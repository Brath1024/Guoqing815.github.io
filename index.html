<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:description" content="ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/avatar.png"}},"description":"ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"}</script><link rel="icon" href="https://brath.cloud/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">ä¸»é¡µ</a><a class="navbar-item" href="/archives">æ–‡ç« åˆ—è¡¨</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">æ›´å¤š</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-12T04:13:41.000Z" title="2023-6-12 12:13:41">2023-06-12</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-12T06:25:42.191Z" title="2023-6-12 14:25:42">2023-06-12</time>æ›´æ–°</span><span class="level-item">17 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2519ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/12/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%89%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸‰æœŸ-å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼å®æˆ˜åˆ†äº«</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸‰æœŸ-å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼å®æˆ˜åˆ†äº«"><a class="markdownIt-Anchor" href="#å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸‰æœŸ-å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼å®æˆ˜åˆ†äº«">#</a> ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸‰æœŸ - å…¬ä¼—å·äº‹ä»¶å¤„ç† - è®¾è®¡æ¨¡å¼å®æˆ˜åˆ†äº«</h1>
<h5 id="ç”±äºå†…å®¹è¿‡äºå¹²ç‡¥-brathè¶æœºæ‰“ä¸€æ³¢å¹¿å‘Š"><a class="markdownIt-Anchor" href="#ç”±äºå†…å®¹è¿‡äºå¹²ç‡¥-brathè¶æœºæ‰“ä¸€æ³¢å¹¿å‘Š">#</a> ç”±äºå†…å®¹è¿‡äºå¹²ç‡¥ã€‚brath è¶æœºæ‰“ä¸€æ³¢å¹¿å‘Šâ€¦</h5>
<p>â€‹		ç”± Brath å…¨æ ˆå¼€å‘çš„ç¨‹åºå‘˜åˆ·é¢˜åº”ç”¨ - é¢è¯•è®°   ç°å·²ç»å…¨é¢å¼€æ”¾æµ‹è¯•ã€‚</p>
<p>â€‹		åœ¨é¢è¯•è®°ï¼Œä½ å¯ä»¥ï¼šè·å–ä¸åˆ†äº«ç¼–ç¨‹çŸ¥è¯†ä¸é¢ç»ï¼Œæ•°åä¸‡é“é¢˜ç›®ä¾›ä½ é€‰æ‹©ï¼Œé€šè¿‡å–œçˆ±æ ‡ç­¾è‡ªç”±ç»„å·ï¼Œæ¨¡æ‹Ÿé¢è¯•ï¼Œæœ€æ–°æ”¯æŒ GPT3.5 å…è´¹ä½¿ç”¨â€¦</p>
<p>â€‹		ç”±äºæ—¶é—´åŸå› ï¼Œæ›´å¤šåŠŸèƒ½è¿˜åœ¨æ…¢æ…¢å¼€å‘ä¸­ï¼Œå¦‚æœä½ å¯¹é¢è¯•è®°æ„Ÿå…´è¶£ï¼Œæƒ³è¦å…±åŒå¼€å‘çš„è¯ï¼Œè¯·è”ç³»æˆ‘çš„å¾®ä¿¡ï¼šã€Brath_codeã€‘</p>
<h1 id="é¢è¯•è®°app"><a class="markdownIt-Anchor" href="#é¢è¯•è®°app">#</a> é¢è¯•è®° APP</h1>
<p>Githubï¼š<a target="_blank" rel="noopener" href="https://github.com/Guoqing815/interview">https://github.com/Guoqing815/interview</a></p>
<p>å®‰å“ APP ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://www.pgyer.com/interview_app_release">https://www.pgyer.com/interview_app_release</a></p>
<p>Brath çš„ä¸ªäººåšå®¢ï¼š<a target="_blank" rel="noopener" href="https://brath.top">https://brath.top</a></p>
<p>é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·ï¼Œå®šæœŸåˆ†äº«æœ‰è¶£çš„ç¼–ç¨‹çŸ¥è¯†ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA">https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA</a></p>
<p><img src="https://camo.githubusercontent.com/30a0dd68364ce682ad0943a209c35e165505540ed677f6ff967e9f6e823cfaac/68747470733a2f2f6272617468342e6f73732d636e2d7368656e7a68656e2e616c6979756e63732e636f6d2f706963676f2f696d6167652d32303233303531373135313031393333352e706e67" alt="image-20230517151019335"></p>
<h1 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€</h1>
<p>â€‹		ä¸ŠæœŸæˆ‘ä»¬ä»‹ç»äº†ç”¨éå¸¸ä¼˜é›…çš„æ–¹å¼æ¥å®ç°å‘é€æ¨¡æ¿æ¶ˆæ¯ï¼Œæœ¬æœŸå°†ç»“åˆå·¥å‚æ¨¡å¼ + ç­–ç•¥æ¨¡å¼æ¥åŒæ ·ä¼˜é›…çš„å®ç°å…¬ä¼—å·äº‹ä»¶å¤„ç†ã€‚</p>
<h5 id=""><a class="markdownIt-Anchor" href="#">#</a> </h5>
<h1 id="é¦–å…ˆæ¥å›é¡¾ä¸‹å·¥å‚å’Œç­–ç•¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#é¦–å…ˆæ¥å›é¡¾ä¸‹å·¥å‚å’Œç­–ç•¥æ¨¡å¼">#</a> é¦–å…ˆæ¥å›é¡¾ä¸‹å·¥å‚å’Œç­–ç•¥æ¨¡å¼ğŸ’»</h1>
<h4 id="å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#å·¥å‚æ¨¡å¼">#</a> å·¥å‚æ¨¡å¼ï¼š</h4>
<p>â€‹		å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ï¼Œè€Œä¸å¿…æš´éœ²å¯¹è±¡åˆ›å»ºçš„é€»è¾‘ã€‚åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå·¥å‚æ¥å£ï¼Œè¯¥æ¥å£æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ç”¨äºåˆ›å»ºå¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å®ç°è¿™ä¸ªæ¥å£æ¥åˆ›å»ºå…·ä½“çš„å¯¹è±¡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸æš´éœ²å¯¹è±¡åˆ›å»ºé€»è¾‘çš„æƒ…å†µä¸‹åˆ›å»ºå¯¹è±¡ã€‚</p>
<h4 id="ç­–ç•¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#ç­–ç•¥æ¨¡å¼">#</a> ç­–ç•¥æ¨¡å¼ï¼š</h4>
<p>â€‹		ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚åœ¨ç­–ç•¥æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•å°è£…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¸­ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ã€‚</p>
<h1 id="æ­£æ–‡å¼€å§‹"><a class="markdownIt-Anchor" href="#æ­£æ–‡å¼€å§‹">#</a> æ­£æ–‡å¼€å§‹ï¼š</h1>
<h2 id="ä¸€-è®¾è®¡æ€æƒ³"><a class="markdownIt-Anchor" href="#ä¸€-è®¾è®¡æ€æƒ³">#</a> ä¸€ã€è®¾è®¡æ€æƒ³</h2>
<h6 id="1äº‹ä»¶ç­–ç•¥å°†è®¸å¤šç±»å‹çš„äº‹ä»¶åˆ†ä¸ºä¸åŒçš„ç­–ç•¥ä¾‹å¦‚æ–‡æœ¬æ¶ˆæ¯-å›¾ç‰‡æ¶ˆæ¯-äº‹ä»¶æ¶ˆæ¯ç­‰ç­‰"><a class="markdownIt-Anchor" href="#1äº‹ä»¶ç­–ç•¥å°†è®¸å¤šç±»å‹çš„äº‹ä»¶åˆ†ä¸ºä¸åŒçš„ç­–ç•¥ä¾‹å¦‚æ–‡æœ¬æ¶ˆæ¯-å›¾ç‰‡æ¶ˆæ¯-äº‹ä»¶æ¶ˆæ¯ç­‰ç­‰">#</a> 1. äº‹ä»¶ç­–ç•¥ï¼šå°†è®¸å¤šç±»å‹çš„äº‹ä»¶åˆ†ä¸ºä¸åŒçš„ç­–ç•¥ï¼Œä¾‹å¦‚æ–‡æœ¬æ¶ˆæ¯ã€å›¾ç‰‡æ¶ˆæ¯ã€äº‹ä»¶æ¶ˆæ¯ç­‰ç­‰ã€‚</h6>
<h6 id="2äº‹ä»¶å·¥å‚å‚¨å­˜æ‰€æœ‰äº‹ä»¶ä¿¡æ¯å¯¹å¤–æä¾›è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•"><a class="markdownIt-Anchor" href="#2äº‹ä»¶å·¥å‚å‚¨å­˜æ‰€æœ‰äº‹ä»¶ä¿¡æ¯å¯¹å¤–æä¾›è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•">#</a> 2. äº‹ä»¶å·¥å‚ï¼šå‚¨å­˜æ‰€æœ‰äº‹ä»¶ä¿¡æ¯ï¼Œå¯¹å¤–æä¾›è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•ã€‚</h6>
<h6 id="3äº‹ä»¶è§£æå­˜å‚¨äº‹ä»¶å·¥å‚å¯¹å¤–æä¾›è§£ææ–¹æ³•è¿”å›è§£æåçš„å®ä½“å¯¹è±¡wechatmessage"><a class="markdownIt-Anchor" href="#3äº‹ä»¶è§£æå­˜å‚¨äº‹ä»¶å·¥å‚å¯¹å¤–æä¾›è§£ææ–¹æ³•è¿”å›è§£æåçš„å®ä½“å¯¹è±¡wechatmessage">#</a> 3. äº‹ä»¶è§£æï¼šå­˜å‚¨äº‹ä»¶å·¥å‚ï¼Œå¯¹å¤–æä¾›è§£ææ–¹æ³•ï¼Œè¿”å›è§£æåçš„å®ä½“å¯¹è±¡ WechatMessage</h6>
<h6 id="4äº‹ä»¶å¤„ç†é€šè¿‡å·¥å‚æä¾›çš„è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•é…åˆä¼ æ¥çš„äº‹ä»¶ç±»å‹è·å–å…·ä½“å¤„ç†å™¨åœ¨è¿›è¡Œæ¶ˆæ¯å¤„ç†"><a class="markdownIt-Anchor" href="#4äº‹ä»¶å¤„ç†é€šè¿‡å·¥å‚æä¾›çš„è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•é…åˆä¼ æ¥çš„äº‹ä»¶ç±»å‹è·å–å…·ä½“å¤„ç†å™¨åœ¨è¿›è¡Œæ¶ˆæ¯å¤„ç†">#</a> 4. äº‹ä»¶å¤„ç†ï¼šé€šè¿‡å·¥å‚æä¾›çš„è·å–äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•ï¼Œé…åˆä¼ æ¥çš„äº‹ä»¶ç±»å‹è·å–å…·ä½“å¤„ç†å™¨åœ¨è¿›è¡Œæ¶ˆæ¯å¤„ç†ã€‚</h6>
<h2 id="äºŒ-ç»“æ„é¢„è§ˆ"><a class="markdownIt-Anchor" href="#äºŒ-ç»“æ„é¢„è§ˆ">#</a> äºŒã€ç»“æ„é¢„è§ˆ</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230612142541419.png" alt="image-20230612142541419"></p>
<h4 id="eventprocessingåŒ…å®šä¹‰äº‹ä»¶å¤„ç†pojoå¯¹è±¡-å¤„ç†å™¨-å¤„ç†å™¨å·¥å‚-è§£æå™¨"><a class="markdownIt-Anchor" href="#eventprocessingåŒ…å®šä¹‰äº‹ä»¶å¤„ç†pojoå¯¹è±¡-å¤„ç†å™¨-å¤„ç†å™¨å·¥å‚-è§£æå™¨">#</a> eventProcessing åŒ…ï¼Œå®šä¹‰äº‹ä»¶å¤„ç† POJO å¯¹è±¡ã€å¤„ç†å™¨ã€å¤„ç†å™¨å·¥å‚ã€è§£æå™¨ã€‚</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230612135531430.png" alt="image-20230612135531430"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230612135502183.png" alt="image-20230612135502183"></p>
<h4 id="handlersåŒ…å®šä¹‰å¤šç§äº‹ä»¶æ¶ˆæ¯ç­–ç•¥å¤„ç†å™¨"><a class="markdownIt-Anchor" href="#handlersåŒ…å®šä¹‰å¤šç§äº‹ä»¶æ¶ˆæ¯ç­–ç•¥å¤„ç†å™¨">#</a> handlers åŒ…ï¼Œå®šä¹‰å¤šç§äº‹ä»¶æ¶ˆæ¯ç­–ç•¥å¤„ç†å™¨ã€‚</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230612135404358.png" alt="image-20230612135404358"></p>
<p>é¢„è§ˆäº†ç»“æ„ä¹‹åï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£ä¸‹é¢çš„ä»£ç å®ç°</p>
<h2 id="ä¸‰-ç­–ç•¥æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹"><a class="markdownIt-Anchor" href="#ä¸‰-ç­–ç•¥æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹">#</a> ä¸‰ã€ç­–ç•¥æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹</h2>
<p>ç°åœ¨å¼€å§‹å®ç°ä»£ç çš„éƒ¨åˆ†ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰äº‹ä»¶å¯¹è±¡ã€äº‹ä»¶æ¶ˆæ¯æ¥å£ã€åŸºç¡€å®ç°</p>
<h5 id="äº‹ä»¶å¯¹è±¡"><a class="markdownIt-Anchor" href="#äº‹ä»¶å¯¹è±¡">#</a> äº‹ä»¶å¯¹è±¡ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-12 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessage å¾®ä¿¡æ¶ˆæ¯èšåˆå¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessage</span> &#123;</span><br><span class="line">    <span class="comment">// æ¥æ”¶æ–¹å¸å·ï¼ˆæ”¶åˆ°çš„OpenIDï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String toUserName;</span><br><span class="line">    <span class="comment">// å¼€å‘è€…å¾®ä¿¡å·</span></span><br><span class="line">    <span class="keyword">private</span> String fromUserName;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯åˆ›å»ºæ—¶é—´ ï¼ˆæ•´å‹ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> createTime;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯ç±»å‹ï¼Œæ–‡æœ¬ä¸ºtext</span></span><br><span class="line">    <span class="keyword">private</span> String msgType;</span><br><span class="line">    <span class="comment">// æ–‡æœ¬æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯idï¼Œ64ä½æ•´å‹</span></span><br><span class="line">    <span class="keyword">private</span> String msgId;</span><br><span class="line">    <span class="comment">// äº‹ä»¶ç±»å‹ï¼Œsubscribe(è®¢é˜…)ã€unsubscribe(å–æ¶ˆè®¢é˜…)</span></span><br><span class="line">    <span class="keyword">private</span> String event;</span><br><span class="line">    <span class="comment">// äº‹ä»¶KEYå€¼ï¼Œqrscene_ä¸ºå‰ç¼€ï¼Œåé¢ä¸ºäºŒç»´ç çš„å‚æ•°å€¼</span></span><br><span class="line">    <span class="keyword">private</span> String eventKey;</span><br><span class="line">    <span class="comment">// äºŒç»´ç çš„ticketï¼Œå¯ç”¨æ¥æ¢å–äºŒç»´ç å›¾ç‰‡</span></span><br><span class="line">    <span class="keyword">private</span> String ticket;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®çº¬åº¦</span></span><br><span class="line">    <span class="keyword">private</span> String latitude;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®ç»åº¦</span></span><br><span class="line">    <span class="keyword">private</span> String longitude;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®ç²¾åº¦</span></span><br><span class="line">    <span class="keyword">private</span> String precision;</span><br><span class="line">    <span class="comment">// å›¾ç‰‡é“¾æ¥ï¼ˆç”±ç³»ç»Ÿç”Ÿæˆï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> String picUrl;</span><br><span class="line">    <span class="comment">// å›¾ç‰‡æ¶ˆæ¯åª’ä½“idï¼Œå¯ä»¥è°ƒç”¨å¤šåª’ä½“æ–‡ä»¶ä¸‹è½½æ¥å£æ‹‰å–æ•°æ®ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> String mediaId;</span><br><span class="line">    <span class="comment">// è¯­éŸ³æ ¼å¼ï¼Œå¦‚amrï¼Œspeexç­‰</span></span><br><span class="line">    <span class="keyword">private</span> String format;</span><br><span class="line">    <span class="comment">// è§†é¢‘æ¶ˆæ¯ç¼©ç•¥å›¾çš„åª’ä½“idï¼Œå¯ä»¥è°ƒç”¨å¤šåª’ä½“æ–‡ä»¶ä¸‹è½½æ¥å£æ‹‰å–æ•°æ®ã€‚</span></span><br><span class="line">    <span class="keyword">private</span> String thumbMediaId;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®çº¬åº¦</span></span><br><span class="line">    <span class="keyword">private</span> String location_X;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®ç»åº¦</span></span><br><span class="line">    <span class="keyword">private</span> String location_Y;</span><br><span class="line">    <span class="comment">// åœ°å›¾ç¼©æ”¾å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> String scale;</span><br><span class="line">    <span class="comment">// åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> String label;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯æè¿°</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯é“¾æ¥</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="comment">// éŸ³ä¹é“¾æ¥</span></span><br><span class="line">    <span class="keyword">private</span> String musicUrl;</span><br><span class="line">    <span class="comment">// é«˜è´¨é‡éŸ³ä¹é“¾æ¥ï¼ŒWIFIç¯å¢ƒä¼˜å…ˆä½¿ç”¨è¯¥é“¾æ¥æ’­æ”¾éŸ³ä¹</span></span><br><span class="line">    <span class="keyword">private</span> String hqMusicUrl;</span><br><span class="line">    <span class="comment">// è¯­éŸ³è¯†åˆ«ç»“æœï¼ŒUTF8ç¼–ç </span></span><br><span class="line">    <span class="keyword">private</span> String recognition;</span><br><span class="line">    <span class="comment">// åŠ å¯†ä¿¡æ¯ï¼Œä»…åœ¨ä½¿ç”¨å®‰å…¨æ¨¡å¼ä¸‹éœ€è¦</span></span><br><span class="line">    <span class="keyword">private</span> String encrypt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="äº‹ä»¶æ¶ˆæ¯æ¥å£"><a class="markdownIt-Anchor" href="#äº‹ä»¶æ¶ˆæ¯æ¥å£">#</a> äº‹ä»¶æ¶ˆæ¯æ¥å£ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-12 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageHandler å¾®ä¿¡æ¶ˆæ¯å¤„ç†æ¥å£è§„èŒƒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WechatMessageHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å™¨æ˜¯å¦æ”¯æŒ $&#123;messageType&#125; ç±»å‹</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> messageType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(String messageType)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡XMLæ•°æ®è§£ææ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wechatMessage</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xmlElement</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">parseMessage</span><span class="params">(WechatMessage wechatMessage, Element xmlElement)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å¾®ä¿¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wechatMessage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">handleMessage</span><span class="params">(WechatMessage wechatMessage, HttpServletRequest request)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å¤„ç†å™¨åç§°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getHandleName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å®ç°ç±»"><a class="markdownIt-Anchor" href="#å®ç°ç±»">#</a> å®ç°ç±»ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component(EventConsts.TEXT_MESSAGE_HANDLER)</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;æ–‡æœ¬æ¶ˆæ¯å¤„ç†å™¨&quot;)</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextMessageHandler</span> <span class="keyword">implements</span> <span class="title class_">WechatMessageHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(TextMessageHandler.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡æœ¬æ¶ˆæ¯å›å¤æœåŠ¡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> TextReplyService textReplyService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHandleName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> EventConsts.TEXT_MESSAGE_HANDLER;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(String messageType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;text&quot;</span>.equals(messageType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">parseMessage</span><span class="params">(WechatMessage wechatMessage, Element xmlElement)</span> &#123;</span><br><span class="line">        <span class="comment">// è§£ææ–‡æœ¬æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> xmlElement.elementText(<span class="string">&quot;Content&quot;</span>);</span><br><span class="line">        wechatMessage.setContent(content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleMessage</span><span class="params">(WechatMessage wechatMessage, HttpServletRequest request)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ”¶åˆ°æ–‡æœ¬æ¶ˆæ¯ wechatMessage: &#123;&#125;&quot;</span>, wechatMessage);</span><br><span class="line">        <span class="comment">//TODO...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šEventConsts ä¸ºå¸¸é‡ï¼Œå¯ä»¥è‡ªå·±å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TEXT_MESSAGE_HANDLER</span> <span class="operator">=</span> <span class="string">&quot;textMessageHandler&quot;</span>;</span><br></pre></td></tr></table></figure>
<h6 id="è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªäº‹ä»¶æ¶ˆæ¯å¤„ç†è§„èŒƒæ¥å£ä»¥åŠå…·ä½“çš„å¤„ç†å™¨å®ç°"><a class="markdownIt-Anchor" href="#è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªäº‹ä»¶æ¶ˆæ¯å¤„ç†è§„èŒƒæ¥å£ä»¥åŠå…·ä½“çš„å¤„ç†å™¨å®ç°">#</a> è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªäº‹ä»¶æ¶ˆæ¯å¤„ç†è§„èŒƒæ¥å£ï¼Œä»¥åŠå…·ä½“çš„å¤„ç†å™¨å®ç°</h6>
<h2 id="å››-äº‹ä»¶å·¥å‚äº‹ä»¶å¤„ç†å™¨å®ç°"><a class="markdownIt-Anchor" href="#å››-äº‹ä»¶å·¥å‚äº‹ä»¶å¤„ç†å™¨å®ç°">#</a> å››ã€äº‹ä»¶å·¥å‚ï¼Œäº‹ä»¶å¤„ç†å™¨å®ç°</h2>
<h5 id="äº‹ä»¶å·¥å‚"><a class="markdownIt-Anchor" href="#äº‹ä»¶å·¥å‚">#</a> äº‹ä»¶å·¥å‚ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-12 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageHandlerFactory  å¾®ä¿¡æ¶ˆæ¯å¤„ç†å™¨å·¥å‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageHandlerFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆæ¯äº‹ä»¶å¤„ç†å™¨ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;WechatMessageHandler&gt; messageHandlers;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–å¤„ç†å™¨ç»„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initService</span><span class="params">(WechatMessageHandler[] properties)</span> &#123;</span><br><span class="line">        messageHandlers = Arrays.asList(properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æ¶ˆæ¯ç±»å‹è·å–å¤„ç†å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> messageType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> WechatMessageHandler <span class="title function_">getMessageHandler</span><span class="params">(String messageType)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> messageHandlers.stream()</span><br><span class="line">                .filter(handler -&gt; handler.supports(messageType))</span><br><span class="line">                .findFirst()</span><br><span class="line">                .orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="äº‹ä»¶å¤„ç†å™¨"><a class="markdownIt-Anchor" href="#äº‹ä»¶å¤„ç†å™¨">#</a> äº‹ä»¶å¤„ç†å™¨ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageParser</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç†å™¨å·¥å‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> WechatMessageHandlerFactory wechatMessageHandlerFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">setWechatMessageHandlerFactory</span><span class="params">(WechatMessageHandlerFactory wechatMessageHandlerFactory)</span> &#123;</span><br><span class="line">        WechatMessageParser.wechatMessageHandlerFactory = wechatMessageHandlerFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£æXML</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> xml</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WechatMessage <span class="title function_">parse</span><span class="params">(String xml)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> DocumentHelper.parseText(xml);</span><br><span class="line">            <span class="type">Element</span> <span class="variable">rootElement</span> <span class="operator">=</span> document.getRootElement();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–æ¶ˆæ¯ç±»å‹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">messageType</span> <span class="operator">=</span> rootElement.elementText(<span class="string">&quot;MsgType&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å¯¹è±¡è½¬æ¢</span></span><br><span class="line">            <span class="type">WechatMessage</span> <span class="variable">wechatMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WechatMessage</span>()</span><br><span class="line">                    .setToUserName(rootElement.elementText(<span class="string">&quot;ToUserName&quot;</span>))</span><br><span class="line">                    .setFromUserName(rootElement.elementText(<span class="string">&quot;FromUserName&quot;</span>))</span><br><span class="line">                    .setCreateTime(Long.parseLong(rootElement.elementText(<span class="string">&quot;CreateTime&quot;</span>)))</span><br><span class="line">                    .setMsgType(messageType);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//é€šè¿‡å·¥å‚è·å–å¤„ç†å™¨ï¼Œå¹¶ä½¿ç”¨å¤„ç†å™¨parseMessageæ–¹æ³•è§£æå½“å‰æ¶ˆæ¯ä»¥åŠelementå¯¹è±¡</span></span><br><span class="line">            Optional&lt;WechatMessageHandler&gt; optionalMessageHandler = Optional.ofNullable(wechatMessageHandlerFactory.getMessageHandler(messageType));</span><br><span class="line">            optionalMessageHandler.ifPresent(handler -&gt; handler.parseMessage(wechatMessage, rootElement));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> wechatMessage;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (DocumentException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="è¿™ä¸¤æ®µä»£ç æˆ‘ä»¬å®ç°äº†äº‹ä»¶å·¥å‚ä»¥åŠäº‹ä»¶è§£æå™¨çš„å®ç°"><a class="markdownIt-Anchor" href="#è¿™ä¸¤æ®µä»£ç æˆ‘ä»¬å®ç°äº†äº‹ä»¶å·¥å‚ä»¥åŠäº‹ä»¶è§£æå™¨çš„å®ç°">#</a> è¿™ä¸¤æ®µä»£ç æˆ‘ä»¬å®ç°äº†äº‹ä»¶å·¥å‚ä»¥åŠäº‹ä»¶è§£æå™¨çš„å®ç°ã€‚</h5>
<h2 id="åˆ°æ­¤ä¸ºæ­¢æ•´æ¡é“¾è·¯æ‰“é€šå¯ä»¥æ¥å•å…ƒæµ‹è¯•ä¸€ä¸‹"><a class="markdownIt-Anchor" href="#åˆ°æ­¤ä¸ºæ­¢æ•´æ¡é“¾è·¯æ‰“é€šå¯ä»¥æ¥å•å…ƒæµ‹è¯•ä¸€ä¸‹">#</a> åˆ°æ­¤ä¸ºæ­¢ï¼Œæ•´æ¡é“¾è·¯æ‰“é€šï¼Œå¯ä»¥æ¥å•å…ƒæµ‹è¯•ä¸€ä¸‹ï¼š</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-12 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: SpringRunnerTest</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRunnerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SpringRunnerTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> WechatMessageHandlerFactory wechatMessageHandlerFactory;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æµ‹è¯•textç­–ç•¥å¤„ç†å™¨</span></span><br><span class="line">        <span class="type">WechatMessageHandler</span> <span class="variable">textHandler</span> <span class="operator">=</span> wechatMessageHandlerFactory.getMessageHandler(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">        System.out.println(textHandler.getHandleName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ä½ç½®ç­–ç•¥å¤„ç†å™¨</span></span><br><span class="line">        <span class="type">WechatMessageHandler</span> <span class="variable">location</span> <span class="operator">=</span> wechatMessageHandlerFactory.getMessageHandler(<span class="string">&quot;location&quot;</span>);</span><br><span class="line">        System.out.println(location.getHandleName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•è§£ætextçš„xmlæ•°æ®</span></span><br><span class="line">        <span class="type">WechatMessage</span> <span class="variable">wechatMessage</span> <span class="operator">=</span> WechatMessageParser.parse(<span class="string">&quot;&lt;xml&gt;&lt;ToUserName&gt;&lt;!				 [CDATA[gh_6ecd244c13d6]]&gt;&lt;/ToUserName&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;FromUserName&gt;&lt;![CDATA[ow3gF5zkvJc097jaYvLj5uWKZZTk]]&gt;&lt;/FromUserName&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;CreateTime&gt;1686546944&lt;/CreateTime&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;Content&gt;&lt;![CDATA[æµ‹è¯•]]&gt;&lt;/Content&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;MsgId&gt;24145550072327732&lt;/MsgId&gt;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&lt;/xml&gt;\n&quot;</span>);</span><br><span class="line">        System.out.println(wechatMessage);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æµ‹è¯•ä½¿ç”¨textç­–ç•¥å¤„ç†å™¨å¤„ç†wechatMessageå¯¹è±¡</span></span><br><span class="line">        <span class="type">MockHttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MockHttpServletRequest</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> textHandler.handleMessage(wechatMessage, request);</span><br><span class="line">        System.out.println(<span class="string">&quot;content: &quot;</span> + content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230612141441920.png" alt="image-20230612141441920"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•textç­–ç•¥å¤„ç†å™¨</span></span><br><span class="line">textMessageHandler</span><br><span class="line">    </span><br><span class="line"><span class="comment">//æµ‹è¯•ä½ç½®ç­–ç•¥å¤„ç†å™¨</span></span><br><span class="line">locationMessageHandler</span><br><span class="line">    </span><br><span class="line"><span class="comment">//æµ‹è¯•è§£ætextçš„xmlæ•°æ®   </span></span><br><span class="line">WechatMessage(toUserName=gh_6ecd244c13d6, fromUserName=ow3gF5zkvJc097jaYvLj5uWKZZTk, createTime=<span class="number">1686546944</span>, msgType=text, content=æµ‹è¯•, msgId=<span class="literal">null</span>, event=<span class="literal">null</span>, eventKey=<span class="literal">null</span>, ticket=<span class="literal">null</span>, latitude=<span class="literal">null</span>, longitude=<span class="literal">null</span>, precision=<span class="literal">null</span>, picUrl=<span class="literal">null</span>, mediaId=<span class="literal">null</span>, format=<span class="literal">null</span>, thumbMediaId=<span class="literal">null</span>, location_X=<span class="literal">null</span>, location_Y=<span class="literal">null</span>, scale=<span class="literal">null</span>, label=<span class="literal">null</span>, title=<span class="literal">null</span>, description=<span class="literal">null</span>, url=<span class="literal">null</span>, musicUrl=<span class="literal">null</span>, hqMusicUrl=<span class="literal">null</span>, recognition=<span class="literal">null</span>, encrypt=<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•ä½¿ç”¨textç­–ç•¥å¤„ç†å™¨å¤„ç†wechatMessageå¯¹è±¡</span></span><br><span class="line">content: &lt;xml&gt;</span><br><span class="line">  &lt;ToUserName&gt;&lt;![CDATA[ow3gF5zkvJc097jaYvLj5uWKZZTk]]&gt;&lt;/ToUserName&gt;</span><br><span class="line">  &lt;FromUserName&gt;&lt;![CDATA[gh_6ecd244c13d6]]&gt;&lt;/FromUserName&gt;</span><br><span class="line">  &lt;CreateTime&gt;&lt;![CDATA[<span class="number">1686550406094</span>]]&gt;&lt;/CreateTime&gt;</span><br><span class="line">  &lt;MsgType&gt;&lt;![CDATA[text]]&gt;&lt;/MsgType&gt;</span><br><span class="line">  &lt;FuncFlag&gt;&lt;![CDATA[<span class="number">0</span>]]&gt;&lt;/FuncFlag&gt;</span><br><span class="line">  &lt;Content&gt;&lt;![CDATA[æµ‹è¯•æˆåŠŸ]]&gt;&lt;/Content&gt;</span><br><span class="line">&lt;/xml&gt;</span><br></pre></td></tr></table></figure>
<h5 id="æµ‹è¯•æˆåŠŸ~"><a class="markdownIt-Anchor" href="#æµ‹è¯•æˆåŠŸ~">#</a> æµ‹è¯•æˆåŠŸï½</h5>
<h6 id="tipså¦‚æœä½ è§‰å¾—brathåˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯è¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äºº~"><a class="markdownIt-Anchor" href="#tipså¦‚æœä½ è§‰å¾—brathåˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯è¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äºº~">#</a> tipsï¼šå¦‚æœä½ è§‰å¾— Brath åˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯ï¼Œè¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äººï½</h6>
<h6 id="åˆ°æ­¤ä¸ºæ­¢å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦è¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨interviewcoderåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ä¸ºäº†æ›´å¥½çš„ä½ ä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><a class="markdownIt-Anchor" href="#åˆ°æ­¤ä¸ºæ­¢å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦è¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨interviewcoderåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ä¸ºäº†æ›´å¥½çš„ä½ ä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ">#</a> åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¬ä¼—å·äº‹ä»¶å¤„ç† - è®¾è®¡æ¨¡å¼çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦ï¼Œè¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨ InterviewCoderï¼Œåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ï¼Œä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œï¼</h6>
<h1 id="å®Œç»“æ’’èŠ±"><a class="markdownIt-Anchor" href="#å®Œç»“æ’’èŠ±">#</a> å®Œç»“æ’’èŠ±â€</h1>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-06T00:13:41.000Z" title="2023-6-6 8:13:41">2023-06-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-06T06:56:51.685Z" title="2023-6-6 14:56:51">2023-06-06</time>æ›´æ–°</span><span class="level-item">29 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦4331ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ-å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯-æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ-å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯-æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«"><a class="markdownIt-Anchor" href="#å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ-å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯-æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«">#</a> ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ - å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯ - æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«</h1>
<h5 id="æ‰“ä¸€æ³¢å¹¿å‘Š"><a class="markdownIt-Anchor" href="#æ‰“ä¸€æ³¢å¹¿å‘Š">#</a> æ‰“ä¸€æ³¢å¹¿å‘Šâ€¦</h5>
<h1 id="é¢è¯•è®°app"><a class="markdownIt-Anchor" href="#é¢è¯•è®°app">#</a> é¢è¯•è®° APP</h1>
<p>Githubï¼š<a target="_blank" rel="noopener" href="https://github.com/Guoqing815/interview">https://github.com/Guoqing815/interview</a></p>
<p>å®‰å“ APP ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://www.pgyer.com/interview_app_release">https://www.pgyer.com/interview_app_release</a></p>
<p>Brath çš„ä¸ªäººåšå®¢ï¼š<a target="_blank" rel="noopener" href="https://brath.top">https://brath.top</a></p>
<p>é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·ï¼Œå®šæœŸåˆ†äº«æœ‰è¶£çš„ç¼–ç¨‹çŸ¥è¯†ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA">https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA</a></p>
<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€</h2>
<p>â€‹		å¤§å®¶å¥½å•Šï¼Œæˆ‘æ˜¯ Brathï¼Œä¸€åæ¿€è¿›çš„å…¨æ ˆå¼€å‘è€…ï¼Œä»è¿™æœŸä¸“æ å¼€å§‹ï¼Œæˆ‘ä¼šé€æ¸åˆ†äº«é¢è¯•è®°é¡¹ç›®ä¸­çš„éƒ¨åˆ†ä¼˜è´¨æºç ç»™åˆ°å¤§å®¶ã€‚è¿˜å¸Œæœ›å¤§å®¶å¤šå¤šå…³æ³¨ï¼</p>
<p>â€‹		ä¸ŠæœŸæˆ‘ä»¬ä»‹ç»äº†å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯çš„é…ç½®æ–¹å¼ï¼Œä»¥åŠ Java ä»£ç ç¤ºä¾‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦ç”¨æ›´ä¼˜é›…çš„æ–¹å¼æ¥å®ç°å‘é€æ¨¡æ¿æ¶ˆæ¯ï¼</p>
<h6 id="æ³¨æ„è¿™æ˜¯å®æˆ˜ä»£ç ä¸æ˜¯demo"><a class="markdownIt-Anchor" href="#æ³¨æ„è¿™æ˜¯å®æˆ˜ä»£ç ä¸æ˜¯demo">#</a> æ³¨æ„ï¼šè¿™æ˜¯å®æˆ˜ä»£ç ï¼Œä¸æ˜¯ Demoï¼</h6>
<h4 id="æ¨¡æ¿æ¨¡å¼ä»‹ç»"><a class="markdownIt-Anchor" href="#æ¨¡æ¿æ¨¡å¼ä»‹ç»">#</a> æ¨¡æ¿æ¨¡å¼ä»‹ç»ï¼š</h4>
<p>â€‹		æ¨¡æ¿æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­å®ç°ã€‚æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡æ–°å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p>
<p>â€‹		åœ¨æ¨¡æ¿æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ï¼Œä»¥åŠä¸€äº›æŠ½è±¡çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éœ€è¦å­ç±»å»å®ç°ã€‚å­ç±»å¯ä»¥ç»§æ‰¿è¯¥æŠ½è±¡ç±»ï¼Œå¹¶å®ç°å…¶ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå®Œæˆå…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h2 id="å¦‚ä½•ä½¿ç”¨æ¨¡æ¿è®¾è®¡æ¨¡å¼ä¼˜é›…çš„å®ç°å‘é€å¾®ä¿¡å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#å¦‚ä½•ä½¿ç”¨æ¨¡æ¿è®¾è®¡æ¨¡å¼ä¼˜é›…çš„å®ç°å‘é€å¾®ä¿¡å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯">#</a> å¦‚ä½•ä½¿ç”¨æ¨¡æ¿è®¾è®¡æ¨¡å¼ä¼˜é›…çš„å®ç°å‘é€å¾®ä¿¡å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯ï¼Ÿ</h2>
<h2 id="ä¸€-è®¾è®¡æ¨¡æ¿æ¶æ„"><a class="markdownIt-Anchor" href="#ä¸€-è®¾è®¡æ¨¡æ¿æ¶æ„">#</a> ä¸€ã€è®¾è®¡æ¨¡æ¿æ¶æ„</h2>
<p>â€‹		æˆ‘ä»¬çš„ä¸šåŠ¡å°±æ˜¯å‘é€æ¨¡æ¿æ¶ˆæ¯ï¼Œæœ€å¼€å§‹æˆ‘ä½¿ç”¨äº† switch åˆ†æ”¯æ¥åˆ¤æ–­ä¸åŒçš„æ¨¡æ¿æ¶ˆæ¯ï¼Œèµ·åˆå®ƒæ˜¯å¥½ç”¨çš„ï¼Œä½†æ˜¯éšç€æ¶ˆæ¯ç±»å‹çš„å¢åŠ ï¼Œæ…¢æ…¢çš„ä»£ç å¼€å§‹å†—ä½™äº†èµ·æ¥ï¼Œæ‰€ä»¥æˆ‘æƒ³åˆ°äº†åˆ©ç”¨æ¨¡æ¿æ¨¡å¼æ¥å½»åº•ä¼˜åŒ–è¿™ä¸ªä¸šåŠ¡ã€‚</p>
<p>â€‹		è¿™æ¬¡è®¾è®¡çš„æ¨¡æ¿æ¶æ„åˆ†ä¸ºäº”ä¸ªæ¨¡å—ï¼š</p>
<h6 id="1æ¨¡æ¿å®šä¹‰æ¯ä¸ªæ¨¡æ¿çš„è§„èŒƒæŠ½å–å…±æ€§æ–¹æ³•å‡ç»ƒé‡è¦åŠŸèƒ½"><a class="markdownIt-Anchor" href="#1æ¨¡æ¿å®šä¹‰æ¯ä¸ªæ¨¡æ¿çš„è§„èŒƒæŠ½å–å…±æ€§æ–¹æ³•å‡ç»ƒé‡è¦åŠŸèƒ½">#</a> 1. æ¨¡æ¿ï¼šå®šä¹‰æ¯ä¸ªæ¨¡æ¿çš„è§„èŒƒï¼ŒæŠ½å–å…±æ€§æ–¹æ³•ï¼Œå‡ç»ƒé‡è¦åŠŸèƒ½</h6>
<h6 id="2æ¶ˆæ¯ç±»å‹åˆ†ç±»ç®¡ç†ä¸ºä¸åŒçš„æ¶ˆæ¯ç±»å‹èµ‹èƒ½"><a class="markdownIt-Anchor" href="#2æ¶ˆæ¯ç±»å‹åˆ†ç±»ç®¡ç†ä¸ºä¸åŒçš„æ¶ˆæ¯ç±»å‹èµ‹èƒ½">#</a> 2. æ¶ˆæ¯ç±»å‹ï¼šåˆ†ç±»ç®¡ç†ï¼Œä¸ºä¸åŒçš„æ¶ˆæ¯ç±»å‹èµ‹èƒ½</h6>
<h6 id="3ç±»å‹é…ç½®ä¾¿æºç®¡ç†æ¶ˆæ¯ç±»å‹æ‘’å¼ƒäº†ifä¸switchåˆ¤æ–­"><a class="markdownIt-Anchor" href="#3ç±»å‹é…ç½®ä¾¿æºç®¡ç†æ¶ˆæ¯ç±»å‹æ‘’å¼ƒäº†ifä¸switchåˆ¤æ–­">#</a> 3. ç±»å‹é…ç½®ï¼šä¾¿æºç®¡ç†æ¶ˆæ¯ç±»å‹ï¼Œæ‘’å¼ƒäº† if ä¸ switch åˆ¤æ–­</h6>
<h6 id="4æ•°æ®æ”¯æ’‘ä¸ºæ¨¡æ¿æ¶ˆæ¯æä¾›åŸºç¡€æ•°æ®æ”¯æ’‘ä¾‹å¦‚å…¬ä¼—å·æ¶ˆæ¯æ¨é€ä¸šåŠ¡"><a class="markdownIt-Anchor" href="#4æ•°æ®æ”¯æ’‘ä¸ºæ¨¡æ¿æ¶ˆæ¯æä¾›åŸºç¡€æ•°æ®æ”¯æ’‘ä¾‹å¦‚å…¬ä¼—å·æ¶ˆæ¯æ¨é€ä¸šåŠ¡">#</a> 4. æ•°æ®æ”¯æ’‘ï¼šä¸ºæ¨¡æ¿æ¶ˆæ¯æä¾›åŸºç¡€æ•°æ®æ”¯æ’‘ï¼Œä¾‹å¦‚å…¬ä¼—å·æ¶ˆæ¯æ¨é€ä¸šåŠ¡</h6>
<h6 id="5ç»Ÿä¸€æ ¡éªŒåœ¨æŠ½è±¡çš„å±‚é¢å»æ ¡éªŒæ¨¡æ¿åˆæ³•æ€§æ ¡éªŒé€šè¿‡å‘é€æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#5ç»Ÿä¸€æ ¡éªŒåœ¨æŠ½è±¡çš„å±‚é¢å»æ ¡éªŒæ¨¡æ¿åˆæ³•æ€§æ ¡éªŒé€šè¿‡å‘é€æ¶ˆæ¯">#</a> 5. ç»Ÿä¸€æ ¡éªŒï¼šåœ¨æŠ½è±¡çš„å±‚é¢å»æ ¡éªŒæ¨¡æ¿åˆæ³•æ€§ï¼Œæ ¡éªŒé€šè¿‡å‘é€æ¶ˆæ¯</h6>
<h6 id="6æ¶ˆæ¯æ³¨å…¥æ¥å£å±‚é¢é€šè¿‡åå°„å®ä¾‹åŒ–æ¶ˆæ¯å¹¶å°†å‚æ•°é›†åˆæ³¨å…¥æ¶ˆæ¯ä½“"><a class="markdownIt-Anchor" href="#6æ¶ˆæ¯æ³¨å…¥æ¥å£å±‚é¢é€šè¿‡åå°„å®ä¾‹åŒ–æ¶ˆæ¯å¹¶å°†å‚æ•°é›†åˆæ³¨å…¥æ¶ˆæ¯ä½“">#</a> 6. æ¶ˆæ¯æ³¨å…¥ï¼šæ¥å£å±‚é¢é€šè¿‡åå°„å®ä¾‹åŒ–æ¶ˆæ¯ï¼Œå¹¶å°†å‚æ•°é›†åˆæ³¨å…¥æ¶ˆæ¯ä½“</h6>
<h2 id="äºŒ-ç»“æ„é¢„è§ˆ"><a class="markdownIt-Anchor" href="#äºŒ-ç»“æ„é¢„è§ˆ">#</a> äºŒã€ç»“æ„é¢„è§ˆ</h2>
<h4 id="messagedataåŒ…å®šä¹‰æ¶ˆæ¯ä½“è§„èŒƒæ¶ˆæ¯æ ¼å¼"><a class="markdownIt-Anchor" href="#messagedataåŒ…å®šä¹‰æ¶ˆæ¯ä½“è§„èŒƒæ¶ˆæ¯æ ¼å¼">#</a> messageData åŒ…ï¼Œå®šä¹‰æ¶ˆæ¯ä½“ï¼Œè§„èŒƒæ¶ˆæ¯æ ¼å¼</h4>
<p>1.IMessage ä¸ºæ¨¡æ¿é€šç”¨å®šä¹‰ï¼Œå®ç°äº†ä¸¤ä¸ªæ–¹æ³•ï¼ŒgetMessageName ç”¨äºè·å–æ¨¡æ¿è‡ªå·±çš„åç§°ï¼ŒgetWxMaTemplateData ç”¨äºè·å–æ¨¡æ¿çš„å‚æ•°é…ç½®</p>
<p>2.LoginSuccessTemplateImpl ä¸ºç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯çš„å®ä¾‹å®šä¹‰ï¼Œå®ç°äº† IMessage æ¥å£ï¼Œå¹¶ä¸”é‡å†™ getMessageName å’Œ getWxMaTemplateData æ–¹æ³•ï¼Œå³èƒ½æä¾›è‡ªå·±çš„åç§°å’Œå‚æ•°åˆ—è¡¨åˆ°æ¥å£å®šä¹‰ä¸­ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141325324.png" alt="image-20230606141325324"></p>
<h4 id="messagemoduleåŒ…å®šä¹‰æ¨¡æ¿é…ç½®å‘é€æµç¨‹"><a class="markdownIt-Anchor" href="#messagemoduleåŒ…å®šä¹‰æ¨¡æ¿é…ç½®å‘é€æµç¨‹">#</a> messageModule åŒ…ï¼Œå®šä¹‰æ¨¡æ¿é…ç½®ï¼Œå‘é€æµç¨‹</h4>
<p>1.WechatMessageConfig ä¸ºæ¨¡æ¿é…ç½®ï¼Œç”¨äºè·å–æ‰€æœ‰æ¨¡æ¿æ˜ å°„çš„é›†åˆï¼Œæ–¹ä¾¿æˆ‘ä»¬é€šè¿‡åç§°è·å–æ¨¡æ¿é…ç½®å®ä¾‹ï¼Œæ‘’å¼ƒäº† ifelse çš„åˆ¤æ–­æ¨¡å¼ã€‚</p>
<p>2.WechatMessageSupport ä¸ºåŸºç¡€æ•°æ®æ”¯æ’‘ï¼Œç”¨äºæä¾›åŸºç¡€çš„å¾®ä¿¡æ¨¡æ¿å‘é€æ¶ˆæ¯çš„æ–¹æ³•ï¼Œä»¥åŠæ¨¡æ¿æ¶ˆæ¯æ³¨å…¥æ–¹æ³•çš„å®ç°ã€‚</p>
<p>3.IWechatMessageExec ä¸ºå‘é€æ¨¡æ¿çš„æ¥å£ï¼Œç”¨äºå®ç°å‘é€æ¨¡æ¿æ¶ˆæ¯çš„è§„èŒƒã€‚</p>
<p>4.AbstractWechatMessageBase ä¸ºæŠ½è±¡çš„å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ï¼Œç”¨äºæŠ½è±¡åŒ–ç®¡ç†æ‰€æœ‰æ¨¡æ¿æ¶ˆæ¯ï¼Œåœ¨è¿™é‡Œåšå‚æ•°çš„æ ¡éªŒï¼Œä»¥åŠ unionId çš„è·å–ã€‚</p>
<p>5.IWechatMessageExecImpl ä¸ºå‘é€æ¶ˆæ¯çš„å®ç°ï¼Œåœ¨æŠ½è±¡å±‚é¢è·å–åˆ° fromOpenId åå³å¯é€šè¿‡æŠ½è±¡å±‚ç»§æ‰¿çš„ Support å±‚çš„å¾®ä¿¡æ¨¡æ¿å‘é€æ¶ˆæ¯çš„æ–¹æ³•æ¥å‘é€å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141135188.png" alt="image-20230606141135188"></p>
<p>é¢„è§ˆäº†ç»“æ„ä¹‹åï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£ä¸‹é¢çš„ä»£ç å®ç°</p>
<h2 id="ä¸‰-æ¨¡æ¿æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹"><a class="markdownIt-Anchor" href="#ä¸‰-æ¨¡æ¿æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹">#</a> ä¸‰ã€æ¨¡æ¿æ¶ˆæ¯ä»¥åŠå®ç°ç±»å‹</h2>
<p>ç°åœ¨å¼€å§‹å®ç°ä»£ç çš„éƒ¨åˆ†ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ä½“çš„æŠ½è±¡æ¥å£ï¼Œç”¨æ¥è¡¨ç¤ºç»Ÿä¸€çš„æ¨¡æ¿</p>
<h5 id="æŠ½è±¡æ¥å£"><a class="markdownIt-Anchor" href="#æŠ½è±¡æ¥å£">#</a> æŠ½è±¡æ¥å£ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 18:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ¶ˆæ¯ä½“çš„æŠ½è±¡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ¶ˆæ¯åç§°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getMessageName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ¨¡æ¿æ¶ˆæ¯é›†åˆ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;WxMaTemplateData&gt; <span class="title function_">getWxMaTemplateData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å®ç°ç±»"><a class="markdownIt-Anchor" href="#å®ç°ç±»">#</a> å®ç°ç±»ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 18:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;loginSuccessTemplateMessage&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessTemplateImpl</span> <span class="keyword">implements</span> <span class="title class_">IMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç™»å½•ç”¨æˆ·ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç™»å½•åœ°å€ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginAddr;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç™»å½•IPä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginIp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessageName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NotifyType.LOGIN_SUCCESS_TEMPLATE_MESSAGE.getType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;WxMaTemplateData&gt; <span class="title function_">getWxMaTemplateData</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;WxMaTemplateData&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword1&quot;</span>, loginUser + <span class="string">&quot;ï¼Œæ‚¨çš„è´¦å·åˆšåˆšåœ¨&quot;</span> + loginAddr + <span class="string">&quot;ç™»å½•ã€‚è¯·å…³æ³¨æœ¬æ¬¡ç™»å½•æ—¶é—´å’Œåœ°ç‚¹ï¼Œè‹¥æ˜¯æ‚¨æœ¬äººç™»å½•ï¼Œè¯·å¿½ç•¥æœ¬æé†’ï¼Œè‹¥éæœ¬äººç™»å½•ï¼Œè¯·ç‚¹å‡»ä¿®æ”¹å¯†ç ï¼Œå¹¶æ£€æŸ¥è´¦å·æœ€è¿‘ç™»å½•å’Œæ“ä½œè¡Œä¸ºæ˜¯å¦æœ‰é—®é¢˜ã€‚&quot;</span>, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword2&quot;</span>, <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword3&quot;</span>, loginIp, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šNotifyType è¡¨ç¤ºæ¶ˆæ¯çš„ç±»å‹ï¼Œä½ å¯ä»¥è‡ªå·±å®šä¹‰å¸¸é‡æ¥ä»£æ›¿è¿™æ®µä»£ç </p>
<h6 id="è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªæŠ½è±¡çš„æ¶ˆæ¯æ¨¡æ¿æ¥å£å¹¶åˆ›å»ºäº†ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯ç±»å‹å®ç°äº†å¯¹åº”çš„æ–¹æ³•"><a class="markdownIt-Anchor" href="#è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªæŠ½è±¡çš„æ¶ˆæ¯æ¨¡æ¿æ¥å£å¹¶åˆ›å»ºäº†ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯ç±»å‹å®ç°äº†å¯¹åº”çš„æ–¹æ³•">#</a> è¿™ä¸¤æ®µä»£ç å®ç°äº†ä¸€ä¸ªæŠ½è±¡çš„æ¶ˆæ¯æ¨¡æ¿æ¥å£ï¼Œå¹¶åˆ›å»ºäº†ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯ç±»å‹ï¼Œå®ç°äº†å¯¹åº”çš„æ–¹æ³•</h6>
<h2 id="å››-æ•°æ®æ”¯æ’‘ä»¥åŠæ•°æ®é…ç½®"><a class="markdownIt-Anchor" href="#å››-æ•°æ®æ”¯æ’‘ä»¥åŠæ•°æ®é…ç½®">#</a> å››ã€æ•°æ®æ”¯æ’‘ä»¥åŠæ•°æ®é…ç½®</h2>
<h5 id="æ•°æ®æ”¯æ’‘"><a class="markdownIt-Anchor" href="#æ•°æ®æ”¯æ’‘">#</a> æ•°æ®æ”¯æ’‘ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 19:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageSupport</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageSupport</span> <span class="keyword">extends</span> <span class="title class_">WechatMessageConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(WechatMessageSupport.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Information service interface</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> NotifyService notifyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å…¥æ¶ˆæ¯æœåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyService</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNotifyService</span><span class="params">(NotifyService notifyService)</span> &#123;</span><br><span class="line">        WechatMessageSupport.notifyService = notifyService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å…¥æ¶ˆæ¯ä½“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iMessage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IMessage <span class="title function_">injectMessage</span><span class="params">(HashMap&lt;String, Object&gt; paramMap, IMessage iMessage)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–classæ¨¡æ¿</span></span><br><span class="line">        Class&lt;?&gt; clazz = iMessage.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç¼“å­˜setteræ–¹æ³•</span></span><br><span class="line">        Map&lt;String, Method&gt; setterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">for</span> (Method method : clazz.getMethods()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.getName().startsWith(Consts.SET)) setterMap.put(method.getName(), method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å…¥å‚æ•°åˆ°å­—æ®µä¸­</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : paramMap.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">paramName</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">paramValue</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="type">String</span> <span class="variable">setterName</span> <span class="operator">=</span> generateSetterName(paramName);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> setterMap.get(setterName);</span><br><span class="line">            <span class="keyword">if</span> (method != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// æ£€æŸ¥å‚æ•°ç±»å‹æ˜¯å¦åŒ¹é…</span></span><br><span class="line">                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">                <span class="keyword">if</span> (parameterTypes.length != <span class="number">1</span> || !parameterTypes[<span class="number">0</span>].isInstance(paramValue)) &#123;</span><br><span class="line">                    logger.warn(<span class="string">&quot;æ— æ³•ä¸ºæ¶ˆæ¯å¯¹è±¡è®¾ç½®å‚æ•° &#123;&#125; = &#123;&#125;, å‚æ•°ç±»å‹ä¸åŒ¹é…&quot;</span>, paramName, paramValue);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ£€æŸ¥æ–¹æ³•æ˜¯å¦å¯è®¿é—®</span></span><br><span class="line">                <span class="keyword">if</span> (!method.isAccessible()) &#123;</span><br><span class="line">                    method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    method.invoke(iMessage, paramValue);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;æ— æ³•ä¸ºæ¶ˆæ¯å¯¹è±¡è®¾ç½®å‚æ•° &#123;&#125; = &#123;&#125;&quot;</span>, paramName, paramValue, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;æ— æ³•ä¸ºæ¶ˆæ¯å¯¹è±¡è®¾ç½®å‚æ•° &#123;&#125; = &#123;&#125;&quot;</span>, paramName, paramValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> iMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆsetteræ–¹æ³•åç§°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> propertyName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">generateSetterName</span><span class="params">(String propertyName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(propertyName).filter(name -&gt; !name.isEmpty()).map(name -&gt; <span class="string">&quot;set&quot;</span> + Character.toUpperCase(name.charAt(<span class="number">0</span>)) + name.substring(<span class="number">1</span>)).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ•°æ®é…ç½®"><a class="markdownIt-Anchor" href="#æ•°æ®é…ç½®">#</a> æ•°æ®é…ç½®ï¼š</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆæ¯ç­–ç•¥ç»„æ˜ å°„è¡¨</span></span><br><span class="line"><span class="comment">     * ç–‘ï¼šä¸ºä»€ä¹ˆåˆå§‹å€¼ä¼šè®¾ç½®æˆ8ï¼Ÿè€Œä¸æ˜¯6å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="comment">     * ç­”ï¼šå› ä¸º HashMap çš„å®ç°å¯èƒ½ä¼šè‡ªåŠ¨å°† initcp è°ƒæ•´ä¸ºæ¥è¿‘ 2 çš„å¹‚æ¬¡æ–¹çš„å€¼ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†å“ˆå¸Œå†²çª</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, IMessage&gt; messageStrategyGroup = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–æ¶ˆæ¯ç»„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initService</span><span class="params">(IMessage[] properties)</span> &#123;</span><br><span class="line">        Arrays.stream(properties).forEach(</span><br><span class="line">                property -&gt; messageStrategyGroup.put(property.getMessageName(), property)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤æ®µä»£ç æˆ‘ä»¬å®ç°äº†æ•°æ®çš„åŸºç¡€æ”¯æ’‘ï¼Œä»¥åŠç±»å‹æ¨¡å¼é…ç½®ã€‚</p>
<h2 id="äº”-æ³¨å…¥æŠ½è±¡æ¶ˆæ¯åˆ°æ¨¡æ¿å¹¶ä¸”å®ç°å‘é€æµç¨‹"><a class="markdownIt-Anchor" href="#äº”-æ³¨å…¥æŠ½è±¡æ¶ˆæ¯åˆ°æ¨¡æ¿å¹¶ä¸”å®ç°å‘é€æµç¨‹">#</a> äº”ã€æ³¨å…¥æŠ½è±¡æ¶ˆæ¯åˆ°æ¨¡æ¿ï¼Œå¹¶ä¸”å®ç°å‘é€æµç¨‹</h2>
<h5 id="æŠ½è±¡æ¶ˆæ¯æ¥å£å®šä¹‰å‘é€æ¨¡æ¿æ¶ˆæ¯çš„æ¥å£"><a class="markdownIt-Anchor" href="#æŠ½è±¡æ¶ˆæ¯æ¥å£å®šä¹‰å‘é€æ¨¡æ¿æ¶ˆæ¯çš„æ¥å£">#</a> æŠ½è±¡æ¶ˆæ¯æ¥å£ï¼šå®šä¹‰å‘é€æ¨¡æ¿æ¶ˆæ¯çš„æ¥å£</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 20:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: IWechatMessageExec</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IWechatMessageExec</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String unionId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æŠ½è±¡æ¶ˆæ¯å®ç°åœ¨æŠ½è±¡æ¶ˆæ¯å±‚é¢å»åˆ¤æ–­æ¶ˆæ¯ä½“çš„å‚æ•°åˆæ³•æ€§å¹¶ä¸”å°†unionidè½¬æ¢ä¸ºfromopenid"><a class="markdownIt-Anchor" href="#æŠ½è±¡æ¶ˆæ¯å®ç°åœ¨æŠ½è±¡æ¶ˆæ¯å±‚é¢å»åˆ¤æ–­æ¶ˆæ¯ä½“çš„å‚æ•°åˆæ³•æ€§å¹¶ä¸”å°†unionidè½¬æ¢ä¸ºfromopenid">#</a> æŠ½è±¡æ¶ˆæ¯å®ç°ï¼šåœ¨æŠ½è±¡æ¶ˆæ¯å±‚é¢å»åˆ¤æ–­æ¶ˆæ¯ä½“çš„å‚æ•°åˆæ³•æ€§ï¼Œå¹¶ä¸”å°† unionId è½¬æ¢ä¸º fromOpenId</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: AbstractWechatMessage</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractWechatMessageBase</span> <span class="keyword">extends</span> <span class="title class_">WechatMessageSupport</span> <span class="keyword">implements</span> <span class="title class_">IWechatMessageExec</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AbstractWechatMessageBase.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æŠ½è±¡æ¶ˆæ¯ï¼Œå‡†å¤‡æ¶ˆæ¯ä½“ï¼Œè½¬æ¢FromOpenID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String unionId)</span> &#123;</span><br><span class="line">        ValidatorUtils.validateEntity(message);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (AssertUtil.isEmpty(unionId)) &#123;</span><br><span class="line">            logger.error(DEFALUT_FAIL, ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿™æ®µä»£ç åŸæœ¬åœ¨WechatMessageSupportå±‚å®ç°ï¼Œè¢«æˆ‘å‰”é™¤æ‰äº†ï¼Œè¿™ä¸ªéœ€è¦å¤§å®¶å»è‡ªå·±å®ç°æ”¶é›†å…¬ä¼—å·å…³æ³¨äººçš„fromOpenIdï¼Œä¸æ˜¯å¾®ä¿¡çš„openIdï¼Œæ˜¯å…³æ³¨äº†å…¬ä¼—å·åï¼Œäº§ç”Ÿçš„openIdã€‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fromOpenId</span> <span class="operator">=</span> wxservFollowService.getFromOpenIdByUnionId(unionId);</span><br><span class="line">        <span class="keyword">if</span> (AssertUtil.isEmpty(fromOpenId)) &#123;</span><br><span class="line">            logger.error(DEFALUT_FAIL, ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ€»ä¹‹fromOpenIdå°±æ˜¯å…³æ³¨äº†å…¬ä¼—å·åäº§ç”Ÿçš„å”¯ä¸€ID</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sendMessage(message, fromOpenId, message.getMessageName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æŠ½è±¡æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> messageType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String openId, String messageType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="å…·ä½“æ¶ˆæ¯å®ç°åœ¨æŠ½è±¡å±‚ç¡®ä¿æ¶ˆæ¯ä½“å®Œæ•´æ€§åè°ƒç”¨æŠ½è±¡å±‚é¢çš„å…·ä½“å®ç°ç±»è°ƒç”¨æ•°æ®æ”¯æ’‘å±‚çš„notifyserviceæœåŠ¡å®Œæˆå‘é€æ¨¡æ¿æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#å…·ä½“æ¶ˆæ¯å®ç°åœ¨æŠ½è±¡å±‚ç¡®ä¿æ¶ˆæ¯ä½“å®Œæ•´æ€§åè°ƒç”¨æŠ½è±¡å±‚é¢çš„å…·ä½“å®ç°ç±»è°ƒç”¨æ•°æ®æ”¯æ’‘å±‚çš„notifyserviceæœåŠ¡å®Œæˆå‘é€æ¨¡æ¿æ¶ˆæ¯">#</a> å…·ä½“æ¶ˆæ¯å®ç°ï¼šåœ¨æŠ½è±¡å±‚ç¡®ä¿æ¶ˆæ¯ä½“å®Œæ•´æ€§åï¼Œè°ƒç”¨æŠ½è±¡å±‚é¢çš„å…·ä½“å®ç°ç±»ï¼Œè°ƒç”¨æ•°æ®æ”¯æ’‘å±‚çš„ notifyService æœåŠ¡å®Œæˆå‘é€æ¨¡æ¿æ¶ˆæ¯</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: æ¨¡æ¿æ¶ˆæ¯æ¨é€å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;wechatMessageExecImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IWechatMessageExecImpl</span> <span class="keyword">extends</span> <span class="title class_">AbstractWechatMessageBase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(IWechatMessageExecImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String openId, String messageType)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;ã€å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€ã€‘ï¼šå¼€å§‹ --  messageTypeï¼š&#123;&#125;,openIdï¼š&#123;&#125;&quot;</span>, messageType, openId);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            notifyService.notifyWxTemplate(</span><br><span class="line">                    openId,</span><br><span class="line">                    NotifyType.of(messageType),</span><br><span class="line">                    message.getWxMaTemplateData()</span><br><span class="line">            );</span><br><span class="line">            logger.info(<span class="string">&quot;ã€å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€ã€‘ï¼šç»“æŸ -- messageTypeï¼š&#123;&#125;,openIdï¼š&#123;&#125;&quot;</span>, messageType, openId);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            logger.error(<span class="string">&quot;ã€å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æ¨é€ã€‘ï¼šå¼‚å¸¸ -- &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(e.getMessage());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseUtil.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="springbooté…ç½®æ–‡ä»¶-æ¶ˆæ¯ç±»å‹-notifyserviceå®ç°"><a class="markdownIt-Anchor" href="#springbooté…ç½®æ–‡ä»¶-æ¶ˆæ¯ç±»å‹-notifyserviceå®ç°">#</a> SpringBoot é…ç½®æ–‡ä»¶ã€æ¶ˆæ¯ç±»å‹ã€NotifyService å®ç°ï¼š</h4>
<h5 id="pomæ–‡ä»¶é…ç½®ä¾èµ–è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤§ç¥binarywangçš„miniappåº“æ¥å®ç°å¾®ä¿¡æ”¯æŒ"><a class="markdownIt-Anchor" href="#pomæ–‡ä»¶é…ç½®ä¾èµ–è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤§ç¥binarywangçš„miniappåº“æ¥å®ç°å¾®ä¿¡æ”¯æŒ">#</a> pom æ–‡ä»¶é…ç½®ä¾èµ–ï¼šè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å¤§ç¥ binarywang çš„ miniapp åº“æ¥å®ç°å¾®ä¿¡æ”¯æŒ</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;weixin-java-miniapp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;weixin-java-pay&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h5 id="yamlé…ç½®å®ç°è‡ªå®šä¹‰é…ç½®ç±»é…ç½®æ¨¡æ¿é›†åˆä»¥åŠæ˜¯å¦å¼€å¯"><a class="markdownIt-Anchor" href="#yamlé…ç½®å®ç°è‡ªå®šä¹‰é…ç½®ç±»é…ç½®æ¨¡æ¿é›†åˆä»¥åŠæ˜¯å¦å¼€å¯">#</a> yaml é…ç½®ï¼šå®ç°è‡ªå®šä¹‰é…ç½®ç±»ï¼Œé…ç½®æ¨¡æ¿é›†åˆï¼Œä»¥åŠæ˜¯å¦å¼€å¯</h5>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">system:</span></span><br><span class="line">  <span class="attr">notify:</span></span><br><span class="line">    <span class="attr">wx:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#å¯åŠ¨æ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loginSuccessTemplateMessage</span> <span class="comment">#ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line">          <span class="attr">templateId:</span> <span class="string">qDHo-UXXXXXXXXXXXXXXXXXXXXX</span> <span class="comment">#å…¬ä¼—å¹³å°æ¨¡æ¿ID</span></span><br></pre></td></tr></table></figure>
<h5 id="é…ç½®ä¿¡æ¯ç±»ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å­é…ç½®"><a class="markdownIt-Anchor" href="#é…ç½®ä¿¡æ¯ç±»ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å­é…ç½®">#</a> é…ç½®ä¿¡æ¯ç±»ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å­é…ç½®</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: NotifyProperties</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;system.notify&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Wx wx;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Data</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Wx</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">boolean</span> enable;</span><br><span class="line">		<span class="keyword">private</span> List&lt;Map&lt;String, String&gt;&gt; template = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="è‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨enableconfigurationpropertiesæ³¨è§£æ³¨å…¥notifypropertiesé…ç½®å¹¶å®ç°notifyserviceé…ç½®æ³¨å…¥"><a class="markdownIt-Anchor" href="#è‡ªåŠ¨é…ç½®ç±»ä½¿ç”¨enableconfigurationpropertiesæ³¨è§£æ³¨å…¥notifypropertiesé…ç½®å¹¶å®ç°notifyserviceé…ç½®æ³¨å…¥">#</a> è‡ªåŠ¨é…ç½®ç±»ï¼šä½¿ç”¨ EnableConfigurationProperties æ³¨è§£æ³¨å…¥ NotifyProperties é…ç½®å¹¶å®ç° notifyService é…ç½®æ³¨å…¥</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:  æŒ‚è½½NotifyPropertiesç±»ï¼Œè·å–é…ç½®ä¿¡æ¯å¹¶è‡ªåŠ¨åŠ è½½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(NotifyProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotifyProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotifyAutoConfiguration</span><span class="params">(NotifyProperties properties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;NotifyService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> NotifyService <span class="title function_">notifyService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NotifyService</span> <span class="variable">notifyService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotifyService</span>();</span><br><span class="line"></span><br><span class="line">        NotifyProperties.<span class="type">Wx</span> <span class="variable">wxConfig</span> <span class="operator">=</span> properties.getWx();</span><br><span class="line">        <span class="keyword">if</span> (wxConfig.isEnable()) &#123;</span><br><span class="line">            notifyService.setWxTemplateSender(wxTemplateSender());</span><br><span class="line">            NotifyService.wxTemplate = wxConfig.getTemplate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> notifyService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WxTemplateSender <span class="title function_">wxTemplateSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WxTemplateSender</span> <span class="variable">wxTemplateSender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxTemplateSender</span>();</span><br><span class="line">        <span class="keyword">return</span> wxTemplateSender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ¶ˆæ¯ç±»å‹é…ç½®æ¨¡æ¿æ¶ˆæ¯ç±»å‹"><a class="markdownIt-Anchor" href="#æ¶ˆæ¯ç±»å‹é…ç½®æ¨¡æ¿æ¶ˆæ¯ç±»å‹">#</a> æ¶ˆæ¯ç±»å‹ï¼šé…ç½®æ¨¡æ¿æ¶ˆæ¯ç±»å‹</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-05-25 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: NotifyType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">NotifyType</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç™»å½•æˆåŠŸæ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line">    LOGIN_SUCCESS_TEMPLATE_MESSAGE(<span class="string">&quot;loginSuccessTemplateMessage&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EnumMap&lt;NotifyType, String&gt; typeMap = <span class="keyword">new</span> <span class="title class_">EnumMap</span>&lt;&gt;(NotifyType.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (NotifyType notifyType : NotifyType.values()) &#123;</span><br><span class="line">            typeMap.put(notifyType, notifyType.type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    NotifyType(String type) &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NotifyType <span class="title function_">of</span><span class="params">(String messageType)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (NotifyType notifyType : typeMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typeMap.get(notifyType).equals(messageType)) &#123;</span><br><span class="line">                <span class="keyword">return</span> notifyType;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No such enum object for the given messageType&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="notifyserviceæœåŠ¡å®ç°å®ç°å‘é€æ¶ˆæ¯çš„æœåŠ¡ç±»"><a class="markdownIt-Anchor" href="#notifyserviceæœåŠ¡å®ç°å®ç°å‘é€æ¶ˆæ¯çš„æœåŠ¡ç±»">#</a> NotifyService æœåŠ¡å®ç°ï¼šå®ç°å‘é€æ¶ˆæ¯çš„æœåŠ¡ç±»</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æœåŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MailSender mailSender;</span><br><span class="line">    <span class="keyword">private</span> String sendFrom;</span><br><span class="line">    <span class="keyword">private</span> String sendTo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WxTemplateSender wxTemplateSender;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String, String&gt;&gt; wxTemplate = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWxEnable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wxTemplateSender != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡æ¨¡ç‰ˆæ¶ˆæ¯é€šçŸ¥,ä¸è·³è½¬</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * è¯¥æ–¹æ³•ä¼šå°è¯•ä»æ•°æ®åº“è·å–ç¼“å­˜çš„FormIdå»å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser     æ¥æ”¶è€…openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType é€šçŸ¥ç±»åˆ«ï¼Œé€šè¿‡è¯¥æšä¸¾å€¼åœ¨é…ç½®æ–‡ä»¶ä¸­è·å–ç›¸åº”çš„æ¨¡ç‰ˆID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params     é€šçŸ¥æ¨¡ç‰ˆå†…å®¹é‡Œçš„å‚æ•°ï¼Œç±»ä¼¼&quot;æ‚¨çš„éªŒè¯ç ä¸º&#123;1&#125;&quot;ä¸­&#123;1&#125;çš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyWxTemplate</span><span class="params">(String touser, NotifyType notifyType, List&lt;WxMaTemplateData&gt; params)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (wxTemplateSender == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateId</span> <span class="operator">=</span> getTemplateId(notifyType, wxTemplate);</span><br><span class="line">        wxTemplateSender.sendWechatMsg(touser, templateId, params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡æ¨¡ç‰ˆæ¶ˆæ¯é€šçŸ¥ï¼Œå¸¦è·³è½¬</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * è¯¥æ–¹æ³•ä¼šå°è¯•ä»æ•°æ®åº“è·å–ç¼“å­˜çš„FormIdå»å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser     æ¥æ”¶è€…openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType é€šçŸ¥ç±»åˆ«ï¼Œé€šè¿‡è¯¥æšä¸¾å€¼åœ¨é…ç½®æ–‡ä»¶ä¸­è·å–ç›¸åº”çš„æ¨¡ç‰ˆID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params     é€šçŸ¥æ¨¡ç‰ˆå†…å®¹é‡Œçš„å‚æ•°ï¼Œç±»ä¼¼&quot;æ‚¨çš„éªŒè¯ç ä¸º&#123;1&#125;&quot;ä¸­&#123;1&#125;çš„å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page       ç‚¹å‡»æ¶ˆæ¯è·³è½¬çš„é¡µé¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyWxTemplate</span><span class="params">(String touser, NotifyType notifyType, List&lt;WxMaTemplateData&gt; params, String page)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (wxTemplateSender == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateId</span> <span class="operator">=</span> getTemplateId(notifyType, wxTemplate);</span><br><span class="line">        wxTemplateSender.sendWechatMsg(touser, templateId, params, page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTemplateId</span><span class="params">(NotifyType notifyType, List&lt;Map&lt;String, String&gt;&gt; values)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, String&gt; item : values) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">notifyTypeStr</span> <span class="operator">=</span> notifyType.getType();</span><br><span class="line">            <span class="keyword">if</span> (item.get(<span class="string">&quot;name&quot;</span>).equals(notifyTypeStr))</span><br><span class="line">                <span class="keyword">return</span> item.get(<span class="string">&quot;templateId&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="wxtemplatesenderå‘é€è€…å®ç°å®ç°å‘é€æ¶ˆæ¯çš„åŸºç¡€ç±»ä½¿ç”¨wxmaserviceåº“å‘é€æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#wxtemplatesenderå‘é€è€…å®ç°å®ç°å‘é€æ¶ˆæ¯çš„åŸºç¡€ç±»ä½¿ç”¨wxmaserviceåº“å‘é€æ¶ˆæ¯">#</a> WxTemplateSender å‘é€è€…å®ç°ï¼šå®ç°å‘é€æ¶ˆæ¯çš„åŸºç¡€ç±»ï¼Œä½¿ç”¨ WxMaService åº“å‘é€æ¶ˆæ¯</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¾®ä¿¡æ¨¡ç‰ˆæ¶ˆæ¯é€šçŸ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxTemplateSender</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(WxTemplateSender.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxMaService wxMaService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€å¾®ä¿¡æ¶ˆæ¯(æ¨¡æ¿æ¶ˆæ¯),ä¸å¸¦è·³è½¬</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            ç”¨æˆ· OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            æ¨¡æ¿æ¶ˆæ¯ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            è¯¦ç»†å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, String[] parms)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€å¾®ä¿¡æ¶ˆæ¯(æ¨¡æ¿æ¶ˆæ¯),ä¸å¸¦è·³è½¬</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            ç”¨æˆ· OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            æ¨¡æ¿æ¶ˆæ¯ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            è¯¦ç»†å†…å®¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€å¾®ä¿¡æ¶ˆæ¯(æ¨¡æ¿æ¶ˆæ¯),å¸¦è·³è½¬</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            ç”¨æˆ· OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            æ¨¡æ¿æ¶ˆæ¯ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            è¯¦ç»†å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     *            è·³è½¬é¡µé¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms, String page)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, page, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‘é€æ¶ˆæ¯åŸºç±»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emphasisKeyword</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String touser, String templatId, String[] parms, String page, String color,</span></span><br><span class="line"><span class="params">                         String emphasisKeyword)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (touser == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">WxMaTemplateMessage</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMaTemplateMessage</span>();</span><br><span class="line">        msg.setTemplateId(templatId);</span><br><span class="line">        msg.setToUser(touser);</span><br><span class="line">        msg.setFormId(touser);</span><br><span class="line">        msg.setPage(page);</span><br><span class="line">        msg.setColor(color);</span><br><span class="line">        msg.setEmphasisKeyword(emphasisKeyword);</span><br><span class="line">        msg.setData(createMsgData(parms));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxMaService.getMsgService().sendTemplateMsg(msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">JsonParser</span> <span class="variable">JSON_PARSER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonParser</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEND_MSG_API</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/message/template/send&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms, String page, String color,</span></span><br><span class="line"><span class="params">                         String emphasisKeyword)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (touser == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">WxMaTemplateMessage</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMaTemplateMessage</span>();</span><br><span class="line">        msg.setTemplateId(templatId);</span><br><span class="line">        msg.setToUser(touser);</span><br><span class="line">        msg.setFormId(touser);</span><br><span class="line">        msg.setPage(page);</span><br><span class="line">        msg.setColor(color);</span><br><span class="line">        msg.setEmphasisKeyword(emphasisKeyword);</span><br><span class="line">        msg.setData(parms);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">responseContent</span> <span class="operator">=</span> <span class="built_in">this</span>.wxMaService.post(SEND_MSG_API, msg.toJson());</span><br><span class="line">            <span class="type">JsonObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON_PARSER.parse(responseContent).getAsJsonObject();</span><br><span class="line">            <span class="keyword">if</span> (jsonObject.get(WxMaConstants.ERRCODE).getAsInt() != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WxErrorException</span>(WxError.fromJson(responseContent));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;ã€å¾®ä¿¡æ¶ˆæ¯æ¨¡æ¿ã€‘ï¼šæœåŠ¡ç«¯å¼‚å¸¸ï¼ŒåŸå› å¯èƒ½æ˜¯ï¼š&#123;&#125;&quot;</span>, e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;WxMaTemplateData&gt; <span class="title function_">createMsgData</span><span class="params">(String[] parms)</span> &#123;</span><br><span class="line">        List&lt;WxMaTemplateData&gt; dataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;WxMaTemplateData&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= parms.length; i++) &#123;</span><br><span class="line">            dataList.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword&quot;</span> + i, parms[i - <span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="åœ¨é…ç½®å®Œå¦‚ä¸Šä»£ç åæˆ‘ä»¬çš„ä»£ç å°±å®Œæˆäº†æ¥ä¸‹æ¥å³å¯é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ¨¡æ¿æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#åœ¨é…ç½®å®Œå¦‚ä¸Šä»£ç åæˆ‘ä»¬çš„ä»£ç å°±å®Œæˆäº†æ¥ä¸‹æ¥å³å¯é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ¨¡æ¿æ¶ˆæ¯">#</a> åœ¨é…ç½®å®Œå¦‚ä¸Šä»£ç åï¼Œæˆ‘ä»¬çš„ä»£ç å°±å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å³å¯é€šè¿‡å•å…ƒæµ‹è¯•æ¥æµ‹è¯•æ¨¡æ¿æ¶ˆæ¯ï¼</h6>
<h2 id="å…­-ä½¿ç”¨æŠ½è±¡æ¨¡æ¿å‘é€æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#å…­-ä½¿ç”¨æŠ½è±¡æ¨¡æ¿å‘é€æ¶ˆæ¯">#</a> å…­ã€ä½¿ç”¨æŠ½è±¡æ¨¡æ¿å‘é€æ¶ˆæ¯</h2>
<p>å•å…ƒæµ‹è¯•å‘é€æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 08:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: å…¬ä¼—å·ï¼šInterviewCoder | åšå®¢ï¼šhttps://brath.top - ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œã€‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å•æµ‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRunnerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SpringRunnerTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IWechatMessageExec messageExec;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//äº§å“ææµ‹æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">ProductTestTemplateImpl</span> <span class="variable">productTestTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductTestTemplateImpl</span>()</span><br><span class="line">                .setCompanyName(<span class="string">&quot;æµ‹è¯•å…¬å¸&quot;</span>)</span><br><span class="line">                .setUserName(<span class="string">&quot;Brath&quot;</span>)</span><br><span class="line">                .setVersion(<span class="string">&quot;2.0.6&quot;</span>);</span><br><span class="line">        <span class="comment">//æ³¨å†ŒæˆåŠŸæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">RegistTemplateImpl</span> <span class="variable">registTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistTemplateImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç™»å½•æˆåŠŸæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">LoginSuccessTemplateImpl</span> <span class="variable">loginSuccessTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginSuccessTemplateImpl</span>()</span><br><span class="line">                .setLoginUser(<span class="string">&quot;Brath&quot;</span>)</span><br><span class="line">                .setLoginAddr(<span class="string">&quot;JVM&quot;</span>)</span><br><span class="line">                .setLoginIp(<span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line">        messageExec.sendMessage(loginSuccessTemplate, <span class="string">&quot;o-KKr6Qwsxxxxxxxxxxxxxxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æµ‹è¯•æˆåŠŸ~"><a class="markdownIt-Anchor" href="#æµ‹è¯•æˆåŠŸ~">#</a> æµ‹è¯•æˆåŠŸï½</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606143429408.png" alt="image-20230606143429408"></p>
<h6 id="tipså¦‚æœä½ è§‰å¾—brathåˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯è¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äºº~"><a class="markdownIt-Anchor" href="#tipså¦‚æœä½ è§‰å¾—brathåˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯è¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äºº~">#</a> tipsï¼šå¦‚æœä½ è§‰å¾— Brath åˆ†äº«çš„ä»£ç è¿˜å¯ä»¥çš„è¯ï¼Œè¯·å°†æˆ‘åˆ†äº«ç»™æ›´å¤šéœ€è¦å¸®åŠ©çš„äººï½</h6>
<h6 id="åˆ°æ­¤ä¸ºæ­¢å…¬ä¼—å·å‘é€æ¨¡æ¿æ¶ˆæ¯çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦è¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨interviewcoderåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ä¸ºäº†æ›´å¥½çš„ä½ ä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><a class="markdownIt-Anchor" href="#åˆ°æ­¤ä¸ºæ­¢å…¬ä¼—å·å‘é€æ¨¡æ¿æ¶ˆæ¯çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦è¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨interviewcoderåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ä¸ºäº†æ›´å¥½çš„ä½ ä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ">#</a> åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¬ä¼—å·å‘é€æ¨¡æ¿æ¶ˆæ¯çš„çŸ¥è¯†åˆ†äº«å°±ç»“æŸå•¦ï¼Œè¿˜è¯·åŒå­¦ä»¬å¤šå¤šå…³æ³¨ InterviewCoderï¼Œåšä¸€ä¸ªæ¿€è¿›çš„å¼€å‘è€…ï¼Œä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œï¼</h6>
<h1 id="å®Œç»“æ’’èŠ±"><a class="markdownIt-Anchor" href="#å®Œç»“æ’’èŠ±">#</a> å®Œç»“æ’’èŠ±â€</h1>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-06T00:10:41.000Z" title="2023-6-6 8:10:41">2023-06-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-06T05:13:21.519Z" title="2023-6-6 13:13:21">2023-06-06</time>æ›´æ–°</span><span class="level-item">13 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1887ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#å…¬ä¼—å·å¼€å‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯">#</a> ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ - å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯</h1>
<h5 id="æ‰“ä¸€æ³¢å¹¿å‘Š"><a class="markdownIt-Anchor" href="#æ‰“ä¸€æ³¢å¹¿å‘Š">#</a> æ‰“ä¸€æ³¢å¹¿å‘Šâ€¦</h5>
<h1 id="é¢è¯•è®°app"><a class="markdownIt-Anchor" href="#é¢è¯•è®°app">#</a> é¢è¯•è®° APP</h1>
<p>Githubï¼š<a target="_blank" rel="noopener" href="https://github.com/Guoqing815/interview">https://github.com/Guoqing815/interview</a></p>
<p>å®‰å“ APP ä¸‹è½½ï¼š<a target="_blank" rel="noopener" href="https://www.pgyer.com/interview_app_release">https://www.pgyer.com/interview_app_release</a></p>
<p>Brath çš„ä¸ªäººåšå®¢ï¼š<a target="_blank" rel="noopener" href="https://brath.top">https://brath.top</a></p>
<p>é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·ï¼Œå®šæœŸåˆ†äº«æœ‰è¶£çš„ç¼–ç¨‹çŸ¥è¯†ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA">https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA</a></p>
<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€</h2>
<p>â€‹		å¤§å®¶å¥½å•Šï¼Œæˆ‘æ˜¯ Brathï¼Œä¸€åæ¿€è¿›çš„å…¨æ ˆå¼€å‘è€…ï¼Œä»è¿™æœŸä¸“æ å¼€å§‹ï¼Œæˆ‘ä¼šé€æ¸åˆ†äº«é¢è¯•è®°é¡¹ç›®ä¸­çš„éƒ¨åˆ†ä¼˜è´¨æºç ç»™åˆ°å¤§å®¶ã€‚è¿˜å¸Œæœ›å¤§å®¶å¤šå¤šå…³æ³¨ï¼</p>
<h5 id="ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æœ‰å‡ ä¸ªå‰æ"><a class="markdownIt-Anchor" href="#ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æœ‰å‡ ä¸ªå‰æ">#</a> ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯æœ‰å‡ ä¸ªå‰æï¼š</h5>
<h6 id="1éœ€è¦æ‹¥æœ‰ä¸€ä¸ªå·²ç»è®¤è¯è¿‡çš„å…¬ä¼—å·è®¤è¯è´¹ç”¨300å…ƒ"><a class="markdownIt-Anchor" href="#1éœ€è¦æ‹¥æœ‰ä¸€ä¸ªå·²ç»è®¤è¯è¿‡çš„å…¬ä¼—å·è®¤è¯è´¹ç”¨300å…ƒ">#</a> 1. éœ€è¦æ‹¥æœ‰ä¸€ä¸ªå·²ç»è®¤è¯è¿‡çš„å…¬ä¼—å·ï¼Œè®¤è¯è´¹ç”¨ 300 å…ƒã€‚</h6>
<h6 id="2è‡³å°‘æœ‰åŸºç¡€çš„javaå¼€å‘ç»éªŒ"><a class="markdownIt-Anchor" href="#2è‡³å°‘æœ‰åŸºç¡€çš„javaå¼€å‘ç»éªŒ">#</a> 2. è‡³å°‘æœ‰åŸºç¡€çš„ Java å¼€å‘ç»éªŒã€‚</h6>
<h6 id="3äº†è§£xmlå’Œjsonæ ¼å¼çš„æ•°æ®"><a class="markdownIt-Anchor" href="#3äº†è§£xmlå’Œjsonæ ¼å¼çš„æ•°æ®">#</a> 3. äº†è§£ XML å’Œ JSON æ ¼å¼çš„æ•°æ®</h6>
<h6 id="4å¾®ä¿¡å…¬ä¼—å¹³å°httpsmpweixinqqcom"><a class="markdownIt-Anchor" href="#4å¾®ä¿¡å…¬ä¼—å¹³å°httpsmpweixinqqcom">#</a> 4. å¾®ä¿¡å…¬ä¼—å¹³å°ï¼š<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">https://mp.weixin.qq.com/</a></h6>
<h2 id="ä¸€-å¼€é€šæ¨¡æ¿æ¶ˆæ¯"><a class="markdownIt-Anchor" href="#ä¸€-å¼€é€šæ¨¡æ¿æ¶ˆæ¯">#</a> ä¸€ã€å¼€é€šæ¨¡æ¿æ¶ˆæ¯</h2>
<p>â€‹	ç™»å½•å¾®ä¿¡å…¬ä¼—å· Web ç«¯ï¼Œå¼€é€šæ¨¡æ¿æ¶ˆæ¯åŠŸèƒ½ï¼Œé€‰æ‹©ä½¿ç”¨çš„æ¨¡æ¿æ¶ˆæ¯æˆ–è€…ç”³è¯·æ–°çš„æ¨¡æ¿æ¶ˆæ¯ï¼Œåªæœ‰é€šè¿‡ä¼ä¸šè®¤è¯æ‰èƒ½ä½¿ç”¨æ¨¡æ¿æ¶ˆæ¯</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606094513227.png" alt="image-20230606094513227"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606094408873.png" alt="image-20230606094408873"></p>
<h2 id="äºŒ-å¼€å¯æ¥å£æƒé™"><a class="markdownIt-Anchor" href="#äºŒ-å¼€å¯æ¥å£æƒé™">#</a> äºŒã€å¼€å¯æ¥å£æƒé™</h2>
<p>æ¥å£æƒé™ =&gt; ç½‘é¡µæœåŠ¡ =&gt; ç½‘é¡µæˆæƒ =&gt; ç”³è¯· / ä¿®æ”¹</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606094447163.png" alt="image-20230606094447163"></p>
<h2 id="ä¸‰-é…ç½®åŸŸå"><a class="markdownIt-Anchor" href="#ä¸‰-é…ç½®åŸŸå">#</a> ä¸‰ã€é…ç½®åŸŸå</h2>
<p>â€‹		ä¸‰é¡¹éƒ½è¦é…ç½®ã€‚æ³¨æ„å‰é¢ä¸è¦åŠ  http æˆ– httpsï¼Œåé¢ä¸å¯å¸¦ç«¯å£å·ã€‚è¿˜éœ€è¦ä¸‹è½½ä¸€ä¸ªæ ¡éªŒæ–‡ä»¶ï¼ŒæŠŠä¸‹è½½ä¸‹æ¥çš„æ ¡éªŒæ–‡ä»¶æ”¾åˆ°æ‰€é…ç½®<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90&amp;spm=1001.2101.3001.7020">åŸŸåè§£æ</a>çš„æœåŠ¡å™¨ä¸Šï¼Œéœ€è¦åŸŸå + æ£€éªŒæ–‡ä»¶åå¯ä»¥è®¿é—®åˆ°è¿™ä¸ªæ–‡ä»¶æ‰ç®—æ ¡éªŒé€šè¿‡ï¼Œåé¢ä¸èƒ½æœ‰ç«¯å£ï¼ˆä¾‹å¦‚ï¼š<a target="_blank" rel="noopener" href="http://wx.qq.com/MP_verify_FF1peUkHP0MrdJqN.txt%EF%BC%9B%EF%BC%89%E3%80%82">wx.qq.com/MP_verify_FF1peUkHP0MrdJqN.txtï¼›ï¼‰ã€‚</a></p>
<p>psï¼šæ”¾æ ¡éªŒæ–‡ä»¶çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œhttp é»˜è®¤ç«¯å£æ˜¯ 80ï¼Œhttps é»˜è®¤ç«¯å£æ˜¯ 443</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606094747344.png" alt="image-20230606094747344"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606094814359.png" alt="image-20230606094814359"></p>
<h2 id="å››-é…ç½®ipç™½åå•"><a class="markdownIt-Anchor" href="#å››-é…ç½®ipç™½åå•">#</a> å››ã€é…ç½® IP ç™½åå•ã€‚</h2>
<p>â€‹		åç»­è·å–<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/wiki/?t=resource/res_main&amp;id=mp1421140183&amp;token=&amp;lang=zh_CN"> access_token</a> è®¿é—®æ¥å£æ—¶ï¼Œéœ€è¦è®¾ç½®è®¿é—®æ¥æº IP ä¸ºç™½åå•ï¼Œå¦‚ä¸é…ç½®å°±æ‹¿ä¸åˆ° tokenï¼Œæ¯å°æœºå™¨ä¸Šè¯·æ±‚è¿”å›çš„ ip éƒ½ä¼šä¸ä¸€æ ·ï¼ŒæŠŠå¼€å‘æœºå™¨å’ŒæœåŠ¡å™¨æ‹¿åˆ°çš„ ip éƒ½é…ç½®ä¸€æ ·å°±å¥½ï¼Œé…ç½®å¤šä¸ª ip æ—¶æ¯ä¸ª ip ç”¨å›è½¦éš”å¼€å°±è¡Œã€‚æ€ä¹ˆè·å–æ¥æº ipï¼šå¦‚æœæ²¡æœ‰é…ç½® ip ç™½åå•ï¼Œè¯·æ±‚è·å–<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=access_token&amp;spm=1001.2101.3001.7020"> access_token</a> æ—¶ä¼šè¿”å›ä¸€ä¸ª ipï¼ŒæŠŠè¿™ä¸ª ip é…ä¸Šå»å°±è¡Œäº†ã€‚å¦å¤–é¡ºä¾¿ä¿å­˜ä¸€ä¸‹ appId å’Œ AppSecretï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606105545467.png" alt="image-20230606105545467"></p>
<h2 id="äº”-å‘é€æ¨¡æ¿æ¶ˆæ¯æµç¨‹"><a class="markdownIt-Anchor" href="#äº”-å‘é€æ¨¡æ¿æ¶ˆæ¯æµç¨‹">#</a> äº”ã€å‘é€æ¨¡æ¿æ¶ˆæ¯æµç¨‹</h2>
<p><strong>1. è·å– code</strong>ï¼šéœ€è¦æ›´æ¢çš„å‚æ•°æ˜¯ appidã€redirect_uriï¼Œå…¶ä»–å‚æ•°ä¸å˜ï¼Œå…¶ä¸­ scope æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä»¥ snsapi_base ä¸º scope å‘èµ·çš„ç½‘é¡µæˆæƒï¼Œæ˜¯ç”¨æ¥è·å–è¿›å…¥é¡µé¢çš„ç”¨æˆ·çš„ openid çš„ï¼Œå¹¶ä¸”æ˜¯é™é»˜æˆæƒå¹¶è‡ªåŠ¨è·³è½¬åˆ°å›è°ƒé¡µçš„ã€‚ç”¨æˆ·æ„ŸçŸ¥çš„å°±æ˜¯ç›´æ¥è¿›å…¥äº†å›è°ƒé¡µï¼ˆå¾€å¾€æ˜¯ä¸šåŠ¡é¡µé¢ï¼‰ï¼›<br>
ä»¥ snsapi_userinfo ä¸º scope å‘èµ·çš„ç½‘é¡µæˆæƒï¼Œæ˜¯ç”¨æ¥è·å–ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯çš„ã€‚ä½†è¿™ç§æˆæƒéœ€è¦ç”¨æˆ·æ‰‹åŠ¨åŒæ„ï¼Œå¹¶ä¸”ç”±äºç”¨æˆ·åŒæ„è¿‡ï¼Œæ‰€ä»¥æ— é¡»å…³æ³¨ï¼Œå°±å¯åœ¨æˆæƒåè·å–è¯¥ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯ã€‚æˆ‘è¿™é‡Œç”¨çš„æ˜¯é™é»˜æˆæƒç„¶åè·³è½¬åˆ°ç›¸å…³é¡µé¢ã€‚å¦å¤–è¿˜è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªåœ°å€åªèƒ½åœ¨å¾®ä¿¡å®¢æˆ·ç«¯è¯·æ±‚æ‰æœ‰ç”¨ï¼Œå¯ä»¥ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·åˆ‡æ¢æˆå…¬ä¼—å·è°ƒè¯•æ¨¡å¼æµ‹è¯•ï¼Œè¯·æ±‚åä¼šè‡ªåŠ¨é‡å®šå‘ï¼Œåœ¨è·³è½¬çš„åœ°å€åé¢æ‹¼ä¸Šä¸€ä¸ª codeï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å‚æ•°ã€‚<br>
<a target="_blank" rel="noopener" href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=%E4%BD%A0%E7%9A%84appid&amp;redirect_uri=%E8%A6%81%E8%B7%B3%E8%BD%AC%E7%9A%84%E5%9C%B0%E5%9D%80/%E9%A1%B5%E9%9D%A2&amp;response_type=code&amp;scope=snsapi_base&amp;state=STATE#wechat_redirect">https://open.weixin.qq.com/connect/oauth2/authorize?appid = ä½ çš„ appid&amp;redirect_uri = è¦è·³è½¬çš„åœ°å€ / é¡µé¢ &amp; response_type=code&amp;scope=snsapi_base&amp;state=STATE#wechat_redirect</a></p>
<p><strong>2. é€šè¿‡ code æ¢å–ç½‘é¡µæˆæƒ access_tokenï¼Œæ‹¿åˆ° openId</strong></p>
<p>æ³¨æ„ä¸Šé¢æ‹¿åˆ°çš„ code åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”æœ‰æ•ˆæ—¶é•¿ä¸º 5 åˆ†é’Ÿï¼Œå¤±æ•ˆå¿…é¡»é‡æ–°è·å–</p>
<p><a target="_blank" rel="noopener" href="https://api.weixin.qq.com/sns/oauth2/access_token?appid=%E4%BD%A0%E7%9A%84appid&amp;secret=%E4%BD%A0%E7%9A%84secret&amp;code=%E4%B8%8A%E9%9D%A2%E5%9C%B0%E5%9D%80%E6%A0%8F%E6%8B%BF%E5%88%B0%E7%9A%84code&amp;grant_type=authorization_code">https://api.weixin.qq.com/sns/oauth2/access_token?appid = ä½ çš„ appid&amp;secret = ä½ çš„ secret&amp;code = ä¸Šé¢åœ°å€æ æ‹¿åˆ°çš„ code&amp;grant_type=authorization_code</a></p>
<p><strong>3. è·å– token (æ­¤ token ä¸ä¸Šé¢çš„ access_token ä¸ä¸€æ ·)ï¼Œæ­¤ token ç”¨äºå‘é€æ¨¡æ¿æ¶ˆæ¯ç”¨ä»¥åŠå…¶ä»– api æ¥å£çš„è°ƒç”¨</strong><br>
<a target="_blank" rel="noopener" href="https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=%E4%BD%A0%E7%9A%84appid&amp;secret=%E4%BD%A0%E7%9A%84secret"> https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid = ä½ çš„ appid&amp;secret = ä½ çš„ secret</a></p>
<p><strong>4. å‘é€æ¨¡æ¿æ¶ˆæ¯</strong><br>
<a target="_blank" rel="noopener" href="https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=%E4%B8%8A%E9%9D%A2%E8%8E%B7%E5%8F%96%E5%88%B0%E7%9A%84token"> https://api.weixin.qq.com/cgi-bin/message/template/send?access_token = ä¸Šé¢è·å–åˆ°çš„ token</a></p>
<h4 id="jsonç¤ºä¾‹"><a class="markdownIt-Anchor" href="#jsonç¤ºä¾‹">#</a> JSON ç¤ºä¾‹ï¼š</h4>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;touser&quot;</span><span class="punctuation">:</span><span class="string">&quot;OPENID&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;template_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://weixin.qq.com/download&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;miniprogram&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxxxxxxxxxxx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pagepath&quot;</span><span class="punctuation">:</span><span class="string">&quot;xxxxxx&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;client_msg_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;MSG_000001&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;keyword1&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#173177&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;keyword2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;#173177&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="å‚æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‚æ•°è¯´æ˜">#</a> å‚æ•°è¯´æ˜ï¼š</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606095123398.png" alt="image-20230606095123398"></p>
<h1 id=""><a class="markdownIt-Anchor" href="#">#</a> </h1>
<h1 id="ç®€å•çš„javaä»£ç "><a class="markdownIt-Anchor" href="#ç®€å•çš„javaä»£ç ">#</a> ç®€å•çš„ Java ä»£ç ï¼š</h1>
<p><strong>1. è·å–ç”¨æˆ· openidï¼Œå‚æ•°ä¸º code</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾®ä¿¡å…¬ä¼—å·è·å–è·å–ç”¨æˆ·openid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/getOpenId&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;å¾®ä¿¡å…¬ä¼—å·è·å–ç”¨æˆ·openid&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getOpenId</span><span class="params">(<span class="meta">@RequestParam</span> String code)</span>&#123;</span><br><span class="line">    String url= <span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token&quot;</span> + <span class="string">&quot;?appid=&quot;</span> + appId     + <span class="string">&quot;&amp;secret=&quot;</span> + appSecret + <span class="string">&quot;&amp;code=&quot;</span>+ code+<span class="string">&quot;&amp;grant_type=authorization_code&quot;</span>;</span><br><span class="line">    RestTemplate restTemplate=<span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    String response=restTemplate.getForObject(url,String.class);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(response);</span><br><span class="line">    <span class="type">String</span> <span class="variable">openid</span> <span class="operator">=</span> jsonObj.get(<span class="string">&quot;openid&quot;</span>).toString();</span><br><span class="line">    <span class="keyword">return</span> openid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2. è·å– token</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¾®ä¿¡å…¬ä¼—å·è·å–è·å–token</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getWeiXinToken</span><span class="params">()</span>&#123;</span><br><span class="line">    String url=<span class="string">&quot;https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=&quot;</span>+ appId + <span class="string">&quot;&amp;secret=&quot;</span> + appSecret;</span><br><span class="line">    <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">forObject</span> <span class="operator">=</span> restTemplate.getForObject(url, String.class);</span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">jsonObj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(forObject);</span><br><span class="line">    <span class="keyword">return</span> jsonObj.get(<span class="string">&quot;access_token&quot;</span>).toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3. å‡†å¤‡ä¸€ä¸ªæ¨¡æ¿æ¶ˆæ¯å®ä½“ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxTemplateMsg</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¥æ”¶è€…openId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String touser;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ¿ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String template_id;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ¿è·³è½¬é“¾æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * dataæ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> TreeMap&lt;String, TreeMap&lt;String, String&gt;&gt; data;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å‚æ•°</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color é¢œè‰² å¯ä¸å¡«</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> params</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TreeMap&lt;String, String&gt; <span class="title function_">item</span><span class="params">(String value, String color)</span> &#123;</span><br><span class="line">        TreeMap&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;String, String&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;value&quot;</span>, value);</span><br><span class="line">        params.put(<span class="string">&quot;color&quot;</span>, color);</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4. æ¨¡æ¿æ¶ˆæ¯å°è£…ï¼Œæ¶ˆæ¯å‚æ•°æ ¹æ®è‡ªå·±é€‰æ‹©çš„æ¨¡æ¿æ¶ˆæ¯æ¥</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¨¡æ¿æ¶ˆæ¯å°è£…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">noticeTemplate</span><span class="params">(String openIdd,String siteName,String airIndex,String value1,String value2,String airIndexTime)</span> &#123;</span><br><span class="line">        String templateId=<span class="string">&quot;ä½ çš„æ¨¡æ¿æ¶ˆæ¯id&quot;</span>;</span><br><span class="line">        TreeMap&lt;String, TreeMap&lt;String, String&gt;&gt; params = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;keyword1&quot;</span>, WxTemplateMsg.item(<span class="string">&quot;test1&quot;</span>, <span class="string">&quot;#000000&quot;</span>));</span><br><span class="line">        params.put(<span class="string">&quot;keyword2&quot;</span>, WxTemplateMsg.item(<span class="string">&quot;test2&quot;</span>, <span class="string">&quot;#000000&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">WxTemplateMsg</span> <span class="variable">wxTemplateMsg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxTemplateMsg</span>();</span><br><span class="line">        wxTemplateMsg.setTemplate_id(templateId);</span><br><span class="line">        wxTemplateMsg.setTouser(openIdd);</span><br><span class="line">        wxTemplateMsg.setData(params);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> JSONUtil.toJsonStr(wxTemplateMsg);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>5. å‘é€æ¨¡æ¿æ¶ˆæ¯</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å‘é€æ¨¡æ¿æ¶ˆæ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendTemplateMsg</span><span class="params">(String openId, String siteName, String airIndex, String value1, String value2, String airIndexTime)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">weiXinToken</span> <span class="operator">=</span> getWeiXinToken();</span><br><span class="line">    <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> noticeTemplate(openId, siteName, airIndex, value1, value2, airIndexTime);</span><br><span class="line">    okhttp3.<span class="type">RequestBody</span> <span class="variable">requestBody</span> <span class="operator">=</span> okhttp3.RequestBody.create(MediaType.parse(<span class="string">&quot;application/json&quot;</span>), data);</span><br><span class="line">    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(<span class="string">&quot;https://api.weixin.qq.com/cgi-bin/message/template/send?access_token=&quot;</span> + weiXinToken).post(requestBody).build();</span><br><span class="line">    <span class="type">OkHttpClient</span> <span class="variable">okHttpClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">    <span class="type">Response</span> <span class="variable">execute</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        execute = okHttpClient.newCall(request).execute();</span><br><span class="line">        <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> execute.body().string();</span><br><span class="line">        <span class="keyword">if</span> (execute.code() == <span class="number">200</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¨¡æ¿æ¶ˆæ¯å‘é€æˆåŠŸ==========&quot;</span> + body);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ¨¡æ¿æ¶ˆæ¯å‘é€å¤±è´¥==========&quot;</span> + body);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="å®Œç»“æ’’èŠ±"><a class="markdownIt-Anchor" href="#å®Œç»“æ’’èŠ±">#</a> å®Œç»“æ’’èŠ±â€</h1>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-05T17:10:41.000Z" title="2023-6-6 1:10:41">2023-06-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-06T05:13:39.917Z" title="2023-6-6 13:13:39">2023-06-06</time>æ›´æ–°</span><span class="level-item">11 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1578ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">ã€Sentinelã€‘Dockeræ­å»ºSentinel</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="sentineldockeræ­å»ºsentinel"><a class="markdownIt-Anchor" href="#sentineldockeræ­å»ºsentinel">#</a> ã€Sentinelã€‘Docker æ­å»º Sentinel</h1>
<h1 id="1-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1-æ¦‚è¿°">#</a> 1ã€æ¦‚è¿°</h1>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Sentinel&amp;spm=1001.2101.3001.7020">Sentinel</a> æä¾›ä¸€ä¸ªè½»é‡çº§çš„å¼€æºæ§åˆ¶å°ï¼Œå®ƒæä¾›æœºå™¨å‘ç°ä»¥åŠå¥åº·æƒ…å†µç®¡ç†ã€ç›‘æ§ï¼ˆå•æœºå’Œé›†ç¾¤ï¼‰ï¼Œè§„åˆ™ç®¡ç†å’Œæ¨é€çš„åŠŸèƒ½ã€‚</p>
<p>Sentinel æ§åˆ¶å°åŒ…å«å¦‚ä¸‹åŠŸèƒ½:</p>
<p><strong>æŸ¥çœ‹æœºå™¨åˆ—è¡¨ä»¥åŠå¥åº·æƒ…å†µï¼š</strong> æ”¶é›† Sentinel å®¢æˆ·ç«¯å‘é€çš„<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BF%83%E8%B7%B3%E5%8C%85&amp;spm=1001.2101.3001.7020">å¿ƒè·³åŒ…</a>ï¼Œç”¨äºåˆ¤æ–­æœºå™¨æ˜¯å¦åœ¨çº¿ã€‚<br>
<strong>ç›‘æ§ (å•æœºå’Œé›†ç¾¤èšåˆ)ï¼š</strong> é€šè¿‡ Sentinel å®¢æˆ·ç«¯æš´éœ²çš„ç›‘æ§ APIï¼Œå®šæœŸæ‹‰å–å¹¶ä¸”èšåˆåº”ç”¨ç›‘æ§ä¿¡æ¯ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ç§’çº§çš„å®æ—¶ç›‘æ§ã€‚<br>
<strong>è§„åˆ™ç®¡ç†å’Œæ¨é€ï¼š</strong> ç»Ÿä¸€ç®¡ç†æ¨é€è§„åˆ™ã€‚<br>
<strong>é‰´æƒï¼š</strong> ç”Ÿäº§ç¯å¢ƒä¸­<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%89%B4%E6%9D%83&amp;spm=1001.2101.3001.7020">é‰´æƒ</a>éå¸¸é‡è¦ã€‚è¿™é‡Œæ¯ä¸ªå¼€å‘è€…éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œå®šåˆ¶ã€‚</p>
<h1 id="2-åˆ¶ä½œé•œåƒ"><a class="markdownIt-Anchor" href="#2-åˆ¶ä½œé•œåƒ">#</a> 2ã€åˆ¶ä½œé•œåƒ</h1>
<p>sentinel-dashboard å°±æ˜¯ä¸€ä¸ª SpringBoot é¡¹ç›®ï¼Œç›´æ¥ä½¿ç”¨å‘½ä»¤å¯åŠ¨å³å¯ï¼Œæ‰€æœ‰è‡ªå®šä¹‰é…ç½® docker å¯åŠ¨ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šéœ€è¦å¯ä»¥ç›´æ¥ä¸‹è½½ jarï¼Œéœ€è¦ä¿®æ”¹æºç åˆ™ä¸‹è½½æºç åŒ…å³å¯ï¼Œä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases%EF%BC%8C%E4%B8%8B%E8%BD%BD%E7%9B%B8%E5%BA%94%E7%89%88%E6%9C%AC%E7%9A%84jar%E5%8C%85%EF%BC%8C%E6%AF%94%E5%A6%82sentinel-dashboard-1.8.1.jar">https://github.com/alibaba/Sentinel/releasesï¼Œä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„ jar åŒ…ï¼Œæ¯”å¦‚ sentinel-dashboard-1.8.1.jar</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131018352.png" alt="image-20230606131018352"></p>
<p><strong>1ã€åˆ›å»ºå·¥ä½œç›®å½•ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/soft/sentinel -p</span><br></pre></td></tr></table></figure>
<p><strong>2ã€æ‹·è´æ–‡ä»¶ï¼š</strong></p>
<p>å°†ä»å®˜ç½‘ä¸‹è½½çš„æˆ–è€…æ˜¯è‡ªå®šä¹‰ç¼–è¯‘å¥½çš„ <code>jar</code>  åŒ…ï¼Œæ‹·è´åˆ° <code>/home/soft/sentinel</code>  ç›®å½•ä¸‹</p>
<p><strong>3ã€Dockerfileï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/soft/sentinel/Dockerfile</span><br></pre></td></tr></table></figure>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#java ç‰ˆæœ¬</span><br><span class="line">FROM openkbs/jdk11-mvn-py3</span><br><span class="line">#rootç”¨æˆ·</span><br><span class="line">USER root</span><br><span class="line">#è®¾ç½®æ—¶åŒº</span><br><span class="line">ENV TZ=Asia/Shanghai</span><br><span class="line">RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &amp;&amp; echo $TZ &gt; /etc/timezone</span><br><span class="line">#è®¾ç½®å·¥ä½œç›®å½•é›†</span><br><span class="line">WORKDIR /root/sentinel</span><br><span class="line">#å¤åˆ¶jarså’Œå‘½ä»¤</span><br><span class="line">ADD *.jar /root/sentinel/</span><br><span class="line">EXPOSE 8858</span><br></pre></td></tr></table></figure>
<p><strong>4ã€åˆ¶ä½œé•œåƒï¼š</strong></p>
<p>ä¿è¯ <code>jar</code>  å’Œ <code>Dockerfile</code>  åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t sentinel-server .</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨å®¹å™¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dit -p 8858:8858 --privileged=true -P --name sentinel sentinel /bin/bash -c &#x27;tail -f /dev/null&#x27; -g &#x27;daemon off;&#x27;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥å®¹å™¨å¯åŠ¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Dserver.port=8858 -Dsentinel.dashboard.auth.username=sentinel -Dsentinel.dashboard.auth.password=sentinel -jar  sentinel-dashboard-1.8.0.jar</span><br></pre></td></tr></table></figure>
<p><strong>3ã€å¯åŠ¨æµ‹è¯•</strong></p>
<p><a target="_blank" rel="noopener" href="http://192.168.31.128:8858/">http://127.0.0.1:8858/</a> ï¼›é»˜è®¤è´¦æˆ·å¯†ç ï¼šsentinel/sentinel</p>
<p><strong>é‰´æƒï¼š</strong><br>
ä» Sentinel 1.6.0 èµ·ï¼ŒSentinel æ§åˆ¶å°å¼•å…¥åŸºæœ¬çš„ç™»å½•åŠŸèƒ½ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ sentinelã€‚è¯¥é‰´æƒèƒ½åŠ›éå¸¸åŸºç¡€ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å»ºè®®æ ¹æ®å®‰å…¨éœ€è¦è‡ªè¡Œæ”¹é€ ã€‚</p>
<p>å¯ä»¥åœ¨ Dockerfile æ–‡ä»¶ä¸­ï¼Œé€šè¿‡å¦‚ä¸‹ JVM å‚æ•°è¿›è¡Œé…ç½®ï¼š</p>
<p>-Dsentinel.dashboard.auth.username=sentinel ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•ç”¨æˆ·åä¸º sentinelï¼›<br>
â€“Dsentinel.dashboard.auth.password=123456 ç”¨äºæŒ‡å®šæ§åˆ¶å°çš„ç™»å½•å¯†ç ä¸º 123456ï¼›å¦‚æœçœ    ç•¥è¿™ä¸¤ä¸ªå‚æ•°ï¼Œé»˜è®¤ç”¨æˆ·å’Œå¯†ç å‡ä¸º sentinelï¼›<br>
-Dserver.servlet.session.timeout=7200 ç”¨äºæŒ‡å®š Spring Boot æœåŠ¡ç«¯ session çš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚    7200 è¡¨ç¤º 7200 ç§’ï¼›60m è¡¨ç¤º 60 åˆ†é’Ÿï¼Œé»˜è®¤ä¸º 30 åˆ†é’Ÿï¼›<br>
é™¤äº†ä¿®æ”¹ JVM å¯åŠ¨å‚æ•°çš„å½¢å¼ï¼Œè¿˜æ˜¯æºç ä¸­é€šè¿‡ application.properties æ–‡ä»¶è¿›è¡Œé…ç½®.</p>
<h1 id="4-é…ç½®é¡¹ç›®è¯´æ˜"><a class="markdownIt-Anchor" href="#4-é…ç½®é¡¹ç›®è¯´æ˜">#</a> 4ã€é…ç½®é¡¹ç›®è¯´æ˜</h1>
<p>æ§åˆ¶å°çš„ä¸€äº›ç‰¹æ€§å¯ä»¥é€šè¿‡é…ç½®é¡¹æ¥è¿›è¡Œé…ç½®</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606112448778.png" alt="image-20230606112448778"></p>
<p>é€šè¿‡ JVM æ–¹å¼ä¸ºï¼šåœ¨ <code>é…ç½®Dockerfiel</code>  çš„ <code>ENTRYPOINT</code>  ä¸­åŠ å…¥ç›¸åº”é…ç½®å°±è¡Œã€‚<br>
æ¯”å¦‚ï¼š <code>ENTRYPOINT [ &quot;java&quot; ,&quot;-jar&quot;,&quot;-Dsentinel.dashboard.app.hideAppNoMachineMillis=60000&quot;</code></p>
<h1 id="5-é•œåƒä¿å­˜ä¸åŠ è½½"><a class="markdownIt-Anchor" href="#5-é•œåƒä¿å­˜ä¸åŠ è½½">#</a> 5ã€é•œåƒä¿å­˜ä¸åŠ è½½</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜iamgeåˆ°homeç›®å½•ä¸‹</span></span><br><span class="line">docker save -o /home/sentinel-server.tar iamgeName</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä»“homeç›®å½•ä¸‹å¯¼å…¥image</span></span><br><span class="line">docker load --input /home/sentinel-server.tar</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æµ‹è¯•ï¼š</span></span><br><span class="line"><span class="comment"># 1ã€saveæˆåŠŸä»¥åï¼Œåˆ é™¤åŸæœ‰imagesä¸­çš„sentinel-server</span></span><br><span class="line"><span class="comment"># 2ã€å¯¼å…¥æˆåŠŸåï¼Œé‡æ–°å¯åŠ¨å®¹å™¨ï¼Œå¹¶ä¸”æˆåŠŸè®¿é—®</span></span><br></pre></td></tr></table></figure>
<h1 id="6-æ§åˆ¶å°ä»‹ç»"><a class="markdownIt-Anchor" href="#6-æ§åˆ¶å°ä»‹ç»">#</a> 6ã€æ§åˆ¶å°ä»‹ç»</h1>
<p><strong>æŸ¥çœ‹æœºå™¨åˆ—è¡¨ä»¥åŠå¥åº·æƒ…å†µï¼š</strong></p>
<p>åœ¨æœºå™¨åˆ—è¡¨ä¸­çœ‹åˆ°çš„è¿æ¥åˆ° <code>sentinel</code>  çš„æœºå™¨ï¼Œå¹¶ä¸”å±•ç¤ºç›‘æ§çŠ¶å†µ</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131048872.png" alt="image-20230606131048872"></p>
<p><strong>ç°‡ç‚¹é“¾è·¯ï¼š</strong><br>
ç°‡ç‚¹é“¾è·¯ï¼ˆå•æœºè°ƒç”¨é“¾è·¯ï¼‰é¡µé¢å®æ—¶çš„å»æ‹‰å–æŒ‡å®šå®¢æˆ·ç«¯èµ„æºçš„è¿è¡Œæƒ…å†µã€‚å®ƒä¸€å…±æä¾›ä¸¤ç§å±•ç¤ºæ¨¡å¼ï¼šä¸€ç§ç”¨æ ‘çŠ¶ç»“æ„å±•ç¤ºèµ„æºçš„è°ƒç”¨é“¾è·¯ï¼Œå¦å¤–ä¸€ç§åˆ™ä¸åŒºåˆ†è°ƒç”¨é“¾è·¯å±•ç¤ºèµ„æºçš„å®æ—¶æƒ…å†µã€‚</p>
<p><strong>æ³¨æ„:</strong> ç°‡ç‚¹é“¾è·¯ç›‘æ§æ˜¯å†…å­˜æ€çš„ä¿¡æ¯ï¼Œå®ƒä»…å±•ç¤ºå¯åŠ¨åè°ƒç”¨è¿‡çš„èµ„æºã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131057100.png" alt="image-20230606131057100"></p>
<p><strong>å®æ—¶ç›‘æ§ï¼š</strong><br>
åŒä¸€ä¸ªæœåŠ¡ä¸‹çš„æ‰€æœ‰æœºå™¨çš„ç°‡ç‚¹ä¿¡æ¯ä¼šè¢«æ±‡æ€»ï¼Œå¹¶ä¸”ç§’çº§åœ°å±•ç¤ºåœ¨ &quot;å®æ—¶ç›‘æ§&quot; ä¸‹ã€‚éœ€è¦ç¡®ä¿ Sentinel æ§åˆ¶å°æ‰€åœ¨çš„æœºå™¨æ—¶é—´ä¸è‡ªå·±åº”ç”¨çš„æœºå™¨æ—¶é—´ä¿æŒä¸€è‡´ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ‹‰ä¸åˆ°å®æ—¶çš„ç›‘æ§æ•°æ®ã€‚</p>
<p>æ³¨æ„ï¼šå®æ—¶ç›‘æ§ä»…å­˜å‚¨ 5 åˆ†é’Ÿä»¥å†…çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–ï¼Œéœ€è¦é€šè¿‡è°ƒç”¨å®æ—¶ç›‘æ§æ¥å£æ¥å®šåˆ¶ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131105294.png" alt="image-20230606131105294"></p>
<p><strong>è§„åˆ™ç®¡ç†ï¼š</strong><br>
Sentinel è§„åˆ™åˆ†ä¸ºï¼šæµæ§ã€é™çº§ã€çƒ­ç‚¹ã€ ç³»ç»Ÿã€æˆæƒï¼Œé€šè¿‡æ§åˆ¶å°å¯ä»¥å¯¹å„ä¸ª <code>èµ„æº</code> é…ç½®ç›¸åº”çš„è§„åˆ™</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131111772.png" alt="image-20230606131111772"></p>
<p><strong>7ã€æ•´åˆ SpringCloud ä½¿ç”¨</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line"> cloud:</span><br><span class="line">  sentinel:</span><br><span class="line">   transport:</span><br><span class="line">     port: 9999 <span class="comment">#è·Ÿæ§åˆ¶å°äº¤æµçš„ç«¯å£,éšæ„æŒ‡å®šä¸€ä¸ªæœªä½¿ç”¨çš„ç«¯å£å³å¯</span></span><br><span class="line">	 dashboard: 127.0.0.1:8858 <span class="comment"># æŒ‡å®šæ§åˆ¶å°æœåŠ¡çš„åœ°å€</span></span><br><span class="line">   <span class="built_in">log</span>:</span><br><span class="line">     <span class="built_in">dir</span>: logs/sentinel <span class="comment">#æ—¥å¿—è¾“å‡ºåœ°å€</span></span><br></pre></td></tr></table></figure>
<p><strong>éªŒè¯ï¼š</strong><br>
Sentinel ä¼šåœ¨å®¢æˆ·ç«¯é¦–æ¬¡è°ƒç”¨çš„æ—¶å€™è¿›è¡Œåˆå§‹åŒ–ï¼Œå¼€å§‹å‘æ§åˆ¶å°å‘é€å¿ƒè·³åŒ…ï¼Œæˆ‘ä»¬å¯åŠ¨æœåŠ¡åï¼Œè¯·æ±‚ä»»æ„ä¸€ä¸ªæ¥å£åï¼Œå³å¯æˆåŠŸæ³¨å†Œã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606131122702.png" alt="image-20230606131122702"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-05T07:25:21.000Z" title="2023-6-5 15:25:21">2023-06-05</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-05T07:51:38.684Z" title="2023-6-5 15:51:38">2023-06-05</time>æ›´æ–°</span><span class="level-item">3 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦436ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">ã€Gitã€‘Githubæäº¤ä»£ç é‡åˆ°é”™è¯¯ï¼šERROR Youâ€˜re using an RSA key with SHA-1, which is no longer allowed</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="gitgithubæäº¤ä»£ç é‡åˆ°é”™è¯¯error-youre-using-an-rsa-key-with-sha-1-which-is-no-longer-allowed"><a class="markdownIt-Anchor" href="#gitgithubæäº¤ä»£ç é‡åˆ°é”™è¯¯error-youre-using-an-rsa-key-with-sha-1-which-is-no-longer-allowed">#</a> ã€Gitã€‘Github æäº¤ä»£ç é‡åˆ°é”™è¯¯ï¼šERROR Youâ€˜re using an RSA key with SHA-1, which is no longer allowed</h1>
<p>ERROR: Youâ€™re using an RSA key with SHA-1, which is no longer allowed.<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/efa1ce926ae34dfb99dfdd3516ec6fab.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
é€šè¿‡ baiduï¼Œä»é”™è¯¯ä¸‹é¢ç»™å‡ºçš„å®˜æ–¹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://github.blog/2021-09-01-improving-git-protocol-security-github/">https://github.blog/2021-09-01-improving-git-protocol-security-github/</a> å¯ä»¥çœ‹åˆ°ï¼Œgithub å¯¹ SSH å¯†é’¥åšäº†å‡çº§ï¼ŒåŸæ¥çš„ SHA-1ï¼Œrsa ç­‰ä¸€äº›å·²ç»ä¸æ”¯æŒäº†ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„æ˜¯ rsaï¼Œå¯èƒ½å’Œå¤§éƒ¨åˆ†ç”¨æˆ·ä¸€æ ·ï¼Œæ‰€ä»¥ä»Šå¤©åœ¨ push ä»£ç æ—¶å€™é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè®°å½•ä»¥ä¸‹ã€‚<br>
ç”Ÿæˆæ–°çš„ Ed25519 å¯†é’¥å¯¹ï¼š<br>
 <code>ssh-keygen -t ed25519 -C &quot;your-email&quot;</code> <br>
 ä¸€è·¯å›è½¦ã€‚<br>
ä¼šåœ¨.ssh ç›®å½•ä¸‹ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶</p>
<blockquote>
<p>id_ed25519<br>
id_ed25519.pub</p>
</blockquote>
<p>å°† id_ed25519.pub æ–‡ä»¶ä¸­çš„å†…å®¹ copyï¼Œæ‹¿å‡ºæ¥åˆ° github ä¸Š<br>
è¿™é‡Œï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230605155058169.png" alt="image-20230605155058169"><br>
 æ·»åŠ ä¸€ä¸ªæ–°çš„ ssh keys å³å¯<br>
éªŒè¯ key æ˜¯å¦å¯ç”¨ï¼šä½¿ç”¨  <code>ssh -T git@github.com </code> å¯¹ ssh key è¿›è¡ŒéªŒè¯<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/88a5bd8e286b4cc28319d49e6c0d0972.png" alt="img"><br>
 ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨ push å‘½ä»¤ä¸Šä¼ äº†ã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-23T02:04:23.000Z" title="2023-5-23 10:04:23">2023-05-23</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-05T07:22:15.429Z" title="2023-6-5 15:22:15">2023-06-05</time>æ›´æ–°</span><span class="level-item">9 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1318ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/23/%E3%80%90Linux%E3%80%91%E9%98%BF%E9%87%8C%E4%BA%91linux%20%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98%E5%B9%B6docker%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E8%BF%81%E7%A7%BB%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98/">ã€Linuxã€‘é˜¿é‡Œäº‘linux æŒ‚è½½æ•°æ®ç›˜å¹¶dockerå·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="linuxé˜¿é‡Œäº‘linux-æŒ‚è½½æ•°æ®ç›˜å¹¶dockerå·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜"><a class="markdownIt-Anchor" href="#linuxé˜¿é‡Œäº‘linux-æŒ‚è½½æ•°æ®ç›˜å¹¶dockerå·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜">#</a> ã€Linuxã€‘é˜¿é‡Œäº‘ linux æŒ‚è½½æ•°æ®ç›˜å¹¶ docker å·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜</h1>
<p><strong>ä¸€ã€æŒ‚è½½æ•°æ®ç›˜ï¼Œåˆ†åŒº - æ ¼å¼åŒ– - æŒ‚è½½</strong></p>
<p>1ã€fdisk -l æŸ¥çœ‹ç£ç›˜æƒ…å†µ</p>
<p>æ‰§è¡Œå‘½ä»¤ fdisk -l å‘ç° 2 ä¸ªç£ç›˜ï¼Œä½†æ˜¯ç£ç›˜ nvme1n1 æ²¡æœ‰åˆ†åŒºï¼Œnvme0n1 æ˜¯æœ‰ 2 ä¸ªåˆ†åŒºäº†ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/cceb22f4006cbef75fcd0469ee6f66b4.png" alt="img"></p>
<p>2ã€fdisk /dev/nvme1n1 æ‰§è¡Œåˆ›å»ºåˆ†åŒº</p>
<p>æ‰§è¡Œå‘½ä»¤ fdisk /dev/nvme1n1</p>
<p>è¾“å…¥ n å†å›è½¦åˆ›å»ºæ–°åˆ†åŒºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/549659e940ec22bb06edfaaff24fbcb9.png" alt="img"></p>
<p>è¾“å…¥ p å†å›è½¦åˆ›å»ºä¸»åˆ†åŒºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b74a9ade7fe427394a9fd29c1341185d.png" alt="img"></p>
<p>è¾“å…¥ 1 è®¾ç½®åˆ†åŒºå·ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/65ef7ff6d5b47dda182b008d7a76bf7a.png" alt="img"></p>
<p>èµ·å§‹æ‰‡åŒºè®¾ç½®ï¼Œç›´æ¥å›è½¦å°±å¯ä»¥ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/49ba78c89a3adc99c197d3f86b1bfa0d.png" alt="img"></p>
<p>æ‰‡åŒºç»“æŸä½ç½®ï¼Œç›´æ¥å›è½¦å°±å¯ä»¥ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f90577aa65369904459b9d92c6812f42.png" alt="img"></p>
<p>æœ€åè¾“å…¥ w å†å›è½¦ä¿å­˜è®¾ç½®ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/14aff319e909413dd137a79ecdaa5f5c.png" alt="img"></p>
<p>3ã€æ ¼å¼åŒ–åˆ†åŒº</p>
<p>è¿è¡Œ fdisk -lu /dev/nvme1n1 æŸ¥çœ‹åˆ†åŒºæƒ…å†µ</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e66c56ebcc4ff70a98e0d896e6c79a48.png" alt="img"></p>
<p>æ ¼å¼åŒ–åˆ†åŒºï¼Œå¹¶å»ºç«‹æ–‡ä»¶ç³»ç»Ÿ ext4ã€‚ æ‰§è¡Œå‘½ä»¤ï¼šsudo mkfs.ext4 /dev/nvme1n1p1</p>
<p>æ³¨æ„ï¼šä¹Ÿæœ‰äººè¯´ç¡¬ç›˜åº”è¯¥æ˜¯ä¹°æ¥å°±å·²ç»æ ¼å¼åŒ–è¿‡äº†çš„ï¼Œè¯´çš„å¥½åƒä¹Ÿæœ‰é‚£ä¹ˆäº›é“ç†ã€‚ä½†æ˜¯æˆ‘ç°åœ¨æ˜¯ nvme1n1 è¿™ä¸ªç¡¬ç›˜æ ¹æœ¬çœ‹ä¸åˆ°åˆ†åŒºçš„æƒ…å†µä¸‹åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„åˆ†åŒº nvme1n1p1 ï¼Œæ ¼å¼åŒ–ä¸€ä¸‹è¿™ä¸ªåˆ†åŒºæˆ‘ä¸ªäººè®¤ä¸ºä¹Ÿæ²¡é”™ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0bac4af4597d43a13aa40c2c6bd37287.png" alt="img"></p>
<p>4ã€æŒ‚è½½åˆ†åŒº</p>
<p>æ‰§è¡Œå‘½ä»¤ï¼šsudo mount /dev/nvme1n1p1 /mnt å°†åˆ†åŒº /dev/nvme1n1p1 æŒ‚è½½åˆ° mnt ç›®å½•ä¸‹ã€‚</p>
<p>ç„¶åæ‰§è¡Œ df æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ ï¼Œæ‰§è¡Œ df -Th æŸ¥çœ‹æ–°æŒ‚è½½çš„ç£ç›˜æ–‡ä»¶ç³»ç»Ÿå’Œå…¶ä»–ç£ç›˜æ˜¯å¦ä¸€è‡´ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/06cef34afe1a743950a164cd40fe272f.png" alt="img"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/924b718ee9c86531e0221e614998cf05.png" alt="img"></p>
<p>5ã€è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½</p>
<p>sudo vim /etc/fstab ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›å…¥ é…ç½®æ–‡ä»¶ï¼Œç„¶åæŒ‰ i é”®è¿›å…¥æ’å…¥ç¼–è¾‘æ¨¡å¼</p>
<p>åœ¨æ–‡ä»¶æœ«å°¾å¢åŠ ä¸‹é¢çš„ä¸€è¡Œ</p>
<p>/dev/nvme1n1p1 /mnt ext4 defaults 0 0</p>
<p>æŒ‰ esc é€€å‡ºç¼–è¾‘ï¼Œè¾“å…¥ :wq ä¿å­˜é€€å‡ºã€‚</p>
<p><strong>äºŒã€docker ç›®å½•ä»ç³»ç»Ÿç›˜è¿ç§»åˆ°æ•°æ®ç›˜</strong></p>
<p>1ã€ç¡®è®¤å·²ç»å°† /dev/nvme1n1 è¿™ä¸ªæ•°æ®ç¡¬ç›˜çš„ /dev/nvme1n1p1 åˆ†åŒºæŒ‚è½½åˆ°äº† mnt ç›®å½•</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/06cef34afe1a743950a164cd40fe272f.png" alt="img"></p>
<p>2ã€æ‰§è¡Œ docker info å‘½ä»¤ï¼Œå¾—åˆ° docker åŸºæœ¬ä¿¡æ¯ï¼Œå…¶ä¸­å¯ä»¥çœ‹åˆ° Docker Root Dir: /var/lib/docker å’Œ Storage Driver: overlay2 è¿™ä¸¤ä¸ªä¿¡æ¯ï¼Œè¯´æ˜äº† docker ç¨‹åºæ–‡ä»¶å®‰è£…åœ¨ /var/lib/dockerï¼Œå…¶ä¸­ overlay2 ä¸ºæ•°æ®å­˜å‚¨ä½ç½®ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a2885575e1d6701f9d340f19e6ef7b2f.png" alt="img"></p>
<p>3ã€å…ˆåœæ­¢ Docker ï¼Œä¿è¯ç§»åŠ¨çš„æ—¶å€™æ•°æ®å®Œæ•´ï¼Œæ‰§è¡Œ service docker stop å‘½ä»¤åœæ­¢ Docker daemonã€‚ å‘½ä»¤ï¼šsystemctl stop docker</p>
<p>å¯ä»¥ç”¨ ps å‘½ä»¤è¿›ä¸€æ­¥æ£€æŸ¥ï¼šps faux | grep -i docker</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/dd32ff8fb25e4b37f053b51533f4f896.png" alt="img"></p>
<p>4ã€å°† Docker é»˜è®¤æ•°æ®ç›®å½•ä¸‹çš„æ•°æ®ç§»åŠ¨åˆ°ä¸€ä¸ªå¤‡ä»½çš„ç›®å½•ï¼Œä¾‹å¦‚ /mnt/Docker_dataï¼Œæ‰§è¡Œå‘½ä»¤:</p>
<p>mv /var/lib/docker /mnt/Docker_data</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7080e757f909be46d25c0402119f9b70.png" alt="img"></p>
<p>5ã€æŠŠ Docker çš„å·¥ä½œç›®å½•åˆ‡æ¢åˆ° /mnt/Docker_data/docker</p>
<p>ï¼ˆ1ï¼‰æ›´æ”¹ Docker æœåŠ¡çš„ service æ–‡ä»¶ï¼š vi /lib/systemd/system/docker.service</p>
<p>ï¼ˆ2ï¼‰ä½¿ç”¨è¾“å…¥ /<em>ExecSt</em>art æœç´¢å…³é”®å­— ï¼Œ æ‰¾åˆ°è¿™ä¸€è¡Œï¼šExecStart=/usr/bin/dockerd -H fd://--containerd=/run/containerd/containerd.sock</p>
<p>æ”¹ä¸ºï¼š<em>ExecSt</em>art=/usr/bin/dockerd -g /mnt/Docker_data/docker -H fd:// --containerd=/run/containerd/containerd.sock</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3132eaca23c769fef0fc97685485249b.png" alt="img"></p>
<p>(3) åˆ·æ–° docker æœåŠ¡ ï¼š<em>sudo s</em>ystemctl daemon-reload</p>
<p>é‡å¯ docker æœåŠ¡ï¼š<em>system</em>ctl start docker</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/455d262fec86518eda5c68c77bc3464e.png" alt="img"></p>
<p>(4) æŸ¥çœ‹ docker çŠ¶æ€ï¼šsystemctl status docker</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e4859b458ec4262825ca347decd46183.png" alt="img"></p>
<p>æ³¨æ„ ï¼šå¦‚æœæŸ¥çœ‹çŠ¶æ€å‡ºç°äº†å¤±è´¥çš„çº¢è‰²çš„æç¤ºï¼Œé‚£ä¹ˆå°±è¦è¿”å›ç¬¬ 3 æ­¥åœæ­¢æœåŠ¡å¼€å§‹ï¼Œå†èµ°ä¸€éæ­¥éª¤ï¼Œé‡æ–°ä¿®æ”¹ Docker æœåŠ¡çš„ service æ–‡ä»¶ï¼Œæ¯”å¦‚æˆ‘å¼€å§‹çš„æ—¶å€™ - H å‰é¢å°‘äº†ä¸€ä¸ªç©ºæ ¼ï¼Œå°±æŠ¥çº¢è‰²é”™è¯¯äº†ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b50944f9ba4c5ee837e8ab64113b002a.png" alt="img"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-23T02:04:23.000Z" title="2023-5-23 10:04:23">2023-05-23</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-06-05T07:31:10.671Z" title="2023-6-5 15:31:10">2023-06-05</time>æ›´æ–°</span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦8834ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/23/%E3%80%90Seata%E3%80%91%E6%9D%A5%E8%87%AA%E9%98%BF%E9%87%8C%E5%BC%80%E6%BA%90%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%A1%86%E6%9E%B6-Seata%E7%9A%84%E5%8E%9F%E7%90%86/">ã€Seataã€‘æ¥è‡ªé˜¿é‡Œå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶-Seataçš„åŸç†</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="seataæ¥è‡ªé˜¿é‡Œå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶-seataçš„åŸç†"><a class="markdownIt-Anchor" href="#seataæ¥è‡ªé˜¿é‡Œå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶-seataçš„åŸç†">#</a> ã€Seataã€‘æ¥è‡ªé˜¿é‡Œå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶ - Seata çš„åŸç†</h1>
<p>é¦–å…ˆ  <code>Seata</code>  å®¢æˆ·ç«¯å¯åŠ¨ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæµç¨‹ï¼š</p>
<ol>
<li>è‡ªåŠ¨åŠ è½½ Bean å±æ€§å’Œé…ç½®ä¿¡æ¯</li>
<li>åˆå§‹åŒ– TM</li>
<li>åˆå§‹åŒ– RM</li>
<li>åˆå§‹åŒ–åˆ†å¸ƒå¼äº‹åŠ¡å®¢æˆ·ç«¯å®Œæˆï¼Œå®Œæˆä»£ç†æ•°æ®åº“é…ç½®</li>
<li>è¿æ¥ TC (Seata æœåŠ¡ç«¯)ï¼Œæ³¨å†Œ RM å’Œ TM</li>
<li>å¼€å¯å…¨å±€äº‹åŠ¡</li>
</ol>
<p>åœ¨è¿™ç¯‡æºç çš„è®²è§£ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦ä»¥ AT æ¨¡å¼ä¸ºä¸»å¯¼ï¼Œå®˜ç½‘ä¹Ÿæ˜¯ä¸»æ¨ AT æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨ä¸Šç¯‡çš„æ–‡ç« ä¸­ä¹Ÿè®²è§£è¿‡ï¼Œæ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹ä¸€çœ‹<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA4MjM0MTQ1Mg==&amp;mid=2458786001&amp;idx=1&amp;sn=98f3b3c5d211f60a803446913fbb12e3&amp;chksm=88fd83f2bf8a0ae4b2682af7b15f9493c33d7771a066d1eb1c73583cfc67da891cffa1c9f55c&amp;token=1008440856&amp;lang=zh_CN#rd">åˆ†å¸ƒå¼äº‹åŠ¡ (Seata) å››å¤§æ¨¡å¼è¯¦è§£</a>ï¼Œåœ¨å®˜ç½‘ä¸­ä¹Ÿæä¾›äº†å¯¹åº”çš„æµç¨‹åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://seata.io/zh-cn/docs/dev/mode/at-mode.html">https://seata.io/zh-cn/docs/dev/mode/at-mode.html</a> ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯åšä¸€äº›ç®€å•çš„ä»‹ç»ï¼ŒAT æ¨¡å¼ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<p><strong>ä¸€é˜¶æ®µï¼š</strong></p>
<ul>
<li>è§£æ SQLï¼Œè·å– SQL ç±»å‹ï¼ˆCRUDï¼‰ã€è¡¨ä¿¡æ¯ã€æ¡ä»¶ (where) ç­‰ç›¸å…³ä¿¡æ¯</li>
<li>æŸ¥è¯¢å‰é•œåƒ (æ”¹å˜ä¹‹å‰çš„æ•°æ®)ï¼Œæ ¹æ®è§£æå¾—åˆ°çš„æ¡ä»¶ä¿¡æ¯ï¼Œç”ŸæˆæŸ¥è¯¢è¯­å¥ï¼Œå®šä½æ•°æ®</li>
<li>æ‰§è¡Œä¸šåŠ¡ SQLï¼Œæ›´æ–°æ•°æ®</li>
<li>æŸ¥è¯¢åé•œåƒï¼ˆæ”¹å˜åçš„æ•°æ®ï¼‰ï¼Œæ ¹æ®å‰é•œåƒçš„ç»“æœï¼Œé€šè¿‡ä¸»é”®éƒ½ç»™ä½ ä¸ºæ•°æ®</li>
<li>æ’å…¥å›æ»šæ—¥å¿—ï¼Œå°†å‰åé•œåƒæ•°æ®ä»¥åŠä¸šåŠ¡ SQL ç­‰ä¿¡æ¯ï¼Œç»„ç»‡æˆä¸€æ¡å›æ»šæ—¥å¿—è®°å½•ï¼Œæ’å…¥åˆ° undo Log è¡¨ä¸­</li>
<li>æäº¤å‰ï¼Œå‘ TC æ³¨å†Œåˆ†æ”¯ï¼Œç”³è¯·å…¨å±€é”</li>
<li>æœ¬åœ°äº‹åŠ¡æäº¤ï¼Œä¸šåŠ¡æ•°æ®çš„æ›´ç»†è…»å’Œç”Ÿæˆçš„ undoLog ä¸€èµ·æäº¤</li>
<li>å°†æœ¬åœ°äº‹åŠ¡æäº¤çš„ç»“æœé€šçŸ¥ç»™ TC</li>
</ul>
<p><strong>äºŒé˜¶æ®µï¼š</strong></p>
<p>å¦‚æœ TC æ”¶åˆ°çš„æ˜¯å›æ»šè¯·æ±‚</p>
<ul>
<li>å¼€å¯æœ¬åœ°äº‹åŠ¡ï¼Œé€šè¿‡ XID å’Œ BranchID æŸ¥æ‰¾åˆ°å¯¹åº”çš„ undo Log è®°å½•</li>
<li>æ ¹æ® undoLog ä¸­çš„å‰é•œåƒå’Œä¸šåŠ¡ SQL çš„ç›¸å…³ä¿¡æ¯ç”Ÿæˆå¹¶æ‰§è¡Œå›æ»šè¯­å¥</li>
<li>æäº¤æœ¬åœ°äº‹åŠ¡ï¼Œå°†æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œç»“æœï¼ˆåˆ†æ”¯äº‹åŠ¡å›æ»šçš„ä¿¡æ¯ï¼‰é€šçŸ¥ç»™ TC</li>
</ul>
<p>å¦‚æœæ²¡é—®é¢˜ï¼Œæ‰§è¡Œæäº¤æ“ä½œ</p>
<ul>
<li>æ”¶åˆ° TC åˆ†æ”¯æäº¤è¯·æ±‚ï¼Œå°†è¯·æ±‚æ”¾å…¥åˆ°ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„é˜Ÿåˆ—ä¸­ï¼Œé©¬ä¸Šè¿”å›æäº¤æˆåŠŸçš„ç»“æœç»™ TC</li>
<li>å¼‚æ­¥ä»»åŠ¡é˜¶æ®µçš„åˆ†æ”¯æäº¤è¯·æ±‚åˆ é™¤ undoLog ä¸­è®°å½•</li>
</ul>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6b4a6708a964d51d954cec9fb660b72f.png" alt="img"></p>
<h2 id="æºç å…¥å£"><a class="markdownIt-Anchor" href="#æºç å…¥å£">#</a> æºç å…¥å£</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±éœ€è¦ä»å®˜ç½‘ä¸­å»ä¸‹è½½æºç ï¼Œä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://seata.io/zh-cn/blog/download.html%EF%BC%8C%E9%80%89%E6%8B%A9">https://seata.io/zh-cn/blog/download.htmlï¼Œé€‰æ‹©</a>  <code>source</code>  å³å¯ï¼Œä¸‹è½½å®Œæˆä¹‹åï¼Œé€šè¿‡ IDEA æ‰“å¼€é¡¹ç›®ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/bdca1226de54c44b76fbcb81ad5203ec.png" alt="img"></p>
<p>æºç ä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å»æ‰¾å…¥å£å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯¹åº”å¼•å…¥çš„  <code>Seata</code>  åŒ…  <code>spring-alibaba-seata</code> ï¼Œæˆ‘ä»¬åœ¨å›æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¼€å¯äº‹åŠ¡çš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯æ·»åŠ è¿‡ä¸€ä¸ª <code>@GlobalTransactional</code>  çš„æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å°±æ˜¯æˆ‘ä»¬å…¥æ‰‹çš„ä¸€ä¸ªç‚¹ï¼Œæˆ‘ä»¬åœ¨  <code>spring.factories</code>  ä¸­çœ‹åˆ°æœ‰ä¸€ä¸ª  <code>GlobalTransactionAutoConfiguration</code> ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æºç çš„å…¥å£</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/23af43bca4492008ae3b80c10bd77c4f.png" alt="img"></p>
<p>åœ¨  <code>GlobalTransactionAutoConfiguration</code>  ä¸­æˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªç”¨ Bean æ³¨å…¥çš„æ–¹æ³•  <code>globalTransactionScanner</code> ï¼Œè¿™ä¸ªå°±æ˜¯å…¨å±€äº‹åŠ¡æ‰«æå™¨ï¼Œè¿™ä¸ªç±»å‹ä¸»è¦è´Ÿè´£åŠ è½½é…ç½®ï¼Œæ³¨å…¥ç›¸å…³çš„ Bean</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0f9703310464018bedfecc661d4c4e91.png" alt="img"></p>
<p>è¿™é‡Œç»™å¤§å®¶å±•ç¤ºäº†å½“å‰ GlobalTransactionScanner çš„ç±»å…³ç³»å›¾ï¼Œå…¶ä¸­æˆ‘ä»¬ç°åœ¨ç»§æ‰¿äº† Aop çš„ AbstractAutoProxyCreator ç±»å‹ï¼Œåœ¨è¿™å…¶ä¸­æœ‰ä¸€ä¸ªé‡ç‚¹æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­ Bean å¯¹è±¡æ˜¯å¦éœ€è¦ä»£ç†ï¼Œæ˜¯å¦éœ€è¦å¢å¼ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SeataProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalTransactionAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¨å±€äº‹åŠ¡æ‰«æå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> GlobalTransactionScanner <span class="title function_">globalTransactionScanner</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="type">String</span> <span class="variable">applicationName</span> <span class="operator">=</span> applicationContext.getEnvironment()</span><br><span class="line">          .getProperty(<span class="string">&quot;spring.application.name&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="type">String</span> <span class="variable">txServiceGroup</span> <span class="operator">=</span> seataProperties.getTxServiceGroup();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isEmpty(txServiceGroup)) &#123;</span><br><span class="line">        txServiceGroup = applicationName + <span class="string">&quot;-fescar-service-group&quot;</span>;</span><br><span class="line">        seataProperties.setTxServiceGroup(txServiceGroup);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ„å»ºå…¨å±€æ‰«æå™¨ï¼Œä¼ å…¥å‚æ•°ï¼šåº”ç”¨åã€äº‹åŠ¡åˆ†ç»„åï¼Œå¤±è´¥å¤„ç†å™¨</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GlobalTransactionScanner</span>(applicationName, txServiceGroup);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™å…¶ä¸­æˆ‘ä»¬è¦å…³å¿ƒçš„æ˜¯  <code>GlobalTransactionScanner</code>  è¿™ä¸ªç±»å‹ï¼Œè¿™ä¸ªç±»å‹æ‰«æ  <code>@GlobalTransactional</code>  æ³¨è§£ï¼Œå¹¶å¯¹ä»£ç†æ–¹æ³•è¿›è¡Œæ‹¦æˆªå¢å¼ºäº‹åŠ¡çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å°±ä»æºç ä¸­æœç´¢è¿™ä¸ª <code>GlobalTransactionScanner</code>  ç±»ï¼Œçœ‹çœ‹é‡Œé¢å…·ä½“æ˜¯åšäº†ä»€ä¹ˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The type Global transaction scanner.</span></span><br><span class="line"><span class="comment"> * å…¨å±€äº‹åŠ¡æ‰«æå™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> slievrly</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalTransactionScanner</span></span><br><span class="line">        <span class="comment">//AbstractAutoProxyCreator AOPåŠ¨æ€ä»£ç† å¢å¼ºBean</span></span><br><span class="line">        <span class="keyword">extends</span> <span class="title class_">AbstractAutoProxyCreator</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ConfigurationChangeListener: ç›‘å¬å™¨åŸºå‡†æ¥å£</span></span><br><span class="line"><span class="comment">         * InitializingBeanï¼š Beanåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">         * ApplicationContextAwareï¼š Springå®¹å™¨</span></span><br><span class="line"><span class="comment">         * DisposableBeanï¼š Spring å®¹å™¨é”€æ¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">ConfigurationChangeListener</span>, InitializingBean, ApplicationContextAware, DisposableBean &#123;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String applicationId;<span class="comment">//æœåŠ¡å</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String txServiceGroup;<span class="comment">//äº‹åŠ¡åˆ†ç»„        </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Initializing Global Transaction Clients ... &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥åº”ç”¨åä»¥åŠäº‹åŠ¡åˆ†ç»„åï¼Œä¸ºç©ºæŠ›å‡ºå¼‚å¸¸IllegalArgumentException</span></span><br><span class="line">        <span class="keyword">if</span> (DEFAULT_TX_GROUP_OLD.equals(txServiceGroup)) &#123;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;the default value of seata.tx-service-group: &#123;&#125; has already changed to &#123;&#125; since Seata 1.5, &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;please change your default configuration as soon as possible &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;and we don&#x27;t recommend you to use default tx-service-group&#x27;s value provided by seata&quot;</span>,</span><br><span class="line">                    DEFAULT_TX_GROUP_OLD, DEFAULT_TX_GROUP);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNullOrEmpty(applicationId) || StringUtils.isNullOrEmpty(txServiceGroup)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(String.format(<span class="string">&quot;applicationId: %s, txServiceGroup: %s&quot;</span>, applicationId, txServiceGroup));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//init TM</span></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–TM</span></span><br><span class="line">        TMClient.init(applicationId, txServiceGroup, accessKey, secretKey);</span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Transaction Manager Client is initialized. applicationId[&#123;&#125;] txServiceGroup[&#123;&#125;]&quot;</span>, applicationId, txServiceGroup);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//init RM</span></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–RM</span></span><br><span class="line">        RMClient.init(applicationId, txServiceGroup);</span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Resource Manager is initialized. applicationId[&#123;&#125;] txServiceGroup[&#123;&#125;]&quot;</span>, applicationId, txServiceGroup);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Global Transaction Clients are initialized. &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        registerSpringShutdownHook();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (disableGlobalTransaction) &#123;</span><br><span class="line">            <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">                LOGGER.info(<span class="string">&quot;Global transaction is disabled.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ConfigurationCache.addConfigListener(ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,</span><br><span class="line">                    (ConfigurationChangeListener)<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (initialized.compareAndSet(<span class="literal">false</span>, <span class="literal">true</span>)) &#123;</span><br><span class="line">            initClient();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Initializing Global Transaction Clients ... &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ£€æŸ¥åº”ç”¨åä»¥åŠäº‹åŠ¡åˆ†ç»„åï¼Œä¸ºç©ºæŠ›å‡ºå¼‚å¸¸IllegalArgumentException</span></span><br><span class="line">        <span class="keyword">if</span> (DEFAULT_TX_GROUP_OLD.equals(txServiceGroup)) &#123;</span><br><span class="line">            LOGGER.warn(<span class="string">&quot;the default value of seata.tx-service-group: &#123;&#125; has already changed to &#123;&#125; since Seata 1.5, &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;please change your default configuration as soon as possible &quot;</span> +</span><br><span class="line">                    <span class="string">&quot;and we don&#x27;t recommend you to use default tx-service-group&#x27;s value provided by seata&quot;</span>,</span><br><span class="line">                    DEFAULT_TX_GROUP_OLD, DEFAULT_TX_GROUP);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ£€æŸ¥åº”ç”¨åä»¥åŠäº‹åŠ¡åˆ†ç»„åï¼Œä¸ºç©ºæŠ›å‡ºå¼‚å¸¸IllegalArgumentException</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNullOrEmpty(applicationId) || StringUtils.isNullOrEmpty(txServiceGroup)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(String.format(<span class="string">&quot;applicationId: %s, txServiceGroup: %s&quot;</span>, applicationId, txServiceGroup));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//init TM</span></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–TM</span></span><br><span class="line">        TMClient.init(applicationId, txServiceGroup, accessKey, secretKey);</span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Transaction Manager Client is initialized. applicationId[&#123;&#125;] txServiceGroup[&#123;&#125;]&quot;</span>, applicationId, txServiceGroup);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//init RM</span></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–RM</span></span><br><span class="line">        RMClient.init(applicationId, txServiceGroup);</span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Resource Manager is initialized. applicationId[&#123;&#125;] txServiceGroup[&#123;&#125;]&quot;</span>, applicationId, txServiceGroup);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">            LOGGER.info(<span class="string">&quot;Global Transaction Clients are initialized. &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        registerSpringShutdownHook();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä»£ç†å¢å¼ºï¼ŒSpring æ‰€æœ‰çš„Beanéƒ½ä¼šç»è¿‡è¿™ä¸ªæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">wrapIfNecessary</span><span class="params">(Object bean, String beanName, Object cacheKey)</span> &#123;</span><br><span class="line">        <span class="comment">// do checkers</span></span><br><span class="line">        <span class="comment">//æ£€æŸ¥beanå’ŒbeanName</span></span><br><span class="line">        <span class="keyword">if</span> (!doCheckers(bean, beanName)) &#123;</span><br><span class="line">            <span class="keyword">return</span> bean;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åŠ é”é˜²æ­¢å¹¶å‘</span></span><br><span class="line">            <span class="keyword">synchronized</span> (PROXYED_SET) &#123;</span><br><span class="line">                <span class="keyword">if</span> (PROXYED_SET.contains(beanName)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> bean;</span><br><span class="line">                &#125;</span><br><span class="line">                interceptor = <span class="literal">null</span>;</span><br><span class="line">                <span class="comment">//check TCC proxy</span></span><br><span class="line">                <span class="comment">//æ£€æŸ¥æ˜¯å¦ä¸ºTCCæ¨¡å¼</span></span><br><span class="line">                <span class="keyword">if</span> (TCCBeanParserUtils.isTccAutoProxy(bean, beanName, applicationContext)) &#123;</span><br><span class="line">                    <span class="comment">// init tcc fence clean task if enable useTccFence</span></span><br><span class="line">                    <span class="comment">//å¦‚æœå¯ç”¨useTccFence å¤±è´¥ ï¼Œåˆ™åˆå§‹åŒ–TCCæ¸…ç†ä»»åŠ¡</span></span><br><span class="line">                    TCCBeanParserUtils.initTccFenceCleanTask(TCCBeanParserUtils.getRemotingDesc(beanName), applicationContext);</span><br><span class="line">                    <span class="comment">//TCC interceptor, proxy bean of sofa:reference/dubbo:reference, and LocalTCC</span></span><br><span class="line">                    <span class="comment">//å¦‚æœæ˜¯ï¼Œæ·»åŠ TCCæ‹¦æˆªå™¨</span></span><br><span class="line">                    interceptor = <span class="keyword">new</span> <span class="title class_">TccActionInterceptor</span>(TCCBeanParserUtils.getRemotingDesc(beanName));</span><br><span class="line">                    ConfigurationCache.addConfigListener(ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,</span><br><span class="line">                            (ConfigurationChangeListener)interceptor);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//ä¸æ˜¯TCC</span></span><br><span class="line">                    Class&lt;?&gt; serviceInterface = SpringProxyUtils.findTargetClass(bean);</span><br><span class="line">                    Class&lt;?&gt;[] interfacesIfJdk = SpringProxyUtils.findInterfaces(bean);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰ç›¸å…³äº‹åŠ¡æ³¨è§£ï¼Œå¦‚æœæ²¡æœ‰ä¸è¿›è¡Œä»£ç†</span></span><br><span class="line">                    <span class="keyword">if</span> (!existsAnnotation(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;serviceInterface&#125;)</span><br><span class="line">                        &amp;&amp; !existsAnnotation(interfacesIfJdk)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> bean;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//å‘ç°å­˜åœ¨å…¨å±€äº‹åŠ¡æ³¨è§£æ ‡æ³¨çš„Beanå¯¹è±¡ï¼Œæ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">                    <span class="keyword">if</span> (globalTransactionalInterceptor == <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="comment">//æ·»åŠ æ‹¦æˆªå™¨</span></span><br><span class="line">                        globalTransactionalInterceptor = <span class="keyword">new</span> <span class="title class_">GlobalTransactionalInterceptor</span>(failureHandlerHook);</span><br><span class="line">                        ConfigurationCache.addConfigListener(</span><br><span class="line">                                ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,</span><br><span class="line">                                (ConfigurationChangeListener)globalTransactionalInterceptor);</span><br><span class="line">                    &#125;</span><br><span class="line">                    interceptor = globalTransactionalInterceptor;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                LOGGER.info(<span class="string">&quot;Bean[&#123;&#125;] with name [&#123;&#125;] would use interceptor [&#123;&#125;]&quot;</span>, bean.getClass().getName(), beanName, interceptor.getClass().getName());</span><br><span class="line">                <span class="comment">//æ£€æŸ¥æ˜¯å¦ä¸ºä»£ç†å¯¹è±¡</span></span><br><span class="line">                <span class="keyword">if</span> (!AopUtils.isAopProxy(bean)) &#123;</span><br><span class="line">                    <span class="comment">//ä¸æ˜¯ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨çˆ¶çº§</span></span><br><span class="line">                    bean = <span class="built_in">super</span>.wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//æ˜¯ä»£ç†å¯¹è±¡ï¼Œåå°„è·å–ä»£ç†ç±»ä¸­å·²ç»å­˜åœ¨çš„æ‹¦æˆªå™¨ç»„åˆï¼Œç„¶åæ·»åŠ åˆ°è¿™ä¸ªé›†åˆä¸­</span></span><br><span class="line">                    <span class="type">AdvisedSupport</span> <span class="variable">advised</span> <span class="operator">=</span> SpringProxyUtils.getAdvisedSupport(bean);</span><br><span class="line">                    Advisor[] advisor = buildAdvisors(beanName, getAdvicesAndAdvisorsForBean(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>));</span><br><span class="line">                    <span class="type">int</span> pos;</span><br><span class="line">                    <span class="keyword">for</span> (Advisor avr : advisor) &#123;</span><br><span class="line">                        <span class="comment">// Find the position based on the advisor&#x27;s order, and add to advisors by pos</span></span><br><span class="line">                        pos = findAddSeataAdvisorPosition(advised, avr);</span><br><span class="line">                        advised.addAdvisor(pos, avr);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                PROXYED_SET.add(beanName);</span><br><span class="line">                <span class="keyword">return</span> bean;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exx) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(exx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">InitializingBean`ï¼šä¸­å®ç°äº†ä¸€ä¸ª `afterPropertiesSet()`æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†`initClient()</span><br></pre></td></tr></table></figure>
<p><code>AbstractAutoProxyCreator</code> ï¼šAPO åŠ¨æ€ä»£ç†ï¼Œåœ¨ä¹‹å‰çš„çš„ Nacos å’Œ Sentiel ä¸­éƒ½æœ‰è¿™ä¸ªä»£ç†ç±»ï¼ŒAOP åœ¨æˆ‘ä»¬è¶Šå¾€æ·±å…¥å­¦ä¹ ï¼Œåœ¨å­¦ä¹ æºç çš„ä¼šè§åˆ°çš„è¶Šæ¥è¶Šå¤šï¼Œè¶Šæ¥è¶Šé‡è¦ï¼Œå¾ˆå¤šç›¸å…³ä»£ç†ï¼Œéƒ½æ˜¯é€šè¿‡ AOP è¿›è¡Œå¢å¼ºï¼Œåœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨æœ‰ä¸€ä¸ª <code>wrapIfNecessary()</code>  æ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯åˆ¤æ–­è¢«ä»£ç†çš„ bean æˆ–è€…ç±»æ˜¯å¦éœ€è¦ä»£ç†å¢å¼ºï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¼šè°ƒç”¨ <code>GlobalTransactionalInterceptor.invoke()</code>  è¿›è¡Œå¸¦æ¥å¢å¼ºã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalTransactionalInterceptor</span> <span class="keyword">implements</span> <span class="title class_">ConfigurationChangeListener</span>, MethodInterceptor, SeataInterceptor &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GlobalTransactionalInterceptor</span><span class="params">(FailureHandler failureHandler)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.failureHandler = failureHandler == <span class="literal">null</span> ? DEFAULT_FAIL_HANDLER : failureHandler;</span><br><span class="line">        <span class="built_in">this</span>.disable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.DISABLE_GLOBAL_TRANSACTION,</span><br><span class="line">            DEFAULT_DISABLE_GLOBAL_TRANSACTION);</span><br><span class="line">        <span class="built_in">this</span>.order =</span><br><span class="line">            ConfigurationFactory.getInstance().getInt(ConfigurationKeys.TM_INTERCEPTOR_ORDER, TM_INTERCEPTOR_ORDER);</span><br><span class="line">        degradeCheck = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_DEGRADE_CHECK,</span><br><span class="line">            DEFAULT_TM_DEGRADE_CHECK);</span><br><span class="line">        <span class="keyword">if</span> (degradeCheck) &#123;</span><br><span class="line">            ConfigurationCache.addConfigListener(ConfigurationKeys.CLIENT_DEGRADE_CHECK, <span class="built_in">this</span>);</span><br><span class="line">            degradeCheckPeriod = ConfigurationFactory.getInstance()</span><br><span class="line">                .getInt(ConfigurationKeys.CLIENT_DEGRADE_CHECK_PERIOD, DEFAULT_TM_DEGRADE_CHECK_PERIOD);</span><br><span class="line">            degradeCheckAllowTimes = ConfigurationFactory.getInstance()</span><br><span class="line">                .getInt(ConfigurationKeys.CLIENT_DEGRADE_CHECK_ALLOW_TIMES, DEFAULT_TM_DEGRADE_CHECK_ALLOW_TIMES);</span><br><span class="line">            EVENT_BUS.register(<span class="built_in">this</span>);</span><br><span class="line">            <span class="keyword">if</span> (degradeCheckPeriod &gt; <span class="number">0</span> &amp;&amp; degradeCheckAllowTimes &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                startDegradeCheck();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.initDefaultGlobalTransactionTimeout();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(<span class="keyword">final</span> MethodInvocation methodInvocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//è·å–æ‰§è¡Œçš„æ–¹æ³•</span></span><br><span class="line">        Class&lt;?&gt; targetClass =</span><br><span class="line">            methodInvocation.getThis() != <span class="literal">null</span> ? AopUtils.getTargetClass(methodInvocation.getThis()) : <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">specificMethod</span> <span class="operator">=</span> ClassUtils.getMostSpecificMethod(methodInvocation.getMethod(), targetClass);</span><br><span class="line">        <span class="keyword">if</span> (specificMethod != <span class="literal">null</span> &amp;&amp; !specificMethod.getDeclaringClass().equals(Object.class)) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> BridgeMethodResolver.findBridgedMethod(specificMethod);</span><br><span class="line">            <span class="comment">//è·å–GlobalTransactionalï¼ˆå…¨å±€äº‹åŠ¡ï¼‰ã€GlobalLock(å…¨å±€é”)å…ƒæ•°æ®</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">GlobalTransactional</span> <span class="variable">globalTransactionalAnnotation</span> <span class="operator">=</span></span><br><span class="line">                getAnnotation(method, targetClass, GlobalTransactional.class);</span><br><span class="line">            <span class="comment">//GlobalLockä¼šå°†æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œçº³å…¥Seataåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ï¼Œå…±åŒç«äº‰å…¨å±€é”</span></span><br><span class="line">            <span class="comment">//ä¿è¯å…¨å±€äº‹åŠ¡åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œæœ¬åœ°äº‹åŠ¡ä¸å¯ä»¥æ“ä½œå…¨å±€äº‹åŠ¡çš„è®°å½•</span></span><br><span class="line">            <span class="keyword">final</span> <span class="type">GlobalLock</span> <span class="variable">globalLockAnnotation</span> <span class="operator">=</span> getAnnotation(method, targetClass, GlobalLock.class);<span class="comment">//è·å–å…¨å±€é”</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">localDisable</span> <span class="operator">=</span> disable || (degradeCheck &amp;&amp; degradeNum &gt;= degradeCheckAllowTimes);</span><br><span class="line">            <span class="keyword">if</span> (!localDisable) &#123;</span><br><span class="line">                <span class="keyword">if</span> (globalTransactionalAnnotation != <span class="literal">null</span> || <span class="built_in">this</span>.aspectTransactional != <span class="literal">null</span>) &#123;</span><br><span class="line">                    AspectTransactional transactional;</span><br><span class="line">                    <span class="keyword">if</span> (globalTransactionalAnnotation != <span class="literal">null</span>) &#123;</span><br><span class="line">                        transactional = <span class="keyword">new</span> <span class="title class_">AspectTransactional</span>(globalTransactionalAnnotation.timeoutMills(),</span><br><span class="line">                            globalTransactionalAnnotation.name(), globalTransactionalAnnotation.rollbackFor(),</span><br><span class="line">                            globalTransactionalAnnotation.noRollbackForClassName(),</span><br><span class="line">                            globalTransactionalAnnotation.noRollbackFor(),</span><br><span class="line">                            globalTransactionalAnnotation.noRollbackForClassName(),</span><br><span class="line">                            globalTransactionalAnnotation.propagation(),</span><br><span class="line">                            globalTransactionalAnnotation.lockRetryInterval(),</span><br><span class="line">                            globalTransactionalAnnotation.lockRetryTimes());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        transactional = <span class="built_in">this</span>.aspectTransactional;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//æ‰§è¡Œå…¨å±€äº‹åŠ¡</span></span><br><span class="line">                    <span class="keyword">return</span> handleGlobalTransaction(methodInvocation, transactional);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (globalLockAnnotation != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//æ‰§è¡Œå…¨å±€é”</span></span><br><span class="line">                    <span class="keyword">return</span> handleGlobalLock(methodInvocation, globalLockAnnotation);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> methodInvocation.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“æµç¨‹å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/45838801f4caeefec5623a955be68146.png" alt="img"></p>
<h2 id="æ ¸å¿ƒæºç "><a class="markdownIt-Anchor" href="#æ ¸å¿ƒæºç ">#</a> æ ¸å¿ƒæºç </h2>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬è®²è§£åˆ°  <code>GlobalTransactionalInterceptor</code>  ä½œä¸ºå…¨å±€äº‹åŠ¡æ‹¦æˆªå™¨ï¼Œä¸€æ—¦æ‰§è¡Œæ‹¦æˆªï¼Œå°±ä¼šè¿›å…¥ invoke æ–¹æ³•ï¼Œå…¶ä¸­ï¼Œæˆ‘ä»¬ä¼šåš  <code>@GlobalTransactional</code>  æ³¨è§£çš„åˆ¤æ–­ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ³¨è§£çš„å­˜åœ¨ï¼Œä¼šæ‰§è¡Œå…¨å±€äº‹åŠ¡å’Œå…¨å±€é”ï¼Œå†æ‰§è¡Œå…¨å±€äº‹åŠ¡çš„æ—¶å€™ä¼šè°ƒç”¨  <code>handleGlobalTransaction</code>  å…¨å±€äº‹åŠ¡å¤„ç†å™¨ï¼Œè·å–äº‹åŠ¡ä¿¡æ¯ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±æ¥çœ‹ä¸€ä¸‹  <code>GlobalTransactionalInterceptor.handleGlobalTransaction</code>  åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œå…¨å±€äº‹åŠ¡çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">Object <span class="title function_">handleGlobalTransaction</span><span class="params">(<span class="keyword">final</span> MethodInvocation methodInvocation,</span></span><br><span class="line"><span class="params">        <span class="keyword">final</span> AspectTransactional aspectTransactional)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">succeed</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> transactionalTemplate.execute(<span class="keyword">new</span> <span class="title class_">TransactionalExecutor</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> Object <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="keyword">return</span> methodInvocation.proceed();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//è·å–äº‹åŠ¡åç§°ï¼Œé»˜è®¤è·å–æ–¹æ³•å</span></span><br><span class="line">                <span class="keyword">public</span> String <span class="title function_">name</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> aspectTransactional.getName();</span><br><span class="line">                    <span class="keyword">if</span> (!StringUtils.isNullOrEmpty(name)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> name;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> formatMethod(methodInvocation.getMethod());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">/**</span></span><br><span class="line"><span class="comment">                 * è§£æGlobalTransationæ³¨è§£å±æ€§ï¼Œå°è£…å¯¹å¯¹è±¡</span></span><br><span class="line"><span class="comment">                 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> TransactionInfo <span class="title function_">getTransactionInfo</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="comment">// reset the value of timeout</span></span><br><span class="line">                    <span class="comment">//è·å–è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤60ç§’</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">timeout</span> <span class="operator">=</span> aspectTransactional.getTimeoutMills();</span><br><span class="line">                    <span class="keyword">if</span> (timeout &lt;= <span class="number">0</span> || timeout == DEFAULT_GLOBAL_TRANSACTION_TIMEOUT) &#123;</span><br><span class="line">                        timeout = defaultGlobalTransactionTimeout;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//æ„å»ºäº‹åŠ¡ä¿¡æ¯å¯¹è±¡</span></span><br><span class="line">                    <span class="type">TransactionInfo</span> <span class="variable">transactionInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionInfo</span>();</span><br><span class="line">                    transactionInfo.setTimeOut(timeout);<span class="comment">//è¶…æ—¶æ—¶é—´</span></span><br><span class="line">                    transactionInfo.setName(name());<span class="comment">//äº‹åŠ¡åç§°</span></span><br><span class="line">                    transactionInfo.setPropagation(aspectTransactional.getPropagation());<span class="comment">//äº‹åŠ¡ä¼ æ’­</span></span><br><span class="line">                    transactionInfo.setLockRetryInterval(aspectTransactional.getLockRetryInterval());<span class="comment">//æ ¡éªŒæˆ–å ç”¨å…¨å±€é”é‡è¯•é—´éš”</span></span><br><span class="line">                    transactionInfo.setLockRetryTimes(aspectTransactional.getLockRetryTimes());<span class="comment">//æ ¡éªŒæˆ–å ç”¨å…¨å±€é”é‡è¯•æ¬¡æ•°</span></span><br><span class="line">                    Set&lt;RollbackRule&gt; rollbackRules = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">                    <span class="comment">//å…¶ä»–æ„å»ºä¿¡æ¯</span></span><br><span class="line">                    <span class="keyword">for</span> (Class&lt;?&gt; rbRule : aspectTransactional.getRollbackFor()) &#123;</span><br><span class="line">                        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">RollbackRule</span>(rbRule));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> (String rbRule : aspectTransactional.getRollbackForClassName()) &#123;</span><br><span class="line">                        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">RollbackRule</span>(rbRule));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> (Class&lt;?&gt; rbRule : aspectTransactional.getNoRollbackFor()) &#123;</span><br><span class="line">                        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">NoRollbackRule</span>(rbRule));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span> (String rbRule : aspectTransactional.getNoRollbackForClassName()) &#123;</span><br><span class="line">                        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">NoRollbackRule</span>(rbRule));</span><br><span class="line">                    &#125;</span><br><span class="line">                    transactionInfo.setRollbackRules(rollbackRules);</span><br><span class="line">                    <span class="keyword">return</span> transactionInfo;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (TransactionalExecutor.ExecutionException e) &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œå¼‚å¸¸</span></span><br><span class="line">            TransactionalExecutor.<span class="type">Code</span> <span class="variable">code</span> <span class="operator">=</span> e.getCode();</span><br><span class="line">            <span class="keyword">switch</span> (code) &#123;</span><br><span class="line">                <span class="keyword">case</span> RollbackDone:</span><br><span class="line">                    <span class="keyword">throw</span> e.getOriginalException();</span><br><span class="line">                <span class="keyword">case</span> BeginFailure:</span><br><span class="line">                    succeed = <span class="literal">false</span>;</span><br><span class="line">                    failureHandler.onBeginFailure(e.getTransaction(), e.getCause());</span><br><span class="line">                    <span class="keyword">throw</span> e.getCause();</span><br><span class="line">                <span class="keyword">case</span> CommitFailure:</span><br><span class="line">                    succeed = <span class="literal">false</span>;</span><br><span class="line">                    failureHandler.onCommitFailure(e.getTransaction(), e.getCause());</span><br><span class="line">                    <span class="keyword">throw</span> e.getCause();</span><br><span class="line">                <span class="keyword">case</span> RollbackFailure:</span><br><span class="line">                    failureHandler.onRollbackFailure(e.getTransaction(), e.getOriginalException());</span><br><span class="line">                    <span class="keyword">throw</span> e.getOriginalException();</span><br><span class="line">                <span class="keyword">case</span> RollbackRetrying:</span><br><span class="line">                    failureHandler.onRollbackRetrying(e.getTransaction(), e.getOriginalException());</span><br><span class="line">                    <span class="keyword">throw</span> e.getOriginalException();</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShouldNeverHappenException</span>(String.format(<span class="string">&quot;Unknown TransactionalExecutor.Code: %s&quot;</span>, code));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (degradeCheck) &#123;</span><br><span class="line">                EVENT_BUS.post(<span class="keyword">new</span> <span class="title class_">DegradeCheckEvent</span>(succeed));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬ï¼Œä¸»è¦å…³æ³¨ä¸€ä¸ªé‡ç‚¹æ–¹æ³•  <code>execute()</code> ï¼Œè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨æ¥æ‰§è¡Œäº‹åŠ¡çš„å…·ä½“æµç¨‹ï¼š</p>
<ul>
<li>è·å–äº‹åŠ¡ä¿¡æ¯</li>
<li>æ‰§è¡Œå…¨å±€äº‹åŠ¡</li>
<li>å‘ç”Ÿå¼‚å¸¸å…¨å±€å›æ»šï¼Œå„ä¸ªæ•°æ®é€šè¿‡ UndoLog è¿›è¡Œäº‹åŠ¡è¡¥å¿</li>
<li>å…¨å±€äº‹åŠ¡æäº¤</li>
<li>æ¸…é™¤æ‰€æœ‰èµ„æº</li>
</ul>
<p>è¿™ä¸ªä½ç½®ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æ ¸å¿ƒçš„ä¸€ä¸ªä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬æ‰€æœ‰çš„ä¸šåŠ¡è¿›æ¥ä»¥åéƒ½ä¼šå»èµ°è¿™ä¸ªä½ç½®ï¼Œå…·ä½“æºç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">execute</span><span class="params">(TransactionalExecutor business)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// 1. Get transactionInfo</span></span><br><span class="line">    <span class="comment">//è·å–äº‹åŠ¡ä¿¡æ¯</span></span><br><span class="line">    <span class="type">TransactionInfo</span> <span class="variable">txInfo</span> <span class="operator">=</span> business.getTransactionInfo();</span><br><span class="line">    <span class="keyword">if</span> (txInfo == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShouldNeverHappenException</span>(<span class="string">&quot;transactionInfo does not exist&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 1.1 Get current transaction, if not null, the tx role is &#x27;GlobalTransactionRole.Participant&#x27;.</span></span><br><span class="line">    <span class="comment">//è·å–å½“å‰äº‹åŠ¡ï¼Œä¸»è¦è·å–XID</span></span><br><span class="line">    <span class="type">GlobalTransaction</span> <span class="variable">tx</span> <span class="operator">=</span> GlobalTransactionContext.getCurrent();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2 Handle the transaction propagation.</span></span><br><span class="line">    <span class="comment">//æ ¹æ®é…ç½®çš„ä¸åŒäº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Œæ‰§è¡Œä¸åŒçš„é€»è¾‘</span></span><br><span class="line">    <span class="type">Propagation</span> <span class="variable">propagation</span> <span class="operator">=</span> txInfo.getPropagation();</span><br><span class="line">    <span class="type">SuspendedResourcesHolder</span> <span class="variable">suspendedResourcesHolder</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (propagation) &#123;</span><br><span class="line">            <span class="keyword">case</span> NOT_SUPPORTED:</span><br><span class="line">                <span class="comment">// If transaction is existing, suspend it.</span></span><br><span class="line">                <span class="keyword">if</span> (existingTransaction(tx)) &#123;</span><br><span class="line">                    suspendedResourcesHolder = tx.suspend();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Execute without transaction and return.</span></span><br><span class="line">                <span class="keyword">return</span> business.execute();</span><br><span class="line">            <span class="keyword">case</span> REQUIRES_NEW:</span><br><span class="line">                <span class="comment">// If transaction is existing, suspend it, and then begin new transaction.</span></span><br><span class="line">                <span class="keyword">if</span> (existingTransaction(tx)) &#123;</span><br><span class="line">                    suspendedResourcesHolder = tx.suspend();</span><br><span class="line">                    tx = GlobalTransactionContext.createNew();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Continue and execute with new transaction</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> SUPPORTS:</span><br><span class="line">                <span class="comment">// If transaction is not existing, execute without transaction.</span></span><br><span class="line">                <span class="keyword">if</span> (notExistingTransaction(tx)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> business.execute();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Continue and execute with new transaction</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> REQUIRED:</span><br><span class="line">                <span class="comment">// If current transaction is existing, execute with current transaction,</span></span><br><span class="line">                <span class="comment">// else continue and execute with new transaction.</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> NEVER:</span><br><span class="line">                <span class="comment">// If transaction is existing, throw exception.</span></span><br><span class="line">                <span class="keyword">if</span> (existingTransaction(tx)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransactionException</span>(</span><br><span class="line">                        String.format(<span class="string">&quot;Existing transaction found for transaction marked with propagation &#x27;never&#x27;, xid = %s&quot;</span></span><br><span class="line">                                , tx.getXid()));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Execute without transaction and return.</span></span><br><span class="line">                    <span class="keyword">return</span> business.execute();</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">case</span> MANDATORY:</span><br><span class="line">                <span class="comment">// If transaction is not existing, throw exception.</span></span><br><span class="line">                <span class="keyword">if</span> (notExistingTransaction(tx)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransactionException</span>(<span class="string">&quot;No existing transaction found for transaction marked with propagation &#x27;mandatory&#x27;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// Continue and execute with current transaction.</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransactionException</span>(<span class="string">&quot;Not Supported Propagation:&quot;</span> + propagation);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.3 If null, create new transaction with role &#x27;GlobalTransactionRole.Launcher&#x27;.</span></span><br><span class="line">        <span class="comment">//å¦‚æœå½“å‰äº‹åŠ¡ä¸ºç©ºï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> (tx == <span class="literal">null</span>) &#123;</span><br><span class="line">            tx = GlobalTransactionContext.createNew();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set current tx config to holder</span></span><br><span class="line">        <span class="type">GlobalLockConfig</span> <span class="variable">previousConfig</span> <span class="operator">=</span> replaceGlobalLockConfig(txInfo);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 2. If the tx role is &#x27;GlobalTransactionRole.Launcher&#x27;, send the request of beginTransaction to TC,</span></span><br><span class="line">            <span class="comment">//    else do nothing. Of course, the hooks will still be triggered.</span></span><br><span class="line">            <span class="comment">//å¼€å§‹æ‰§è¡Œå…¨å±€äº‹åŠ¡</span></span><br><span class="line">            beginTransaction(txInfo, tx);</span><br><span class="line"></span><br><span class="line">            Object rs;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// Do Your Business</span></span><br><span class="line">                <span class="comment">// æ‰§è¡Œå½“å‰ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                <span class="comment">//1ã€åœ¨TCæ³¨å†Œå½“å‰åˆ†æ”¯äº‹åŠ¡ï¼ŒTCä¼šåœ¨branch_tableä¸­æ’å…¥ä¸€æ¡åˆ†æ”¯äº‹åŠ¡æ•°æ®</span></span><br><span class="line">                <span class="comment">//2ã€æ‰§è¡Œæœ¬åœ°updateè¯­å¥ï¼Œå¹¶åœ¨æ‰§è¡Œå‰åæŸ¥è¯¢æ•°æ®çŠ¶æ€ï¼Œå¹¶æŠŠæ•°æ®å‰åé•œåƒå­˜å…¥åˆ°undo_logä¸­</span></span><br><span class="line">                <span class="comment">//3ã€è¿œç¨‹è°ƒç”¨å…¶ä»–åº”ç”¨ï¼Œè¿œç¨‹åº”ç”¨æ¥æ”¶åˆ°XIDï¼Œä¹Ÿä¼šæ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå†™å…¥branch_tableä»¥åŠæœ¬åœ°undo_logè¡¨</span></span><br><span class="line">                <span class="comment">//4ã€ä¼šåœ¨lock_tableè¡¨ä¸­æ’å…¥å…¨å±€é”æ•°æ®ï¼ˆä¸€ä¸ªåˆ†æ”¯ä¸€æ¡ï¼‰</span></span><br><span class="line">                rs = business.execute();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                <span class="comment">// 3. The needed business exception to rollback.</span></span><br><span class="line">                <span class="comment">//å‘ç”Ÿå¼‚å¸¸å…¨å±€å›æ»šï¼Œæ¯ä¸ªäº‹åŠ¡é€šè¿‡undo_logè¡¨è¿›è¡Œäº‹åŠ¡è¡¥å¿</span></span><br><span class="line">                completeTransactionAfterThrowing(txInfo, tx, ex);</span><br><span class="line">                <span class="keyword">throw</span> ex;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. everything is fine, commit.</span></span><br><span class="line">            <span class="comment">//å…¨å±€æäº¤</span></span><br><span class="line">            commitTransaction(tx);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> rs;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//5. clear</span></span><br><span class="line">            <span class="comment">//æ¸…ç†æ‰€æœ‰èµ„æº</span></span><br><span class="line">            resumeGlobalLockConfig(previousConfig);</span><br><span class="line">            triggerAfterCompletion();</span><br><span class="line">            cleanUp();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// If the transaction is suspended, resume it.</span></span><br><span class="line">        <span class="keyword">if</span> (suspendedResourcesHolder != <span class="literal">null</span>) &#123;</span><br><span class="line">            tx.resume(suspendedResourcesHolder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™å…¶ä¸­çš„ç¬¬ä¸‰æ­¥å’Œç¬¬å››æ­¥å…¶å®åœ¨å‘ TCï¼ˆSeata-Serverï¼‰å‘èµ·å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–è€…å›æ»šï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå…³æ³¨æ‰§è¡Œå…¨å±€äº‹åŠ¡çš„  <code>beginTransaction()</code>  æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘TCå‘èµ·è¯·æ±‚ï¼Œé‡‡ç”¨æ¨¡æ¿æ¨¡å¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">beginTransaction</span><span class="params">(TransactionInfo txInfo, GlobalTransaction tx)</span> <span class="keyword">throws</span> TransactionalExecutor.ExecutionException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        triggerBeforeBegin();</span><br><span class="line">        <span class="comment">//å¯¹TCå‘èµ·è¯·æ±‚</span></span><br><span class="line">        tx.begin(txInfo.getTimeOut(), txInfo.getName());</span><br><span class="line">        triggerAfterBegin();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TransactionException txe) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TransactionalExecutor</span>.ExecutionException(tx, txe,</span><br><span class="line">            TransactionalExecutor.Code.BeginFailure);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¥å…³æ³¨å…¶ä¸­ï¼Œå‘ TC å‘èµ·è¯·æ±‚çš„  <code>tx.begin()</code>  æ–¹æ³•ï¼Œè€Œè°ƒç”¨ <code>begin()</code>  æ–¹æ³•çš„ç±»ä¸ºï¼š <code>DefaultGlobalTransaction</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">(<span class="type">int</span> timeout, String name)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">       <span class="comment">//åˆ¤æ–­è°ƒç”¨è€…æ˜¯å¦ä¸ºTM</span></span><br><span class="line">       <span class="keyword">if</span> (role != GlobalTransactionRole.Launcher) &#123;</span><br><span class="line">           assertXIDNotNull();</span><br><span class="line">           <span class="keyword">if</span> (LOGGER.isDebugEnabled()) &#123;</span><br><span class="line">               LOGGER.debug(<span class="string">&quot;Ignore Begin(): just involved in global transaction [&#123;&#125;]&quot;</span>, xid);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       assertXIDNull();</span><br><span class="line">       <span class="type">String</span> <span class="variable">currentXid</span> <span class="operator">=</span> RootContext.getXID();</span><br><span class="line">       <span class="keyword">if</span> (currentXid != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;Global transaction already exists,&quot;</span> +</span><br><span class="line">               <span class="string">&quot; can&#x27;t begin a new global transaction, currentXid = &quot;</span> + currentXid);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//è·å–XID</span></span><br><span class="line">       xid = transactionManager.begin(<span class="literal">null</span>, <span class="literal">null</span>, name, timeout);</span><br><span class="line">       status = GlobalStatus.Begin;</span><br><span class="line">       <span class="comment">//ç»‘å®šXID</span></span><br><span class="line">       RootContext.bind(xid);</span><br><span class="line">       <span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">           LOGGER.info(<span class="string">&quot;Begin new global transaction [&#123;&#125;]&quot;</span>, xid);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¥çœ‹ä¸€ä¸‹  <code>transactionManager.begin()</code>  æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨çš„æ˜¯  <code>DefaultTransactionManager.begin</code>  é»˜è®¤çš„äº‹åŠ¡ç®¡ç†è€…ï¼Œæ¥è·å– XIDï¼Œä¼ å…¥äº‹åŠ¡ç›¸å…³çš„ä¿¡æ¯ ï¼Œæœ€å¥½ TC è¿”å›å¯¹åº”çš„å…¨å±€äº‹åŠ¡ XIDï¼Œå®ƒè°ƒç”¨çš„æ˜¯ <code>DefaultTransactionManager.begin()</code>  æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">begin</span><span class="params">(String applicationId, String transactionServiceGroup, String name, <span class="type">int</span> timeout)</span></span><br><span class="line">    <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="type">GlobalBeginRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GlobalBeginRequest</span>();</span><br><span class="line">    request.setTransactionName(name);</span><br><span class="line">    request.setTimeout(timeout);</span><br><span class="line">    <span class="comment">//å‘é€è¯·æ±‚å¾—åˆ°å“åº”</span></span><br><span class="line">    <span class="type">GlobalBeginResponse</span> <span class="variable">response</span> <span class="operator">=</span> (GlobalBeginResponse) syncCall(request);</span><br><span class="line">    <span class="keyword">if</span> (response.getResultCode() == ResultCode.Failed) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TmTransactionException</span>(TransactionExceptionCode.BeginFailed, response.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è¿”å›XID</span></span><br><span class="line">    <span class="keyword">return</span> response.getXid();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸ª <code>syncCall</code> ï¼Œåœ¨è¿™é‡Œé‡‡ç”¨çš„æ˜¯ Netty é€šè®¯æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> AbstractTransactionResponse <span class="title function_">syncCall</span><span class="params">(AbstractTransactionRequest request)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é€šè¿‡Nettyå‘é€è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">return</span> (AbstractTransactionResponse) TmNettyRemotingClient.getInstance().sendSyncRequest(request);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (TimeoutException toe) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TmTransactionException</span>(TransactionExceptionCode.IO, <span class="string">&quot;RPC timeout&quot;</span>, toe);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å›¾è§£å¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/58f1038f3648c3d95be79c183eb151b6.png" alt="img"></p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦é‡ç‚¹äº†è§£  <code>GlobalTransactionScanner</code>  è¿™ä¸ªç±»å‹ï¼Œåœ¨è¿™ä¸ªç±»å‹ä¸­ç»§æ‰¿äº†ä¸€äº›æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œè¿™ä¸ªç±»ä¸»è¦ä½œç”¨å°±æ˜¯æ‰«ææœ‰æ³¨è§£çš„ Beanï¼Œå¹¶åš AOP å¢å¼ºã€‚</p>
<ul>
<li><code>ApplicationContextAware</code> ï¼šç»§æ‰¿è¿™ä¸ªç±»å‹ä»¥åï¼Œéœ€è¦å®ç°å…¶æ–¹æ³•  <code>setApplicationContext()</code> ï¼Œå½“ Spring å¯åŠ¨å®Œæˆä»¥åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªç±»å‹ï¼Œå°†  <code>ApplicationContext</code>  ç»™  <code>bean</code> ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ  <code>GlobalTransactionScanner</code>  èƒ½å¤Ÿå¾ˆè‡ªç„¶çš„ä½¿ç”¨ Spring ç¯å¢ƒ</li>
<li><code>InitializingBean</code> ï¼š ç»§æ‰¿è¿™ä¸ªæ¥å£ï¼Œéœ€è¦å®ç°  <code>afterPropertiesSet()</code>  ï¼Œä½†å‡¡æ˜¯ç»§æ‰¿è¿™ä¸ªæ¥å£çš„ç±»ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå½“æ‰€æœ‰çš„  <code>properties</code>  è®¾ç½®å®Œæˆä»¥åï¼Œä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•</li>
<li><code>DisposableBean</code>  ï¼š è¿™ä¸ªç±»ï¼Œå®ç°äº†ä¸€ä¸ª  <code>destroy()</code>  è¿™ä¸ªæ–¹æ³•æ˜¯åœ¨é”€æ¯çš„æ—¶å€™å»è°ƒç”¨</li>
<li><code>AbstractAutoProxyCreator</code> ï¼š è¿™ä¸ªç±»æ˜¯ Spring å®ç° AOP çš„ä¸€ç§æ–¹å¼ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª  <code>BeanPostProcessor</code>  ï¼Œåœ¨ Bean åˆå§‹åŒ–è‡³å»å¹´ï¼Œè°ƒç”¨å†…éƒ¨  <code>createProxy()</code>  ï¼Œåˆ›å»ºä¸€ä¸ª Bean çš„ AOP ä»£ç† Bean å¹¶è¿”å›ï¼Œå¯¹ Bean è¿›è¡Œå¢å¼ºã€‚</li>
</ul>
<h2 id="seataæ•°æ®æºä»£ç†"><a class="markdownIt-Anchor" href="#seataæ•°æ®æºä»£ç†">#</a> Seata æ•°æ®æºä»£ç†</h2>
<p>åœ¨ä¸Šé¢çš„ç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº† Seata AT æ¨¡å¼ 2PC çš„æ‰§è¡Œæµç¨‹ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å°±æ¥å¸¦å¤§å®¶äº†è§£ä¸€ä¸‹å…³äº AT æ•°æ®æºä»£ç†çš„ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯ AT æ¨¡å¼ä¸­éå¸¸å…³é”®çš„ä¸€ä¸ªé‡è¦çŸ¥è¯†ç‚¹ï¼Œå¤§å®¶å¯ä»¥æ‹¿èµ·å°æœ¬å­ï¼Œè®°ä¸‹æ¥ã€‚</p>
<p>é¦–å…ˆ AT æ¨¡å¼çš„æ ¸å¿ƒä¸»è¦åˆ†ä¸ºä¸€ä¸‹ä¸¤ä¸ª</p>
<ul>
<li>å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œè·å–å…¨å±€é”ã€‚</li>
<li>è§£æ SQL å¹¶å†™å…¥ undoLog ä¸­ã€‚</li>
</ul>
<p>å…³äºç¬¬ä¸€ç‚¹æˆ‘ä»¬å·²ç»åˆ†ææ¸…æ¥šäº†ï¼Œç¬¬äºŒç‚¹å°±æ˜¯å…³äº AT æ¨¡å¼å¦‚ä½•è§£æ SQL å¹¶å†™å…¥ undoLog ä¸­ï¼Œä½†æ˜¯åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ Seata æ˜¯å¦‚ä½•é€‰æ‹©æ•°æ®æºï¼Œå¹¶è¿›è¡Œæ•°æ®æºä»£ç†çš„ã€‚è™½ç„¶å…¨å±€äº‹åŠ¡æ‹¦æˆªæˆåŠŸåæœ€ç»ˆè¿˜æ˜¯æ‰§è¡Œäº†ä¸šåŠ¡æ–¹æ³•è¿›è¡Œ SQL æäº¤å’Œæ“ä½œï¼Œä½†æ˜¯ç”±äº Seata å¯¹æ•°æ®æºè¿›è¡Œäº†ä»£ç†ï¼Œæ‰€ä»¥ SQL çš„è§£æå’Œ undoLog çš„æ“ä½œï¼Œæ˜¯åœ¨æ•°æ®æºä»£ç†ä¸­è¿›è¡Œå®Œæˆçš„ã€‚</p>
<p>æ•°æ®æºä»£ç†æ˜¯ Seata ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œåœ¨<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1&amp;spm=1001.2101.3001.7020">åˆ†å¸ƒå¼äº‹åŠ¡</a>è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒundoLog çš„è®°å½•ã€èµ„æºçš„é”å®šï¼Œç”¨æˆ·éƒ½æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå› ä¸ºè¿™äº›æ“ä½œéƒ½æ˜¯æ•°æ®æºçš„ä»£ç†ä¸­å®Œæˆäº†ï¼Œæ°æ°æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬æ‰è¦å»äº†è§£ï¼Œè¿™æ ·ä¸ä»…æœ‰åˆ©äºæˆ‘ä»¬äº†è§£ Seata çš„æ ¸å¿ƒæ“ä½œï¼Œè¿˜èƒ½å¯¹ä»¥åæºç é˜…è¯»æœ‰æ‰€å¸®åŠ©ï¼Œå› ä¸ºå…¶å®å¾ˆå¤šåº•å±‚ä»£ç éƒ½ä¼šå»ä½¿ç”¨è¿™æ ·ç”¨æˆ·æ— æ„ŸçŸ¥çš„æ–¹å¼ (ä»£ç†) å»å®ç°ã€‚</p>
<p>åŒæ ·ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„å¯»æ‰¾æºç å…¥å£çš„æ—¶å€™ï¼Œé€šè¿‡æˆ‘ä»¬é¡¹ç›®ä¸­å¼•å…¥çš„ jar æ‰¾åˆ°ä¸€ä¸ª  <code>SeataAutoConfiguration</code>  ç±»ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢æ‰¾åˆ°ä¸€ä¸ª <code>SeataDataSourceBeanPostProcessor()</code> ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ•°æ®æºä»£ç†çš„å…¥å£æ–¹æ³•</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/78c4564099e2c372a310458314d545e9.png" alt="img"></p>
<p>æˆ‘ä»¬è¿›å…¥ <code>SeataDataSourceBeanPostProcessor</code>  ç±»é‡Œé¢ï¼Œå‘ç°ç»§æ‰¿äº†ä¸€ä¸ª  <code>BeanPostProcessor</code>  , è¿™ä¸ªæ¥å£æˆ‘ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªæ˜¯ Sprng çš„æ‹“å±•æ¥å£ï¼Œæ‰€æœ‰çš„ Bean å¯¹è±¡ï¼Œéƒ½æœ‰è¿›å…¥ä¸¤ä¸ªæ–¹æ³•  <code>postProcessAfterInitialization()</code>  å’Œ  <code>postProcessBeforeInitialization()</code>  è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ç”±  <code>BeanPostProcessor</code>  æä¾›çš„ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œ <code>Before</code> ã€‚ä¸€ä¸ªæ˜¯åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œ <code>After</code> ï¼Œä¸»è¦ç”¨æ¥å¯¹æ¯”æˆ‘ä»¬çš„çš„ Bean æ˜¯å¦ä¸ºæ•°æ®æºä»£ç†å¯¹è±¡ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨åˆ°ä¸€ä¸ª <code>postProcessAfterInitialization.proxyDataSource()</code>  æ–¹æ³•ï¼Œè¿™ä¸ªé‡Œé¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">proxyDataSource</span><span class="params">(Object originBean)</span> &#123;</span><br><span class="line">    <span class="type">DataSourceProxy</span> <span class="variable">dataSourceProxy</span> <span class="operator">=</span> DataSourceProxyHolder.get().putDataSource((DataSource) originBean);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.useJdkProxy) &#123;</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), SpringProxyUtils.getAllInterfaces(originBean), (proxy, method, args) -&gt; handleMethodProxy(dataSourceProxy, method, args, originBean));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Enhancer.create(originBean.getClass(), (MethodInterceptor) (proxy, method, args, methodProxy) -&gt; handleMethodProxy(dataSourceProxy, method, args, originBean));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ª <code>DataSourceProxy</code>  ä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦çœ‹çš„å°±æ˜¯è¿™ä¸ªç±»ï¼Œè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬æ•°æ®åº“ä»£ç†çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä»æˆ‘ä»¬ä¸‹è½½çš„æºç é¡¹ç›®ä¸­ï¼Œæœç´¢è¿™ä¸ªä»£ç†å¯¹è±¡ï¼Œå½“æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªç±»çš„ç›®å½•æ—¶å‘ç°ï¼Œé™¤äº†è¿™ä¸ªï¼Œè¿˜æœ‰ <code>ConnectionProxy</code>  è¿æ¥å¯¹è±¡ã€ <code>StatementProxy</code> ã€ <code>PreparedStatementProxy</code>  SQL æ‰§è¡Œå¯¹è±¡ï¼Œè¿™äº›éƒ½è¢« Seata è¿›è¡Œäº†ä»£ç†ï¼Œä¸ºä»€ä¹ˆè¦å¯¹è¿™äº›éƒ½è¿›è¡Œä»£ç†ï¼Œä»£ç†çš„ç›®çš„å…¶å®ä¸ºäº†æ‰§è¡Œ Seata çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”Ÿæˆ undoLogï¼Œå…¨å±€äº‹åŠ¡çš„å¼€å¯ï¼Œäº‹åŠ¡çš„æäº¤å›æ»šç­‰æ“ä½œ</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ef54a9c5142d96cf230b7938f60a9145.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">DataSourceProxy` å…·ä½“åšäº†ä»€ä¹ˆï¼Œä¸»è¦åŠŸèƒ½æœ‰å“ªäº›ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚ä»–åœ¨æºç ä¸­æ˜¯å¦‚ä½•ä½“ç°çš„ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ˜¯`init()</span><br><span class="line">public class DataSourceProxy extends AbstractDataSourceProxy implements Resource &#123;</span><br><span class="line"></span><br><span class="line">    private String resourceGroupId;</span><br><span class="line"></span><br><span class="line">    private void init(DataSource dataSource, String resourceGroupId) &#123;</span><br><span class="line">        //èµ„æºç»„IDï¼Œé»˜è®¤æ˜¯â€œdefaultâ€è¿™ä¸ªé»˜è®¤å€¼</span><br><span class="line">        this.resourceGroupId = resourceGroupId;</span><br><span class="line">        try (Connection connection = dataSource.getConnection()) &#123;</span><br><span class="line">            //æ ¹æ®åŸå§‹æ•°æ®æºå¾—åˆ°JDBCè¿æ¥å’Œæ•°æ®åº“ç±»å‹</span><br><span class="line">            jdbcUrl = connection.getMetaData().getURL();</span><br><span class="line">            dbType = JdbcUtils.getDbType(jdbcUrl);</span><br><span class="line">            if (JdbcConstants.ORACLE.equals(dbType)) &#123;</span><br><span class="line">                userName = connection.getMetaData().getUserName();</span><br><span class="line">            &#125; else if (JdbcConstants.MARIADB.equals(dbType)) &#123;</span><br><span class="line">                dbType = JdbcConstants.MYSQL;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;can not init dataSource&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        initResourceId();</span><br><span class="line">        DefaultResourceManager.get().registerResource(this);</span><br><span class="line">        if (ENABLE_TABLE_META_CHECKER_ENABLE) &#123;</span><br><span class="line">            //å¦‚æœé…ç½®å¼€å…³æ‰“å¼€ï¼Œä¼šå®šæ—¶åœ¨çº¿ç¨‹æ± ä¸æ–­æ›´æ–°è¡¨çš„å…ƒæ•°æ®ç¼“å­˜ä¿¡æ¯</span><br><span class="line">            tableMetaExecutor.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">                try (Connection connection = dataSource.getConnection()) &#123;</span><br><span class="line">                    TableMetaCacheFactory.getTableMetaCache(DataSourceProxy.this.getDbType())</span><br><span class="line">                        .refresh(connection, DataSourceProxy.this.getResourceId());</span><br><span class="line">                &#125; catch (Exception ignore) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, 0, TABLE_META_CHECKER_INTERVAL, TimeUnit.MILLISECONDS);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //Set the default branch type to &#x27;AT&#x27; in the RootContext.</span><br><span class="line">        RootContext.setDefaultBranchType(this.getBranchType());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä»–ä¸»è¦åšäº†ä»¥ä¸‹å‡ ç‚¹çš„å¢å¼ºï¼š</p>
<ol>
<li>ç»™æ¯ä¸ªæ•°æ®æºæ ‡è¯†èµ„æºç»„ ID</li>
<li>å¦‚æœæ‰“å¼€é…ç½®ï¼Œä¼šæœ‰ä¸€ä¸ªå®šæ—¶çº¿ç¨‹æ± å®šæ—¶æ›´æ–°è¡¨çš„å…ƒæ•°æ®ä¿¡æ¯å¹¶ç¼“å­˜åˆ°æœ¬åœ°</li>
<li>ç”Ÿæˆä»£ç†è¿æ¥  <code>ConnectionProxy</code>  å¯¹è±¡</li>
</ol>
<p>åœ¨è¿™ä¸‰ä¸ªå¢å¼ºåŠŸèƒ½é‡Œé¢ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æœ€é‡è¦çš„ï¼Œåœ¨ AT æ¨¡å¼é‡Œé¢ï¼Œä¼šè‡ªåŠ¨è®°å½• undoLogï¼Œèµ„æºé”å®šï¼Œéƒ½æ˜¯é€šè¿‡ <code>ConnectionProxy</code>  å®Œæˆçš„ï¼Œé™¤æ­¤ä¹‹å¤–  <code>DataSrouceProxy</code>  é‡å†™äº†ä¸€ä¸ªæ–¹æ³•  <code>getConnection</code> ï¼Œå› ä¸ºè¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ª  <code>ConnectionProxy</code> ï¼Œè€Œä¸æ˜¯åŸç”Ÿçš„ <code>Connection</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ConnectionProxy <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">targetConnection</span> <span class="operator">=</span> targetDataSource.getConnection();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConnectionProxy</span>(<span class="built_in">this</span>, targetConnection);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ConnectionProxy <span class="title function_">getConnection</span><span class="params">(String username, String password)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">Connection</span> <span class="variable">targetConnection</span> <span class="operator">=</span> targetDataSource.getConnection(username, password);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConnectionProxy</span>(<span class="built_in">this</span>, targetConnection);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="connectionproxy"><a class="markdownIt-Anchor" href="#connectionproxy">#</a> ConnectionProxy</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ConnectionProxy` ç»§æ‰¿ `AbstractConnectionProxy` ï¼Œåœ¨è¿™ä¸ªçˆ¶ç±»ä¸­æœ‰å¾ˆå¤šå…¬ç”¨çš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªçˆ¶ç±»æœ‰ `PreparedStatementProxy` ã€`StatementProxy` ã€`DataSourceProxy</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f16ce360addfb4ffbc43b040f0493fc5.png" alt="img"></p>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆæ¥çœ‹ä¸€ä¸‹ <code>AbstractConnectionProxy</code> ï¼Œå› ä¸ºè¿™é‡Œå°è£…äº†éœ€è¦æˆ‘ä»¬ç”¨åˆ°çš„é€šç”¨æ–¹æ³•å’Œé€»è¾‘ï¼Œåœ¨å…¶ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çš„ä¸»è¦åœ¨äº  <code>PreparedStatementProxy</code>  å’Œ  <code>StatementProxy</code>  ï¼Œåœ¨è¿™é‡Œçš„é€»è¾‘ä¸»è¦æ˜¯æ•°æ®æºè¿æ¥çš„æ­¥éª¤ï¼Œè¿æ¥è·å–ï¼Œåˆ›å»ºæ‰§è¡Œå¯¹è±¡ç­‰ç­‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Statement <span class="title function_">createStatement</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="comment">//è°ƒç”¨çœŸå®è¿æ¥å¯¹è±¡è·å–Statementå¯¹è±¡</span></span><br><span class="line">    <span class="type">Statement</span> <span class="variable">targetStatement</span> <span class="operator">=</span> getTargetConnection().createStatement();</span><br><span class="line">    <span class="comment">//åˆ›å»ºStatementçš„ä»£ç†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StatementProxy</span>(<span class="built_in">this</span>, targetStatement);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> PreparedStatement <span class="title function_">prepareStatement</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="comment">//è·å–æ•°æ®åº“ç±»å‹ mysql/oracle</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">dbType</span> <span class="operator">=</span> getDbType();</span><br><span class="line">    <span class="comment">// support oracle 10.2+</span></span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">targetPreparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">//å¦‚æœæ˜¯ATæ¨¡å¼ä¸”å¼€å¯å…¨å±€äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (BranchType.AT == RootContext.getBranchType()) &#123;</span><br><span class="line">        List&lt;SQLRecognizer&gt; sqlRecognizers = SQLVisitorFactory.get(sql, dbType);</span><br><span class="line">        <span class="keyword">if</span> (sqlRecognizers != <span class="literal">null</span> &amp;&amp; sqlRecognizers.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">SQLRecognizer</span> <span class="variable">sqlRecognizer</span> <span class="operator">=</span> sqlRecognizers.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (sqlRecognizer != <span class="literal">null</span> &amp;&amp; sqlRecognizer.getSQLType() == SQLType.INSERT) &#123;</span><br><span class="line">                <span class="comment">//è·å–è¡¨çš„å…ƒæ•°æ®</span></span><br><span class="line">                <span class="type">TableMeta</span> <span class="variable">tableMeta</span> <span class="operator">=</span> TableMetaCacheFactory.getTableMetaCache(dbType).getTableMeta(getTargetConnection(),</span><br><span class="line">                        sqlRecognizer.getTableName(), getDataSourceProxy().getResourceId());</span><br><span class="line">                <span class="comment">//å¾—åˆ°è¡¨çš„ä¸»é”®åˆ—å</span></span><br><span class="line">                String[] pkNameArray = <span class="keyword">new</span> <span class="title class_">String</span>[tableMeta.getPrimaryKeyOnlyName().size()];</span><br><span class="line">                tableMeta.getPrimaryKeyOnlyName().toArray(pkNameArray);</span><br><span class="line">                targetPreparedStatement = getTargetConnection().prepareStatement(sql,pkNameArray);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (targetPreparedStatement == <span class="literal">null</span>) &#123;</span><br><span class="line">        targetPreparedStatement = getTargetConnection().prepareStatement(sql);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ›å»ºPreparedStatementProxyä»£ç†</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PreparedStatementProxy</span>(<span class="built_in">this</span>, targetPreparedStatement, sql);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸¤ä¸ªä»£ç†å¯¹è±¡ä¸­ï¼Œéƒ½ç”¨åˆ°äº†ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> ResultSet <span class="title function_">executeQuery</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="built_in">this</span>.targetSQL = sql;</span><br><span class="line">    <span class="keyword">return</span> ExecuteTemplate.execute(<span class="built_in">this</span>, (statement, args) -&gt; statement.executeQuery((String) args[<span class="number">0</span>]), sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">executeUpdate</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="built_in">this</span>.targetSQL = sql;</span><br><span class="line">    <span class="keyword">return</span> ExecuteTemplate.execute(<span class="built_in">this</span>, (statement, args) -&gt; statement.executeUpdate((String) args[<span class="number">0</span>]), sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">execute</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="built_in">this</span>.targetSQL = sql;</span><br><span class="line">    <span class="keyword">return</span> ExecuteTemplate.execute(<span class="built_in">this</span>, (statement, args) -&gt; statement.execute((String) args[<span class="number">0</span>]), sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™äº›æ–¹æ³•ä¸­éƒ½è°ƒç”¨äº†  <code>ExecuteTemplate.execute()</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹åœ¨  <code>ExecuteTemplate</code>  ç±»ä¸­å…·ä½“æ˜¯åšäº†ä»€ä¹ˆæ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExecuteTemplate</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, S <span class="keyword">extends</span> <span class="title class_">Statement</span>&gt; T <span class="title function_">execute</span><span class="params">(List&lt;SQLRecognizer&gt; sqlRecognizers,</span></span><br><span class="line"><span class="params">                                                     StatementProxy&lt;S&gt; statementProxy,</span></span><br><span class="line"><span class="params">                                                     StatementCallback&lt;T, S&gt; statementCallback,</span></span><br><span class="line"><span class="params">                                                     Object... args)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰å…¨å±€é”ï¼Œå¹¶ä¸”ä¸æ˜¯ATæ¨¡å¼ï¼Œç›´æ¥æ‰§è¡ŒSQL</span></span><br><span class="line">        <span class="keyword">if</span> (!RootContext.requireGlobalLock() &amp;&amp; BranchType.AT != RootContext.getBranchType()) &#123;</span><br><span class="line">            <span class="comment">// Just work as original statement</span></span><br><span class="line">            <span class="keyword">return</span> statementCallback.execute(statementProxy.getTargetStatement(), args);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾—åˆ°æ•°æ®åº“ç±»å‹- mysql/oracle</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">dbType</span> <span class="operator">=</span> statementProxy.getConnectionProxy().getDbType();</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(sqlRecognizers)) &#123;</span><br><span class="line">            <span class="comment">//sqlRecognizers ä¸ºSQLè¯­å¥çš„è§£æå™¨ï¼Œè·å–æ‰§è¡Œçš„SQLï¼Œé€šè¿‡å®ƒå¯ä»¥è·å¾—SQLè¯­å¥è¡¨åã€ç›¸å…³çš„åˆ—åã€ç±»å‹ç­‰ä¿¡æ¯ï¼Œæœ€åè§£æå‡ºå¯¹åº”çš„SQLè¡¨è¾¾å¼</span></span><br><span class="line">            sqlRecognizers = SQLVisitorFactory.get(</span><br><span class="line">                    statementProxy.getTargetSQL(),</span><br><span class="line">                    dbType);</span><br><span class="line">        &#125;</span><br><span class="line">        Executor&lt;T&gt; executor;</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(sqlRecognizers)) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœseataæ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„SQLè¯­å¥è§£æå™¨ï¼Œé‚£ä¹ˆä¾¿åˆ›å»ºç®€å•æ‰§è¡Œå™¨PlainExecutor</span></span><br><span class="line">            <span class="comment">//PlainExecutorç›´æ¥ä½¿ç”¨åŸç”Ÿçš„Statmentå¯¹è±¡æ‰§è¡ŒSQL</span></span><br><span class="line">            executor = <span class="keyword">new</span> <span class="title class_">PlainExecutor</span>&lt;&gt;(statementProxy, statementCallback);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (sqlRecognizers.size() == <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="type">SQLRecognizer</span> <span class="variable">sqlRecognizer</span> <span class="operator">=</span> sqlRecognizers.get(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">switch</span> (sqlRecognizer.getSQLType()) &#123;</span><br><span class="line">                    <span class="comment">//æ–°å¢</span></span><br><span class="line">                    <span class="keyword">case</span> INSERT:</span><br><span class="line">                        executor = EnhancedServiceLoader.load(InsertExecutor.class, dbType,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;StatementProxy.class, StatementCallback.class, SQLRecognizer.class&#125;,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;statementProxy, statementCallback, sqlRecognizer&#125;);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="comment">//ä¿®æ”¹</span></span><br><span class="line">                    <span class="keyword">case</span> UPDATE:</span><br><span class="line">                        executor = <span class="keyword">new</span> <span class="title class_">UpdateExecutor</span>&lt;&gt;(statementProxy, statementCallback, sqlRecognizer);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="comment">//åˆ é™¤</span></span><br><span class="line">                    <span class="keyword">case</span> DELETE:</span><br><span class="line">                        executor = <span class="keyword">new</span> <span class="title class_">DeleteExecutor</span>&lt;&gt;(statementProxy, statementCallback, sqlRecognizer);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="comment">//åŠ é”</span></span><br><span class="line">                    <span class="keyword">case</span> SELECT_FOR_UPDATE:</span><br><span class="line">                        executor = <span class="keyword">new</span> <span class="title class_">SelectForUpdateExecutor</span>&lt;&gt;(statementProxy, statementCallback, sqlRecognizer);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="comment">//æ’å…¥åŠ é”</span></span><br><span class="line">                    <span class="keyword">case</span> INSERT_ON_DUPLICATE_UPDATE:</span><br><span class="line">                        <span class="keyword">switch</span> (dbType) &#123;</span><br><span class="line">                            <span class="keyword">case</span> JdbcConstants.MYSQL:</span><br><span class="line">                            <span class="keyword">case</span> JdbcConstants.MARIADB:</span><br><span class="line">                                executor =</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">MySQLInsertOrUpdateExecutor</span>(statementProxy, statementCallback, sqlRecognizer);</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            <span class="keyword">default</span>:</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotSupportYetException</span>(dbType + <span class="string">&quot; not support to INSERT_ON_DUPLICATE_UPDATE&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                        <span class="comment">//åŸç”Ÿ</span></span><br><span class="line">                    <span class="keyword">default</span>:</span><br><span class="line">                        executor = <span class="keyword">new</span> <span class="title class_">PlainExecutor</span>&lt;&gt;(statementProxy, statementCallback);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æ‰¹é‡å¤„ç†SQLè¯­å¥</span></span><br><span class="line">                executor = <span class="keyword">new</span> <span class="title class_">MultiExecutor</span>&lt;&gt;(statementProxy, statementCallback, sqlRecognizers);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        T rs;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">            rs = executor.execute(args);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(ex <span class="keyword">instanceof</span> SQLException)) &#123;</span><br><span class="line">                <span class="comment">// Turn other exception into SQLException</span></span><br><span class="line">                ex = <span class="keyword">new</span> <span class="title class_">SQLException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> (SQLException) ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨  <code>ExecuteTemplate</code>  å°±ä¸€ä¸ª  <code>execute()</code> ï¼ŒSeata å°† SQL æ‰§è¡Œå§”æ‰˜ç»™ä¸åŒçš„æ‰§è¡Œå™¨ (æ¨¡æ¿)ï¼ŒSeata æä¾›äº† 6 ç§æ‰§è¡Œå™¨ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä»£ç  case ä¸­ï¼ˆ <code>INSERT</code> ï¼Œ <code>UPDATE</code> ï¼Œ <code>DELETE</code> ï¼Œ <code>SELECT_FOR_UPDATE</code> , <code>INSERT_ON_DUPLICATE_UPDATE</code> ï¼‰ï¼Œè¿™äº›æ‰§è¡Œå™¨çš„çˆ¶ç±»éƒ½æ˜¯ <code>AbstractDMLBaseExecutor</code></p>
<ul>
<li><code>UpdateExecutor</code> : æ‰§è¡Œ update è¯­å¥</li>
<li><code>InsertExecutor</code> : æ‰§è¡Œ insert è¯­å¥</li>
<li><code>DeleteExecutor</code> : æ‰§è¡Œ delete è¯­å¥</li>
<li><code>SelectForUpdateExecutor</code> : æ‰§è¡Œ select for update è¯­å¥</li>
<li><code>PlainExecutor</code> : æ‰§è¡Œæ™®é€šæŸ¥è¯¢è¯­å¥</li>
<li><code>MultiExecutor</code> : å¤åˆæ‰§è¡Œå™¨ï¼Œåœ¨ä¸€æ¡ SQL è¯­å¥ä¸­æ‰§è¡Œå¤šæ¡è¯­å¥</li>
</ul>
<p>å…³ç³»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f16af649be708d3642cf86a1c451fcf7.png" alt="img"></p>
<p>ç„¶åæˆ‘ä»¬æ‰¾åˆ° <code> rs = executor.execute(args);</code>  æœ€ç»ˆæ‰§è¡Œçš„æ–¹æ³•ï¼Œæ‰¾åˆ°æœ€é¡¶çº§çš„çˆ¶ç±» <code>BaseTransactionalExecutor.execute()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">execute</span><span class="params">(Object... args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">xid</span> <span class="operator">=</span> RootContext.getXID();</span><br><span class="line">    <span class="keyword">if</span> (xid != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//è·å–XID</span></span><br><span class="line">        statementProxy.getConnectionProxy().bind(xid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è®¾ç½®å…¨å±€é”</span></span><br><span class="line">    statementProxy.getConnectionProxy().setGlobalLockRequire(RootContext.requireGlobalLock());</span><br><span class="line">    <span class="keyword">return</span> doExecute(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ ¹æ® <code>doExecute(args);</code>  æ‰¾åˆ°å…¶ä¸­çš„é‡å†™æ–¹æ³•  <code>AbstractDMLBaseExecutor.doExecute()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> T <span class="title function_">doExecute</span><span class="params">(Object... args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">AbstractConnectionProxy</span> <span class="variable">connectionProxy</span> <span class="operator">=</span> statementProxy.getConnectionProxy();</span><br><span class="line">    <span class="comment">//æ˜¯å¦è‡ªåŠ¨æäº¤</span></span><br><span class="line">    <span class="keyword">if</span> (connectionProxy.getAutoCommit()) &#123;</span><br><span class="line">        <span class="keyword">return</span> executeAutoCommitTrue(args);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> executeAutoCommitFalse(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ•°æ®åº“è€Œè¨€ï¼Œæœ¬èº«éƒ½æ˜¯è‡ªåŠ¨æäº¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥ <code>executeAutoCommitTrue()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">protected</span> T <span class="title function_">executeAutoCommitTrue</span><span class="params">(Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">ConnectionProxy</span> <span class="variable">connectionProxy</span> <span class="operator">=</span> statementProxy.getConnectionProxy();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤</span></span><br><span class="line">            connectionProxy.changeAutoCommit();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LockRetryPolicy</span>(connectionProxy).execute(() -&gt; &#123;</span><br><span class="line">                <span class="comment">//è°ƒç”¨æ‰‹åŠ¨æäº¤æ–¹æ³•ï¼Œå¾—åˆ°åˆ†æ”¯æ‰§è¡Œçš„æœ€ç»ˆç»“æœ</span></span><br><span class="line">                <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> executeAutoCommitFalse(args);</span><br><span class="line">                <span class="comment">//æ‰§è¡Œæäº¤</span></span><br><span class="line">                connectionProxy.commit();</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// when exception occur in finally,this exception will lost, so just print it here</span></span><br><span class="line">            LOGGER.error(<span class="string">&quot;execute executeAutoCommitTrue error:&#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">            <span class="keyword">if</span> (!LockRetryPolicy.isLockRetryPolicyBranchRollbackOnConflict()) &#123;</span><br><span class="line">                connectionProxy.getTargetConnection().rollback();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connectionProxy.getContext().reset();</span><br><span class="line">            connectionProxy.setAutoCommit(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">connectionProxy.changeAutoCommit()`æ–¹æ³•ï¼Œä¿®æ”¹ä¸ºæ‰‹åŠ¨æäº¤åï¼Œæˆ‘ä»¬çœ‹æ¥æœ€å…³é”®çš„ä»£ç `executeAutoCommitFalse()</span><br><span class="line">    <span class="keyword">protected</span> T <span class="title function_">executeAutoCommitFalse</span><span class="params">(Object[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (!JdbcConstants.MYSQL.equalsIgnoreCase(getDbType()) &amp;&amp; isMultiPk()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotSupportYetException</span>(<span class="string">&quot;multi pk only support mysql!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è·å–å‰é•œåƒ</span></span><br><span class="line">        <span class="type">TableRecords</span> <span class="variable">beforeImage</span> <span class="operator">=</span> beforeImage();</span><br><span class="line">        <span class="comment">//æ‰§è¡Œå…·ä½“ä¸šåŠ¡</span></span><br><span class="line">        <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> statementCallback.execute(statementProxy.getTargetStatement(), args);</span><br><span class="line">        <span class="comment">//è·å–æ‰§è¡Œæ•°é‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">updateCount</span> <span class="operator">=</span> statementProxy.getUpdateCount();</span><br><span class="line">        <span class="comment">//åˆ¤æ–­å¦‚æœæ‰§è¡Œæ•°é‡å¤§äº0</span></span><br><span class="line">        <span class="keyword">if</span> (updateCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//è·å–åé•œåƒ</span></span><br><span class="line">            <span class="type">TableRecords</span> <span class="variable">afterImage</span> <span class="operator">=</span> afterImage(beforeImage);</span><br><span class="line">            <span class="comment">//æš‚å­˜åˆ°undologä¸­ï¼Œåœ¨Commitçš„æ—¶å€™ä¿å­˜åˆ°æ•°æ®åº“</span></span><br><span class="line">            prepareUndoLog(beforeImage, afterImage);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å†å›åˆ° <code>executeAutoCommitTrue</code>  ä¸­ï¼Œå»çœ‹çœ‹æäº¤åšäº†å“ªäº›æ“ä½œ <code>connectionProxy.commit();</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        lockRetryPolicy.execute(() -&gt; &#123;</span><br><span class="line">            <span class="comment">//å…·ä½“æ‰§è¡Œ</span></span><br><span class="line">            doCommit();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (targetConnection != <span class="literal">null</span> &amp;&amp; !getAutoCommit() &amp;&amp; !getContext().isAutoCommitChanged()) &#123;</span><br><span class="line">            rollback();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥åˆ° <code>doCommit()</code>  ä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">doCommit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦å­˜åœ¨å…¨å±€äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (context.inGlobalTransaction()) &#123;</span><br><span class="line">        processGlobalTransactionCommit();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (context.isGlobalLockRequire()) &#123;</span><br><span class="line">        processLocalCommitWithGlobalLocks();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        targetConnection.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä¸€å®šæ˜¯å­˜åœ¨å…¨å±€äº‹åŠ¡çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿›å…¥  <code>processGlobalTransactionCommit()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processGlobalTransactionCommit</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</span></span><br><span class="line">          register();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (TransactionException e) &#123;</span><br><span class="line">          recognizeLockKeyConflictException(e, context.buildLockKeys());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">//å†™å…¥æ•°æ®åº“undolog</span></span><br><span class="line">          UndoLogManagerFactory.getUndoLogManager(<span class="built_in">this</span>.getDbType()).flushUndoLogs(<span class="built_in">this</span>);</span><br><span class="line">          <span class="comment">//æ‰§è¡ŒåŸç”Ÿæäº¤ ä¸€é˜¶æ®µæäº¤</span></span><br><span class="line">          targetConnection.commit();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">          LOGGER.error(<span class="string">&quot;process connectionProxy commit error: &#123;&#125;&quot;</span>, ex.getMessage(), ex);</span><br><span class="line">          report(<span class="literal">false</span>);</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(ex);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (IS_REPORT_SUCCESS_ENABLE) &#123;</span><br><span class="line">          report(<span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      context.reset();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ <code>register()</code>  æ–¹æ³•å°±æ˜¯æ³¨å†Œåˆ†æ”¯äº‹åŠ¡çš„æ–¹æ³•ï¼ŒåŒæ—¶è¿˜ä¼šå°† undoLog å†™å…¥æ•°æ®åº“å’Œæ‰§è¡Œæäº¤ç­‰æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œç”Ÿæˆåˆ†æ”¯äº‹åŠ¡ID</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">()</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="keyword">if</span> (!context.hasUndoLog() || !context.hasLockKey()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ³¨å†Œåˆ†æ”¯äº‹åŠ¡</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">branchId</span> <span class="operator">=</span> DefaultResourceManager.get().branchRegister(BranchType.AT, getDataSourceProxy().getResourceId(),</span><br><span class="line">        <span class="literal">null</span>, context.getXid(), context.getApplicationData(), context.buildLockKeys());</span><br><span class="line">    context.setBranchId(branchId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨å›åˆ° <code>processGlobalTransactionCommit</code>  ä¸­ï¼Œçœ‹çœ‹å†™å…¥æ•°æ®åº“ä¸­çš„ <code>flushUndoLogs()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">flushUndoLogs</span><span class="params">(ConnectionProxy cp)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">       <span class="type">ConnectionContext</span> <span class="variable">connectionContext</span> <span class="operator">=</span> cp.getContext();</span><br><span class="line">       <span class="keyword">if</span> (!connectionContext.hasUndoLog()) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//è·å–XID</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">xid</span> <span class="operator">=</span> connectionContext.getXid();</span><br><span class="line">       <span class="comment">//è·å–åˆ†æ”¯ID</span></span><br><span class="line">       <span class="type">long</span> <span class="variable">branchId</span> <span class="operator">=</span> connectionContext.getBranchId();</span><br><span class="line"></span><br><span class="line">       <span class="type">BranchUndoLog</span> <span class="variable">branchUndoLog</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BranchUndoLog</span>();</span><br><span class="line">       branchUndoLog.setXid(xid);</span><br><span class="line">       branchUndoLog.setBranchId(branchId);</span><br><span class="line">       branchUndoLog.setSqlUndoLogs(connectionContext.getUndoItems());</span><br><span class="line"></span><br><span class="line">       <span class="type">UndoLogParser</span> <span class="variable">parser</span> <span class="operator">=</span> UndoLogParserFactory.getInstance();</span><br><span class="line">       <span class="type">byte</span>[] undoLogContent = parser.encode(branchUndoLog);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (LOGGER.isDebugEnabled()) &#123;</span><br><span class="line">           LOGGER.debug(<span class="string">&quot;Flushing UNDO LOG: &#123;&#125;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(undoLogContent, Constants.DEFAULT_CHARSET));</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="type">CompressorType</span> <span class="variable">compressorType</span> <span class="operator">=</span> CompressorType.NONE;</span><br><span class="line">       <span class="keyword">if</span> (needCompress(undoLogContent)) &#123;</span><br><span class="line">           compressorType = ROLLBACK_INFO_COMPRESS_TYPE;</span><br><span class="line">           undoLogContent = CompressorFactory.getCompressor(compressorType.getCode()).compress(undoLogContent);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//å†™å…¥æ•°æ®åº“å…·ä½“ä½ç½®</span></span><br><span class="line">       insertUndoLogWithNormal(xid, branchId, buildContext(parser.getName(), compressorType), undoLogContent, cp.getTargetConnection());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“å†™å…¥æ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ MySqlï¼Œæ‰€ä»¥æ‰§è¡Œçš„æ˜¯ MySql å®ç°ç±» <code>MySQLUndoLogManager.insertUndoLogWithNormal()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">insertUndoLogWithNormal</span><span class="params">(String xid, <span class="type">long</span> branchId, String rollbackCtx, <span class="type">byte</span>[] undoLogContent,</span></span><br><span class="line"><span class="params">                                       Connection conn)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    insertUndoLog(xid, branchId, rollbackCtx, undoLogContent, State.Normal, conn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…·ä½“å†™å…¥æ“ä½œ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertUndoLog</span><span class="params">(String xid, <span class="type">long</span> branchId, String rollbackCtx, <span class="type">byte</span>[] undoLogContent,</span></span><br><span class="line"><span class="params">                           State state, Connection conn)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">PreparedStatement</span> <span class="variable">pst</span> <span class="operator">=</span> conn.prepareStatement(INSERT_UNDO_LOG_SQL)) &#123;</span><br><span class="line">        pst.setLong(<span class="number">1</span>, branchId);</span><br><span class="line">        pst.setString(<span class="number">2</span>, xid);</span><br><span class="line">        pst.setString(<span class="number">3</span>, rollbackCtx);</span><br><span class="line">        pst.setBytes(<span class="number">4</span>, undoLogContent);</span><br><span class="line">        pst.setInt(<span class="number">5</span>, state.getValue());</span><br><span class="line">        pst.executeUpdate();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!(e <span class="keyword">instanceof</span> SQLException)) &#123;</span><br><span class="line">            e = <span class="keyword">new</span> <span class="title class_">SQLException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> (SQLException) e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…·ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/cc94f7cbd5363484c839ed9e69b95c5d.png" alt="img"></p>
<h2 id="seata-æœåŠ¡ç«¯"><a class="markdownIt-Anchor" href="#seata-æœåŠ¡ç«¯">#</a> Seata æœåŠ¡ç«¯</h2>
<p>æˆ‘ä»¬æ‰¾åˆ° <code>Server.java</code>  è¿™é‡Œå°±æ˜¯å¯åŠ¨å…¥å£ï¼Œåœ¨è¿™ä¸ªå…¥å£ä¸­æ‰¾åˆ°åè°ƒè€…ï¼Œå› ä¸º TC æ•´ä½“çš„æ“ä½œå°±æ˜¯åè°ƒæ•´ä½“çš„å…¨å±€äº‹åŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é»˜è®¤åè°ƒè€…</span></span><br><span class="line"><span class="type">DefaultCoordinator</span> <span class="variable">coordinator</span> <span class="operator">=</span> DefaultCoordinator.getInstance(nettyRemotingServer);</span><br></pre></td></tr></table></figure>
<p>åœ¨ <code>DefaultCoordinator</code>  ç±»ä¸­æˆ‘ä»¬æ‰¾åˆ° ä¸€ä¸ª <code>doGlobalBegin</code>  è¿™ä¸ªå°±æ˜¯å¤„ç†å…¨å±€äº‹åŠ¡å¼€å§‹çš„æ–¹æ³•ï¼Œä»¥åŠå…¨å±€æäº¤  <code>doGlobalCommit</code>  å’Œå…¨å±€å›æ»š  <code>doGlobalRollback</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">//å¤„ç†å…¨å±€äº‹åŠ¡</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGlobalBegin</span><span class="params">(GlobalBeginRequest request, GlobalBeginResponse response, RpcContext rpcContext)</span><span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">        <span class="comment">//å“åº”å®¢æˆ·ç«¯xid</span></span><br><span class="line">response.setXid(core.begin(rpcContext.getApplicationId(), rpcContext.getTransactionServiceGroup(),</span><br><span class="line">                request.getTransactionName(), request.getTimeout()));</span><br><span class="line"><span class="keyword">if</span> (LOGGER.isInfoEnabled()) &#123;</span><br><span class="line">    LOGGER.info(<span class="string">&quot;Begin new global transaction applicationId: &#123;&#125;,transactionServiceGroup: &#123;&#125;, transactionName: &#123;&#125;,timeout:&#123;&#125;,xid:&#123;&#125;&quot;</span>,</span><br><span class="line">       rpcContext.getApplicationId(), rpcContext.getTransactionServiceGroup(), request.getTransactionName(), request.getTimeout(), response.getXid());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//å¤„ç†å…¨å±€æäº¤</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGlobalCommit</span><span class="params">(GlobalCommitRequest request, GlobalCommitResponse response, RpcContext rpcContext)</span><span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">     MDC.put(RootContext.MDC_KEY_XID, request.getXid());</span><br><span class="line">     response.setGlobalStatus(core.commit(request.getXid()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å¤„ç†å…¨å±€å›æ»š</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGlobalRollback</span><span class="params">(GlobalRollbackRequest request, GlobalRollbackResponse response,</span></span><br><span class="line"><span class="params">                                    RpcContext rpcContext)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    MDC.put(RootContext.MDC_KEY_XID, request.getXid());</span><br><span class="line">    response.setGlobalStatus(core.rollback(request.getXid()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå…³æ³¨  <code>doGlobalBegin</code>  ä¸­  <code>core.begin()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">begin</span><span class="params">(String applicationId, String transactionServiceGroup, String name, <span class="type">int</span> timeout)</span></span><br><span class="line">    <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºå…¨å±€äº‹åŠ¡Session</span></span><br><span class="line">    <span class="type">GlobalSession</span> <span class="variable">session</span> <span class="operator">=</span> GlobalSession.createGlobalSession(applicationId, transactionServiceGroup, name,</span><br><span class="line">        timeout);</span><br><span class="line">    MDC.put(RootContext.MDC_KEY_XID, session.getXid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸ºSessioné‡æ·»åŠ å›è°ƒç›‘å¬ï¼ŒSessionHolder.getRootSessionManager() è·å–ä¸€ä¸ªå…¨å±€Sessionç®¡ç†å™¨DataBaseSessionManager</span></span><br><span class="line">    <span class="comment">//è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œåˆ›å»ºDataBaseSessionManager</span></span><br><span class="line">    session.addSessionLifecycleListener(SessionHolder.getRootSessionManager());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…¨å±€äº‹åŠ¡å¼€å§‹</span></span><br><span class="line">    session.begin();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// transaction start event</span></span><br><span class="line">    MetricsPublisher.postSessionDoingEvent(session, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> session.getXid();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨æ¥çœ‹ä¸€ä¸‹ <code>SessionHolder.getRootSessionManager()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Gets root session manager.</span></span><br><span class="line"><span class="comment"> * è·å–ä¸€ä¸ªå…¨å±€Sessionç®¡ç†å™¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the root session manager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> SessionManager <span class="title function_">getRootSessionManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ROOT_SESSION_MANAGER == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShouldNeverHappenException</span>(<span class="string">&quot;SessionManager is NOT init!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ROOT_SESSION_MANAGER;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(String mode)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(mode)) &#123;</span><br><span class="line">        mode = CONFIG.getConfig(ConfigurationKeys.STORE_SESSION_MODE,</span><br><span class="line">                CONFIG.getConfig(ConfigurationKeys.STORE_MODE, SERVER_DEFAULT_STORE_MODE));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">StoreMode</span> <span class="variable">storeMode</span> <span class="operator">=</span> StoreMode.get(mode);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­Seataæ¨¡å¼ï¼Œå½“å‰ä¸ºDB</span></span><br><span class="line">    <span class="keyword">if</span> (StoreMode.DB.equals(storeMode)) &#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡SPIæœºåˆ¶è¯»å–SessionManageræ¥å£å®ç°ç±»ï¼Œè¯»å–çš„META-INF.servicesç›®å½•ï¼Œåœ¨é€šè¿‡åå°„æœºåˆ¶åˆ›å»ºå¯¹è±¡DataBaseSessionManager</span></span><br><span class="line">        ROOT_SESSION_MANAGER = EnhancedServiceLoader.load(SessionManager.class, StoreMode.DB.getName());</span><br><span class="line">        ........</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œä»–å…¶å®è¯»å–çš„æ˜¯ DB æ¨¡å¼ä¸‹  <code>io.seata.server.session.SessionManager</code>  æ–‡ä»¶çš„å†…å®¹</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4dd908fc36e0128e646e3c8c0b03262a.png" alt="img"></p>
<p>æˆ‘ä»¬åœ¨å›åˆ° <code>begin</code>  æ–¹æ³•ä¸­ï¼Œå»æŸ¥çœ‹ <code>session.begin()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">begin</span><span class="params">()</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">//å£°æ˜å…¨å±€äº‹åŠ¡å¼€å§‹</span></span><br><span class="line">    <span class="built_in">this</span>.status = GlobalStatus.Begin;</span><br><span class="line">    <span class="comment">//å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="built_in">this</span>.beginTime = System.currentTimeMillis();</span><br><span class="line">    <span class="comment">//æ¿€æ´»å…¨å±€äº‹åŠ¡</span></span><br><span class="line">    <span class="built_in">this</span>.active = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//å°†SessionManageræ”¾å…¥åˆ°é›†åˆä¸­ï¼Œè°ƒç”¨onBeginæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">for</span> (SessionLifecycleListener lifecycleListener : lifecycleListeners) &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨çˆ¶çº§æŠ½è±¡ç±»çš„æ–¹æ³•</span></span><br><span class="line">        lifecycleListener.onBegin(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹  <code>onBegin()</code>  æ–¹æ³•ï¼Œè°ƒç”¨çš„æ˜¯çˆ¶çº§çš„æ–¹æ³•ï¼Œåœ¨è¿™å…¶ä¸­æˆ‘ä»¬è¦å…³æ³¨  <code>addGlobalSession()</code>  æ–¹æ³•ï¼Œä½†æ˜¯è¦æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯ db æ¨¡å¼æ‰€ä»¥è°ƒç”¨çš„æ˜¯ db æ¨¡å¼çš„  <code>DateBaseSessionManager</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBegin</span><span class="params">(GlobalSession globalSession)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œè°ƒç”¨çš„æ˜¯DateBaseSessionManager</span></span><br><span class="line">    addGlobalSession(globalSession);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addGlobalSession</span><span class="params">(GlobalSession session)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isBlank(taskName)) &#123;</span><br><span class="line">        <span class="comment">//å†™å…¥session</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> transactionStoreManager.writeSession(LogOperation.GLOBAL_ADD, session);</span><br><span class="line">        <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StoreException</span>(<span class="string">&quot;addGlobalSession failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> transactionStoreManager.writeSession(LogOperation.GLOBAL_UPDATE, session);</span><br><span class="line">        <span class="keyword">if</span> (!ret) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StoreException</span>(<span class="string">&quot;addGlobalSession failed.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨çœ‹æŸ¥è¯¢å…¶ä¸­å…³é”®çš„æ–¹æ³• <code>DataBaseTransactionStoreManager.writeSession()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">writeSession</span><span class="params">(LogOperation logOperation, SessionStorable session)</span> &#123;</span><br><span class="line">       <span class="comment">//ç¬¬ä¸€æ¬¡è¿›å…¥æ˜¯å†™å…¥ ä¼šè¿›å…¥å½“å‰æ–¹æ³•</span></span><br><span class="line">       <span class="comment">//å…¨å±€æ·»åŠ </span></span><br><span class="line">       <span class="keyword">if</span> (LogOperation.GLOBAL_ADD.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.insertGlobalTransactionDO(SessionConverter.convertGlobalTransactionDO(session));</span><br><span class="line">           <span class="comment">//å…¨å±€ä¿®æ”¹</span></span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LogOperation.GLOBAL_UPDATE.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.updateGlobalTransactionDO(SessionConverter.convertGlobalTransactionDO(session));</span><br><span class="line">           <span class="comment">//å…¨å±€åˆ é™¤</span></span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LogOperation.GLOBAL_REMOVE.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.deleteGlobalTransactionDO(SessionConverter.convertGlobalTransactionDO(session));</span><br><span class="line">           <span class="comment">//åˆ†æ”¯æ·»åŠ </span></span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LogOperation.BRANCH_ADD.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.insertBranchTransactionDO(SessionConverter.convertBranchTransactionDO(session));</span><br><span class="line">           <span class="comment">//åˆ†æ”¯æ›´æ–°</span></span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LogOperation.BRANCH_UPDATE.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.updateBranchTransactionDO(SessionConverter.convertBranchTransactionDO(session));</span><br><span class="line">           <span class="comment">//åˆ†æ”¯ç§»é™¤</span></span><br><span class="line">       &#125; <span class="keyword">else</span> <span class="keyword">if</span> (LogOperation.BRANCH_REMOVE.equals(logOperation)) &#123;</span><br><span class="line">           <span class="keyword">return</span> logStore.deleteBranchTransactionDO(SessionConverter.convertBranchTransactionDO(session));</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StoreException</span>(<span class="string">&quot;Unknown LogOperation:&quot;</span> + logOperation.name());</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°±çœ‹ç¬¬ä¸€æ¬¡è¿›å»çš„æ–¹æ³• <code>logStore.insertGlobalTransactionDO(SessionConverter.convertGlobalTransactionDO(session));</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">insertGlobalTransactionDO</span><span class="params">(GlobalTransactionDO globalTransactionDO)</span> &#123;</span><br><span class="line">     <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> LogStoreSqlsFactory.getLogStoreSqls(dbType).getInsertGlobalTransactionSQL(globalTable);</span><br><span class="line">     <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">     <span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">         conn = logStoreDataSource.getConnection();</span><br><span class="line">         conn.setAutoCommit(<span class="literal">true</span>);</span><br><span class="line">         ps = conn.prepareStatement(sql);</span><br><span class="line">         ps.setString(index++, globalTransactionDO.getXid());</span><br><span class="line">         ps.setLong(index++, globalTransactionDO.getTransactionId());</span><br><span class="line">         ps.setInt(index++, globalTransactionDO.getStatus());</span><br><span class="line">         ps.setString(index++, globalTransactionDO.getApplicationId());</span><br><span class="line">         ps.setString(index++, globalTransactionDO.getTransactionServiceGroup());</span><br><span class="line">         <span class="type">String</span> <span class="variable">transactionName</span> <span class="operator">=</span> globalTransactionDO.getTransactionName();</span><br><span class="line">         transactionName = transactionName.length() &gt; transactionNameColumnSize ?</span><br><span class="line">             transactionName.substring(<span class="number">0</span>, transactionNameColumnSize) :</span><br><span class="line">             transactionName;</span><br><span class="line">         ps.setString(index++, transactionName);</span><br><span class="line">         ps.setInt(index++, globalTransactionDO.getTimeout());</span><br><span class="line">         ps.setLong(index++, globalTransactionDO.getBeginTime());</span><br><span class="line">         ps.setString(index++, globalTransactionDO.getApplicationData());</span><br><span class="line">         <span class="keyword">return</span> ps.executeUpdate() &gt; <span class="number">0</span>;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">StoreException</span>(e);</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         IOUtil.close(ps, conn);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæœ‰ä¸€ä¸ª  <code>GlobalTransactionDO </code> å¯¹è±¡ï¼Œé‡Œé¢æœ‰ <code>xidã€transactionId</code>  ç­‰ç­‰ï¼Œåˆ°è¿™é‡Œæ˜¯ä¸æ˜¯å°±å¾ˆç†Ÿæ‚‰äº†ã€</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5649458fda2717fb7c87a5d8d0df2741.png" alt="img"></p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨ Seata çš„æ—¶å€™ä¼šåˆ›å»ºä¸‰å¼ è¡¨</p>
<ol>
<li>branch_table åˆ†æ”¯äº‹åŠ¡è¡¨</li>
<li>global_table å…¨å±€äº‹åŠ¡è¡¨</li>
<li>lock_table å…¨å±€é”è¡¨</li>
</ol>
<p>è€Œè¿™é‡Œå°±æ˜¯å¯¹åº”æˆ‘ä»¬çš„ <code>global_table</code>  è¡¨ï¼Œå…¶ä»–ä¸¤ä¸ªä¹Ÿæ˜¯å·®ä¸å¤šï¼Œéƒ½æ˜¯ä¸€æ ·çš„æ“ä½œ</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6ef22513cae0ad8f2861cf18ec4cde0c.png" alt="img"><br>
 æµç¨‹å›¾å¦‚ä¸‹ï¼š<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c33801b28bbae2a960f6b14856d4e8cf.png" alt="img"></p>
<h2 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h2>
<p>å®Œæ•´æµç¨‹å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e615279306d5aaf9ad85b8e2f9905a35.png" alt="img"></p>
<p>å¯¹äº Seata æºç æ¥è¯´ä¸»è¦æ˜¯äº†è§£ä»å“ªé‡Œå…¥å£ä»¥åŠæ ¸å¿ƒç‚¹åœ¨å“ªé‡Œï¼Œé‡åˆ°æœ‰ç–‘é—®çš„ï¼Œå¯ä»¥ Debugï¼Œå¯¹äº Seata AT æ¨¡å¼ï¼Œæˆ‘ä»¬ä¸»è¦æŒæ¡çš„æ ¸å¿ƒç‚¹æ˜¯</p>
<ul>
<li>å¦‚ä½•è·å–å…¨å±€é”ã€å¼€å¯å…¨å±€äº‹åŠ¡</li>
<li>è§£æ SQL å¹¶å†™å…¥ undolog</li>
</ul>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-17T08:20:40.000Z" title="2023-5-17 16:20:40">2023-05-17</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-17T08:28:47.563Z" title="2023-5-17 16:28:47">2023-05-17</time>æ›´æ–°</span><span class="level-item">2 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦298ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/17/%E3%80%90Java%E3%80%91%E8%AE%B0%E4%B8%80%E6%AC%A1%E7%BA%BF%E4%B8%8A%E6%95%85%E9%9A%9C%EF%BC%9A%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E6%97%A0%E5%93%8D%E5%BA%94/">ã€Javaã€‘è®°ä¸€æ¬¡çº¿ä¸Šæ•…éšœï¼šæœåŠ¡æ¥å£æ— å“åº”</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="äº‹æ•…èµ·å› "><a class="markdownIt-Anchor" href="#äº‹æ•…èµ·å› ">#</a> äº‹æ•…èµ·å› </h2>
<h5 id="ä¸­åˆå…¬ä¼—å·çªç„¶æ”¶åˆ°æ¶ˆæ¯å¾ˆå¤šç”¨æˆ·è¯´chatgptä¸å›å¤è¯¢é—®æˆ‘æ˜¯ä¸æ˜¯ç¨‹åºåæ‰äº†"><a class="markdownIt-Anchor" href="#ä¸­åˆå…¬ä¼—å·çªç„¶æ”¶åˆ°æ¶ˆæ¯å¾ˆå¤šç”¨æˆ·è¯´chatgptä¸å›å¤è¯¢é—®æˆ‘æ˜¯ä¸æ˜¯ç¨‹åºåæ‰äº†">#</a> ä¸­åˆå…¬ä¼—å·çªç„¶æ”¶åˆ°æ¶ˆæ¯ï¼Œå¾ˆå¤šç”¨æˆ·è¯´ chatGPT ä¸å›å¤ï¼Œè¯¢é—®æˆ‘æ˜¯ä¸æ˜¯ç¨‹åºåæ‰äº†</h5>
<h2 id="æ’æŸ¥æµç¨‹"><a class="markdownIt-Anchor" href="#æ’æŸ¥æµç¨‹">#</a> æ’æŸ¥æµç¨‹</h2>
<h4 id="1è¿›å…¥dockeræŸ¥çœ‹æœåŠ¡æ—¥å¿—å‘ç°æ—¥å¿—éƒ½æ­£å¸¸è¾“å‡ºæ²¡æœ‰æŠ¥é”™"><a class="markdownIt-Anchor" href="#1è¿›å…¥dockeræŸ¥çœ‹æœåŠ¡æ—¥å¿—å‘ç°æ—¥å¿—éƒ½æ­£å¸¸è¾“å‡ºæ²¡æœ‰æŠ¥é”™">#</a> 1. è¿›å…¥ docker æŸ¥çœ‹æœåŠ¡æ—¥å¿—ï¼Œå‘ç°æ—¥å¿—éƒ½æ­£å¸¸è¾“å‡ºï¼Œæ²¡æœ‰æŠ¥é”™</h4>
<h4 id="2åœ¨æœ¬åœ°å¯åŠ¨ç¨‹åºæ’æŸ¥å‘ç°æ— å¼‚å¸¸"><a class="markdownIt-Anchor" href="#2åœ¨æœ¬åœ°å¯åŠ¨ç¨‹åºæ’æŸ¥å‘ç°æ— å¼‚å¸¸">#</a> 2. åœ¨æœ¬åœ°å¯åŠ¨ç¨‹åºæ’æŸ¥ï¼Œå‘ç°æ— å¼‚å¸¸</h4>
<h4 id="3ä½¿ç”¨æ¥å£å·¥å…·è°ƒç”¨å…¶ä»–æ¥å£å’Œç½‘å…³å¿ƒè·³æ¥å£å°è¯•æ— å“åº”"><a class="markdownIt-Anchor" href="#3ä½¿ç”¨æ¥å£å·¥å…·è°ƒç”¨å…¶ä»–æ¥å£å’Œç½‘å…³å¿ƒè·³æ¥å£å°è¯•æ— å“åº”">#</a> 3. ä½¿ç”¨æ¥å£å·¥å…·è°ƒç”¨å…¶ä»–æ¥å£å’Œç½‘å…³å¿ƒè·³æ¥å£å°è¯•ï¼Œæ— å“åº”</h4>
<h4 id="4æŸ¥çœ‹çº¿ä¸Šcpuå’Œå†…å­˜ä½¿ç”¨ç‡ç»“æœæ­£å¸¸"><a class="markdownIt-Anchor" href="#4æŸ¥çœ‹çº¿ä¸Šcpuå’Œå†…å­˜ä½¿ç”¨ç‡ç»“æœæ­£å¸¸">#</a> 4. æŸ¥çœ‹çº¿ä¸Š CPU å’Œå†…å­˜ä½¿ç”¨ç‡ï¼Œç»“æœæ­£å¸¸</h4>
<h4 id="5æŸ¥çœ‹çº¿ä¸Šç£ç›˜å ç”¨100"><a class="markdownIt-Anchor" href="#5æŸ¥çœ‹çº¿ä¸Šç£ç›˜å ç”¨100">#</a> 5. æŸ¥çœ‹çº¿ä¸Šç£ç›˜ï¼šå ç”¨ 100%</h4>
<h2 id="ç»“æœ"><a class="markdownIt-Anchor" href="#ç»“æœ">#</a> ç»“æœ</h2>
<p>â€‹	æ¸…ç†æ‰ Nacos çš„å¤§é‡æ—¥å¿—åï¼ŒæœåŠ¡æ¢å¤æ­£å¸¸ã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-08T14:04:55.000Z" title="2023-5-8 22:04:55">2023-05-08</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-09T00:27:14.814Z" title="2023-5-9 8:27:14">2023-05-09</time>æ›´æ–°</span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦9856ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/08/%E3%80%90Java%E3%80%91HashMap%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E8%A7%A3%E8%AF%BB/">ã€Javaã€‘HashMapæ ¸å¿ƒåŸç†è§£è¯»</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javahashmapæ ¸å¿ƒåŸç†è§£è¯»"><a class="markdownIt-Anchor" href="#javahashmapæ ¸å¿ƒåŸç†è§£è¯»">#</a> ã€Javaã€‘HashMap æ ¸å¿ƒåŸç†è§£è¯»</h1>
<h2 id="ä¸€-å‰è¨€"><a class="markdownIt-Anchor" href="#ä¸€-å‰è¨€">#</a> ä¸€ã€å‰è¨€</h2>
<p>å¾—ç›Šäº <code>Doug Lea</code>  è€çˆ·å­çš„æ“åˆ€ï¼Œè®© <code>HashMap</code>  æˆä¸ºä½¿ç”¨å’Œé¢è¯•æœ€é¢‘ç¹çš„ APIï¼Œæ²¡åŠæ³•è®¾è®¡çš„å¤ªä¼˜ç§€äº†ï¼</p>
<p>HashMap æœ€æ—©å‡ºç°åœ¨ JDK 1.2 ä¸­ï¼Œåº•å±‚åŸºäºæ•£åˆ—ç®—æ³•å®ç°ã€‚HashMap å…è®¸ null é”®å’Œ null å€¼ï¼Œåœ¨è®¡ç®—å“ˆé”®çš„å“ˆå¸Œå€¼æ—¶ï¼Œnull é”®å“ˆå¸Œå€¼ä¸º 0ã€‚HashMap å¹¶ä¸ä¿è¯é”®å€¼å¯¹çš„é¡ºåºï¼Œè¿™æ„å‘³ç€åœ¨è¿›è¡ŒæŸäº›æ“ä½œåï¼Œé”®å€¼å¯¹çš„é¡ºåºå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHashMap æ˜¯éçº¿ç¨‹å®‰å…¨ç±»ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜ã€‚</p>
<h2 id="äºŒ-æºç åˆ†æ"><a class="markdownIt-Anchor" href="#äºŒ-æºç åˆ†æ">#</a> äºŒã€æºç åˆ†æ</h2>
<h3 id="1-å†™ä¸€ä¸ªæœ€ç®€å•çš„hashmap"><a class="markdownIt-Anchor" href="#1-å†™ä¸€ä¸ªæœ€ç®€å•çš„hashmap">#</a> 1. å†™ä¸€ä¸ªæœ€ç®€å•çš„ HashMap</h3>
<p>å­¦ä¹  HashMap å‰ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å…ˆäº†è§£è¿™æ˜¯ä¸€ç§æ€ä¹ˆæ ·çš„æ•°æ®ç»“æ„æ¥å­˜æ”¾æ•°æ®ã€‚è€Œ HashMap ç»è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£åï¼Œä¹ä¸€çœ‹ä»£ç è¿˜æ˜¯å¾ˆå¤æ‚çš„ã€‚å°±åƒä½ åŸæ¥åªç©¿ä¸ªè£¤è¡©ï¼Œç°åœ¨è¿˜æœ‰ç§‹è£¤å’Œé£è¡£ã€‚æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æœ€æ ¹æœ¬çš„ HashMap æ˜¯ä»€ä¹ˆæ ·ï¼Œä¹Ÿå°±æ˜¯åªç©¿è£¤è¡©æ˜¯ä»€ä¹ˆæ•ˆæœï¼Œä¹‹åå†å»åˆ†æå®ƒçš„æºç ã€‚</p>
<p><strong>é—®é¢˜ï¼š</strong> å‡è®¾æˆ‘ä»¬æœ‰ä¸€ç»„ 7 ä¸ªå­—ç¬¦ä¸²ï¼Œéœ€è¦å­˜æ”¾åˆ°æ•°ç»„ä¸­ï¼Œä½†è¦æ±‚åœ¨è·å–æ¯ä¸ªå…ƒç´ çš„æ—¶å€™æ—¶é—´å¤æ‚åº¦æ˜¯ O (1)ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ ä¸èƒ½é€šè¿‡å¾ªç¯éå†çš„æ–¹å¼è¿›è¡Œè·å–ï¼Œè€Œæ˜¯è¦å®šä½åˆ°æ•°ç»„ ID ç›´æ¥è·å–ç›¸åº”çš„å…ƒç´ ã€‚</p>
<p><strong>æ–¹æ¡ˆï¼š</strong> å¦‚æœè¯´æˆ‘ä»¬éœ€è¦é€šè¿‡ ID ä»æ•°ç»„ä¸­è·å–å…ƒç´ ï¼Œé‚£ä¹ˆå°±éœ€è¦æŠŠæ¯ä¸ªå­—ç¬¦ä¸²éƒ½è®¡ç®—å‡ºä¸€ä¸ªåœ¨æ•°ç»„ä¸­çš„ä½ç½® IDã€‚<em>å­—ç¬¦ä¸²è·å– ID ä½ èƒ½æƒ³åˆ°ä»€ä¹ˆæ–¹å¼ï¼Ÿ</em> ä¸€ä¸ªå­—ç¬¦ä¸²æœ€ç›´æ¥çš„è·å–è·Ÿæ•°å­—ç›¸å…³çš„ä¿¡æ¯å°±æ˜¯ HashCodeï¼Œå¯ HashCode çš„å–å€¼èŒƒå›´å¤ªå¤§äº† <code>[-2147483648, 2147483647]</code> ï¼Œä¸å¯èƒ½ç›´æ¥ä½¿ç”¨ã€‚é‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ HashCode ä¸æ•°ç»„é•¿åº¦åšä¸è¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªå¯ä»¥åœ¨æ•°ç»„ä¸­å‡ºç°çš„ä½ç½®ã€‚å¦‚æœè¯´æœ‰ä¸¤ä¸ªå…ƒç´ å¾—åˆ°åŒæ ·çš„ IDï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°ç»„ ID ä¸‹å°±å­˜æ”¾ä¸¤ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ä»¥ä¸Šå‘¢å…¶å®å°±æ˜¯æˆ‘ä»¬è¦æŠŠå­—ç¬¦ä¸²æ•£åˆ—åˆ°æ•°ç»„ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€è·¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŠŠè¿™ä¸ªæ€è·¯ç”¨ä»£ç å®ç°å‡ºæ¥ã€‚</p>
<h4 id="11-ä»£ç å®ç°"><a class="markdownIt-Anchor" href="#11-ä»£ç å®ç°">#</a> 1.1 ä»£ç å®ç°</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–ä¸€ç»„å­—ç¬¦ä¸²</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(<span class="string">&quot;jlkk&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;lopi&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;å°å‚…å“¥&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;e4we&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;alpo&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;yhjk&quot;</span>);</span><br><span class="line">list.add(<span class="string">&quot;plop&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è¦å­˜æ”¾çš„æ•°ç»„</span></span><br><span class="line">String[] tab = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¾ªç¯å­˜æ”¾</span></span><br><span class="line"><span class="keyword">for</span> (String key : list) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> key.hashCode() &amp; (tab.length - <span class="number">1</span>);  <span class="comment">// è®¡ç®—ç´¢å¼•ä½ç½®</span></span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;keyå€¼=%s Idx=%d&quot;</span>, key, idx));</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> == tab[idx]) &#123;</span><br><span class="line">        tab[idx] = key;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tab[idx] = tab[idx] + <span class="string">&quot;-&gt;&quot;</span> + key;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºæµ‹è¯•ç»“æœ</span></span><br><span class="line">System.out.println(JSON.toJSONString(tab));</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ•´ä½“çœ‹èµ·æ¥ä¹Ÿæ˜¯éå¸¸ç®€å•ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¤æ‚åº¦ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼›</p>
<ol>
<li>åˆå§‹åŒ–ä¸€ç»„å­—ç¬¦ä¸²é›†åˆï¼Œè¿™é‡Œåˆå§‹åŒ–äº† 7 ä¸ªã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªæ•°ç»„ç”¨äºå­˜æ”¾å­—ç¬¦ä¸²ï¼Œæ³¨æ„è¿™é‡Œçš„é•¿åº¦æ˜¯ 8ï¼Œä¹Ÿå°±æ˜¯ 2 çš„ 3 æ¬¡å¹‚ã€‚è¿™æ ·çš„æ•°ç»„é•¿åº¦æ‰ä¼šå‡ºç°ä¸€ä¸ª  <code>0111</code>  é™¤é«˜ä½ä»¥å¤–éƒ½æ˜¯ 1 çš„ç‰¹å¾ï¼Œä¹Ÿæ˜¯ä¸ºäº†æ•£åˆ—ã€‚</li>
<li>æ¥ä¸‹æ¥å°±æ˜¯å¾ªç¯å­˜æ”¾æ•°æ®ï¼Œè®¡ç®—å‡ºæ¯ä¸ªå­—ç¬¦ä¸²åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚ <code>key.hashCode() &amp; (tab.length - 1)</code> ã€‚</li>
<li>åœ¨å­—ç¬¦ä¸²å­˜æ”¾åˆ°æ•°ç»„çš„è¿‡ç¨‹ï¼Œå¦‚æœé‡åˆ°ç›¸åŒçš„å…ƒç´ ï¼Œè¿›è¡Œè¿æ¥æ“ä½œ <code>æ¨¡æ‹Ÿé“¾è¡¨çš„è¿‡ç¨‹</code> ã€‚</li>
<li>æœ€åè¾“å‡ºå­˜æ”¾ç»“æœã€‚</li>
</ol>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">keyå€¼=jlkk Idx=<span class="number">2</span></span><br><span class="line">keyå€¼=lopi Idx=<span class="number">4</span></span><br><span class="line">keyå€¼=å°å‚…å“¥ Idx=<span class="number">7</span></span><br><span class="line">keyå€¼=e4we Idx=<span class="number">5</span></span><br><span class="line">keyå€¼=alpo Idx=<span class="number">2</span></span><br><span class="line">keyå€¼=yhjk Idx=<span class="number">0</span></span><br><span class="line">keyå€¼=plop Idx=<span class="number">5</span></span><br><span class="line">æµ‹è¯•ç»“æœï¼š[<span class="string">&quot;yhjk&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;jlkk-&gt;alpo&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;lopi&quot;</span>,<span class="string">&quot;e4we-&gt;plop&quot;</span>,<span class="literal">null</span>,<span class="string">&quot;å°å‚…å“¥&quot;</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨æµ‹è¯•ç»“æœé¦–å…ˆæ˜¯è®¡ç®—å‡ºæ¯ä¸ªå…ƒç´ åœ¨æ•°ç»„çš„ Idxï¼Œä¹Ÿæœ‰å‡ºç°é‡å¤çš„ä½ç½®ã€‚</li>
<li>æœ€åæ˜¯æµ‹è¯•ç»“æœçš„è¾“å‡ºï¼Œ1ã€3ã€6ï¼Œä½ç½®æ˜¯ç©ºçš„ï¼Œ2ã€5ï¼Œä½ç½®æœ‰ä¸¤ä¸ªå…ƒç´ è¢«é“¾æ¥èµ·æ¥ <code>e4we-&gt;plop</code> ã€‚</li>
<li>è¿™å°±è¾¾åˆ°äº†æˆ‘ä»¬ä¸€ä¸ªæœ€åŸºæœ¬çš„è¦æ±‚ï¼Œå°†ä¸²å…ƒç´ æ•£åˆ—å­˜æ”¾åˆ°æ•°ç»„ä¸­ï¼Œæœ€åé€šè¿‡å­—ç¬¦ä¸²å…ƒç´ çš„ç´¢å¼• ID è¿›è¡Œè·å–å¯¹åº”å­—ç¬¦ä¸²ã€‚è¿™æ ·æ˜¯ HashMap çš„ä¸€ä¸ªæœ€åŸºæœ¬åŸç†ï¼Œæœ‰äº†è¿™ä¸ªåŸºç¡€åé¢å°±ä¼šæ›´å®¹æ˜“ç†è§£ HashMap çš„æºç å®ç°ã€‚</li>
</ul>
<h4 id="12-hashæ•£åˆ—ç¤ºæ„å›¾"><a class="markdownIt-Anchor" href="#12-hashæ•£åˆ—ç¤ºæ„å›¾">#</a> 1.2 Hash æ•£åˆ—ç¤ºæ„å›¾</h4>
<p>å¦‚æœä¸Šé¢çš„æµ‹è¯•ç»“æœä¸èƒ½åœ¨ä½ çš„å¤´è„‘ä¸­å¾ˆå¥½çš„å»ºç«‹å‡ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹ä»¥ä¸‹è¿™å¼ æ•£åˆ—ç¤ºæ„å›¾ï¼Œæ–¹ä¾¿ç†è§£ï¼›</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-01.png" alt="bugstack.cn Hashæ•£åˆ—ç¤ºæ„å›¾"></p>
<ul>
<li>è¿™å¼ å›¾å°±æ˜¯ä¸Šé¢ä»£ç å®ç°çš„å…¨è¿‡ç¨‹ï¼Œå°†æ¯ä¸€ä¸ªå­—ç¬¦ä¸²å…ƒç´ é€šè¿‡ Hash è®¡ç®—ç´¢å¼•ä½ç½®ï¼Œå­˜æ”¾åˆ°æ•°ç»„ä¸­ã€‚</li>
<li>é»„è‰²çš„ç´¢å¼• ID æ˜¯æ²¡æœ‰å…ƒç´ å­˜æ”¾ã€ç»¿è‰²çš„ç´¢å¼• ID å­˜æ”¾äº†ä¸€ä¸ªå…ƒç´ ã€çº¢è‰²çš„ç´¢å¼• ID å­˜æ”¾äº†ä¸¤ä¸ªå…ƒç´ ã€‚</li>
</ul>
<h4 id="httpsbugstackcnmdjavainterview2020-08-07-é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡hashmapæ ¸å¿ƒçŸ¥è¯†æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†æ·±åº¦å­¦ä¹ html_1-3-è¿™ä¸ªç®€å•çš„hashmapæœ‰å“ªäº›é—®é¢˜13-è¿™ä¸ªç®€å•çš„hashmapæœ‰å“ªäº›é—®é¢˜"><a class="markdownIt-Anchor" href="#httpsbugstackcnmdjavainterview2020-08-07-é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡hashmapæ ¸å¿ƒçŸ¥è¯†æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†æ·±åº¦å­¦ä¹ html_1-3-è¿™ä¸ªç®€å•çš„hashmapæœ‰å“ªäº›é—®é¢˜13-è¿™ä¸ªç®€å•çš„hashmapæœ‰å“ªäº›é—®é¢˜">#</a> [#](<a target="_blank" rel="noopener" href="https://bugstack.cn/md/java/interview/2020-08-07-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C">https://bugstack.cn/md/java/interview/2020-08-07 - é¢ç»æ‰‹å†Œ</a>ãƒ»ç¬¬ 3 ç¯‡ã€ŠHashMap æ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹.html#_1-3 - è¿™ä¸ªç®€å•çš„ hashmap æœ‰å“ªäº›é—®é¢˜) 1.3 è¿™ä¸ªç®€å•çš„ HashMap æœ‰å“ªäº›é—®é¢˜</h4>
<p>ä»¥ä¸Šæˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„ HashMapï¼Œæˆ–è€…è¯´è¿˜ç®—ä¸ä¸Š HashMapï¼Œåªèƒ½ç®—åšä¸€ä¸ªæ•£åˆ—æ•°æ®å­˜æ”¾çš„é›å½¢ã€‚ä½†è¿™æ ·çš„ä¸€ä¸ªæ•°æ®ç»“æ„æ”¾åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¼šæœ‰å“ªäº›é—®é¢˜å‘¢ï¼Ÿ</p>
<ol>
<li>è¿™é‡Œæ‰€æœ‰çš„å…ƒç´ å­˜æ”¾éƒ½éœ€è¦è·å–ä¸€ä¸ªç´¢å¼•ä½ç½®ï¼Œè€Œå¦‚æœå…ƒç´ çš„ä½ç½®ä¸å¤Ÿæ•£åˆ—ç¢°æ’ä¸¥é‡ï¼Œé‚£ä¹ˆå°±å¤±å»äº†æ•£åˆ—è¡¨å­˜æ”¾çš„æ„ä¹‰ï¼Œæ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ€§èƒ½ã€‚</li>
<li>åœ¨è·å–ç´¢å¼• ID çš„è®¡ç®—å…¬å¼ä¸­ï¼Œéœ€è¦æ•°ç»„é•¿åº¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œé‚£ä¹ˆæ€ä¹ˆè¿›è¡Œåˆå§‹åŒ–è¿™ä¸ªæ•°ç»„å¤§å°ã€‚</li>
<li>æ•°ç»„è¶Šå°ç¢°æ’çš„è¶Šå¤§ï¼Œæ•°ç»„è¶Šå¤§ç¢°æ’çš„è¶Šå°ï¼Œæ—¶é—´ä¸ç©ºé—´å¦‚ä½•å–èˆã€‚</li>
<li>ç›®å‰å­˜æ”¾ 7 ä¸ªå…ƒç´ ï¼Œå·²ç»æœ‰ä¸¤ä¸ªä½ç½®éƒ½å­˜æ”¾äº† 2 ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆé“¾è¡¨è¶Šæ¥è¶Šé•¿æ€ä¹ˆä¼˜åŒ–ã€‚</li>
<li>éšç€å…ƒç´ çš„ä¸æ–­æ·»åŠ ï¼Œæ•°ç»„é•¿åº¦ä¸è¶³æ‰©å®¹æ—¶ï¼Œæ€ä¹ˆæŠŠåŸæœ‰çš„å…ƒç´ ï¼Œæ‹†åˆ†åˆ°æ–°çš„ä½ç½®ä¸Šå»ã€‚</li>
</ol>
<p>ä»¥ä¸Šè¿™äº›é—®é¢˜å¯ä»¥å½’çº³ä¸ºï¼› <code>æ‰°åŠ¨å‡½æ•°</code> ã€ <code>åˆå§‹åŒ–å®¹é‡</code> ã€ <code>è´Ÿè½½å› å­</code> ã€ <code>æ‰©å®¹æ–¹æ³•</code> ä»¥åŠ <code>é“¾è¡¨å’Œçº¢é»‘æ ‘</code> è½¬æ¢çš„ä½¿ç”¨ç­‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé€ä¸ªé—®é¢˜è¿›è¡Œåˆ†æã€‚</p>
<h3 id="2-æ‰°åŠ¨å‡½æ•°"><a class="markdownIt-Anchor" href="#2-æ‰°åŠ¨å‡½æ•°">#</a> 2. æ‰°åŠ¨å‡½æ•°</h3>
<p>åœ¨ HashMap å­˜æ”¾å…ƒç´ æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç æ¥å¤„ç†å“ˆå¸Œå€¼ï¼Œè¿™æ˜¯ <code>java 8</code>  çš„æ•£åˆ—å€¼æ‰°åŠ¨å‡½æ•°ï¼Œç”¨äºä¼˜åŒ–æ•£åˆ—æ•ˆæœï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="type">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="21-ä¸ºä»€ä¹ˆä½¿ç”¨æ‰°åŠ¨å‡½æ•°"><a class="markdownIt-Anchor" href="#21-ä¸ºä»€ä¹ˆä½¿ç”¨æ‰°åŠ¨å‡½æ•°">#</a> 2.1 ä¸ºä»€ä¹ˆä½¿ç”¨æ‰°åŠ¨å‡½æ•°</h4>
<p>ç†è®ºä¸Šæ¥è¯´å­—ç¬¦ä¸²çš„ <code>hashCode</code>  æ˜¯ä¸€ä¸ª int ç±»å‹å€¼ï¼Œé‚£å¯ä»¥ç›´æ¥ä½œä¸ºæ•°ç»„ä¸‹æ ‡äº†ï¼Œä¸”ä¸ä¼šå‡ºç°ç¢°æ’ã€‚ä½†æ˜¯è¿™ä¸ª <code>hashCode</code>  çš„å–å€¼èŒƒå›´æ˜¯ [-2147483648, 2147483647]ï¼Œæœ‰å°†è¿‘ 40 äº¿çš„é•¿åº¦ï¼Œè°ä¹Ÿä¸èƒ½æŠŠæ•°ç»„åˆå§‹åŒ–çš„è¿™ä¹ˆå¤§ï¼Œå†…å­˜ä¹Ÿæ˜¯æ”¾ä¸ä¸‹çš„ã€‚</p>
<p>æˆ‘ä»¬é»˜è®¤åˆå§‹åŒ–çš„ Map å¤§å°æ˜¯ 16 ä¸ªé•¿åº¦  <code>DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4</code> ï¼Œæ‰€ä»¥è·å–çš„ Hash å€¼å¹¶ä¸èƒ½ç›´æ¥ä½œä¸ºä¸‹æ ‡ä½¿ç”¨ï¼Œéœ€è¦ä¸æ•°ç»„é•¿åº¦è¿›è¡Œå–æ¨¡è¿ç®—å¾—åˆ°ä¸€ä¸ªä¸‹æ ‡å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢åšçš„æ•£åˆ—åˆ—å­ã€‚</p>
<p>é‚£ä¹ˆï¼ŒhashMap æºç è¿™é‡Œä¸åªæ˜¯ç›´æ¥è·å–å“ˆå¸Œå€¼ï¼Œè¿˜è¿›è¡Œäº†ä¸€æ¬¡æ‰°åŠ¨è®¡ç®—ï¼Œ <code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code> ã€‚æŠŠå“ˆå¸Œå€¼å³ç§» 16 ä½ï¼Œä¹Ÿå°±æ­£å¥½æ˜¯è‡ªå·±é•¿åº¦çš„ä¸€åŠï¼Œä¹‹åä¸åŸå“ˆå¸Œå€¼åšå¼‚æˆ–è¿ç®—ï¼Œè¿™æ ·å°±æ··åˆäº†åŸå“ˆå¸Œå€¼ä¸­çš„é«˜ä½å’Œä½ä½ï¼Œå¢å¤§äº†<strong>éšæœºæ€§</strong>ã€‚è®¡ç®—æ–¹å¼å¦‚ä¸‹å›¾ï¼›</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-02.png" alt="bugstack.cn æ‰°åŠ¨å‡½æ•°"></p>
<ul>
<li>è¯´ç™½äº†ï¼Œä½¿ç”¨æ‰°åŠ¨å‡½æ•°å°±æ˜¯ä¸ºäº†å¢åŠ éšæœºæ€§ï¼Œè®©æ•°æ®å…ƒç´ æ›´åŠ å‡è¡¡çš„æ•£åˆ—ï¼Œå‡å°‘ç¢°æ’ã€‚</li>
</ul>
<h4 id="22-å®éªŒéªŒè¯æ‰°åŠ¨å‡½æ•°"><a class="markdownIt-Anchor" href="#22-å®éªŒéªŒè¯æ‰°åŠ¨å‡½æ•°">#</a> 2.2 å®éªŒéªŒè¯æ‰°åŠ¨å‡½æ•°</h4>
<p>ä»ä¸Šé¢çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œæ‰°åŠ¨å‡½æ•°ä½¿ç”¨äº†å“ˆå¸Œå€¼çš„é«˜åŠåŒºå’Œä½åŠåŒºåšå¼‚æˆ–ï¼Œæ··åˆåŸå§‹å“ˆå¸Œç çš„é«˜ä½å’Œä½ä½ï¼Œä»¥æ­¤æ¥åŠ å¤§ä½ä½åŒºçš„éšæœºæ€§ã€‚</p>
<p>ä½†çœ‹ä¸åˆ°å®éªŒæ•°æ®çš„è¯ï¼Œè¿™ç»ˆç©¶æ˜¯ä¸€æ®µç†è®ºï¼Œå…·ä½“è¿™æ®µå“ˆå¸Œå€¼çœŸçš„è¢«å¢åŠ äº†éšæœºæ€§æ²¡æœ‰ï¼Œå¹¶ä¸çŸ¥é“ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬è¦åšä¸€ä¸ªå®éªŒï¼Œè¿™ä¸ªå®éªŒæ˜¯è¿™æ ·åšï¼›</p>
<ol>
<li>é€‰å– 10 ä¸‡ä¸ªå•è¯è¯åº“</li>
<li>å®šä¹‰ 128 ä½é•¿åº¦çš„æ•°ç»„æ ¼å­</li>
<li>åˆ†åˆ«è®¡ç®—åœ¨æ‰°åŠ¨å’Œä¸æ‰°åŠ¨ä¸‹ï¼Œ10 ä¸‡å•è¯çš„ä¸‹æ ‡åˆ†é…åˆ° 128 ä¸ªæ ¼å­çš„æ•°é‡</li>
<li>ç»Ÿè®¡å„ä¸ªæ ¼å­æ•°é‡ï¼Œç”Ÿæˆæ³¢åŠ¨æ›²çº¿ã€‚å¦‚æœæ‰°åŠ¨å‡½æ•°ä¸‹çš„æ³¢åŠ¨æ›²çº¿ç›¸å¯¹æ›´å¹³ç¨³ï¼Œé‚£ä¹ˆè¯æ˜æ‰°åŠ¨å‡½æ•°æœ‰æ•ˆæœã€‚</li>
</ol>
<h5 id="221-æ‰°åŠ¨ä»£ç æµ‹è¯•"><a class="markdownIt-Anchor" href="#221-æ‰°åŠ¨ä»£ç æµ‹è¯•">#</a> 2.2.1 æ‰°åŠ¨ä»£ç æµ‹è¯•</h5>
<p><strong>æ‰°åŠ¨å‡½æ•°å¯¹æ¯”æ–¹æ³•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Disturb</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">disturbHashIdx</span><span class="params">(String key, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (size - <span class="number">1</span>) &amp; (key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; <span class="number">16</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">hashIdx</span><span class="params">(String key, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (size - <span class="number">1</span>) &amp; key.hashCode();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>disturbHashIdx</code>  æ‰°åŠ¨å‡½æ•°ä¸‹ï¼Œä¸‹æ ‡å€¼è®¡ç®—</li>
<li><code>hashIdx</code>  éæ‰°åŠ¨å‡½æ•°ä¸‹ï¼Œä¸‹æ ‡å€¼è®¡ç®—</li>
</ul>
<p><strong>å•å…ƒæµ‹è¯•</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10ä¸‡å•è¯å·²ç»åˆå§‹åŒ–åˆ°wordsä¸­</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_disturb</span><span class="params">()</span> &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ‰°åŠ¨å‡½æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> Disturb.disturbHashIdx(word, <span class="number">128</span>);</span><br><span class="line">        <span class="comment">// ä¸ä½¿ç”¨æ‰°åŠ¨å‡½æ•°</span></span><br><span class="line">        <span class="comment">// int idx = Disturb.hashIdx(word, 128);</span></span><br><span class="line">        <span class="keyword">if</span> (map.containsKey(idx)) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> map.get(idx);</span><br><span class="line">            map.put(idx, ++integer);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            map.put(idx, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(map.values());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šåˆ†åˆ«ç»Ÿè®¡ä¸¤ç§å‡½æ•°ä¸‹çš„ä¸‹æ ‡å€¼åˆ†é…ï¼Œæœ€ç»ˆå°†ç»Ÿè®¡ç»“æœæ”¾åˆ° excel ä¸­ç”Ÿæˆå›¾è¡¨ã€‚</p>
<h5 id="httpsbugstackcnmdjavainterview2020-08-07-é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡hashmapæ ¸å¿ƒçŸ¥è¯†æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†æ·±åº¦å­¦ä¹ html_2-2-2-æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨222-æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨"><a class="markdownIt-Anchor" href="#httpsbugstackcnmdjavainterview2020-08-07-é¢ç»æ‰‹å†Œ-ç¬¬3ç¯‡hashmapæ ¸å¿ƒçŸ¥è¯†æ‰°åŠ¨å‡½æ•°-è´Ÿè½½å› å­-æ‰©å®¹é“¾è¡¨æ‹†åˆ†æ·±åº¦å­¦ä¹ html_2-2-2-æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨222-æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨">#</a> [#](<a target="_blank" rel="noopener" href="https://bugstack.cn/md/java/interview/2020-08-07-%E9%9D%A2%E7%BB%8F%E6%89%8B%E5%86%8C">https://bugstack.cn/md/java/interview/2020-08-07 - é¢ç»æ‰‹å†Œ</a>ãƒ»ç¬¬ 3 ç¯‡ã€ŠHashMap æ ¸å¿ƒçŸ¥è¯†ï¼Œæ‰°åŠ¨å‡½æ•°ã€è´Ÿè½½å› å­ã€æ‰©å®¹é“¾è¡¨æ‹†åˆ†ï¼Œæ·±åº¦å­¦ä¹ ã€‹.html#_2-2-2 - æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨) 2.2.2 æ‰°åŠ¨å‡½æ•°æ•£åˆ—å›¾è¡¨</h5>
<p>ä»¥ä¸Šçš„ä¸¤å¼ å›¾ï¼Œåˆ†åˆ«æ˜¯æ²¡æœ‰ä½¿ç”¨æ‰°åŠ¨å‡½æ•°å’Œä½¿ç”¨æ‰°åŠ¨å‡½æ•°çš„ï¼Œä¸‹æ ‡åˆ†é…ã€‚å®éªŒæ•°æ®ï¼›</p>
<ol>
<li>10 ä¸‡ä¸ªä¸é‡å¤çš„å•è¯</li>
<li>128 ä¸ªæ ¼å­ï¼Œç›¸å½“äº 128 é•¿åº¦çš„æ•°ç»„</li>
</ol>
<p><strong>æœªä½¿ç”¨æ‰°åŠ¨å‡½æ•°</strong></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-03.png" alt="bugstack.cn æœªä½¿ç”¨æ‰°åŠ¨å‡½æ•°"></p>
<p><strong>ä½¿ç”¨æ‰°åŠ¨å‡½æ•°</strong></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-04.png" alt="bugstack.cn ä½¿ç”¨æ‰°åŠ¨å‡½æ•°"></p>
<ul>
<li>ä»è¿™ä¸¤ç§çš„å¯¹æ¯”å›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨ä½¿ç”¨äº†æ‰°åŠ¨å‡½æ•°åï¼Œæ•°æ®åˆ†é…çš„æ›´åŠ å‡åŒ€äº†ã€‚</li>
<li>æ•°æ®åˆ†é…å‡åŒ€ï¼Œä¹Ÿå°±æ˜¯æ•£åˆ—çš„æ•ˆæœæ›´å¥½ï¼Œå‡å°‘äº† hash çš„ç¢°æ’ï¼Œè®©æ•°æ®å­˜æ”¾å’Œè·å–çš„æ•ˆç‡æ›´ä½³ã€‚</li>
</ul>
<h3 id="3-åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­"><a class="markdownIt-Anchor" href="#3-åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­">#</a> 3. åˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½å› å­</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è®¨è®ºä¸‹ä¸€ä¸ªé—®é¢˜ï¼Œä»æˆ‘ä»¬æ¨¡ä»¿ HashMap çš„ä¾‹å­ä¸­ä»¥åŠ HashMap é»˜è®¤çš„åˆå§‹åŒ–å¤§å°é‡Œï¼Œéƒ½å¯ä»¥çŸ¥é“ï¼Œæ•£åˆ—æ•°ç»„éœ€è¦ä¸€ä¸ª 2 çš„å¹‚æ¬¡æ–¹çš„é•¿åº¦ï¼Œå› ä¸ºåªæœ‰ 2 çš„å¹‚æ¬¡æ–¹åœ¨å‡ 1 çš„æ—¶å€™ï¼Œæ‰ä¼šå‡ºç° <code>01111</code>  è¿™æ ·çš„å€¼ã€‚</p>
<p>é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åœ¨åˆå§‹åŒ– HashMap çš„æ—¶å€™ï¼Œå¦‚æœä¼ ä¸€ä¸ª 17 ä¸ªçš„å€¼ <code>new HashMap&lt;&gt;(17);</code> ï¼Œå®ƒä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<h4 id="31-å¯»æ‰¾2çš„å¹‚æ¬¡æ–¹æœ€å°å€¼"><a class="markdownIt-Anchor" href="#31-å¯»æ‰¾2çš„å¹‚æ¬¡æ–¹æœ€å°å€¼">#</a> 3.1 å¯»æ‰¾ 2 çš„å¹‚æ¬¡æ–¹æœ€å°å€¼</h4>
<p>åœ¨ HashMap çš„åˆå§‹åŒ–ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µæ–¹æ³•ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">HashMap</span><span class="params">(<span class="type">int</span> initialCapacity, <span class="type">float</span> loadFactor)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">this</span>.loadFactor = loadFactor;</span><br><span class="line">    <span class="built_in">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é˜ˆå€¼ <code>threshold</code> ï¼Œé€šè¿‡æ–¹æ³• <code>tableSizeFor</code>  è¿›è¡Œè®¡ç®—ï¼Œæ˜¯æ ¹æ®åˆå§‹åŒ–æ¥è®¡ç®—çš„ã€‚</li>
<li>è¿™ä¸ªæ–¹æ³•ä¹Ÿå°±æ˜¯è¦å¯»æ‰¾æ¯”åˆå§‹å€¼å¤§çš„ï¼Œæœ€å°çš„é‚£ä¸ª 2 è¿›åˆ¶æ•°å€¼ã€‚æ¯”å¦‚ä¼ äº† 17ï¼Œæˆ‘åº”è¯¥æ‰¾åˆ°çš„æ˜¯ 32ï¼ˆ2 çš„ 4 æ¬¡å¹‚æ˜¯ 16&lt;17, æ‰€ä»¥æ‰¾åˆ° 2 çš„ 5 æ¬¡å¹‚ 32ï¼‰ã€‚</li>
</ul>
<p>è®¡ç®—é˜ˆå€¼å¤§å°çš„æ–¹æ³•ï¼›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>MAXIMUM_CAPACITY = 1 &lt;&lt; 30ï¼Œè¿™ä¸ªæ˜¯ä¸´ç•ŒèŒƒå›´ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§çš„ Map é›†åˆã€‚</li>
<li>ä¹ä¸€çœ‹å¯èƒ½æœ‰ç‚¹æ™•ğŸ˜µæ€ä¹ˆéƒ½åœ¨å‘å³ç§»ä½ 1ã€2ã€4ã€8ã€16ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†æŠŠäºŒè¿›åˆ¶çš„å„ä¸ªä½ç½®éƒ½å¡«ä¸Š 1ï¼Œå½“äºŒè¿›åˆ¶çš„å„ä¸ªä½ç½®éƒ½æ˜¯ 1 ä»¥åï¼Œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ 2 çš„å¹‚æ¬¡æ–¹å‡ 1 äº†ï¼Œæœ€åæŠŠç»“æœåŠ  1 å†è¿”å›å³å¯ã€‚</li>
</ul>
<p>é‚£è¿™é‡Œæˆ‘ä»¬æŠŠ 17 è¿™æ ·ä¸€ä¸ªåˆå§‹åŒ–è®¡ç®—é˜ˆå€¼çš„è¿‡ç¨‹ï¼Œç”¨å›¾å±•ç¤ºå‡ºæ¥ï¼Œæ–¹ä¾¿ç†è§£ï¼›</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-05.png" alt="bugstack.cn è®¡ç®—é˜ˆå€¼"></p>
<h4 id="32-è´Ÿè½½å› å­"><a class="markdownIt-Anchor" href="#32-è´Ÿè½½å› å­">#</a> 3.2 è´Ÿè½½å› å­</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">float</span> <span class="variable">DEFAULT_LOAD_FACTOR</span> <span class="operator">=</span> <span class="number">0.75f</span>;  </span><br></pre></td></tr></table></figure>
<p><strong>è´Ÿè½½å› å­æ˜¯åšä»€ä¹ˆçš„ï¼Ÿ</strong></p>
<p>è´Ÿè½½å› å­ï¼Œå¯ä»¥ç†è§£æˆä¸€è¾†è½¦å¯æ‰¿é‡é‡é‡è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼ŒæŠŠè´§æ”¾åˆ°æ–°çš„è½¦ä¸Šã€‚</p>
<p>é‚£ä¹ˆåœ¨ HashMap ä¸­ï¼Œè´Ÿè½½å› å­å†³å®šäº†æ•°æ®é‡å¤šå°‘äº†ä»¥åè¿›è¡Œæ‰©å®¹ã€‚<em>è¿™é‡Œè¦æåˆ°ä¸Šé¢åšçš„ HashMap ä¾‹å­ï¼Œæˆ‘ä»¬å‡†å¤‡äº† 7 ä¸ªå…ƒç´ ï¼Œä½†æ˜¯æœ€åè¿˜æœ‰ 3 ä¸ªä½ç½®ç©ºä½™ï¼Œ2 ä¸ªä½ç½®å­˜æ”¾äº† 2 ä¸ªå…ƒç´ ã€‚</em> æ‰€ä»¥å¯èƒ½å³ä½¿ä½ æ•°æ®æ¯”æ•°ç»„å®¹é‡å¤§æ—¶ä¹Ÿæ˜¯ä¸ä¸€å®šèƒ½æ­£æ­£å¥½å¥½çš„æŠŠæ•°ç»„å æ»¡çš„ï¼Œè€Œæ˜¯åœ¨æŸäº›å°æ ‡ä½ç½®å‡ºç°äº†å¤§é‡çš„ç¢°æ’ï¼Œåªèƒ½åœ¨åŒä¸€ä¸ªä½ç½®ç”¨é“¾è¡¨å­˜æ”¾ï¼Œé‚£ä¹ˆè¿™æ ·å°±å¤±å»äº† Map æ•°ç»„çš„æ€§èƒ½ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„å¤§å°ä¸‹è¿›è¡Œæ‰©å®¹ï¼Œé»˜è®¤å€¼ 0.75 å°±æ˜¯è¯´å½“é˜ˆå€¼å®¹é‡å äº† 3/4 æ—¶èµ¶ç´§æ‰©å®¹ï¼Œå‡å°‘ Hash ç¢°æ’ã€‚</p>
<p>åŒæ—¶ 0.75 æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ å€¼ï¼Œåœ¨åˆ›å»º HashMap ä¹Ÿå¯ä»¥è°ƒæ•´ï¼Œæ¯”å¦‚ä½ å¸Œæœ›ç”¨æ›´å¤šçš„ç©ºé—´æ¢å–æ—¶é—´ï¼Œå¯ä»¥æŠŠè´Ÿè½½å› å­è°ƒçš„æ›´å°ä¸€äº›ï¼Œå‡å°‘ç¢°æ’ã€‚</p>
<h3 id="4-æ‰©å®¹å…ƒç´ æ‹†åˆ†"><a class="markdownIt-Anchor" href="#4-æ‰©å®¹å…ƒç´ æ‹†åˆ†">#</a> 4. æ‰©å®¹å…ƒç´ æ‹†åˆ†</h3>
<p>ä¸ºä»€ä¹ˆæ‰©å®¹ï¼Œå› ä¸ºæ•°ç»„é•¿åº¦ä¸è¶³äº†ã€‚é‚£æ‰©å®¹æœ€ç›´æ¥çš„é—®é¢˜ï¼Œå°±æ˜¯éœ€è¦æŠŠå…ƒç´ æ‹†åˆ†åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚æ‹†åˆ†å…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼ŒåŸ jdk1.7 ä¸­ä¼šéœ€è¦é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œä½†æ˜¯åˆ° jdk1.8 ä¸­å·²ç»è¿›è¡Œä¼˜åŒ–ï¼Œä¸å†éœ€è¦é‡æ–°è®¡ç®—ï¼Œæå‡äº†æ‹†åˆ†çš„æ€§èƒ½ï¼Œè®¾è®¡çš„è¿˜æ˜¯éå¸¸å·§å¦™çš„ã€‚</p>
<h4 id="41-æµ‹è¯•æ•°æ®"><a class="markdownIt-Anchor" href="#41-æµ‹è¯•æ•°æ®">#</a> 4.1 æµ‹è¯•æ•°æ®</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_hashMap</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="string">&quot;jlkk&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;lopi&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;jmdw&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;e4we&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;io98&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;nmhg&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;vfg6&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;gfrt&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;alpo&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;vfbh&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;bnhj&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;zuio&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;iu8e&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;yhjk&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;plop&quot;</span>);</span><br><span class="line">    list.add(<span class="string">&quot;dd0p&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String key : list) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å­—ç¬¦ä¸²ï¼š&quot;</span> + key + <span class="string">&quot; \tIdx(16)ï¼š&quot;</span> + ((<span class="number">16</span> - <span class="number">1</span>) &amp; hash) + <span class="string">&quot; \tBitå€¼ï¼š&quot;</span> + Integer.toBinaryString(hash) + <span class="string">&quot; - &quot;</span> + Integer.toBinaryString(hash &amp; <span class="number">16</span>) + <span class="string">&quot; \t\tIdx(32)ï¼š&quot;</span> + ((</span><br><span class="line">        System.out.println(Integer.toBinaryString(key.hashCode()) +<span class="string">&quot; &quot;</span>+ Integer.toBinaryString(hash) + <span class="string">&quot; &quot;</span> + Integer.toBinaryString((<span class="number">32</span> - <span class="number">1</span>) &amp; hash));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ç»“æœ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">å­—ç¬¦ä¸²ï¼šjlkk 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">3</span> 	Bitå€¼ï¼š<span class="number">1100011101001000010011</span> - <span class="number">10000</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">19</span></span><br><span class="line"><span class="number">1100011101001000100010</span> <span class="number">1100011101001000010011</span> <span class="number">10011</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šlopi 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">14</span> 	Bitå€¼ï¼š<span class="number">1100101100011010001110</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">14</span></span><br><span class="line"><span class="number">1100101100011010111100</span> <span class="number">1100101100011010001110</span> <span class="number">1110</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šjmdw 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">7</span> 	Bitå€¼ï¼š<span class="number">1100011101010100100111</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">7</span></span><br><span class="line"><span class="number">1100011101010100010110</span> <span class="number">1100011101010100100111</span> <span class="number">111</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼še4we 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">3</span> 	Bitå€¼ï¼š<span class="number">1011101011101101010011</span> - <span class="number">10000</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">19</span></span><br><span class="line"><span class="number">1011101011101101111101</span> <span class="number">1011101011101101010011</span> <span class="number">10011</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šio98 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">4</span> 	Bitå€¼ï¼š<span class="number">1100010110001011110100</span> - <span class="number">10000</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">20</span></span><br><span class="line"><span class="number">1100010110001011000101</span> <span class="number">1100010110001011110100</span> <span class="number">10100</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šnmhg 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">13</span> 	Bitå€¼ï¼š<span class="number">1100111010011011001101</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">13</span></span><br><span class="line"><span class="number">1100111010011011111110</span> <span class="number">1100111010011011001101</span> <span class="number">1101</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼švfg6 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">8</span> 	Bitå€¼ï¼š<span class="number">1101110010111101101000</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">8</span></span><br><span class="line"><span class="number">1101110010111101011111</span> <span class="number">1101110010111101101000</span> <span class="number">1000</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šgfrt 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">1</span> 	Bitå€¼ï¼š<span class="number">1100000101111101010001</span> - <span class="number">10000</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">17</span></span><br><span class="line"><span class="number">1100000101111101100001</span> <span class="number">1100000101111101010001</span> <span class="number">10001</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šalpo 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">7</span> 	Bitå€¼ï¼š<span class="number">1011011011101101000111</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">7</span></span><br><span class="line"><span class="number">1011011011101101101010</span> <span class="number">1011011011101101000111</span> <span class="number">111</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼švfbh 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">1</span> 	Bitå€¼ï¼š<span class="number">1101110010111011000001</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">1</span></span><br><span class="line"><span class="number">1101110010111011110110</span> <span class="number">1101110010111011000001</span> <span class="number">1</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šbnhj 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">0</span> 	Bitå€¼ï¼š<span class="number">1011100011011001100000</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">0</span></span><br><span class="line"><span class="number">1011100011011001001110</span> <span class="number">1011100011011001100000</span> <span class="number">0</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šzuio 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">8</span> 	Bitå€¼ï¼š<span class="number">1110010011100110011000</span> - <span class="number">10000</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">24</span></span><br><span class="line"><span class="number">1110010011100110100001</span> <span class="number">1110010011100110011000</span> <span class="number">11000</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šiu8e 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">8</span> 	Bitå€¼ï¼š<span class="number">1100010111100101101000</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">8</span></span><br><span class="line"><span class="number">1100010111100101011001</span> <span class="number">1100010111100101101000</span> <span class="number">1000</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šyhjk 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">8</span> 	Bitå€¼ï¼š<span class="number">1110001001010010101000</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">8</span></span><br><span class="line"><span class="number">1110001001010010010000</span> <span class="number">1110001001010010101000</span> <span class="number">1000</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šplop 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">9</span> 	Bitå€¼ï¼š<span class="number">1101001000110011101001</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">9</span></span><br><span class="line"><span class="number">1101001000110011011101</span> <span class="number">1101001000110011101001</span> <span class="number">1001</span></span><br><span class="line">å­—ç¬¦ä¸²ï¼šdd0p 	<span class="title function_">Idx</span><span class="params">(<span class="number">16</span>)</span>ï¼š<span class="number">14</span> 	Bitå€¼ï¼š<span class="number">1011101111001011101110</span> - <span class="number">0</span> 		Idx(<span class="number">32</span>)ï¼š<span class="number">14</span></span><br><span class="line"><span class="number">1011101111001011000000</span> <span class="number">1011101111001011101110</span> <span class="number">1110</span></span><br></pre></td></tr></table></figure>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬éšæœºä½¿ç”¨ä¸€äº›å­—ç¬¦ä¸²è®¡ç®—ä»–ä»¬åˆ†åˆ«åœ¨ 16 ä½é•¿åº¦å’Œ 32 ä½é•¿åº¦æ•°ç»„ä¸‹çš„ç´¢å¼•åˆ†é…æƒ…å†µï¼Œçœ‹å“ªäº›æ•°æ®è¢«é‡æ–°è·¯ç”±åˆ°äº†æ–°çš„åœ°å€ã€‚</li>
<li>åŒæ—¶ï¼Œè¿™é‡Œè¿˜å¯ä»¥è§‚å¯ŸğŸ•µå‡ºä¸€ä¸ªéå¸¸é‡è¦çš„ä¿¡æ¯ï¼ŒåŸå“ˆå¸Œå€¼ä¸æ‰©å®¹æ–°å¢å‡ºæ¥çš„é•¿åº¦ 16ï¼Œè¿›è¡Œ &amp; è¿ç®—ï¼Œå¦‚æœå€¼ç­‰äº 0ï¼Œåˆ™ä¸‹æ ‡ä½ç½®ä¸å˜ã€‚å¦‚æœä¸ä¸º 0ï¼Œé‚£ä¹ˆæ–°çš„ä½ç½®åˆ™æ˜¯åŸæ¥ä½ç½®ä¸ŠåŠ  16ã€‚ï½›è¿™ä¸ªåœ°æ–¹éœ€è¦å¥½å¥½ç†è§£ä¸‹ï¼Œå¹¶çœ‹å®éªŒæ•°æ®ï½</li>
<li>è¿™æ ·ä¸€æ¥ï¼Œå°±ä¸éœ€è¦åœ¨é‡æ–°è®¡ç®—æ¯ä¸€ä¸ªæ•°ç»„ä¸­å…ƒç´ çš„å“ˆå¸Œå€¼äº†ã€‚</li>
</ul>
<p>4.2 æ•°æ®è¿ç§»</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/interview-4-06.png" alt="bugstack.cn æ•°æ®è¿ç§»"></p>
<ul>
<li>è¿™å¼ å›¾å°±æ˜¯åŸ 16 ä½é•¿åº¦æ•°ç»„å…ƒç´ ï¼Œå‘ 32 ä½æ‰©å®¹åæ•°ç»„è½¬ç§»çš„è¿‡ç¨‹ã€‚</li>
<li>å¯¹ 31 å–æ¨¡ä¿ç•™ä½ 5 ä½ï¼Œå¯¹ 15 å–æ¨¡ä¿ç•™ä½ 4 ä½ï¼Œä¸¤è€…çš„å·®å¼‚å°±åœ¨äºç¬¬ 5 ä½æ˜¯å¦ä¸º 1ï¼Œæ˜¯çš„è¯åˆ™éœ€è¦åŠ ä¸Šå¢é‡ï¼Œä¸º 0 çš„è¯åˆ™ä¸éœ€è¦æ”¹å˜</li>
<li>å…¶ä¸­é»„è‰²åŒºåŸŸå…ƒç´  <code>zuio</code>  å› è®¡ç®—ç»“æœ  <code>hash &amp; oldCap</code>  ä½ä½ç¬¬ 5 ä½ä¸º 1ï¼Œåˆ™è¢«è¿ç§»åˆ°ä¸‹æ ‡ä½ç½® 24ã€‚</li>
<li>åŒæ—¶è¿˜æ˜¯ç”¨é‡æ–°è®¡ç®—å“ˆå¸Œå€¼çš„æ–¹å¼éªŒè¯äº†ï¼Œç¡®å®åˆ†é…åˆ° 24 çš„ä½ç½®ï¼Œå› ä¸ºè¿™æ˜¯åœ¨äºŒè¿›åˆ¶è®¡ç®—ä¸­è¡¥ 1 çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¸Šé¢ç®€åŒ–çš„æ–¹å¼ç¡®å®šå“ˆå¸Œå€¼çš„ä½ç½®ã€‚</li>
</ul>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆ e.hash &amp; oldCap == 0 ä¸ºä»€ä¹ˆå¯ä»¥åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»ä½ï¼Œè€Œä¸æ˜¯å†æ¬¡è®¡ç®— hash;</p>
<p>ä»ç„¶æ˜¯åŸå§‹é•¿åº¦ä¸º 16 ä¸¾ä¾‹:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">old:</span><br><span class="line"><span class="number">10</span>: <span class="number">0000</span> <span class="number">1010</span></span><br><span class="line"><span class="number">15</span>: <span class="number">0000</span> <span class="number">1111</span></span><br><span class="line">&amp;: <span class="number">0000</span> <span class="number">1010</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span>:</span><br><span class="line"><span class="number">10</span>: <span class="number">0000</span> <span class="number">1010</span></span><br><span class="line"><span class="number">31</span>: <span class="number">0001</span> <span class="number">1111</span></span><br><span class="line">&amp;: <span class="number">0000</span> <span class="number">1010</span> </span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥å¾ˆè½»æ˜“çš„çœ‹å‡ºï¼Œä¸¤æ¬¡ indexFor () çš„å·®åˆ«åªæ˜¯ç¬¬äºŒæ¬¡å‚ä¸ä½äºæ¯”ç¬¬ä¸€æ¬¡å·¦è¾¹æœ‰ä¸€ä½ä» 0 å˜ä¸º 1, è€Œè¿™ä¸ªå˜åŒ–çš„ 1 åˆšå¥½æ˜¯ oldCap, é‚£ä¹ˆåªéœ€è¦åˆ¤æ–­åŸ key çš„ hash è¿™ä¸ªä½ä¸Šæ˜¯å¦ä¸º 1: è‹¥æ˜¯ 1, åˆ™éœ€è¦ç§»åŠ¨è‡³ oldCap + i çš„æ§½ä½ï¼Œè‹¥ä¸º 0, åˆ™ä¸éœ€è¦ç§»åŠ¨ï¼›</p>
<p>è¿™ä¹Ÿæ˜¯ HashMap çš„é•¿åº¦å¿…é¡»ä¿è¯æ˜¯ 2 çš„å¹‚æ¬¡æ–¹çš„åŸå› ï¼Œæ­£å› ä¸ºè¿™ç§ç¯ç¯ç›¸æ‰£çš„è®¾è®¡ï¼ŒHashMap.loadFactor çš„é€‰å€¼æ˜¯ 3/4 å°±èƒ½ç†è§£äº†ï¼Œtable.length * 3/4 å¯ä»¥è¢«ä¼˜åŒ–ä¸º ((table.length&gt;&gt; 2) &lt;&lt; 2) - (table.length &gt;&gt; 2) == table.length - (table.length &gt;&gt; 2), JAVA çš„ä½è¿ç®—æ¯”ä¹˜é™¤çš„æ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥å– 3/4 åœ¨ä¿è¯ hash å†²çªå°çš„æƒ…å†µä¸‹å…¼é¡¾äº†æ•ˆç‡ï¼›</p>
<h1 id="é¢è¯•é¢˜æ€»ç»“"><a class="markdownIt-Anchor" href="#é¢è¯•é¢˜æ€»ç»“">#</a> é¢è¯•é¢˜æ€»ç»“</h1>
<h1 id="question"><a class="markdownIt-Anchor" href="#question">#</a> Question</h1>
<h4 id="1ä¸ºä»€ä¹ˆhashmapå“ˆå¸Œè¡¨ä¸­æ•°ç»„é•¿åº¦æ€»æ˜¯å–-2-çš„å¹‚æ¬¡æ–¹"><a class="markdownIt-Anchor" href="#1ä¸ºä»€ä¹ˆhashmapå“ˆå¸Œè¡¨ä¸­æ•°ç»„é•¿åº¦æ€»æ˜¯å–-2-çš„å¹‚æ¬¡æ–¹">#</a> 1. ä¸ºä»€ä¹ˆ HashMap å“ˆå¸Œè¡¨ä¸­æ•°ç»„é•¿åº¦æ€»æ˜¯å– 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿ</h4>
<h6 id="æ•£åˆ—æ•°ç»„éœ€è¦ä¸€ä¸ª2çš„å¹‚æ¬¡æ–¹çš„é•¿åº¦å› ä¸ºåªæœ‰2çš„å¹‚æ¬¡æ–¹åœ¨å‡1çš„æ—¶å€™æ‰ä¼šå‡ºç°01111è¿™æ ·çš„å€¼"><a class="markdownIt-Anchor" href="#æ•£åˆ—æ•°ç»„éœ€è¦ä¸€ä¸ª2çš„å¹‚æ¬¡æ–¹çš„é•¿åº¦å› ä¸ºåªæœ‰2çš„å¹‚æ¬¡æ–¹åœ¨å‡1çš„æ—¶å€™æ‰ä¼šå‡ºç°01111è¿™æ ·çš„å€¼">#</a> æ•£åˆ—æ•°ç»„éœ€è¦ä¸€ä¸ª 2 çš„å¹‚æ¬¡æ–¹çš„é•¿åº¦ï¼Œå› ä¸ºåªæœ‰ 2 çš„å¹‚æ¬¡æ–¹åœ¨å‡ 1 çš„æ—¶å€™ï¼Œæ‰ä¼šå‡ºç° 01111 è¿™æ ·çš„å€¼ã€‚</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡è·å–å­˜å‚¨å†…å®¹çš„hashcodeï¼Œå¹¶ä¸”å¯¹é•¿åº¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹çš„æ•°ç»„é•¿åº¦-1è¿›è¡Œä¸è¿ç®—å¾—åˆ°ä¸€ä¸ªå¯ä»¥åœ¨æ•°ç»„ä¸­å‡ºç°çš„ä½ç½®</span></span><br><span class="line"><span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> key.hashCode() &amp; (tab.length - <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å“ˆå¸Œè¡¨ä¸­æ•°ç»„é•¿åº¦æ€»æ˜¯å– <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ï¼Œè¿™æ˜¯å› ä¸ºå¯¹äºå¤§å¤šæ•°çš„è´¨æ•°æ¥è¯´ï¼Œå®ƒä»¬çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­åªæœ‰å°‘æ•°ä½æ˜¯ä¸º <span class="number">1</span>ã€‚å¦‚æœä½¿ç”¨ä¸€ä¸ªä¸æ˜¯ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹çš„æ•°ç»„é•¿åº¦ï¼Œé‚£ä¹ˆå½“å…ƒç´ çš„å“ˆå¸Œæ˜ å°„åˆ°ç´¢å¼•æ—¶ï¼Œå°±ä¼šå‡ºç°æŸäº›ç´¢å¼•æ°¸è¿œæ— æ³•è¢«è®¿é—®åˆ°çš„æƒ…å†µï¼Œè¿™å°±æµªè´¹äº†å“ˆå¸Œè¡¨çš„ç©ºé—´ã€‚</span><br><span class="line"></span><br><span class="line">ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦åœ¨ä¸€ä¸ªå¤§å°ä¸º <span class="number">5</span> çš„æ•°ç»„ä¸­æ’å…¥ <span class="number">10</span> ä¸ªå…ƒç´  &#123;a,b,c,d,e,f,g,h,i,j&#125;ï¼Œè€Œå“ˆå¸Œå‡½æ•°å°†ä»–ä»¬ä¾æ¬¡æ˜ å°„åˆ°ä¸‹æ ‡ä½ç½®ï¼š[<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸‰ä¸ªä¸‹æ ‡ï¼ˆ<span class="number">5</span>ã€<span class="number">6</span>ã€<span class="number">7</span>ï¼‰å§‹ç»ˆæ²¡æœ‰è¢«æ˜ å°„åˆ°ï¼Œå®Œå…¨æµªè´¹äº†è¿™å‡ ä¸ªä¸‹æ ‡çš„å­˜å‚¨ç©ºé—´ã€‚ä½†å¦‚æœæ•°ç»„é•¿åº¦ä¸º <span class="number">8</span>ï¼Œé‚£ä¹ˆä¸Šè¿°å…ƒç´ çš„å“ˆå¸Œå€¼æŒ‰ç…§ä¸Šé¢çš„æ˜ å°„è§„åˆ™å¯ä»¥å¾—åˆ°çš„ä¸‹æ ‡åˆ†åˆ«æ˜¯ [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] % <span class="number">8</span> = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]ï¼Œä¸ä¼šå‡ºç°ä»»ä½•ä¸‹æ ‡è¢«æµªè´¹çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœå°†æ•°ç»„é•¿åº¦æ”¹ä¸º <span class="number">7</span>ï¼Œé‚£ä¹ˆä¸Šè¿°å…ƒç´ çš„å“ˆå¸Œå€¼æŒ‰ç…§ä¸Šé¢çš„æ˜ å°„è§„åˆ™å¯ä»¥å¾—åˆ°çš„ä¸‹æ ‡åˆ†åˆ«æ˜¯ [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] % <span class="number">7</span> = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>]ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œç´¢å¼•ä¸º <span class="number">5</span>ã€<span class="number">6</span> çš„ç©ºé—´ä»ç„¶è¢«æµªè´¹äº†ã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤ï¼Œä¸ºäº†é¿å…åœ¨å“ˆå¸Œè¡¨ä¸­æµªè´¹å­˜å‚¨ç©ºé—´ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šé€‰æ‹©ä½¿ç”¨ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ä½œä¸ºå“ˆå¸Œè¡¨çš„å¤§å°ã€‚è¿™æ ·ï¼Œåœ¨è®¡ç®—å…ƒç´ çš„ä½ç½®æ—¶ï¼Œåªéœ€è¦å¯¹å“ˆå¸Œç è¿›è¡Œä½è¿ç®—å³å¯ï¼Œä¸éœ€è¦è¿›è¡Œé™¤æ³•ç­‰å¤æ‚çš„è®¡ç®—ã€‚åŒæ—¶ï¼Œç”±äº <span class="number">2</span> çš„å¹‚æ¬¡æ–¹æ»¡è¶³ <span class="number">2</span>^n2*n*ï¼Œæ‰€ä»¥ç”¨ä½è¿ç®—æ¥ä»£æ›¿é™¤æ³•æˆ–å–æ¨¡æ“ä½œä¹Ÿèƒ½å¤Ÿæé«˜è¿è¡Œæ•ˆç‡ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="2hashmapæ€ä¹ˆä¿è¯å“ˆå¸Œè¡¨é•¿åº¦æ˜¯-2-çš„å¹‚æ¬¡æ–¹"><a class="markdownIt-Anchor" href="#2hashmapæ€ä¹ˆä¿è¯å“ˆå¸Œè¡¨é•¿åº¦æ˜¯-2-çš„å¹‚æ¬¡æ–¹">#</a> 2.HashMap æ€ä¹ˆä¿è¯å“ˆå¸Œè¡¨é•¿åº¦æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ Java ä¸­ï¼Œå“ˆå¸Œè¡¨çš„é•¿åº¦æ€»æ˜¯ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ã€‚è¿™æ˜¯é€šè¿‡ HashMap ç±»ä¸­çš„ä¸€ä¸ªåä¸º `tableSizeFor(<span class="type">int</span> cap)` çš„é™æ€æ–¹æ³•æ¥å®ç°çš„ã€‚</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ–¹æ³•ä¼šé¦–å…ˆå°†ä¼ å…¥çš„å‚æ•°å‡å» <span class="number">1</span>ï¼Œç„¶åå°†ç»“æœå³ç§»ä¸€ä½ï¼Œåœ¨è¿™ä¸ªå€¼ä¸ŠåŠ  <span class="number">1</span>ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœå°±æ˜¯å¤§äºç­‰äºåŸå§‹å‚æ•°ä¸”æœ€æ¥è¿‘åŸå§‹å‚æ•°çš„ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ <span class="number">7</span>ï¼Œåˆ™æŒ‰ç…§ä¸Šè¿°ç®—æ³•å¯ä»¥å¾—åˆ° <span class="number">8</span>ï¼š(((<span class="number">7</span> - <span class="number">1</span>) &gt;&gt;&gt; <span class="number">1</span>) + <span class="number">1</span>) = ((<span class="number">0110</span>)_2 &gt;&gt;&gt; <span class="number">1</span> + <span class="number">1</span>) = (<span class="number">0011</span>)_2 + (<span class="number">0001</span>)_2 = (<span class="number">0100</span>)_2 = <span class="number">8</span>(((<span class="number">7</span>âˆ’<span class="number">1</span>)&gt;&gt;&gt;<span class="number">1</span>)+<span class="number">1</span>)=((<span class="number">0110</span>)<span class="number">2</span>&gt;&gt;&gt;<span class="number">1</span>+<span class="number">1</span>)=(<span class="number">0011</span>)<span class="number">2</span>+(<span class="number">0001</span>)<span class="number">2</span>=(<span class="number">0100</span>)<span class="number">2</span>=<span class="number">8</span>ã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å“ˆå¸Œè¡¨æ—¶ï¼Œåªéœ€è¦å°†åˆå§‹å®¹é‡è®¾ç½®ä¸ºéœ€è¦å­˜å‚¨çš„å…ƒç´ æ•°ç›®é™¤ä»¥è´Ÿè½½å› å­ï¼ˆload factorï¼‰ï¼Œç„¶åè°ƒç”¨ `tableSizeFor` æ–¹æ³•è¿›è¡Œå¤„ç†å³å¯ã€‚è¿™æ ·å°±èƒ½å¤Ÿä¿è¯å“ˆå¸Œè¡¨çš„é•¿åº¦å§‹ç»ˆæ˜¯ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ï¼Œå¹¶è¾¾åˆ°è¾ƒå¥½çš„æ€§èƒ½å’Œç©ºé—´åˆ©ç”¨ç‡ã€‚</span><br><span class="line"></span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶è¿™ç§æ–¹å¼ç¡®å®å¯ä»¥ä¿è¯å“ˆå¸Œè¡¨çš„é•¿åº¦æ˜¯ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ï¼Œä½†æœ‰æ—¶å€™ä¹Ÿå¯èƒ½ä¼šå‡ºç°å“ˆå¸Œå†²çªçš„æƒ…å†µã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°ã€è´Ÿè½½å› å­ç­‰å‚æ•°æ¥é¿å…å“ˆå¸Œå†²çªï¼Œå¹¶æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="3åœ¨hashmapå­˜æ”¾å…ƒç´ æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç æ¥å¤„ç†å“ˆå¸Œå€¼è¿™æ˜¯java-8çš„æ•£åˆ—å€¼æ‰°åŠ¨å‡½æ•°ç”¨äºä¼˜åŒ–æ•£åˆ—æ•ˆæœ"><a class="markdownIt-Anchor" href="#3åœ¨hashmapå­˜æ”¾å…ƒç´ æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç æ¥å¤„ç†å“ˆå¸Œå€¼è¿™æ˜¯java-8çš„æ•£åˆ—å€¼æ‰°åŠ¨å‡½æ•°ç”¨äºä¼˜åŒ–æ•£åˆ—æ•ˆæœ">#</a> 3. åœ¨ HashMap å­˜æ”¾å…ƒç´ æ—¶å€™æœ‰è¿™æ ·ä¸€æ®µä»£ç æ¥å¤„ç†å“ˆå¸Œå€¼ï¼Œè¿™æ˜¯ java 8 çš„æ•£åˆ—å€¼æ‰°åŠ¨å‡½æ•°ï¼Œç”¨äºä¼˜åŒ–æ•£åˆ—æ•ˆæœ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(Object key)</span>&#123;</span><br><span class="line">	<span class="type">int</span> h;</span><br><span class="line">	<span class="keyword">return</span> (key == <span class="literal">null</span>) ? <span class="number">0</span> : (h = key.hashcode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4hashä¸ºä»€ä¹ˆç”¨31è®¡ç®—"><a class="markdownIt-Anchor" href="#4hashä¸ºä»€ä¹ˆç”¨31è®¡ç®—">#</a> 4.Hash ä¸ºä»€ä¹ˆç”¨ 31 è®¡ç®—ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	ä½¿ç”¨ <span class="number">31</span> è¿™ä¸ªç³»æ•°çš„åŸå› æ˜¯å› ä¸ºå®ƒæ—¢æ˜¯ä¸€ä¸ªè´¨æ•°ï¼Œåˆå¯ä»¥é€šè¿‡ç§»ä½å’Œå‡æ³•ç­‰ç®€å•çš„è¿ç®—æ¥å®ç°ä¹˜æ³•ã€‚åŒæ—¶ï¼Œç”±äº <span class="number">31</span> åœ¨äºŒè¿›åˆ¶ä¸­åªæœ‰ä¸€ä¸ªéé›¶çš„æ¯”ç‰¹ä½ï¼Œå› æ­¤ç”¨ <span class="number">31</span> è¿›è¡Œä¹˜æ³•ç›¸å½“äºè¿›è¡Œäº†ä½è¿ç®—å’ŒåŠ æ³•çš„ç»„åˆï¼Œè¿™æ ·ä¸ä»…èƒ½å¤Ÿä¿è¯é«˜æ•ˆè¿ç®—ï¼Œè¿˜èƒ½å¤Ÿé¿å…å“ˆå¸Œå†²çªã€‚</span><br><span class="line">	</span><br><span class="line"><span class="number">31</span>å…·æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼š</span><br><span class="line">	<span class="number">1.</span>å°è´¨æ•°ï¼š<span class="number">31</span> æ˜¯ä¸€ä¸ªè¾ƒå°çš„è´¨æ•°ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­è¢«ç”¨æ¥ä¹˜ä»¥é”®çš„å“ˆå¸Œç ï¼Œä½¿å¾—ç»“æœä¸ä¼šå¤ªå¤§ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ç›¸å¯¹äºå…¶ä»–çš„è´¨æ•°ï¼Œ<span class="number">31</span> æ›´æ˜“äºè¢« CPU ç¼“å­˜ï¼Œè¿™ä¹Ÿæœ‰åŠ©äºæå‡å“ˆå¸Œè¡¨çš„æŸ¥è¯¢é€Ÿåº¦ã€‚</span><br><span class="line">	<span class="number">2.</span>å¯é€†æ€§ï¼šå› ä¸º <span class="number">31</span> æ˜¯è´¨æ•°ä¸”æ¯”è¾ƒå°ï¼Œæ‰€ä»¥åªè¦å“ˆå¸Œè¡¨çš„å¤§å°è¶³å¤Ÿå¤§ï¼Œåœ¨ä¹˜æ³•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®æº¢å‡ºæ˜¯ä¸ä¼šå½±å“å“ˆå¸Œç»“æœçš„ã€‚è€Œä¸”ï¼Œ<span class="number">31</span> çš„é€†å…ƒ <span class="number">0x9e3779b1</span> æ˜¯ä¸€ä¸ªå›ºå®šçš„å¸¸é‡ï¼Œä¹Ÿå¾ˆå®¹æ˜“è®¡ç®—ï¼Œè¿™æœ‰åŠ©äºåœ¨éœ€è¦æ¢å¤å“ˆå¸Œç æ—¶è¿›è¡Œé€†è¿ç®—ã€‚</span><br><span class="line"></span><br><span class="line">	åœ¨å®ç°å“ˆå¸Œå‡½æ•°æ—¶ï¼Œä½¿ç”¨ç³»æ•° <span class="number">31</span> å¯ä»¥ä¿è¯é«˜æ•ˆæ€§ã€å¯é€†æ€§å’Œä½å†²çªç‡ï¼Œå› æ­¤åœ¨ Java ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="5hashmapæ‰°åŠ¨å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¯ä»¥è¢«åº”ç”¨åœ¨å“ªäº›åœ°æ–¹"><a class="markdownIt-Anchor" href="#5hashmapæ‰°åŠ¨å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆä»¥åŠå®ƒå¯ä»¥è¢«åº”ç”¨åœ¨å“ªäº›åœ°æ–¹">#</a> 5.HashMap æ‰°åŠ¨å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒå¯ä»¥è¢«åº”ç”¨åœ¨å“ªäº›åœ°æ–¹ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">æ‰°åŠ¨å‡½æ•°æ˜¯ä¸€ç§ç”¨äºå¢å¼ºå“ˆå¸Œå‡½æ•°çš„æŠ€æœ¯ã€‚å®ƒé€šå¸¸è¢«ç”¨æ¥å¯¹åŸå§‹å“ˆå¸Œå€¼è¿›è¡Œæ··æ·†å’Œæ‰°åŠ¨ï¼Œä»è€Œå‡å°å“ˆå¸Œå†²çªçš„å‘ç”Ÿç‡ã€‚</span><br><span class="line">	</span><br><span class="line">	å…·ä½“æ¥è¯´ï¼Œæ‰°åŠ¨å‡½æ•°ä¼šå°†åŸå§‹å“ˆå¸Œå€¼ä¸å¦ä¸€ä¸ªæ•°å€¼è¿›è¡Œæ··åˆï¼Œå¹¶å†æ¬¡è¿ç”¨å“ˆå¸Œå‡½æ•°äº§ç”Ÿæœ€ç»ˆçš„å“ˆå¸Œå€¼ã€‚è¿™ä¸ªé¢å¤–çš„æ•°å€¼å¯ä»¥æ˜¯ä»»æ„çš„å›ºå®šå€¼æˆ–éšæœºæ•°ï¼Œç›®çš„æ˜¯ä½¿å¾—ä¸åŒçš„å“ˆå¸Œå€¼åœ¨è¿›è¡Œæ··æ·†ä¹‹åï¼Œä»ç„¶èƒ½å¤Ÿä¿æŒä¸€å®šçš„åˆ†æ•£æ€§ï¼Œä»è€Œå‡å°å“ˆå¸Œå†²çªçš„æ¦‚ç‡ã€‚</span><br><span class="line"></span><br><span class="line">æ‰°åŠ¨å‡½æ•°å¯ä»¥è¢«åº”ç”¨åœ¨è®¸å¤šåœ°æ–¹ï¼Œä¾‹å¦‚ï¼š</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>å“ˆå¸Œè¡¨ï¼šåœ¨å“ˆå¸Œè¡¨ä¸­ï¼Œæ‰°åŠ¨å‡½æ•°å¯ä»¥ç”¨æ¥å¢åŠ é”®çš„éšæœºæ€§ï¼Œå‡å°‘å“ˆå¸Œå†²çªçš„å‘ç”Ÿç‡ï¼Œä»è€Œæé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½ã€‚Java ä¸­çš„ HashMap å°±ä½¿ç”¨äº†æ‰°åŠ¨å‡½æ•°å¯¹é”®çš„å“ˆå¸Œç è¿›è¡Œæ··æ·†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>åŠ å¯†ç®—æ³•ï¼šåœ¨ä¸€äº›åŠ å¯†ç®—æ³•ä¸­ï¼Œä¹Ÿä¼šä½¿ç”¨æ‰°åŠ¨å‡½æ•°æ¥å¢åŠ å¯†ç ç†µï¼Œå¹¶æé«˜åŠ å¯†å¼ºåº¦ã€‚ä¾‹å¦‚ï¼ŒMD5 ç®—æ³•å°±é‡‡ç”¨äº†ä¸€ç³»åˆ—æ‰°åŠ¨å‡½æ•°å¯¹æ•°æ®è¿›è¡Œæ··æ·†ã€‚</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>å›¾åƒå¤„ç†ï¼šåœ¨å›¾åƒå¤„ç†ä¸­ï¼Œæ‰°åŠ¨å‡½æ•°å¯ä»¥ç”¨æ¥å¯¹åƒç´ å€¼éšæœºåŒ–ï¼Œå¢åŠ å›¾åƒçš„å™ªå£°ï¼Œä»è€Œå®ç°ä¸€äº›ç‰¹æ®Šæ•ˆæœï¼Œå¦‚æ¯›ç»ç’ƒæ•ˆæœã€é›¨æ»´æ•ˆæœç­‰ã€‚</span><br><span class="line"></span><br><span class="line">æ€»ä¹‹ï¼Œæ‰°åŠ¨å‡½æ•°æ˜¯ä¸€ç§é€šç”¨çš„æŠ€æœ¯ï¼Œå¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹ä½¿ç”¨ã€‚é€šè¿‡å¼•å…¥éšæœºæ•°å’Œæ··æ·†æ“ä½œï¼Œæ‰°åŠ¨å‡½æ•°å¯ä»¥å¢å¼ºæ•°æ®çš„éšæœºæ€§å’Œå¤æ‚æ€§ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="6hashmapè´Ÿè½½å› å­"><a class="markdownIt-Anchor" href="#6hashmapè´Ÿè½½å› å­">#</a> 6.HashMap è´Ÿè½½å› å­ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">è´Ÿè½½å› å­ï¼Œå¯ä»¥ç†è§£æˆä¸€è¾†è½¦å¯æ‰¿é‡é‡é‡è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼ŒæŠŠè´§æ”¾åˆ°æ–°çš„è½¦ä¸Šã€‚</span><br><span class="line"></span><br><span class="line">	é‚£ä¹ˆåœ¨HashMapä¸­ï¼Œè´Ÿè½½å› å­å†³å®šäº†æ•°æ®é‡å¤šå°‘äº†ä»¥åè¿›è¡Œæ‰©å®¹ã€‚è¿™é‡Œè¦æåˆ°ä¸Šé¢åšçš„HashMapä¾‹å­ï¼Œæˆ‘ä»¬å‡†å¤‡äº†<span class="number">7</span>ä¸ªå…ƒç´ ï¼Œä½†æ˜¯æœ€åè¿˜æœ‰<span class="number">3</span>ä¸ªä½ç½®ç©ºä½™ï¼Œ<span class="number">2</span>ä¸ªä½ç½®å­˜æ”¾äº†<span class="number">2</span>ä¸ªå…ƒç´ ã€‚ æ‰€ä»¥å¯èƒ½å³ä½¿ä½ æ•°æ®æ¯”æ•°ç»„å®¹é‡å¤§æ—¶ä¹Ÿæ˜¯ä¸ä¸€å®šèƒ½æ­£æ­£å¥½å¥½çš„æŠŠæ•°ç»„å æ»¡çš„ï¼Œè€Œæ˜¯åœ¨æŸäº›å°æ ‡ä½ç½®å‡ºç°äº†å¤§é‡çš„ç¢°æ’ï¼Œåªèƒ½åœ¨åŒä¸€ä¸ªä½ç½®ç”¨é“¾è¡¨å­˜æ”¾ï¼Œé‚£ä¹ˆè¿™æ ·å°±å¤±å»äº†Mapæ•°ç»„çš„æ€§èƒ½ã€‚</span><br><span class="line"></span><br><span class="line">	æ‰€ä»¥ï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆç†çš„å¤§å°ä¸‹è¿›è¡Œæ‰©å®¹ï¼Œé»˜è®¤å€¼<span class="number">0.75</span>å°±æ˜¯è¯´å½“é˜ˆå€¼å®¹é‡å äº†<span class="number">3</span>/<span class="number">4</span>æ—¶èµ¶ç´§æ‰©å®¹ï¼Œå‡å°‘Hashç¢°æ’ã€‚</span><br><span class="line"></span><br><span class="line">	åŒæ—¶<span class="number">0.75</span>æ˜¯ä¸€ä¸ªé»˜è®¤æ„é€ å€¼ï¼Œåœ¨åˆ›å»ºHashMapä¹Ÿå¯ä»¥è°ƒæ•´ï¼Œæ¯”å¦‚ä½ å¸Œæœ›ç”¨æ›´å¤šçš„ç©ºé—´æ¢å–æ—¶é—´ï¼Œå¯ä»¥æŠŠè´Ÿè½½å› å­è°ƒçš„æ›´å°ä¸€äº›ï¼Œå‡å°‘ç¢°æ’ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="7hashmapæ˜¯å¼€æ”¾å¯»å€è¿˜æ˜¯æ‹‰é“¾å¯»å€"><a class="markdownIt-Anchor" href="#7hashmapæ˜¯å¼€æ”¾å¯»å€è¿˜æ˜¯æ‹‰é“¾å¯»å€">#</a> 7.HashMap æ˜¯å¼€æ”¾å¯»å€è¿˜æ˜¯æ‹‰é“¾å¯»å€ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HashMap æ˜¯ä¸€ç§æ‹‰é“¾å¼å“ˆå¸Œè¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä½¿ç”¨äº†é“¾è¡¨æ¥è§£å†³å“ˆå¸Œå†²çªã€‚</span><br><span class="line"></span><br><span class="line">	å…·ä½“æ¥è¯´ï¼Œå½“å¤šä¸ªä¸åŒçš„é”®æ˜ å°„åˆ°åŒä¸€ä¸ªæ¡¶æ—¶ï¼ŒHashMap ä¼šå°†å®ƒä»¬å­˜å‚¨åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œå¹¶é€šè¿‡é“¾è¡¨æˆ–çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ç»„ç»‡èµ·æ¥ã€‚è¿™æ ·ï¼Œåœ¨è¿›è¡ŒæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼Œå°±å¯ä»¥éå†å¯¹åº”æ¡¶ä¸­çš„é“¾è¡¨ï¼Œæ‰¾åˆ°æ‰€éœ€çš„å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">	ç›¸å¯¹äºå¼€æ”¾å¯»å€æ³•ï¼Œæ‹‰é“¾æ³•èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†å“ˆå¸Œå†²çªï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ‰©å®¹ã€‚å› ä¸ºåœ¨æ‹‰é“¾æ³•ä¸­ï¼Œå“ˆå¸Œè¡¨çš„æ¯ä¸ªæ¡¶éƒ½å¯ä»¥å­˜å‚¨å¤šä¸ªå…ƒç´ ï¼Œè€Œåœ¨å¼€æ”¾å¯»å€æ³•ä¸­ï¼Œæ¯ä¸ªä½ç½®åªèƒ½å­˜å‚¨ä¸€ä¸ªå…ƒç´ ï¼Œè¿™ä½¿å¾—åŠ¨æ€æ‰©å®¹å˜å¾—æ›´åŠ å›°éš¾å’Œä½æ•ˆã€‚</span><br><span class="line"></span><br><span class="line">	ä½†æ˜¯ï¼Œç”±äºé“¾è¡¨çš„ç©ºé—´å’Œæ—¶é—´å¼€é”€ï¼Œå½“å“ˆå¸Œå†²çªè¾ƒä¸ºé¢‘ç¹æ—¶ï¼Œæ‹‰é“¾æ³•å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJava8 å¼•å…¥äº†åŸºäºçº¢é»‘æ ‘çš„ä¼˜åŒ–æœºåˆ¶ï¼Œå³å½“é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</span><br><span class="line"></span><br><span class="line">æ€»ä¹‹ï¼ŒHashMap æ˜¯ä¸€ç§åŸºäºæ‹‰é“¾æ³•å®ç°çš„å“ˆå¸Œè¡¨ï¼Œèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å“ˆå¸Œå†²çªï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€æ‰©å®¹å’ŒåŸºäºçº¢é»‘æ ‘çš„ä¼˜åŒ–ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="8hashmapé“¾è¡¨ä»€ä¹ˆæ—¶å€™æ ‘åŒ–ä»¥åŠè¿ç§»æ•°æ®ç®—æ³•æ˜¯ä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#8hashmapé“¾è¡¨ä»€ä¹ˆæ—¶å€™æ ‘åŒ–ä»¥åŠè¿ç§»æ•°æ®ç®—æ³•æ˜¯ä»€ä¹ˆ">#</a> 8.HashMap é“¾è¡¨ä»€ä¹ˆæ—¶å€™æ ‘åŒ–ä»¥åŠè¿ç§»æ•°æ®ç®—æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åœ¨JDK1<span class="number">.8</span>ä¸­ï¼ŒHashMapæ˜¯ä»¥æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘æ„æˆçš„ã€‚</span><br><span class="line"></span><br><span class="line">	å…·ä½“æ¥è¯´ï¼Œå½“æŸä¸ªæ¡¶ä¸­çš„é“¾è¡¨é•¿åº¦è¶…è¿‡äº†é˜ˆå€¼æ—¶ï¼ŒHashMap ä¼šå°†è¿™ä¸ªé“¾è¡¨è½¬æ¢æˆä¸€æ£µçº¢é»‘æ ‘ï¼Œä»¥ä¾¿æ”¯æŒæ›´å¿«çš„æŸ¥æ‰¾ã€æ’å…¥å’Œåˆ é™¤ç­‰æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</span><br><span class="line"></span><br><span class="line">	<span class="number">1.</span>åˆ›å»ºä¸€æ£µç©ºçš„çº¢é»‘æ ‘ï¼Œå¹¶å°†åŸå§‹é“¾è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ æ’å…¥åˆ°è¿™æ£µæ ‘ä¸­ã€‚</span><br><span class="line">	<span class="number">2.</span>åˆ é™¤åŸå§‹é“¾è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶è®¾ç½®å“ˆå¸Œè¡¨çš„ç»“æ„ç±»å‹ä¸º TREEBINã€‚</span><br><span class="line">	<span class="number">3.</span>åœ¨è¿›è¡Œæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œæ—¶ï¼Œå…ˆåˆ¤æ–­å½“å‰æ¡¶çš„æ•°æ®ç»“æ„ç±»å‹ï¼Œå¦‚æœæ˜¯é“¾è¡¨ï¼Œåˆ™é‡‡ç”¨é“¾è¡¨çš„æ–¹æ³•è¿›è¡Œæ“ä½œï¼›å¦åˆ™ï¼Œé‡‡ç”¨çº¢é»‘æ ‘çš„æ–¹æ³•è¿›è¡Œæ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">	æ€»ä¹‹ï¼Œåœ¨ JDK8 åŠä»¥åç‰ˆæœ¬ä¸­ï¼ŒHashMap åœ¨æ ‘åŒ–å’Œè¿ç§»æ•°æ®æ–¹é¢åšäº†ä¸€äº›ä¼˜åŒ–ï¼Œä½¿å¾—å®ƒèƒ½å¤Ÿæ›´å¥½åœ°æ”¯æŒå¤§è§„æ¨¡å¹¶å‘å’Œé«˜æ•ˆå†…å­˜ä½¿ç”¨ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="9hashmap-ä¸­çš„-keyè‹¥ä¸º-objectç±»å‹-åˆ™éœ€å®ç°å“ªäº›æ–¹æ³•"><a class="markdownIt-Anchor" href="#9hashmap-ä¸­çš„-keyè‹¥ä¸º-objectç±»å‹-åˆ™éœ€å®ç°å“ªäº›æ–¹æ³•">#</a> 9.HashMap ä¸­çš„ key è‹¥ä¸º Object ç±»å‹ï¼Œ åˆ™éœ€å®ç°å“ªäº›æ–¹æ³•ï¼Ÿ</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/12e5dce6bacfa7d4db320d87936b45db.jpeg" alt="HashMap åœ¨ JDK1.7 å’Œ JDK1.8 ä¸­æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ_æ•°ç»„_07"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœ HashMap ä¸­çš„ key æ˜¯ Object ç±»å‹ï¼Œåˆ™è¯¥å¯¹è±¡éœ€è¦æ­£ç¡®åœ°å®ç° equals() å’Œ hashCode() æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºç¡®å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå¹¶è®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç ã€‚</span><br><span class="line"></span><br><span class="line">å…·ä½“æ¥è¯´ï¼Œequals() æ–¹æ³•ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚åœ¨ HashMap ä¸­ï¼Œå½“ä¸¤ä¸ª key çš„å“ˆå¸Œå€¼ç›¸åŒæ—¶ï¼Œä¼šè°ƒç”¨å®ƒä»¬çš„ equals() æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œä»¥ç¡®å®šå®ƒä»¬æ˜¯å¦çœŸæ­£ç›¸ç­‰ã€‚å› æ­¤ï¼Œæ­£ç¡®å®ç° equals() æ–¹æ³•å¯ä»¥é˜²æ­¢å“ˆå¸Œå†²çªå’Œé”®å€¼å¯¹é‡å¤çš„é—®é¢˜ã€‚</span><br><span class="line">       </span><br><span class="line">hashCode() æ–¹æ³•ç”¨äºè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç ï¼Œå®ƒå°†ä¸€ä¸ªå¯¹è±¡æ˜ å°„åˆ°ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç”¨äºç¡®å®šè¯¥å¯¹è±¡åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®ã€‚åœ¨ HashMap ä¸­ï¼Œå½“æ’å…¥æˆ–æŸ¥æ‰¾é”®å€¼å¯¹æ—¶ï¼Œä¼šé¦–å…ˆè®¡ç®— key çš„å“ˆå¸Œç ï¼Œå¹¶æ ¹æ®å“ˆå¸Œç æŸ¥æ‰¾å¯¹åº”çš„æ¡¶ã€‚å› æ­¤ï¼Œæ­£ç¡®å®ç° hashCode() æ–¹æ³•å¯ä»¥æé«˜å“ˆå¸Œè¡¨çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</span><br><span class="line"></span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœåœ¨ HashMap ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„å¯¹è±¡ä½œä¸º keyï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬çš„ equals() æ–¹æ³•å’Œ hashCode() æ–¹æ³•æ˜¯é€šè¿‡ç»§æ‰¿ Object ç±»è€Œæ¥çš„ï¼Œè¿™å¯èƒ½å¯¼è‡´ key çš„æ¯”è¾ƒå’Œå“ˆå¸Œç è®¡ç®—ä¸å‡†ç¡®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è‡ªå·±é‡å†™ equals() å’Œ hashCode() æ–¹æ³•ï¼Œä»¥æ»¡è¶³æˆ‘ä»¬çš„å…·ä½“éœ€æ±‚ã€‚åŒæ—¶ï¼Œè¿˜éœ€è¦éµå¾ªä¸€äº›è§„åˆ™ï¼Œä¾‹å¦‚ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„å“ˆå¸Œç å¿…é¡»ç›¸ç­‰ï¼›åä¹‹äº¦ç„¶ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="10hashmapä¸­çš„æ‰°åŠ¨å‡½æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„"><a class="markdownIt-Anchor" href="#10hashmapä¸­çš„æ‰°åŠ¨å‡½æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„">#</a> 10.HashMap ä¸­çš„æ‰°åŠ¨å‡½æ•°æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ‰°åŠ¨å‡½æ•°å°±æ˜¯ä¸ºäº†å¢åŠ éšæœºæ€§ï¼Œè®©æ•°æ®å…ƒç´ æ›´åŠ å‡è¡¡çš„æ•£åˆ—ï¼Œå‡å°‘ç¢°æ’</span></span><br><span class="line"><span class="comment"> * æŠŠå“ˆå¸Œå€¼å³ç§»16ä½ï¼Œä¹Ÿå°±æ­£å¥½æ˜¯è‡ªå·±é•¿åº¦çš„ä¸€åŠï¼Œä¹‹åä¸åŸå“ˆå¸Œå€¼åšå¼‚æˆ–è¿ç®—</span></span><br><span class="line"><span class="comment"> * è¿™æ ·å°±æ··åˆäº†åŸå“ˆå¸Œå€¼ä¸­çš„é«˜ä½å’Œä½ä½ï¼Œå¢å¤§äº†éšæœºæ€§</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="variable">hashIndex</span> <span class="operator">=</span> (size - <span class="number">1</span>) &amp; (key.hashCode() ^ (key.hashCode() &gt;&gt;&gt; <span class="number">16</span>));</span><br></pre></td></tr></table></figure>
<h4 id="11ä¸ºä»€ä¹ˆhashmapä¸­è¦ä½¿ç”¨-1-30-æ¥ä½œä¸ºæœ€å¤§é™åˆ¶"><a class="markdownIt-Anchor" href="#11ä¸ºä»€ä¹ˆhashmapä¸­è¦ä½¿ç”¨-1-30-æ¥ä½œä¸ºæœ€å¤§é™åˆ¶">#</a> 11. ä¸ºä»€ä¹ˆ hashMap ä¸­è¦ä½¿ç”¨ ï¼ˆ1 &lt;&lt; 30ï¼‰ æ¥ä½œä¸ºæœ€å¤§é™åˆ¶</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ HashMap ä¸­ï¼Œä½¿ç”¨ <span class="number">1</span> &lt;&lt; <span class="number">30</span> æ¥ä½œä¸ºå®¹é‡çš„æœ€å¤§é™åˆ¶æ˜¯å› ä¸º Java ä¸­çš„æ•°ç»„é•¿åº¦ä¸èƒ½è¶…è¿‡ Integer.MAX_VALUEï¼ˆå³ <span class="number">2</span>^<span class="number">31</span>-<span class="number">1</span>ï¼‰ã€‚è€Œ HashMap å†…éƒ¨çš„å®ç°éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥ä¿å­˜æ•°æ®ï¼Œå› æ­¤å…¶å®¹é‡ä¹Ÿå¿…é¡»å—åˆ°è¿™ä¸ªé™åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">ä¸ºäº†ä¿è¯ HashMap çš„æœ€å¤§å®¹é‡ä¸è¶…è¿‡ Integer.MAX_VALUEï¼ŒåŒæ—¶åˆè¦å°½å¯èƒ½åœ°æé«˜ HashMap çš„å®¹é‡ï¼ŒJava å¼€å‘å›¢é˜Ÿé€‰æ‹©äº† <span class="number">1</span> &lt;&lt; <span class="number">30</span> ä½œä¸º HashMap çš„æœ€å¤§å®¹é‡ã€‚è¿™ä¸ªå€¼æ˜¯ä¸€ä¸ª <span class="number">2</span> çš„å¹‚æ¬¡æ–¹ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨ä½è¿ç®—çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶åˆä¸ä¼šè¶…è¿‡æ•°ç»„é•¿åº¦çš„æœ€å¤§é™åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHashMap å®é™…ä¸Šå¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨ <span class="number">1</span> &lt;&lt; <span class="number">30</span> ä½œä¸ºå®¹é‡çš„æœ€å¤§é™åˆ¶ã€‚åœ¨åˆå§‹åŒ– HashMap æ—¶ï¼Œå¦‚æœä¼ å…¥çš„åˆå§‹å®¹é‡å¤§äºç­‰äº <span class="number">1</span> &lt;&lt; <span class="number">30</span>ï¼Œåˆ™ä¼šå°†å®¹é‡è®¾ç½®ä¸º Integer.MAX_VALUEï¼›å¦‚æœä¼ å…¥çš„åˆå§‹å®¹é‡å°äº <span class="number">1</span> &lt;&lt; <span class="number">30</span>ï¼Œåˆ™ä¼šå°†å®¹é‡è°ƒæ•´ä¸ºå¤§äºç­‰äºä¼ å…¥å€¼ä¸”æœ€æ¥è¿‘ <span class="number">2</span> çš„å¹‚æ¬¡æ–¹çš„æ•°ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ HashMap å®¹é‡çš„åˆç†æ€§ï¼ŒåŒæ—¶é¿å…å‡ºç°æ•°ç»„é•¿åº¦è¶…è¿‡ Integer.MAX_VALUE çš„æƒ…å†µã€‚</span><br></pre></td></tr></table></figure>
<h4 id="12hashmapå¦‚ä½•å¯»æ‰¾2çš„å¹‚æ¬¡æ–¹æœ€å°å€¼"><a class="markdownIt-Anchor" href="#12hashmapå¦‚ä½•å¯»æ‰¾2çš„å¹‚æ¬¡æ–¹æœ€å°å€¼">#</a> 12.HashMap å¦‚ä½•å¯»æ‰¾ 2 çš„å¹‚æ¬¡æ–¹æœ€å°å€¼ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDK1.8ä¸­ï¼šæŠŠäºŒè¿›åˆ¶çš„å„ä¸ªä½ç½®éƒ½å¡«ä¸Š1ï¼Œå½“äºŒè¿›åˆ¶çš„å„ä¸ªä½ç½®éƒ½æ˜¯1ä»¥åï¼Œå°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„2çš„å¹‚æ¬¡æ–¹å‡1äº†ï¼Œæœ€åæŠŠç»“æœåŠ 1å†è¿”å›å³å¯ã€‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//JDK1.8ä¹‹åï¼šï¼ˆäºŒåˆ†æ³•ï¼‰é€šè¿‡å¤šæ¬¡å³ç§»å’Œå‡å°ä½å®½çš„æ–¹å¼æ¥é€æ­¥ç¼©å°æœç´¢èŒƒå›´ï¼Œæœ€ç»ˆå¾—åˆ°æœ€é«˜ä½ 0 çš„ä¸ªæ•°</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">tableSizeFor</span><span class="params">(<span class="type">int</span> cap)</span> &#123;</span><br><span class="line">     <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> -<span class="number">1</span> &gt;&gt;&gt; Integer.numberOfLeadingZeros(cap - <span class="number">1</span>);</span><br><span class="line">     <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="12ä¸ºä»€ä¹ˆé‡å†™equalsä¸€å®šè¦é‡å†™hashcode"><a class="markdownIt-Anchor" href="#12ä¸ºä»€ä¹ˆé‡å†™equalsä¸€å®šè¦é‡å†™hashcode">#</a> 12. ä¸ºä»€ä¹ˆé‡å†™ equals ä¸€å®šè¦é‡å†™ hashcode</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ Java ä¸­ï¼Œæ¯ä¸ªç±»éƒ½ç»§æ‰¿äº† Object ç±»ï¼ŒObject ç±»æä¾›äº†ä¸¤ä¸ªæœ‰å…³å“ˆå¸Œå€¼çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ equals() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªæ˜¯ hashCode() æ–¹æ³•ã€‚å…¶ä¸­ï¼Œequals() æ–¹æ³•ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œè€Œ hashCode() æ–¹æ³•åˆ™è¿”å›è¯¥å¯¹è±¡çš„å“ˆå¸Œç ã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœåœ¨ä¸€ä¸ªç±»ä¸­é‡å†™äº† equals() æ–¹æ³•ï¼Œä½†æ²¡æœ‰é‡å†™ hashCode() æ–¹æ³•ï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´å‡ºç°ä»¥ä¸‹æƒ…å†µï¼š</span><br><span class="line"></span><br><span class="line">	åœ¨ä½¿ç”¨ HashMapã€HashSet ç­‰å“ˆå¸Œæ•°æ®ç»“æ„æ—¶ï¼Œç”±äºä¸åŒçš„å¯¹è±¡å¯ä»¥è¿”å›ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå› æ­¤å¯èƒ½ä¼šå°†è¿™äº›å¯¹è±¡è¯¯è®¤ä¸ºæ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå¼•å‘ç¨‹åºé”™è¯¯ã€‚</span><br><span class="line">	åœ¨ä½¿ç”¨è‡ªå®šä¹‰å¯¹è±¡ä½œä¸ºé”®æ¥è¿›è¡Œ Map æ“ä½œæ—¶ï¼Œç”±äºä¸åŒçš„é”®å¯ä»¥è¿”å›ç›¸åŒçš„å“ˆå¸Œå€¼ï¼Œå› æ­¤å¯èƒ½æ— æ³•æ­£ç¡®åœ°å®šä½åˆ°å¯¹åº”çš„é”®å€¼å¯¹ï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–æŸ¥æ‰¾å¤±è´¥ã€‚</span><br><span class="line">å› æ­¤ï¼Œå¦‚æœè¦é‡å†™ equals() æ–¹æ³•ï¼Œåˆ™å¿…é¡»åŒæ—¶é‡å†™ hashCode() æ–¹æ³•ï¼Œä»¥ç¡®ä¿å®ƒä»¬çš„è¡Œä¸ºä¸€è‡´å¹¶æ»¡è¶³ä¸€äº›çº¦å®šï¼š</span><br><span class="line"></span><br><span class="line">	å¦‚æœä¸¤ä¸ªå¯¹è±¡ä½¿ç”¨ equals() æ–¹æ³•æ¯”è¾ƒè¿”å›ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬çš„ hashCode() å€¼å¿…é¡»ç›¸ç­‰ã€‚</span><br><span class="line">	å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„ hashCode() å€¼ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬ä¸ä¸€å®šç›¸ç­‰ï¼ˆå³å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çªï¼‰ï¼Œå› æ­¤éœ€è¦å†æ¬¡ä½¿ç”¨ equals() æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚</span><br><span class="line">é€šè¿‡éµå¾ªè¿™äº›çº¦å®šï¼Œå¯ä»¥ä¿è¯åœ¨ä½¿ç”¨å“ˆå¸Œæ•°æ®ç»“æ„æˆ–è‡ªå®šä¹‰å¯¹è±¡ä½œä¸ºé”®å€¼å¯¹æ—¶ä¸ä¼šå‡ºç°é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="13ä¸ºä»€ä¹ˆåœ¨-java-çš„-hashmap-å®ç°ä¸­æ•°ç»„çš„å¤§å°å³å®¹é‡å¿…é¡»å§‹ç»ˆä¿æŒä¸º-2-çš„å¹‚æ¬¡æ–¹"><a class="markdownIt-Anchor" href="#13ä¸ºä»€ä¹ˆåœ¨-java-çš„-hashmap-å®ç°ä¸­æ•°ç»„çš„å¤§å°å³å®¹é‡å¿…é¡»å§‹ç»ˆä¿æŒä¸º-2-çš„å¹‚æ¬¡æ–¹">#</a> 13. ä¸ºä»€ä¹ˆåœ¨ Java çš„ HashMap å®ç°ä¸­ï¼Œæ•°ç»„çš„å¤§å°ï¼ˆå³å®¹é‡ï¼‰å¿…é¡»å§‹ç»ˆä¿æŒä¸º 2 çš„å¹‚æ¬¡æ–¹ï¼Ÿ</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HashMapçš„é•¿åº¦å¿…é¡»ä¿è¯æ˜¯<span class="number">2</span>çš„å¹‚æ¬¡æ–¹ï¼Œæ˜¯ä¸ºäº†é¿å…å‡ºç°HashMapä¸ºç©ºæˆ–è€…HashMapä¸­å­˜å‚¨çš„å…ƒç´ ä¸ªæ•°ä¸è¶³<span class="number">2</span>çš„å¹‚æ¬¡æ–¹çš„æƒ…å†µã€‚</span><br><span class="line"></span><br><span class="line">å¦‚æœHashMapçš„é•¿åº¦ä¸æ˜¯<span class="number">2</span>çš„å¹‚æ¬¡æ–¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line">	å¦‚æœHashMapçš„é•¿åº¦ä¸º<span class="number">1</span>ï¼Œé‚£ä¹ˆå®ƒçš„å“ˆå¸Œå†²çªè§£å†³æ–¹å¼åªèƒ½æ˜¯é“¾åœ°å€æ³•ï¼ˆå³å°†å†²çªçš„é”®å€¼å¯¹æ’å…¥åˆ°é“¾è¡¨ä¸­ï¼‰ï¼Œè¿™ç§æ–¹å¼ä¸èƒ½å¤„ç†å“ˆå¸Œå†²çªã€‚</span><br><span class="line">	å¦‚æœHashMapçš„é•¿åº¦ä¸º<span class="number">0</span>ï¼Œé‚£ä¹ˆå®ƒçš„å“ˆå¸Œå†²çªè§£å†³æ–¹å¼åªèƒ½æ˜¯å¼€æ”¾åœ°å€æ³•ï¼ˆå³å°†å†²çªçš„é”®å€¼å¯¹ç›´æ¥æ”¾åœ¨HashMapä¸­ï¼‰ï¼Œè¿™ç§æ–¹å¼ä¸èƒ½å¤„ç†å“ˆå¸Œå†²çªã€‚</span><br><span class="line"></span><br><span class="line">å› æ­¤ï¼Œä¸ºäº†ä¿è¯HashMapçš„æ­£ç¡®æ€§å’Œæ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å®ƒçš„é•¿åº¦æ˜¯<span class="number">2</span>çš„å¹‚æ¬¡æ–¹ï¼Œæˆ–è€…ä¸ºä¸€ä¸ªå›ºå®šçš„æœ€å¤§å€¼ã€‚å¦‚æœéœ€è¦åŠ¨æ€åœ°è°ƒæ•´HashMapçš„é•¿åº¦ï¼Œå¯ä»¥ä½¿ç”¨é“¾è¡¨æ³•æˆ–è€…å¼€æ”¾åœ°å€æ³•ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="14ä¸ºä»€ä¹ˆhashmaploadfactorçš„é€‰å€¼æ˜¯34è€Œä¸æ˜¯24"><a class="markdownIt-Anchor" href="#14ä¸ºä»€ä¹ˆhashmaploadfactorçš„é€‰å€¼æ˜¯34è€Œä¸æ˜¯24">#</a> 14. ä¸ºä»€ä¹ˆ HashMap.loadFactor çš„é€‰å€¼æ˜¯ 3/4ï¼Œè€Œä¸æ˜¯ 2/4?</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆï¼Œå½“loadFactorçš„å€¼æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œè™½ç„¶èƒ½å¤Ÿå‡å°‘ç©ºé—´çš„æµªè´¹ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å“ˆå¸Œè¡¨æ›´åŠ é¢‘ç¹åœ°è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œè¿™ä¼šå½±å“åˆ°HashMapçš„æ€§èƒ½ã€‚</span><br><span class="line">å…¶æ¬¡ï¼Œå½“loadFactorçš„å€¼æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œè™½ç„¶èƒ½å¤Ÿå‡å°‘æ‰©å®¹æ“ä½œçš„æ¬¡æ•°ï¼Œä½†æ˜¯ä¼šå¯¼è‡´å“ˆå¸Œé“¾è¡¨é•¿åº¦è¿‡é•¿ï¼ŒæŸ¥æ‰¾æ•ˆç‡ä¼šå˜å¾—è¾ƒä½ã€‚</span><br><span class="line">å› æ­¤ï¼Œä¸ºäº†å¹³è¡¡ç©ºé—´åˆ©ç”¨ç‡å’Œæ—¶é—´æ•ˆç‡ï¼Œé€‰æ‹©ä¸€ä¸ªé€‚å½“çš„loadFactorå€¼éå¸¸é‡è¦ã€‚ç»è¿‡å®éªŒå’Œåˆ†æï¼Œå‘ç°loadFactorå–<span class="number">0.75</span>æ—¶ï¼Œå¯ä»¥åœ¨ä¿è¯å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡çš„åŒæ—¶ï¼Œç¨å¾®å‡å°‘ç©ºé—´çš„æµªè´¹ã€‚å¦å¤–ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªå–å€¼ï¼Œå¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿé‡‡ç”¨äº†ç±»ä¼¼çš„å€¼ã€‚</span><br></pre></td></tr></table></figure>
<h4 id="15hashmapä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶å¦‚ä½•æ‰©å®¹"><a class="markdownIt-Anchor" href="#15hashmapä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶å¦‚ä½•æ‰©å®¹">#</a> 15.HashMap ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ï¼Ÿå¦‚ä½•æ‰©å®¹ï¼Ÿ</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">HashMapåœ¨å­˜å‚¨é”®å€¼å¯¹æ—¶ï¼Œä¼šå°†é”®é€šè¿‡å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°æ¡¶é‡Œé¢ï¼Œæ¯ä¸ªæ¡¶æ˜¯ä¸€ä¸ªé“¾è¡¨æˆ–çº¢é»‘æ ‘ã€‚å½“HashMapä¸­çš„å…ƒç´ æ•°é‡å¢åŠ åˆ°è¶…è¿‡äº†è´Ÿè½½å› å­ï¼ˆé»˜è®¤ä¸º0.75ï¼‰ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">å…·ä½“åœ°è¯´ï¼Œåœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœå½“å‰çš„å…ƒç´ æ•°é‡è¾¾åˆ°äº†é˜ˆå€¼ï¼ˆå³å®¹é‡ä¹˜ä»¥è´Ÿè½½å› å­ï¼‰ï¼Œå°±ä¼šå¯åŠ¨æ‰©å®¹æœºåˆ¶ã€‚è¿™ä¸ªé˜ˆå€¼é€šè¿‡å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š</span><br><span class="line"></span><br><span class="line">threshold = capacity * loadFactor</span><br><span class="line"></span><br><span class="line">å…¶ä¸­capacityæ˜¯å½“å‰HashMapçš„å®¹é‡ï¼ŒloadFactoræ˜¯è´Ÿè½½å› å­ï¼Œé»˜è®¤å€¼ä¸º0.75ã€‚å½“HashMapä¸­å…ƒç´ ä¸ªæ•°è¾¾åˆ°äº†thresholdå€¼æ—¶ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹æœºåˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">æ‰©å®¹æ“ä½œåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</span><br><span class="line"></span><br><span class="line">	1.åˆ›å»ºä¸€ä¸ªæ–°çš„Entryæ•°ç»„ï¼Œé•¿åº¦ä¸ºåŸæ•°ç»„çš„ä¸¤å€ã€‚</span><br><span class="line">	2.å°†åŸæ¥æ•°ç»„ä¸­æ‰€æœ‰çš„å…ƒç´ é‡æ–°åˆ†é…åˆ°æ–°çš„æ•°ç»„ä¸­ï¼Œè¿™ä¸€æ­¥éœ€è¦é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ çš„hashå€¼ï¼Œå¹¶ä¸”æ ¹æ®æ–°çš„æ•°ç»„é•¿åº¦æ±‚å‡ºå®ƒä»¬åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ã€‚</span><br><span class="line">	3.åœ¨é‡æ–°åˆ†é…å…ƒç´ çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªä½ç½®ä¸Šæœ‰å¤šä¸ªå…ƒç´ ï¼Œåˆ™ä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨æˆ–çº¢é»‘æ ‘ï¼Œè¿™å–å†³äºé“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äºç­‰äº8ï¼Œå¹¶ä¸”æ¡¶å®¹é‡å¤§äº64ã€‚å¦‚æœé“¾è¡¨é•¿åº¦å¤§äºç­‰äº8å¹¶ä¸”æ¡¶å®¹é‡å¤§äº64çš„è¯ï¼Œåˆ™ä¼šå°†å…¶è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œå¦åˆ™ä»ç„¶ä½¿ç”¨é“¾è¡¨ã€‚è¿™ä¸€æ­¥æ˜¯ä¸ºäº†æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œå› ä¸ºçº¢é»‘æ ‘çš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦æ˜¯O(log n)ï¼Œè€Œé“¾è¡¨çš„æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ã€‚</span><br><span class="line">	4.æ›´æ–°HashMapçš„å®¹é‡å’Œé˜ˆå€¼ã€‚</span><br><span class="line">	</span><br><span class="line">æ‰©å®¹æ“ä½œä¼šæ¯”è¾ƒè€—æ—¶ï¼Œå› ä¸ºéœ€è¦é‡æ–°è®¡ç®—hashå€¼ã€é‡æ–°åˆ†é…å…ƒç´ ç­‰ï¼Œæ‰€ä»¥åº”è¯¥å°½å¯èƒ½é¿å…é¢‘ç¹è§¦å‘æ‰©å®¹ã€‚å¯ä»¥é€šè¿‡è°ƒæ•´è´Ÿè½½å› å­çš„å¤§å°æ¥æ§åˆ¶HashMapçš„æ€§èƒ½å’Œç©ºé—´å ç”¨</span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-05T01:57:09.000Z" title="2023-5-5 9:57:09">2023-05-05</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-05T02:04:28.525Z" title="2023-5-5 10:04:28">2023-05-05</time>æ›´æ–°</span><span class="level-item">14 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2151ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/05/%E3%80%90IDEA%E3%80%91IDEA%E7%9A%84debug%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E8%AF%A6%E8%A7%A3/">ã€IDEAã€‘IDEAçš„debugè°ƒè¯•æŠ€å·§è¯¦è§£</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="ideaideaçš„debugè°ƒè¯•æŠ€å·§è¯¦è§£è½¬è‡ªcsdn"><a class="markdownIt-Anchor" href="#ideaideaçš„debugè°ƒè¯•æŠ€å·§è¯¦è§£è½¬è‡ªcsdn">#</a> ã€IDEAã€‘IDEA çš„ debug è°ƒè¯•æŠ€å·§è¯¦è§£ï¼ˆè½¬è‡ª CSDNï¼‰</h1>
<p>ç›®å½•</p>
<p><a href="#%E4%B8%80%E3%80%81%E6%A6%82%E8%BF%B0">ä¸€ã€æ¦‚è¿°</a></p>
<p><a href="#%E4%BA%8C%E3%80%81debug%E6%93%8D%E4%BD%9C%E5%88%86%E6%9E%90">äºŒã€debug æ“ä½œåˆ†æ</a></p>
<p><a href="#1%E3%80%81%E6%89%93%E6%96%AD%E7%82%B9">1ã€æ‰“æ–­ç‚¹</a></p>
<p><a href="#2%E3%80%81%E8%BF%90%E8%A1%8Cdebug%E6%A8%A1%E5%BC%8F">2ã€è¿è¡Œ debug æ¨¡å¼</a></p>
<p><a href="#3%E3%80%81%E9%87%8D%E6%96%B0%E6%89%A7%E8%A1%8Cdebug">3ã€é‡æ–°æ‰§è¡Œ debug</a></p>
<p><a href="#4%E3%80%81%E8%AE%A9%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E5%88%B0%E4%B8%8B%E4%B8%80%E6%AC%A1%E6%96%AD%E7%82%B9%E5%90%8E%E6%9A%82%E5%81%9C">4ã€è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ</a></p>
<p><a href="#5%E3%80%81%E8%AE%A9%E6%96%AD%E7%82%B9%E5%A4%84%E7%9A%84%E4%BB%A3%E7%A0%81%E5%86%8D%E5%8A%A0%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81">5ã€è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç </a></p>
<p><a href="#6%E3%80%81%E5%81%9C%E6%AD%A2debug%E7%A8%8B%E5%BA%8F">6ã€åœæ­¢ debug ç¨‹åº</a></p>
<p><a href="#7%E3%80%81%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E6%96%AD%E7%82%B9">7ã€æ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹</a></p>
<p><a href="#8%E3%80%81%E6%B7%BB%E5%8A%A0%E6%96%AD%E7%82%B9%E8%BF%90%E8%A1%8C%E7%9A%84%E6%9D%A1%E4%BB%B6">8ã€æ·»åŠ æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶</a></p>
<p><a href="#9%E3%80%81%E5%B1%8F%E8%94%BD%E6%89%80%E6%9C%89%E6%96%AD%E7%82%B9">9ã€å±è”½æ‰€æœ‰æ–­ç‚¹</a></p>
<p><a href="#10%E3%80%81%E6%8A%8A%E5%85%89%E6%A0%87%E7%A7%BB%E5%88%B0%E5%BD%93%E5%89%8D%E7%A8%8B%E5%BA%8F%E8%BF%90%E8%A1%8C%E4%BD%8D%E7%BD%AE">10ã€æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®</a></p>
<p><a href="#11%E3%80%81%E5%8D%95%E6%AD%A5%E8%B7%B3%E8%BF%87">11ã€å•æ­¥è·³è¿‡</a></p>
<p><a href="#12%E3%80%81%E5%8F%AF%E4%BB%A5%E8%B7%B3%E5%85%A5%E6%96%B9%E6%B3%95%E5%86%85%E9%83%A8%E7%9A%84%E6%89%A7%E8%A1%8C%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%93%8D%E4%BD%9C">12ã€å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨çš„æ‰§è¡Œä¸€è¡Œä»£ç æ“ä½œ</a></p>
<p><a href="#13%E3%80%81%E8%B7%B3%E5%87%BA%E6%96%B9%E6%B3%95">13ã€è·³å‡ºæ–¹æ³•</a></p>
<p><a href="#14%E3%80%81%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E5%88%B0%E5%85%89%E6%A0%87%E6%89%80%E5%9C%A8%E4%BD%8D%E7%BD%AE">14ã€ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®</a></p>
<p><a href="#15%E3%80%81%E5%9C%A8%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%94%B9%E5%8F%98%E6%AD%A3%E5%9C%A8debug%E7%9A%84%E6%95%B0%E6%8D%AE">15ã€åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨ debug çš„æ•°æ®</a></p>
<hr>
<h1 id="ä¸€-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#ä¸€-æ¦‚è¿°">#</a> ä¸€ã€æ¦‚è¿°</h1>
<ul>
<li>debug è°ƒè¯•ä¹Ÿå«æ–­ç‚¹è°ƒè¯•</li>
<li>åœ¨ç¨‹åºçš„æŸä¸€è¡Œæ‰“ä¸Šæ–­ç‚¹ï¼Œåˆ™åœ¨ debug æ¨¡å¼ä¸‹è¿è¡Œåˆ°æ–­ç‚¹ä½ç½®æ—¶ä¼šæš‚åœï¼Œä¾¿äºç¨‹åºå‘˜è§‚å¯Ÿä»£ç çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å­¦ä¼š debugï¼Œæœ‰åŠ©äºåœ¨ç¨‹åºè¿è¡Œæœªè¾¾åˆ°ç†æƒ³æƒ…å†µæ—¶ï¼Œå¯¹ç¨‹åºçš„å„ä¸ªæµç¨‹è¿›è¡Œåˆ†æ</li>
<li>æœ¬æ–‡åªè¯¦ç»†æè¿°äº† debug çš„ä¸€äº›åŸºæœ¬çš„å¸¸ç”¨æ“ä½œï¼Œå¦‚æœæœ‰ç¼ºæ¼æ¬¢è¿è¯„è®ºåŒºç•™è¨€ï½</li>
</ul>
<h1 id="äºŒ-debugæ“ä½œåˆ†æ"><a class="markdownIt-Anchor" href="#äºŒ-debugæ“ä½œåˆ†æ">#</a> äºŒã€debug æ“ä½œåˆ†æ</h1>
<h2 id="1-æ‰“æ–­ç‚¹"><a class="markdownIt-Anchor" href="#1-æ‰“æ–­ç‚¹">#</a> 1ã€æ‰“æ–­ç‚¹</h2>
<ul>
<li>åœ¨ç¨‹åºçš„æŸä¸€è¡Œä½ç½®ï¼Œæ•°å­—å³è¾¹çš„ç©ºç™½éƒ¨åˆ†ä½¿ç”¨é¼ æ ‡å·¦é”®ç‚¹å‡»ä¸€ä¸‹ï¼Œå‡ºç°çº¢ç‚¹å³ä¸ºæ‰“ä¸Šäº†ä¸€ä¸ªæ–­ç‚¹</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9e3026905fcd4c7a9a7b0dce93f324e9.png" width="422" height="362" />
<h2 id="2-è¿è¡Œdebugæ¨¡å¼"><a class="markdownIt-Anchor" href="#2-è¿è¡Œdebugæ¨¡å¼">#</a> 2ã€è¿è¡Œ debug æ¨¡å¼</h2>
<ul>
<li>æ–¹å¼ä¸€
<ul>
<li>é€‰ä¸­è¦è¿›è¡Œ debug çš„ç¨‹åºï¼Œç‚¹å‡»å³ä¸Šè§’çš„ debug æŒ‰é’®</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f52559e407cf4dd9af9438fc616abca5.png" width="288" height="82" />
<ul>
<li>æ–¹å¼äºŒ
<ul>
<li>åœ¨è¦è¿›è¡Œ debug çš„ç¨‹åºå¤„å³é”®ï¼Œé€‰ä¸­ä¸‹å›¾é€‰é¡¹</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a703e498d8dc4e91be40b3ba06a7a5be.png" width="386" height="449" />
<h2 id="3-é‡æ–°æ‰§è¡Œdebug"><a class="markdownIt-Anchor" href="#3-é‡æ–°æ‰§è¡Œdebug">#</a> 3ã€é‡æ–°æ‰§è¡Œ debug</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®ï¼Œä¼šå…³é—­å½“å‰ debug çš„ç¨‹åºå¹¶é‡æ–°å¯åŠ¨ debug</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6a18ce960271427892dbc4a8df8e568d.png" width="832" height="308" />
<h2 id="4-è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ"><a class="markdownIt-Anchor" href="#4-è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ">#</a> 4ã€è®©ç¨‹åºæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾çš„æŒ‰é’®ï¼Œdebug ä¼šç»§ç»­è¿è¡Œç¨‹åºï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹åæš‚åœ</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5347586e6a414e7fbacc2863e4e7f44d.png" width="851" height="301" />
<ul>
<li>ä¸¾ä¾‹
<ul>
<li>ä¸‹å›¾æ˜¯ä¸€ä¸ªå¾ªç¯æ“ä½œï¼Œåœ¨æ‰“æ–­ç‚¹çš„ä½ç½®ç‚¹å‡»ä¸Šé¢è¯´çš„æŒ‰é’®ï¼Œç›¸å½“äºå†å¾ªç¯ä¸€æ¬¡ï¼Œåˆ°ä»£ç ç¬¬ 9 è¡Œæ—¶åœæ­¢</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4653841c52c54a3183914354054609dd.png" width="818" height="336" />
<h2 id="5-è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç "><a class="markdownIt-Anchor" href="#5-è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç ">#</a> 5ã€è®©æ–­ç‚¹å¤„çš„ä»£ç å†åŠ ä¸€è¡Œä»£ç </h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾çš„åŠ å·ï¼Œå¯ä»¥åœ¨æ–­ç‚¹å¤„åŠ ä¸€è¡Œä»£ç ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„ count++ å³ä¸ºæ–°æ·»åŠ çš„ä»£ç 
<ul>
<li>é€‰ä¸­ count++ï¼Œå³é”®ç‚¹å‡» Edit å¯ä»¥ç¼–è¾‘è¯¥ä»£ç </li>
<li>é€‰ä¸­è¯¥è¡Œä»£ç ï¼ˆcount++ï¼‰ï¼Œç‚¹å‡»åŠ å·ä¸‹é¢çš„å‡å·ï¼Œå¯ä»¥åˆ é™¤è¯¥è¡Œä»£ç </li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b7843e76b1b64b488e93c9cd8b6e72a6.png" width="865" height="266" />
<ul>
<li>é€‰ä¸­ä¸‹å›¾çš„çœ¼é•œï¼Œå˜ä¸ºåˆ†å±æ“ä½œ</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ac95d9ee4ebb4c2c8e573e623e34f779.png" width="1200" height="324" />
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/18ec87566c3340689daa95295557fa12.png" width="1200" height="302" />
<hr>
<p><strong>ä¸¾ä¾‹</strong></p>
<ul>
<li>ä¸‹å›¾æ˜¯æ²¡æ·»åŠ é¢å¤–ä»£ç ä¹‹å‰çš„æˆªå›¾</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/155c34d01574452f9924b608cb26a642.png" width="1163" height="567" />
<ul>
<li>æ·»åŠ ä¸€å¥ count++ï¼Œå¹¶ç‚¹å‡»å·¦è¾¹çº¢è‰²æ¡†ä¸­çš„æŒ‰é’®ï¼Œæ‰§è¡Œåˆ°ä¸‹ä¸€æ¬¡æ–­ç‚¹ï¼Œå³å¾ªç¯äº†ä¸€æ¬¡</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/33ebf61346304b9c9679c6f836ed99b7.png" width="1139" height="659" />
<ul>
<li>æ•ˆæœå’Œè¿è¡Œæ­¥éª¤è§ä¸‹å›¾</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0994f7950ff1421ca6cf4116e1fafe23.png" width="1200" height="666" />
<h2 id="6-åœæ­¢debugç¨‹åº"><a class="markdownIt-Anchor" href="#6-åœæ­¢debugç¨‹åº">#</a> 6ã€åœæ­¢ debug ç¨‹åº</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®åœæ­¢ debug ç¨‹åº</li>
<li>æ³¨æ„
<ul>
<li>è¿è¡Œçš„å¦‚æœæ˜¯ javaSE é¡¹ç›®ï¼Œç‚¹ä¸€ä¸‹å°±åœæ­¢</li>
<li>è¿è¡Œçš„å¦‚æœæ˜¯ javaWeb é¡¹ç›®ï¼Œéœ€è¦ç‚¹ä¸¤ä¸‹
<ul>
<li>ç¬¬ä¸€ä¸‹åœæ­¢ä»£ç çš„å½“å‰çº¿ç¨‹</li>
<li>ç¬¬äºŒä¸‹åœæ­¢æœåŠ¡å™¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7ce1d0c26f4a45ec9050155f0f653557.png" width="882" height="304" />
<h2 id="7-æ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹"><a class="markdownIt-Anchor" href="#7-æ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹">#</a> 7ã€æ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®ï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5651d84b51cf45d1bab9072c4c7d1ccc.png" width="830" height="272" />
<ul>
<li>ç‚¹å‡»åå‡ºç°ä¸‹å›¾æ‰€ç¤ºç•Œé¢ï¼Œå¯ä»¥æ·»åŠ æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶ï¼Œè§ä¸‹ä¸€æ¡åŠŸèƒ½è§£é‡Š</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/93a8e0b13c4d45e3a4adf260d9ca24b6.png" width="1108" height="670" />
<h2 id="8-æ·»åŠ æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶"><a class="markdownIt-Anchor" href="#8-æ·»åŠ æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶">#</a> 8ã€æ·»åŠ æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶</h2>
<ul>
<li>é€‰ä¸­æ–­ç‚¹ï¼Œå³é”®åå³å¯ç¼–è¾‘æ–­ç‚¹è¿è¡Œçš„æ¡ä»¶
<ul>
<li>æ»¡è¶³æ¡ä»¶æ—¶ç¨‹åºæ‰ä¼šåœ¨è¯¥æ–­ç‚¹å¤„åœä¸‹</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e6b57eeaa0294cdf9364c2b0f6a6cb25.png" width="1006" height="513" />
<ul>
<li>æ¯”å¦‚æ·»åŠ  i&gt;=5ï¼Œé‡æ–° debug åçš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤º</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/82a7ffe03cd54958a8801e21eceb704a.png" width="918" height="645" />
<ul>
<li>æ­¤æ—¶ä¼šå‘ç°ç¬¬ 7 æ¡æ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹ä¿¡æ¯å¤„ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹å›¾æ•ˆæœ</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/daab0ee1bfe94a329aa68db1c95f2080.png" width="1022" height="281" />
<h2 id="9-å±è”½æ‰€æœ‰æ–­ç‚¹"><a class="markdownIt-Anchor" href="#9-å±è”½æ‰€æœ‰æ–­ç‚¹">#</a> 9ã€å±è”½æ‰€æœ‰æ–­ç‚¹</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®ï¼Œå¯ä»¥å±è”½æ‰€æœ‰æ–­ç‚¹</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f7e06ed221044991be85af4fca6748f9.png" width="583" height="361" />
<ul>
<li>å±è”½å‰<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/677a8547e65844eebac684de9f46bc71.png" width="102" height="73" /></li>
<li>å±è”½å<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/46bb93d283a640df802eec5d8fd1bbab.png" width="81" height="56" /></li>
<li>å±è”½çš„æ–­ç‚¹åœ¨ debug çš„æ—¶å€™ä¸ä¼šè¿è¡Œ
<ul>
<li>å¦‚æœç¨‹åºè°ƒè¯•åè§‰å¾—æ²¡é—®é¢˜äº†ï¼Œå¯ä»¥å±è”½æ‰æ‰€æœ‰æ–­ç‚¹ç»§ç»­è¿è¡Œç¨‹åºæŸ¥çœ‹æ•ˆæœ</li>
</ul>
</li>
</ul>
<h2 id="10-æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®"><a class="markdownIt-Anchor" href="#10-æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®">#</a> 10ã€æŠŠå…‰æ ‡ç§»åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®åï¼Œä¼šæŠŠé¼ æ ‡å…‰æ ‡ç§»åŠ¨åˆ°å½“å‰ç¨‹åºè¿è¡Œä½ç½®
<ul>
<li>å½“ç¨‹åºä»£ç é‡å¾ˆå¤§çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è¯¥æŒ‰é’®å¿«é€Ÿå®šä½åˆ°ç¨‹åºè¿è¡Œä½ç½®</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a44a214ccd894d52884cd8cd20e9665c.png" width="617" height="245" />
<ul>
<li>å¦‚ä¸‹å›¾æ‰€ç¤º
<ul>
<li>å‡è®¾ç¨‹åºè¿è¡Œåˆ°ç¬¬ 9 è¡Œæ–­ç‚¹å¤„ï¼Œé¼ æ ‡å…‰æ ‡åœ¨ç¬¬ 11 è¡Œï¼Œç‚¹å‡»è¯¥æŒ‰é’®åå…‰æ ‡å°±ä¼šç§»åŠ¨åˆ°ç¬¬ 9 è¡Œ</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/15566342c22e47b390f7922e06c080e9.png" width="648" height="129" />
<h2 id="11-å•æ­¥è·³è¿‡"><a class="markdownIt-Anchor" href="#11-å•æ­¥è·³è¿‡">#</a> 11ã€å•æ­¥è·³è¿‡</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾æŒ‰é’®ï¼Œä¼šä¸€è¡Œä¸€è¡Œæ‰§è¡Œè‡ªå·±ç¼–å†™çš„ä»£ç 
<ul>
<li>å¦‚æœç¢°åˆ°æ–¹æ³•ï¼Œè¯¥æŒ‰é’®ä¸ä¼šè¿›å…¥åˆ°è¯¥æ–¹æ³•å†…éƒ¨</li>
<li>å¿«æ·é”® F8</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1c54b8240f6e4d719f8aae936a925fb2.png" width="544" height="201" />
<h2 id="12-å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨çš„æ‰§è¡Œä¸€è¡Œä»£ç æ“ä½œ"><a class="markdownIt-Anchor" href="#12-å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨çš„æ‰§è¡Œä¸€è¡Œä»£ç æ“ä½œ">#</a> 12ã€å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨çš„æ‰§è¡Œä¸€è¡Œä»£ç æ“ä½œ</h2>
<ul>
<li>ä¸‹å›¾ä¸­çš„è“è‰²ç®­å¤´å’Œçº¢è‰²ç®­å¤´éƒ½å¯ä»¥æ‰§è¡Œä¸€è¡Œä»£ç ï¼Œå¦‚æœé‡åˆ°æ–¹æ³•æ—¶ä¼šè¿›å…¥æ–¹æ³•å†…éƒ¨ï¼ŒåŒºåˆ«åœ¨äº
<ul>
<li>è“è‰²ç®­å¤´åªä¼šè·³è¿›è‡ªå·±å†™çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯ç³»ç»Ÿå·²ç»å†™å¥½çš„æ–¹æ³•ï¼Œè“è‰²ç®­å¤´æ— æ³•è·³å…¥è¯¥æ–¹æ³•</li>
<li>çº¢è‰²ç®­å¤´ä¸ç®¡æ˜¯è‡ªå·±å†™çš„æ–¹æ³•ï¼Œè¿˜æ˜¯ç³»ç»Ÿå·²ç»å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œéƒ½å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/23a065624b024b29ba358d96c1e827eb.png" width="852" height="271" />
<ul>
<li>å¦‚ä¸‹å›¾æ‰€ç¤º
<ul>
<li>ArrayList çš„ add æ–¹æ³•æ˜¯ç³»ç»Ÿå·²ç»å†™å¥½çš„ï¼Œè“è‰²ç®­å¤´æ— æ³•è·³å…¥æ–¹æ³•å†…éƒ¨ï¼Œä½†æ˜¯çº¢è‰²ç®­å¤´å¯ä»¥è·³å…¥æ–¹æ³•å†…éƒ¨</li>
<li>printMessageï¼ˆï¼‰æ˜¯è‡ªå®šä¹‰æ–¹æ³•ï¼Œçº¢è‰²å’Œè“è‰²ç®­å¤´éƒ½å¯ä»¥è·³å…¥è¯¥æ–¹æ³•å†…éƒ¨</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f24471618ac74e69842c047606635c13.png" width="811" height="762" />
<h2 id="13-è·³å‡ºæ–¹æ³•"><a class="markdownIt-Anchor" href="#13-è·³å‡ºæ–¹æ³•">#</a> 13ã€è·³å‡ºæ–¹æ³•</h2>
<ul>
<li>ä¸‹å›¾çš„ä¸¤ä¸ªæŒ‰é’®éƒ½å¯ä»¥è·³å‡ºæ–¹æ³•
<ul>
<li>ç¬¬äºŒä¸ªæŒ‰é’®æ˜¯å…³é—­çª—å£çš„æ„æ€ï¼ŒåŒæ ·å¯ä»¥èµ·åˆ°è·³å‡ºæ–¹æ³•çš„ä½œç”¨</li>
<li>åœ¨è¿›å…¥æ–¹æ³•å†…éƒ¨çš„æ—¶å€™ä½¿ç”¨è¿™ä¸¤ä¸ªæŒ‰é’®</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0deedd480bd94b0f9d93aab8bc5d33d1.png" width="514" height="238" />
<h2 id="14-ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®"><a class="markdownIt-Anchor" href="#14-ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®">#</a> 14ã€ç›´æ¥æ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®</h2>
<ul>
<li>ç‚¹å‡»ä¸‹å›¾çš„æŒ‰é’®ï¼Œç¨‹åºä¼šæ‰§è¡Œåˆ°å…‰æ ‡æ‰€åœ¨çš„ä½ç½®
<ul>
<li>å‰ææ˜¯å…‰æ ‡å‰é¢æ²¡æœ‰æ–­ç‚¹ï¼Œå¦åˆ™ç¨‹åºè¿˜æ˜¯ä¼šåœ¨å…‰æ ‡å‰é¢çš„æ–­ç‚¹å¤„æš‚åœ</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/75d500280cad4a7497a31bb49c1a73a4.png" width="616" height="247" />
<h2 id="15-åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨debugçš„æ•°æ®"><a class="markdownIt-Anchor" href="#15-åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨debugçš„æ•°æ®">#</a> 15ã€åœ¨æ§åˆ¶å°æ”¹å˜æ­£åœ¨ debug çš„æ•°æ®</h2>
<ul>
<li>åœ¨æ§åˆ¶å°é€‰ä¸­æŸä¸ªå˜é‡ï¼Œå³é”®ç‚¹å‡» SetÂ Value å¯ä»¥æ”¹å˜è¯¥å˜é‡çš„å€¼
<ul>
<li>å¦‚æœæƒ³æµ‹è¯•æŸä¸ªåœ°æ–¹çš„æ•°æ®å¦‚æœæ˜¯æ­£ç¡®çš„ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Œå¯ä»¥æ‰‹åŠ¨æ›´æ”¹è¯¥å¤„å˜é‡çš„å€¼</li>
</ul>
</li>
</ul>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9fcd3a72eebf47a9be694fabec9549cd.png" width="1003" height="304" />
<p>è¡¥å……ï¼šdebug è°ƒè¯•çœ‹ä»£ç æ—¶ï¼Œä¸€èˆ¬ç”¨ F9 è·³åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œæ‰“æ–­ç‚¹çš„ç›®çš„æ˜¯ä½ æƒ³çœ‹ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸ªä½ç½®æ—¶ä¼šæœ‰ä»€ä¹ˆæ•ˆæœï¼Œæˆ–è€…æ˜¯åˆ°è¾¾æ–­ç‚¹çš„ä½ç½®åå†ç»§ç»­å¾€ä¸‹çœ‹å®ç°çš„è¿‡ç¨‹ï¼›ç”¨ F7 å»è·³è¿›æ–¹æ³•å†…éƒ¨ï¼Œçœ‹å…·ä½“çš„å®ç°ç»†èŠ‚ï¼›ç”¨ F8 å»çœ‹å½“å‰ä½ç½®ä»£ç å¾€ä¸‹çš„æ‰§è¡Œæƒ…å†µï¼ˆä¸è·³å…¥å…·ä½“æ–¹æ³•çš„å†…éƒ¨ï¼‰</p>
<h4 id="åŸæ–‡é“¾æ¥httpsblogcsdnnetfuture_god_qrarticledetails121250865"><a class="markdownIt-Anchor" href="#åŸæ–‡é“¾æ¥httpsblogcsdnnetfuture_god_qrarticledetails121250865">#</a> åŸæ–‡é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/future_god_qr/article/details/121250865">https://blog.csdn.net/future_god_qr/article/details/121250865</a></h4>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-05-05T01:57:09.000Z" title="2023-5-5 9:57:09">2023-05-05</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-05T02:03:30.951Z" title="2023-5-5 10:03:30">2023-05-05</time>æ›´æ–°</span><span class="level-item">11 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1580ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/05/05/%E3%80%90%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80%E3%80%91%E7%99%BE%E5%BA%A6%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E6%95%99%E7%A8%8B/">ã€æ–‡å¿ƒä¸€è¨€ã€‘ç™¾åº¦æ–‡å¿ƒä¸€è¨€å¤§å‹è¯­è¨€æ¨¡å‹æ¥å…¥æ•™ç¨‹</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="æ–‡å¿ƒä¸€è¨€ç™¾åº¦æ–‡å¿ƒä¸€è¨€å¤§å‹è¯­è¨€æ¨¡å‹æ¥å…¥æ•™ç¨‹"><a class="markdownIt-Anchor" href="#æ–‡å¿ƒä¸€è¨€ç™¾åº¦æ–‡å¿ƒä¸€è¨€å¤§å‹è¯­è¨€æ¨¡å‹æ¥å…¥æ•™ç¨‹">#</a> ã€æ–‡å¿ƒä¸€è¨€ã€‘ç™¾åº¦æ–‡å¿ƒä¸€è¨€å¤§å‹è¯­è¨€æ¨¡å‹æ¥å…¥æ•™ç¨‹</h1>
<h5 id="æ–‡å¿ƒä¸€è¨€æ˜¯ç™¾åº¦çš„æ™ºèƒ½å¯¹è¯äº§å“å®ƒå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œæµç•…-è‡ªç„¶-æœ‰è¶£çš„å¤šè½®å¯¹è¯æ¶µç›–äº†ç”Ÿæ´»-å¨±ä¹-æ•™è‚²-å•†åŠ¡ç­‰å¤šä¸ªé¢†åŸŸå’Œåœºæ™¯-æ–‡å¿ƒä¸€è¨€ä¸ä»…å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ä¾›ç”¨æˆ·ä½¿ç”¨ä¹Ÿå¯ä»¥é€šè¿‡ç™¾åº¦æ™ºèƒ½äº‘çš„apiè°ƒç”¨æ¥å£ä¸ºå„è¡Œå„ä¸šçš„ä¼ä¸šå®¢æˆ·æä¾›å¼ºå¤§è€Œçµæ´»çš„aièƒ½åŠ›èµ‹èƒ½æ›´å¤šè¡Œä¸šä¼™ä¼´"><a class="markdownIt-Anchor" href="#æ–‡å¿ƒä¸€è¨€æ˜¯ç™¾åº¦çš„æ™ºèƒ½å¯¹è¯äº§å“å®ƒå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œæµç•…-è‡ªç„¶-æœ‰è¶£çš„å¤šè½®å¯¹è¯æ¶µç›–äº†ç”Ÿæ´»-å¨±ä¹-æ•™è‚²-å•†åŠ¡ç­‰å¤šä¸ªé¢†åŸŸå’Œåœºæ™¯-æ–‡å¿ƒä¸€è¨€ä¸ä»…å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ä¾›ç”¨æˆ·ä½¿ç”¨ä¹Ÿå¯ä»¥é€šè¿‡ç™¾åº¦æ™ºèƒ½äº‘çš„apiè°ƒç”¨æ¥å£ä¸ºå„è¡Œå„ä¸šçš„ä¼ä¸šå®¢æˆ·æä¾›å¼ºå¤§è€Œçµæ´»çš„aièƒ½åŠ›èµ‹èƒ½æ›´å¤šè¡Œä¸šä¼™ä¼´">#</a> æ–‡å¿ƒä¸€è¨€æ˜¯ç™¾åº¦çš„æ™ºèƒ½å¯¹è¯äº§å“ï¼Œå®ƒå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œæµç•…ã€è‡ªç„¶ã€æœ‰è¶£çš„å¤šè½®å¯¹è¯ï¼Œæ¶µç›–äº†ç”Ÿæ´»ã€å¨±ä¹ã€æ•™è‚²ã€å•†åŠ¡ç­‰å¤šä¸ªé¢†åŸŸå’Œåœºæ™¯ã€‚æ–‡å¿ƒä¸€è¨€ä¸ä»…å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ä¾›ç”¨æˆ·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç™¾åº¦æ™ºèƒ½äº‘çš„ API è°ƒç”¨æ¥å£ï¼Œä¸ºå„è¡Œå„ä¸šçš„ä¼ä¸šå®¢æˆ·æä¾›å¼ºå¤§è€Œçµæ´»çš„ AI èƒ½åŠ›ï¼Œèµ‹èƒ½æ›´å¤šè¡Œä¸šä¼™ä¼´ã€‚</h5>
<h5 id="é‚£ä¹ˆä½œä¸ºä¸€ä¸ªä¼ä¸šå®¢æˆ·å¦‚ä½•æ¥å…¥æ–‡å¿ƒä¸€è¨€å‘¢æœ¬æ–‡å°†ä¸ºæ‚¨ä»‹ç»ç™¾åº¦æ™ºèƒ½äº‘æä¾›çš„å…¨é¢çš„aiè§£å†³æ–¹æ¡ˆå¸®åŠ©æ‚¨å¿«é€Ÿå®ç°ä¸æ–‡å¿ƒä¸€è¨€çš„å¯¹æ¥å’Œé›†æˆ"><a class="markdownIt-Anchor" href="#é‚£ä¹ˆä½œä¸ºä¸€ä¸ªä¼ä¸šå®¢æˆ·å¦‚ä½•æ¥å…¥æ–‡å¿ƒä¸€è¨€å‘¢æœ¬æ–‡å°†ä¸ºæ‚¨ä»‹ç»ç™¾åº¦æ™ºèƒ½äº‘æä¾›çš„å…¨é¢çš„aiè§£å†³æ–¹æ¡ˆå¸®åŠ©æ‚¨å¿«é€Ÿå®ç°ä¸æ–‡å¿ƒä¸€è¨€çš„å¯¹æ¥å’Œé›†æˆ">#</a> é‚£ä¹ˆï¼Œä½œä¸ºä¸€ä¸ªä¼ä¸šå®¢æˆ·ï¼Œå¦‚ä½•æ¥å…¥æ–‡å¿ƒä¸€è¨€å‘¢ï¼Ÿæœ¬æ–‡å°†ä¸ºæ‚¨ä»‹ç»ç™¾åº¦æ™ºèƒ½äº‘æä¾›çš„å…¨é¢çš„ AI è§£å†³æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå®ç°ä¸æ–‡å¿ƒä¸€è¨€çš„å¯¹æ¥å’Œé›†æˆã€‚</h5>
<h2 id="01ç¬¬ä¸€æ­¥æ³¨å†Œç™¾åº¦æ™ºèƒ½äº‘è´¦å·"><a class="markdownIt-Anchor" href="#01ç¬¬ä¸€æ­¥æ³¨å†Œç™¾åº¦æ™ºèƒ½äº‘è´¦å·">#</a> <strong>01</strong> ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œç™¾åº¦æ™ºèƒ½äº‘è´¦å·</h2>
<p>è¦ä½¿ç”¨ç™¾åº¦æ™ºèƒ½äº‘æä¾›çš„æœåŠ¡å’Œäº§å“ï¼Œæ‚¨é¦–å…ˆéœ€è¦æ³¨å†Œä¸€ä¸ªç™¾åº¦æ™ºèƒ½äº‘è´¦å·ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ³¨å†Œï¼š</p>
<ul>
<li>è®¿é—®ç™¾åº¦æ™ºèƒ½äº‘å®˜ç½‘ (<a target="_blank" rel="noopener" href="https://cloud.baidu.com/">https://cloud.baidu.com/</a>)ï¼Œç‚¹å‡»å³ä¸Šè§’ â€œå…è´¹æ³¨å†Œâ€ æŒ‰é’®ã€‚</li>
<li>è¾“å…¥æ‚¨çš„æ‰‹æœºå·ç ï¼Œå¹¶è·å–éªŒè¯ç ã€‚</li>
<li>è®¾ç½®æ‚¨çš„ç™»å½•å¯†ç ï¼Œå¹¶åŒæ„æœåŠ¡åè®®ã€‚</li>
<li>å®Œæˆå®åè®¤è¯ï¼Œå¹¶é€‰æ‹©è´¦å·ç±»å‹ (ä¸ªäººæˆ–ä¼ä¸š)ã€‚</li>
<li>å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ‚¨å°±æˆåŠŸæ³¨å†Œäº†ä¸€ä¸ªç™¾åº¦æ™ºèƒ½äº‘è´¦å·ã€‚</li>
</ul>
<h2 id="02ç¬¬äºŒæ­¥ç”³è¯·æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æƒé™"><a class="markdownIt-Anchor" href="#02ç¬¬äºŒæ­¥ç”³è¯·æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æƒé™">#</a> <strong>02</strong> ç¬¬äºŒæ­¥ï¼šç”³è¯·æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æƒé™</h2>
<p>â€‹		è¦ä½¿ç”¨æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£ï¼Œæ‚¨éœ€è¦ç”³è¯·ç›¸åº”çš„æƒé™ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œç”³è¯·ï¼š</p>
<ul>
<li><strong>ç™»å½•ç™¾åº¦æ™ºèƒ½äº‘æ§åˆ¶å° (<a target="_blank" rel="noopener" href="https://console.bce.baidu.com/">https://console.bce.baidu.com/</a>)ï¼Œç‚¹å‡»å·¦ä¾§å¯¼èˆªæ  â€œäººå·¥æ™ºèƒ½â€ ä¸‹æ‹‰èœå•ä¸­çš„ â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ é€‰é¡¹ã€‚</strong></li>
<li><strong>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¡µé¢ä¸­ï¼Œæ‰¾åˆ° â€œæ–‡å¿ƒä¸€è¨€â€ äº§å“ï¼Œå¹¶ç‚¹å‡» â€œç«‹å³ä½¿ç”¨â€ æŒ‰é’®ã€‚</strong></li>
<li><strong>åœ¨å¼¹å‡ºçª—å£ä¸­å¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œå¹¶æäº¤ç”³è¯·ã€‚</strong></li>
<li><strong>ç­‰å¾…å®¡æ ¸ç»“æœã€‚å®¡æ ¸é€šè¿‡åï¼Œæ‚¨å°±å¯ä»¥åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹å¹¶ç®¡ç†æ‚¨çš„æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æƒé™ã€‚</strong></li>
</ul>
<h2 id="03ç¬¬ä¸‰æ­¥é…ç½®å¹¶æµ‹è¯•æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æ¥å£"><a class="markdownIt-Anchor" href="#03ç¬¬ä¸‰æ­¥é…ç½®å¹¶æµ‹è¯•æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æ¥å£">#</a> <strong>03</strong> ç¬¬ä¸‰æ­¥ï¼šé…ç½®å¹¶æµ‹è¯•æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£</h2>
<p>â€‹		è¿›å…¥ï¼š<a target="_blank" rel="noopener" href="https://wenxin.baidu.com/user/key">https://wenxin.baidu.com/user/key</a></p>
<p>â€‹		ä½¿ç”¨æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£ï¼Œæ‚¨éœ€è¦é…ç½®ç›¸å…³å‚æ•°ï¼Œå¹¶è¿›è¡Œæµ‹è¯•ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé…ç½®å’Œæµ‹è¯•ï¼š</p>
<ul>
<li>åœ¨æ§åˆ¶å°ä¸­è¿›å…¥ â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ é¡µé¢ï¼Œå¹¶ç‚¹å‡» â€œæ–‡å¿ƒä¸€è¨€â€ äº§å“ä¸‹æ–¹çš„ â€œç®¡ç†â€ æŒ‰é’®ï¼Œè¿›å…¥æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„é…ç½®é¡µé¢ã€‚</li>
<li>åœ¨é…ç½®é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¹¶ä¿®æ”¹æ‚¨çš„æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚åº”ç”¨åç§°ã€åº”ç”¨æè¿°ã€åº”ç”¨ç±»å‹ç­‰ã€‚</li>
<li>æ‚¨è¿˜å¯ä»¥åœ¨é…ç½®é¡µé¢ä¸­è®¾ç½®æ‚¨çš„æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„å®‰å…¨è®¤è¯æ–¹å¼ï¼Œå¦‚ Access Key ID å’Œ Secret Access Keyã€‚è¿™äº›æ˜¯æ‚¨è°ƒç”¨æ–‡å¿ƒä¸€è¨€ API æ—¶éœ€è¦æä¾›çš„èº«ä»½å‡­è¯ï¼Œå»ºè®®æ‚¨å¦¥å–„ä¿ç®¡ï¼Œå¹¶å®šæœŸæ›´æ¢ã€‚</li>
<li>æ‚¨è¿˜å¯ä»¥åœ¨é…ç½®é¡µé¢ä¸­è®¾ç½®æ‚¨çš„æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„é…é¢å’Œé™æµç­–ç•¥ï¼Œå¦‚æ¯æ—¥è¯·æ±‚æ¬¡æ•°ã€æ¯ç§’è¯·æ±‚æ¬¡æ•°ç­‰ã€‚è¿™äº›æ˜¯ä¸ºäº†ä¿éšœæ‚¨å’Œå…¶ä»–ç”¨æˆ·çš„æœåŠ¡è´¨é‡å’Œå®‰å…¨æ€§ï¼Œå»ºè®®æ‚¨æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚åˆç†åˆ†é…ï¼Œå¹¶é¿å…è¶…å‡ºé™åˆ¶ã€‚</li>
<li>åœ¨å®Œæˆä»¥ä¸Šé…ç½®åï¼Œæ‚¨å°±å¯ä»¥åœ¨é…ç½®é¡µé¢ä¸­ç‚¹å‡» â€œåœ¨çº¿æµ‹è¯•â€ æŒ‰é’®ï¼Œè¿›è¡Œæ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„æµ‹è¯•ã€‚æµ‹è¯•æ—¶ï¼Œæ‚¨éœ€è¦è¾“å…¥ä¸€ä¸ªå¯¹è¯è¯­å¥ï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªå¯¹è¯é¢†åŸŸå’Œåœºæ™¯ã€‚ç„¶åç‚¹å‡» â€œå‘é€â€ æŒ‰é’®ï¼Œå³å¯æŸ¥çœ‹æ–‡å¿ƒä¸€è¨€ API è¿”å›çš„å¯¹è¯å›å¤ã€‚</li>
</ul>
<h2 id="04ç¬¬å››æ­¥é›†æˆå¹¶ä½¿ç”¨æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æ¥å£"><a class="markdownIt-Anchor" href="#04ç¬¬å››æ­¥é›†æˆå¹¶ä½¿ç”¨æ–‡å¿ƒä¸€è¨€apiè°ƒç”¨æ¥å£">#</a> <strong>04</strong> ç¬¬å››æ­¥ï¼šé›†æˆå¹¶ä½¿ç”¨æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£</h2>
<p>â€‹		è¦é›†æˆå¹¶ä½¿ç”¨æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£ï¼Œæ‚¨éœ€è¦æ ¹æ®è‡ªå·±çš„å¼€å‘ç¯å¢ƒå’Œè¯­è¨€é€‰æ‹©åˆé€‚çš„ SDK æˆ–å·¥å…·ï¼Œå¹¶ç¼–å†™ç›¸åº”çš„ä»£ç ã€‚ç™¾åº¦æ™ºèƒ½äº‘æä¾›äº†å¤šç§è¯­è¨€å’Œå¹³å°æ”¯æŒçš„ SDK æˆ–å·¥å…·ï¼Œå¦‚ Javaã€Pythonã€PHPã€Node.jsã€Androidã€iOS ç­‰ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé›†æˆå’Œä½¿ç”¨ï¼š</p>
<ul>
<li>åœ¨æ§åˆ¶å°ä¸­è¿›å…¥ â€œè‡ªç„¶è¯­è¨€å¤„ç†â€ é¡µé¢ï¼Œå¹¶ç‚¹å‡» â€œæ–‡å¿ƒä¸€è¨€â€ äº§å“ä¸‹æ–¹çš„ â€œæ–‡æ¡£â€ æŒ‰é’®ï¼Œè¿›å…¥æ–‡å¿ƒä¸€è¨€ API è°ƒç”¨æ¥å£çš„æ–‡æ¡£é¡µé¢ã€‚</li>
<li>åœ¨æ–‡æ¡£é¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å¹¶ä¸‹è½½æ‚¨æ‰€éœ€è¦çš„ SDK æˆ–å·¥å…·ï¼Œå¹¶å‚è€ƒç›¸å…³çš„ç¤ºä¾‹ä»£ç å’Œè¯´æ˜è¿›è¡Œé›†æˆå’Œä½¿ç”¨ã€‚</li>
<li>åœ¨å®Œæˆé›†æˆå’Œä½¿ç”¨åï¼Œæ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„åº”ç”¨ä¸­è°ƒç”¨æ–‡å¿ƒä¸€è¨€ APIï¼Œå®ç°ä¸ç”¨æˆ·çš„æ™ºèƒ½å¯¹è¯åŠŸèƒ½ã€‚</li>
</ul>
<h1 id="ç»“è¯­"><a class="markdownIt-Anchor" href="#ç»“è¯­">#</a> ç»“è¯­ï¼š</h1>
<p>â€‹		æ–‡å¿ƒä¸€è¨€æ˜¯ç™¾åº¦æ™ºèƒ½äº‘æ¨å‡ºçš„ä¸€æ¬¾åŸºäºå¤§è§„æ¨¡è‡ªç„¶è¯­è¨€ç”Ÿæˆæ¨¡å‹ (ChatGPT) çš„æ™ºèƒ½å¯¹è¯äº§å“ï¼Œå®ƒå¯ä»¥ä¸ç”¨æˆ·è¿›è¡Œæµç•…ã€è‡ªç„¶ã€æœ‰è¶£çš„å¤šè½®å¯¹è¯ï¼Œæ¶µç›–äº†ç”Ÿæ´»ã€å¨±ä¹ã€æ•™è‚²ã€å•†åŠ¡ç­‰å¤šä¸ªé¢†åŸŸå’Œåœºæ™¯ã€‚æœ¬æ–‡ä»‹ç»äº†ä½œä¸ºä¸€ä¸ªä¼ä¸šå®¢æˆ·ï¼Œå¦‚ä½•é€šè¿‡ç™¾åº¦æ™ºèƒ½äº‘æä¾›çš„å…¨é¢çš„ AI è§£å†³æ–¹æ¡ˆï¼Œå¿«é€Ÿå®ç°ä¸æ–‡å¿ƒä¸€è¨€çš„å¯¹æ¥å’Œé›†æˆã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-29T11:42:37.000Z" title="2023-4-29 19:42:37">2023-04-29</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-04-29T11:44:45.229Z" title="2023-4-29 19:44:45">2023-04-29</time>æ›´æ–°</span><span class="level-item">2 å°æ—¶è¯»å®Œ (å¤§çº¦20643ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/29/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%9123%20%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%EF%BC%88%E5%85%A823%E7%A7%8D%EF%BC%89/">ã€è®¾è®¡æ¨¡å¼ã€‘23 ç§è®¾è®¡æ¨¡å¼è¯¦è§£ï¼ˆå…¨23ç§ï¼‰</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="è®¾è®¡æ¨¡å¼23-ç§è®¾è®¡æ¨¡å¼è¯¦è§£å…¨23ç§"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼23-ç§è®¾è®¡æ¨¡å¼è¯¦è§£å…¨23ç§">#</a> ã€è®¾è®¡æ¨¡å¼ã€‘23 ç§è®¾è®¡æ¨¡å¼è¯¦è§£ï¼ˆå…¨ 23 ç§ï¼‰</h1>
<h1 id="è®¾è®¡æ¨¡å¼çš„åˆ†ç±»"><a class="markdownIt-Anchor" href="#è®¾è®¡æ¨¡å¼çš„åˆ†ç±»">#</a> è®¾è®¡æ¨¡å¼çš„åˆ†ç±»</h1>
<p>æ€»ä½“æ¥è¯´è®¾è®¡æ¨¡å¼åˆ†ä¸ºä¸‰å¤§ç±»ï¼š</p>
<p>åˆ›å»ºå‹æ¨¡å¼ï¼Œå…±äº”ç§ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</p>
<p>ç»“æ„å‹æ¨¡å¼ï¼Œå…±ä¸ƒç§ï¼šé€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚</p>
<p>è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…±åä¸€ç§ï¼šç­–ç•¥æ¨¡å¼ã€æ¨¡æ¿æ–¹æ³•æ¨¡å¼ã€è§‚å¯Ÿè€…æ¨¡å¼ã€è¿­ä»£å­æ¨¡å¼ã€è´£ä»»é“¾æ¨¡å¼ã€å‘½ä»¤æ¨¡å¼ã€å¤‡å¿˜å½•æ¨¡å¼ã€çŠ¶æ€æ¨¡å¼ã€è®¿é—®è€…æ¨¡å¼ã€ä¸­ä»‹è€…æ¨¡å¼ã€è§£é‡Šå™¨æ¨¡å¼ã€‚</p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h1 id="a-åˆ›å»ºæ¨¡å¼5ç§"><a class="markdownIt-Anchor" href="#a-åˆ›å»ºæ¨¡å¼5ç§">#</a> Aã€åˆ›å»ºæ¨¡å¼ï¼ˆ5 ç§ï¼‰</h1>
<p><strong>å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å•ä¾‹æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€‚</strong></p>
<h2 id="1-å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#1-å·¥å‚æ¨¡å¼">#</a> 1 å·¥å‚æ¨¡å¼</h2>
<h3 id="11-ç®€å•å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#11-ç®€å•å·¥å‚æ¨¡å¼">#</a> 1.1 ç®€å•å·¥å‚æ¨¡å¼</h3>
<p>** å®šä¹‰ï¼š** å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„ç±»ï¼Œç”±è¿™ä¸ªç±»æ¥å°è£…å®ä¾‹åŒ–å¯¹è±¡çš„è¡Œä¸ºã€‚</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>ï¼ˆæˆ‘ä»¬ä¸¾ä¸€ä¸ª pizza å·¥å‚çš„ä¾‹å­ï¼‰</p>
<p>pizza å·¥å‚ä¸€å…±ç”Ÿäº§ä¸‰ç§ç±»å‹çš„ pizzaï¼šchesse,pepper,greakã€‚é€šè¿‡å·¥å‚ç±»ï¼ˆSimplePizzaFactoryï¼‰å®ä¾‹åŒ–è¿™ä¸‰ç§ç±»å‹çš„å¯¹è±¡ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609001610870.png" class="has" width="503" height="276" />
<p>å·¥å‚ç±»çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimplePizzaFactory</span> &#123;</span><br><span class="line">       <span class="keyword">public</span> Pizza <span class="title function_">CreatePizza</span><span class="params">(String ordertype)</span> &#123;</span><br><span class="line">              <span class="type">Pizza</span> <span class="variable">pizza</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">              <span class="keyword">if</span> (ordertype.equals(<span class="string">&quot;cheese&quot;</span>)) &#123;</span><br><span class="line">                     pizza = <span class="keyword">new</span> <span class="title class_">CheesePizza</span>();</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ordertype.equals(<span class="string">&quot;greek&quot;</span>)) &#123;</span><br><span class="line">                     pizza = <span class="keyword">new</span> <span class="title class_">GreekPizza</span>();</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ordertype.equals(<span class="string">&quot;pepper&quot;</span>)) &#123;</span><br><span class="line">                     pizza = <span class="keyword">new</span> <span class="title class_">PepperPizza</span>();</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">return</span> pizza;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç®€å•å·¥å‚å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³•ï¼š</strong> ç®€å•å·¥å‚æ¨¡å¼æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œç±»çš„åˆ›å»ºä¾èµ–å·¥å‚ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦æ‹“å±•ç¨‹åºï¼Œå¿…é¡»å¯¹å·¥å‚ç±»è¿›è¡Œä¿®æ”¹ï¼Œè¿™è¿èƒŒäº†å¼€é—­åŸåˆ™ï¼Œæ‰€ä»¥ï¼Œä»è®¾è®¡è§’åº¦è€ƒè™‘ï¼Œæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œå¦‚ä½•è§£å†³ï¼Ÿæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•å¹¶åˆ›å»ºå¤šä¸ªä¸åŒçš„å·¥å‚ç±»å®ç°è¯¥æŠ½è±¡æ–¹æ³•ï¼Œè¿™æ ·ä¸€æ—¦éœ€è¦å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œç›´æ¥å¢åŠ æ–°çš„å·¥å‚ç±»å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦ä¿®æ”¹ä¹‹å‰çš„ä»£ç ã€‚è¿™ç§æ–¹æ³•ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯´çš„å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</p>
<h3 id="12-å·¥å‚æ–¹æ³•æ¨¡å¼"><a class="markdownIt-Anchor" href="#12-å·¥å‚æ–¹æ³•æ¨¡å¼">#</a> 1.2 å·¥å‚æ–¹æ³•æ¨¡å¼</h3>
<p>** å®šä¹‰ï¼š** å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼å°†å¯¹è±¡çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ã€‚</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>ï¼ˆæˆ‘ä»¬ä¾ç„¶ä¸¾ pizza å·¥å‚çš„ä¾‹å­ï¼Œä¸è¿‡è¿™ä¸ªä¾‹å­ä¸­ï¼Œpizza äº§åœ°æœ‰ä¸¤ä¸ªï¼šä¼¦æ•¦å’Œçº½çº¦ï¼‰ã€‚æ·»åŠ äº†ä¸€ä¸ªæ–°çš„äº§åœ°ï¼Œå¦‚æœç”¨ç®€å•å·¥å‚æ¨¡å¼çš„çš„è¯ï¼Œæˆ‘ä»¬è¦å»ä¿®æ”¹å·¥å‚ä»£ç ï¼Œå¹¶ä¸”ä¼šå¢åŠ ä¸€å †çš„ if else è¯­å¥ã€‚è€Œå·¥å‚æ–¹æ³•æ¨¡å¼å…‹æœäº†ç®€å•å·¥å‚è¦ä¿®æ”¹ä»£ç çš„ç¼ºç‚¹ï¼Œå®ƒä¼šç›´æ¥åˆ›å»ºä¸¤ä¸ªå·¥å‚ï¼Œçº½çº¦å·¥å‚å’Œä¼¦æ•¦å·¥å‚ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609001610872.png" class="has" width="279" height="144" />
<p>OrderPizza ä¸­æœ‰ä¸ªæŠ½è±¡çš„æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">abstract Pizza createPizza();</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªå·¥å‚ç±»ç»§æ‰¿ OrderPizza å¹¶å®ç°æŠ½è±¡æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class LDOrderPizza extends OrderPizza &#123;</span><br><span class="line">       Pizza createPizza(String ordertype) &#123;</span><br><span class="line">              Pizza pizza = null;</span><br><span class="line">              if (ordertype.equals(&quot;cheese&quot;)) &#123;</span><br><span class="line">                     pizza = new LDCheesePizza();</span><br><span class="line">              &#125; else if (ordertype.equals(&quot;pepper&quot;)) &#123;</span><br><span class="line">                     pizza = new LDPepperPizza();</span><br><span class="line">              &#125;</span><br><span class="line">              return pizza;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class NYOrderPizza extends OrderPizza &#123;</span><br><span class="line"></span><br><span class="line">    Pizza createPizza(String ordertype) &#123;</span><br><span class="line">        Pizza pizza = null;</span><br><span class="line"></span><br><span class="line">        if (ordertype.equals(&quot;cheese&quot;)) &#123;</span><br><span class="line">            pizza = new NYCheesePizza();</span><br><span class="line">        &#125; else if (ordertype.equals(&quot;pepper&quot;)) &#123;</span><br><span class="line">            pizza = new NYPepperPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        return pizza;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ã€é€šè¿‡ä¸åŒçš„å·¥å‚ä¼šå¾—åˆ°ä¸åŒçš„å®ä¾‹åŒ–çš„å¯¹è±¡ï¼ŒPizzaStroe çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class PizzaStroe &#123;</span><br><span class="line">       public static void main(String[] args) &#123;</span><br><span class="line">              OrderPizza mOrderPizza;</span><br><span class="line">              mOrderPizza = new NYOrderPizza();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** è§£å†³äº†ç®€å•å·¥å‚æ¨¡å¼çš„é—®é¢˜ï¼š** å¢åŠ ä¸€ä¸ªæ–°çš„ pizza äº§åœ°ï¼ˆåŒ—äº¬ï¼‰ï¼Œåªè¦å¢åŠ ä¸€ä¸ª BJOrderPizza ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class BJOrderPizza extends OrderPizza &#123;</span><br><span class="line">       Pizza createPizza(String ordertype) &#123;</span><br><span class="line">              Pizza pizza = null;</span><br><span class="line">              if (ordertype.equals(&quot;cheese&quot;)) &#123;</span><br><span class="line">                     pizza = new LDCheesePizza();</span><br><span class="line">              &#125; else if (ordertype.equals(&quot;pepper&quot;)) &#123;</span><br><span class="line">                     pizza = new LDPepperPizza();</span><br><span class="line">              &#125;</span><br><span class="line">              return pizza;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®è¿™ä¸ªæ¨¡å¼çš„å¥½å¤„å°±æ˜¯ï¼Œå¦‚æœä½ ç°åœ¨æƒ³å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œåªéœ€åšä¸€ä¸ªå®ç°ç±»å°± OK äº†ï¼Œæ— éœ€å»æ”¹åŠ¨ç°æˆçš„ä»£ç ã€‚è¿™æ ·åšï¼Œæ‹“å±•æ€§è¾ƒå¥½ï¼</p>
<p>** å·¥å‚æ–¹æ³•å­˜åœ¨çš„é—®é¢˜ä¸è§£å†³æ–¹æ³•ï¼š** å®¢æˆ·ç«¯éœ€è¦åˆ›å»ºç±»çš„å…·ä½“çš„å®ä¾‹ã€‚ç®€å•æ¥è¯´å°±æ˜¯ç”¨æˆ·è¦è®¢çº½çº¦å·¥å‚çš„æŠ«è¨ï¼Œä»–å¿…é¡»å»çº½çº¦å·¥å‚ï¼Œæƒ³è®¢ä¼¦æ•¦å·¥å‚çš„æŠ«è¨ï¼Œå¿…é¡»å»ä¼¦æ•¦å·¥å‚ã€‚ å½“ä¼¦æ•¦å·¥å‚å’Œçº½çº¦å·¥å‚å‘ç”Ÿå˜åŒ–äº†ï¼Œç”¨æˆ·ä¹Ÿè¦è·Ÿç€å˜åŒ–ï¼Œè¿™æ— ç–‘å°±å¢åŠ äº†ç”¨æˆ·çš„æ“ä½œå¤æ‚æ€§ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå·¥å‚ç±»æŠ½è±¡ä¸ºæ¥å£ï¼Œç”¨æˆ·åªéœ€è¦å»æ‰¾é»˜è®¤çš„å·¥å‚æå‡ºè‡ªå·±çš„éœ€æ±‚ï¼ˆä¼ å…¥å‚æ•°ï¼‰ï¼Œä¾¿èƒ½å¾—åˆ°è‡ªå·±æƒ³è¦äº§å“ï¼Œè€Œä¸ç”¨æ ¹æ®äº§å“å»å¯»æ‰¾ä¸åŒçš„å·¥å‚ï¼Œæ–¹ä¾¿ç”¨æˆ·æ“ä½œã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯´çš„æŠ½è±¡å·¥å‚æ¨¡å¼ã€‚</p>
<h3 id="13-æŠ½è±¡å·¥å‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#13-æŠ½è±¡å·¥å‚æ¨¡å¼">#</a> 1.3 æŠ½è±¡å·¥å‚æ¨¡å¼</h3>
<p>** å®šä¹‰ï¼š** å®šä¹‰äº†ä¸€ä¸ªæ¥å£ç”¨äºåˆ›å»ºç›¸å…³æˆ–æœ‰ä¾èµ–å…³ç³»çš„å¯¹è±¡æ—ï¼Œè€Œæ— éœ€æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚</p>
<p><strong>ä¸¾ä¾‹ï¼š</strong>ï¼ˆæˆ‘ä»¬ä¾ç„¶ä¸¾ pizza å·¥å‚çš„ä¾‹å­ï¼Œpizza å·¥å‚æœ‰ä¸¤ä¸ªï¼šçº½çº¦å·¥å‚å’Œä¼¦æ•¦å·¥å‚ï¼‰ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609001610898.png" class="has" width="433" height="208" />
<p>å·¥å‚çš„æ¥å£ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface AbsFactory &#123;</span><br><span class="line">       Pizza CreatePizza(String ordertype) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å·¥å‚çš„å®ç°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class LDFactory implements AbsFactory &#123;</span><br><span class="line">       @Override</span><br><span class="line">       public Pizza CreatePizza(String ordertype) &#123;</span><br><span class="line">              Pizza pizza = null;</span><br><span class="line">              if (&quot;cheese&quot;.equals(ordertype)) &#123;</span><br><span class="line">                     pizza = new LDCheesePizza();</span><br><span class="line">              &#125; else if (&quot;pepper&quot;.equals(ordertype)) &#123;</span><br><span class="line">                     pizza = new LDPepperPizza();</span><br><span class="line">              &#125;</span><br><span class="line">              return pizza;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PizzaStroe çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class PizzaStroe &#123;</span><br><span class="line">       public static void main(String[] args) &#123;</span><br><span class="line">              OrderPizza mOrderPizza;</span><br><span class="line">              mOrderPizza = new OrderPizza(&quot;London&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** è§£å†³äº†å·¥å‚æ–¹æ³•æ¨¡å¼çš„é—®é¢˜ï¼š** åœ¨æŠ½è±¡å·¥å‚ä¸­ PizzaStroe ä¸­åªéœ€è¦ä¼ å…¥å‚æ•°å°±å¯ä»¥å®ä¾‹åŒ–å¯¹è±¡ã€‚</p>
<h3 id="14-å·¥å‚æ¨¡å¼é€‚ç”¨çš„åœºåˆ"><a class="markdownIt-Anchor" href="#14-å·¥å‚æ¨¡å¼é€‚ç”¨çš„åœºåˆ">#</a> 1.4 å·¥å‚æ¨¡å¼é€‚ç”¨çš„åœºåˆ</h3>
<p>å¤§é‡çš„äº§å“éœ€è¦åˆ›å»ºï¼Œå¹¶ä¸”è¿™äº›äº§å“å…·æœ‰å…±åŒçš„æ¥å£ ã€‚</p>
<h3 id="15-ä¸‰ç§å·¥å‚æ¨¡å¼çš„ä½¿ç”¨é€‰æ‹©"><a class="markdownIt-Anchor" href="#15-ä¸‰ç§å·¥å‚æ¨¡å¼çš„ä½¿ç”¨é€‰æ‹©">#</a> 1.5  ä¸‰ç§å·¥å‚æ¨¡å¼çš„ä½¿ç”¨é€‰æ‹©</h3>
<p>ç®€å•å·¥å‚ ï¼š ç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„ä»»æ„äº§å“ã€‚ï¼ˆä¸æ”¯æŒæ‹“å±•å¢åŠ äº§å“ï¼‰</p>
<p>å·¥å‚æ–¹æ³• ï¼šç”¨æ¥ç”Ÿäº§åŒä¸€ç­‰çº§ç»“æ„ä¸­çš„å›ºå®šäº§å“ã€‚ï¼ˆæ”¯æŒæ‹“å±•å¢åŠ äº§å“ï¼‰</p>
<p>æŠ½è±¡å·¥å‚ ï¼šç”¨æ¥ç”Ÿäº§ä¸åŒäº§å“æ—çš„å…¨éƒ¨äº§å“ã€‚ï¼ˆæ”¯æŒæ‹“å±•å¢åŠ äº§å“ï¼›æ”¯æŒå¢åŠ äº§å“æ—ï¼‰</p>
<p>** ç®€å•å·¥å‚çš„é€‚ç”¨åœºåˆï¼š** åªæœ‰ä¼¦æ•¦å·¥å‚ï¼ˆåªæœ‰è¿™ä¸€ä¸ªç­‰çº§ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå·¥å‚åªç”Ÿäº§ä¸‰ç§ç±»å‹çš„ pizzaï¼šchesse,pepper,greakï¼ˆå›ºå®šäº§å“ï¼‰ã€‚</p>
<p><strong>å·¥å‚æ–¹æ³•çš„é€‚ç”¨åœºåˆ</strong>ï¼šç°åœ¨ä¸å…‰æœ‰ä¼¦æ•¦å·¥å‚ï¼Œè¿˜å¢è®¾äº†çº½çº¦å·¥å‚ï¼ˆä»ç„¶æ˜¯åŒä¸€ç­‰çº§ç»“æ„ï¼Œä½†æ˜¯æ”¯æŒäº†äº§å“çš„æ‹“å±•ï¼‰ï¼Œè¿™ä¸¤ä¸ªå·¥å‚ä¾ç„¶åªç”Ÿäº§ä¸‰ç§ç±»å‹çš„ pizzaï¼šchesse,pepper,greakï¼ˆå›ºå®šäº§å“ï¼‰ã€‚</p>
<p>** æŠ½è±¡å·¥å‚çš„é€‚ç”¨åœºåˆï¼š** ä¸å…‰å¢è®¾äº†çº½çº¦å·¥å‚ï¼ˆä»ç„¶æ˜¯åŒä¸€ç­‰çº§ç»“æ„ï¼Œä½†æ˜¯æ”¯æŒäº†äº§å“çš„æ‹“å±•ï¼‰ï¼Œè¿™ä¸¤ä¸ªå·¥å‚è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„ç±»å‹çš„ pizzaï¼šchinese pizzaï¼ˆå¢åŠ äº§å“æ—ï¼‰ã€‚</p>
<p>** æ‰€ä»¥è¯´æŠ½è±¡å·¥å‚å°±åƒå·¥å‚ï¼Œè€Œå·¥å‚æ–¹æ³•åˆ™åƒæ˜¯å·¥å‚çš„ä¸€ç§äº§å“ç”Ÿäº§çº¿ã€‚<strong>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºå·¥å‚ï¼Œè€Œç”¨å·¥å‚æ–¹æ³•æ¨¡å¼åˆ›å»ºç”Ÿäº§çº¿ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºä¼¦æ•¦å·¥å‚å’Œçº½çº¦å·¥å‚ï¼Œä½¿ç”¨å·¥å‚æ–¹æ³•å®ç° cheese pizza å’Œ greak pizza çš„ç”Ÿäº§ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</strong>     **</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609001610907.png" class="has" width="697" height="258" />
<p>æ€»ç»“ä¸€ä¸‹ä¸‰ç§æ¨¡å¼ï¼š</p>
<p><strong>ç®€å•å·¥å‚æ¨¡å¼å°±æ˜¯å»ºç«‹ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„ç±»ï¼Œåœ¨è¯¥ç±»ä¸­å¯¹å¤šä¸ªå¯¹è±¡å®ä¾‹åŒ–ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å†æœ‰æ–°çš„ç±»å‹çš„å¯¹è±¡éœ€è¦å®ä¾‹åŒ–åªè¦å¢åŠ å­ç±»å³å¯ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªæ¥å£ç”¨äºåˆ›å»ºå¯¹è±¡æ—ï¼Œè€Œæ— éœ€æ˜ç¡®æŒ‡å®šå…·ä½“ç±»ã€‚æŠ½è±¡å·¥å‚ä¹Ÿæ˜¯æŠŠå¯¹è±¡çš„å®ä¾‹åŒ–äº¤ç»™äº†å­ç±»ï¼Œå³æ”¯æŒæ‹“å±•ã€‚åŒæ—¶æä¾›ç»™å®¢æˆ·ç«¯æ¥å£ï¼Œé¿å…äº†ç”¨æˆ·ç›´æ¥æ“ä½œå­ç±»å·¥å‚ã€‚</strong></p>
<h3 id="-2"><a class="markdownIt-Anchor" href="#-2">#</a> </h3>
<h2 id="2-å•ä¾‹æ¨¡å¼"><a class="markdownIt-Anchor" href="#2-å•ä¾‹æ¨¡å¼">#</a> 2 å•ä¾‹æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** ç¡®ä¿ä¸€ä¸ªç±»æœ€å¤šåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹</p>
<p>å•ä¾‹æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šé¢„åŠ è½½å’Œæ‡’åŠ è½½</p>
<h3 id="21-é¢„åŠ è½½"><a class="markdownIt-Anchor" href="#21-é¢„åŠ è½½">#</a> 2.1 é¢„åŠ è½½</h3>
<p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é¢„å…ˆåŠ è½½ã€‚å†è¿›ä¸€æ­¥è§£é‡Šå°±æ˜¯è¿˜æ²¡æœ‰ä½¿ç”¨è¯¥å•ä¾‹å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œè¯¥å•ä¾‹å¯¹è±¡å°±å·²ç»è¢«åŠ è½½åˆ°å†…å­˜äº†ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class PreloadSingleton &#123;</span><br><span class="line">       </span><br><span class="line">       public static PreloadSingleton instance = new PreloadSingleton();</span><br><span class="line">   </span><br><span class="line">       //å…¶ä»–çš„ç±»æ— æ³•å®ä¾‹åŒ–å•ä¾‹ç±»çš„å¯¹è±¡</span><br><span class="line">       private PreloadSingleton() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       </span><br><span class="line">       public static PreloadSingleton getInstance() &#123;</span><br><span class="line">              return instance;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å¾ˆæ˜æ˜¾ï¼Œæ²¡æœ‰ä½¿ç”¨è¯¥å•ä¾‹å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°±è¢«åŠ è½½åˆ°äº†å†…å­˜ï¼Œä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</strong></p>
<h3 id="22-æ‡’åŠ è½½"><a class="markdownIt-Anchor" href="#22-æ‡’åŠ è½½">#</a> 2.2 æ‡’åŠ è½½</h3>
<p>ä¸ºäº†é¿å…å†…å­˜çš„æµªè´¹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ‡’åŠ è½½ï¼Œå³ç”¨åˆ°è¯¥å•ä¾‹å¯¹è±¡çš„æ—¶å€™å†åˆ›å»ºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">       </span><br><span class="line">       private static Singleton instance=null;</span><br><span class="line">       </span><br><span class="line">       private Singleton()&#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       </span><br><span class="line">       public static Singleton getInstance()</span><br><span class="line">       &#123;</span><br><span class="line">              if(instance==null)</span><br><span class="line">              &#123;</span><br><span class="line">                     instance=new Singleton();</span><br><span class="line">              &#125;</span><br><span class="line">              return instance;</span><br><span class="line">              </span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="23-å•ä¾‹æ¨¡å¼å’Œçº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#23-å•ä¾‹æ¨¡å¼å’Œçº¿ç¨‹å®‰å…¨">#</a> 2.3 å•ä¾‹æ¨¡å¼å’Œçº¿ç¨‹å®‰å…¨</h3>
<p>ï¼ˆ1ï¼‰é¢„åŠ è½½åªæœ‰ä¸€æ¡è¯­å¥ return instance, è¿™æ˜¾ç„¶å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬çŸ¥é“é¢„åŠ è½½ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚</p>
<p>ï¼ˆ2ï¼‰æ‡’åŠ è½½ä¸æµªè´¹å†…å­˜ï¼Œä½†æ˜¯æ— æ³•ä¿è¯çº¿ç¨‹çš„å®‰å…¨ã€‚é¦–å…ˆï¼Œif åˆ¤æ–­ä»¥åŠå…¶å†…å­˜æ‰§è¡Œä»£ç æ˜¯éåŸå­æ€§çš„ã€‚å…¶æ¬¡ï¼Œnew Singleton () æ— æ³•ä¿è¯æ‰§è¡Œçš„é¡ºåºæ€§ã€‚</p>
<p>ä¸æ»¡è¶³åŸå­æ€§æˆ–è€…é¡ºåºæ€§ï¼Œçº¿ç¨‹è‚¯å®šæ˜¯ä¸å®‰å…¨çš„ï¼Œè¿™æ˜¯åŸºæœ¬çš„å¸¸è¯†ï¼Œä¸å†èµ˜è¿°ã€‚æˆ‘ä¸»è¦è®²ä¸€ä¸‹ä¸ºä»€ä¹ˆ new Singleton () æ— æ³•ä¿è¯é¡ºåºæ€§ã€‚æˆ‘ä»¬çŸ¥é“åˆ›å»ºä¸€ä¸ªå¯¹è±¡åˆ†ä¸‰æ­¥:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">memory=allocate();//1:åˆå§‹åŒ–å†…å­˜ç©ºé—´</span><br><span class="line"></span><br><span class="line">ctorInstance(memory);//2:åˆå§‹åŒ–å¯¹è±¡</span><br><span class="line"></span><br><span class="line">instance=memory();//3:è®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</span><br></pre></td></tr></table></figure>
<p>**jvm ä¸ºäº†æé«˜ç¨‹åºæ‰§è¡Œæ€§èƒ½ï¼Œä¼šå¯¹æ²¡æœ‰ä¾èµ–å…³ç³»çš„ä»£ç è¿›è¡Œé‡æ’åºï¼Œä¸Šé¢ 2 å’Œ 3 è¡Œä»£ç å¯èƒ½è¢«é‡æ–°æ’åºã€‚** æˆ‘ä»¬ç”¨ä¸¤ä¸ªçº¿ç¨‹æ¥è¯´æ˜çº¿ç¨‹æ˜¯ä¸å®‰å…¨çš„ã€‚çº¿ç¨‹ A å’Œçº¿ç¨‹ B éƒ½åˆ›å»ºå¯¹è±¡ã€‚å…¶ä¸­ï¼ŒA2 å’Œ A3 çš„é‡æ’åºï¼Œå°†å¯¼è‡´çº¿ç¨‹ B åœ¨ B1 å¤„åˆ¤æ–­å‡º instance ä¸ä¸ºç©ºï¼Œçº¿ç¨‹ B æ¥ä¸‹æ¥å°†è®¿é—® instance å¼•ç”¨çš„å¯¹è±¡ã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ B å°†ä¼šè®¿é—®åˆ°ä¸€ä¸ªè¿˜æœªåˆå§‹åŒ–çš„å¯¹è±¡ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€‚</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609030328860.png" class="has" width="674" height="386" />
<h3 id="24-ä¿è¯æ‡’åŠ è½½çš„çº¿ç¨‹å®‰å…¨"><a class="markdownIt-Anchor" href="#24-ä¿è¯æ‡’åŠ è½½çš„çº¿ç¨‹å®‰å…¨">#</a> 2.4 ä¿è¯æ‡’åŠ è½½çš„çº¿ç¨‹å®‰å…¨</h3>
<p><span style="color:#000000;">æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯ä½¿ç”¨</span><span style="color:#f33b45;">synchronized</span><span style="color:#000000;">å…³é”®å­—ã€‚</span><span style="color:#f33b45;">synchronized</span>åŠ è½½ getInstace () å‡½æ•°ä¸Šç¡®å®ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦ç»å¸¸çš„è°ƒç”¨<span style="color:#000000;"><span style="color:#7f0055;"><span style="color:#7f0055;"><span style="color:#333333;">getInstance () æ–¹æ³•ï¼Œä¸ç®¡æœ‰æ²¡æœ‰åˆå§‹åŒ–å®ä¾‹ï¼Œéƒ½ä¼šå”¤é†’å’Œé˜»å¡çº¿ç¨‹ã€‚ä¸ºäº†é¿å…çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—å¤§é‡æ—¶é—´ï¼Œå¦‚æœå¯¹è±¡å·²ç»å®ä¾‹åŒ–äº†ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦å†ä½¿ç”¨</span></span></span></span><span style="color:#f33b45;">synchronized</span><span style="color:#000000;"><span style="color:#7f0055;"><span style="color:#7f0055;"><span style="color:#333333;">åŠ é”ï¼Œç›´æ¥è¿”å›å¯¹è±¡ã€‚</span></span></span></span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">       private static Singleton instance = null;</span><br><span class="line">       private Singleton() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       public static synchronized Singleton getInstance() &#123;</span><br><span class="line">              if (instance == null) &#123;</span><br><span class="line">                     instance = new Singleton();</span><br><span class="line">              &#125;</span><br><span class="line">              return instance;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æŠŠ<span style="color:#f33b45;">sychronized</span>åŠ åœ¨ if (instance==null) åˆ¤æ–­è¯­å¥é‡Œé¢ï¼Œ<strong>ä¿è¯ instance æœªå®ä¾‹åŒ–çš„æ—¶å€™æ‰åŠ é”</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">       private static Singleton instance = null;</span><br><span class="line">       private Singleton() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       public static synchronized Singleton getInstance() &#123;</span><br><span class="line">              if (instance == null) &#123;</span><br><span class="line">                     synchronized (Singleton.class) &#123;</span><br><span class="line">                           if (instance == null) &#123;</span><br><span class="line">                                  instance = new Singleton();</span><br><span class="line">                           &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              return instance;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç»è¿‡ 2.3 çš„è®¨è®ºçŸ¥é“ new ä¸€ä¸ªå¯¹è±¡çš„ä»£ç æ˜¯æ— æ³•ä¿è¯é¡ºåºæ€§çš„ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªå…³é”®å­—<span style="color:#f33b45;">volatile</span>ä¿è¯å¯¹è±¡å®ä¾‹åŒ–è¿‡ç¨‹çš„é¡ºåºæ€§ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Singleton &#123;</span><br><span class="line">       private static volatile Singleton instance = null;</span><br><span class="line">       private Singleton() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       public static synchronized Singleton getInstance() &#123;</span><br><span class="line">              if (instance == null) &#123;</span><br><span class="line">                     synchronized (instance) &#123;</span><br><span class="line">                           if (instance == null) &#123;</span><br><span class="line">                                  instance = new Singleton();</span><br><span class="line">                           &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              return instance;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>åˆ°æ­¤ï¼Œæˆ‘ä»¬å°±ä¿è¯äº†æ‡’åŠ è½½çš„çº¿ç¨‹å®‰å…¨ã€‚</strong></p>
<h2 id="3-ç”Ÿæˆå™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#3-ç”Ÿæˆå™¨æ¨¡å¼">#</a> 3 ç”Ÿæˆå™¨æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å°è£…ä¸€ä¸ªå¤æ‚å¯¹è±¡æ„é€ è¿‡ç¨‹ï¼Œå¹¶å…è®¸æŒ‰æ­¥éª¤æ„é€ ã€‚</p>
<p><strong>å®šä¹‰è§£é‡Šï¼š</strong> æˆ‘ä»¬å¯ä»¥å°†ç”Ÿæˆå™¨æ¨¡å¼ç†è§£ä¸ºï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯¹è±¡éœ€è¦å»ºç«‹ï¼Œè¿™ä¸ªå¯¹è±¡æ˜¯ç”±å¤šä¸ªç»„ä»¶ï¼ˆComponentï¼‰ç»„åˆè€Œæˆï¼Œæ¯ä¸ªç»„ä»¶çš„å»ºç«‹éƒ½æ¯”è¾ƒå¤æ‚ï¼Œä½†è¿ç”¨ç»„ä»¶æ¥å»ºç«‹æ‰€éœ€çš„å¯¹è±¡éå¸¸ç®€å•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å°†æ„å»ºå¤æ‚ç»„ä»¶çš„æ­¥éª¤ä¸è¿ç”¨ç»„ä»¶æ„å»ºå¯¹è±¡åˆ†ç¦»ï¼Œä½¿ç”¨ builder æ¨¡å¼å¯ä»¥å»ºç«‹ã€‚</p>
<h3 id="31-æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#31-æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 3.1 æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<p>ç”Ÿæˆå™¨æ¨¡å¼ç»“æ„ä¸­åŒ…æ‹¬å››ç§è§’è‰²ï¼š</p>
<p>ï¼ˆ1ï¼‰äº§å“ (Product)ï¼šå…·ä½“ç”Ÿäº§å™¨è¦æ„é€ çš„å¤æ‚å¯¹è±¡ï¼›</p>
<p>ï¼ˆ2ï¼‰æŠ½è±¡ç”Ÿæˆå™¨ (Bulider)ï¼šæŠ½è±¡ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£é™¤äº†ä¸ºåˆ›å»ºä¸€ä¸ª Product å¯¹è±¡çš„å„ä¸ªç»„ä»¶å®šä¹‰äº†è‹¥å¹²ä¸ªæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜è¦å®šä¹‰è¿”å› Product å¯¹è±¡çš„æ–¹æ³•ï¼ˆ<strong>å®šä¹‰æ„é€ æ­¥éª¤</strong>ï¼‰ï¼›</p>
<p>ï¼ˆ3ï¼‰å…·ä½“ç”Ÿäº§å™¨ (ConcreteBuilder)ï¼šå®ç° Builder æ¥å£çš„ç±»ï¼Œå…·ä½“ç”Ÿæˆå™¨å°†å®ç° Builder æ¥å£æ‰€å®šä¹‰çš„æ–¹æ³•ï¼ˆ<strong>ç”Ÿäº§å„ä¸ªç»„ä»¶</strong>ï¼‰ï¼›</p>
<p>ï¼ˆ4ï¼‰æŒ‡æŒ¥è€… (Director)ï¼šæŒ‡æŒ¥è€…æ˜¯ä¸€ä¸ªç±»ï¼Œè¯¥ç±»éœ€è¦å«æœ‰ Builder æ¥å£å£°æ˜çš„å˜é‡ã€‚æŒ‡æŒ¥è€…çš„èŒè´£æ˜¯è´Ÿè´£å‘ç”¨æˆ·æä¾›å…·ä½“ç”Ÿæˆå™¨ï¼Œå³æŒ‡æŒ¥è€…å°†è¯·æ±‚å…·ä½“ç”Ÿæˆå™¨ç±»æ¥æ„é€ ç”¨æˆ·æ‰€éœ€è¦çš„ Product å¯¹è±¡ï¼Œå¦‚æœæ‰€è¯·æ±‚çš„å…·ä½“ç”Ÿæˆå™¨æˆåŠŸåœ°æ„é€ å‡º Product å¯¹è±¡ï¼ŒæŒ‡æŒ¥è€…å°±å¯ä»¥è®©è¯¥å…·ä½“ç”Ÿäº§å™¨è¿”å›æ‰€æ„é€ çš„ Product å¯¹è±¡ã€‚ï¼ˆ<strong>æŒ‰ç…§æ­¥éª¤ç»„è£…éƒ¨ä»¶ï¼Œå¹¶è¿”å› Product</strong>ï¼‰</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609172340456.png" class="has" width="680" height="225" />
<p><strong>ä¸¾ä¾‹</strong>ï¼ˆæˆ‘ä»¬å¦‚æœæ„å»ºç”Ÿæˆä¸€å°ç”µè„‘ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½éœ€è¦è¿™ä¹ˆå‡ ä¸ªæ­¥éª¤ï¼ˆ1ï¼‰éœ€è¦ä¸€ä¸ªä¸»æœºï¼ˆ2ï¼‰éœ€è¦ä¸€ä¸ªæ˜¾ç¤ºå™¨ï¼ˆ3ï¼‰éœ€è¦ä¸€ä¸ªé”®ç›˜ï¼ˆ4ï¼‰éœ€è¦ä¸€ä¸ªé¼ æ ‡ï¼‰</p>
<p>è™½ç„¶æˆ‘ä»¬å…·ä½“åœ¨æ„å»ºä¸€å°ä¸»æœºçš„æ—¶å€™ï¼Œæ¯ä¸ªå¯¹è±¡çš„å®é™…æ­¥éª¤æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ï¼Œæœ‰çš„å¯¹è±¡æ„å»ºäº† i7cpu çš„ä¸»æœºï¼Œæœ‰çš„å¯¹è±¡æ„å»ºäº† i5cpu çš„ä¸»æœºï¼Œæœ‰çš„å¯¹è±¡æ„å»ºäº†æ™®é€šé”®ç›˜ï¼Œæœ‰çš„å¯¹è±¡æ„å»ºäº†æœºæ¢°é”®ç›˜ç­‰ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œä½ æ€»æ˜¯éœ€è¦ç»è¿‡ä¸€ä¸ªæ­¥éª¤å°±æ˜¯æ„å»ºä¸€å°ä¸»æœºï¼Œä¸€å°é”®ç›˜ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨æ¨¡å¼æ¥ç”Ÿæˆä¸€å°ç”µè„‘ï¼Œä»–éœ€è¦é€šè¿‡å¤šä¸ªæ­¥éª¤æ¥ç”Ÿæˆã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609172340477.png" class="has" width="470" height="437" />
<p>ComputerBuilder ç±»å®šä¹‰æ„é€ æ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public abstract class ComputerBuilder &#123;</span><br><span class="line">   </span><br><span class="line">    protected Computer computer;</span><br><span class="line">   </span><br><span class="line">    public Computer getComputer() &#123;</span><br><span class="line">        return computer;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    public void buildComputer() &#123;</span><br><span class="line">        computer = new Computer();</span><br><span class="line">        System.out.println(&quot;ç”Ÿæˆäº†ä¸€å°ç”µè„‘ï¼ï¼ï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public abstract void buildMaster();</span><br><span class="line">    public abstract void buildScreen();</span><br><span class="line">    public abstract void buildKeyboard();</span><br><span class="line">    public abstract void buildMouse();</span><br><span class="line">    public abstract void buildAudio();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HPComputerBuilder å®šä¹‰å„ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class HPComputerBuilder extends ComputerBuilder &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void buildMaster() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        computer.setMaster(&quot;i7,16g,512SSD,1060&quot;);</span><br><span class="line">        System.out.println(&quot;(i7,16g,512SSD,1060)çš„æƒ æ™®ä¸»æœº&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void buildScreen() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        computer.setScreen(&quot;1080p&quot;);</span><br><span class="line">        System.out.println(&quot;(1080p)çš„æƒ æ™®æ˜¾ç¤ºå±&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void buildKeyboard() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        computer.setKeyboard(&quot;cherry é’è½´æœºæ¢°é”®ç›˜&quot;);</span><br><span class="line">        System.out.println(&quot;(cherry é’è½´æœºæ¢°é”®ç›˜)çš„é”®ç›˜&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void buildMouse() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        computer.setMouse(&quot;MI é¼ æ ‡&quot;);</span><br><span class="line">        System.out.println(&quot;(MI é¼ æ ‡)çš„é¼ æ ‡&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void buildAudio() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        computer.setAudio(&quot;é£åˆ©æµ¦ éŸ³å“&quot;);</span><br><span class="line">        System.out.println(&quot;(é£åˆ©æµ¦ éŸ³å“)çš„éŸ³å“&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Director ç±»å¯¹ç»„ä»¶è¿›è¡Œç»„è£…å¹¶ç”Ÿæˆäº§å“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class Director &#123;</span><br><span class="line">   </span><br><span class="line">    private ComputerBuilder computerBuilder;</span><br><span class="line">    public void setComputerBuilder(ComputerBuilder computerBuilder) &#123;</span><br><span class="line">        this.computerBuilder = computerBuilder;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    public Computer getComputer() &#123;</span><br><span class="line">        return computerBuilder.getComputer();</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    public void constructComputer() &#123;</span><br><span class="line">        computerBuilder.buildComputer();</span><br><span class="line">        computerBuilder.buildMaster();</span><br><span class="line">        computerBuilder.buildScreen();</span><br><span class="line">        computerBuilder.buildKeyboard();</span><br><span class="line">        computerBuilder.buildMouse();</span><br><span class="line">        computerBuilder.buildAudio();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="32-ç”Ÿæˆå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#32-ç”Ÿæˆå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹">#</a> 3.2 ç”Ÿæˆå™¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹</h3>
<h3 id="ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#ä¼˜ç‚¹">#</a> ä¼˜ç‚¹</h3>
<ul>
<li>
<p>å°†ä¸€ä¸ªå¯¹è±¡åˆ†è§£ä¸ºå„ä¸ªç»„ä»¶</p>
</li>
<li>
<p>å°†å¯¹è±¡ç»„ä»¶çš„æ„é€ å°è£…èµ·æ¥</p>
</li>
<li>
<p>å¯ä»¥æ§åˆ¶æ•´ä¸ªå¯¹è±¡çš„ç”Ÿæˆè¿‡ç¨‹</p>
</li>
</ul>
<h3 id="ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#ç¼ºç‚¹">#</a> ç¼ºç‚¹</h3>
<ul>
<li>å¯¹ä¸åŒç±»å‹çš„å¯¹è±¡éœ€è¦å®ç°ä¸åŒçš„å…·ä½“æ„é€ å™¨çš„ç±»ï¼Œè¿™å¯èƒ½å›ç­”å¤§å¤§å¢åŠ ç±»çš„æ•°é‡</li>
</ul>
<h3 id="33-ç”Ÿæˆå™¨æ¨¡å¼ä¸å·¥å‚æ¨¡å¼çš„ä¸åŒ"><a class="markdownIt-Anchor" href="#33-ç”Ÿæˆå™¨æ¨¡å¼ä¸å·¥å‚æ¨¡å¼çš„ä¸åŒ">#</a> 3.3 ç”Ÿæˆå™¨æ¨¡å¼ä¸å·¥å‚æ¨¡å¼çš„ä¸åŒ</h3>
<p>ç”Ÿæˆå™¨æ¨¡å¼æ„å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡é€šå¸¸æ„å»ºçš„è¿‡ç¨‹ä¸­éœ€è¦å¤šä¸ªæ­¥éª¤ï¼Œå°±åƒæˆ‘ä»¬ä¾‹å­ä¸­çš„å…ˆæœ‰ä¸»æœºï¼Œå†æœ‰æ˜¾ç¤ºå±ï¼Œå†æœ‰é¼ æ ‡ç­‰ç­‰ï¼Œç”Ÿæˆå™¨æ¨¡å¼çš„ä½œç”¨å°±æ˜¯å°†è¿™äº›å¤æ‚çš„æ„å»ºè¿‡ç¨‹å°è£…èµ·æ¥ã€‚å·¥å‚æ¨¡å¼æ„å»ºå¯¹è±¡çš„æ—¶å€™é€šå¸¸å°±åªæœ‰ä¸€ä¸ªæ­¥éª¤ï¼Œè°ƒç”¨ä¸€ä¸ªå·¥å‚æ–¹æ³•å°±å¯ä»¥ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚</p>
<h2 id="4-åŸå‹æ¨¡å¼"><a class="markdownIt-Anchor" href="#4-åŸå‹æ¨¡å¼">#</a> 4 åŸå‹æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** é€šè¿‡å¤åˆ¶ç°æœ‰å®ä¾‹æ¥åˆ›å»ºæ–°çš„å®ä¾‹ï¼Œæ— éœ€çŸ¥é“ç›¸åº”ç±»çš„ä¿¡æ¯ã€‚</p>
<p>ç®€å•åœ°ç†è§£ï¼Œå…¶å®å°±æ˜¯å½“éœ€è¦åˆ›å»ºä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬åˆšå¥½æœ‰ä¸€ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼Œä½†æ˜¯åˆä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œæˆ‘ä¼š clone ä¸€ä¸ªä¸€æ¯›ä¸€æ ·çš„æ–°å¯¹è±¡æ¥ä½¿ç”¨ï¼›åŸºæœ¬ä¸Šè¿™å°±æ˜¯åŸå‹æ¨¡å¼ã€‚å…³é”®å­—ï¼š<strong>Clone</strong>ã€‚</p>
<h3 id="41-æ·±æ‹·è´å’Œæµ…æ‹·è´"><a class="markdownIt-Anchor" href="#41-æ·±æ‹·è´å’Œæµ…æ‹·è´">#</a> 4.1 æ·±æ‹·è´å’Œæµ…æ‹·è´</h3>
<p>æµ…å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼ŒåŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œè€Œå¼•ç”¨ç±»å‹ï¼ŒæŒ‡å‘çš„è¿˜æ˜¯åŸå¯¹è±¡æ‰€æŒ‡å‘çš„ã€‚</p>
<p>æ·±å¤åˆ¶ï¼šå°†ä¸€ä¸ªå¯¹è±¡å¤åˆ¶åï¼Œä¸è®ºæ˜¯åŸºæœ¬æ•°æ®ç±»å‹è¿˜æœ‰å¼•ç”¨ç±»å‹ï¼Œéƒ½æ˜¯é‡æ–°åˆ›å»ºçš„ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æ·±å¤åˆ¶è¿›è¡Œäº†å®Œå…¨å½»åº•çš„å¤åˆ¶ï¼Œè€Œæµ…å¤åˆ¶ä¸å½»åº•ã€‚clone æ˜æ˜¾æ˜¯æ·±å¤åˆ¶ï¼Œclone å‡ºæ¥çš„å¯¹è±¡æ˜¯æ˜¯ä¸èƒ½å»å½±å“åŸå‹å¯¹è±¡çš„</p>
<h3 id="42-åŸå‹æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#42-åŸå‹æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 4.2 åŸå‹æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609184856243.png" class="has" width="367" height="237" />
<p>Clientï¼šä½¿ç”¨è€…</p>
<p>Prototypeï¼šæ¥å£ï¼ˆæŠ½è±¡ç±»ï¼‰ï¼Œå£°æ˜å…·å¤‡ clone èƒ½åŠ›ï¼Œä¾‹å¦‚ java ä¸­å¾— Cloneable æ¥å£</p>
<p>ConcretePrototypeï¼šå…·ä½“çš„åŸå‹ç±»</p>
<p>å¯ä»¥çœ‹å‡ºè®¾è®¡æ¨¡å¼è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œé‡ç‚¹åœ¨äº Prototype æ¥å£å’Œ Prototype æ¥å£çš„å®ç°ç±» ConcretePrototypeã€‚åŸå‹æ¨¡å¼çš„å…·ä½“å®ç°ï¼šä¸€ä¸ªåŸå‹ç±»ï¼Œåªéœ€è¦å®ç° Cloneable æ¥å£ï¼Œè¦†å†™ clone æ–¹æ³•ï¼Œæ­¤å¤„ clone æ–¹æ³•å¯ä»¥æ”¹æˆä»»æ„çš„åç§°ï¼Œå› ä¸º Cloneable æ¥å£æ˜¯ä¸ªç©ºæ¥å£ï¼Œä½ å¯ä»¥ä»»æ„å®šä¹‰å®ç°ç±»çš„æ–¹æ³•åï¼Œå¦‚ cloneA æˆ–è€… cloneBï¼Œå› ä¸ºæ­¤å¤„çš„é‡ç‚¹æ˜¯ super.clone () è¿™å¥è¯ï¼Œsuper.clone () è°ƒç”¨çš„æ˜¯ Object çš„ clone () æ–¹æ³•ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class Prototype implements Cloneable &#123;  </span><br><span class="line">     public Object clone() throws CloneNotSupportedException &#123;  </span><br><span class="line">         Prototype proto = (Prototype) super.clone();  </span><br><span class="line">         return proto;  </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>** ä¸¾ä¾‹ï¼ˆ<strong>é“¶è¡Œå‘é€å¤§é‡é‚®ä»¶ï¼Œä½¿ç”¨ clone å’Œä¸ä½¿ç”¨ clone çš„æ—¶é—´å¯¹æ¯”</strong>ï¼‰ï¼š** æˆ‘ä»¬æ¨¡æ‹Ÿåˆ›å»ºä¸€ä¸ªå¯¹è±¡éœ€è¦è€—è´¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œå› æ­¤ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æˆ‘ä»¬è®©å½“å‰çº¿ç¨‹ sleep ä¸€ä¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public Mail(EventTemplate et) &#123;</span><br><span class="line">              this.tail = et.geteventContent();</span><br><span class="line">              this.subject = et.geteventSubject();</span><br><span class="line">              try &#123;</span><br><span class="line">                     Thread.sleep(1000);</span><br><span class="line">              &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                     // TODO Auto-generated catch block</span><br><span class="line">                     e.printStackTrace();</span><br><span class="line">              &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ä½¿ç”¨ clone, å‘é€åä¸ªé‚®ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">              int i = 0;</span><br><span class="line">              int MAX_COUNT = 10;</span><br><span class="line">              EventTemplate et = new EventTemplate(&quot;9æœˆä»½ä¿¡ç”¨å¡è´¦å•&quot;, &quot;å›½åº†æŠ½å¥–æ´»åŠ¨...&quot;);</span><br><span class="line">              long start = System.currentTimeMillis();</span><br><span class="line">              while (i &lt; MAX_COUNT) &#123;</span><br><span class="line">                     // ä»¥ä¸‹æ˜¯æ¯å°é‚®ä»¶ä¸åŒçš„åœ°æ–¹</span><br><span class="line">                     Mail mail = new Mail(et);</span><br><span class="line">                     mail.setContent(getRandString(5) + &quot;,å…ˆç”Ÿï¼ˆå¥³å£«ï¼‰:ä½ çš„ä¿¡ç”¨å¡è´¦å•...&quot; + mail.getTail());</span><br><span class="line">                     mail.setReceiver(getRandString(5) + &quot;@&quot; + getRandString(8) + &quot;.com&quot;);</span><br><span class="line">                     // ç„¶åå‘é€é‚®ä»¶</span><br><span class="line">                     sendMail(mail);</span><br><span class="line">                     i++;</span><br><span class="line">              &#125;</span><br><span class="line">              long end = System.currentTimeMillis();</span><br><span class="line">              System.out.println(&quot;ç”¨æ—¶:&quot; + (end - start));</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç”¨æ—¶ï¼š10001</strong></p>
<p>ä½¿ç”¨ clone, å‘é€åä¸ªé‚®ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">          int i = 0;</span><br><span class="line">          int MAX_COUNT = 10;</span><br><span class="line">          EventTemplate et = new EventTemplate(&quot;9æœˆä»½ä¿¡ç”¨å¡è´¦å•&quot;, &quot;å›½åº†æŠ½å¥–æ´»åŠ¨...&quot;);</span><br><span class="line">          long start=System.currentTimeMillis();</span><br><span class="line">          Mail mail = new Mail(et);         </span><br><span class="line">          while (i &lt; MAX_COUNT) &#123;</span><br><span class="line">                 Mail cloneMail = mail.clone();</span><br><span class="line">                 mail.setContent(getRandString(5) + &quot;,å…ˆç”Ÿï¼ˆå¥³å£«ï¼‰:ä½ çš„ä¿¡ç”¨å¡è´¦å•...&quot;</span><br><span class="line">                              + mail.getTail());</span><br><span class="line">                 mail.setReceiver(getRandString(5) + &quot;@&quot; + getRandString(8) + &quot;.com&quot;);</span><br><span class="line">                 sendMail(cloneMail);</span><br><span class="line">                 i++;</span><br><span class="line">          &#125;</span><br><span class="line">          long end=System.currentTimeMillis();</span><br><span class="line">          System.out.println(&quot;ç”¨æ—¶:&quot;+(end-start));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç”¨æ—¶ï¼š1001</strong></p>
<h3 id="43-æ€»ç»“"><a class="markdownIt-Anchor" href="#43-æ€»ç»“">#</a> 4.3 æ€»ç»“</h3>
<p><strong>åŸå‹æ¨¡å¼çš„æœ¬è´¨å°±æ˜¯ cloneï¼Œå¯ä»¥è§£å†³æ„å»ºå¤æ‚å¯¹è±¡çš„èµ„æºæ¶ˆè€—é—®é¢˜ï¼Œèƒ½å†æŸäº›åœºæ™¯ä¸­æå‡æ„å»ºå¯¹è±¡çš„æ•ˆç‡ï¼›è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç”¨é€”å°±æ˜¯ä¿æŠ¤æ€§æ‹·è´ï¼Œå¯ä»¥é€šè¿‡è¿”å›ä¸€ä¸ªæ‹·è´å¯¹è±¡çš„å½¢å¼ï¼Œå®ç°åªè¯»çš„é™åˆ¶ã€‚</strong></p>
<h1 id="b-ç»“æ„æ¨¡å¼7ç§"><a class="markdownIt-Anchor" href="#b-ç»“æ„æ¨¡å¼7ç§">#</a> Bã€ç»“æ„æ¨¡å¼ï¼ˆ7 ç§ï¼‰</h1>
<p>é€‚é…å™¨æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ã€ä»£ç†æ¨¡å¼ã€å¤–è§‚æ¨¡å¼ã€æ¡¥æ¥æ¨¡å¼ã€ç»„åˆæ¨¡å¼ã€äº«å…ƒæ¨¡å¼ã€‚</p>
<h3 id="-3"><a class="markdownIt-Anchor" href="#-3">#</a> </h3>
<h2 id="5-é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#5-é€‚é…å™¨æ¨¡å¼">#</a> 5 é€‚é…å™¨æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong> é€‚é…å™¨æ¨¡å¼å°†æŸä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£è¡¨ç¤ºï¼Œç›®çš„æ˜¯æ¶ˆé™¤ç”±äºæ¥å£ä¸åŒ¹é…æ‰€é€ æˆçš„ç±»çš„å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>** ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š** ç±»çš„é€‚é…å™¨æ¨¡å¼ã€å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ã€æ¥å£çš„é€‚é…å™¨æ¨¡å¼ã€‚</p>
<h3 id="51-ç±»é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#51-ç±»é€‚é…å™¨æ¨¡å¼">#</a> 5.1 ç±»é€‚é…å™¨æ¨¡å¼</h3>
<p>é€šè¿‡å¤šé‡<strong>ç»§æ‰¿</strong>ç›®æ ‡æ¥å£å’Œè¢«é€‚é…è€…ç±»æ–¹å¼æ¥å®ç°é€‚é…</p>
<p><strong>ä¸¾ä¾‹</strong> (å°† USB æ¥å£è½¬ä¸º VGA æ¥å£)ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609210401275.png" class="has" width="329" height="268" />
<p>USBImpl çš„ä»£ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class USBImpl implements USB&#123;</span><br><span class="line">       @Override</span><br><span class="line">       public void showPPT() &#123;</span><br><span class="line">              // TODO Auto-generated method stub</span><br><span class="line">              System.out.println(&quot;PPTå†…å®¹æ¼”ç¤º&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AdatperUSB2VGA é¦–å…ˆç»§æ‰¿ USBImpl è·å– USB çš„åŠŸèƒ½ï¼Œå…¶æ¬¡ï¼Œå®ç° VGA æ¥å£ï¼Œè¡¨ç¤ºè¯¥ç±»çš„ç±»å‹ä¸º VGAã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class AdapterUSB2VGA extends USBImpl implements VGA &#123;</span><br><span class="line">       @Override</span><br><span class="line">       public void projection() &#123;</span><br><span class="line">              super.showPPT();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Projector å°† USB æ˜ å°„ä¸º VGAï¼Œåªæœ‰ VGA æ¥å£æ‰å¯ä»¥è¿æ¥ä¸ŠæŠ•å½±ä»ªè¿›è¡ŒæŠ•å½±</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Projector&lt;T&gt; &#123;</span><br><span class="line">       public void projection(T t) &#123;</span><br><span class="line">              if (t instanceof VGA) &#123;</span><br><span class="line">                     System.out.println(&quot;å¼€å§‹æŠ•å½±&quot;);</span><br><span class="line">                     VGA v = new VGAImpl();</span><br><span class="line">                     v = (VGA) t;</span><br><span class="line">                     v.projection();</span><br><span class="line">              &#125; else &#123;</span><br><span class="line">                     System.out.println(&quot;æ¥å£ä¸åŒ¹é…ï¼Œæ— æ³•æŠ•å½±&quot;);</span><br><span class="line">              &#125;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>test ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void test2()&#123;</span><br><span class="line">       //é€šè¿‡é€‚é…å™¨åˆ›å»ºä¸€ä¸ªVGAå¯¹è±¡ï¼Œè¿™ä¸ªé€‚é…å™¨å®é™…æ˜¯ä½¿ç”¨çš„æ˜¯USBçš„showPPTï¼ˆï¼‰æ–¹æ³•</span><br><span class="line">       VGA a=new AdapterUSB2VGA();</span><br><span class="line">       //è¿›è¡ŒæŠ•å½±</span><br><span class="line">       Projector p1=new Projector();</span><br><span class="line">       p1.projection(a);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="52-å¯¹è±¡é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#52-å¯¹è±¡é€‚é…å™¨æ¨¡å¼">#</a> 5.2 å¯¹è±¡é€‚é…å™¨æ¨¡å¼</h3>
<p>å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ³•å®ç°é€‚é…ï¼Œå¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆï¼Œç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong> (å°† USB æ¥å£è½¬ä¸º VGA æ¥å£)ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609210401318.png" class="has" width="356" height="278" />
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class AdapterUSB2VGA implements VGA &#123;</span><br><span class="line">       USB u = new USBImpl();</span><br><span class="line">       @Override</span><br><span class="line">       public void projection() &#123;</span><br><span class="line">              u.showPPT();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ç° VGA æ¥å£ï¼Œè¡¨ç¤ºé€‚é…å™¨ç±»æ˜¯ VGA ç±»å‹çš„ï¼Œé€‚é…å™¨æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨ USB å¯¹è±¡ã€‚</p>
<h3 id="53-æ¥å£é€‚é…å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#53-æ¥å£é€‚é…å™¨æ¨¡å¼">#</a> 5.3 æ¥å£é€‚é…å™¨æ¨¡å¼</h3>
<p>å½“ä¸éœ€è¦å…¨éƒ¨å®ç°æ¥å£æä¾›çš„æ–¹æ³•æ—¶ï¼Œå¯å…ˆè®¾è®¡ä¸€ä¸ªæŠ½è±¡ç±»å®ç°æ¥å£ï¼Œå¹¶ä¸ºè¯¥æ¥å£ä¸­æ¯ä¸ªæ–¹æ³•æä¾›ä¸€ä¸ªé»˜è®¤å®ç°ï¼ˆç©ºæ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆè¯¥æŠ½è±¡ç±»çš„å­ç±»å¯æœ‰é€‰æ‹©åœ°è¦†ç›–çˆ¶ç±»çš„æŸäº›æ–¹æ³•æ¥å®ç°éœ€æ±‚ï¼Œ<strong>å®ƒé€‚ç”¨äºä¸€ä¸ªæ¥å£ä¸æƒ³ä½¿ç”¨å…¶æ‰€æœ‰çš„æ–¹æ³•çš„æƒ…å†µã€‚</strong></p>
<p><strong>ä¸¾ä¾‹</strong> (å°† USB æ¥å£è½¬ä¸º VGA æ¥å£ï¼ŒVGA ä¸­çš„ b () å’Œ c () ä¸ä¼šè¢«å®ç°)ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609210401289.png" class="has" width="451" height="351" />
<p><span style="color:#333333;">AdapterUSB2VGA</span>æŠ½è±¡ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AdapterUSB2VGA implements VGA &#123;</span><br><span class="line">       USB u = new USBImpl();</span><br><span class="line">       @Override</span><br><span class="line">       public void projection() &#123;</span><br><span class="line">              u.showPPT();</span><br><span class="line">       &#125;</span><br><span class="line">       @Override</span><br><span class="line">       public void b() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">       @Override</span><br><span class="line">       public void c() &#123;</span><br><span class="line">       &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span style="color:#333333;">AdapterUSB2VGA å®ç°ï¼Œä¸ç”¨å»å®ç° b () å’Œ c () æ–¹æ³•ã€‚</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class AdapterUSB2VGAImpl extends AdapterUSB2VGA &#123;</span><br><span class="line">       public void projection() &#123;</span><br><span class="line">              super.projection();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="54-æ€»ç»“"><a class="markdownIt-Anchor" href="#54-æ€»ç»“">#</a> 5.4 æ€»ç»“</h3>
<p>æ€»ç»“ä¸€ä¸‹ä¸‰ç§é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š</p>
<p><strong>ç±»é€‚é…å™¨æ¨¡å¼ï¼š<strong>å½“å¸Œæœ›å°†</strong>ä¸€ä¸ªç±»</strong>è½¬æ¢æˆæ»¡è¶³å¦ä¸€ä¸ªæ–°æ¥å£çš„ç±»æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç±»çš„é€‚é…å™¨æ¨¡å¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°ç±»ï¼Œç»§æ‰¿åŸæœ‰çš„ç±»ï¼Œå®ç°æ–°çš„æ¥å£å³å¯ã€‚</p>
<p>** å¯¹è±¡é€‚é…å™¨æ¨¡å¼ï¼š** å½“å¸Œæœ›å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆæ»¡è¶³å¦ä¸€ä¸ªæ–°æ¥å£çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Wrapper ç±»ï¼ŒæŒæœ‰åŸç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œåœ¨ Wrapper ç±»çš„æ–¹æ³•ä¸­ï¼Œè°ƒç”¨å®ä¾‹çš„æ–¹æ³•å°±è¡Œã€‚</p>
<p>** æ¥å£é€‚é…å™¨æ¨¡å¼ï¼š** å½“ä¸å¸Œæœ›å®ç°ä¸€ä¸ªæ¥å£ä¸­æ‰€æœ‰çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±» Wrapperï¼Œå®ç°æ‰€æœ‰æ–¹æ³•ï¼Œæˆ‘ä»¬å†™åˆ«çš„ç±»çš„æ—¶å€™ï¼Œç»§æ‰¿æŠ½è±¡ç±»å³å¯ã€‚</p>
<p><strong>å‘½åè§„åˆ™ï¼š</strong></p>
<p><strong>æˆ‘ä¸ªäººç†è§£ï¼Œä¸‰ç§å‘½åæ–¹å¼ï¼Œæ˜¯æ ¹æ® src æ˜¯ä»¥æ€æ ·çš„å½¢å¼ç»™åˆ° Adapterï¼ˆåœ¨ Adapter é‡Œçš„å½¢å¼ï¼‰æ¥å‘½åçš„ã€‚</strong></p>
<p>ç±»é€‚é…å™¨ï¼Œä»¥ç±»ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°±æ˜¯å°† src å½“åšç±»ï¼Œç»§æ‰¿ï¼Œ</p>
<p>å¯¹è±¡é€‚é…å™¨ï¼Œä»¥å¯¹è±¡ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°† src ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼ŒæŒæœ‰ã€‚</p>
<p>æ¥å£é€‚é…å™¨ï¼Œä»¥æ¥å£ç»™åˆ°ï¼Œåœ¨ Adapter é‡Œï¼Œå°† src ä½œä¸ºä¸€ä¸ªæ¥å£ï¼Œå®ç°ã€‚</p>
<p><strong>ä½¿ç”¨é€‰æ‹©ï¼š</strong></p>
<p><strong>æ ¹æ®åˆæˆå¤ç”¨åŸåˆ™ï¼Œç»„åˆå¤§äºç»§æ‰¿ã€‚å› æ­¤ï¼Œç±»çš„é€‚é…å™¨æ¨¡å¼åº”è¯¥å°‘ç”¨ã€‚</strong></p>
<h3 id="-4"><a class="markdownIt-Anchor" href="#-4">#</a> </h3>
<h2 id="6-è£…é¥°è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#6-è£…é¥°è€…æ¨¡å¼">#</a> 6 è£…é¥°è€…æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong><span style="color:#4d4d4d;">åŠ¨æ€çš„å°†æ–°åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚åœ¨å¯¹è±¡åŠŸèƒ½æ‰©å±•æ–¹é¢ï¼Œå®ƒ</span><span style="color:#4d4d4d;">æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§ã€‚</span></p>
<h3 id="span-stylecolor4d4d4d61-è£…é¥°è€…æ¨¡å¼ç»“æ„å›¾ä¸ä»£ç ç¤ºä¾‹span"><a class="markdownIt-Anchor" href="#span-stylecolor4d4d4d61-è£…é¥°è€…æ¨¡å¼ç»“æ„å›¾ä¸ä»£ç ç¤ºä¾‹span">#</a> <span style="color:#4d4d4d;">6.1 è£…é¥°è€…æ¨¡å¼ç»“æ„å›¾ä¸ä»£ç ç¤ºä¾‹</span></h3>
<p><span style="color:#4d4d4d;">1.Componentï¼ˆè¢«è£…é¥°å¯¹è±¡çš„åŸºç±»ï¼‰</span></p>
<p><span style="color:#4d4d4d;">   å®šä¹‰ä¸€ä¸ªå¯¹è±¡æ¥å£ï¼Œå¯ä»¥ç»™è¿™äº›å¯¹è±¡åŠ¨æ€åœ°æ·»åŠ èŒè´£ã€‚</span></p>
<p><span style="color:#4d4d4d;">2.ConcreteComponentï¼ˆå…·ä½“è¢«è£…é¥°å¯¹è±¡ï¼‰</span></p>
<p><span style="color:#4d4d4d;">   å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç»™è¿™ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›èŒè´£ã€‚</span></p>
<p><span style="color:#4d4d4d;">3.Decoratorï¼ˆè£…é¥°è€…æŠ½è±¡ç±»ï¼‰</span></p>
<p><span style="color:#4d4d4d;">   ç»´æŒä¸€ä¸ªæŒ‡å‘ Component å®ä¾‹çš„å¼•ç”¨ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªä¸ Component æ¥å£ä¸€è‡´çš„æ¥å£ã€‚</span></p>
<p><span style="color:#4d4d4d;">4.ConcreteDecoratorï¼ˆå…·ä½“è£…é¥°è€…ï¼‰</span></p>
<p><span style="color:#4d4d4d;">   å…·ä½“çš„è£…é¥°å¯¹è±¡ï¼Œç»™å†…éƒ¨æŒæœ‰çš„å…·ä½“è¢«è£…é¥°å¯¹è±¡ï¼Œå¢åŠ å…·ä½“çš„èŒè´£ã€‚</span></p>
<p><strong>è¢«è£…é¥°å¯¹è±¡å’Œä¿®é¥°è€…ç»§æ‰¿è‡ªåŒä¸€ä¸ªè¶…ç±»</strong></p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609223457210.png" class="has" width="561" height="287" />
<p><strong><span style="color:#4d4d4d;">ä¸¾ä¾‹</span></strong><span style="color:#4d4d4d;">(<span style="color:#4d4d4d;">å’–å•¡é¦†è®¢å•é¡¹ç›®ï¼š</span></span><span style="color:#4d4d4d;">1ï¼‰ã€å’–å•¡ç§ç±»ï¼šEspressoã€ShortBlackã€LongBlackã€Decaf</span><span style="color:#4d4d4d;">2ï¼‰ã€<strong>è°ƒæ–™ï¼ˆè£…é¥°è€…ï¼‰</strong>ï¼šMilkã€Soyã€Chocolate</span><span style="color:#4d4d4d;">)ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</span></p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190609222716270.png" class="has" width="561" height="287" />
<p>è¢«è£…é¥°çš„å¯¹è±¡å’Œè£…é¥°è€…éƒ½ç»§æ‰¿è‡ªåŒä¸€ä¸ªè¶…ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Drink &#123;</span><br><span class="line">       public String description=&quot;&quot;;</span><br><span class="line">       private float price=0f;;</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">       public void setDescription(String description)</span><br><span class="line">       &#123;</span><br><span class="line">              this.description=description;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       public String getDescription()</span><br><span class="line">       &#123;</span><br><span class="line">              return description+&quot;-&quot;+this.getPrice();</span><br><span class="line">       &#125;</span><br><span class="line">       public float getPrice()</span><br><span class="line">       &#123;</span><br><span class="line">              return price;</span><br><span class="line">       &#125;</span><br><span class="line">       public void setPrice(float price)</span><br><span class="line">       &#123;</span><br><span class="line">              this.price=price;</span><br><span class="line">       &#125;</span><br><span class="line">       public abstract float cost();</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¢«è£…é¥°çš„å¯¹è±¡ï¼Œä¸ç”¨å»æ”¹é€ ã€‚åŸæ¥æ€ä¹ˆæ ·å†™ï¼Œç°åœ¨è¿˜æ˜¯æ€ä¹ˆå†™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public  class Coffee extends Drink &#123;</span><br><span class="line">       @Override</span><br><span class="line">       public float cost() &#123;</span><br><span class="line">              // TODO Auto-generated method stub</span><br><span class="line">              return super.getPrice();</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>coffee ç±»çš„å®ç°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Decaf extends Coffee &#123;</span><br><span class="line">       public Decaf()</span><br><span class="line">       &#123;</span><br><span class="line">              super.setDescription(&quot;Decaf&quot;);</span><br><span class="line">              super.setPrice(3.0f);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è£…é¥°è€…</p>
<p>è£…é¥°è€…ä¸ä»…è¦è€ƒè™‘è‡ªèº«ï¼Œè¿˜è¦è€ƒè™‘è¢«å®ƒä¿®é¥°çš„å¯¹è±¡ï¼Œå®ƒæ˜¯åœ¨è¢«ä¿®é¥°çš„å¯¹è±¡ä¸Šç»§ç»­æ·»åŠ ä¿®é¥°ã€‚ä¾‹å¦‚ï¼Œå’–å•¡é‡Œé¢åŠ ç‰›å¥¶ï¼Œå†åŠ å·§å…‹åŠ›ã€‚åŠ ç³–åä»·æ ¼ä¸º coffee+milkã€‚å†åŠ ç‰›å¥¶ä»·æ ¼ä¸º coffee+milk+chocolateã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Decorator extends Drink &#123;</span><br><span class="line">       private Drink Obj;</span><br><span class="line">       public Decorator(Drink Obj) &#123;</span><br><span class="line">              this.Obj = Obj;</span><br><span class="line">       &#125;;</span><br><span class="line">       @Override</span><br><span class="line">       public float cost() &#123;</span><br><span class="line">              // TODO Auto-generated method stub</span><br><span class="line">              return super.getPrice() + Obj.cost();</span><br><span class="line">       &#125;</span><br><span class="line">       @Override</span><br><span class="line">       public String getDescription() &#123;</span><br><span class="line">              return super.description + &quot;-&quot; + super.getPrice() + &quot;&amp;&amp;&quot; + Obj.getDescription();</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è£…é¥°è€…å®ä¾‹åŒ–ï¼ˆåŠ ç‰›å¥¶ï¼‰ã€‚è¿™é‡Œé¢è¦å¯¹è¢«ä¿®é¥°çš„å¯¹è±¡è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Milk extends Decorator &#123;</span><br><span class="line">       public Milk(Drink Obj) &#123;          </span><br><span class="line">              super(Obj);</span><br><span class="line">              // TODO Auto-generated constructor stub</span><br><span class="line">              super.setDescription(&quot;Milk&quot;);</span><br><span class="line">              super.setPrice(2.0f);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>coffee åº—ï¼šåˆå§‹åŒ–ä¸€ä¸ªè¢«ä¿®é¥°å¯¹è±¡ï¼Œä¿®é¥°è€…å®ä¾‹éœ€è¦å¯¹è¢«ä¿®æ”¹è€…å®ä¾‹åŒ–ï¼Œæ‰èƒ½å¯¹å…·ä½“çš„è¢«ä¿®é¥°è€…è¿›è¡Œä¿®é¥°ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class CoffeeBar &#123;</span><br><span class="line">       public static void main(String[] args) &#123;</span><br><span class="line">              Drink order;</span><br><span class="line">              order = new Decaf();</span><br><span class="line">              System.out.println(&quot;order1 price:&quot; + order.cost());</span><br><span class="line">              System.out.println(&quot;order1 desc:&quot; + order.getDescription());</span><br><span class="line">              System.out.println(&quot;****************&quot;);</span><br><span class="line">              order = new LongBlack();</span><br><span class="line">              order = new Milk(order);</span><br><span class="line">              order = new Chocolate(order);</span><br><span class="line">              order = new Chocolate(order);</span><br><span class="line">              System.out.println(&quot;order2 price:&quot; + order.cost());</span><br><span class="line">              System.out.println(&quot;order2 desc:&quot; + order.getDescription());</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.2 æ€»ç»“</p>
<p><strong>è£…é¥°è€…å’Œè¢«è£…é¥°è€…ä¹‹é—´å¿…é¡»æ˜¯ä¸€æ ·çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¦æœ‰å…±åŒçš„è¶…ç±»ã€‚åœ¨è¿™é‡Œåº”ç”¨ç»§æ‰¿å¹¶ä¸æ˜¯å®ç°æ–¹æ³•çš„å¤åˆ¶ï¼Œè€Œæ˜¯å®ç°ç±»å‹çš„åŒ¹é…ã€‚å› ä¸ºè£…é¥°è€…å’Œè¢«è£…é¥°è€…æ˜¯åŒä¸€ä¸ªç±»å‹ï¼Œå› æ­¤è£…é¥°è€…å¯ä»¥å–ä»£è¢«è£…é¥°è€…ï¼Œè¿™æ ·å°±ä½¿è¢«è£…é¥°è€…æ‹¥æœ‰äº†è£…é¥°è€…ç‹¬æœ‰çš„è¡Œä¸ºã€‚æ ¹æ®è£…é¥°è€…æ¨¡å¼çš„ç†å¿µï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œå®ç°æ–°çš„è£…é¥°è€…å¢åŠ æ–°çš„è¡Œä¸ºã€‚å¦‚æœæ˜¯ç”¨ç»§æ‰¿ï¼Œæ¯å½“éœ€è¦å¢åŠ æ–°çš„è¡Œä¸ºæ—¶ï¼Œå°±è¦ä¿®æ”¹åŸç¨‹åºäº†ã€‚</strong></p>
<h3 id="-5"><a class="markdownIt-Anchor" href="#-5">#</a> </h3>
<h3 id="-6"><a class="markdownIt-Anchor" href="#-6">#</a> </h3>
<h2 id="7-ä»£ç†æ¨¡å¼"><a class="markdownIt-Anchor" href="#7-ä»£ç†æ¨¡å¼">#</a> 7 ä»£ç†æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** ä»£ç†æ¨¡å¼ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹åŸå¯¹è±¡çš„å¼•ç”¨ã€‚é€šä¿—çš„æ¥è®²ä»£ç†æ¨¡å¼å°±æ˜¯æˆ‘ä»¬ç”Ÿæ´»ä¸­å¸¸è§çš„ä¸­ä»‹ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ï¼šå‡å¦‚è¯´æˆ‘ç°åœ¨æƒ³ä¹°ä¸€è¾†äºŒæ‰‹è½¦ï¼Œè™½ç„¶æˆ‘å¯ä»¥è‡ªå·±å»æ‰¾è½¦æºï¼Œåšè´¨é‡æ£€æµ‹ç­‰ä¸€ç³»åˆ—çš„è½¦è¾†è¿‡æˆ·æµç¨‹ï¼Œä½†æ˜¯è¿™ç¡®å®å¤ªæµªè´¹æˆ‘å¾—æ—¶é—´å’Œç²¾åŠ›äº†ã€‚æˆ‘åªæ˜¯æƒ³ä¹°ä¸€è¾†è½¦è€Œå·²ä¸ºä»€ä¹ˆæˆ‘è¿˜è¦é¢å¤–åšè¿™ä¹ˆå¤šäº‹å‘¢ï¼Ÿäºæ˜¯æˆ‘å°±é€šè¿‡ä¸­ä»‹å…¬å¸æ¥ä¹°è½¦ï¼Œä»–ä»¬æ¥ç»™æˆ‘æ‰¾è½¦æºï¼Œå¸®æˆ‘åŠç†è½¦è¾†è¿‡æˆ·æµç¨‹ï¼Œæˆ‘åªæ˜¯è´Ÿè´£é€‰æ‹©è‡ªå·±å–œæ¬¢çš„è½¦ï¼Œç„¶åä»˜é’±å°±å¯ä»¥äº†ã€‚ç”¨å›¾è¡¨ç¤ºå¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2019061001123986.png" class="has" width="633" height="210" />
<h3 id="71-ä¸ºä»€ä¹ˆè¦ç”¨ä»£ç†æ¨¡å¼"><a class="markdownIt-Anchor" href="#71-ä¸ºä»€ä¹ˆè¦ç”¨ä»£ç†æ¨¡å¼">#</a> 7.1 ä¸ºä»€ä¹ˆè¦ç”¨ä»£ç†æ¨¡å¼ï¼Ÿ</h3>
<p>** ä¸­ä»‹éš”ç¦»ä½œç”¨ï¼š** åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¢æˆ·ç±»ä¸æƒ³æˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ä¸€ä¸ªå§”æ‰˜å¯¹è±¡ï¼Œè€Œä»£ç†ç±»å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·ç±»å’Œå§”æ‰˜å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ï¼Œå…¶ç‰¹å¾æ˜¯ä»£ç†ç±»å’Œå§”æ‰˜ç±»å®ç°ç›¸åŒçš„æ¥å£ã€‚</p>
<p>** å¼€é—­åŸåˆ™ï¼Œå¢åŠ åŠŸèƒ½ï¼š** ä»£ç†ç±»é™¤äº†æ˜¯å®¢æˆ·ç±»å’Œå§”æ‰˜ç±»çš„ä¸­ä»‹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç»™ä»£ç†ç±»å¢åŠ é¢å¤–çš„åŠŸèƒ½æ¥æ‰©å±•å§”æ‰˜ç±»çš„åŠŸèƒ½ï¼Œè¿™æ ·åšæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä»£ç†ç±»è€Œä¸éœ€è¦å†ä¿®æ”¹å§”æ‰˜ç±»ï¼Œç¬¦åˆä»£ç è®¾è®¡çš„å¼€é—­åŸåˆ™ã€‚ä»£ç†ç±»ä¸»è¦è´Ÿè´£ä¸ºå§”æ‰˜ç±»é¢„å¤„ç†æ¶ˆæ¯ã€è¿‡æ»¤æ¶ˆæ¯ã€æŠŠæ¶ˆæ¯è½¬å‘ç»™å§”æ‰˜ç±»ï¼Œä»¥åŠäº‹åå¯¹è¿”å›ç»“æœçš„å¤„ç†ç­‰ã€‚ä»£ç†ç±»æœ¬èº«å¹¶ä¸çœŸæ­£å®ç°æœåŠ¡ï¼Œè€Œæ˜¯åŒè¿‡è°ƒç”¨å§”æ‰˜ç±»çš„ç›¸å…³æ–¹æ³•ï¼Œæ¥æä¾›ç‰¹å®šçš„æœåŠ¡ã€‚çœŸæ­£çš„ä¸šåŠ¡åŠŸèƒ½è¿˜æ˜¯ç”±å§”æ‰˜ç±»æ¥å®ç°ï¼Œä½†æ˜¯å¯ä»¥åœ¨ä¸šåŠ¡åŠŸèƒ½æ‰§è¡Œçš„å‰ååŠ å…¥ä¸€äº›å…¬å…±çš„æœåŠ¡ã€‚ä¾‹å¦‚æˆ‘ä»¬æƒ³ç»™é¡¹ç›®åŠ å…¥ç¼“å­˜ã€æ—¥å¿—è¿™äº›åŠŸèƒ½ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä»£ç†ç±»æ¥å®Œæˆï¼Œè€Œæ²¡å¿…è¦æ‰“å¼€å·²ç»å°è£…å¥½çš„å§”æ‰˜ç±»ã€‚</p>
<p><strong>ä»£ç†æ¨¡å¼åˆ†ä¸ºä¸‰ç±»ï¼š1. é™æ€ä»£ç† 2. åŠ¨æ€ä»£ç† 3. CGLIB ä»£ç†</strong></p>
<p>7.2 é™æ€ä»£ç†</p>
<p><span style="color:#4d4d4d;"><strong>ä¸¾ä¾‹</strong></span><span style="color:#4d4d4d;">(ä¹°æˆ¿</span><span style="color:#4d4d4d;">ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</span></p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2019061001123984.png" class="has" width="359" height="179" />
<p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæœåŠ¡ç±»æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface BuyHouse &#123;</span><br><span class="line">    void buyHosue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šå®ç°æœåŠ¡æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class BuyHouseImpl implements BuyHouse &#123;</span><br><span class="line">       @Override</span><br><span class="line">       public void buyHosue() &#123;</span><br><span class="line">              System.out.println(&quot;æˆ‘è¦ä¹°æˆ¿&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºä»£ç†ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class BuyHouseProxy implements BuyHouse &#123;</span><br><span class="line">       private BuyHouse buyHouse;</span><br><span class="line">       public BuyHouseProxy(final BuyHouse buyHouse) &#123;</span><br><span class="line">              this.buyHouse = buyHouse;</span><br><span class="line">       &#125;</span><br><span class="line">       @Override</span><br><span class="line">       public void buyHosue() &#123;</span><br><span class="line">              System.out.println(&quot;ä¹°æˆ¿å‰å‡†å¤‡&quot;);</span><br><span class="line">              buyHouse.buyHosue();</span><br><span class="line">              System.out.println(&quot;ä¹°æˆ¿åè£…ä¿®&quot;);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>ä¼˜ç‚¹ï¼šå¯ä»¥åšåˆ°åœ¨ç¬¦åˆå¼€é—­åŸåˆ™çš„æƒ…å†µä¸‹å¯¹ç›®æ ‡å¯¹è±¡è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚</p>
<p>ç¼ºç‚¹ï¼š <strong>ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡è¦å®ç°ç›¸åŒçš„æ¥å£ï¼Œæˆ‘ä»¬å¾—ä¸ºæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¾—åˆ›å»ºä»£ç†ç±»ï¼Œå·¥ä½œé‡å¤ªå¤§</strong>ï¼Œä¸æ˜“ç®¡ç†ã€‚åŒæ—¶æ¥å£ä¸€æ—¦å‘ç”Ÿæ”¹å˜ï¼Œä»£ç†ç±»ä¹Ÿå¾—ç›¸åº”ä¿®æ”¹ã€‚</p>
<h3 id="73-åŠ¨æ€ä»£ç†"><a class="markdownIt-Anchor" href="#73-åŠ¨æ€ä»£ç†">#</a> 7.3 åŠ¨æ€ä»£ç†</h3>
<p>åŠ¨æ€ä»£ç†æœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p>
<p>1. ä»£ç†å¯¹è±¡ï¼Œä¸éœ€è¦å®ç°æ¥å£</p>
<p>2. ä»£ç†å¯¹è±¡çš„ç”Ÿæˆï¼Œæ˜¯åˆ©ç”¨ JDK çš„ API, åŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡ (éœ€è¦æˆ‘ä»¬æŒ‡å®šåˆ›å»ºä»£ç†å¯¹è±¡ / ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹)</p>
<p>ä»£ç†ç±»ä¸ç”¨å†å®ç°æ¥å£äº†ã€‚ä½†æ˜¯ï¼Œè¦æ±‚è¢«ä»£ç†å¯¹è±¡å¿…é¡»æœ‰æ¥å£ã€‚</p>
<p><strong>åŠ¨æ€ä»£ç†å®ç°ï¼š</strong></p>
<p>Java.lang.reflect.Proxy ç±»å¯ä»¥ç›´æ¥ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡</p>
<ul>
<li>
<p>Proxy.newProxyInstance (ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡</p>
<ul>
<li>
<p>å‚æ•° 1:ClassLoader loader ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ ä¸€èˆ¬ä½¿ç”¨è¢«ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨</p>
</li>
<li>
<p>å‚æ•° 2:Class&lt;?&gt;[] interfaces ä»£ç†å¯¹è±¡çš„è¦å®ç°çš„æ¥å£ ä¸€èˆ¬ä½¿ç”¨çš„è¢«ä»£ç†å¯¹è±¡å®ç°çš„æ¥å£</p>
</li>
<li>
<p>å‚æ•° 3:InvocationHandler h (æ¥å£) æ‰§è¡Œå¤„ç†ç±»</p>
</li>
</ul>
</li>
<li>
<p>InvocationHandler ä¸­çš„ invoke (Object proxy, Method method, Object [] args) æ–¹æ³•ï¼šè°ƒç”¨ä»£ç†ç±»çš„ä»»ä½•æ–¹æ³•ï¼Œæ­¤æ–¹æ³•éƒ½ä¼šæ‰§è¡Œ</p>
<ul>
<li>
<p>å‚æ•° 3.1: ä»£ç†å¯¹è±¡ (æ…ç”¨)</p>
</li>
<li>
<p>å‚æ•° 3.2: å½“å‰æ‰§è¡Œçš„æ–¹æ³•</p>
</li>
<li>
<p>å‚æ•° 3.3: å½“å‰æ‰§è¡Œçš„æ–¹æ³•è¿è¡Œæ—¶ä¼ é€’è¿‡æ¥çš„å‚æ•°</p>
</li>
</ul>
</li>
</ul>
<p>ç¬¬ä¸€æ­¥ï¼šç¼–å†™åŠ¨æ€å¤„ç†å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class DynamicProxyHandler implements InvocationHandler &#123;</span><br><span class="line">       private Object object;</span><br><span class="line">       public DynamicProxyHandler(final Object object) &#123;</span><br><span class="line">              this.object = object;</span><br><span class="line">       &#125;</span><br><span class="line">       @Override</span><br><span class="line">       public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">              System.out.println(&quot;ä¹°æˆ¿å‰å‡†å¤‡&quot;);</span><br><span class="line">              Object result = method.invoke(object, args);</span><br><span class="line">              System.out.println(&quot;ä¹°æˆ¿åè£…ä¿®&quot;);</span><br><span class="line">              return result;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼šç¼–å†™æµ‹è¯•ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class DynamicProxyTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        BuyHouse buyHouse = new BuyHouseImpl();</span><br><span class="line">        BuyHouse proxyBuyHouse = (BuyHouse) Proxy.newProxyInstance(BuyHouse.class.getClassLoader(), new</span><br><span class="line">                Class[]&#123;BuyHouse.class&#125;, new DynamicProxyHandler(buyHouse));</span><br><span class="line">        proxyBuyHouse.buyHosue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>** åŠ¨æ€ä»£ç†æ€»ç»“ï¼š** è™½ç„¶ç›¸å¯¹äºé™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¤§å¤§å‡å°‘äº†æˆ‘ä»¬çš„å¼€å‘ä»»åŠ¡ï¼ŒåŒæ—¶å‡å°‘äº†å¯¹ä¸šåŠ¡æ¥å£çš„ä¾èµ–ï¼Œé™ä½äº†è€¦åˆåº¦ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹å°å°çš„é—æ†¾ä¹‹å¤„ï¼Œé‚£å°±æ˜¯å®ƒå§‹ç»ˆæ— æ³•æ‘†è„±ä»…æ”¯æŒ interface ä»£ç†çš„æ¡æ¢ï¼ˆæˆ‘ä»¬è¦ä½¿ç”¨è¢«ä»£ç†çš„å¯¹è±¡çš„æ¥å£ï¼‰ï¼Œå› ä¸ºå®ƒçš„è®¾è®¡æ³¨å®šäº†è¿™ä¸ªé—æ†¾ã€‚</p>
<p>7.4 CGLIB ä»£ç†</p>
<p><strong>CGLIB åŸç†</strong>ï¼šåŠ¨æ€ç”Ÿæˆä¸€ä¸ªè¦ä»£ç†ç±»çš„å­ç±»ï¼Œå­ç±»é‡å†™è¦ä»£ç†çš„ç±»çš„æ‰€æœ‰ä¸æ˜¯ final çš„æ–¹æ³•ã€‚åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚å®ƒæ¯”ä½¿ç”¨ java åå°„çš„ JDK åŠ¨æ€ä»£ç†è¦å¿«ã€‚</p>
<p><strong>CGLIB åº•å±‚</strong>ï¼šä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶ ASMï¼Œæ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»ã€‚ä¸é¼“åŠ±ç›´æ¥ä½¿ç”¨ ASMï¼Œå› ä¸ºå®ƒè¦æ±‚ä½ å¿…é¡»å¯¹ JVM å†…éƒ¨ç»“æ„åŒ…æ‹¬ class æ–‡ä»¶çš„æ ¼å¼å’ŒæŒ‡ä»¤é›†éƒ½å¾ˆç†Ÿæ‚‰ã€‚</p>
<p><strong>CGLIB ç¼ºç‚¹</strong>ï¼šå¯¹äº final æ–¹æ³•ï¼Œæ— æ³•è¿›è¡Œä»£ç†ã€‚</p>
<p>CGLIB çš„å®ç°æ­¥éª¤ï¼š</p>
<p>ç¬¬ä¸€æ­¥ï¼šå»ºç«‹æ‹¦æˆªå™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public Object intercept(Object object, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;ä¹°æˆ¿å‰å‡†å¤‡&quot;);</span><br><span class="line"></span><br><span class="line">        Object result = methodProxy.invoke(object, args);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;ä¹°æˆ¿åè£…ä¿®&quot;);</span><br><span class="line"></span><br><span class="line">        return result;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°ï¼šObject ä¸ºç”± CGLib åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»å®ä¾‹ï¼ŒMethod ä¸ºä¸Šæ–‡ä¸­å®ä½“ç±»æ‰€è°ƒç”¨çš„è¢«ä»£ç†çš„æ–¹æ³•å¼•ç”¨ï¼ŒObject [] ä¸ºå‚æ•°å€¼åˆ—è¡¨ï¼ŒMethodProxy ä¸ºç”Ÿæˆçš„ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨ã€‚</p>
<p>è¿”å›ï¼šä»ä»£ç†å®ä¾‹çš„æ–¹æ³•è°ƒç”¨è¿”å›çš„å€¼ã€‚</p>
<p>å…¶ä¸­ï¼Œ<strong>proxy.invokeSuper(obj,arg)</strong> è°ƒç”¨ä»£ç†ç±»å®ä¾‹ä¸Šçš„ proxy æ–¹æ³•çš„çˆ¶ç±»æ–¹æ³•ï¼ˆå³å®ä½“ç±» TargetObject ä¸­å¯¹åº”çš„æ–¹æ³•ï¼‰</p>
<p>ç¬¬äºŒæ­¥ï¼š ç”ŸæˆåŠ¨æ€ä»£ç†ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class CglibProxy implements MethodInterceptor &#123;</span><br><span class="line">    private Object target;</span><br><span class="line">    public Object getInstance(final Object target) &#123;</span><br><span class="line">        this.target = target;</span><br><span class="line">        Enhancer enhancer = new Enhancer();</span><br><span class="line">        enhancer.setSuperclass(this.target.getClass());</span><br><span class="line">        enhancer.setCallback(this);</span><br><span class="line">        return enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line">    public Object intercept(Object object, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123;</span><br><span class="line">        System.out.println(&quot;ä¹°æˆ¿å‰å‡†å¤‡&quot;);</span><br><span class="line">        Object result = methodProxy.invoke(object, args);</span><br><span class="line">        System.out.println(&quot;ä¹°æˆ¿åè£…ä¿®&quot;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œ Enhancer ç±»æ˜¯ CGLib ä¸­çš„ä¸€ä¸ªå­—èŠ‚ç å¢å¼ºå™¨ï¼Œå®ƒå¯ä»¥æ–¹ä¾¿çš„å¯¹ä½ æƒ³è¦å¤„ç†çš„ç±»è¿›è¡Œæ‰©å±•ï¼Œä»¥åä¼šç»å¸¸çœ‹åˆ°å®ƒã€‚</p>
<p>é¦–å…ˆå°†è¢«ä»£ç†ç±» TargetObject è®¾ç½®æˆçˆ¶ç±»ï¼Œç„¶åè®¾ç½®æ‹¦æˆªå™¨ TargetInterceptorï¼Œæœ€åæ‰§è¡Œ enhancer.create () åŠ¨æ€ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œå¹¶ä» Object å¼ºåˆ¶è½¬å‹æˆçˆ¶ç±»å‹ TargetObjectã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class CglibProxyTest &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        BuyHouse buyHouse = new BuyHouseImpl();</span><br><span class="line">        CglibProxy cglibProxy = new CglibProxy();</span><br><span class="line">        BuyHouseImpl buyHouseCglibProxy = (BuyHouseImpl) cglibProxy.getInstance(buyHouse);</span><br><span class="line">        buyHouseCglibProxy.buyHosue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>CGLIB ä»£ç†æ€»ç»“ï¼š** CGLIB åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ¯” JDK åˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯ CGLIB åˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯” JDK å¤šå¾—å¤šã€‚æ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨ CGLIB åˆé€‚ï¼Œåä¹‹ä½¿ç”¨ JDK æ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ç”±äº CGLib ç”±äºæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äº final ä¿®é¥°çš„æ–¹æ³•æ— æ³•è¿›è¡Œä»£ç†ã€‚**</p>
<h2 id="8-å¤–è§‚æ¨¡å¼"><a class="markdownIt-Anchor" href="#8-å¤–è§‚æ¨¡å¼">#</a> 8 å¤–è§‚æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong> éšè—äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼Œå¹¶å‘å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå¯ä»¥è®¿é—®ç³»ç»Ÿçš„æ¥å£ã€‚</p>
<h3 id="81-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#81-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 8.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610154828945.png" class="has" width="666" height="408" />
<p>ç®€å•æ¥è¯´ï¼Œè¯¥æ¨¡å¼å°±æ˜¯æŠŠä¸€äº›å¤æ‚çš„æµç¨‹å°è£…æˆä¸€ä¸ªæ¥å£ä¾›ç»™å¤–éƒ¨ç”¨æˆ·æ›´ç®€å•çš„ä½¿ç”¨ã€‚è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œè®¾è®¡åˆ° 3 ä¸ªè§’è‰²ã€‚</p>
<p>1ï¼‰. é—¨é¢è§’è‰²ï¼šå¤–è§‚æ¨¡å¼çš„æ ¸å¿ƒã€‚å®ƒè¢«å®¢æˆ·è§’è‰²è°ƒç”¨ï¼Œå®ƒç†Ÿæ‚‰å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å†…éƒ¨æ ¹æ®å®¢æˆ·è§’è‰²çš„éœ€æ±‚é¢„å®šäº†å‡ ç§åŠŸèƒ½çš„ç»„åˆã€‚ï¼ˆ<strong>å®¢æˆ·è°ƒç”¨ï¼ŒåŒæ—¶è‡ªèº«è°ƒç”¨å­ç³»ç»ŸåŠŸèƒ½</strong>ï¼‰</p>
<p>2ï¼‰. å­ç³»ç»Ÿè§’è‰²ï¼šå®ç°äº†å­ç³»ç»Ÿçš„åŠŸèƒ½ã€‚å®ƒå¯¹å®¢æˆ·è§’è‰²å’Œ Facade æ—¶æœªçŸ¥çš„ã€‚å®ƒå†…éƒ¨å¯ä»¥æœ‰ç³»ç»Ÿå†…çš„ç›¸äº’äº¤äº’ï¼Œä¹Ÿå¯ä»¥ç”±ä¾›å¤–ç•Œè°ƒç”¨çš„æ¥å£ã€‚ï¼ˆå®ç°å…·ä½“åŠŸèƒ½ï¼‰</p>
<p>3ï¼‰. å®¢æˆ·è§’è‰²ï¼šé€šè¿‡è°ƒç”¨ Facede æ¥å®Œæˆè¦å®ç°çš„åŠŸèƒ½ï¼ˆ<strong>è°ƒç”¨é—¨é¢è§’è‰²</strong>ï¼‰ã€‚</p>
<p>ä¸¾ä¾‹ï¼ˆæ¯ä¸ª Computer éƒ½æœ‰ CPUã€Memoryã€Diskã€‚åœ¨ Computer å¼€å¯å’Œå…³é—­çš„æ—¶å€™ï¼Œç›¸åº”çš„éƒ¨ä»¶ä¹Ÿä¼šå¼€å¯å’Œå…³é—­ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610154828952.png" class="has" width="473" height="187" />
<p>é¦–å…ˆæ˜¯å­ç³»ç»Ÿç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public class CPU &#123;</span><br><span class="line"></span><br><span class="line">    public void start() &#123;</span><br><span class="line">        System.out.println(&quot;cpu is start...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void shutDown() &#123;</span><br><span class="line">        System.out.println(&quot;CPU is shutDown...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Disk &#123;</span><br><span class="line">    public void start() &#123;</span><br><span class="line">        System.out.println(&quot;Disk is start...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void shutDown() &#123;</span><br><span class="line">        System.out.println(&quot;Disk is shutDown...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Memory &#123;</span><br><span class="line">    public void start() &#123;</span><br><span class="line">        System.out.println(&quot;Memory is start...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void shutDown() &#123;</span><br><span class="line">        System.out.println(&quot;Memory is shutDown...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯ï¼Œé—¨é¢ç±» Facade</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class Computer &#123;</span><br><span class="line"></span><br><span class="line">    private CPU cpu;</span><br><span class="line">    private Memory memory;</span><br><span class="line">    private Disk disk;</span><br><span class="line"></span><br><span class="line">    public Computer() &#123;</span><br><span class="line">        cpu = new CPU();</span><br><span class="line">        memory = new Memory();</span><br><span class="line">        disk = new Disk();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void start() &#123;</span><br><span class="line">        System.out.println(&quot;Computer start begin&quot;);</span><br><span class="line">        cpu.start();</span><br><span class="line">        disk.start();</span><br><span class="line">        memory.start();</span><br><span class="line">        System.out.println(&quot;Computer start end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void shutDown() &#123;</span><br><span class="line">        System.out.println(&quot;Computer shutDown begin&quot;);</span><br><span class="line">        cpu.shutDown();</span><br><span class="line">        disk.shutDown();</span><br><span class="line">        memory.shutDown();</span><br><span class="line">        System.out.println(&quot;Computer shutDown end...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸ºï¼Œå®¢æˆ·è§’è‰²</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Client &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Computer computer = new Computer();</span><br><span class="line">        computer.start();</span><br><span class="line">        System.out.println(&quot;=================&quot;);</span><br><span class="line">        computer.shutDown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="82-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#82-ä¼˜ç‚¹">#</a> 8.2 ä¼˜ç‚¹</h3>
<p>**ã€€- æ¾æ•£è€¦åˆ **</p>
<p>ä½¿å¾—å®¢æˆ·ç«¯å’Œå­ç³»ç»Ÿä¹‹é—´è§£è€¦ï¼Œè®©å­ç³»ç»Ÿå†…éƒ¨çš„æ¨¡å—åŠŸèƒ½æ›´å®¹æ˜“æ‰©å±•å’Œç»´æŠ¤ï¼›</p>
<p>**ã€€ã€€- ç®€å•æ˜“ç”¨ **</p>
<p>å®¢æˆ·ç«¯æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å­ç³»ç»Ÿå†…éƒ¨çš„å®ç°ï¼Œæˆ–è€…æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å­ç³»ç»Ÿå†…éƒ¨çš„æ„æˆï¼Œå®ƒåªéœ€è¦è·Ÿ Facade ç±»äº¤äº’å³å¯ã€‚</p>
<p>**ã€€- æ›´å¥½çš„åˆ’åˆ†è®¿é—®å±‚æ¬¡ **</p>
<p>æœ‰äº›æ–¹æ³•æ˜¯å¯¹ç³»ç»Ÿå¤–çš„ï¼Œæœ‰äº›æ–¹æ³•æ˜¯ç³»ç»Ÿå†…éƒ¨ç›¸äº’äº¤äº’çš„ä½¿ç”¨çš„ã€‚å­ç³»ç»ŸæŠŠé‚£äº›æš´éœ²ç»™å¤–éƒ¨çš„åŠŸèƒ½é›†ä¸­åˆ°é—¨é¢ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼Œå¾ˆå¥½çš„éšè—äº†å­ç³»ç»Ÿå†…éƒ¨çš„ç»†èŠ‚ã€‚</p>
<h2 id="9-æ¡¥æ¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#9-æ¡¥æ¥æ¨¡å¼">#</a> 9 æ¡¥æ¥æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong> å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚</p>
<h3 id="91-æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#91-æ¡ˆä¾‹">#</a> 9.1 æ¡ˆä¾‹</h3>
<p>çœ‹ä¸‹å›¾æ‰‹æœºä¸æ‰‹æœºè½¯ä»¶çš„ç±»å›¾</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610180930798.png" class="has" width="710" height="417" />
<p>å¢åŠ ä¸€æ¬¾æ–°çš„æ‰‹æœºè½¯ä»¶ï¼Œéœ€è¦åœ¨æ‰€æœ‰æ‰‹æœºå“ç‰Œç±»ä¸‹æ·»åŠ å¯¹åº”çš„æ‰‹æœºè½¯ä»¶ç±»ï¼Œå½“æ‰‹æœºè½¯ä»¶ç§ç±»è¾ƒå¤šæ—¶ï¼Œå°†å¯¼è‡´ç±»çš„ä¸ªæ•°æ€¥å‰§è†¨èƒ€ï¼Œéš¾ä»¥ç»´æŠ¤</p>
<p>æ‰‹æœºå’Œæ‰‹æœºä¸­çš„è½¯ä»¶æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>æ‰‹æœºä¸­çš„è½¯ä»¶ä»æœ¬è´¨ä¸Šæ¥è¯´å¹¶ä¸æ˜¯ä¸€ç§æ‰‹æœºï¼Œæ‰‹æœºè½¯ä»¶è¿è¡Œåœ¨æ‰‹æœºä¸­ï¼Œæ˜¯ä¸€ç§åŒ…å«ä¸è¢«åŒ…å«å…³ç³»ï¼Œè€Œä¸æ˜¯ä¸€ç§çˆ¶ä¸å­æˆ–è€…è¯´ä¸€èˆ¬ä¸ç‰¹æ®Šçš„å…³ç³»ï¼Œé€šè¿‡ç»§æ‰¿æ‰‹æœºç±»å®ç°æ‰‹æœºè½¯ä»¶ç±»çš„è®¾è®¡æ˜¯è¿åä¸€èˆ¬è§„å¾‹çš„ã€‚</p>
<p>å¦‚æœ Oppo æ‰‹æœºå®ç°äº† wifi åŠŸèƒ½ï¼Œç»§æ‰¿å®ƒçš„ Oppo åº”ç”¨å•†åŸä¹Ÿä¼šç»§æ‰¿ wifi åŠŸèƒ½ï¼Œå¹¶ä¸” Oppo æ‰‹æœºç±»çš„ä»»ä½•å˜åŠ¨ï¼Œéƒ½ä¼šå½±å“å…¶å­ç±»</p>
<p>æ¢ä¸€ç§è§£å†³æ€è·¯</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610180930823.png" class="has" width="710" height="430" />
<p>ä»ç±»å›¾ä¸Šçœ‹èµ·æ¥æ›´åƒæ˜¯æ‰‹æœºè½¯ä»¶ç±»å›¾ï¼Œæ¶‰åŠåˆ°æ‰‹æœºæœ¬èº«ç›¸å…³çš„åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´ï¼šwifi åŠŸèƒ½ï¼Œæ”¾åˆ°å“ªä¸ªç±»ä¸­å®ç°å‘¢ï¼Ÿæ”¾åˆ° OppoAppStore ä¸­å®ç°æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„</p>
<p>å¼•èµ·æ•´ä¸ªç»“æ„å˜åŒ–çš„å…ƒç´ æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯æ‰‹æœºå“ç‰Œï¼Œä¸€ä¸ªæ˜¯æ‰‹æœºè½¯ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™ä¸¤ä¸ªç‚¹æŠ½å‡ºæ¥ï¼Œåˆ†åˆ«è¿›è¡Œå°è£…</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610180930831.png" class="has" width="690" height="331" />
<h3 id="92-æ¡¥æ¥æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#92-æ¡¥æ¥æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 9.2 æ¡¥æ¥æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610180930861.png" class="has" width="556" height="274" />
<p><strong>ç±»å›¾ï¼š</strong></p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610180930821.png" class="has" width="451" height="197" />
<p><strong>å®ç°ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public interface Software &#123;</span><br><span class="line">    public void run();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public class AppStore implements Software &#123;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;run app store&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Camera implements Software &#123;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        System.out.println(&quot;run camera&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŠ½è±¡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Phone &#123;</span><br><span class="line"></span><br><span class="line">    protected Software software;</span><br><span class="line"></span><br><span class="line">    public void setSoftware(Software software) &#123;</span><br><span class="line">        this.software = software;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void run();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public class Oppo extends Phone &#123;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        software.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Vivo extends Phone &#123;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        software.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¹æ¯”æœ€åˆçš„è®¾è®¡ï¼Œå°†æŠ½è±¡éƒ¨åˆ†ï¼ˆæ‰‹æœºï¼‰ä¸å®ƒçš„å®ç°éƒ¨åˆ†ï¼ˆæ‰‹æœºè½¯ä»¶ç±»ï¼‰åˆ†ç¦»ï¼Œå°†å®ç°éƒ¨åˆ†æŠ½è±¡æˆå•ç‹¬çš„ç±»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚æ•´ä¸ªç±»å›¾çœ‹èµ·æ¥åƒä¸€åº§æ¡¥ï¼Œæ‰€ä»¥ç§°ä¸ºæ¡¥æ¥æ¨¡å¼</p>
<p>ç»§æ‰¿æ˜¯ä¸€ç§å¼ºè€¦åˆå…³ç³»ï¼Œå­ç±»çš„å®ç°ä¸å®ƒçš„çˆ¶ç±»æœ‰éå¸¸ç´§å¯†çš„ä¾èµ–å…³ç³»ï¼Œçˆ¶ç±»çš„ä»»ä½•å˜åŒ– éƒ½ä¼šå¯¼è‡´å­ç±»å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤ç»§æ‰¿æˆ–è€…è¯´å¼ºè€¦åˆå…³ç³»ä¸¥é‡å½±å“äº†ç±»çš„çµæ´»æ€§ï¼Œå¹¶æœ€ç»ˆé™åˆ¶äº†å¯å¤ç”¨æ€§</p>
<p>ä»æ¡¥æ¥æ¨¡å¼çš„è®¾è®¡ä¸Šæˆ‘ä»¬å¯ä»¥çœ‹å‡ºèšåˆæ˜¯ä¸€ç§æ¯”ç»§æ‰¿è¦å¼±çš„å…³è”å…³ç³»ï¼Œæ‰‹æœºç±»å’Œè½¯ä»¶ç±»éƒ½å¯ç‹¬ç«‹çš„è¿›è¡Œå˜åŒ–ï¼Œä¸ä¼šäº’ç›¸å½±å“</p>
<h3 id="span-stylecolor00000093-é€‚ç”¨åœºæ™¯span"><a class="markdownIt-Anchor" href="#span-stylecolor00000093-é€‚ç”¨åœºæ™¯span">#</a> <span style="color:#000000;">9.3 é€‚ç”¨åœºæ™¯</span></h3>
<p>æ¡¥æ¥æ¨¡å¼é€šå¸¸é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ã€‚</p>
<ol>
<li>
<p>å½“ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªç»´åº¦éƒ½éœ€è¦è¿›è¡Œæ‰©å±•æ—¶ã€‚</p>
</li>
<li>
<p>å½“ä¸€ä¸ªç³»ç»Ÿä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿æˆ–å› ä¸ºå¤šå±‚æ¬¡ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ æ—¶ã€‚</p>
</li>
<li>
<p>å½“ä¸€ä¸ªç³»ç»Ÿéœ€è¦åœ¨æ„ä»¶çš„æŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“åŒ–è§’è‰²ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§æ—¶ã€‚</p>
</li>
</ol>
<h3 id="span-stylecolor00000094-ä¼˜ç¼ºç‚¹span"><a class="markdownIt-Anchor" href="#span-stylecolor00000094-ä¼˜ç¼ºç‚¹span">#</a> <span style="color:#000000;">9.4 ä¼˜ç¼ºç‚¹</span></h3>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<p>(1) åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œæ¡¥æ¥æ¨¡å¼å¯ä»¥å–ä»£å¤šå±‚ç»§æ‰¿æ–¹æ¡ˆï¼Œå¤šå±‚ç»§æ‰¿æ–¹æ¡ˆè¿èƒŒäº† â€œå•ä¸€èŒè´£åŸåˆ™â€ï¼Œå¤ç”¨æ€§è¾ƒå·®ï¼Œä¸”ç±»çš„ä¸ªæ•°éå¸¸å¤šï¼Œæ¡¥æ¥æ¨¡å¼æ˜¯æ¯”å¤šå±‚ç»§æ‰¿æ–¹æ¡ˆæ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œå®ƒæå¤§å‡å°‘äº†å­ç±»çš„ä¸ªæ•°ã€‚</p>
<p>(2) æ¡¥æ¥æ¨¡å¼æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œåœ¨ä¸¤ä¸ªå˜åŒ–ç»´åº¦ä¸­ä»»æ„æ‰©å±•ä¸€ä¸ªç»´åº¦ï¼Œéƒ½ä¸éœ€è¦ä¿®æ”¹åŸæœ‰ç³»ç»Ÿï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<p>æ¡¥æ¥æ¨¡å¼çš„ä½¿ç”¨ä¼šå¢åŠ ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ï¼Œç”±äºå…³è”å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚å¼€å‘è€…ä¸€å¼€å§‹å°±é’ˆå¯¹æŠ½è±¡å±‚è¿›è¡Œè®¾è®¡ä¸ç¼–ç¨‹ã€‚</p>
<h2 id="10-ç»„åˆæ¨¡å¼"><a class="markdownIt-Anchor" href="#10-ç»„åˆæ¨¡å¼">#</a> 10 ç»„åˆæ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** æœ‰æ—¶åˆå«ä½œ<span style="color:#006400;">éƒ¨åˆ† - æ•´ä½“æ¨¡å¼</span>ï¼Œå®ƒæ˜¯ä¸€ç§å°†å¯¹è±¡ç»„åˆæˆæ ‘çŠ¶çš„å±‚æ¬¡ç»“æ„çš„æ¨¡å¼ï¼Œç”¨æ¥è¡¨ç¤º â€œéƒ¨åˆ† - æ•´ä½“â€ çš„å…³ç³»ï¼Œä½¿ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡å…·æœ‰ä¸€è‡´çš„è®¿é—®æ€§ã€‚</p>
<p>** æ„å›¾ï¼š** å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º &quot;éƒ¨åˆ† - æ•´ä½“&quot; çš„å±‚æ¬¡ç»“æ„ã€‚ç»„åˆæ¨¡å¼ä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** å®ƒåœ¨æˆ‘ä»¬æ ‘å‹ç»“æ„çš„é—®é¢˜ä¸­ï¼Œæ¨¡ç³Šäº†ç®€å•å…ƒç´ å’Œå¤æ‚å…ƒç´ çš„æ¦‚å¿µï¼Œå®¢æˆ·ç¨‹åºå¯ä»¥å‘å¤„ç†ç®€å•å…ƒç´ ä¸€æ ·æ¥å¤„ç†å¤æ‚å…ƒç´ ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç¨‹åºä¸å¤æ‚å…ƒç´ çš„å†…éƒ¨ç»“æ„è§£è€¦ã€‚</p>
<p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€æ‚¨æƒ³è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ† - æ•´ä½“å±‚æ¬¡ç»“æ„ï¼ˆæ ‘å½¢ç»“æ„ï¼‰ã€‚ 2ã€æ‚¨å¸Œæœ›ç”¨æˆ·å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„ä¸åŒï¼Œç”¨æˆ·å°†ç»Ÿä¸€åœ°ä½¿ç”¨ç»„åˆç»“æ„ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** æ ‘æå’Œå¶å­å®ç°ç»Ÿä¸€æ¥å£ï¼Œæ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** æ ‘æå†…éƒ¨ç»„åˆè¯¥æ¥å£ï¼Œå¹¶ä¸”å«æœ‰å†…éƒ¨å±æ€§ Listï¼Œé‡Œé¢æ”¾ Componentã€‚</p>
<p>ç»„åˆæ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æœ‰ï¼š</p>
<ol>
<li>
<p>ç»„åˆæ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä¸€è‡´åœ°å¤„ç†å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ï¼Œæ— é¡»å…³å¿ƒè‡ªå·±å¤„ç†çš„æ˜¯å•ä¸ªå¯¹è±¡ï¼Œè¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œè¿™ç®€åŒ–äº†å®¢æˆ·ç«¯ä»£ç ï¼›</p>
</li>
<li>
<p>æ›´å®¹æ˜“åœ¨ç»„åˆä½“å†…åŠ å…¥æ–°çš„å¯¹è±¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå› ä¸ºåŠ å…¥äº†æ–°çš„å¯¹è±¡è€Œæ›´æ”¹æºä»£ç ï¼Œæ»¡è¶³ â€œå¼€é—­åŸåˆ™â€ï¼›</p>
</li>
</ol>
<p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼š</p>
<ol>
<li>
<p>è®¾è®¡è¾ƒå¤æ‚ï¼Œå®¢æˆ·ç«¯éœ€è¦èŠ±æ›´å¤šæ—¶é—´ç†æ¸…ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼›</p>
</li>
<li>
<p>ä¸å®¹æ˜“é™åˆ¶å®¹å™¨ä¸­çš„æ„ä»¶ï¼›</p>
</li>
<li>
<p>ä¸å®¹æ˜“ç”¨ç»§æ‰¿çš„æ–¹æ³•æ¥å¢åŠ æ„ä»¶çš„æ–°åŠŸèƒ½ï¼›</p>
</li>
</ol>
<h3 id="101-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#101-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 10.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612191511416.png" class="has" width="529" height="565" />
<ul>
<li>
<p>æŠ½è±¡æ„ä»¶ï¼ˆComponentï¼‰è§’è‰²ï¼šå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºæ ‘å¶æ„ä»¶å’Œæ ‘ææ„ä»¶å£°æ˜å…¬å…±æ¥å£ï¼Œå¹¶å®ç°å®ƒä»¬çš„é»˜è®¤è¡Œä¸ºã€‚åœ¨é€æ˜å¼çš„ç»„åˆæ¨¡å¼ä¸­æŠ½è±¡æ„ä»¶è¿˜å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼›åœ¨å®‰å…¨å¼çš„ç»„åˆæ¨¡å¼ä¸­ä¸å£°æ˜è®¿é—®å’Œç®¡ç†å­ç±»çš„æ¥å£ï¼Œç®¡ç†å·¥ä½œç”±æ ‘ææ„ä»¶å®Œæˆã€‚</p>
</li>
<li>
<p>æ ‘å¶æ„ä»¶ï¼ˆLeafï¼‰è§’è‰²ï¼šæ˜¯ç»„åˆä¸­çš„å¶èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæ²¡æœ‰å­èŠ‚ç‚¹ï¼Œç”¨äºå®ç°æŠ½è±¡æ„ä»¶è§’è‰²ä¸­ å£°æ˜çš„å…¬å…±æ¥å£ã€‚</p>
</li>
<li>
<p>æ ‘ææ„ä»¶ï¼ˆCompositeï¼‰è§’è‰²ï¼šæ˜¯ç»„åˆä¸­çš„åˆ†æ”¯èŠ‚ç‚¹å¯¹è±¡ï¼Œå®ƒæœ‰å­èŠ‚ç‚¹ã€‚å®ƒå®ç°äº†æŠ½è±¡æ„ä»¶è§’è‰²ä¸­å£°æ˜çš„æ¥å£ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å­˜å‚¨å’Œç®¡ç†å­éƒ¨ä»¶ï¼Œé€šå¸¸åŒ…å« Add ()ã€Remove ()ã€GetChild () ç­‰æ–¹æ³•</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼ˆè®¿é—®ä¸€é¢—æ ‘ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/201906121917147.png" class="has" width="286" height="216" />
<p>1 ç»„ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface Component &#123;</span><br><span class="line">    public void add(Component c);</span><br><span class="line">    public void remove(Component c);</span><br><span class="line">    public Component getChild(int i);</span><br><span class="line">    public void operation();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å¶å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class Leaf implements Component&#123;</span><br><span class="line">    </span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    public Leaf(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void add(Component c) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void remove(Component c) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Component getChild(int i) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">         System.out.println(&quot;æ ‘å¶&quot;+name+&quot;ï¼šè¢«è®¿é—®ï¼&quot;); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 æ ‘æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class Composite implements Component &#123;</span><br><span class="line"></span><br><span class="line">    private ArrayList&lt;Component&gt; children = new ArrayList&lt;Component&gt;();</span><br><span class="line"></span><br><span class="line">    public void add(Component c) &#123;</span><br><span class="line">        children.add(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void remove(Component c) &#123;</span><br><span class="line">        children.remove(c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Component getChild(int i) &#123;</span><br><span class="line">        return children.get(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void operation() &#123;</span><br><span class="line">        for (Object obj : children) &#123;</span><br><span class="line">            ((Component) obj).operation();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="-7"><a class="markdownIt-Anchor" href="#-7">#</a> </h3>
<h2 id="11-äº«å…ƒæ¨¡å¼"><a class="markdownIt-Anchor" href="#11-äº«å…ƒæ¨¡å¼">#</a> 11 äº«å…ƒæ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** é€šè¿‡å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** åœ¨æœ‰å¤§é‡å¯¹è±¡æ—¶ï¼Œæœ‰å¯èƒ½ä¼šé€ æˆå†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬æŠŠå…¶ä¸­å…±åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œå¦‚æœæœ‰ç›¸åŒçš„ä¸šåŠ¡è¯·æ±‚ï¼Œç›´æ¥è¿”å›åœ¨å†…å­˜ä¸­å·²æœ‰çš„å¯¹è±¡ï¼Œé¿å…é‡æ–°åˆ›å»ºã€‚</p>
<p><strong>ä½•æ—¶ä½¿ç”¨ï¼š</strong> 1ã€ç³»ç»Ÿä¸­æœ‰å¤§é‡å¯¹è±¡ã€‚ 2ã€è¿™äº›å¯¹è±¡æ¶ˆè€—å¤§é‡å†…å­˜ã€‚ 3ã€è¿™äº›å¯¹è±¡çš„çŠ¶æ€å¤§éƒ¨åˆ†å¯ä»¥å¤–éƒ¨åŒ–ã€‚ 4ã€è¿™äº›å¯¹è±¡å¯ä»¥æŒ‰ç…§å†…è•´çŠ¶æ€åˆ†ä¸ºå¾ˆå¤šç»„ï¼Œå½“æŠŠå¤–è•´å¯¹è±¡ä»å¯¹è±¡ä¸­å‰”é™¤å‡ºæ¥æ—¶ï¼Œæ¯ä¸€ç»„å¯¹è±¡éƒ½å¯ä»¥ç”¨ä¸€ä¸ªå¯¹è±¡æ¥ä»£æ›¿ã€‚ 5ã€ç³»ç»Ÿä¸ä¾èµ–äºè¿™äº›å¯¹è±¡èº«ä»½ï¼Œè¿™äº›å¯¹è±¡æ˜¯ä¸å¯åˆ†è¾¨çš„ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** ç”¨å”¯ä¸€æ ‡è¯†ç åˆ¤æ–­ï¼Œå¦‚æœåœ¨å†…å­˜ä¸­æœ‰ï¼Œåˆ™è¿”å›è¿™ä¸ªå”¯ä¸€æ ‡è¯†ç æ‰€æ ‡è¯†çš„å¯¹è±¡ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** ç”¨ HashMap å­˜å‚¨è¿™äº›å¯¹è±¡ã€‚</p>
<p><strong>åº”ç”¨å®ä¾‹ï¼š</strong> 1ã€JAVA ä¸­çš„ Stringï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ä¿å­˜åœ¨å­—ç¬¦ä¸²ç¼“å­˜æ± é‡Œé¢ã€‚</p>
<p>** ä¼˜ç‚¹ï¼š** å¤§å¤§å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½ç³»ç»Ÿçš„å†…å­˜ï¼Œä½¿æ•ˆç‡æé«˜ã€‚</p>
<p>** ç¼ºç‚¹ï¼š** æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œéœ€è¦åˆ†ç¦»å‡ºå¤–éƒ¨çŠ¶æ€å’Œå†…éƒ¨çŠ¶æ€ï¼Œè€Œä¸”å¤–éƒ¨çŠ¶æ€å…·æœ‰å›ºæœ‰åŒ–çš„æ€§è´¨ï¼Œä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå¦åˆ™ä¼šé€ æˆç³»ç»Ÿçš„æ··ä¹±ã€‚</p>
<p><span style="color:#f33b45;">ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬æŠ½å–å‡ºä¸€ä¸ªå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ï¼ˆä¸èƒ½å…±äº«ï¼‰å’Œå†…éƒ¨çŠ¶æ€ï¼ˆå¯ä»¥å…±äº«ï¼‰ã€‚ç„¶åæ ¹æ®å¤–éƒ¨çŠ¶æ€çš„å†³å®šæ˜¯å¦åˆ›å»ºå†…éƒ¨çŠ¶æ€å¯¹è±¡ã€‚å†…éƒ¨çŠ¶æ€å¯¹è±¡æ˜¯é€šè¿‡å“ˆå¸Œè¡¨ä¿å­˜çš„ï¼Œå½“å¤–éƒ¨çŠ¶æ€ç›¸åŒçš„æ—¶å€™ï¼Œä¸å†é‡å¤çš„åˆ›å»ºå†…éƒ¨çŠ¶æ€å¯¹è±¡ï¼Œä»è€Œå‡å°‘è¦åˆ›å»ºå¯¹è±¡çš„æ•°é‡ã€‚</span></p>
<h3 id="111-äº«å…ƒæ¨¡å¼çš„ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#111-äº«å…ƒæ¨¡å¼çš„ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹">#</a> 11.1 äº«å…ƒæ¨¡å¼çš„ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610202655697.png" class="has" width="563" height="320" />
<p>1ã€Flyweight (äº«å…ƒæŠ½è±¡ç±»)ï¼šä¸€èˆ¬æ˜¯æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå®šä¹‰äº†äº«å…ƒç±»çš„å…¬å…±æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¯ä»¥åˆ†äº«å†…éƒ¨çŠ¶æ€çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨è¿™äº›æ–¹æ³•ä¿®æ”¹å¤–éƒ¨çŠ¶æ€ã€‚</p>
<p>2ã€ConcreteFlyweight (å…·ä½“äº«å…ƒç±»)ï¼šå…·ä½“äº«å…ƒç±»å®ç°äº†æŠ½è±¡äº«å…ƒç±»çš„æ–¹æ³•ï¼Œä¸ºäº«å…ƒå¯¹è±¡å¼€è¾Ÿäº†å†…å­˜ç©ºé—´æ¥ä¿å­˜äº«å…ƒå¯¹è±¡çš„å†…éƒ¨æ•°æ®ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡å’Œå•ä¾‹æ¨¡å¼ç»“åˆåªåˆ›å»ºä¸€ä¸ªäº«å…ƒå¯¹è±¡ã€‚</p>
<p>3ã€FlyweightFactory (äº«å…ƒå·¥å‚ç±»)ï¼šäº«å…ƒå·¥å‚ç±»åˆ›å»ºå¹¶ä¸”ç®¡ç†äº«å…ƒç±»ï¼Œäº«å…ƒå·¥å‚ç±»é’ˆå¯¹äº«å…ƒç±»æ¥è¿›è¡Œç¼–ç¨‹ï¼Œé€šè¿‡æä¾›ä¸€ä¸ªäº«å…ƒæ± æ¥è¿›è¡Œäº«å…ƒå¯¹è±¡çš„ç®¡ç†ã€‚ä¸€èˆ¬äº«å…ƒæ± è®¾è®¡æˆ<strong>é”®å€¼å¯¹</strong>ï¼Œæˆ–è€…å…¶ä»–çš„å­˜å‚¨ç»“æ„æ¥å­˜å‚¨ã€‚å½“å®¢æˆ·ç«¯è¿›è¡Œäº«å…ƒå¯¹è±¡çš„è¯·æ±‚æ—¶ï¼Œå¦‚æœäº«å…ƒæ± ä¸­æœ‰å¯¹åº”çš„äº«å…ƒå¯¹è±¡åˆ™ç›´æ¥è¿”å›å¯¹åº”çš„å¯¹è±¡ï¼Œå¦åˆ™å·¥å‚ç±»åˆ›å»ºå¯¹åº”çš„äº«å…ƒå¯¹è±¡å¹¶ä¿å­˜åˆ°äº«å…ƒæ± ã€‚</p>
<p>ä¸¾ä¾‹ï¼ˆJAVA ä¸­çš„ Stringï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ä¿å­˜åœ¨å­—ç¬¦ä¸²ç¼“å­˜æ± é‡Œé¢ï¼‰ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610202655744.png" class="has" width="310" height="187" />
<p>ï¼ˆ1ï¼‰åˆ›å»ºäº«å…ƒå¯¹è±¡æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface IFlyweight &#123;</span><br><span class="line">    void print();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰åˆ›å»ºå…·ä½“äº«å…ƒå¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Flyweight implements IFlyweight &#123;</span><br><span class="line">    private String id;</span><br><span class="line">    public Flyweight(String id)&#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void print() &#123;</span><br><span class="line">        System.out.println(&quot;Flyweight.id = &quot; + getId() + &quot; ...&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public String getId() &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰åˆ›å»ºå·¥å‚ï¼Œè¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œä¸ºäº†é¿å…äº«å…ƒå¯¹è±¡è¢«é‡å¤åˆ›å»ºï¼Œæˆ‘ä»¬ä½¿ç”¨ HashMap ä¸­çš„ key å€¼ä¿è¯å…¶å”¯ä¸€ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class FlyweightFactory &#123;</span><br><span class="line">    private Map&lt;String, IFlyweight&gt; flyweightMap = new HashMap();</span><br><span class="line">    public IFlyweight getFlyweight(String str)&#123;</span><br><span class="line">        IFlyweight flyweight = flyweightMap.get(str);</span><br><span class="line">        if(flyweight == null)&#123;</span><br><span class="line">            flyweight = new Flyweight(str);</span><br><span class="line">            flyweightMap.put(str, flyweight);</span><br><span class="line">        &#125;</span><br><span class="line">        return  flyweight;</span><br><span class="line">    &#125;</span><br><span class="line">    public int getFlyweightMapSize()&#123;</span><br><span class="line">        return flyweightMap.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ4ï¼‰æµ‹è¯•ï¼Œæˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯åªä¼šäº§ç”Ÿä¸¤ä¸ªäº«å…ƒå¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class MainTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        FlyweightFactory flyweightFactory = new FlyweightFactory();</span><br><span class="line">        IFlyweight flyweight1 = flyweightFactory.getFlyweight(&quot;A&quot;);</span><br><span class="line">        IFlyweight flyweight2 = flyweightFactory.getFlyweight(&quot;B&quot;);</span><br><span class="line">        IFlyweight flyweight3 = flyweightFactory.getFlyweight(&quot;A&quot;);</span><br><span class="line">        flyweight1.print();</span><br><span class="line">        flyweight2.print();</span><br><span class="line">        flyweight3.print();</span><br><span class="line">        System.out.println(flyweightFactory.getFlyweightMapSize());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610203118380.png" class="has" width="466" height="100" />
<h2 id="-8"><a class="markdownIt-Anchor" href="#-8">#</a> </h2>
<h1 id="c-å…³ç³»æ¨¡å¼11ç§"><a class="markdownIt-Anchor" href="#c-å…³ç³»æ¨¡å¼11ç§">#</a> <strong>Cã€å…³ç³»æ¨¡å¼ï¼ˆ11 ç§ï¼‰</strong></h1>
<p>å…ˆæ¥å¼ å›¾ï¼Œçœ‹çœ‹è¿™ 11 ä¸­æ¨¡å¼çš„å…³ç³»ï¼š</p>
<p>ç¬¬ä¸€ç±»ï¼šé€šè¿‡çˆ¶ç±»ä¸å­ç±»çš„å…³ç³»è¿›è¡Œå®ç°ã€‚</p>
<p>ç¬¬äºŒç±»ï¼šä¸¤ä¸ªç±»ä¹‹é—´ã€‚</p>
<p>ç¬¬ä¸‰ç±»ï¼šç±»çš„çŠ¶æ€ã€‚</p>
<p>ç¬¬å››ç±»ï¼šé€šè¿‡ä¸­é—´ç±»</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610215352532.png" class="has" width="675" height="323" />
<h2 id="12-ç­–ç•¥æ¨¡å¼"><a class="markdownIt-Anchor" href="#12-ç­–ç•¥æ¨¡å¼">#</a> 12 ç­–ç•¥æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong> ç­–ç•¥æ¨¡å¼å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†æ¯ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿ä»–ä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚</p>
<p>** æ„å›¾ï¼š** å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** åœ¨æœ‰å¤šç§ç®—æ³•ç›¸ä¼¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ ifâ€¦else æ‰€å¸¦æ¥çš„å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** ä¸€ä¸ªç³»ç»Ÿæœ‰è®¸å¤šè®¸å¤šç±»ï¼Œè€ŒåŒºåˆ†å®ƒä»¬çš„åªæ˜¯ä»–ä»¬ç›´æ¥çš„è¡Œä¸ºã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** å°†è¿™äº›ç®—æ³•å°è£…æˆä¸€ä¸ªä¸€ä¸ªçš„ç±»ï¼Œä»»æ„åœ°æ›¿æ¢ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** å®ç°åŒä¸€ä¸ªæ¥å£ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ 2ã€é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚ 3ã€æ‰©å±•æ€§è‰¯å¥½ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€ç­–ç•¥ç±»ä¼šå¢å¤šã€‚ 2ã€æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚</p>
<h3 id="121-ç­–ç•¥æ¨¡å¼ç»“æ„å’Œç¤ºä¾‹ä»£ç "><a class="markdownIt-Anchor" href="#121-ç­–ç•¥æ¨¡å¼ç»“æ„å’Œç¤ºä¾‹ä»£ç ">#</a> 12.1 ç­–ç•¥æ¨¡å¼ç»“æ„å’Œç¤ºä¾‹ä»£ç </h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610215352527.png" class="has" width="725" height="311" />
<p><strong>æŠ½è±¡ç­–ç•¥è§’è‰²:</strong> è¿™ä¸ªæ˜¯ä¸€ä¸ªæŠ½è±¡çš„è§’è‰²ï¼Œé€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»å»å®ç°ã€‚å¯¹æ¯”æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ Comparator æ¥å£ã€‚</p>
<p><strong>å…·ä½“ç­–ç•¥è§’è‰²:</strong> åŒ…è£…äº†å…·ä½“çš„ç®—æ³•å’Œè¡Œä¸ºã€‚å¯¹æ¯”æ¥è¯´ï¼Œå°±æ˜¯å®ç°äº† Comparator æ¥å£çš„å®ç°ä¸€ç»„å®ç°ç±»ã€‚</p>
<p><strong>ç¯å¢ƒè§’è‰²:</strong> å†…éƒ¨ä¼šæŒæœ‰ä¸€ä¸ªæŠ½è±¡è§’è‰²çš„å¼•ç”¨ï¼Œç»™å®¢æˆ·ç«¯è°ƒç”¨ã€‚</p>
<p>ä¸¾ä¾‹å¦‚ä¸‹ï¼ˆ å®ç°ä¸€ä¸ªåŠ å‡çš„åŠŸèƒ½ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190610215352523.png" class="has" width="335" height="261" />
<p>1ã€å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface Strategy &#123;</span><br><span class="line"></span><br><span class="line">    public int calc(int num1,int num2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class AddStrategy implements Strategy &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int calc(int num1, int num2) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        return num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public class SubstractStrategy implements Strategy &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int calc(int num1, int num2) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        return num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€ç¯å¢ƒè§’è‰²</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Environment &#123;</span><br><span class="line">    private Strategy strategy;</span><br><span class="line"></span><br><span class="line">    public Environment(Strategy strategy) &#123;</span><br><span class="line">        this.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int calculate(int a, int b) &#123;</span><br><span class="line">        return strategy.calc(a, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4ã€æµ‹è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class MainTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        </span><br><span class="line">        Environment environment=new Environment(new AddStrategy());</span><br><span class="line">        int result=environment.calculate(20, 5);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        </span><br><span class="line">        Environment environment1=new Environment(new SubstractStrategy());</span><br><span class="line">        int result1=environment1.calculate(20, 5);</span><br><span class="line">        System.out.println(result1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="-9"><a class="markdownIt-Anchor" href="#-9">#</a> </h3>
<h2 id="13-æ¨¡æ¿æ¨¡å¼"><a class="markdownIt-Anchor" href="#13-æ¨¡æ¿æ¨¡å¼">#</a> 13 æ¨¡æ¿æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ï¼Œæ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚</p>
<p>é€šä¿—ç‚¹çš„ç†è§£å°±æ˜¯ ï¼šå®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œæœ‰å›ºå®šçš„æ•°ä¸ªæ­¥éª¤ï¼Œä½†æ˜¯æ¯ä¸ªæ­¥éª¤æ ¹æ®å¯¹è±¡çš„ä¸åŒï¼Œè€Œå®ç°ç»†èŠ‚ä¸åŒï¼›å°±å¯ä»¥åœ¨çˆ¶ç±»ä¸­å®šä¹‰ä¸€ä¸ªå®Œæˆè¯¥äº‹æƒ…çš„æ€»æ–¹æ³•ï¼ŒæŒ‰ç…§å®Œæˆäº‹ä»¶éœ€è¦çš„æ­¥éª¤å»è°ƒç”¨å…¶æ¯ä¸ªæ­¥éª¤çš„å®ç°æ–¹æ³•ã€‚æ¯ä¸ªæ­¥éª¤çš„å…·ä½“å®ç°ï¼Œç”±å­ç±»å®Œæˆã€‚</p>
<h3 id="131-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#131-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 13.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612192139396.png" class="has" width="713" height="582" />
<p>æŠ½è±¡çˆ¶ç±»ï¼ˆAbstractClassï¼‰ï¼šå®ç°äº†æ¨¡æ¿æ–¹æ³•ï¼Œå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ã€‚</p>
<p>å…·ä½“ç±»ï¼ˆConcreteClass)ï¼šå®ç°æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå³ä¸åŒçš„å¯¹è±¡çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p>
<p>ä¸¾ä¾‹ï¼ˆ æˆ‘ä»¬åšèœå¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ ï¼ˆ1ï¼‰å¤‡æ–™ ï¼ˆ2ï¼‰å…·ä½“åšèœ ï¼ˆ3ï¼‰ç››èœç«¯ç»™å®¢äººäº«ç”¨ï¼Œè¿™ä¸‰éƒ¨å°±æ˜¯ç®—æ³•çš„éª¨æ¶ ï¼›ç„¶è€Œåšä¸åŒèœéœ€è¦çš„æ–™ï¼Œåšçš„æ–¹æ³•ï¼Œä»¥åŠå¦‚ä½•ç››è£…ç»™å®¢äººäº«ç”¨éƒ½æ˜¯ä¸åŒçš„è¿™ä¸ªå°±æ˜¯ä¸åŒçš„å®ç°ç»†èŠ‚ã€‚ï¼‰ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612192139362.png" class="has" width="425" height="250" />
<p>a. å…ˆæ¥å†™ä¸€ä¸ªæŠ½è±¡çš„åšèœçˆ¶ç±»ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Dish &#123;    </span><br><span class="line">    /**</span><br><span class="line">     * å…·ä½“çš„æ•´ä¸ªè¿‡ç¨‹</span><br><span class="line">     */</span><br><span class="line">    protected void dodish()&#123;</span><br><span class="line">        this.preparation();</span><br><span class="line">        this.doing();</span><br><span class="line">        this.carriedDishes();</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * å¤‡æ–™</span><br><span class="line">     */</span><br><span class="line">    public abstract void preparation();</span><br><span class="line">    /**</span><br><span class="line">     * åšèœ</span><br><span class="line">     */</span><br><span class="line">    public abstract void doing();</span><br><span class="line">    /**</span><br><span class="line">     * ä¸Šèœ</span><br><span class="line">     */</span><br><span class="line">    public abstract void carriedDishes ();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>b. ä¸‹æ¥åšä¸¤ä¸ªç•ªèŒ„ç‚’è›‹ï¼ˆEggsWithTomatoï¼‰å’Œçº¢çƒ§è‚‰ï¼ˆBouilliï¼‰å®ç°çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public class EggsWithTomato extends Dish &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void preparation() &#123;</span><br><span class="line">        System.out.println(&quot;æ´—å¹¶åˆ‡è¥¿çº¢æŸ¿ï¼Œæ‰“é¸¡è›‹ã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doing() &#123;</span><br><span class="line">        System.out.println(&quot;é¸¡è›‹å€’å…¥é”…é‡Œï¼Œç„¶åå€’å…¥è¥¿çº¢æŸ¿ä¸€èµ·ç‚’ã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void carriedDishes() &#123;</span><br><span class="line">        System.out.println(&quot;å°†ç‚’å¥½çš„è¥¿çº¢å¯ºé¸¡è›‹è£…å…¥ç¢Ÿå­é‡Œï¼Œç«¯ç»™å®¢äººåƒã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public class Bouilli extends Dish&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void preparation() &#123;</span><br><span class="line">        System.out.println(&quot;åˆ‡çŒªè‚‰å’ŒåœŸè±†ã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void doing() &#123;</span><br><span class="line">        System.out.println(&quot;å°†åˆ‡å¥½çš„çŒªè‚‰å€’å…¥é”…ä¸­ç‚’ä¸€ä¼šç„¶åå€’å…¥åœŸè±†è¿ç‚’å¸¦ç‚–ã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void carriedDishes() &#123;</span><br><span class="line">        System.out.println(&quot;å°†åšå¥½çš„çº¢çƒ§è‚‰ç››è¿›ç¢—é‡Œç«¯ç»™å®¢äººåƒã€‚&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>c. åœ¨æµ‹è¯•ç±»ä¸­æˆ‘ä»¬æ¥åšèœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class MainTest &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Dish eggsWithTomato = new EggsWithTomato();</span><br><span class="line">        eggsWithTomato.dodish();</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;-----------------------------&quot;);</span><br><span class="line"></span><br><span class="line">        Dish bouilli = new Bouilli();</span><br><span class="line">        bouilli.dodish();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="132-æ¨¡æ¿æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹"><a class="markdownIt-Anchor" href="#132-æ¨¡æ¿æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹">#</a> 13.2  æ¨¡æ¿æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹</h3>
<p>ä¼˜ç‚¹ï¼š</p>
<p>ï¼ˆ1ï¼‰å…·ä½“ç»†èŠ‚æ­¥éª¤å®ç°å®šä¹‰åœ¨å­ç±»ä¸­ï¼Œå­ç±»å®šä¹‰è¯¦ç»†å¤„ç†ç®—æ³•æ˜¯ä¸ä¼šæ”¹å˜ç®—æ³•æ•´ä½“ç»“æ„ã€‚</p>
<p>ï¼ˆ2ï¼‰ä»£ç å¤ç”¨çš„åŸºæœ¬æŠ€æœ¯ï¼Œåœ¨æ•°æ®åº“è®¾è®¡ä¸­å°¤ä¸ºé‡è¦ã€‚</p>
<p>ï¼ˆ3ï¼‰å­˜åœ¨ä¸€ç§åå‘çš„æ§åˆ¶ç»“æ„ï¼Œé€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å­ç±»å¯¹çˆ¶ç±»è¿›è¡Œæ‰©å±•å¢åŠ æ–°çš„è¡Œä¸ºï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚</p>
<h3 id="ç¼ºç‚¹-2"><a class="markdownIt-Anchor" href="#ç¼ºç‚¹-2">#</a> ç¼ºç‚¹ï¼š</h3>
<pre><code>æ¯ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦å®šä¹‰ä¸€ä¸ªå­ç±»ï¼Œä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œç³»ç»Ÿæ›´åŠ åºå¤§ã€‚
</code></pre>
<h3 id="-10"><a class="markdownIt-Anchor" href="#-10">#</a> </h3>
<h2 id="14-è§‚å¯Ÿè€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#14-è§‚å¯Ÿè€…æ¨¡å¼">#</a> 14 è§‚å¯Ÿè€…æ¨¡å¼</h2>
<p><strong>å®šä¹‰ï¼š</strong> å®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜ç»™å…¶ä»–å¯¹è±¡é€šçŸ¥çš„é—®é¢˜ï¼Œè€Œä¸”è¦è€ƒè™‘åˆ°æ˜“ç”¨å’Œä½è€¦åˆï¼Œä¿è¯é«˜åº¦çš„åä½œã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** ä¸€ä¸ªå¯¹è±¡ï¼ˆç›®æ ‡å¯¹è±¡ï¼‰çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰çš„ä¾èµ–å¯¹è±¡ï¼ˆè§‚å¯Ÿè€…å¯¹è±¡ï¼‰éƒ½å°†å¾—åˆ°é€šçŸ¥ï¼Œè¿›è¡Œå¹¿æ’­é€šçŸ¥ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** ä½¿ç”¨é¢å‘å¯¹è±¡æŠ€æœ¯ï¼Œå¯ä»¥å°†è¿™ç§ä¾èµ–å…³ç³»å¼±åŒ–ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** åœ¨æŠ½è±¡ç±»é‡Œæœ‰ä¸€ä¸ª ArrayList å­˜æ”¾è§‚å¯Ÿè€…ä»¬ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æŠ½è±¡è€¦åˆçš„ã€‚ 2ã€å»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€å¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿè€…å¯¹è±¡æœ‰å¾ˆå¤šçš„ç›´æ¥å’Œé—´æ¥çš„è§‚å¯Ÿè€…çš„è¯ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚ 2ã€å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ 3ã€è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<h3 id="141-æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#141-æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹">#</a> 14.1 æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190611172644555.png" class="has" width="505" height="416" />
<ul>
<li>
<p><strong>æŠ½è±¡è¢«è§‚å¯Ÿè€…è§’è‰²</strong>ï¼šä¹Ÿå°±æ˜¯ä¸€ä¸ªæŠ½è±¡ä¸»é¢˜ï¼Œå®ƒæŠŠæ‰€æœ‰å¯¹è§‚å¯Ÿè€…å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…ã€‚æŠ½è±¡ä¸»é¢˜æä¾›ä¸€ä¸ªæ¥å£ï¼Œå¯ä»¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…è§’è‰²ã€‚ä¸€èˆ¬ç”¨ä¸€ä¸ªæŠ½è±¡ç±»å’Œæ¥å£æ¥å®ç°ã€‚</p>
</li>
<li>
<p><strong>æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²</strong>ï¼šä¸ºæ‰€æœ‰çš„å…·ä½“è§‚å¯Ÿè€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œåœ¨å¾—åˆ°ä¸»é¢˜é€šçŸ¥æ—¶æ›´æ–°è‡ªå·±ã€‚</p>
</li>
<li>
<p><strong>å…·ä½“è¢«è§‚å¯Ÿè€…è§’è‰²</strong>ï¼šä¹Ÿå°±æ˜¯ä¸€ä¸ªå…·ä½“çš„ä¸»é¢˜ï¼Œåœ¨é›†ä½“ä¸»é¢˜çš„å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ç™»è®°è¿‡çš„è§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ã€‚</p>
</li>
<li>
<p><strong>å…·ä½“è§‚å¯Ÿè€…è§’è‰²</strong>ï¼šå®ç°æŠ½è±¡è§‚å¯Ÿè€…è§’è‰²æ‰€éœ€è¦çš„æ›´æ–°æ¥å£ï¼Œä¸€è¾¹ä½¿æœ¬èº«çš„çŠ¶æ€ä¸åˆ¶å›¾çš„çŠ¶æ€ç›¸åè°ƒã€‚</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼ˆæœ‰ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·æœåŠ¡ï¼Œä¸å®šæ—¶å‘å¸ƒä¸€äº›æ¶ˆæ¯ï¼Œå…³æ³¨å…¬ä¼—å·å°±å¯ä»¥æ”¶åˆ°æ¨é€æ¶ˆæ¯ï¼Œå–æ¶ˆå…³æ³¨å°±æ”¶ä¸åˆ°æ¨é€æ¶ˆæ¯ã€‚ï¼‰ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190611172644540.png" class="has" width="545" height="359" />
<p>1ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡è¢«è§‚å¯Ÿè€…æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface Subject &#123;</span><br><span class="line">    </span><br><span class="line">      public void registerObserver(Observer o);</span><br><span class="line">      public void removeObserver(Observer o);</span><br><span class="line">      public void notifyObserver();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€å®šä¹‰ä¸€ä¸ªæŠ½è±¡è§‚å¯Ÿè€…æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface Observer &#123;</span><br><span class="line">    </span><br><span class="line">    public void update(String message);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3ã€å®šä¹‰è¢«è§‚å¯Ÿè€…ï¼Œå®ç°äº† Observerable æ¥å£ï¼Œå¯¹ Observerable æ¥å£çš„ä¸‰ä¸ªæ–¹æ³•è¿›è¡Œäº†å…·ä½“å®ç°ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ª List é›†åˆï¼Œç”¨ä»¥ä¿å­˜æ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œç­‰éœ€è¦é€šçŸ¥è§‚å¯Ÿè€…æ—¶ï¼Œéå†è¯¥é›†åˆå³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public class WechatServer implements Subject &#123;</span><br><span class="line"></span><br><span class="line">    private List&lt;Observer&gt; list;</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    public WechatServer() &#123;</span><br><span class="line">        list = new ArrayList&lt;Observer&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void registerObserver(Observer o) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        list.add(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void removeObserver(Observer o) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        if (!list.isEmpty()) &#123;</span><br><span class="line">            list.remove(o);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void notifyObserver() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        for (Observer o : list) &#123;</span><br><span class="line">            o.update(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setInfomation(String s) &#123;</span><br><span class="line">        this.message = s;</span><br><span class="line">        System.out.println(&quot;å¾®ä¿¡æœåŠ¡æ›´æ–°æ¶ˆæ¯ï¼š &quot; + s);</span><br><span class="line">        // æ¶ˆæ¯æ›´æ–°ï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…</span><br><span class="line">        notifyObserver();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4ã€å®šä¹‰å…·ä½“è§‚å¯Ÿè€…ï¼Œå¾®ä¿¡å…¬ä¼—å·çš„å…·ä½“è§‚å¯Ÿè€…ä¸ºç”¨æˆ· User</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class User implements Observer &#123;</span><br><span class="line"></span><br><span class="line">    private String name;</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    public User(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void update(String message) &#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">        read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void read() &#123;</span><br><span class="line">        System.out.println(name + &quot; æ”¶åˆ°æ¨é€æ¶ˆæ¯ï¼š &quot; + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5ã€ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class MainTest &#123;</span><br><span class="line">    </span><br><span class="line">     public static void main(String[] args) &#123;</span><br><span class="line">         </span><br><span class="line">            WechatServer server = new WechatServer();</span><br><span class="line">            </span><br><span class="line">            Observer userZhang = new User(&quot;ZhangSan&quot;);</span><br><span class="line">            Observer userLi = new User(&quot;LiSi&quot;);</span><br><span class="line">            Observer userWang = new User(&quot;WangWu&quot;);</span><br><span class="line">            </span><br><span class="line">            server.registerObserver(userZhang);</span><br><span class="line">            server.registerObserver(userLi);</span><br><span class="line">            server.registerObserver(userWang);</span><br><span class="line">            server.setInfomation(&quot;PHPæ˜¯ä¸–ç•Œä¸Šæœ€å¥½ç”¨çš„è¯­è¨€ï¼&quot;);</span><br><span class="line">            </span><br><span class="line">            System.out.println(&quot;----------------------------------------------&quot;);</span><br><span class="line">            server.removeObserver(userZhang);</span><br><span class="line">            server.setInfomation(&quot;JAVAæ˜¯ä¸–ç•Œä¸Šæœ€å¥½ç”¨çš„è¯­è¨€ï¼&quot;);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="15-è¿­ä»£å™¨æ¨¡å¼"><a class="markdownIt-Anchor" href="#15-è¿­ä»£å™¨æ¨¡å¼">#</a> 15 è¿­ä»£å™¨æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆæ— é¡»æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</p>
<p><strong>ç®€å•æ¥è¯´ï¼Œä¸åŒç§ç±»çš„å¯¹è±¡å¯èƒ½éœ€è¦ä¸åŒçš„éå†æ–¹å¼ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸€ç§ç±»å‹çš„å¯¹è±¡é…ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæœ€åå¤šä¸ªè¿­ä»£å™¨åˆæˆä¸€ä¸ªã€‚</strong></p>
<p>** ä¸»è¦è§£å†³ï¼š** ä¸åŒçš„æ–¹å¼æ¥éå†æ•´ä¸ªæ•´åˆå¯¹è±¡ã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** æŠŠåœ¨å…ƒç´ ä¹‹é—´æ¸¸èµ°çš„è´£ä»»äº¤ç»™è¿­ä»£å™¨ï¼Œè€Œä¸æ˜¯èšåˆå¯¹è±¡ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** å®šä¹‰æ¥å£ï¼šhasNext, nextã€‚</p>
<p>** åº”ç”¨å®ä¾‹ï¼š**JAVA ä¸­çš„ iteratorã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å®ƒæ”¯æŒä»¥ä¸åŒçš„æ–¹å¼éå†ä¸€ä¸ªèšåˆå¯¹è±¡ã€‚ 2ã€è¿­ä»£å™¨ç®€åŒ–äº†èšåˆç±»ã€‚ 3ã€åœ¨åŒä¸€ä¸ªèšåˆä¸Šå¯ä»¥æœ‰å¤šä¸ªéå†ã€‚ 4ã€åœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­ï¼Œå¢åŠ æ–°çš„èšåˆç±»å’Œè¿­ä»£å™¨ç±»éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ã€‚</p>
<p>** ç¼ºç‚¹ï¼š** ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚</p>
<h3 id="151-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#151-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 15.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190611195714196.png" class="has" width="726" height="380" />
<p>(1) è¿­ä»£å™¨è§’è‰²ï¼ˆIteratorï¼‰: å®šä¹‰éå†å…ƒç´ æ‰€éœ€è¦çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´ä¼šæœ‰è¿™ä¹ˆä¸‰ä¸ªæ–¹æ³•ï¼šå–å¾—ä¸‹ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³• next ()ï¼Œåˆ¤æ–­æ˜¯å¦éå†ç»“æŸçš„æ–¹æ³• hasNext ()ï¼‰ï¼Œç§»å‡ºå½“å‰å¯¹è±¡çš„æ–¹æ³• remove (),</p>
<p>(2) å…·ä½“è¿­ä»£å™¨è§’è‰²ï¼ˆConcrete Iteratorï¼‰ï¼šå®ç°è¿­ä»£å™¨æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆé›†åˆçš„è¿­ä»£ã€‚</p>
<p>(3) å®¹å™¨è§’è‰² (Aggregate):  ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›ä¸€ä¸ª iterator () æ–¹æ³•ï¼Œä¾‹å¦‚ java ä¸­çš„ Collection æ¥å£ï¼ŒList æ¥å£ï¼ŒSet æ¥å£ç­‰</p>
<p>(4) å…·ä½“å®¹å™¨è§’è‰²ï¼ˆConcreteAggregateï¼‰ï¼šå°±æ˜¯æŠ½è±¡å®¹å™¨çš„å…·ä½“å®ç°ç±»ï¼Œæ¯”å¦‚ List æ¥å£çš„æœ‰åºåˆ—è¡¨å®ç° ArrayListï¼ŒList æ¥å£çš„é“¾è¡¨å®ç° LinkListï¼ŒSet æ¥å£çš„å“ˆå¸Œåˆ—è¡¨çš„å®ç° HashSet ç­‰ã€‚</p>
<p>ä¸¾ä¾‹ï¼ˆå’–å•¡å…å’Œä¸­é¤å…åˆå¹¶ï¼Œä»–ä»¬ä¸¤ä¸ªé¤å…çš„èœå•ä¸€ä¸ªæ˜¯æ•°ç»„ä¿å­˜çš„ï¼Œä¸€ä¸ªæ˜¯ ArrayList ä¿å­˜çš„ã€‚éå†æ–¹å¼ä¸ä¸€æ ·ï¼Œä½¿ç”¨è¿­ä»£å™¨èšåˆè®¿é—®ï¼Œåªéœ€è¦ä¸€ç§æ–¹å¼ï¼‰</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190611195714224.png" class="has" width="494" height="360" />
<p>1 è¿­ä»£å™¨æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface Iterator &#123;</span><br><span class="line">    </span><br><span class="line">    public boolean hasNext();</span><br><span class="line">    public Object next();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å’–å•¡åº—èœå•å’Œå’–å•¡åº—èœå•éå†å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">public class CakeHouseMenu &#123;</span><br><span class="line">    private ArrayList&lt;MenuItem&gt; menuItems;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    public CakeHouseMenu() &#123;</span><br><span class="line">        menuItems = new ArrayList&lt;MenuItem&gt;();</span><br><span class="line">        </span><br><span class="line">        addItem(&quot;KFC Cake Breakfast&quot;,&quot;boiled eggs&amp;toast&amp;cabbage&quot;,true,3.99f);</span><br><span class="line">        addItem(&quot;MDL Cake Breakfast&quot;,&quot;fried eggs&amp;toast&quot;,false,3.59f);</span><br><span class="line">        addItem(&quot;Stawberry Cake&quot;,&quot;fresh stawberry&quot;,true,3.29f);</span><br><span class="line">        addItem(&quot;Regular Cake Breakfast&quot;,&quot;toast&amp;sausage&quot;,true,2.59f);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void addItem(String name, String description, boolean vegetable,</span><br><span class="line">            float price) &#123;</span><br><span class="line">        MenuItem menuItem = new MenuItem(name, description, vegetable, price);</span><br><span class="line">        menuItems.add(menuItem);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    public Iterator getIterator()</span><br><span class="line">    &#123;</span><br><span class="line">        return new CakeHouseIterator() ;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class CakeHouseIterator implements  Iterator</span><br><span class="line">     &#123;      </span><br><span class="line">        private int position=0;</span><br><span class="line">        public CakeHouseIterator()</span><br><span class="line">        &#123;</span><br><span class="line">              position=0;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">            @Override</span><br><span class="line">            public boolean hasNext() &#123;</span><br><span class="line">            // TODO Auto-generated method stub</span><br><span class="line">            if(position&lt;menuItems.size())</span><br><span class="line">            &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Object next() &#123;</span><br><span class="line">            // TODO Auto-generated method stub</span><br><span class="line">            MenuItem menuItem =menuItems.get(position);</span><br><span class="line">            position++;</span><br><span class="line">            return menuItem;</span><br><span class="line">        &#125;&#125;;</span><br><span class="line">    //éæœµç²¬é”ç†»å…˜æµ ï½‡çˆœ</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 ä¸­é¤å…èœå•å’Œä¸­é¤å…èœå•éå†å™¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">public class DinerMenu &#123;</span><br><span class="line">    private final static int Max_Items = 5;</span><br><span class="line">    private int numberOfItems = 0;</span><br><span class="line">    private MenuItem[] menuItems;</span><br><span class="line"></span><br><span class="line">    public DinerMenu() &#123;</span><br><span class="line">        menuItems = new MenuItem[Max_Items];</span><br><span class="line">        addItem(&quot;vegetable Blt&quot;, &quot;bacon&amp;lettuce&amp;tomato&amp;cabbage&quot;, true, 3.58f);</span><br><span class="line">        addItem(&quot;Blt&quot;, &quot;bacon&amp;lettuce&amp;tomato&quot;, false, 3.00f);</span><br><span class="line">        addItem(&quot;bean soup&quot;, &quot;bean&amp;potato salad&quot;, true, 3.28f);</span><br><span class="line">        addItem(&quot;hotdog&quot;, &quot;onions&amp;cheese&amp;bread&quot;, false, 3.05f);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void addItem(String name, String description, boolean vegetable,</span><br><span class="line">            float price) &#123;</span><br><span class="line">        MenuItem menuItem = new MenuItem(name, description, vegetable, price);</span><br><span class="line">        if (numberOfItems &gt;= Max_Items) &#123;</span><br><span class="line">            System.err.println(&quot;sorry,menu is full!can not add another item&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            menuItems[numberOfItems] = menuItem;</span><br><span class="line">            numberOfItems++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Iterator getIterator() &#123;</span><br><span class="line">        return new DinerIterator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class DinerIterator implements Iterator &#123;</span><br><span class="line">        private int position;</span><br><span class="line"></span><br><span class="line">        public DinerIterator() &#123;</span><br><span class="line">            position = 0;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            // TODO Auto-generated method stub</span><br><span class="line">            if (position &lt; numberOfItems) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Object next() &#123;</span><br><span class="line">            // TODO Auto-generated method stub</span><br><span class="line">            MenuItem menuItem = menuItems[position];</span><br><span class="line">            position++;</span><br><span class="line">            return menuItem;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 å¥³æœåŠ¡å‘˜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class Waitress &#123;</span><br><span class="line">    private ArrayList&lt;Iterator&gt; iterators = new ArrayList&lt;Iterator&gt;();</span><br><span class="line"></span><br><span class="line">    public Waitress() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addIterator(Iterator iterator) &#123;</span><br><span class="line">        iterators.add(iterator);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void printMenu() &#123;</span><br><span class="line">        Iterator iterator;</span><br><span class="line">        MenuItem menuItem;</span><br><span class="line">        for (int i = 0, len = iterators.size(); i &lt; len; i++) &#123;</span><br><span class="line">            iterator = iterators.get(i);</span><br><span class="line"></span><br><span class="line">            while (iterator.hasNext()) &#123;</span><br><span class="line">                menuItem = (MenuItem) iterator.next();</span><br><span class="line">                System.out</span><br><span class="line">                        .println(menuItem.getName() + &quot;***&quot; + menuItem.getPrice() + &quot;***&quot; + menuItem.getDescription());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void printBreakfastMenu() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void printLunchMenu() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void printVegetableMenu() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="16-è´£ä»»é“¾æ¨¡å¼"><a class="markdownIt-Anchor" href="#16-è´£ä»»é“¾æ¨¡å¼">#</a> 16 è´£ä»»é“¾æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å¦‚æœæœ‰å¤šä¸ªå¯¹è±¡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œè´£ä»»é“¾å¯ä½¿è¯·æ±‚çš„å‘é€è€…å’Œæ¥å—è€…è§£è€¦ï¼Œè¯·æ±‚æ²¿ç€è´£ä»»é“¾ä¼ é€’ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†äº†å®ƒä¸ºæ­¢ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** èŒè´£é“¾ä¸Šçš„å¤„ç†è€…è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°èŒè´£é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’ï¼Œæ‰€ä»¥èŒè´£é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†ã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ä»¥è¿‡æ»¤å¾ˆå¤šé“ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** æ‹¦æˆªçš„ç±»éƒ½å®ç°ç»Ÿä¸€æ¥å£ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š**Handler é‡Œé¢èšåˆå®ƒè‡ªå·±ï¼Œåœ¨ HandlerRequest é‡Œåˆ¤æ–­æ˜¯å¦åˆé€‚ï¼Œå¦‚æœæ²¡è¾¾åˆ°æ¡ä»¶åˆ™å‘ä¸‹ä¼ é€’ï¼Œå‘è°ä¼ é€’ä¹‹å‰ set è¿›å»ã€‚</p>
<h3 id="161-æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#161-æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 16.1 æ¨¡å¼çš„ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2019061120335378.png" class="has" width="468" height="272" />
<ol>
<li>
<p>æŠ½è±¡å¤„ç†è€…ï¼ˆHandlerï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼ŒåŒ…å«æŠ½è±¡å¤„ç†æ–¹æ³•å’Œä¸€ä¸ªåç»§è¿æ¥ã€‚</p>
</li>
<li>
<p>å…·ä½“å¤„ç†è€…ï¼ˆConcrete Handlerï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å¤„ç†è€…çš„å¤„ç†æ–¹æ³•ï¼Œåˆ¤æ–­èƒ½å¦å¤„ç†æœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚åˆ™å¤„ç†ï¼Œå¦åˆ™å°†è¯¥è¯·æ±‚è½¬ç»™å®ƒçš„åç»§è€…ã€‚</p>
</li>
<li>
<p>å®¢æˆ·ç±»ï¼ˆClientï¼‰è§’è‰²ï¼šåˆ›å»ºå¤„ç†é“¾ï¼Œå¹¶å‘é“¾å¤´çš„å…·ä½“å¤„ç†è€…å¯¹è±¡æäº¤è¯·æ±‚ï¼Œå®ƒä¸å…³å¿ƒå¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’è¿‡ç¨‹ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¾‹ï¼ˆè´­ä¹°è¯·æ±‚å†³ç­–ï¼Œä»·æ ¼ä¸åŒè¦ç”±ä¸åŒçš„çº§åˆ«å†³å®šï¼šç»„é•¿ã€éƒ¨é•¿ã€å‰¯éƒ¨ã€æ€»è£ï¼‰ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190611203353118.png" class="has" width="1041" height="363" />
<p>1 å†³ç­–è€…æŠ½è±¡ç±»ï¼ŒåŒ…å«å¯¹è¯·æ±‚å¤„ç†çš„å‡½æ•°ï¼ŒåŒæ—¶è¿˜åŒ…å«æŒ‡å®šä¸‹ä¸€ä¸ªå†³ç­–è€…çš„å‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Approver &#123;</span><br><span class="line">     Approver successor;</span><br><span class="line">     String Name;</span><br><span class="line">    public Approver(String Name)</span><br><span class="line">    &#123;</span><br><span class="line">        this.Name=Name;</span><br><span class="line">    &#125;</span><br><span class="line">    public abstract void ProcessRequest( PurchaseRequest request);</span><br><span class="line">    public void SetSuccessor(Approver successor) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        this.successor=successor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å®¢æˆ·ç«¯ä»¥åŠè¯·æ±‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class PurchaseRequest &#123;</span><br><span class="line">    private int Type = 0;</span><br><span class="line">    private int Number = 0;</span><br><span class="line">    private float Price = 0;</span><br><span class="line">    private int ID = 0;</span><br><span class="line"></span><br><span class="line">    public PurchaseRequest(int Type, int Number, float Price) &#123;</span><br><span class="line">        this.Type = Type;</span><br><span class="line">        this.Number = Number;</span><br><span class="line">        this.Price = Price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int GetType() &#123;</span><br><span class="line">        return Type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public float GetSum() &#123;</span><br><span class="line">        return Number * Price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int GetID() &#123;</span><br><span class="line">        return (int) (Math.random() * 1000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class Client &#123;</span><br><span class="line"></span><br><span class="line">    public Client() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PurchaseRequest sendRequst(int Type, int Number, float Price) &#123;</span><br><span class="line">        return new PurchaseRequest(Type, Number, Price);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 ç»„é•¿ã€éƒ¨é•¿ã€‚ã€‚ã€‚ç»§æ‰¿å†³ç­–è€…æŠ½è±¡ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class GroupApprover extends Approver &#123;</span><br><span class="line"></span><br><span class="line">    public GroupApprover(String Name) &#123;</span><br><span class="line">        super(Name + &quot; GroupLeader&quot;);</span><br><span class="line">        // TODO Auto-generated constructor stub</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void ProcessRequest(PurchaseRequest request) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line"></span><br><span class="line">        if (request.GetSum() &lt; 5000) &#123;</span><br><span class="line">            System.out.println(&quot;**This request &quot; + request.GetID() + &quot; will be handled by &quot; + this.Name + &quot; **&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            successor.ProcessRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">public class DepartmentApprover extends Approver &#123;</span><br><span class="line"></span><br><span class="line">    public DepartmentApprover(String Name) &#123;</span><br><span class="line">        super(Name + &quot; DepartmentLeader&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void ProcessRequest(PurchaseRequest request) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line"></span><br><span class="line">        if ((5000 &lt;= request.GetSum()) &amp;&amp; (request.GetSum() &lt; 10000)) &#123;</span><br><span class="line">            System.out.println(&quot;**This request &quot; + request.GetID()</span><br><span class="line">                    + &quot; will be handled by &quot; + this.Name + &quot; **&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            successor.ProcessRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 æµ‹è¯•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class MainTest &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        Client mClient = new Client();</span><br><span class="line">        Approver GroupLeader = new GroupApprover(&quot;Tom&quot;);</span><br><span class="line">        Approver DepartmentLeader = new DepartmentApprover(&quot;Jerry&quot;);</span><br><span class="line">        Approver VicePresident = new VicePresidentApprover(&quot;Kate&quot;);</span><br><span class="line">        Approver President = new PresidentApprover(&quot;Bush&quot;);</span><br><span class="line"></span><br><span class="line">        GroupLeader.SetSuccessor(VicePresident);</span><br><span class="line">        DepartmentLeader.SetSuccessor(President);</span><br><span class="line">        VicePresident.SetSuccessor(DepartmentLeader);</span><br><span class="line">        President.SetSuccessor(GroupLeader);</span><br><span class="line"></span><br><span class="line">        GroupLeader.ProcessRequest(mClient.sendRequst(1, 10000, 40));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="-11"><a class="markdownIt-Anchor" href="#-11">#</a> </h2>
<h2 id="17-å‘½ä»¤æ¨¡å¼"><a class="markdownIt-Anchor" href="#17-å‘½ä»¤æ¨¡å¼">#</a> 17 å‘½ä»¤æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å°†ä¸€ä¸ªè¯·æ±‚å°è£…ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å‘å‡ºè¯·æ±‚çš„è´£ä»»å’Œæ‰§è¡Œè¯·æ±‚çš„è´£ä»»åˆ†å‰²å¼€ã€‚è¿™æ ·ä¸¤è€…ä¹‹é—´é€šè¿‡å‘½ä»¤å¯¹è±¡è¿›è¡Œæ²Ÿé€šï¼Œè¿™æ ·æ–¹ä¾¿å°†å‘½ä»¤å¯¹è±¡è¿›è¡Œå‚¨å­˜ã€ä¼ é€’ã€è°ƒç”¨ã€å¢åŠ ä¸ç®¡ç†ã€‚</p>
<p>** æ„å›¾ï¼š** å°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿æ‚¨å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å¯¹å®¢æˆ·è¿›è¡Œå‚æ•°åŒ–ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** åœ¨è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œè¡Œä¸ºè¯·æ±‚è€…ä¸è¡Œä¸ºå®ç°è€…é€šå¸¸æ˜¯ä¸€ç§ç´§è€¦åˆçš„å…³ç³»ï¼Œä½†æŸäº›åœºåˆï¼Œæ¯”å¦‚éœ€è¦å¯¹è¡Œä¸ºè¿›è¡Œè®°å½•ã€æ’¤é”€æˆ–é‡åšã€äº‹åŠ¡ç­‰å¤„ç†æ—¶ï¼Œè¿™ç§æ— æ³•æŠµå¾¡å˜åŒ–çš„ç´§è€¦åˆçš„è®¾è®¡å°±ä¸å¤ªåˆé€‚ã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** åœ¨æŸäº›åœºåˆï¼Œæ¯”å¦‚è¦å¯¹è¡Œä¸ºè¿›è¡Œ &quot;è®°å½•ã€æ’¤é”€ / é‡åšã€äº‹åŠ¡&quot; ç­‰å¤„ç†ï¼Œè¿™ç§æ— æ³•æŠµå¾¡å˜åŒ–çš„ç´§è€¦åˆæ˜¯ä¸åˆé€‚çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚ä½•å°† &quot;è¡Œä¸ºè¯·æ±‚è€…&quot; ä¸ &quot;è¡Œä¸ºå®ç°è€…&quot; è§£è€¦ï¼Ÿå°†ä¸€ç»„è¡Œä¸ºæŠ½è±¡ä¸ºå¯¹è±¡ï¼Œå¯ä»¥å®ç°äºŒè€…ä¹‹é—´çš„æ¾è€¦åˆã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** é€šè¿‡è°ƒç”¨è€…è°ƒç”¨æ¥å—è€…æ‰§è¡Œå‘½ä»¤ï¼Œé¡ºåºï¼šè°ƒç”¨è€…â†’æ¥å—è€…â†’å‘½ä»¤ã€‚</p>
<h3 id="171æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#171æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 17.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<h2 id="img-srchttpsbrath4oss-cn-shenzhenaliyuncscompicgo20190612194014850gif-classhas-width550-height612"><a class="markdownIt-Anchor" href="#img-srchttpsbrath4oss-cn-shenzhenaliyuncscompicgo20190612194014850gif-classhas-width550-height612">#</a> <img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612194014850.gif" class="has" width="550" height="612" /></h2>
<ol>
<li>æŠ½è±¡å‘½ä»¤ç±»ï¼ˆCommandï¼‰è§’è‰²ï¼šå£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£ï¼Œæ‹¥æœ‰æ‰§è¡Œå‘½ä»¤çš„æŠ½è±¡æ–¹æ³• execute ()ã€‚</li>
<li>å…·ä½“å‘½ä»¤è§’è‰²ï¼ˆConcrete    Commandï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒæ‹¥æœ‰æ¥æ”¶è€…å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æ¥æ”¶è€…çš„åŠŸèƒ½æ¥å®Œæˆå‘½ä»¤è¦æ‰§è¡Œçš„æ“ä½œã€‚</li>
<li>å®ç°è€… / æ¥æ”¶è€…ï¼ˆReceiverï¼‰è§’è‰²ï¼šæ‰§è¡Œå‘½ä»¤åŠŸèƒ½çš„ç›¸å…³æ“ä½œï¼Œæ˜¯å…·ä½“å‘½ä»¤å¯¹è±¡ä¸šåŠ¡çš„çœŸæ­£å®ç°è€…ã€‚</li>
<li>è°ƒç”¨è€… / è¯·æ±‚è€…ï¼ˆInvokerï¼‰è§’è‰²ï¼šæ˜¯è¯·æ±‚çš„å‘é€è€…ï¼Œå®ƒé€šå¸¸æ‹¥æœ‰å¾ˆå¤šçš„å‘½ä»¤å¯¹è±¡ï¼Œå¹¶é€šè¿‡è®¿é—®å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œç›¸å…³è¯·æ±‚ï¼Œå®ƒä¸ç›´æ¥è®¿é—®æ¥æ”¶è€…ã€‚</li>
</ol>
<p>ä»£ç ä¸¾ä¾‹ï¼ˆå¼€ç¯å’Œå…³ç¯ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612194307560.png" class="has" width="420" height="277" />
<p>1 å‘½ä»¤æŠ½è±¡ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface Command &#123;</span><br><span class="line">    </span><br><span class="line">    public void excute();</span><br><span class="line">    public void undo();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å…·ä½“å‘½ä»¤å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class TurnOffLight implements Command &#123;</span><br><span class="line"></span><br><span class="line">    private Light light;</span><br><span class="line"></span><br><span class="line">    public TurnOffLight(Light light) &#123;</span><br><span class="line">        this.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void excute() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        light.Off();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void undo() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        light.On();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 å®ç°è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public class Light &#123;</span><br><span class="line"></span><br><span class="line">    String loc = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public Light(String loc) &#123;</span><br><span class="line">        this.loc = loc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void On() &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(loc + &quot; On&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Off() &#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(loc + &quot; Off&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 è¯·æ±‚è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class Contral&#123;</span><br><span class="line"></span><br><span class="line">    public void CommandExcute(Command command) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        command.excute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void CommandUndo(Command command) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        command.undo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="-12"><a class="markdownIt-Anchor" href="#-12">#</a> </h2>
<h2 id="18-çŠ¶æ€æ¨¡å¼"><a class="markdownIt-Anchor" href="#18-çŠ¶æ€æ¨¡å¼">#</a> 18 çŠ¶æ€æ¨¡å¼</h2>
<p><strong>å®šä¹‰</strong>ï¼š åœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºè¡¨ç¤ºå„ç§çŠ¶æ€çš„å¯¹è±¡å’Œä¸€ä¸ªè¡Œä¸ºéšç€çŠ¶æ€å¯¹è±¡æ”¹å˜è€Œæ”¹å˜çš„ context å¯¹è±¡ã€‚</p>
<p>ç®€å•ç†è§£ï¼Œä¸€ä¸ªæ‹¥æœ‰çŠ¶æ€çš„ context å¯¹è±¡ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€ä¸‹ï¼Œå…¶è¡Œä¸ºä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>** æ„å›¾ï¼š** å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚</p>
<p>** ä¸»è¦è§£å†³ï¼š** å¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„çŠ¶æ€æ”¹å˜è€Œæ”¹å˜å®ƒçš„ç›¸å…³è¡Œä¸ºã€‚</p>
<p>** ä½•æ—¶ä½¿ç”¨ï¼š** ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥ã€‚</p>
<p>** å¦‚ä½•è§£å†³ï¼š** å°†å„ç§å…·ä½“çš„çŠ¶æ€ç±»æŠ½è±¡å‡ºæ¥ã€‚</p>
<p>** å…³é”®ä»£ç ï¼š** é€šå¸¸å‘½ä»¤æ¨¡å¼çš„æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚è€ŒçŠ¶æ€æ¨¡å¼çš„æ¥å£ä¸­æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ã€‚è€Œä¸”ï¼ŒçŠ¶æ€æ¨¡å¼çš„å®ç°ç±»çš„æ–¹æ³•ï¼Œä¸€èˆ¬è¿”å›å€¼ï¼Œæˆ–è€…æ˜¯æ”¹å˜å®ä¾‹å˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŠ¶æ€æ¨¡å¼ä¸€èˆ¬å’Œå¯¹è±¡çš„çŠ¶æ€æœ‰å…³ã€‚å®ç°ç±»çš„æ–¹æ³•æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¦†ç›–æ¥å£ä¸­çš„æ–¹æ³•ã€‚çŠ¶æ€æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ¶ˆé™¤ ifâ€¦else ç­‰æ¡ä»¶é€‰æ‹©è¯­å¥ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong> 1ã€å°è£…äº†è½¬æ¢è§„åˆ™ã€‚ 2ã€æšä¸¾å¯èƒ½çš„çŠ¶æ€ï¼Œåœ¨æšä¸¾çŠ¶æ€ä¹‹å‰éœ€è¦ç¡®å®šçŠ¶æ€ç§ç±»ã€‚ 3ã€å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ 4ã€å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚ 5ã€å¯ä»¥è®©å¤šä¸ªç¯å¢ƒå¯¹è±¡å…±äº«ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œä»è€Œå‡å°‘ç³»ç»Ÿä¸­å¯¹è±¡çš„ä¸ªæ•°ã€‚</p>
<p><strong>ç¼ºç‚¹ï¼š</strong> 1ã€çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚ 2ã€çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚ 3ã€çŠ¶æ€æ¨¡å¼å¯¹ &quot;å¼€é—­åŸåˆ™&quot; çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºä»£ç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€ä¿®æ”¹å¯¹åº”ç±»çš„æºä»£ç ã€‚</p>
<h3 id="181-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#181-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 18.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612003537747.png" class="has" width="585" height="357" />
<ul>
<li>
<p><strong>State æŠ½è±¡çŠ¶æ€è§’è‰²</strong></p>
<p>æ¥å£æˆ–æŠ½è±¡ç±»ï¼Œè´Ÿè´£å¯¹è±¡çŠ¶æ€å®šä¹‰ï¼Œå¹¶ä¸”å°è£…ç¯å¢ƒè§’è‰²ä»¥å®ç°çŠ¶æ€åˆ‡æ¢ã€‚</p>
</li>
<li>
<p><strong>ConcreteState å…·ä½“çŠ¶æ€è§’è‰²</strong></p>
<p>å…·ä½“çŠ¶æ€ä¸»è¦æœ‰ä¸¤ä¸ªèŒè´£ï¼šä¸€æ˜¯å¤„ç†æœ¬çŠ¶æ€ä¸‹çš„äº‹æƒ…ï¼ŒäºŒæ˜¯ä»æœ¬çŠ¶æ€å¦‚ä½•è¿‡æ¸¡åˆ°å…¶ä»–çŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>Context ç¯å¢ƒè§’è‰²</strong></p>
<p>å®šä¹‰å®¢æˆ·ç«¯éœ€è¦çš„æ¥å£ï¼Œå¹¶ä¸”è´Ÿè´£å…·ä½“çŠ¶æ€çš„åˆ‡æ¢ã€‚</p>
</li>
</ul>
<p>ä¸¾ä¾‹ï¼ˆäººç‰©åœ¨åœ°ç‚¹ A å‘åœ°ç‚¹ B ç§»åŠ¨ï¼Œåœ¨åœ°ç‚¹ B å‘åœ°ç‚¹ A ç§»åŠ¨ï¼‰ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612003537942.png" class="has" width="473" height="324" />
<p>1 state æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface State &#123;</span><br><span class="line">    public void stop();</span><br><span class="line">    public void move();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 çŠ¶æ€å®ä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class PlaceA implements State &#123;</span><br><span class="line"></span><br><span class="line">    private Player context;</span><br><span class="line"></span><br><span class="line">    public PlaceA(Player context) &#123;</span><br><span class="line">        this.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void move() &#123;</span><br><span class="line">        System.out.println(&quot;å¤„äºåœ°ç‚¹A,å¼€å§‹å‘Bç§»åŠ¨&quot;);</span><br><span class="line">        System.out.println(&quot;--------&quot;);</span><br><span class="line">        context.setDirection(&quot;AB&quot;);</span><br><span class="line">        context.setState(context.onMove);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        System.out.println(&quot;æ­£å¤„åœ¨åœ°ç‚¹Aï¼Œä¸ç”¨åœæ­¢ç§»åŠ¨&quot;);</span><br><span class="line">        System.out.println(&quot;--------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 context (player) æ‹¥æœ‰çŠ¶æ€çš„å¯¹è±¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class Player &#123;</span><br><span class="line"></span><br><span class="line">    State placeA;</span><br><span class="line">    State placeB;</span><br><span class="line">    State onMove;</span><br><span class="line">    private State state;</span><br><span class="line">    private String direction;</span><br><span class="line"></span><br><span class="line">    public Player() &#123;</span><br><span class="line">        direction = &quot;AB&quot;;</span><br><span class="line">        placeA = new PlaceA(this);</span><br><span class="line">        placeB = new PlaceB(this);</span><br><span class="line">        onMove = new OnMove(this);</span><br><span class="line">        this.state = placeA;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void move() &#123;</span><br><span class="line">        System.out.println(&quot;æŒ‡ä»¤:å¼€å§‹ç§»åŠ¨&quot;);</span><br><span class="line">        state.move();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        System.out.println(&quot;æŒ‡ä»¤:åœæ­¢ç§»åŠ¨&quot;);</span><br><span class="line">        state.stop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public State getState() &#123;</span><br><span class="line">        return state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(State state) &#123;</span><br><span class="line">        this.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDirection(String direction) &#123;</span><br><span class="line">        this.direction = direction;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getDirection() &#123;</span><br><span class="line">        return direction;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="-13"><a class="markdownIt-Anchor" href="#-13">#</a> </h3>
<h2 id="19-å¤‡å¿˜å½•æ¨¡å¼"><a class="markdownIt-Anchor" href="#19-å¤‡å¿˜å½•æ¨¡å¼">#</a> 19 å¤‡å¿˜å½•æ¨¡å¼</h2>
<p>å®šä¹‰ï¼š åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åå½“éœ€è¦æ—¶èƒ½å°†è¯¥å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚è¯¥æ¨¡å¼<span style="color:#b22222;">åˆå«å¿«ç…§æ¨¡å¼ã€‚</span></p>
<p>å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ã€‚</p>
<ul>
<li>
<p>æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ã€‚å½“ç”¨æˆ·éœ€è¦æ—¶èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å°†æ•°æ®æ¢å¤åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚</p>
</li>
<li>
<p>å®ç°äº†å†…éƒ¨çŠ¶æ€çš„å°è£…ã€‚é™¤äº†åˆ›å»ºå®ƒçš„å‘èµ·äººä¹‹å¤–ï¼Œå…¶ä»–å¯¹è±¡éƒ½ä¸èƒ½å¤Ÿè®¿é—®è¿™äº›çŠ¶æ€ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>ç®€åŒ–äº†å‘èµ·äººç±»ã€‚å‘èµ·äººä¸éœ€è¦ç®¡ç†å’Œä¿å­˜å…¶å†…éƒ¨çŠ¶æ€çš„å„ä¸ªå¤‡ä»½ï¼Œæ‰€æœ‰çŠ¶æ€ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¤‡å¿˜å½•ä¸­ï¼Œå¹¶ç”±ç®¡ç†è€…è¿›è¡Œç®¡ç†ï¼Œè¿™ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚</p>
</li>
</ul>
<p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šèµ„æºæ¶ˆè€—å¤§ã€‚å¦‚æœè¦ä¿å­˜çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯è¿‡å¤šæˆ–è€…ç‰¹åˆ«é¢‘ç¹ï¼Œå°†ä¼šå ç”¨æ¯”è¾ƒå¤§çš„å†…å­˜èµ„æºã€‚</p>
<h3 id="191-æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#191-æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹">#</a> 19.1 æ¨¡å¼ç»“æ„å›¾å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612143829622.png" class="has" width="564" height="405" />
<ol>
<li>
<p>å‘èµ·äººï¼ˆOriginatorï¼‰è§’è‰²ï¼šè®°å½•å½“å‰æ—¶åˆ»çš„å†…éƒ¨çŠ¶æ€ä¿¡æ¯ï¼Œæä¾›åˆ›å»ºå¤‡å¿˜å½•å’Œæ¢å¤å¤‡å¿˜å½•æ•°æ®çš„åŠŸèƒ½ï¼Œå®ç°å…¶ä»–ä¸šåŠ¡åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è®¿é—®å¤‡å¿˜å½•é‡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²ï¼šè´Ÿè´£å­˜å‚¨å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼Œåœ¨éœ€è¦çš„æ—¶å€™æä¾›è¿™äº›å†…éƒ¨çŠ¶æ€ç»™å‘èµ·äººã€‚</p>
</li>
<li>
<p>ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²ï¼šå¯¹å¤‡å¿˜å½•è¿›è¡Œç®¡ç†ï¼Œæä¾›ä¿å­˜ä¸è·å–å¤‡å¿˜å½•çš„åŠŸèƒ½ï¼Œä½†å…¶ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œè®¿é—®ä¸ä¿®æ”¹ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¾‹ï¼ˆå‘èµ·è€…é€šè¿‡å¤‡å¿˜å½•å­˜å‚¨ä¿¡æ¯å’Œè·å–ä¿¡æ¯ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612143829817.png" class="has" width="401" height="198" />
<p>1 å¤‡å¿˜å½•æ¥å£</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface MementoIF &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å¤‡å¿˜å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Memento implements MementoIF&#123;</span><br><span class="line">    </span><br><span class="line">    private String state;</span><br><span class="line"></span><br><span class="line">    public Memento(String state) &#123;</span><br><span class="line">        this.state = state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public String getState()&#123;</span><br><span class="line">        return state;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 å‘èµ·è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Originator &#123;</span><br><span class="line"></span><br><span class="line">    private String state;</span><br><span class="line"></span><br><span class="line">    public String getState() &#123;</span><br><span class="line">        return state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(String state) &#123;</span><br><span class="line">        this.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Memento saveToMemento() &#123;</span><br><span class="line">        return new Memento(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getStateFromMemento(MementoIF memento) &#123;</span><br><span class="line">        return ((Memento) memento).getState();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 ç®¡ç†è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class CareTaker &#123;</span><br><span class="line">    </span><br><span class="line">    private List&lt;MementoIF&gt; mementoList = new ArrayList&lt;MementoIF&gt;();</span><br><span class="line"></span><br><span class="line">    public void add(MementoIF memento) &#123;</span><br><span class="line">        mementoList.add(memento);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MementoIF get(int index) &#123;</span><br><span class="line">        return mementoList.get(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="20-è®¿é—®è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#20-è®¿é—®è€…æ¨¡å¼">#</a> 20 è®¿é—®è€…æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å°†ä½œç”¨äºæŸç§æ•°æ®ç»“æ„ä¸­çš„å„å…ƒç´ çš„æ“ä½œåˆ†ç¦»å‡ºæ¥å°è£…æˆç‹¬ç«‹çš„ç±»ï¼Œä½¿å…¶åœ¨ä¸æ”¹å˜æ•°æ®ç»“æ„çš„å‰æä¸‹å¯ä»¥æ·»åŠ ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ–°çš„æ“ä½œï¼Œä¸ºæ•°æ®ç»“æ„ä¸­çš„æ¯ä¸ªå…ƒç´ æä¾›å¤šç§è®¿é—®æ–¹å¼ã€‚å®ƒå°†å¯¹æ•°æ®çš„æ“ä½œä¸æ•°æ®ç»“æ„è¿›è¡Œåˆ†ç¦»ã€‚</p>
<p>è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ã€‚</p>
<ol>
<li>
<p>æ‰©å±•æ€§å¥½ã€‚èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œä¸ºå¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>å¤ç”¨æ€§å¥½ã€‚å¯ä»¥é€šè¿‡è®¿é—®è€…æ¥å®šä¹‰æ•´ä¸ªå¯¹è±¡ç»“æ„é€šç”¨çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¤ç”¨ç¨‹åº¦ã€‚</p>
</li>
<li>
<p>çµæ´»æ€§å¥½ã€‚è®¿é—®è€…æ¨¡å¼å°†æ•°æ®ç»“æ„ä¸ä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œè§£è€¦ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ç›¸å¯¹è‡ªç”±åœ°æ¼”åŒ–è€Œä¸å½±å“ç³»ç»Ÿçš„æ•°æ®ç»“æ„ã€‚</p>
</li>
<li>
<p>ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ã€‚è®¿é—®è€…æ¨¡å¼æŠŠç›¸å…³çš„è¡Œä¸ºå°è£…åœ¨ä¸€èµ·ï¼Œæ„æˆä¸€ä¸ªè®¿é—®è€…ï¼Œä½¿æ¯ä¸€ä¸ªè®¿é—®è€…çš„åŠŸèƒ½éƒ½æ¯”è¾ƒå•ä¸€ã€‚</p>
</li>
</ol>
<p>è®¿é—®è€…ï¼ˆVisitorï¼‰æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹å¦‚ä¸‹ã€‚</p>
<ol>
<li>
<p>å¢åŠ æ–°çš„å…ƒç´ ç±»å¾ˆå›°éš¾ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œæ¯å¢åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ç±»ï¼Œéƒ½è¦åœ¨æ¯ä¸€ä¸ªå…·ä½“è®¿é—®è€…ç±»ä¸­å¢åŠ ç›¸åº”çš„å…·ä½“æ“ä½œï¼Œè¿™è¿èƒŒäº† â€œå¼€é—­åŸåˆ™â€ã€‚</p>
</li>
<li>
<p>ç ´åå°è£…ã€‚è®¿é—®è€…æ¨¡å¼ä¸­å…·ä½“å…ƒç´ å¯¹è®¿é—®è€…å…¬å¸ƒç»†èŠ‚ï¼Œè¿™ç ´åäº†å¯¹è±¡çš„å°è£…æ€§ã€‚</p>
</li>
<li>
<p>è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™ã€‚è®¿é—®è€…æ¨¡å¼ä¾èµ–äº†å…·ä½“ç±»ï¼Œè€Œæ²¡æœ‰ä¾èµ–æŠ½è±¡ç±»ã€‚</p>
</li>
</ol>
<h3 id="201-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#201-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 20.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612154308216.gif" class="has" width="500" height="443" />
<p>è®¿é—®è€…æ¨¡å¼åŒ…å«ä»¥ä¸‹ä¸»è¦è§’è‰²ã€‚</p>
<ol>
<li>
<p>æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰è§’è‰²ï¼šå®šä¹‰ä¸€ä¸ªè®¿é—®å…·ä½“å…ƒç´ çš„æ¥å£ï¼Œä¸ºæ¯ä¸ªå…·ä½“å…ƒç´ ç±»å¯¹åº”ä¸€ä¸ªè®¿é—®æ“ä½œ visit () ï¼Œè¯¥æ“ä½œä¸­çš„å‚æ•°ç±»å‹æ ‡è¯†äº†è¢«è®¿é—®çš„å…·ä½“å…ƒç´ ã€‚</p>
</li>
<li>
<p>å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡è®¿é—®è€…è§’è‰²ä¸­å£°æ˜çš„å„ä¸ªè®¿é—®æ“ä½œï¼Œç¡®å®šè®¿é—®è€…è®¿é—®ä¸€ä¸ªå…ƒç´ æ—¶è¯¥åšä»€ä¹ˆã€‚</p>
</li>
<li>
<p>æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰è§’è‰²ï¼šå£°æ˜ä¸€ä¸ªåŒ…å«æ¥å—æ“ä½œ accept () çš„æ¥å£ï¼Œè¢«æ¥å—çš„è®¿é—®è€…å¯¹è±¡ä½œä¸º accept () æ–¹æ³•çš„å‚æ•°ã€‚</p>
</li>
<li>
<p>å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰è§’è‰²ï¼šå®ç°æŠ½è±¡å…ƒç´ è§’è‰²æä¾›çš„ accept () æ“ä½œï¼Œå…¶æ–¹æ³•ä½“é€šå¸¸éƒ½æ˜¯ visitor.visit (this) ï¼Œå¦å¤–å…·ä½“å…ƒç´ ä¸­å¯èƒ½è¿˜åŒ…å«æœ¬èº«ä¸šåŠ¡é€»è¾‘çš„ç›¸å…³æ“ä½œã€‚</p>
</li>
<li>
<p>å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰è§’è‰²ï¼šæ˜¯ä¸€ä¸ªåŒ…å«å…ƒç´ è§’è‰²çš„å®¹å™¨ï¼Œæä¾›è®©è®¿é—®è€…å¯¹è±¡éå†å®¹å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ çš„æ–¹æ³•ï¼Œé€šå¸¸ç”± Listã€Setã€Map ç­‰èšåˆç±»å®ç°ã€‚</p>
</li>
</ol>
<p>1 æŠ½è±¡è®¿é—®è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface Visitor &#123;</span><br><span class="line"></span><br><span class="line">    abstract public void Visit(Element element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å…·ä½“è®¿é—®è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class CompensationVisitor implements Visitor &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void Visit(Element element) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        Employee employee = ((Employee) element);</span><br><span class="line"></span><br><span class="line">        System.out.println(</span><br><span class="line">                employee.getName() + &quot;&#x27;s Compensation is &quot; + (employee.getDegree() * employee.getVacationDays() * 10));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 æŠ½è±¡å…ƒç´ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface Element &#123;</span><br><span class="line">    abstract public void Accept(Visitor visitor);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 å…·ä½“å…ƒç´ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class CompensationVisitor implements Visitor &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void Visit(Element element) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        Employee employee = ((Employee) element);</span><br><span class="line"></span><br><span class="line">        System.out.println(</span><br><span class="line">                employee.getName() + &quot;&#x27;s Compensation is &quot; + (employee.getDegree() * employee.getVacationDays() * 10));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5 å¯¹è±¡ç»“æ„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public class ObjectStructure &#123;</span><br><span class="line">    private HashMap&lt;String, Employee&gt; employees;</span><br><span class="line"></span><br><span class="line">    public ObjectStructure() &#123;</span><br><span class="line">        employees = new HashMap();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Attach(Employee employee) &#123;</span><br><span class="line">        employees.put(employee.getName(), employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Detach(Employee employee) &#123;</span><br><span class="line">        employees.remove(employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Employee getEmployee(String name) &#123;</span><br><span class="line">        return employees.get(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void Accept(Visitor visitor) &#123;</span><br><span class="line">        for (Employee e : employees.values()) &#123;</span><br><span class="line">            e.Accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="-14"><a class="markdownIt-Anchor" href="#-14">#</a> </h3>
<h2 id="21-ä¸­ä»‹è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#21-ä¸­ä»‹è€…æ¨¡å¼">#</a> 21 ä¸­ä»‹è€…æ¨¡å¼</h2>
<p>** å®šä¹‰ï¼š** å®šä¹‰ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œä½¿åŸæœ‰å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ¾æ•£ï¼Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…æ¨¡å¼åˆå«è°ƒåœæ¨¡å¼ï¼Œå®ƒæ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„å…¸å‹åº”ç”¨ã€‚</p>
<p>ä¸­ä»‹è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡è¡Œä¸ºå‹æ¨¡å¼ï¼Œå…¶ä¸»è¦ä¼˜ç‚¹å¦‚ä¸‹ã€‚</p>
<ol>
<li>
<p>é™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§ï¼Œä½¿å¾—å¯¹è±¡æ˜“äºç‹¬ç«‹åœ°è¢«å¤ç”¨ã€‚</p>
</li>
<li>
<p>å°†å¯¹è±¡é—´çš„ä¸€å¯¹å¤šå…³è”è½¬å˜ä¸ºä¸€å¯¹ä¸€çš„å…³è”ï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ï¼Œä½¿å¾—ç³»ç»Ÿæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</p>
</li>
</ol>
<p>å…¶ä¸»è¦ç¼ºç‚¹æ˜¯ï¼šå½“åŒäº‹ç±»å¤ªå¤šæ—¶ï¼Œä¸­ä»‹è€…çš„èŒè´£å°†å¾ˆå¤§ï¼Œå®ƒä¼šå˜å¾—å¤æ‚è€Œåºå¤§ï¼Œä»¥è‡³äºç³»ç»Ÿéš¾ä»¥ç»´æŠ¤ã€‚</p>
<h3 id="211-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹"><a class="markdownIt-Anchor" href="#211-æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹">#</a> 21.1 æ¨¡å¼ç»“æ„å’Œä»£ç ç¤ºä¾‹</h3>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612175348613.png" class="has" width="803" height="457" />
<ol>
<li>
<p>æŠ½è±¡ä¸­ä»‹è€…ï¼ˆMediatorï¼‰è§’è‰²ï¼šå®ƒæ˜¯ä¸­ä»‹è€…çš„æ¥å£ï¼Œæä¾›äº†åŒäº‹å¯¹è±¡æ³¨å†Œä¸è½¬å‘åŒäº‹å¯¹è±¡ä¿¡æ¯çš„æŠ½è±¡æ–¹æ³•ã€‚</p>
</li>
<li>
<p>å…·ä½“ä¸­ä»‹è€…ï¼ˆConcreteMediatorï¼‰è§’è‰²ï¼šå®ç°ä¸­ä»‹è€…æ¥å£ï¼Œå®šä¹‰ä¸€ä¸ª List æ¥ç®¡ç†åŒäº‹å¯¹è±¡ï¼Œåè°ƒå„ä¸ªåŒäº‹è§’è‰²ä¹‹é—´çš„äº¤äº’å…³ç³»ï¼Œå› æ­¤å®ƒä¾èµ–äºåŒäº‹è§’è‰²ã€‚</p>
</li>
<li>
<p>æŠ½è±¡åŒäº‹ç±»ï¼ˆColleagueï¼‰è§’è‰²ï¼šå®šä¹‰åŒäº‹ç±»çš„æ¥å£ï¼Œä¿å­˜ä¸­ä»‹è€…å¯¹è±¡ï¼Œæä¾›åŒäº‹å¯¹è±¡äº¤äº’çš„æŠ½è±¡æ–¹æ³•ï¼Œå®ç°æ‰€æœ‰ç›¸äº’å½±å“çš„åŒäº‹ç±»çš„å…¬å…±åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>å…·ä½“åŒäº‹ç±»ï¼ˆConcrete Colleagueï¼‰è§’è‰²ï¼šæ˜¯æŠ½è±¡åŒäº‹ç±»çš„å®ç°è€…ï¼Œå½“éœ€è¦ä¸å…¶ä»–åŒäº‹å¯¹è±¡äº¤äº’æ—¶ï¼Œç”±ä¸­ä»‹è€…å¯¹è±¡è´Ÿè´£åç»­çš„äº¤äº’ã€‚</p>
</li>
</ol>
<p>ä¸¾ä¾‹ï¼ˆé€šè¿‡ä¸­ä»‹å–æ–¹ï¼‰ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20190612175348612.png" class="has" width="577" height="290" />
<p>1 æŠ½è±¡ä¸­ä»‹è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public interface Mediator &#123;</span><br><span class="line"></span><br><span class="line">    void register(Colleague colleague); // å®¢æˆ·æ³¨å†Œ</span><br><span class="line"></span><br><span class="line">    void relay(String from, String to,String ad); // è½¬å‘</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2 å…·ä½“ä¸­ä»‹è€…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class ConcreteMediator implements Mediator &#123;</span><br><span class="line"></span><br><span class="line">    private List&lt;Colleague&gt; colleagues = new ArrayList&lt;Colleague&gt;();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void register(Colleague colleague) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        if (!colleagues.contains(colleague)) &#123;</span><br><span class="line">            colleagues.add(colleague);</span><br><span class="line">            colleague.setMedium(this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void relay(String from, String to, String ad) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        for (Colleague cl : colleagues) &#123;</span><br><span class="line"></span><br><span class="line">            String name = cl.getName();</span><br><span class="line">            if (name.equals(to)) &#123;</span><br><span class="line">                cl.receive(from, ad);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3 æŠ½è±¡åŒäº‹ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Colleague &#123;</span><br><span class="line"></span><br><span class="line">    protected Mediator mediator;</span><br><span class="line">    protected String name;</span><br><span class="line"></span><br><span class="line">    public Colleague(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMedium(Mediator mediator) &#123;</span><br><span class="line"></span><br><span class="line">        this.mediator = mediator;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void Send(String to, String ad);</span><br><span class="line"></span><br><span class="line">    public abstract void receive(String from, String ad);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4 å…·ä½“åŒäº‹ç±»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class Buyer extends Colleague &#123;</span><br><span class="line"></span><br><span class="line">    public Buyer(String name) &#123;</span><br><span class="line"></span><br><span class="line">        super(name);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void Send(String to, String ad) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        mediator.relay(name, to, ad);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void receive(String from, String ad) &#123;</span><br><span class="line">        // TODO Auto-generated method stub</span><br><span class="line">        System.out.println(name + &quot;æ¥æ”¶åˆ°æ¥è‡ª&quot; + from + &quot;çš„æ¶ˆæ¯:&quot; + ad);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:49.000Z" title="2023-4-27 17:20:49">2023-04-27</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-04-27T09:21:31.402Z" title="2023-4-27 17:21:31">2023-04-27</time>æ›´æ–°</span><span class="level-item">32 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦4825ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90MySql%E3%80%9121%E4%B8%AAMySQL%E8%A1%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%87%86%E5%88%99/">ã€MySqlã€‘21ä¸ªMySQLè¡¨è®¾è®¡çš„ç»éªŒå‡†åˆ™</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="mysql21ä¸ªmysqlè¡¨è®¾è®¡çš„ç»éªŒå‡†åˆ™"><a class="markdownIt-Anchor" href="#mysql21ä¸ªmysqlè¡¨è®¾è®¡çš„ç»éªŒå‡†åˆ™">#</a> ã€MySqlã€‘21 ä¸ª MySQL è¡¨è®¾è®¡çš„ç»éªŒå‡†åˆ™</h2>
<div id="content_views" class="markdown_views prism-atom-one-dark"> 
 <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
 </svg> 
 <h2><a id="1_0"></a>1.å‘½åè§„èŒƒ</h2> 
 <p>æ•°æ®åº“è¡¨åã€å­—æ®µåã€ç´¢å¼•åç­‰éƒ½éœ€è¦å‘½åè§„èŒƒï¼Œå¯è¯»æ€§é«˜(ä¸€èˆ¬è¦æ±‚ç”¨è‹±æ–‡)ï¼Œè®©åˆ«äººä¸€çœ‹å‘½åï¼Œå°±çŸ¥é“è¿™ä¸ªå­—æ®µè¡¨ç¤ºä»€ä¹ˆæ„æ€ã€‚</p> 
 <p>æ¯”å¦‚ä¸€ä¸ªè¡¨çš„è´¦å·å­—æ®µï¼Œ<strong>åä¾‹å¦‚ä¸‹</strong>ï¼š</p> 
 <pre><code>acc_no,1_acc_no,zhanghao
</code></pre> 
 <p><strong>æ­£ä¾‹ï¼š</strong></p> 
 <pre><code>account_no,account_number
</code></pre> 
 <ul>
  <li>è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯æˆ–è€…æ•°å­—ï¼Œç¦æ­¢ä½¿ç”¨æ•°å­—å¼€å¤´ï¼Œç¦æ­¢ä½¿ç”¨æ‹¼éŸ³ï¼Œå¹¶ä¸”ä¸€èˆ¬ä¸ä½¿ç”¨è‹±æ–‡ç¼©å†™ã€‚</li>
  <li>ä¸»é”®ç´¢å¼•åä¸º<code>pk_å­—æ®µå</code>ï¼›å”¯ä¸€ç´¢å¼•åä¸º<code>uk_å­—æ®µå</code>ï¼›æ™®é€šç´¢å¼•ååˆ™ä¸º<code>idx_å­—æ®µå</code>ã€‚</li>
 </ul> 
 <h2><a id="2_18"></a>2.é€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹</h2> 
 <p>è®¾è®¡è¡¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©åˆé€‚çš„å­—æ®µç±»å‹ï¼Œæ¯”å¦‚ï¼š</p> 
 <ul>
  <li>å°½å¯èƒ½é€‰æ‹©å­˜å‚¨ç©ºé—´å°çš„å­—æ®µç±»å‹ï¼Œå°±å¥½åƒæ•°å­—ç±»å‹çš„ï¼Œä»<code>tinyintã€smallintã€intã€bigint</code>ä»å·¦å¾€å³å¼€å§‹é€‰æ‹©</li>
  <li>å°æ•°ç±»å‹å¦‚é‡‘é¢ï¼Œåˆ™é€‰æ‹© <code>decimal</code>ï¼Œç¦æ­¢ä½¿ç”¨ <code>float</code> å’Œ <code>double</code>ã€‚</li>
  <li>å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å‡ ä¹ç›¸ç­‰ï¼Œä½¿ç”¨ <code>char</code> å®šé•¿å­—ç¬¦ä¸²ç±»å‹ã€‚</li>
  <li><code>varchar</code>æ˜¯å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä¸é¢„å…ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡<code>5000</code>ã€‚</li>
  <li>å¦‚æœå­˜å‚¨çš„å€¼å¤ªå¤§ï¼Œå»ºè®®å­—æ®µç±»å‹ä¿®æ”¹ä¸º<code>text</code>ï¼ŒåŒæ—¶æŠ½å‡ºå•ç‹¬ä¸€å¼ è¡¨ï¼Œç”¨ä¸»é”®ä¸ä¹‹å¯¹åº”ã€‚</li>
  <li>åŒä¸€è¡¨ä¸­ï¼Œæ‰€æœ‰<code>varchar</code>å­—æ®µçš„é•¿åº¦åŠ èµ·æ¥ï¼Œä¸èƒ½å¤§äº<code>65535</code>. å¦‚æœæœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè¯·ä½¿ç”¨<code>TEXT/LONGTEXT</code> ç±»å‹ã€‚</li>
 </ul> 
 <h2><a id="3__29"></a>3. ä¸»é”®è®¾è®¡è¦åˆç†</h2> 
 <p>ä¸»é”®è®¾è®¡çš„è¯ï¼Œæœ€å¥½ä¸è¦ä¸ä¸šåŠ¡é€»è¾‘æœ‰æ‰€å…³è”ã€‚æœ‰äº›ä¸šåŠ¡ä¸Šçš„å­—æ®µï¼Œæ¯”å¦‚èº«ä»½è¯ï¼Œè™½ç„¶æ˜¯å”¯ä¸€çš„ï¼Œä¸€äº›å¼€å‘è€…å–œæ¬¢ç”¨å®ƒæ¥åšä¸»é”®ï¼Œä½†æ˜¯ä¸æ˜¯å¾ˆå»ºè®®å“ˆã€‚ä¸»é”®æœ€å¥½æ˜¯æ¯«æ— æ„ä¹‰çš„ä¸€ä¸²ç‹¬ç«‹ä¸é‡å¤çš„æ•°å­—ï¼Œæ¯”å¦‚<code>UUID</code>ï¼Œåˆæˆ–è€…<code>Auto_increment</code>è‡ªå¢çš„ä¸»é”®ï¼Œæˆ–è€…æ˜¯é›ªèŠ±ç®—æ³•ç”Ÿæˆçš„ä¸»é”®ç­‰ç­‰;</p> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/ccd1bc85b0ee0b89a50656597486178d.png" alt=""></p> 
 <h2><a id="4__35"></a>4. é€‰æ‹©åˆé€‚çš„å­—æ®µé•¿åº¦</h2> 
 <p>å…ˆé—®å¤§å®¶ä¸€ä¸ªé—®é¢˜ï¼Œå¤§å®¶çŸ¥é“æ•°æ®åº“å­—æ®µé•¿åº¦è¡¨ç¤º<strong>å­—ç¬¦é•¿åº¦</strong>è¿˜æ˜¯<strong>å­—èŠ‚é•¿åº¦</strong>å˜›ï¼Ÿ</p> 
 <blockquote> 
  <p>å…¶å®åœ¨mysqlä¸­ï¼Œ<code>varchar</code>å’Œ<code>char</code>ç±»å‹è¡¨ç¤ºå­—ç¬¦é•¿åº¦ï¼Œè€Œå…¶ä»–ç±»å‹è¡¨ç¤ºçš„é•¿åº¦éƒ½è¡¨ç¤ºå­—èŠ‚é•¿åº¦ã€‚æ¯”å¦‚<code>char(10)</code>è¡¨ç¤ºå­—ç¬¦é•¿åº¦æ˜¯10ï¼Œè€Œ<code>bigintï¼ˆ4ï¼‰</code>è¡¨ç¤ºæ˜¾ç¤ºé•¿åº¦æ˜¯<code>4</code>ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å› ä¸ºbigintå®é™…é•¿åº¦æ˜¯<code>8</code>ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥bigintï¼ˆ4ï¼‰çš„å®é™…é•¿åº¦å°±æ˜¯8ä¸ªå­—èŠ‚ã€‚</p> 
 </blockquote> 
 <p>æˆ‘ä»¬åœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œéœ€è¦å……åˆ†è€ƒè™‘ä¸€ä¸ªå­—æ®µçš„é•¿åº¦ï¼Œæ¯”å¦‚ä¸€ä¸ªç”¨æˆ·åå­—æ®µï¼ˆå®ƒçš„é•¿åº¦5~20ä¸ªå­—ç¬¦ï¼‰ï¼Œä½ è§‰å¾—åº”è¯¥è®¾ç½®å¤šé•¿å‘¢ï¼Ÿå¯ä»¥è€ƒè™‘è®¾ç½®ä¸º <code>username varcharï¼ˆ32ï¼‰</code>ã€‚å­—æ®µé•¿åº¦ä¸€èˆ¬è®¾ç½®ä¸º2çš„å¹‚å“ˆï¼ˆä¹Ÿå°±æ˜¯<code>2çš„n</code>æ¬¡æ–¹ï¼‰ã€‚â€™;</p> 
 <h2><a id="5_43"></a>5ï¼Œä¼˜å…ˆè€ƒè™‘é€»è¾‘åˆ é™¤ï¼Œè€Œä¸æ˜¯ç‰©ç†åˆ é™¤</h2> 
 <p>ä»€ä¹ˆæ˜¯ç‰©ç†åˆ é™¤ï¼Ÿä»€ä¹ˆæ˜¯é€»è¾‘åˆ é™¤ï¼Ÿ</p> 
 <ul>
  <li>ç‰©ç†åˆ é™¤ï¼šæŠŠæ•°æ®ä»ç¡¬ç›˜ä¸­åˆ é™¤ï¼Œå¯é‡Šæ”¾å­˜å‚¨ç©ºé—´</li>
  <li>é€»è¾‘åˆ é™¤ï¼šç»™æ•°æ®æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚<code>is_deleted</code>ï¼Œä»¥æ ‡è®°è¯¥æ•°æ®å·²ç»é€»è¾‘åˆ é™¤ã€‚</li>
 </ul> 
 <p>ç‰©ç†åˆ é™¤å°±æ˜¯æ‰§è¡Œ<code>delete</code>è¯­å¥ï¼Œå¦‚åˆ é™¤<code>account_no =â€˜666â€™</code>çš„è´¦æˆ·ä¿¡æ¯SQLå¦‚ä¸‹ï¼š</p> 
 <pre><code>delete from account_info_tab whereaccount_no ='666';
</code></pre> 
 <p>é€»è¾‘åˆ é™¤å‘¢ï¼Œå°±æ˜¯è¿™æ ·ï¼š</p> 
 <pre><code>update account_info_tab set is_deleted = 1 where account_no ='666';
</code></pre> 
 <p><strong>ä¸ºä»€ä¹ˆæ¨èç”¨é€»è¾‘åˆ é™¤ï¼Œä¸æ¨èç‰©ç†åˆ é™¤å‘¢ï¼Ÿ</strong></p> 
 <blockquote> 
  <ul>
   <li>ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨ç‰©ç†åˆ é™¤ï¼Œå› ä¸ºæ¢å¤æ•°æ®å¾ˆå›°éš¾</li>
   <li>ç‰©ç†åˆ é™¤ä¼šä½¿è‡ªå¢ä¸»é”®ä¸å†è¿ç»­</li>
   <li>æ ¸å¿ƒä¸šåŠ¡è¡¨ çš„æ•°æ®ä¸å»ºè®®åšç‰©ç†åˆ é™¤ï¼Œåªé€‚åˆåšçŠ¶æ€å˜æ›´ã€‚</li>
  </ul> 
 </blockquote> 
 <h2><a id="6_create_timemodifed_time_66"></a>6. æ¯ä¸ªè¡¨éƒ½éœ€è¦æ·»åŠ è¿™å‡ ä¸ªé€šç”¨å­—æ®µå¦‚ä¸»é”®ã€create_timeã€modifed_timeç­‰</h2> 
 <p>è¡¨å¿…å¤‡ä¸€èˆ¬æ¥è¯´ï¼Œæˆ–å…·å¤‡è¿™å‡ ä¸ªå­—æ®µï¼š</p> 
 <ul>
  <li>idï¼šä¸»é”®ï¼Œä¸€ä¸ªè¡¨å¿…é¡»å¾—æœ‰ä¸»é”®ï¼Œå¿…é¡»</li>
  <li>create_timeï¼šåˆ›å»ºæ—¶é—´ï¼Œå¿…é¡»</li>
  <li>modifed_time/update_time: ä¿®æ”¹æ—¶é—´ï¼Œå¿…é¡»ï¼Œæ›´æ–°è®°å½•æ—¶ï¼Œéœ€è¦æ›´æ–°å®ƒ</li>
  <li>version : æ•°æ®è®°å½•çš„ç‰ˆæœ¬å·ï¼Œç”¨äºä¹è§‚é”ï¼Œéå¿…é¡»</li>
  <li>remark ï¼šæ•°æ®è®°å½•å¤‡æ³¨ï¼Œéå¿…é¡»</li>
  <li>modified_by :ä¿®æ”¹äººï¼Œéå¿…é¡»</li>
  <li>creator ï¼šåˆ›å»ºäººï¼Œéå¿…é¡»</li>
 </ul> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/5c0c0ff67e3189ae7899070386491415.png" alt=""></p> 
 <h2><a id="7__80"></a>7. ä¸€å¼ è¡¨çš„å­—æ®µä¸å®œè¿‡å¤š</h2> 
 <p>æˆ‘ä»¬å»ºè¡¨çš„æ—¶å€™ï¼Œè¦ç‰¢è®°ï¼Œä¸€å¼ è¡¨çš„å­—æ®µä¸å®œè¿‡å¤šå“ˆï¼Œä¸€èˆ¬å°½é‡ä¸è¦è¶…è¿‡20ä¸ªå­—æ®µå“ˆã€‚ç¬”è€…è®°å¾—ä¸Šä¸ªå…¬å¸ï¼Œæœ‰ä¼™ä¼´è®¾è®¡å¼€æˆ·è¡¨ï¼ŒåŠ äº†äº”åå¤šä¸ªå­—æ®µã€‚ã€‚ã€‚</p> 
 <p>å¦‚æœä¸€å¼ è¡¨çš„å­—æ®µè¿‡å¤šï¼Œè¡¨ä¸­ä¿å­˜çš„æ•°æ®å¯èƒ½å°±ä¼šå¾ˆå¤§ï¼ŒæŸ¥è¯¢æ•ˆç‡å°±ä¼šå¾ˆä½ã€‚å› æ­¤ï¼Œä¸€å¼ è¡¨ä¸è¦è®¾è®¡å¤ªå¤šå­—æ®µå“ˆï¼Œå¦‚æœä¸šåŠ¡éœ€æ±‚ï¼Œå®åœ¨éœ€è¦å¾ˆå¤šå­—æ®µï¼Œå¯ä»¥æŠŠä¸€å¼ å¤§çš„è¡¨ï¼Œæ‹†æˆå¤šå¼ å°çš„è¡¨ï¼Œå®ƒä»¬çš„ä¸»é”®ç›¸åŒå³å¯ã€‚</p> 
 <p>å½“è¡¨çš„å­—æ®µæ•°éå¸¸å¤šæ—¶ï¼Œå¯ä»¥å°†è¡¨åˆ†æˆä¸¤å¼ è¡¨ï¼Œä¸€å¼ ä½œä¸ºæ¡ä»¶æŸ¥è¯¢è¡¨ï¼Œä¸€å¼ ä½œä¸ºè¯¦ç»†å†…å®¹è¡¨ (ä¸»è¦æ˜¯ä¸ºäº†æ€§èƒ½è€ƒè™‘)ã€‚</p> 
 <h2><a id="8_not_null_88"></a>8. å°½å¯èƒ½ä½¿ç”¨not nullå®šä¹‰å­—æ®µ</h2> 
 <p>å¦‚æœæ²¡æœ‰ç‰¹æ®Šçš„ç†ç”±ï¼Œ ä¸€èˆ¬éƒ½å»ºè®®å°†å­—æ®µå®šä¹‰ä¸º <code>NOT NULL</code> ã€‚</p> 
 <p><strong>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</strong></p> 
 <ul>
  <li>é¦–å…ˆï¼Œ <code>NOT NULL</code> å¯ä»¥é˜²æ­¢å‡ºç°ç©ºæŒ‡é’ˆé—®é¢˜ã€‚</li>
  <li>å…¶æ¬¡ï¼Œ<code>NULL</code>å€¼å­˜å‚¨ä¹Ÿéœ€è¦é¢å¤–çš„ç©ºé—´çš„ï¼Œå®ƒä¹Ÿä¼šå¯¼è‡´æ¯”è¾ƒè¿ç®—æ›´ä¸ºå¤æ‚ï¼Œä½¿ä¼˜åŒ–å™¨éš¾ä»¥ä¼˜åŒ–SQLã€‚</li>
  <li><code>NULL</code>å€¼æœ‰å¯èƒ½ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
  <li>å¦‚æœå°†å­—æ®µé»˜è®¤è®¾ç½®æˆä¸€ä¸ªç©ºå­—ç¬¦ä¸²æˆ–å¸¸é‡å€¼å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä¸”éƒ½ä¸ä¼šå½±å“åˆ°åº”ç”¨é€»è¾‘ï¼Œ é‚£å°±å¯ä»¥å°†è¿™ä¸ªå­—æ®µè®¾ç½®ä¸º<code>NOT NULL</code>ã€‚</li>
 </ul> 
 <h2><a id="9__99"></a>9. è®¾è®¡è¡¨æ—¶ï¼Œè¯„ä¼°å“ªäº›å­—æ®µéœ€è¦åŠ ç´¢å¼•</h2> 
 <p>é¦–å…ˆï¼Œè¯„ä¼°ä½ çš„è¡¨æ•°æ®é‡ã€‚å¦‚æœä½ çš„è¡¨æ•°æ®é‡åªæœ‰ä¸€ç™¾å‡ åè¡Œï¼Œå°±æ²¡æœ‰å¿…è¦åŠ ç´¢å¼•ã€‚å¦åˆ™è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œå¦‚æœæœ‰æŸ¥è¯¢æ¡ä»¶çš„å­—æ®µï¼Œä¸€èˆ¬å°±éœ€è¦å»ºç«‹ç´¢å¼•ã€‚ä½†æ˜¯ç´¢å¼•ä¹Ÿä¸èƒ½æ»¥ç”¨ï¼š</p> 
 <ul>
  <li>ç´¢å¼•ä¹Ÿä¸è¦å»ºå¾—å¤ªå¤šï¼Œä¸€èˆ¬å•è¡¨ç´¢å¼•ä¸ªæ•°ä¸è¦è¶…è¿‡<code>5</code>ä¸ªã€‚å› ä¸ºåˆ›å»ºè¿‡å¤šçš„ç´¢å¼•ï¼Œä¼šé™ä½å†™å¾—é€Ÿåº¦ã€‚</li>
  <li>åŒºåˆ†åº¦ä¸é«˜çš„å­—æ®µï¼Œä¸èƒ½åŠ ç´¢å¼•ï¼Œå¦‚æ€§åˆ«ç­‰</li>
  <li>ç´¢å¼•åˆ›å»ºå®Œåï¼Œè¿˜æ˜¯è¦æ³¨æ„é¿å…ç´¢å¼•å¤±æ•ˆçš„æƒ…å†µï¼Œå¦‚ä½¿ç”¨mysqlçš„å†…ç½®å‡½æ•°ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆçš„</li>
  <li>ç´¢å¼•è¿‡å¤šçš„è¯ï¼Œå¯ä»¥é€šè¿‡è”åˆç´¢å¼•çš„è¯æ–¹å¼æ¥ä¼˜åŒ–ã€‚ç„¶åçš„è¯ï¼Œç´¢å¼•è¿˜æœ‰ä¸€äº›è§„åˆ™ï¼Œå¦‚è¦†ç›–ç´¢å¼•ï¼Œæœ€å·¦åŒ¹é…åŸåˆ™ç­‰ç­‰ã€‚ã€‚</li>
 </ul> 
 <p>å‡è®¾ä½ æ–°å»ºä¸€å¼ ç”¨æˆ·è¡¨ï¼Œå¦‚ä¸‹ï¼š</p> 
 <pre><code>CREATE TABLE user_info_tab (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `age` int(11) DEFAULT NULL,
  `name` varchar(255) NOT NULL,
  `create_time` datetime NOT NULL,
  `modifed_time` datetime NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre> 
 <p>å¯¹äºè¿™å¼ è¡¨ï¼Œå¾ˆå¯èƒ½ä¼šæœ‰æ ¹æ®<code>user_id</code>æˆ–è€…<code>name</code>æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¹¶ä¸”ï¼Œ<code>user_id</code>æ˜¯å”¯ä¸€çš„ã€‚å› æ­¤ï¼Œä½ æ˜¯å¯ä»¥ç»™<code>user_id</code>åŠ ä¸Šå”¯ä¸€ç´¢å¼•ï¼Œ<code>name</code>åŠ ä¸Šæ™®é€šç´¢å¼•ã€‚</p> 
 <pre><code>CREATE TABLE user_info_tab (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `user_id` int(11) NOT NULL,
  `age` int(11) DEFAULT NULL,
  `name` varchar(255) NOT NULL,
  `create_time` datetime NOT NULL,
  `modifed_time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`) USING BTREE,
  UNIQUE KEY un_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre> 
 <h2><a id="10__3NF_138"></a>10. ä¸éœ€è¦ä¸¥æ ¼éµå®ˆ 3NFï¼Œé€šè¿‡ä¸šåŠ¡å­—æ®µå†—ä½™æ¥å‡å°‘è¡¨å…³è”</h2> 
 <p>ä»€ä¹ˆæ˜¯æ•°æ®åº“ä¸‰èŒƒå¼ï¼ˆ<code>3NF</code>ï¼‰ï¼Œå¤§å®¶æ˜¯å¦è¿˜æœ‰å°è±¡å—ï¼Ÿ</p> 
 <ul>
  <li>ç¬¬ä¸€èŒƒå¼ï¼šå¯¹å±æ€§çš„åŸå­æ€§ï¼Œè¦æ±‚å±æ€§å…·æœ‰åŸå­æ€§ï¼Œä¸å¯å†åˆ†è§£ï¼›</li>
  <li>ç¬¬äºŒèŒƒå¼ï¼šå¯¹è®°å½•çš„å”¯ä¸€æ€§ï¼Œè¦æ±‚è®°å½•æœ‰å”¯ä¸€æ ‡è¯†ï¼Œå³å®ä½“çš„å”¯ä¸€æ€§ï¼Œå³ä¸å­˜åœ¨éƒ¨åˆ†ä¾èµ–ï¼›</li>
  <li>ç¬¬ä¸‰æ–¹å¼ï¼šå¯¹å­—æ®µçš„å†—ä½™æ€§ï¼Œè¦æ±‚ä»»ä½•å­—æ®µä¸èƒ½ç”±å…¶ä»–å­—æ®µæ´¾ç”Ÿå‡ºæ¥ï¼Œå®ƒè¦æ±‚å­—æ®µæ²¡æœ‰å†—ä½™ï¼Œå³ä¸å­˜åœ¨ä¼ é€’ä¾èµ–ï¼›</li>
 </ul> 
 <p>æˆ‘ä»¬è®¾è®¡è¡¨åŠå…¶å­—æ®µä¹‹é—´çš„å…³ç³», åº”å°½é‡æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¯ä»¥é€‚å½“å†—ä½™ï¼Œæ¥æé«˜æ•ˆç‡ã€‚æ¯”å¦‚ä»¥ä¸‹è¿™å¼ è¡¨</p> 
 <table>
  <thead>
   <tr>
    <th>å•†å“åç§°</th>
    <th>å•†å“å‹å·</th>
    <th>å•ä»·</th>
    <th>æ•°é‡</th>
    <th>æ€»é‡‘é¢</th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td>æ‰‹æœº</td>
    <td>åä¸º</td>
    <td>8000</td>
    <td>5</td>
    <td>40000</td>
   </tr>
  </tbody>
 </table> 
 <p>ä»¥ä¸Šè¿™å¼ å­˜æ”¾å•†å“ä¿¡æ¯çš„åŸºæœ¬è¡¨ã€‚<code>æ€»é‡‘é¢</code>è¿™ä¸ªå­—æ®µçš„å­˜åœ¨ï¼Œè¡¨æ˜è¯¥è¡¨çš„è®¾è®¡ä¸æ»¡è¶³ç¬¬ä¸‰èŒƒå¼ï¼Œå› ä¸º<code>æ€»é‡‘é¢</code>å¯ä»¥ç”±<code>å•ä»·*æ•°é‡</code>å¾—åˆ°ï¼Œè¯´æ˜<code>æ€»é‡‘é¢</code>æ˜¯å†—ä½™å­—æ®µã€‚ä½†æ˜¯ï¼Œå¢åŠ <code>æ€»é‡‘é¢</code>è¿™ä¸ªå†—ä½™å­—æ®µï¼Œå¯ä»¥æé«˜æŸ¥è¯¢ç»Ÿè®¡çš„é€Ÿåº¦ï¼Œè¿™å°±æ˜¯ä»¥ç©ºé—´æ¢æ—¶é—´çš„ä½œæ³•ã€‚</p> 
 <p>å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸ªå°ä¾‹å­å“ˆï¼Œå¤§å®¶å¼€å‘è®¾è®¡çš„æ—¶å€™ï¼Œè¦ç»“åˆå…·ä½“ä¸šåŠ¡åˆ†æå“ˆã€‚</p> 
 <h2><a id="11_MySQL_156"></a>11. é¿å…ä½¿ç”¨MySQLä¿ç•™å­—</h2> 
 <p>å¦‚æœåº“åã€è¡¨åã€å­—æ®µåç­‰å±æ€§å«æœ‰ä¿ç•™å­—æ—¶ï¼Œ<code>SQL</code>è¯­å¥å¿…é¡»ç”¨åå¼•å·æ¥å¼•ç”¨å±æ€§åç§°ï¼Œè¿™å°†ä½¿å¾—SQLè¯­å¥ä¹¦å†™ã€SHELLè„šæœ¬ä¸­å˜é‡çš„è½¬ä¹‰ç­‰å˜å¾—éå¸¸å¤æ‚ã€‚</p> 
 <p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸€èˆ¬é¿å…ä½¿ç”¨<code>MySQL</code>ä¿ç•™å­—ï¼Œå¦‚<code>selectã€intervalã€desc</code>ç­‰ç­‰</p> 
 <h2><a id="12__162"></a>12. ä¸æå¤–é”®å…³è”ï¼Œä¸€èˆ¬éƒ½åœ¨ä»£ç ç»´æŠ¤</h2> 
 <p>ä»€ä¹ˆæ˜¯å¤–é”®å‘¢ï¼Ÿ</p> 
 <blockquote> 
  <p>å¤–é”®ï¼Œä¹Ÿå«<code>FOREIGN KEY</code>ï¼Œå®ƒæ˜¯ç”¨äºå°†ä¸¤ä¸ªè¡¨è¿æ¥åœ¨ä¸€èµ·çš„é”®ã€‚<code>FOREIGN KEY</code>æ˜¯ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µï¼ˆæˆ–å­—æ®µé›†åˆï¼‰ï¼Œå®ƒå¼•ç”¨å¦ä¸€ä¸ªè¡¨ä¸­çš„<code>PRIMARY KEY</code>ã€‚å®ƒæ˜¯ç”¨æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§çš„ã€‚</p> 
 </blockquote> 
 <p>é˜¿é‡Œçš„<code>Java</code>è§„èŒƒä¹Ÿæœ‰è¿™ä¹ˆä¸€æ¡ï¼š</p> 
 <blockquote> 
  <p>ã€å¼ºåˆ¶ã€‘<strong>ä¸å¾—ä½¿ç”¨å¤–é”®ä¸çº§è”</strong>ï¼Œä¸€åˆ‡å¤–é”®æ¦‚å¿µå¿…é¡»åœ¨åº”ç”¨å±‚è§£å†³ã€‚</p> 
 </blockquote> 
 <p>æˆ‘ä»¬ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨<strong>å¤–é”®</strong>å‘¢ï¼Ÿ</p> 
 <blockquote> 
  <ul>
   <li>ä½¿ç”¨å¤–é”®å­˜åœ¨æ€§èƒ½é—®é¢˜ã€å¹¶å‘æ­»é”é—®é¢˜ã€ä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿ç­‰ç­‰ã€‚æ¯æ¬¡åš<code>DELETE</code>æˆ–è€…<code>UPDATE</code>éƒ½å¿…é¡»è€ƒè™‘å¤–é”®çº¦æŸï¼Œä¼šå¯¼è‡´å¼€å‘çš„æ—¶å€™å¾ˆéš¾å—,æµ‹è¯•æ•°æ®é€ æ•°æ®ä¹Ÿä¸æ–¹ä¾¿ã€‚</li>
   <li>è¿˜æœ‰ä¸€ä¸ªåœºæ™¯ä¸èƒ½ä½¿ç”¨å¤–é”®ï¼Œå°±æ˜¯åˆ†åº“åˆ†è¡¨ã€‚</li>
  </ul> 
 </blockquote> 
 <h2><a id="13_INNODB_177"></a>13. ä¸€èˆ¬éƒ½é€‰æ‹©INNODBå­˜å‚¨å¼•æ“</h2> 
 <p>å»ºè¡¨æ˜¯éœ€è¦é€‰æ‹©<strong>å­˜å‚¨å¼•æ“</strong>çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½é€‰æ‹©<code>INNODB</code>å­˜å‚¨å¼•æ“ï¼Œé™¤éè¯»å†™æ¯”ç‡å°äº<code>1%</code>, æ‰è€ƒè™‘ä½¿ç”¨<code>MyISAM</code> ã€‚</p> 
 <p>æœ‰äº›å°ä¼™ä¼´å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼Œä¸æ˜¯è¿˜æœ‰<code>MEMORY</code>ç­‰å…¶ä»–å­˜å‚¨å¼•æ“å—ï¼Ÿä»€ä¹ˆæ—¶å€™ä½¿ç”¨å®ƒå‘¢ï¼Ÿå…¶å®å…¶ä»–å­˜å‚¨å¼•æ“ä¸€èˆ¬é™¤äº†éƒ½å»ºè®®åœ¨<code>DBA</code>çš„æŒ‡å¯¼ä¸‹ä½¿ç”¨ã€‚</p> 
 <p>æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹è¿™<code>MySQL</code>è¿™ä¸‰ç§å­˜å‚¨å¼•æ“çš„å¯¹æ¯”åŒºåˆ«å§ï¼š</p> 
 <table>
  <thead>
   <tr>
    <th>ç‰¹æ€§</th>
    <th>INNODB</th>
    <th>MyISAM</th>
    <th>MEMORY</th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td>äº‹åŠ¡å®‰å…¨</td>
    <td>æ”¯æŒ</td>
    <td>æ— </td>
    <td>æ— </td>
   </tr>
   <tr>
    <td>å­˜å‚¨é™åˆ¶</td>
    <td>64TB</td>
    <td>æœ‰</td>
    <td>æœ‰</td>
   </tr>
   <tr>
    <td>ç©ºé—´ä½¿ç”¨</td>
    <td>é«˜</td>
    <td>ä½</td>
    <td>ä½</td>
   </tr>
   <tr>
    <td>å†…å­˜ä½¿ç”¨</td>
    <td>é«˜</td>
    <td>ä½</td>
    <td>é«˜</td>
   </tr>
   <tr>
    <td>æ’å…¥æ•°æ®é€Ÿåº¦</td>
    <td>ä½</td>
    <td>é«˜</td>
    <td>é«˜</td>
   </tr>
   <tr>
    <td>æ˜¯å¦æ”¯æŒå¤–é”®</td>
    <td>æ”¯æŒ</td>
    <td>æ— </td>
    <td>æ— </td>
   </tr>
  </tbody>
 </table> 
 <h2><a id="14__194"></a>14. é€‰æ‹©åˆé€‚ç»Ÿä¸€çš„å­—ç¬¦é›†ã€‚</h2> 
 <p>æ•°æ®åº“åº“ã€è¡¨ã€å¼€å‘ç¨‹åºç­‰éƒ½éœ€è¦ç»Ÿä¸€å­—ç¬¦é›†ï¼Œé€šå¸¸ä¸­è‹±æ–‡ç¯å¢ƒç”¨<code>utf8</code>ã€‚</p> 
 <p>MySQLæ”¯æŒçš„å­—ç¬¦é›†æœ‰<code>utf8ã€utf8mb4ã€GBKã€latin1</code>ç­‰ã€‚</p> 
 <ul>
  <li>utf8ï¼šæ”¯æŒä¸­è‹±æ–‡æ··åˆåœºæ™¯ï¼Œå›½é™…é€šè¿‡ï¼Œ3ä¸ªå­—èŠ‚é•¿åº¦</li>
  <li>utf8mb4: &nbsp; å®Œå…¨å…¼å®¹utf8ï¼Œ4ä¸ªå­—èŠ‚é•¿åº¦ï¼Œä¸€èˆ¬å­˜å‚¨<strong>emojiè¡¨æƒ…</strong>éœ€è¦ç”¨åˆ°å®ƒã€‚</li>
  <li>GBK ï¼šæ”¯æŒä¸­æ–‡ï¼Œä½†æ˜¯ä¸æ”¯æŒå›½é™…é€šç”¨å­—ç¬¦é›†ï¼Œ2ä¸ªå­—èŠ‚é•¿åº¦</li>
  <li>latin1ï¼šMySQLé»˜è®¤å­—ç¬¦é›†ï¼Œ1ä¸ªå­—èŠ‚é•¿åº¦</li>
 </ul> 
 <h2><a id="15_comment_205"></a>15. å¦‚æœä½ çš„æ•°æ®åº“å­—æ®µæ˜¯æšä¸¾ç±»å‹çš„ï¼Œéœ€è¦åœ¨commentæ³¨é‡Šæ¸…æ¥š</h2> 
 <p>å¦‚æœä½ è®¾è®¡çš„æ•°æ®åº“å­—æ®µæ˜¯æšä¸¾ç±»å‹çš„è¯ï¼Œå°±éœ€è¦åœ¨<code>comment</code>åé¢æ³¨é‡Šæ¸…æ¥šæ¯ä¸ªæšä¸¾çš„æ„æ€ï¼Œä»¥ä¾¿äºç»´æŠ¤</p> 
 <p>æ­£ä¾‹å¦‚ä¸‹ï¼š</p> 
 <pre><code>`session_status` varchar(2) COLLATE utf8_bin NOT NULL COMMENT 'sessionæˆæƒæ€ 00ï¼šåœ¨çº¿-æˆæƒæ€æœ‰æ•ˆ 01ï¼šä¸‹çº¿-æˆæƒæ€å¤±æ•ˆ 02ï¼šä¸‹çº¿-ä¸»åŠ¨é€€å‡º 03ï¼šä¸‹çº¿-åœ¨åˆ«å¤„è¢«ç™»å½•'
</code></pre> 
 <p>åä¾‹ï¼š</p> 
 <pre><code>`session_status` varchar(2) COLLATE utf8_bin NOT NULL COMMENT 'sessionæˆæƒæ€'
</code></pre> 
 <p>å¹¶ä¸”ï¼Œå¦‚æœä½ çš„æšä¸¾ç±»å‹åœ¨æœªæ¥çš„ç‰ˆæœ¬æœ‰å¢åŠ ä¿®æ”¹çš„è¯ï¼Œä¹Ÿéœ€è¦åŒæ—¶ç»´æŠ¤åˆ°<code>comment</code>åé¢ã€‚</p> 
 <h2><a id="16_222"></a>16.æ—¶é—´çš„ç±»å‹é€‰æ‹©</h2> 
 <p>æˆ‘ä»¬è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½éœ€è¦åŠ é€šç”¨æ—¶é—´çš„å­—æ®µï¼Œå¦‚<code>create_timeã€modified_time</code>ç­‰ç­‰ã€‚é‚£å¯¹äºæ—¶é—´çš„ç±»å‹ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿ</p> 
 <p>å¯¹äºMySQLæ¥è¯´ï¼Œä¸»è¦æœ‰<code>dateã€datetimeã€timeã€timestamp å’Œ year</code>ã€‚</p> 
 <ul>
  <li>date ï¼šè¡¨ç¤ºçš„æ—¥æœŸå€¼, æ ¼å¼<code>yyyy-mm-dd</code>,èŒƒå›´<code>1000-01-01 åˆ° 9999-12-31</code>ï¼Œ3å­—èŠ‚</li>
  <li>time ï¼šè¡¨ç¤ºçš„æ—¶é—´å€¼ï¼Œæ ¼å¼ <code>hh:mm:ss</code>ï¼ŒèŒƒå›´<code>-838:59:59 åˆ° 838:59:59</code>ï¼Œ3å­—èŠ‚</li>
  <li>datetimeï¼šè¡¨ç¤ºçš„æ—¥æœŸæ—¶é—´å€¼ï¼Œæ ¼å¼<code>yyyy-mm-dd hh:mm:ss</code>ï¼ŒèŒƒå›´<code>1000-01-01 00:00:00åˆ°</code>9999-12-31 23:59:59```,8å­—èŠ‚ï¼Œè·Ÿæ—¶åŒºæ— å…³</li>
  <li>timestampï¼šè¡¨ç¤ºçš„æ—¶é—´æˆ³å€¼ï¼Œæ ¼å¼ä¸º<code>yyyymmddhhmmss</code>ï¼ŒèŒƒå›´<code>1970-01-01 00:00:01åˆ°2038-01-19 03:14:07</code>ï¼Œ4å­—èŠ‚ï¼Œè·Ÿæ—¶åŒºæœ‰å…³</li>
  <li>yearï¼šå¹´ä»½å€¼ï¼Œæ ¼å¼ä¸º<code>yyyy</code>ã€‚èŒƒå›´<code>1901åˆ°2155</code>ï¼Œ1å­—èŠ‚</li>
 </ul> 
 <p>æ¨èä¼˜å…ˆä½¿ç”¨<code>datetime</code>ç±»å‹æ¥ä¿å­˜æ—¥æœŸå’Œæ—¶é—´ï¼Œå› ä¸ºå­˜å‚¨èŒƒå›´æ›´å¤§ï¼Œä¸”è·Ÿæ—¶åŒºæ— å…³ã€‚</p> 
 <h2><a id="17_Stored_procedure___236"></a>17. ä¸å»ºè®®ä½¿ç”¨Stored procedure (åŒ…æ‹¬å­˜å‚¨è¿‡ç¨‹ï¼Œè§¦å‘å™¨) ã€‚</h2> 
 <p><strong>ä»€ä¹ˆæ˜¯å­˜å‚¨è¿‡ç¨‹</strong></p> 
 <p>å·²é¢„ç¼–è¯‘ä¸ºä¸€ä¸ªå¯æ‰§è¡Œè¿‡ç¨‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªSQLè¯­å¥ã€‚</p> 
 <p><strong>ä»€ä¹ˆæ˜¯è§¦å‘å™¨</strong></p> 
 <p>è§¦å‘å™¨ï¼ŒæŒ‡ä¸€æ®µä»£ç ï¼Œå½“è§¦å‘æŸä¸ªäº‹ä»¶æ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œè¿™äº›ä»£ç ã€‚ä½¿ç”¨åœºæ™¯ï¼š</p> 
 <ul>
  <li>å¯ä»¥é€šè¿‡æ•°æ®åº“ä¸­çš„ç›¸å…³è¡¨å®ç°çº§è”æ›´æ”¹ã€‚</li>
  <li>å®æ—¶ç›‘æ§æŸå¼ è¡¨ä¸­çš„æŸä¸ªå­—æ®µçš„æ›´æ”¹è€Œéœ€è¦åšå‡ºç›¸åº”çš„å¤„ç†ã€‚</li>
  <li>ä¾‹å¦‚å¯ä»¥ç”ŸæˆæŸäº›ä¸šåŠ¡çš„ç¼–å·ã€‚</li>
  <li>æ³¨æ„ä¸è¦æ»¥ç”¨ï¼Œå¦åˆ™ä¼šé€ æˆæ•°æ®åº“åŠåº”ç”¨ç¨‹åºçš„ç»´æŠ¤å›°éš¾ã€‚</li>
 </ul> 
 <p>å¯¹äºMYSQLæ¥è¯´ï¼Œå­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰è¿˜ä¸æ˜¯å¾ˆæˆç†Ÿï¼Œ å¹¶æ²¡æœ‰å®Œå–„çš„å‡ºé”™è®°å½•å¤„ç†ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚</p> 
 <h2><a id="18_1N__253"></a>18. 1:N å…³ç³»çš„è®¾è®¡</h2> 
 <p>æ—¥å¸¸å¼€å‘ä¸­ï¼Œ<code>1</code>å¯¹å¤šçš„å…³ç³»åº”è¯¥æ˜¯éå¸¸å¸¸è§çš„ã€‚æ¯”å¦‚ä¸€ä¸ªç­çº§æœ‰å¤šä¸ªå­¦ç”Ÿï¼Œä¸€ä¸ªéƒ¨é—¨æœ‰å¤šä¸ªå‘˜å·¥ç­‰ç­‰ã€‚è¿™ç§çš„å»ºè¡¨åŸåˆ™å°±æ˜¯ï¼šåœ¨ä»è¡¨ï¼ˆ<code>N</code>çš„è¿™ä¸€æ–¹ï¼‰åˆ›å»ºä¸€ä¸ªå­—æ®µï¼Œä»¥å­—æ®µä½œä¸ºå¤–é”®æŒ‡å‘ä¸»è¡¨ï¼ˆ<code>1</code>çš„è¿™ä¸€æ–¹ï¼‰çš„ä¸»é”®ã€‚ç¤ºæ„å›¾å¦‚ä¸‹:</p> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/16838d39a5d92370407a0bb83f69c511.png" alt=""></p> 
 <p>å­¦ç”Ÿè¡¨æ˜¯å¤šï¼ˆ<code>N</code>ï¼‰çš„ä¸€æ–¹ï¼Œä¼šæœ‰ä¸ªå­—æ®µ<code>class_id</code>ä¿å­˜ç­çº§è¡¨çš„ä¸»é”®ã€‚å½“ç„¶ï¼Œä¸€ç­ä¸åŠ å¤–é”®çº¦æŸå“ˆï¼Œåªæ˜¯å•çº¯ä¿å­˜è¿™ä¸ªå…³ç³»è€Œå·²ã€‚</p> 
 <p>æœ‰æ—¶å€™ä¸¤å¼ è¡¨å­˜åœ¨<code>N:N</code>å…³ç³»æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥æ¶ˆé™¤è¿™ç§å…³ç³»ã€‚é€šè¿‡å¢åŠ ç¬¬ä¸‰å¼ è¡¨ï¼ŒæŠŠ<code>N:N</code>ä¿®æ”¹ä¸ºä¸¤ä¸ª <code>1:N</code>ã€‚æ¯”å¦‚å›¾ä¹¦å’Œè¯»è€…ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„å¤šå¯¹å¤šçš„å…³ç³»ã€‚ä¸€æœ¬ä¹¦å¯ä»¥è¢«å¤šä¸ªè¯»è€…å€Ÿï¼Œä¸€ä¸ªè¯»è€…åˆå¯ä»¥å€Ÿå¤šæœ¬ä¹¦ã€‚æˆ‘ä»¬å°±å¯ä»¥è®¾è®¡ä¸€ä¸ªå€Ÿä¹¦è¡¨ï¼ŒåŒ…å«å›¾ä¹¦è¡¨çš„ä¸»é”®ï¼Œä»¥åŠè¯»è€…çš„ä¸»é”®ï¼Œä»¥åŠå€Ÿè¿˜æ ‡è®°ç­‰å­—æ®µã€‚</p> 
 <h2><a id="19__263"></a>19. å¤§å­—æ®µ</h2> 
 <p>è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°¤å…¶éœ€è¦å…³æ³¨ä¸€äº›å¤§å­—æ®µï¼Œå³å ç”¨è¾ƒå¤šå­˜å‚¨ç©ºé—´çš„å­—æ®µã€‚æ¯”å¦‚ç”¨æ¥è®°å½•ç”¨æˆ·è¯„è®ºçš„å­—æ®µï¼Œåˆæˆ–è€…è®°å½•åšå®¢å†…å®¹çš„å­—æ®µï¼Œåˆæˆ–è€…ä¿å­˜åˆåŒæ•°æ®çš„å­—æ®µã€‚å¦‚æœç›´æ¥æŠŠè¡¨å­—æ®µè®¾è®¡æˆtextç±»å‹çš„è¯ï¼Œå°±ä¼šæµªè´¹å­˜å‚¨ç©ºé—´ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿä¸å¥½ã€‚</p> 
 <p>åœ¨MySQlä¸­ï¼Œè¿™ç§æ–¹å¼ä¿å­˜çš„è®¾è®¡æ–¹æ¡ˆï¼Œå…¶å®æ˜¯ä¸å¤ªåˆç†çš„ã€‚è¿™ç§éå¸¸å¤§çš„æ•°æ®ï¼Œå¯ä»¥ä¿å­˜åˆ°<code>mongodb</code>ä¸­ï¼Œç„¶åï¼Œåœ¨ä¸šåŠ¡è¡¨ä¿å­˜å¯¹åº”<code>mongodb</code>çš„<code>id</code>å³å¯ã€‚</p> 
 <p>è¿™ç§è®¾è®¡æ€æƒ³ç±»ä¼¼äºï¼Œæˆ‘ä»¬è¡¨å­—æ®µä¿å­˜å›¾ç‰‡æ—¶ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯ä¿å­˜å›¾ç‰‡å†…å®¹ï¼Œè€Œæ˜¯ç›´æ¥ä¿å­˜å›¾ç‰‡urlå³å¯ã€‚</p> 
 <h2><a id="20__271"></a>20. è€ƒè™‘æ˜¯å¦éœ€è¦åˆ†åº“åˆ†è¡¨</h2> 
 <p><strong>ä»€ä¹ˆæ˜¯åˆ†åº“åˆ†è¡¨å‘¢ï¼Ÿ</strong></p> 
 <ul>
  <li>åˆ†åº“ï¼šå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“åˆ†æˆå¤šä¸ªæ•°æ®åº“ï¼Œéƒ¨ç½²åˆ°ä¸åŒæœºå™¨ã€‚</li>
 </ul> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/b2cf7a062366981d0097856ac608eb09.png" alt=""></p> 
 <ul>
  <li>åˆ†è¡¨ï¼šå°±æ˜¯ä¸€ä¸ªæ•°æ®åº“è¡¨åˆ†æˆå¤šä¸ªè¡¨ã€‚</li>
 </ul> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/4198e1532e4032a024e81f66f904f38c.png" alt=""></p> 
 <p>æˆ‘ä»¬åœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œå…¶å®å¯ä»¥æå‰ä¼°ç®—ä¸€ä¸‹ï¼Œæ˜¯å¦éœ€è¦åš<strong>åˆ†åº“åˆ†è¡¨</strong>ã€‚æ¯”å¦‚ä¸€äº›ç”¨æˆ·ä¿¡æ¯ï¼Œæœªæ¥å¯èƒ½æ•°æ®é‡åˆ°è¾¾ç™¾ä¸‡è®¾ç½®åƒä¸‡çš„è¯ï¼Œå°±å¯ä»¥æå‰è€ƒè™‘åˆ†åº“åˆ†è¡¨ã€‚</p> 
 <blockquote> 
  <p><strong>ä¸ºä»€ä¹ˆéœ€è¦åˆ†åº“åˆ†è¡¨</strong>: æ•°æ®é‡å¤ªå¤§çš„è¯ï¼ŒSQLçš„æŸ¥è¯¢å°±ä¼šå˜æ…¢ã€‚å¦‚æœä¸€ä¸ªæŸ¥è¯¢SQLæ²¡å‘½ä¸­ç´¢å¼•ï¼Œåƒç™¾ä¸‡æ•°æ®é‡çº§åˆ«çš„è¡¨å¯èƒ½ä¼šæ‹–å®æ•´ä¸ªæ•°æ®åº“ã€‚å³ä½¿SQLå‘½ä¸­äº†ç´¢å¼•ï¼Œå¦‚æœè¡¨çš„æ•°æ®é‡è¶…è¿‡ä¸€åƒä¸‡çš„è¯ï¼ŒæŸ¥è¯¢ä¹Ÿæ˜¯ä¼šæ˜æ˜¾å˜æ…¢çš„ã€‚è¿™æ˜¯å› ä¸ºç´¢å¼•ä¸€èˆ¬æ˜¯B+æ ‘ç»“æ„ï¼Œæ•°æ®åƒä¸‡çº§åˆ«çš„è¯ï¼ŒB+æ ‘çš„é«˜åº¦ä¼šå¢é«˜ï¼ŒæŸ¥è¯¢å°±å˜æ…¢å•¦ã€‚</p> 
 </blockquote> 
 <p>åˆ†åº“åˆ†è¡¨ä¸»è¦æœ‰æ°´å¹³æ‹†åˆ†ã€å‚ç›´æ‹†åˆ†çš„è¯´æ³•ï¼Œæ‹†åˆ†ç­–ç•¥æœ‰<code>rangeèŒƒå›´ã€hashå–æ¨¡</code>ã€‚è€Œåˆ†åº“åˆ†è¡¨ä¸»è¦æœ‰è¿™äº›é—®é¢˜ï¼š</p> 
 <ul>
  <li>äº‹åŠ¡é—®é¢˜</li>
  <li>è·¨åº“å…³è”</li>
  <li>æ’åºé—®é¢˜</li>
  <li>åˆ†é¡µé—®é¢˜</li>
  <li>åˆ†å¸ƒå¼ID</li>
 </ul> 
 <h2><a id="21_sqL__295"></a>21. sqL ç¼–å†™çš„ä¸€äº›ä¼˜åŒ–ç»éªŒ</h2> 
 <p>æœ€åçš„è¯ï¼Œè·Ÿå¤§å®¶èŠæ¥ä¸€äº›å†™SQLçš„ç»éªŒå§ï¼š</p> 
 <ul>
  <li>æŸ¥è¯¢SQLå°½é‡ä¸è¦ä½¿ç”¨<code>select *</code>ï¼Œè€Œæ˜¯<code>select</code>å…·ä½“å­—æ®µ</li>
  <li>å¦‚æœçŸ¥é“æŸ¥è¯¢ç»“æœåªæœ‰ä¸€æ¡æˆ–è€…åªè¦æœ€å¤§/æœ€å°ä¸€æ¡è®°å½•ï¼Œå»ºè®®ç”¨<code>limit 1</code></li>
  <li>åº”å°½é‡é¿å…åœ¨<code>where</code>å­å¥ä¸­ä½¿ç”¨<code>or</code>æ¥è¿æ¥æ¡ä»¶</li>
  <li>æ³¨æ„ä¼˜åŒ–<code>limit</code>æ·±åˆ†é¡µé—®é¢˜</li>
  <li>ä½¿ç”¨<code>where</code>æ¡ä»¶é™å®šè¦æŸ¥è¯¢çš„æ•°æ®ï¼Œé¿å…è¿”å›å¤šä½™çš„è¡Œ</li>
  <li>å°½é‡é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨<code>mysql</code>çš„å†…ç½®å‡½æ•°</li>
  <li>åº”å°½é‡é¿å…åœ¨ <code>where</code>å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œ</li>
  <li>åº”å°½é‡é¿å…åœ¨<code>where</code> å­å¥ä¸­ä½¿ç”¨<code>!=</code>æˆ–<code>&lt;&gt;</code>æ“ä½œç¬¦</li>
  <li>ä½¿ç”¨è”åˆç´¢å¼•æ—¶ï¼Œæ³¨æ„ç´¢å¼•åˆ—çš„é¡ºåºï¼Œä¸€èˆ¬éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ã€‚</li>
  <li>å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”è€ƒè™‘åœ¨<code>where åŠ order by</code>æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•</li>
  <li>å¦‚æœæ’å…¥æ•°æ®è¿‡å¤šï¼Œè€ƒè™‘æ‰¹é‡æ’å…¥</li>
  <li>åœ¨é€‚å½“çš„æ—¶å€™ï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•</li>
  <li>ä½¿ç”¨explain åˆ†æä½ SQLçš„è®¡åˆ’</li>
 </ul> 
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:49.000Z" title="2023-4-27 17:20:49">2023-04-27</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-04-27T09:22:38.119Z" title="2023-4-27 17:22:38">2023-04-27</time>æ›´æ–°</span><span class="level-item">17 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2530ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90Zookeeper%E3%80%91Zookeeper%E5%85%A5%E9%97%A8%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/">ã€Zookeeperã€‘Zookeeperå…¥é—¨çœ‹è¿™ç¯‡å°±å¤Ÿäº†</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="zookeeperzookeeperå…¥é—¨çœ‹è¿™ç¯‡å°±å¤Ÿäº†"><a class="markdownIt-Anchor" href="#zookeeperzookeeperå…¥é—¨çœ‹è¿™ç¯‡å°±å¤Ÿäº†">#</a> ã€Zookeeperã€‘Zookeeper å…¥é—¨çœ‹è¿™ç¯‡å°±å¤Ÿäº†</h2>
<div id="content_views" class="htmledit_views"> <strong><a target="_blank" rel="noopener" href="https://www.roncoo.com/course/list.html?courseName=Zookeeper">Zookeeperæ˜¯ä»€ä¹ˆ</a></strong> 
 <br> 
 <br>å®˜æ–¹æ–‡æ¡£ä¸Šè¿™ä¹ˆè§£é‡Šzookeeperï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œæ˜¯Apache Hadoop çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚ 
 <br> 
 <br>ä¸Šé¢çš„è§£é‡Šæœ‰ç‚¹æŠ½è±¡ï¼Œç®€å•æ¥è¯´zookeeper=æ–‡ä»¶ç³»ç»Ÿ+ç›‘å¬é€šçŸ¥æœºåˆ¶ã€‚ 
 <br> 
 <br>1ã€ æ–‡ä»¶ç³»ç»Ÿ 
 <br> 
 <br> 
 <p>Zookeeperç»´æŠ¤ä¸€ä¸ªç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿçš„æ•°æ®ç»“æ„ï¼š</p> 
 <p><img src="https://img-blog.csdn.net/201807121434154?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></p> 
 <p></p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">æ¯ä¸ªå­ç›®å½•é¡¹å¦‚ NameService éƒ½è¢«ç§°ä½œä¸º znode(ç›®å½•èŠ‚ç‚¹)ï¼Œå’Œæ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªç”±çš„å¢åŠ ã€åˆ é™¤znodeï¼Œåœ¨ä¸€ä¸ªznodeä¸‹å¢åŠ ã€åˆ é™¤å­znodeï¼Œå”¯ä¸€çš„ä¸åŒåœ¨äºznodeæ˜¯å¯ä»¥å­˜å‚¨æ•°æ®çš„ã€‚</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">æœ‰å››ç§ç±»å‹çš„znodeï¼š</p> 
 <ul style="margin-left:30px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">
  <li><p style="line-height:28px;"><span style="font-weight:bolder;">PERSISTENT-æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹</span></p><p style="line-height:28px;">å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨</p></li>
  <li><p style="line-height:28px;"><span style="font-weight:bolder;">PERSISTENT_SEQUENTIAL-æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹</span></p><p style="line-height:28px;">å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·</p></li>
  <li><p style="line-height:28px;"><span style="font-weight:bolder;">EPHEMERAL-ä¸´æ—¶ç›®å½•èŠ‚ç‚¹</span></p><p style="line-height:28px;">å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤</p></li>
  <li><p style="line-height:28px;"><span style="font-weight:bolder;">EPHEMERAL_SEQUENTIAL-ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹</span></p><p style="line-height:28px;">å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·</p></li>
 </ul> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">2ã€ ç›‘å¬é€šçŸ¥æœºåˆ¶</span></p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å®ƒå…³å¿ƒçš„ç›®å½•èŠ‚ç‚¹ï¼Œå½“ç›®å½•èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼ˆæ•°æ®æ”¹å˜ã€è¢«åˆ é™¤ã€å­ç›®å½•èŠ‚ç‚¹å¢åŠ åˆ é™¤ï¼‰æ—¶ï¼Œzookeeperä¼šé€šçŸ¥å®¢æˆ·ç«¯ã€‚</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">å°±è¿™ä¹ˆç®€å•ï¼Œä¸‹é¢æˆ‘ä»¬çœ‹çœ‹Zookeeperèƒ½åšç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</p> <span id="OSC_h1_2" style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> <span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> 
 <h1 id="h1_2" style="font-size:24px;font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Zookeeperèƒ½åšä»€ä¹ˆ</span></h1> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">zookeeperåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå¯ä»¥å®ç°è¯¸å¦‚åˆ†å¸ƒå¼åº”ç”¨é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæˆ‘ä»¬è¿™é‡Œæ‹¿æ¯”è¾ƒç®€å•çš„åˆ†å¸ƒå¼åº”ç”¨é…ç½®ç®¡ç†ä¸ºä¾‹æ¥è¯´æ˜ã€‚</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">å‡è®¾æˆ‘ä»¬çš„ç¨‹åºæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²åœ¨å¤šå°æœºå™¨ä¸Šï¼Œå¦‚æœæˆ‘ä»¬è¦æ”¹å˜ç¨‹åºçš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦é€å°æœºå™¨å»ä¿®æ”¹ï¼Œéå¸¸éº»çƒ¦ï¼Œç°åœ¨æŠŠè¿™äº›é…ç½®å…¨éƒ¨æ”¾åˆ°zookeeperä¸Šå»ï¼Œä¿å­˜åœ¨ zookeeper çš„æŸä¸ªç›®å½•èŠ‚ç‚¹ä¸­ï¼Œç„¶åæ‰€æœ‰ç›¸å…³åº”ç”¨ç¨‹åºå¯¹è¿™ä¸ªç›®å½•èŠ‚ç‚¹è¿›è¡Œç›‘å¬ï¼Œä¸€æ—¦é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºå°±ä¼šæ”¶åˆ° zookeeper çš„é€šçŸ¥ï¼Œç„¶åä» zookeeper è·å–æ–°çš„é…ç½®ä¿¡æ¯åº”ç”¨åˆ°ç³»ç»Ÿä¸­ã€‚</p> 
 <p><img src="https://img-blog.csdn.net/20180712143454552?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p> 
 <p></p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">å¦‚ä¸Šï¼Œä½ å¤§è‡´åº”è¯¥äº†è§£zookeeperæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œå¤§æ¦‚èƒ½åšäº›ä»€ä¹ˆäº†ï¼Œæˆ‘ä»¬é©¬ä¸Šæ¥å­¦ä¹ ä¸‹zookeeperçš„å®‰è£…åŠä½¿ç”¨ï¼Œå¹¶å¼€å‘ä¸€ä¸ªå°ç¨‹åºæ¥å®ç°zookeeperè¿™ä¸ªåˆ†å¸ƒå¼é…ç½®ç®¡ç†çš„åŠŸèƒ½ã€‚</p> <span id="OSC_h1_3" style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> <span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> 
 <h1 id="h1_3" style="font-size:24px;font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Zookeeperå•æœºæ¨¡å¼å®‰è£…</span></h1> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step1</span>ï¼šé…ç½®JAVAç¯å¢ƒï¼Œæ£€éªŒç¯å¢ƒï¼šjava -version</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step2</span>ï¼šä¸‹è½½å¹¶è§£å‹zookeeper</p> 
 <pre><code class="language-java"># cd /usr/local
# wget http://mirror.bit.edu.cn/apache/zookeeper/stable/zookeeper-3.4.12.tar.gz
# tar -zxvf zookeeper-3.4.12.tar.gz
# cd zookeeper-3.4.12</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step3</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šé‡å‘½åé…ç½®æ–‡ä»¶zoo_sample.cfg</span><br></p> 
 <pre><code class="language-java"># cp conf/zoo_sample.cfg conf/zoo.cfg</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step4</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šå¯åŠ¨zookeeper</span></p> 
 <pre><code class="language-java"># bin/zkServer.sh start</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step5</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šæ£€æµ‹æ˜¯å¦æˆåŠŸå¯åŠ¨ï¼Œç”¨zookeeperå®¢æˆ·ç«¯è¿æ¥ä¸‹æœåŠ¡ç«¯</span></p> 
 <pre><code class="language-java"># bin/zkCli.sh</code></pre> 
 <h1 id="h1_4" style="font-size:24px;font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Zookeeperä½¿ç”¨</span></h1> <span id="OSC_h3_5" style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> <span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span> 
 <h3 id="h3_5" style="font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;font-size:20px;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">ä½¿ç”¨å®¢æˆ·ç«¯å‘½ä»¤æ“ä½œzookeeper</span></h3> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">1ã€ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ ZooKeeper ä¸­æ‰€åŒ…å«çš„å†…å®¹</p> 
 <img src="https://img-blog.csdn.net/20180712143716167?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""> 
 <br> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><br></span></p> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">2ã€åˆ›å»ºä¸€ä¸ªæ–°çš„ znode ï¼Œä½¿ç”¨ create /zkPro myData</span><br></p> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/2018071214374133?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;">3ã€å†æ¬¡ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹ç°åœ¨ zookeeper ä¸­æ‰€åŒ…å«çš„å†…å®¹ï¼š</span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><img src="https://img-blog.csdn.net/20180712143805771?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">4ã€ä¸‹é¢æˆ‘ä»¬è¿è¡Œ get å‘½ä»¤æ¥ç¡®è®¤ç¬¬äºŒæ­¥ä¸­æ‰€åˆ›å»ºçš„ znode æ˜¯å¦åŒ…å«æˆ‘ä»¬æ‰€åˆ›å»ºçš„å­—ç¬¦ä¸²ï¼š</span><br></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712143823808?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">5ã€ä¸‹é¢æˆ‘ä»¬é€šè¿‡ set å‘½ä»¤æ¥å¯¹ zk æ‰€å…³è”çš„å­—ç¬¦ä¸²è¿›è¡Œè®¾ç½®ï¼š</span><br></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/2018071214384160?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">6ã€ä¸‹é¢æˆ‘ä»¬å°†åˆšæ‰åˆ›å»ºçš„ znode åˆ é™¤</span><br></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712143857281?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span></span></span></span></p> 
 <h3 id="h3_6" style="font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;font-size:20px;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">ä½¿ç”¨Java APIæ“ä½œzookeeper</span></h3> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ä½¿ç”¨Java APIæ“ä½œzookeeperéœ€è¦å¼•ç”¨ä¸‹é¢çš„åŒ…</p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712143918407?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span></span></span></span></p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸Šé¢è¯´çš„åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼š</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">1ã€åœ¨zookeeperé‡Œå¢åŠ ä¸€ä¸ªç›®å½•èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠé…ç½®ä¿¡æ¯å­˜å‚¨åœ¨é‡Œé¢</p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712143937411?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></span></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">2ã€å¯åŠ¨ä¸¤ä¸ªzookeeperå®¢æˆ·ç«¯ç¨‹åºï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º</span><br></span></span></span></span></p> 
 <pre><code class="language-java">import java.util.concurrent.CountDownLatch;
import org.apache.zookeeper.WatchedEvent;
import org.apache.zookeeper.Watcher;
import org.apache.zookeeper.Watcher.Event.EventType;
import org.apache.zookeeper.Watcher.Event.KeeperState;
import org.apache.zookeeper.ZooKeeper;
import org.apache.zookeeper.data.Stat;
<p>/**</p>
<ul>
<li>åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ demo</li>
<li>@author</li>
<li></li>
</ul>
<p>*/<br>
public class ZooKeeperProSync implements Watcher &#123;</p>
<pre><code>private static CountDownLatch connectedSemaphore = new CountDownLatch(1);
private static ZooKeeper zk = null;
private static Stat stat = new Stat();

public static void main(String[] args) throws Exception &#123;
    //zookeeperé…ç½®æ•°æ®å­˜æ”¾è·¯å¾„
    String path = &quot;/username&quot;;
    //è¿æ¥zookeeperå¹¶ä¸”æ³¨å†Œä¸€ä¸ªé»˜è®¤çš„ç›‘å¬å™¨
    zk = new ZooKeeper(&quot;192.168.31.100:2181&quot;, 5000, //
            new ZooKeeperProSync());
    //ç­‰å¾…zkè¿æ¥æˆåŠŸçš„é€šçŸ¥
    connectedSemaphore.await();
    //è·å–pathç›®å½•èŠ‚ç‚¹çš„é…ç½®æ•°æ®ï¼Œå¹¶æ³¨å†Œé»˜è®¤çš„ç›‘å¬å™¨
    System.out.println(new String(zk.getData(path, true, stat)));

    Thread.sleep(Integer.MAX_VALUE);
&#125;

public void process(WatchedEvent event) &#123;
    if (KeeperState.SyncConnected == event.getState()) &#123;  //zkè¿æ¥æˆåŠŸé€šçŸ¥äº‹ä»¶
        if (EventType.None == event.getType() &amp;amp;&amp;amp; null == event.getPath()) &#123;
            connectedSemaphore.countDown();
        &#125; else if (event.getType() == EventType.NodeDataChanged) &#123;  //zkç›®å½•èŠ‚ç‚¹æ•°æ®å˜åŒ–é€šçŸ¥äº‹ä»¶
            try &#123;
                System.out.println(&quot;é…ç½®å·²ä¿®æ”¹ï¼Œæ–°å€¼ä¸ºï¼š&quot; + new String(zk.getData(event.getPath(), true, stat)));
            &#125; catch (Exception e) &#123;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<p>}</code></pre></p>
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ä¸¤ä¸ªç¨‹åºå¯åŠ¨åéƒ½æ­£ç¡®çš„è¯»å–åˆ°äº†zookeeperçš„/usernameç›®å½•èŠ‚ç‚¹ä¸‹çš„æ•°æ®'qingfeng'</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">3ã€æˆ‘ä»¬åœ¨zookeeperé‡Œä¿®æ”¹ä¸‹ç›®å½•èŠ‚ç‚¹/usernameä¸‹çš„æ•°æ®</p> 
 <img src="https://img-blog.csdn.net/20180712144020208?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""> 
 <br> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ä¿®æ”¹å®Œæˆåï¼Œæˆ‘ä»¬çœ‹è§ä¸¤ä¸ªç¨‹åºåå°éƒ½åŠæ—¶æ”¶åˆ°äº†ä»–ä»¬ç›‘å¬çš„ç›®å½•èŠ‚ç‚¹æ•°æ®å˜æ›´åçš„å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º</span><br></span></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712144042598?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></span></span></span></span></p> 
 <p><span style="background-color:rgb(255,255,255);color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"></span></span></span></span></span></p> 
 <h1 id="h1_7" style="font-size:24px;font-family:'PingFang SC', 'Helvetica Neue', 'Microsoft YaHei UI', 'Microsoft YaHei', 'Noto Sans CJK SC', Sathu, EucrosiaUPC, Arial, Helvetica, sans-serif;line-height:1.28571em;font-weight:500;color:rgb(61,70,77);background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Zookeeperé›†ç¾¤æ¨¡å¼å®‰è£…</span></h1> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">æœ¬ä¾‹æ­å»ºçš„æ˜¯ä¼ªé›†ç¾¤æ¨¡å¼ï¼Œå³ä¸€å°æœºå™¨ä¸Šå¯åŠ¨ä¸‰ä¸ªzookeeperå®ä¾‹ç»„æˆé›†ç¾¤ï¼ŒçœŸæ­£çš„é›†ç¾¤æ¨¡å¼æ— éå°±æ˜¯å®ä¾‹IPåœ°å€ä¸åŒï¼Œæ­å»ºæ–¹æ³•æ²¡æœ‰åŒºåˆ«</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step1</span>ï¼šé…ç½®JAVAç¯å¢ƒï¼Œæ£€éªŒç¯å¢ƒï¼šjava -version</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step2</span>ï¼šä¸‹è½½å¹¶è§£å‹zookeeper</p> 
 <pre><code class="language-java"># cd /usr/local
# wget http://mirror.bit.edu.cn/apache/zookeeper/stable/zookeeper-3.4.12.tar.gz
# tar -zxvf zookeeper-3.4.12.tar.gz
# cd zookeeper-3.4.12</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step3</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šé‡å‘½å zoo_sample.cfgæ–‡ä»¶</span></p> 
 <pre><code class="language-java"># cp conf/zoo_sample.cfg conf/zoo-1.cfg</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step4</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šä¿®æ”¹é…ç½®æ–‡ä»¶zoo-1.cfgï¼ŒåŸé…ç½®æ–‡ä»¶é‡Œæœ‰çš„ï¼Œä¿®æ”¹æˆä¸‹é¢çš„å€¼ï¼Œæ²¡æœ‰çš„åˆ™åŠ ä¸Š</span></p> 
 <pre><code class="language-java"># vim conf/zoo-1.cfg
dataDir=/tmp/zookeeper-1
clientPort=2181
server.1=127.0.0.1:2888:3888
server.2=127.0.0.1:2889:3889
server.3=127.0.0.1:2890:3890</code></pre> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">é…ç½®è¯´æ˜</span></p> 
 <ul style="margin-left:30px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">
  <li>tickTimeï¼šè¿™ä¸ªæ—¶é—´æ˜¯ä½œä¸º Zookeeper æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ª tickTime æ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ã€‚</li>
  <li>initLimitï¼šè¿™ä¸ªé…ç½®é¡¹æ˜¯ç”¨æ¥é…ç½® Zookeeper æ¥å—å®¢æˆ·ç«¯ï¼ˆè¿™é‡Œæ‰€è¯´çš„å®¢æˆ·ç«¯ä¸æ˜¯ç”¨æˆ·è¿æ¥ Zookeeper æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ï¼Œè€Œæ˜¯ Zookeeper æœåŠ¡å™¨é›†ç¾¤ä¸­è¿æ¥åˆ° Leader çš„ Follower æœåŠ¡å™¨ï¼‰åˆå§‹åŒ–è¿æ¥æ—¶æœ€é•¿èƒ½å¿å—å¤šå°‘ä¸ªå¿ƒè·³æ—¶é—´é—´éš”æ•°ã€‚å½“å·²ç»è¶…è¿‡ 10ä¸ªå¿ƒè·³çš„æ—¶é—´ï¼ˆä¹Ÿå°±æ˜¯ tickTimeï¼‰é•¿åº¦å Zookeeper æœåŠ¡å™¨è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„è¿”å›ä¿¡æ¯ï¼Œé‚£ä¹ˆè¡¨æ˜è¿™ä¸ªå®¢æˆ·ç«¯è¿æ¥å¤±è´¥ã€‚æ€»çš„æ—¶é—´é•¿åº¦å°±æ˜¯ 10*2000=20 ç§’</li>
  <li>syncLimitï¼šè¿™ä¸ªé…ç½®é¡¹æ ‡è¯† Leader ä¸ Follower ä¹‹é—´å‘é€æ¶ˆæ¯ï¼Œè¯·æ±‚å’Œåº”ç­”æ—¶é—´é•¿åº¦ï¼Œæœ€é•¿ä¸èƒ½è¶…è¿‡å¤šå°‘ä¸ª tickTime çš„æ—¶é—´é•¿åº¦ï¼Œæ€»çš„æ—¶é—´é•¿åº¦å°±æ˜¯ 5*2000=10ç§’</li>
  <li>dataDirï¼šé¡¾åæ€ä¹‰å°±æ˜¯ Zookeeper ä¿å­˜æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒZookeeper å°†å†™æ•°æ®çš„æ—¥å¿—æ–‡ä»¶ä¹Ÿä¿å­˜åœ¨è¿™ä¸ªç›®å½•é‡Œã€‚</li>
  <li>clientPortï¼šè¿™ä¸ªç«¯å£å°±æ˜¯å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ã€‚</li>
  <li>server.A=Bï¼šCï¼šDï¼šå…¶ä¸­ A æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨ï¼›B æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ ip åœ°å€ï¼›C è¡¨ç¤ºçš„æ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£ï¼›D è¡¨ç¤ºçš„æ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„ Leader æœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„ Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£ã€‚å¦‚æœæ˜¯ä¼ªé›†ç¾¤çš„é…ç½®æ–¹å¼ï¼Œç”±äº B éƒ½æ˜¯ä¸€æ ·ï¼Œæ‰€ä»¥ä¸åŒçš„ Zookeeper å®ä¾‹é€šä¿¡ç«¯å£å·ä¸èƒ½ä¸€æ ·ï¼Œæ‰€ä»¥è¦ç»™å®ƒä»¬åˆ†é…ä¸åŒçš„ç«¯å£å·ã€‚</li>
 </ul> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step4</span>ï¼šå†ä»zoo-1.cfgå¤åˆ¶ä¸¤ä¸ªé…ç½®æ–‡ä»¶zoo-2.cfgå’Œzoo-3.cfgï¼Œåªéœ€ä¿®æ”¹dataDirå’ŒclientPortä¸åŒå³å¯</p> 
 <pre><code class="language-java"># cp conf/zoo-1.cfg conf/zoo-2.cfg
# cp conf/zoo-1.cfg conf/zoo-3.cfg
# vim conf/zoo-2.cfg
dataDir=/tmp/zookeeper-2
clientPort=2182
# vim conf/zoo-2.cfg
dataDir=/tmp/zookeeper-3
clientPort=2183</code></pre> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><span style="font-weight:bolder;">Step5</span>ï¼šæ ‡è¯†Server ID</p> 
 <p style="line-height:28px;color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹/tmp/zookeeper-1ï¼Œ/tmp/zookeeper-2ï¼Œ/tmp/zookeeper-2ï¼Œåœ¨æ¯ä¸ªç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶myid æ–‡ä»¶ï¼Œå†™å…¥å½“å‰å®ä¾‹çš„server idï¼Œå³1.2.3</p> 
 <pre><code class="language-java"># cd /tmp/zookeeper-1
# vim myid
1
# cd /tmp/zookeeper-2
# vim myid
2
# cd /tmp/zookeeper-3
# vim myid
3</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step6</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šå¯åŠ¨ä¸‰ä¸ªzookeeperå®ä¾‹</span></p> 
 <pre><code class="language-java"># bin/zkServer.sh start conf/zoo-1.cfg
# bin/zkServer.sh start conf/zoo-2.cfg
# bin/zkServer.sh start conf/zoo-3.cfg</code></pre> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><strong>Step7</strong></span><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);">ï¼šæ£€æµ‹é›†ç¾¤çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨å‘½ä»¤â€œzkCli.sh -server IP:PORTâ€è¿æ¥zookeeperæœåŠ¡ç«¯æ£€æµ‹</span></p> 
 <p><span style="color:rgb(61,70,77);font-family:'Pingfang SC', STHeiti, 'Lantinghei SC', 'Open Sans', Arial, 'Hiragino Sans GB', 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;background-color:rgb(255,255,255);"><img src="https://img-blog.csdn.net/20180712144336907?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2phdmFfNjY2NjY=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""><br></span></p> 
 <p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯¹zookeeperå°±ç®—æœ‰äº†ä¸€ä¸ªå…¥é—¨çš„äº†è§£ï¼Œå½“ç„¶zookeeperè¿œæ¯”æˆ‘ä»¬è¿™é‡Œæè¿°çš„åŠŸèƒ½å¤šï¼Œæ¯”å¦‚ç”¨zookeeperå®ç°é›†ç¾¤ç®¡ç†ï¼Œåˆ†å¸ƒå¼é”ï¼Œåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œzookeeperé›†ç¾¤leaderé€‰ä¸¾ç­‰ç­‰<br></p> 
 <p>æ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://www.roncoo.com/course/view/255bac222b1b4300b42838b58fea3a2e">https://www.roncoo.com/course/view/255bac222b1b4300b42838b58fea3a2e</a></p> 
 <p>æ–‡ç« æ¥æºï¼šhttps://my.oschina.net/u/3796575/blog/1845035</p> 
</div>
## å…³äºæˆ‘
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:49.000Z" title="2023-4-27 17:20:49">2023-04-27</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-04-29T11:04:20.517Z" title="2023-4-29 19:04:20">2023-04-29</time>æ›´æ–°</span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦11033ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90Dubbo%E3%80%91Dubbo%E8%AF%A6%E8%A7%A3%EF%BC%8C%E7%94%A8%E5%BF%83%E7%9C%8B%E8%BF%99%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86%E3%80%90%E9%87%8D%E7%82%B9%E3%80%91/">ã€Dubboã€‘Dubboè¯¦è§£ï¼Œç”¨å¿ƒçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†ã€é‡ç‚¹ã€‘</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="dubbodubboè¯¦è§£ç”¨å¿ƒçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†é‡ç‚¹"><a class="markdownIt-Anchor" href="#dubbodubboè¯¦è§£ç”¨å¿ƒçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†é‡ç‚¹">#</a> ã€Dubboã€‘Dubbo è¯¦è§£ï¼Œç”¨å¿ƒçœ‹è¿™ä¸€ç¯‡æ–‡ç« å°±å¤Ÿäº†ã€é‡ç‚¹ã€‘</h2>
<h2 id="11-dubboæ¦‚è¿°"><a class="markdownIt-Anchor" href="#11-dubboæ¦‚è¿°">#</a> 1.1  <code>Dubbo</code>  æ¦‚è¿°</h2>
<p><strong> <code>Dubbo</code>  æ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„åŸºäº  <code>Java</code>  çš„é«˜æ€§èƒ½ <code>RPC</code> ï¼ˆä¸€ç§è¿œç¨‹è°ƒç”¨ï¼‰ åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œè‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„ <code>RPC</code>  è¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠ <code>SOA</code>  æœåŠ¡æ²»ç†æ–¹æ¡ˆ</strong>ã€‚</p>
<p>æ¯å¤©ä¸º <code>2</code>  åƒå¤šä¸ªæœåŠ¡æä¾›å¤§äº <code>30</code>  äº¿æ¬¡è®¿é—®é‡æ”¯æŒï¼Œå¹¶è¢«å¹¿æ³›åº”ç”¨äºé˜¿é‡Œå·´å·´é›†å›¢çš„å„æˆå‘˜ç«™ç‚¹ä»¥åŠåˆ«çš„å…¬å¸çš„ä¸šåŠ¡ä¸­ã€‚</p>
<p>ç®€å•çš„è¯´ï¼Œ <code>Dubbo</code>  å°±æ˜¯ä¸ªæœåŠ¡æ¡†æ¶ï¼Œå¦‚æœæ²¡æœ‰åˆ†å¸ƒå¼çš„éœ€æ±‚ï¼Œå…¶å®æ˜¯ä¸éœ€è¦ç”¨çš„ï¼Œåªæœ‰åœ¨åˆ†å¸ƒå¼çš„æ—¶å€™ï¼Œæ‰æœ‰ <code>Dubbo</code>  è¿™æ ·çš„åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶çš„éœ€æ±‚ã€‚</p>
<p>å¹¶ä¸”æœ¬è´¨ä¸Šæ˜¯ä¸ªè¿œç¨‹æœåŠ¡è°ƒç”¨çš„åˆ†å¸ƒå¼æ¡†æ¶ï¼ˆå‘Šåˆ« <code>Web Service</code>  æ¨¡å¼ä¸­çš„ <code>WSdl</code> ï¼Œä»¥æœåŠ¡è€…ä¸æ¶ˆè´¹è€…çš„æ–¹å¼åœ¨ <code>Dubbo</code>  ä¸Šæ³¨å†Œï¼‰</p>
<p>å…¶æ ¸å¿ƒéƒ¨åˆ†åŒ…å«ï¼š</p>
<p>1ã€<strong>è¿œç¨‹é€šè®¯</strong>ï¼šæä¾›å¯¹å¤šç§åŸºäºé•¿è¿æ¥çš„ <code>NIO</code>  æ¡†æ¶æŠ½è±¡å°è£…ï¼ŒåŒ…æ‹¬å¤šç§çº¿ç¨‹æ¨¡å‹ï¼Œåºåˆ—åŒ–ï¼Œä»¥åŠ â€œè¯·æ±‚ - å“åº”â€ æ¨¡å¼çš„ä¿¡æ¯äº¤æ¢æ–¹å¼ã€‚<br>
2ã€<strong>é›†ç¾¤å®¹é”™</strong>ï¼šæä¾›åŸºäºæ¥å£æ–¹æ³•çš„é€æ˜è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ŒåŒ…æ‹¬å¤šåè®®æ”¯æŒï¼Œä»¥åŠè½¯è´Ÿè½½å‡è¡¡ï¼Œå¤±è´¥å®¹é”™ï¼Œåœ°å€è·¯ç”±ï¼ŒåŠ¨æ€é…ç½®ç­‰é›†ç¾¤æ”¯æŒã€‚<br>
3ã€<strong>è‡ªåŠ¨å‘ç°</strong>ï¼šåŸºäºæ³¨å†Œä¸­å¿ƒç›®å½•æœåŠ¡ï¼Œä½¿æœåŠ¡æ¶ˆè´¹æ–¹èƒ½åŠ¨æ€çš„æŸ¥æ‰¾æœåŠ¡æä¾›æ–¹ï¼Œä½¿åœ°å€é€æ˜ï¼Œä½¿æœåŠ¡æä¾›æ–¹å¯ä»¥å¹³æ»‘å¢åŠ æˆ–å‡å°‘æœºå™¨ã€‚</p>
<h2 id="12-dubboèƒŒæ™¯"><a class="markdownIt-Anchor" href="#12-dubboèƒŒæ™¯">#</a> 1.2  <code>Dubbo</code>  èƒŒæ™¯</h2>
<p><code>Dubbo</code>  å¼€å§‹äºç”µå•†ç³»ç»Ÿï¼Œå› æ­¤åœ¨è¿™é‡Œå…ˆä»ç”µå•†ç³»ç»Ÿçš„æ¼”å˜è®²èµ·ã€‚</p>
<h3 id="121-å•ä¸€åº”ç”¨æ¡†æ¶"><a class="markdownIt-Anchor" href="#121-å•ä¸€åº”ç”¨æ¡†æ¶">#</a> 1.2.1 å•ä¸€åº”ç”¨æ¡†æ¶</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9529d3b51c5f4fa4944fc793a542688a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½å¦‚ä¸‹å•æ”¯ä»˜ç­‰éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šå•ä¸€çš„ç³»ç»Ÿæ¶æ„ï¼Œä½¿å¾—åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå ç”¨çš„èµ„æºè¶Šæ¥è¶Šå¤šï¼Œè€Œä¸”éšç€æµé‡çš„å¢åŠ è¶Šæ¥è¶Šéš¾ä»¥ç»´æŠ¤ã€‚</p>
<h3 id="122-å‚ç›´åº”ç”¨æ¡†æ¶"><a class="markdownIt-Anchor" href="#122-å‚ç›´åº”ç”¨æ¡†æ¶">#</a> 1.2.2 å‚ç›´åº”ç”¨æ¡†æ¶</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a7579c9f3b0e4a928d2bedde32fd2f1f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å‚ç›´åº”ç”¨æ¶æ„è§£å†³äº†å•ä¸€åº”ç”¨æ¶æ„æ‰€é¢ä¸´çš„æ‰©å®¹é—®é¢˜ï¼Œæµé‡èƒ½å¤Ÿåˆ†æ•£åˆ°å„ä¸ªå­ç³»ç»Ÿå½“ä¸­ï¼Œä¸”ç³»ç»Ÿçš„ä½“ç§¯å¯æ§ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†å¼€å‘äººå‘˜ä¹‹é—´ååŒä»¥åŠç»´æŠ¤çš„æˆæœ¬ï¼Œæå‡äº†å¼€å‘æ•ˆç‡ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼šä½†æ˜¯åœ¨å‚ç›´æ¶æ„ä¸­ç›¸åŒé€»è¾‘ä»£ç éœ€è¦ä¸æ–­çš„å¤åˆ¶ï¼Œä¸èƒ½å¤ç”¨ã€‚</p>
<h3 id="123-åˆ†å¸ƒå¼åº”ç”¨æ¶æ„rpc"><a class="markdownIt-Anchor" href="#123-åˆ†å¸ƒå¼åº”ç”¨æ¶æ„rpc">#</a> 1.2.3 åˆ†å¸ƒå¼åº”ç”¨æ¶æ„ ( <code>RPC</code> )</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/36242cd9be084aea8c2c30643485c960.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒã€‚</p>
<h3 id="124-æµåŠ¨è®¡ç®—æ¶æ„soa"><a class="markdownIt-Anchor" href="#124-æµåŠ¨è®¡ç®—æ¶æ„soa">#</a> 1.2.4 æµåŠ¨è®¡ç®—æ¶æ„ ( <code>SOA</code> )</h3>
<p>éšç€æœåŠ¡åŒ–çš„è¿›ä¸€æ­¥å‘å±•ï¼ŒæœåŠ¡è¶Šæ¥è¶Šå¤šï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨å’Œä¾èµ–å…³ç³»ä¹Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œè¯ç”Ÿäº†é¢å‘æœåŠ¡çš„æ¶æ„ä½“ç³» ( <code>SOA</code> )ï¼Œä¹Ÿå› æ­¤è¡ç”Ÿå‡ºäº†ä¸€ç³»åˆ—ç›¸åº”çš„æŠ€æœ¯ï¼Œå¦‚å¯¹æœåŠ¡æä¾›ã€æœåŠ¡è°ƒç”¨ã€è¿æ¥å¤„ç†ã€é€šä¿¡åè®®ã€åºåˆ—åŒ–æ–¹å¼ã€æœåŠ¡å‘ç°ã€æœåŠ¡è·¯ç”±ã€æ—¥å¿—è¾“å‡ºç­‰è¡Œä¸ºè¿›è¡Œå°è£…çš„æœåŠ¡æ¡†æ¶ã€‚</p>
<h3 id="125-æ¶æ„æ¼”å˜è¯¦è§£"><a class="markdownIt-Anchor" href="#125-æ¶æ„æ¼”å˜è¯¦è§£">#</a> 1.2.5 æ¶æ„æ¼”å˜è¯¦è§£</h3>
<p>ä»ä»¥ä¸Šæ˜¯ç”µå•†ç³»ç»Ÿçš„æ¼”å˜å¯ä»¥çœ‹å‡ºæ¶æ„æ¼”å˜çš„è¿‡ç¨‹ï¼š<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/58b4c7452c0243fdb318d0282d603f94.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
 1ã€å•åº”ç”¨å•æœåŠ¡å™¨ï¼›<br>
2ã€å•åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªåº”ç”¨å¹¶éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼›<br>
3ã€å•åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªåº”ç”¨å¹¶å®ç°åˆ†å¸ƒå¼éƒ¨ç½²ï¼›<br>
4ã€æµåŠ¨è®¡ç®—æ¡†æ¶ï¼ˆç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒï¼‰</p>
<h4 id="1251-å•ä¸€åº”ç”¨æ¶æ„"><a class="markdownIt-Anchor" href="#1251-å•ä¸€åº”ç”¨æ¶æ„">#</a> 1.2.5.1 å•ä¸€åº”ç”¨æ¶æ„</h4>
<p>å½“ç½‘ç«™æµé‡å¾ˆå°æ—¶ï¼Œåªéœ€ä¸€ä¸ªåº”ç”¨ï¼Œå°†æ‰€æœ‰åŠŸèƒ½éƒ½éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä»¥å‡å°‘éƒ¨ç½²èŠ‚ç‚¹å’Œæˆæœ¬ã€‚ æ­¤æ—¶ï¼Œç”¨äºç®€åŒ–å¢åˆ æ”¹æŸ¥å·¥ä½œé‡çš„ æ•°æ®è®¿é—®æ¡†æ¶ ( <code>ORM</code> ) æ˜¯å…³é”®ã€‚</p>
<h4 id="1252-å‚ç›´åº”ç”¨æ¶æ„"><a class="markdownIt-Anchor" href="#1252-å‚ç›´åº”ç”¨æ¶æ„">#</a> 1.2.5.2 å‚ç›´åº”ç”¨æ¶æ„</h4>
<p>å½“è®¿é—®é‡é€æ¸å¢å¤§ï¼Œå•ä¸€åº”ç”¨å¢åŠ æœºå™¨å¸¦æ¥çš„åŠ é€Ÿåº¦è¶Šæ¥è¶Šå°ï¼Œå°†åº”ç”¨æ‹†æˆäº’ä¸ç›¸å¹²çš„å‡ ä¸ªåº”ç”¨ï¼Œä»¥æå‡æ•ˆç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºåŠ é€Ÿå‰ç«¯é¡µé¢å¼€å‘çš„  <code>Web</code>  æ¡†æ¶ ( <code>MVC</code> ) æ˜¯å…³é”®ã€‚</p>
<h4 id="1253-åˆ†å¸ƒå¼æœåŠ¡æ¶æ„"><a class="markdownIt-Anchor" href="#1253-åˆ†å¸ƒå¼æœåŠ¡æ¶æ„">#</a> 1.2.5.3 åˆ†å¸ƒå¼æœåŠ¡æ¶æ„</h4>
<p>å½“å‚ç›´åº”ç”¨è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨ä¹‹é—´äº¤äº’ä¸å¯é¿å…ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨åŠæ•´åˆçš„ åˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ ( <code>RPC</code> ) æ˜¯å…³é”®ã€‚</p>
<h4 id="1254-æµåŠ¨è®¡ç®—æ¶æ„"><a class="markdownIt-Anchor" href="#1254-æµåŠ¨è®¡ç®—æ¶æ„">#</a> 1.2.5.4 æµåŠ¨è®¡ç®—æ¶æ„</h4>
<p>å½“æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œå®¹é‡çš„è¯„ä¼°ï¼Œå°æœåŠ¡èµ„æºçš„æµªè´¹ç­‰é—®é¢˜é€æ¸æ˜¾ç°ï¼Œæ­¤æ—¶éœ€å¢åŠ ä¸€ä¸ªè°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›å®æ—¶ç®¡ç†é›†ç¾¤å®¹é‡ï¼Œæé«˜é›†ç¾¤åˆ©ç”¨ç‡ã€‚æ­¤æ—¶ï¼Œç”¨äºæé«˜æœºå™¨åˆ©ç”¨ç‡çš„ èµ„æºè°ƒåº¦å’Œæ²»ç†ä¸­å¿ƒ ( <code>SOA</code> ) æ˜¯å…³é”®ã€‚</p>
<h3 id="126-rpcçš„ç®€ä»‹"><a class="markdownIt-Anchor" href="#126-rpcçš„ç®€ä»‹">#</a> 1.2.6  <code>RPC</code>  çš„ç®€ä»‹</h3>
<p><strong> <code>RPC(Remote Procedure Call Protocol)</code> ï¼šè¿œç¨‹è¿‡ç¨‹è°ƒç”¨</strong></p>
<p>ä¸¤å°æœåŠ¡å™¨ <code>Aã€B</code> ï¼Œåˆ†åˆ«éƒ¨ç½²ä¸åŒçš„åº”ç”¨ <code>a,b</code> ã€‚å½“ <code>A</code>  æœåŠ¡å™¨æƒ³è¦è°ƒç”¨ <code>B</code>  æœåŠ¡å™¨ä¸Šåº”ç”¨ <code>b</code>  æä¾›çš„å‡½æ•°æˆ–æ–¹æ³•çš„æ—¶å€™ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰ä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚<br>
è¯´ç™½äº†ï¼Œå°±æ˜¯ä½ åœ¨ä½ çš„æœºå™¨ä¸Šå†™äº†ä¸€ä¸ªç¨‹åºï¼Œæˆ‘è¿™è¾¹æ˜¯æ— æ³•ç›´æ¥è°ƒç”¨çš„ï¼Œè¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†ä¸€ä¸ªè¿œç¨‹æœåŠ¡è°ƒç”¨çš„æ¦‚å¿µã€‚</p>
<p><code>RPC</code>  æ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚ <code>RPC</code>  åè®®å‡å®šæŸäº›ä¼ è¾“åè®®çš„å­˜åœ¨ï¼Œå¦‚ <code>TCP</code>  æˆ– <code>UDP</code> ï¼Œä¸ºé€šä¿¡ç¨‹åºä¹‹é—´æºå¸¦ä¿¡æ¯æ•°æ®ã€‚åœ¨ <code>OSI</code>  ç½‘ç»œé€šä¿¡æ¨¡å‹ä¸­ï¼Œ <code>RPC</code>  è·¨è¶Šäº†ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚ <code>RPC</code>  ä½¿å¾—å¼€å‘åŒ…æ‹¬ç½‘ç»œåˆ†å¸ƒå¼å¤šç¨‹åºåœ¨å†…çš„åº”ç”¨ç¨‹åºæ›´åŠ å®¹æ˜“ã€‚<br>
<strong> <code>RPC</code>  é‡‡ç”¨å®¢æˆ·æœº / æœåŠ¡å™¨æ¨¡å¼</strong>ã€‚è¯·æ±‚ç¨‹åºå°±æ˜¯ä¸€ä¸ªå®¢æˆ·æœºï¼Œè€ŒæœåŠ¡æä¾›ç¨‹åºå°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ã€‚é¦–å…ˆï¼Œå®¢æˆ·æœºè°ƒç”¨è¿›ç¨‹å‘é€ä¸€ä¸ªæœ‰è¿›ç¨‹å‚æ•°çš„è°ƒç”¨ä¿¡æ¯åˆ°æœåŠ¡è¿›ç¨‹ï¼Œç„¶åç­‰å¾…åº”ç­”ä¿¡æ¯ã€‚åœ¨æœåŠ¡å™¨ç«¯ï¼Œè¿›ç¨‹ä¿æŒç¡çœ çŠ¶æ€ç›´åˆ°è°ƒç”¨ä¿¡æ¯åˆ°è¾¾ä¸ºæ­¢ã€‚å½“ä¸€ä¸ªè°ƒç”¨ä¿¡æ¯åˆ°è¾¾ï¼ŒæœåŠ¡å™¨è·å¾—è¿›ç¨‹å‚æ•°ï¼Œè®¡ç®—ç»“æœï¼Œå‘é€ç­”å¤ä¿¡æ¯ï¼Œç„¶åç­‰å¾…ä¸‹ä¸€ä¸ªè°ƒç”¨ä¿¡æ¯ï¼Œæœ€åï¼Œå®¢æˆ·ç«¯è°ƒç”¨è¿›ç¨‹æ¥æ”¶ç­”å¤ä¿¡æ¯ï¼Œè·å¾—è¿›ç¨‹ç»“æœï¼Œç„¶åè°ƒç”¨æ‰§è¡Œç»§ç»­è¿›è¡Œã€‚</p>
<h4 id="1261-rpcéœ€è¦è§£å†³çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#1261-rpcéœ€è¦è§£å†³çš„é—®é¢˜">#</a> 1.2.6.1  <code>RPC</code>  éœ€è¦è§£å†³çš„é—®é¢˜</h4>
<ul>
<li><strong>é€šè®¯é—®é¢˜</strong>ï¼šä¸»è¦æ˜¯é€šè¿‡åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ TCP è¿æ¥ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„æ‰€æœ‰äº¤æ¢çš„æ•°æ®éƒ½åœ¨è¿™ä¸ªè¿æ¥é‡Œä¼ è¾“ã€‚è¿æ¥å¯ä»¥æ˜¯æŒ‰éœ€è¿æ¥ï¼Œè°ƒç”¨ç»“æŸåå°±æ–­æ‰ï¼Œä¹Ÿå¯ä»¥æ˜¯é•¿è¿æ¥ï¼Œå¤šä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨å…±äº«åŒä¸€ä¸ªè¿æ¥ã€‚</li>
<li><strong>å¯»å€é—®é¢˜</strong>ï¼šA æœåŠ¡å™¨ä¸Šçš„åº”ç”¨æ€ä¹ˆå‘Šè¯‰åº•å±‚çš„ RPC æ¡†æ¶ï¼Œå¦‚ä½•è¿æ¥åˆ° B æœåŠ¡å™¨ï¼ˆå¦‚ä¸»æœºæˆ– <code>IP</code>  åœ°å€ï¼‰ä»¥åŠç‰¹å®šçš„ç«¯å£ï¼Œæ–¹æ³•çš„åç§°åç§°æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·æ‰èƒ½å®Œæˆè°ƒç”¨ã€‚æ¯”å¦‚åŸºäº <code>Web</code>  æœåŠ¡åè®®æ ˆçš„ <code>RPC</code> ï¼Œå°±è¦æä¾›ä¸€ä¸ª <code>endpoint URI</code> ï¼Œæˆ–è€…æ˜¯ä» <code>UDDI</code>  æœåŠ¡ä¸ŠæŸ¥æ‰¾ã€‚å¦‚æœæ˜¯ <code>RMI</code>  è°ƒç”¨çš„è¯ï¼Œè¿˜éœ€è¦ä¸€ä¸ª <code>RMI Registry</code>  æ¥æ³¨å†ŒæœåŠ¡çš„åœ°å€ã€‚</li>
<li><strong>åºåˆ—åŒ– ä¸ ååºåˆ—åŒ–</strong>ï¼šå½“ <code>A</code>  æœåŠ¡å™¨ä¸Šçš„åº”ç”¨å‘èµ·è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œæ–¹æ³•çš„å‚æ•°éœ€è¦é€šè¿‡åº•å±‚çš„ç½‘ç»œåè®®å¦‚ <code>TCP</code>  ä¼ é€’åˆ° <code>B</code>  æœåŠ¡å™¨ï¼Œç”±äºç½‘ç»œåè®®æ˜¯åŸºäºäºŒè¿›åˆ¶çš„ï¼Œå†…å­˜ä¸­çš„å‚æ•°çš„å€¼è¦åºåˆ—åŒ–æˆäºŒè¿›åˆ¶çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–ï¼ˆ <code>Serialize</code> ï¼‰æˆ–ç¼–ç»„ï¼ˆ <code>marshal</code> ï¼‰ï¼Œé€šè¿‡å¯»å€å’Œä¼ è¾“å°†åºåˆ—åŒ–çš„äºŒè¿›åˆ¶å‘é€ç»™ <code>B</code>  æœåŠ¡å™¨ã€‚<br>
åŒç†ï¼Œ <code>B</code>  æœåŠ¡å™¨æ¥æ”¶å‚æ•°è¦å°†å‚æ•°ååºåˆ—åŒ–ã€‚B æœåŠ¡å™¨åº”ç”¨è°ƒç”¨è‡ªå·±çš„æ–¹æ³•å¤„ç†åè¿”å›çš„ç»“æœä¹Ÿè¦åºåˆ—åŒ–ç»™ <code>A</code>  æœåŠ¡å™¨ï¼Œ <code>A</code>  æœåŠ¡å™¨æ¥æ”¶ä¹Ÿè¦ç»è¿‡ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</li>
</ul>
<h2 id="13-dubboä½œç”¨"><a class="markdownIt-Anchor" href="#13-dubboä½œç”¨">#</a> 1.3  <code>Dubbo</code>  ä½œç”¨</h2>
<p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ <code>Dubbo</code>  çš„æœåŠ¡æ²»ç†å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b42b2f9c1b1e4c56b36ea55673c037fd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="131-ä¸ºä»€ä¹ˆä½¿ç”¨dubbo"><a class="markdownIt-Anchor" href="#131-ä¸ºä»€ä¹ˆä½¿ç”¨dubbo">#</a> 1.3.1 ä¸ºä»€ä¹ˆä½¿ç”¨ <code>Dubbo</code></h3>
<p>å› ä¸ºæ˜¯é˜¿é‡Œå¼€æºé¡¹ç›®ï¼Œå›½å†…å¾ˆå¤šäº’è”ç½‘å…¬å¸éƒ½åœ¨ç”¨ï¼Œå·²ç»ç»è¿‡å¾ˆå¤šçº¿ä¸Šè€ƒéªŒã€‚å†…éƒ¨ä½¿ç”¨äº† <code>Nettyã€Zookeeper</code> ï¼Œä¿è¯äº†é«˜æ€§èƒ½é«˜å¯ç”¨æ€§ã€‚</p>
<ul>
<li><strong>ä½¿ç”¨ <code>Dubbo</code>  å¯ä»¥å°†æ ¸å¿ƒä¸šåŠ¡æŠ½å–å‡ºæ¥ï¼Œä½œä¸ºç‹¬ç«‹çš„æœåŠ¡</strong>ï¼Œé€æ¸å½¢æˆç¨³å®šçš„æœåŠ¡ä¸­å¿ƒï¼Œå¯ç”¨äºæé«˜ä¸šåŠ¡å¤ç”¨çµæ´»æ‰©å±•ï¼Œä½¿å‰ç«¯åº”ç”¨èƒ½æ›´å¿«é€Ÿçš„å“åº”å¤šå˜çš„å¸‚åœºéœ€æ±‚ã€‚</li>
<li>åˆ†å¸ƒå¼æ¶æ„å¯ä»¥æ‰¿å—æ›´å¤§è§„æ¨¡çš„å¹¶å‘æµé‡ã€‚</li>
</ul>
<h3 id="132-dubboèƒ½åšä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#132-dubboèƒ½åšä»€ä¹ˆ">#</a> 1.3.2  <code>Dubbo</code>  èƒ½åšä»€ä¹ˆ</h3>
<p>1ã€<strong>é€æ˜åŒ–çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨</strong>ï¼Œå°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œåªéœ€ç®€å•é…ç½®ï¼Œæ²¡æœ‰ä»»ä½• <code>API</code>  ä¾µå…¥ã€‚<br>
2ã€<strong>è½¯è´Ÿè½½å‡è¡¡åŠå®¹é”™æœºåˆ¶</strong>ï¼Œå¯åœ¨å†…ç½‘æ›¿ä»£ <code>F5</code>  ç­‰ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼Œé™ä½æˆæœ¬ï¼Œå‡å°‘å•ç‚¹ã€‚<br>
3.ã€<strong>æœåŠ¡è‡ªåŠ¨æ³¨å†Œä¸å‘ç°</strong>ï¼Œä¸å†éœ€è¦å†™æ­»æœåŠ¡æä¾›æ–¹åœ°å€ï¼Œæ³¨å†Œä¸­å¿ƒåŸºäºæ¥å£åæŸ¥è¯¢æœåŠ¡æä¾›è€…çš„ <code>IP</code>  åœ°å€ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¹³æ»‘æ·»åŠ æˆ–åˆ é™¤æœåŠ¡æä¾›è€…ã€‚</p>
<p><strong> <code>Dubbo</code>  é‡‡ç”¨å…¨ <code>Spring</code>  é…ç½®æ–¹å¼ï¼Œé€æ˜åŒ–æ¥å…¥åº”ç”¨ï¼Œå¯¹åº”ç”¨æ²¡æœ‰ä»»ä½• <code>API</code>  ä¾µå…¥ï¼Œåªéœ€ç”¨ <code>Spring</code>  åŠ è½½ <code>Dubbo</code>  çš„é…ç½®å³å¯</strong>ï¼Œ <code>Dubbo</code>  åŸºäº <code>Spring</code>  çš„ <code>Schema</code>  æ‰©å±•è¿›è¡ŒåŠ è½½ã€‚</p>
<h2 id="14-dubbo-å’Œ-spring-cloudåŒºåˆ«"><a class="markdownIt-Anchor" href="#14-dubbo-å’Œ-spring-cloudåŒºåˆ«">#</a> 1.4  <code>Dubbo</code>  å’Œ  <code>Spring Cloud</code>  åŒºåˆ«</h2>
<p>1ã€<strong>é€šä¿¡æ–¹å¼ä¸åŒ</strong>ï¼š <code>Dubbo</code>  ä½¿ç”¨çš„æ˜¯  <code>RPC</code>  é€šä¿¡ï¼Œè€Œ <code>Spring Cloud</code>  ä½¿ç”¨çš„æ˜¯ <code>HTTP RESTFul</code>  æ–¹å¼ã€‚<br>
2ã€<strong>ç»„æˆä¸ä¸€æ ·</strong>ï¼š</p>
<ul>
<li><code>dubbo</code>  çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸º <code>Zookeerper</code> ï¼ŒæœåŠ¡ç›‘æ§ä¸­å¿ƒä¸º <code>dubbo-monitor</code> ï¼Œæ— æ¶ˆæ¯æ€»çº¿ã€æœåŠ¡è·Ÿè¸ªã€æ‰¹é‡ä»»åŠ¡ç­‰ç»„ä»¶ï¼›</li>
<li><code>Spring Cloud</code>  çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸º <code>spring-cloud netflix enruka</code> ï¼ŒæœåŠ¡ç›‘æ§ä¸­å¿ƒä¸º <code>spring-boot admin</code> ï¼Œæœ‰æ¶ˆæ¯æ€»çº¿ã€æ•°æ®æµã€æœåŠ¡è·Ÿè¸ªã€æ‰¹é‡ä»»åŠ¡ç­‰ç»„ä»¶ï¼›</li>
</ul>
<h2 id="15-dubboæŠ€æœ¯æ¶æ„"><a class="markdownIt-Anchor" href="#15-dubboæŠ€æœ¯æ¶æ„">#</a> 1.5  <code>Dubbo</code>  æŠ€æœ¯æ¶æ„</h2>
<p>é¦–å…ˆæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ <code>Dubbo</code>  å®˜ç½‘æä¾›çš„æ¶æ„å›¾ï¼š<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7792efd1449d4117b828af6c1022e089.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<strong>èŠ‚ç‚¹è§’è‰²è¯´æ˜</strong></p>
<table>
<thead>
<tr>
<th>èŠ‚ç‚¹</th>
<th>è§’è‰²è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Provider</td>
<td>æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</td>
</tr>
<tr>
<td>Consumer</td>
<td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</td>
</tr>
<tr>
<td>Registry</td>
<td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td>
</tr>
<tr>
<td>Monitor</td>
<td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td>
</tr>
<tr>
<td>Container</td>
<td>æœåŠ¡è¿è¡Œå®¹å™¨</td>
</tr>
</tbody>
</table>
<p>çœ‹äº†è¿™å‡ ä¸ªæ¦‚å¿µåä¼¼ä¹å‘ç°å…¶å® <code>Dubbo</code>  çš„æ¶æ„ä¹Ÿæ˜¯å¾ˆç®€å•çš„ (å…¶å®ç°ç»†èŠ‚æ˜¯å¤æ‚)ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œæœ‰æ²¡æœ‰å‘ç°ï¼Œå…¶å®å¾ˆåƒ<strong>ç”Ÿäº§è€… - æ¶ˆè´¹è€…</strong>æ¨¡å‹ã€‚åªæ˜¯åœ¨è¿™ç§æ¨¡å‹ä¸Šï¼ŒåŠ ä¸Šäº†<strong>æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒ</strong>ï¼Œç”¨äºç®¡ç†æä¾›æ–¹æä¾›çš„ <code>url</code> ï¼Œä»¥åŠç®¡ç†æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<p><strong>è°ƒç”¨å…³ç³»è¯´æ˜</strong></p>
<p>1ã€æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚<br>
2ã€æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚<br>
3ã€æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚<br>
4ã€æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚<br>
5ã€æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚<br>
6ã€æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</p>
<hr>
<p>é‚£ä¹ˆï¼Œæ•´ä¸ª<strong>å‘å¸ƒ - è®¢é˜…</strong>çš„è¿‡ç¨‹å°±éå¸¸çš„ç®€å•äº†ï¼š</p>
<ul>
<li>å¯åŠ¨å®¹å™¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚</li>
<li>æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒå‘å¸ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œåœ¨æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚</li>
</ul>
<p>å¦‚æœè€ƒè™‘<strong>å¤±è´¥æˆ–å˜æ›´</strong>çš„æƒ…å†µï¼Œå°±éœ€è¦è€ƒè™‘ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚</li>
</ul>
<h2 id="16-dubboå…¥é—¨æ¡ˆä¾‹"><a class="markdownIt-Anchor" href="#16-dubboå…¥é—¨æ¡ˆä¾‹">#</a> 1.6  <code>Dubbo</code>  å…¥é—¨æ¡ˆä¾‹</h2>
<h3 id="161-æœåŠ¡ç«¯"><a class="markdownIt-Anchor" href="#161-æœåŠ¡ç«¯">#</a> 1.6.1 æœåŠ¡ç«¯</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæŠŠæœåŠ¡ç«¯çš„æ¥å£å†™å¥½ï¼Œå› ä¸ºå…¶å® <code>dubbo</code>  çš„ä½œç”¨ç®€å•æ¥è¯´å°±æ˜¯ç»™æ¶ˆè´¹ç«¯æä¾›æ¥å£ã€‚</p>
<p><strong>æ¥å£å®šä¹‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xmlæ–¹å¼æœåŠ¡æä¾›è€…æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProviderService</span> &#123;</span><br><span class="line">    String <span class="title function_">SayHello</span><span class="params">(String word)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ¥å£éå¸¸ç®€å•ï¼Œåªæ˜¯åŒ…å«ä¸€ä¸ª  <code>SayHello</code>  çš„æ–¹æ³•ã€‚</p>
<p>æ¥ç€ï¼Œå®šä¹‰å®ƒçš„<strong>å®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xmlæ–¹å¼æœåŠ¡æä¾›è€…å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ProviderService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">SayHello</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±æŠŠæˆ‘ä»¬çš„æ¥å£å†™å¥½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå°†æˆ‘ä»¬çš„æœåŠ¡æš´éœ²å‡ºå»å‘¢ï¼Ÿ</p>
<p><strong>å¯¼å…¥ maven ä¾èµ–</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ouyangsihai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.32.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨çš„ <code>dubbo</code>  çš„ç‰ˆæœ¬æ˜¯ <code>2.6.6</code> ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ åªå¯¼å…¥ <code>dubbo</code>  çš„åŒ…çš„æ—¶å€™æ˜¯ä¼šæŠ¥é”™çš„ï¼Œæ‰¾ä¸åˆ° <code>netty</code>  å’Œ <code>curator</code>  çš„ä¾èµ–ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸¤ä¸ªçš„ä¾èµ–åŠ ä¸Šï¼Œå°±ä¸ä¼šæŠ¥é”™äº†ã€‚</p>
<p>å¦å¤–ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨  <code>zookeeper</code>  ä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œ <code>dubbo</code>  éœ€è¦çš„ç¯å¢ƒå°±å·²ç»å¯ä»¥äº†ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬å°±æŠŠä¸Šé¢åˆšåˆšå®šä¹‰çš„æ¥å£æš´éœ²å‡ºå»ã€‚</p>
<p><strong>æš´éœ²æ¥å£ï¼ˆ <code>xml</code>  é…ç½®æ–¹æ³•ï¼‰</strong><br>
é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬é¡¹ç›®çš„ <code>resource</code>  ç›®å½•ä¸‹åˆ›å»º  <code>META-INF.spring</code>  åŒ…ï¼Œç„¶åå†åˆ›å»º  <code>provider.xml</code>  æ–‡ä»¶ï¼Œåå­—å¯ä»¥ä»»å–å“¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5b512b42ca2b41ed82fd82aaeee060dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰é¡¹ç›®åœ¨æ•´ä¸ªåˆ†å¸ƒå¼æ¶æ„é‡Œé¢çš„å”¯ä¸€åç§°ï¼Œè®¡ç®—ä¾èµ–å…³ç³»çš„æ ‡ç­¾--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;provider&quot;</span> <span class="attr">owner</span>=<span class="string">&quot;sihai&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.enable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.accept.foreign.ip&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;55555&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:monitor</span> <span class="attr">protocol</span>=<span class="string">&quot;registry&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubboè¿™ä¸ªæœåŠ¡æ‰€è¦æš´éœ²çš„æœåŠ¡åœ°å€æ‰€å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:registry address=&quot;N/A&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;N/A&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰æœåŠ¡å‘å¸ƒæ‰€ä¾èµ–çš„åè®®ï¼›webserviceã€Thriftã€Hessainã€http--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Bean beanå®šä¹‰--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<p>1ã€ä¸Šé¢çš„æ–‡ä»¶å…¶å®å°±æ˜¯ç±»ä¼¼  <code>spring</code>  çš„é…ç½®æ–‡ä»¶ï¼Œè€Œä¸”ï¼Œ <code>dubbo</code>  åº•å±‚å°±æ˜¯  <code>spring</code> ã€‚<br>
2ã€èŠ‚ç‚¹ï¼š <code>dubbo:application</code> <br>
 å°±æ˜¯æ•´ä¸ªé¡¹ç›®åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­çš„å”¯ä¸€åç§°ï¼Œå¯ä»¥åœ¨ <code>name</code>  å±æ€§ä¸­é…ç½®ï¼Œå¦å¤–è¿˜å¯ä»¥é…ç½® <code>owner</code>  å­—æ®µï¼Œè¡¨ç¤ºå±äºè°ã€‚<br>
ä¸‹é¢çš„å‚æ•°æ˜¯å¯ä»¥ä¸é…ç½®çš„ï¼Œè¿™é‡Œé…ç½®æ˜¯å› ä¸ºå‡ºç°äº†ç«¯å£çš„å†²çªï¼Œæ‰€ä»¥é…ç½®ã€‚<br>
3ã€èŠ‚ç‚¹ï¼š <code>dubbo:monitor</code> <br>
 ç›‘æ§ä¸­å¿ƒé…ç½®ï¼Œ ç”¨äºé…ç½®è¿æ¥ç›‘æ§ä¸­å¿ƒç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥ä¸é…ç½®ï¼Œä¸æ˜¯å¿…é¡»çš„å‚æ•°ã€‚<br>
4ã€èŠ‚ç‚¹ï¼š <code>dubbo:registry</code> <br>
 é…ç½®æ³¨å†Œä¸­å¿ƒçš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é…ç½®  <code>zookeeper</code>  ä½œä¸ºæˆ‘ä»¬çš„æ³¨å†Œä¸­å¿ƒã€‚ <code>address</code>  æ˜¯æ³¨å†Œä¸­å¿ƒçš„åœ°å€ï¼Œè¿™é‡Œæˆ‘ä»¬é…ç½®çš„æ˜¯  <code>N/A</code>  è¡¨ç¤ºç”±  <code>dubbo</code>  è‡ªåŠ¨åˆ†é…åœ°å€ã€‚æˆ–è€…è¯´æ˜¯ä¸€ç§ç›´è¿çš„æ–¹å¼ï¼Œä¸é€šè¿‡æ³¨å†Œä¸­å¿ƒã€‚<br>
5ã€èŠ‚ç‚¹ï¼š <code>dubbo:protocol</code> <br>
 æœåŠ¡å‘å¸ƒçš„æ—¶å€™  <code>dubbo</code>  ä¾èµ–ä»€ä¹ˆåè®®ï¼Œå¯ä»¥é…ç½® <code>dubbo</code> ã€ <code>webservice</code> ã€ <code>http</code>  ç­‰åè®®ã€‚<br>
6ã€èŠ‚ç‚¹ï¼š <code>dubbo:service</code> <br>
 è¿™ä¸ªèŠ‚ç‚¹å°±æ˜¯æˆ‘ä»¬çš„é‡ç‚¹äº†ï¼Œå½“æˆ‘ä»¬æœåŠ¡å‘å¸ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡è¿™ä¸ªé…ç½®å°†æˆ‘ä»¬çš„æœåŠ¡å‘å¸ƒå‡ºå»çš„ã€‚ <code>interface</code>  æ˜¯æ¥å£çš„åŒ…è·¯å¾„ï¼Œ <code>ref</code>  æ˜¯ç¬¬ â‘¦ ç‚¹é…ç½®çš„æ¥å£çš„ <code>bean</code> ã€‚<br>
7ã€æœ€åï¼Œæˆ‘ä»¬éœ€è¦åƒé…ç½® <code>spring</code>  çš„æ¥å£ä¸€æ ·ï¼Œé…ç½®æ¥å£çš„  <code>bean</code> ã€‚</p>
<p>åˆ°è¿™ä¸€æ­¥ï¼Œå…³äºæœåŠ¡ç«¯çš„é…ç½®å°±å®Œæˆäº†ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡  <code>main</code>  æ–¹æ³•å°†æ¥å£å‘å¸ƒå‡ºå»ã€‚</p>
<p><strong>å‘å¸ƒæ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ProtocolConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ServiceConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.container.Main;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderService;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xmlæ–¹å¼å¯åŠ¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//åŠ è½½xmlé…ç½®æ–‡ä»¶å¯åŠ¨</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;META-INF/spring/provider.xml&quot;</span>);</span><br><span class="line">        context.start();</span><br><span class="line">        System.in.read(); <span class="comment">// æŒ‰ä»»æ„é”®é€€å‡º</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘å¸ƒæ¥å£éå¸¸ç®€å•ï¼Œå› ä¸º <code>dubbo</code>  åº•å±‚å°±æ˜¯ä¾èµ–  <code>spring</code>  çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡  <code>ClassPathXmlApplicationContext</code>  æ‹¿åˆ°æˆ‘ä»¬åˆšåˆšé…ç½®å¥½çš„  <code>xml</code> ï¼Œç„¶åè°ƒç”¨  <code>context.start()</code>  æ–¹æ³•å°±å¯åŠ¨äº†ã€‚</p>
<p>çœ‹åˆ°ä¸‹é¢çš„æˆªå›¾ï¼Œå°±ç®—æ˜¯å¯åŠ¨æˆåŠŸäº†ï¼Œæ¥å£ä¹Ÿå°±å‘å¸ƒå‡ºå»äº†ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fb50e61a90ab4e6c873323a7bac4d345.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ä½ ä»¥ä¸ºåˆ°è¿™é‡Œå°±ç»“æŸäº†äº†ï¼Œå¹¶ä¸æ˜¯çš„ï¼Œæˆ‘ä»¬æ‹¿åˆ°  <code>dubbo</code>  æš´éœ²å‡ºå»çš„  <code>url</code>  åˆ†æåˆ†æã€‚</p>
<p><strong>Dubbo æš´éœ²çš„ URL</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dubbo://192.168.234.1:20880/com.sihai.dubbo.provider.service.ProviderService?anyhost=true&amp;application=provider&amp;bean.name=com.sihai.dubbo.provider.service.ProviderService&amp;bind.ip=192.168.234.1&amp;bind.port=20880&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.sihai.dubbo.provider.service.ProviderService&amp;methods=SayHello&amp;owner=sihai&amp;pid=8412&amp;qos.accept.foreign.ip=false&amp;qos.enable=true&amp;qos.port=55555&amp;side=provider&amp;timestamp=1562077289380</span><br></pre></td></tr></table></figure>
<p>åˆ†æå¦‚ä¸‹ï¼š</p>
<p>1ã€é¦–å…ˆï¼Œåœ¨å½¢å¼ä¸Šæˆ‘ä»¬å‘ç°ï¼Œå…¶å®è¿™ä¹ˆç‰›é€¼çš„  <code>dubbo</code>  ä¹Ÿæ˜¯ç”¨ç±»ä¼¼äº  <code>http</code>  çš„åè®®å‘å¸ƒè‡ªå·±çš„æœåŠ¡çš„ï¼Œåªæ˜¯è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯ <code>dubbo</code>  åè®®ã€‚<br>
2ã€ <code>dubbo://192.168.234.1:20880/com.sihai.dubbo.provider.service.ProviderService</code> <br>
 ä¸Šé¢è¿™æ®µé“¾æ¥å°±æ˜¯  <code>?</code>  ä¹‹å‰çš„é“¾æ¥ï¼Œæ„æˆï¼š<strong>åè®®://ip: ç«¯å£ / æ¥å£</strong>ã€‚å‘ç°æ˜¯ä¸æ˜¯ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç¥ç§˜çš„ã€‚<br>
3ã€ <code>anyhost=true&amp;application=provider&amp;bean.name=com.sihai.dubbo.provider.service.ProviderService&amp;bind.ip=192.168.234.1&amp;bind.port=20880&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.sihai.dubbo.provider.service.ProviderService&amp;methods=SayHello&amp;owner=sihai&amp;pid=8412&amp;qos.accept.foreign.ip=false&amp;qos.enable=true&amp;qos.port=55555&amp;side=provider&amp;timestamp=1562077289380</code> <br>
 <code>?</code>  ä¹‹åçš„å­—ç¬¦ä¸²ï¼Œåˆ†æåä½ å‘ç°ï¼Œè¿™äº›éƒ½æ˜¯åˆšåˆšåœ¨ <code>provider.xml</code>  ä¸­é…ç½®çš„å­—æ®µï¼Œç„¶åé€šè¿‡ <code>&amp;</code>  æ‹¼æ¥è€Œæˆçš„ï¼Œé—»åˆ°äº†  <code>http</code>  çš„é¦™å‘³äº†å—ï¼Ÿ</p>
<p>ç»ˆäºï¼Œ <code>dubbo</code>  æœåŠ¡ç«¯å…¥é—¨äº†ã€‚ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ‹¿åˆ°äº†  <code>url</code>  åï¼Œæ€ä¹ˆæ¶ˆè´¹å‘¢ï¼Ÿ</p>
<h3 id="162-æ¶ˆè´¹ç«¯"><a class="markdownIt-Anchor" href="#162-æ¶ˆè´¹ç«¯">#</a> 1.6.2 æ¶ˆè´¹ç«¯</h3>
<p>ä¸Šé¢æåˆ°ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯æä¾›çš„åªæ˜¯ç‚¹å¯¹ç‚¹çš„æ–¹å¼æä¾›æœåŠ¡ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨æ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥ï¼Œä¸‹é¢çš„é…ç½®ä¹Ÿæ˜¯ä¼šæœ‰ä¸€äº›ä¸ä¸€æ ·çš„ã€‚</p>
<p><strong>æ¶ˆè´¹ç«¯ç¯å¢ƒé…ç½®</strong><br>
é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨æ¶ˆè´¹ç«¯çš„  <code>resource</code>  ä¸‹å»ºç«‹é…ç½®æ–‡ä»¶  <code>consumer.xml</code></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e6964bf9a44b442ca792e91ca7e098b0.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰é¡¹ç›®åœ¨æ•´ä¸ªåˆ†å¸ƒå¼æ¶æ„é‡Œé¢çš„å”¯ä¸€åç§°ï¼Œè®¡ç®—ä¾èµ–å…³ç³»çš„æ ‡ç­¾--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;consumer&quot;</span> <span class="attr">owner</span>=<span class="string">&quot;sihai&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubboè¿™ä¸ªæœåŠ¡æ‰€è¦æš´éœ²çš„æœåŠ¡åœ°å€æ‰€å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç‚¹å¯¹ç‚¹çš„æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;N/A&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot; check=&quot;false&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç”Ÿæˆä¸€ä¸ªè¿œç¨‹æœåŠ¡çš„è°ƒç”¨ä»£ç†--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç‚¹å¯¹ç‚¹æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">url</span>=<span class="string">&quot;dubbo://192.168.234.1:20880/com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:reference id=&quot;providerService&quot;  </span></span><br><span class="line"><span class="comment">                    interface=&quot;com.sihai.dubbo.provider.service.ProviderService&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åˆ†æå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>1ã€å‘ç°è¿™é‡Œçš„  <code>dubbo:application</code>  å’Œ  <code>dubbo:registry</code>  æ˜¯ä¸€è‡´çš„<br>
 2ã€ <code>dubbo:reference</code>  ï¼šæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨ç‚¹å¯¹ç‚¹çš„æ–¹å¼ï¼Œæ‰€ä»¥ï¼Œéœ€è¦é…ç½®åœ¨æœåŠ¡ç«¯æš´éœ²çš„  <code>url</code></p>
<p><strong>maven ä¾èµ–</strong><br>
å’ŒæœåŠ¡ç«¯ä¸€æ ·</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ouyangsihai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.ouyangsihai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-provider<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.netty<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>netty-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.32.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>è°ƒç”¨æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ReferenceConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * xmlçš„æ–¹å¼è°ƒç”¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        ClassPathXmlApplicationContext context=<span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;consumer.xml&quot;</span>);</span><br><span class="line">        context.start();</span><br><span class="line">        <span class="type">ProviderService</span> <span class="variable">providerService</span> <span class="operator">=</span> (ProviderService) context.getBean(<span class="string">&quot;providerService&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> providerService.SayHello(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">        System.in.read();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå’ŒæœåŠ¡ç«¯çš„å‘å¸ƒå¦‚å‡ºä¸€è¾™<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/af173265c9fd4e72a6118916e5f4bf32.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å¦‚æ­¤ï¼Œæˆ‘ä»¬å°±æˆåŠŸè°ƒç”¨æ¥å£äº†ã€‚</p>
<h2 id="17-åŠ å…¥zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒ"><a class="markdownIt-Anchor" href="#17-åŠ å…¥zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒ">#</a> 1.7 åŠ å…¥ <code>zookeeper</code>  ä½œä¸ºæ³¨å†Œä¸­å¿ƒ</h2>
<p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„æ³¨å†Œä¸­å¿ƒï¼Œè€Œæ˜¯ç”¨ä¸€ç§ç›´è¿çš„æ–¹å¼è¿›è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå®é™…ä¸Šå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨ <code>dubbo + zookeeper</code>  çš„æ–¹å¼ï¼Œä½¿ç”¨  <code>zookeeper</code>  ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»‹ç»ä¸€ä¸‹  <code>zookeeper</code>  ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„å…¥é—¨å®ä¾‹ä¸­è¿›è¡Œæ”¹é€ ã€‚</p>
<h3 id="171-æœåŠ¡ç«¯"><a class="markdownIt-Anchor" href="#171-æœåŠ¡ç«¯">#</a> 1.7.1 æœåŠ¡ç«¯</h3>
<p>åœ¨æœåŠ¡ç«¯ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ <code>provider.xml</code>  å³å¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰é¡¹ç›®åœ¨æ•´ä¸ªåˆ†å¸ƒå¼æ¶æ„é‡Œé¢çš„å”¯ä¸€åç§°ï¼Œè®¡ç®—ä¾èµ–å…³ç³»çš„æ ‡ç­¾--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;provider&quot;</span> <span class="attr">owner</span>=<span class="string">&quot;sihai&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.enable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.accept.foreign.ip&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">&quot;qos.port&quot;</span> <span class="attr">value</span>=<span class="string">&quot;55555&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:application</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:monitor</span> <span class="attr">protocol</span>=<span class="string">&quot;registry&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubboè¿™ä¸ªæœåŠ¡æ‰€è¦æš´éœ²çš„æœåŠ¡åœ°å€æ‰€å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:registry address=&quot;N/A&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://localhost:2181&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰æœåŠ¡å‘å¸ƒæ‰€ä¾èµ–çš„åè®®ï¼›webserviceã€Thriftã€Hessainã€http--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--Bean beanå®šä¹‰--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹å…³æ³¨è¿™å¥è¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>åœ¨  <code>address</code>  ä¸­ï¼Œä½¿ç”¨æˆ‘ä»¬çš„  <code>zookeeper</code>  çš„åœ°å€ã€‚</p>
<p>å¦‚æœæ˜¯ <code>zookeeper</code>  é›†ç¾¤çš„è¯ï¼Œä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;192.168.11.129:2181,192.168.11.137:2181,192.168.11.138:2181&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>æœåŠ¡ç«¯çš„é…ç½®å°±å¥½äº†ï¼Œå…¶ä»–çš„è·Ÿ å…¥é—¨æ¡ˆä¾‹ ä¸€æ ·ã€‚</p>
<h3 id="172-æ¶ˆè´¹ç«¯"><a class="markdownIt-Anchor" href="#172-æ¶ˆè´¹ç«¯">#</a> 1.7.2 æ¶ˆè´¹ç«¯</h3>
<p>è·ŸæœåŠ¡ç«¯ä¸€æ ·ï¼Œåœ¨æ¶ˆè´¹ç«¯ï¼Œæˆ‘ä»¬ä¹Ÿåªéœ€è¦ä¿®æ”¹  <code>consumer.xml</code>  å³å¯ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://code.alibabatech.com/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å½“å‰é¡¹ç›®åœ¨æ•´ä¸ªåˆ†å¸ƒå¼æ¶æ„é‡Œé¢çš„å”¯ä¸€åç§°ï¼Œè®¡ç®—ä¾èµ–å…³ç³»çš„æ ‡ç­¾--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;consumer&quot;</span> <span class="attr">owner</span>=<span class="string">&quot;sihai&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--dubboè¿™ä¸ªæœåŠ¡æ‰€è¦æš´éœ²çš„æœåŠ¡åœ°å€æ‰€å¯¹åº”çš„æ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç‚¹å¯¹ç‚¹çš„æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:registry address=&quot;N/A&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://localhost:2181&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--ç”Ÿæˆä¸€ä¸ªè¿œç¨‹æœåŠ¡çš„è°ƒç”¨ä»£ç†--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç‚¹å¯¹ç‚¹æ–¹å¼--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;dubbo:reference id=&quot;providerService&quot;</span></span><br><span class="line"><span class="comment">                     interface=&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span><br><span class="line"><span class="comment">                     url=&quot;dubbo://192.168.234.1:20880/com.sihai.dubbo.provider.service.ProviderService&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1ã€æ³¨å†Œä¸­å¿ƒé…ç½®è·ŸæœåŠ¡ç«¯ä¸€æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>2ã€ <code>dubbo:reference</code> <br>
 ç”±äºæˆ‘ä»¬è¿™é‡Œä½¿ç”¨  <code>zookeeper</code>  ä½œä¸ºæ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥ï¼Œè·Ÿç‚¹å¯¹ç‚¹çš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†éœ€è¦  <code>dubbo</code>  æœåŠ¡ç«¯æä¾›çš„ url äº†ï¼Œåªéœ€è¦ç›´æ¥å¼•ç”¨æœåŠ¡ç«¯æä¾›çš„æ¥å£å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:reference id=&quot;providerService&quot;</span><br><span class="line">                     interface=&quot;com.sihai.dubbo.provider.service.ProviderService&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p>å¥½äº†ï¼Œæ¶ˆè´¹ç«¯ä¹Ÿé…ç½®å¥½äº†ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¿®æ”¹çš„å…¥é—¨æ¡ˆä¾‹ï¼Œé‡æ–°å¯åŠ¨è¿è¡Œäº†ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7a5a1b4a974a48ceb5aa80f1d516f5f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
åŒæ ·æˆåŠŸäº†ã€‚</p>
<p>è¿™æ—¶å€™çš„åŒºåˆ«åœ¨äºï¼Œ<strong>å°†  <code>dubbo</code>  å‘å¸ƒçš„ <code>url</code>  æ³¨å†Œåˆ°äº†  <code>zookeeper</code> ï¼Œæ¶ˆè´¹ç«¯ä»  <code>zookeeper</code>  æ¶ˆè´¹ï¼Œ <code>zookeeper</code>  ç›¸å½“äºä¸€ä¸ªä¸­ä»‹ï¼Œç»™æ¶ˆè´¹è€…æä¾›æœåŠ¡</strong>ã€‚</p>
<p>ä½ ä»¥ä¸ºè¿™å°±å®Œäº†ï¼Ÿä¸ï¼Œå¥½æˆæ‰åˆšåˆšå¼€å§‹å‘¢ã€‚</p>
<h2 id="18-å¤šç§é…ç½®æ–¹å¼"><a class="markdownIt-Anchor" href="#18-å¤šç§é…ç½®æ–¹å¼">#</a> 1.8 å¤šç§é…ç½®æ–¹å¼</h2>
<p>åœ¨å…¥é—¨å®ä¾‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯  <code>xml</code>  é…ç½®çš„æ–¹å¼ï¼Œå¯¹  <code>dubbo</code>  çš„ç¯å¢ƒè¿›è¡Œäº†é…ç½®ï¼Œä½†æ˜¯ï¼Œå®˜æ–¹è¿˜æä¾›äº†å…¶ä»–çš„é…ç½®æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿä¸€ä¸€åˆ†è§£ã€‚</p>
<h3 id="181-apié…ç½®æ–¹å¼"><a class="markdownIt-Anchor" href="#181-apié…ç½®æ–¹å¼">#</a> 1.8.1  <code>API</code>  é…ç½®æ–¹å¼</h3>
<p>è¿™ç§æ–¹å¼å…¶å®å®˜æ–¹æ˜¯ä¸å¤ªæ¨èçš„ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ <code>xml</code>  é…ç½®çš„æ–¹å¼ï¼Œä½†æ˜¯ï¼Œåœ¨æœ‰çš„æ—¶å€™æµ‹è¯•çš„æ—¶å€™ï¼Œè¿˜æ˜¯å¯ä»¥ç”¨çš„åˆ°çš„ï¼Œå¦å¤–ï¼Œä¸ºäº†ä¿è¯å®Œæ•´æ€§ï¼Œè¿™äº›å†…å®¹è¿˜æ˜¯æœ‰å¿…è¦è®²è®²çš„ã€‚</p>
<p>é¦–å…ˆè¿˜æ˜¯å›åˆ°æœåŠ¡ç«¯å·¥ç¨‹ã€‚</p>
<p><strong>æœåŠ¡ç«¯</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e0f491e8de154c93b814e9e87df52f54.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨  <code>api</code>  çš„æ–¹å¼é…ç½®ï¼Œæ‰€ä»¥ï¼Œ <code>provider.xml</code>  è¿™ä¸ªé…ç½®æ–‡ä»¶å°±æš‚æ—¶ä¸éœ€è¦äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä¸Šé¢çš„  <code>AppApi</code>  è¿™ä¸ªç±»ä¸­çš„  <code>main</code>  æ–¹æ³•ä¸­ç”¨ <code>api</code>  é…ç½®åŠå¯åŠ¨å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ProtocolConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ServiceConfig;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderService;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Apiæ–¹å¼å¯åŠ¨</span></span><br><span class="line"><span class="comment"> * apiçš„æ–¹å¼è°ƒç”¨ä¸éœ€è¦å…¶ä»–çš„é…ç½®ï¼Œåªéœ€è¦ä¸‹é¢çš„ä»£ç å³å¯ã€‚</span></span><br><span class="line"><span class="comment"> * ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå®˜æ–¹å»ºè®®ï¼š</span></span><br><span class="line"><span class="comment"> * Apiæ–¹å¼ç”¨äºæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ï¼Œæ¨èxmlçš„æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppApi</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœåŠ¡å®ç°</span></span><br><span class="line">        <span class="type">ProviderService</span> <span class="variable">providerService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProviderServiceImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å½“å‰åº”ç”¨é…ç½®</span></span><br><span class="line">        <span class="type">ApplicationConfig</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationConfig</span>();</span><br><span class="line">        application.setName(<span class="string">&quot;provider&quot;</span>);</span><br><span class="line">        application.setOwner(<span class="string">&quot;sihai&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½®</span></span><br><span class="line">        <span class="type">RegistryConfig</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistryConfig</span>();</span><br><span class="line">        registry.setAddress(<span class="string">&quot;zookeeper://localhost:2181&quot;</span>);</span><br><span class="line"><span class="comment">//        registry.setUsername(&quot;aaa&quot;);</span></span><br><span class="line"><span class="comment">//        registry.setPassword(&quot;bbb&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœåŠ¡æä¾›è€…åè®®é…ç½®</span></span><br><span class="line">        <span class="type">ProtocolConfig</span> <span class="variable">protocol</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProtocolConfig</span>();</span><br><span class="line">        protocol.setName(<span class="string">&quot;dubbo&quot;</span>);</span><br><span class="line">        protocol.setPort(<span class="number">20880</span>);</span><br><span class="line">        <span class="comment">//protocol.setThreads(200);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šServiceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œ</span></span><br><span class="line">        <span class="comment">//ä»¥åŠå¼€å¯æœåŠ¡ç«¯å£</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡é…ç½®</span></span><br><span class="line">        <span class="comment">// æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œ</span></span><br><span class="line">        <span class="comment">//å¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼</span></span><br><span class="line">        ServiceConfig&lt;ProviderService&gt; service = <span class="keyword">new</span> <span class="title class_">ServiceConfig</span>&lt;ProviderService&gt;(); </span><br><span class="line">        service.setApplication(application);</span><br><span class="line">        <span class="comment">// å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries()</span></span><br><span class="line">        service.setRegistry(registry); </span><br><span class="line">        <span class="comment">// å¤šä¸ªåè®®å¯ä»¥ç”¨setProtocols()</span></span><br><span class="line">        service.setProtocol(protocol); </span><br><span class="line">        service.setInterface(ProviderService.class);</span><br><span class="line">        service.setRef(providerService);</span><br><span class="line">        service.setVersion(<span class="string">&quot;1.0.0&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æš´éœ²åŠæ³¨å†ŒæœåŠ¡</span></span><br><span class="line">        service.export();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†æè¯´æ˜å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>çœ‹åˆ°ä¸Šé¢çš„ä»£ç æ˜¯ä¸æ˜¯äº‘é‡Œé›¾é‡Œï¼Œä¸è¦æ…Œï¼Œæˆ‘ä»¬é€šè¿‡å¯¹ç…§  <code>xml</code>  çš„æ–¹å¼åˆ†æä¸€ä¸‹ã€‚</p>
<p><strong>registry çš„ xml æ–¹å¼</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;localhost:2181&quot;/&gt;</span><br></pre></td></tr></table></figure>
<p><strong>API çš„æ–¹å¼</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RegistryConfig</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistryConfig</span>();</span><br><span class="line">registry.setAddress(<span class="string">&quot;zookeeper://localhost:2181&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>dubbo:registry</code>  èŠ‚ç‚¹å¯¹åº” <code>RegistryConfig</code>  ï¼Œ <code>xml</code>  çš„å±æ€§å¯¹åº”  <code>API</code>  æ–¹å¼ç”¨  <code>set</code>  æ–¹æ³•å°±å¯ä»¥äº†ã€‚å¯¹æ¯”ä¹‹ä¸‹ï¼Œä½ å°±ä¼šå‘ç°ï¼Œå¦‚æœ  <code>API</code>  çš„æ–¹å¼ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å¯¹ç…§ <code>xml</code>  é…ç½®æ–¹å¼å°±å¯ä»¥ã€‚</p>
<p><strong>å…¶ä»– API</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">org.apache.dubbo.config.ServiceConfig</span><br><span class="line">org.apache.dubbo.config.ReferenceConfig</span><br><span class="line">org.apache.dubbo.config.ProtocolConfig</span><br><span class="line">org.apache.dubbo.config.RegistryConfig</span><br><span class="line">org.apache.dubbo.config.MonitorConfig</span><br><span class="line">org.apache.dubbo.config.ApplicationConfig</span><br><span class="line">org.apache.dubbo.config.ModuleConfig</span><br><span class="line">org.apache.dubbo.config.ProviderConfig</span><br><span class="line">org.apache.dubbo.config.ConsumerConfig</span><br><span class="line">org.apache.dubbo.config.MethodConfig</span><br><span class="line">org.apache.dubbo.config.ArgumentConfig</span><br></pre></td></tr></table></figure>
<p>æ›´è¯¦ç»†çš„å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š</p>
<blockquote>
<p>http://<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=dubbo&amp;spm=1001.2101.3001.7020">dubbo</a>.apache.org/zh-cnâ€¦</p>
</blockquote>
<p>æˆ‘ä»¬å†çœ‹çœ‹æˆ‘é…ç½®çš„æ¶ˆè´¹ç«¯çš„ <code>Api</code>  æ–¹å¼ã€‚</p>
<p><strong>æ¶ˆè´¹ç«¯</strong><br>
åŒæ ·ï¼Œæˆ‘ä»¬ä¸éœ€è¦  <code>consumer.xml</code>  é…ç½®æ–‡ä»¶äº†ï¼Œåªéœ€è¦åœ¨  <code>main</code>  æ–¹æ³•ä¸­å¯åŠ¨å³å¯ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/99006e3f58d0417dbf27fa7068633b05.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ReferenceConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * apiçš„æ–¹å¼è°ƒç”¨</span></span><br><span class="line"><span class="comment"> * apiçš„æ–¹å¼è°ƒç”¨ä¸éœ€è¦å…¶ä»–çš„é…ç½®ï¼Œåªéœ€è¦ä¸‹é¢çš„ä»£ç å³å¯ã€‚</span></span><br><span class="line"><span class="comment"> * ä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå®˜æ–¹å»ºè®®ï¼š</span></span><br><span class="line"><span class="comment"> * Apiæ–¹å¼ç”¨äºæµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ï¼Œæ¨èxmlçš„æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppApi</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å½“å‰åº”ç”¨é…ç½®</span></span><br><span class="line">        <span class="type">ApplicationConfig</span> <span class="variable">application</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationConfig</span>();</span><br><span class="line">        application.setName(<span class="string">&quot;consumer&quot;</span>);</span><br><span class="line">        application.setOwner(<span class="string">&quot;sihai&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½®</span></span><br><span class="line">        <span class="type">RegistryConfig</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistryConfig</span>();</span><br><span class="line">        registry.setAddress(<span class="string">&quot;zookeeper://localhost:2181&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨æ„ï¼šReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œ</span></span><br><span class="line">        <span class="comment">//ä»¥åŠä¸æœåŠ¡æä¾›æ–¹çš„è¿æ¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¼•ç”¨è¿œç¨‹æœåŠ¡</span></span><br><span class="line">        ReferenceConfig&lt;ProviderService&gt; reference = <span class="keyword">new</span> <span class="title class_">ReferenceConfig</span>&lt;ProviderService&gt;(); <span class="comment">// æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ä»¥åŠä¸æä¾›è€…çš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼</span></span><br><span class="line">        reference.setApplication(application);</span><br><span class="line">        reference.setRegistry(registry); <span class="comment">// å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries()</span></span><br><span class="line">        reference.setInterface(ProviderService.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨xxxService</span></span><br><span class="line">        <span class="type">ProviderService</span> <span class="variable">providerService</span> <span class="operator">=</span> reference.get(); <span class="comment">// æ³¨æ„ï¼šæ­¤ä»£ç†å¯¹è±¡å†…éƒ¨å°è£…äº†æ‰€æœ‰é€šè®¯ç»†èŠ‚ï¼Œå¯¹è±¡è¾ƒé‡ï¼Œè¯·ç¼“å­˜å¤ç”¨</span></span><br><span class="line">        providerService.SayHello(<span class="string">&quot;hello dubbo! I am sihai!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™éƒ¨åˆ†çš„  <code>API</code>  é…ç½®çš„æ–¹å¼å°±åˆ°è¿™äº†ï¼Œæ³¨æ„ï¼šå®˜æ–¹æ¨è  <code>xml</code>  çš„é…ç½®æ–¹æ³•</p>
<h3 id="182-æ³¨è§£é…ç½®æ–¹å¼"><a class="markdownIt-Anchor" href="#182-æ³¨è§£é…ç½®æ–¹å¼">#</a> 1.8.2 æ³¨è§£é…ç½®æ–¹å¼</h3>
<p>æ³¨è§£é…ç½®æ–¹å¼è¿˜æ˜¯éœ€è¦äº†è§£ä¸€ä¸‹çš„ï¼Œç°åœ¨å¾®æœåŠ¡éƒ½å€¾å‘äºè¿™ç§æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯ä»¥åå‘å±•çš„è¶‹åŠ¿ï¼Œ <code>0</code>  é…ç½®åº”è¯¥æ˜¯è¿™å‡ å¹´çš„è¶‹åŠ¿ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•å¯¹ <code>dubbo</code>  ä½¿ç”¨æ³¨è§£çš„æ–¹å¼å‘¢ï¼Ÿæˆ‘ä»¬å…ˆçœ‹æœåŠ¡ç«¯ã€‚</p>
<p><strong>æœåŠ¡ç«¯</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1ad33df6d381480793d65ee4212b5ea6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<strong>ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¥å£åŠå®ç°ç±»ï¼Œåœ¨ä¸Šé¢çš„æˆªå›¾ä¸­çš„  <code>annotation</code>  åŒ…ä¸‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider.service.annotation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ–¹å¼æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProviderServiceAnnotation</span> &#123;</span><br><span class="line">    String <span class="title function_">SayHelloAnnotation</span><span class="params">(String word)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider.service.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ–¹å¼å®ç°ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(timeout = 5000)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderServiceImplAnnotation</span> <span class="keyword">implements</span> <span class="title class_">ProviderServiceAnnotation</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">SayHelloAnnotation</span><span class="params">(String word)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>@Service</strong></p>
<p><code>@Service</code>  ç”¨æ¥é…ç½®  <code>Dubbo</code>  çš„æœåŠ¡æä¾›æ–¹ã€‚</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šç»„è£…æœåŠ¡æä¾›æ–¹</strong>ã€‚é€šè¿‡  <code>Spring</code>  ä¸­  <code>Java Config</code>  çš„æŠ€æœ¯ï¼ˆ <code>@Configuration</code> ï¼‰å’Œ  <code>annotation</code>  æ‰«æï¼ˆ <code>@EnableDubbo</code> ï¼‰æ¥å‘ç°ã€ç»„è£…ã€å¹¶å‘å¤–æä¾› <code>Dubbo</code>  çš„æœåŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ProtocolConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ProviderConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ–¹å¼é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableDubbo(scanBasePackages = &quot;com.sihai.dubbo.provider.service.annotation&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DubboConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// #1 æœåŠ¡æä¾›è€…ä¿¡æ¯é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> ProviderConfig <span class="title function_">providerConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ProviderConfig</span> <span class="variable">providerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProviderConfig</span>();</span><br><span class="line">        providerConfig.setTimeout(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">return</span> providerConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// #2 åˆ†å¸ƒå¼åº”ç”¨ä¿¡æ¯é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> ApplicationConfig <span class="title function_">applicationConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationConfig</span> <span class="variable">applicationConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationConfig</span>();</span><br><span class="line">        applicationConfig.setName(<span class="string">&quot;dubbo-annotation-provider&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> applicationConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// #3 æ³¨å†Œä¸­å¿ƒä¿¡æ¯é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> RegistryConfig <span class="title function_">registryConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistryConfig</span>();</span><br><span class="line">        registryConfig.setProtocol(<span class="string">&quot;zookeeper&quot;</span>);</span><br><span class="line">        registryConfig.setAddress(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        registryConfig.setPort(<span class="number">2181</span>);</span><br><span class="line">        <span class="keyword">return</span> registryConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// #4 ä½¿ç”¨åè®®é…ç½®ï¼Œè¿™é‡Œä½¿ç”¨ dubbo</span></span><br><span class="line">    <span class="keyword">public</span> ProtocolConfig <span class="title function_">protocolConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ProtocolConfig</span> <span class="variable">protocolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProtocolConfig</span>();</span><br><span class="line">        protocolConfig.setName(<span class="string">&quot;dubbo&quot;</span>);</span><br><span class="line">        protocolConfig.setPort(<span class="number">20880</span>);</span><br><span class="line">        <span class="keyword">return</span> protocolConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ†æè¯´æ˜å¦‚ä¸‹ï¼š<br>
1ã€é€šè¿‡  <code>@EnableDubbo</code>  æŒ‡å®šåœ¨ <code>com.sihai.dubbo.provider.service.annotation</code>  ä¸‹æ‰«ææ‰€æœ‰æ ‡æ³¨æœ‰  <code>@Service</code>  çš„ç±»</p>
<p>2ã€é€šè¿‡  <code>@Configuration</code>  å°†  <code>DubboConfiguration</code>  ä¸­æ‰€æœ‰çš„  <code>@Bean</code>  é€šè¿‡ <code>Java Config</code>  çš„æ–¹å¼ç»„è£…å‡ºæ¥å¹¶æ³¨å…¥ç»™  <code>Dubbo</code>  æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æ ‡æ³¨æœ‰ <code>@Service</code>  çš„ç±»ã€‚</p>
<p>è¿™å…¶ä¸­å°±åŒ…æ‹¬äº†ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ProviderConfigï¼šæœåŠ¡æä¾›æ–¹é…ç½®</span><br><span class="line">ApplicationConfigï¼šåº”ç”¨é…ç½®</span><br><span class="line">RegistryConfigï¼šæ³¨å†Œä¸­å¿ƒé…ç½®</span><br><span class="line">ProtocolConfigï¼šåè®®é…ç½®</span><br></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œå…¶å®ã€‚ã€‚ã€‚<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7a607c56fd774c65acf83b23b10bc831.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<strong>ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.DubboComponentScan;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.configuration.DubboConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> sun.applet.Main;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£å¯åŠ¨æ–¹å¼</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppAnnotation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(DubboConfiguration.class); </span><br><span class="line">        context.start();</span><br><span class="line">        System.in.read(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‘ç°è¾“å‡ºä¸‹é¢ä¿¡æ¯å°±è¡¨ç¤º  <code>success</code>  äº†</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5f2fc6b4d06b48fea91f16dfb130eb70.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<strong>æ¶ˆè´¹ç«¯</strong></p>
<p>åŒæ ·æˆ‘ä»¬ä¸‹çœ‹çœ‹æ¶ˆè´¹ç«¯çš„å·¥ç¨‹ï¼Œæœ‰ä¸€ä¸ªæ„Ÿæ€§è®¤è¯†ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0ff7a379a9df48e5a08f4669871a8832.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<strong>ç¬¬ä¸€æ­¥ï¼šå¼•ç”¨æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.consumer.Annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.annotation.Reference;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.annotation.ProviderServiceAnnotation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ–¹å¼çš„service</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;annotatedConsumer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerAnnotationService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Reference</span></span><br><span class="line">    <span class="keyword">private</span> ProviderServiceAnnotation providerServiceAnnotation;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doSayHello</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> providerServiceAnnotation.SayHelloAnnotation(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨  <code>ConsumerAnnotationService</code>  ç±»ä¸­ï¼Œé€šè¿‡  <code>@Reference</code>  å¼•ç”¨æœåŠ¡ç«¯æä¾›çš„ç±»ï¼Œç„¶åé€šè¿‡æ–¹æ³•è°ƒç”¨è¿™ä¸ªç±»çš„æ–¹å¼ï¼Œç»™æ¶ˆè´¹ç«¯æä¾›æ¥å£ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚æœè¿™é‡Œæ‰¾ä¸åˆ°  <code>ProviderServiceAnnotation</code>  ç±»ï¼Œè¯·åœ¨æœåŠ¡ç«¯å…ˆæŠŠæœåŠ¡ç«¯å·¥ç¨‹ç”¨  <code>Maven intall</code>  ä¸€ä¸‹ï¼Œç„¶åå°†æœåŠ¡ç«¯çš„ä¾èµ–æ”¾åˆ°æ¶ˆè´¹ç«¯çš„ <code>pom</code>  ä¸­ã€‚å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.ouyangsihai&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-provider&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>è§£é‡Šä¸€ä¸‹ï¼šå¼•å…¥çš„ <code>jar</code>  åŒ…é‡Œé¢åªæ˜¯æœªè¢«å®ç°çš„æ¥å£ï¼Œ <code>rpc</code>  éœ€è¦åœ¨å®¢æˆ·ç«¯æœåŠ¡ç«¯å®šä¹‰ä¸€å¥—ç»Ÿä¸€çš„æ¥å£ï¼Œç„¶ååœ¨æœåŠ¡ç«¯å®ç°æ¥å£ï¼Œå®é™…ä¸Šè¿˜æ˜¯ç½‘ç»œé€šä¿¡ï¼Œåªä¸è¿‡é•¿å¾—åƒæœ¬åœ°å®ç°</p>
<p><strong>ç¬¬äºŒæ­¥ï¼šç»„è£…æœåŠ¡æ¶ˆè´¹è€…</strong></p>
<p>è¿™ä¸€æ­¥å’ŒæœåŠ¡ç«¯æ˜¯ç±»ä¼¼çš„ï¼Œè¿™é‡Œå°±ä¸åœ¨é‡å¤äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.consumer.configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.ConsumerConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.RegistryConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableDubbo(scanBasePackages = &quot;com.sihai.dubbo.consumer.Annotation&quot;)</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &#123;&quot;com.sihai.dubbo.consumer.Annotation&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// åº”ç”¨é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> ApplicationConfig <span class="title function_">applicationConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ApplicationConfig</span> <span class="variable">applicationConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApplicationConfig</span>();</span><br><span class="line">        applicationConfig.setName(<span class="string">&quot;dubbo-annotation-consumer&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; stringStringMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">        stringStringMap.put(<span class="string">&quot;qos.enable&quot;</span>,<span class="string">&quot;true&quot;</span>);</span><br><span class="line">        stringStringMap.put(<span class="string">&quot;qos.accept.foreign.ip&quot;</span>,<span class="string">&quot;false&quot;</span>);</span><br><span class="line">        stringStringMap.put(<span class="string">&quot;qos.port&quot;</span>,<span class="string">&quot;33333&quot;</span>);</span><br><span class="line">        applicationConfig.setParameters(stringStringMap);</span><br><span class="line">        <span class="keyword">return</span> applicationConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// æœåŠ¡æ¶ˆè´¹è€…é…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> ConsumerConfig <span class="title function_">consumerConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ConsumerConfig</span> <span class="variable">consumerConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsumerConfig</span>();</span><br><span class="line">        consumerConfig.setTimeout(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> consumerConfig;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// é…ç½®æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">    <span class="keyword">public</span> RegistryConfig <span class="title function_">registryConfig</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">RegistryConfig</span> <span class="variable">registryConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistryConfig</span>();</span><br><span class="line">        registryConfig.setProtocol(<span class="string">&quot;zookeeper&quot;</span>);</span><br><span class="line">        registryConfig.setAddress(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">        registryConfig.setPort(<span class="number">2181</span>);</span><br><span class="line">        <span class="keyword">return</span> registryConfig;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šå‘èµ·è¿œç¨‹è°ƒç”¨</strong></p>
<p>åœ¨ <code>main</code>  æ–¹æ³•ä¸­é€šè¿‡å¯åŠ¨ä¸€ä¸ª <code>Spring Context</code> ï¼Œä»å…¶ä¸­æŸ¥æ‰¾åˆ°ç»„è£…å¥½çš„ <code>Dubbo</code>  çš„æœåŠ¡æ¶ˆè´¹è€…ï¼Œå¹¶å‘èµ·ä¸€æ¬¡<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8&amp;spm=1001.2101.3001.7020">è¿œç¨‹è°ƒç”¨</a>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sihai.dubbo.consumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.consumer.Annotation.ConsumerAnnotationService;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.consumer.configuration.ConsumerConfiguration;</span><br><span class="line"><span class="keyword">import</span> com.sihai.dubbo.provider.service.ProviderService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨è§£æ–¹å¼å¯åŠ¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppAnnotation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(ConsumerConfiguration.class); </span><br><span class="line">        context.start(); <span class="comment">// å¯åŠ¨</span></span><br><span class="line">        <span class="type">ConsumerAnnotationService</span> <span class="variable">consumerAnnotationService</span> <span class="operator">=</span> context.getBean(ConsumerAnnotationService.class); </span><br><span class="line">        <span class="type">String</span> <span class="variable">hello</span> <span class="operator">=</span> consumerAnnotationService.doSayHello(<span class="string">&quot;annotation&quot;</span>); <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">        System.out.println(<span class="string">&quot;result: &quot;</span> + hello); <span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/994174d242d84c92a8eb2489b6bc8930.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="19-å¸¸ç”¨åœºæ™¯"><a class="markdownIt-Anchor" href="#19-å¸¸ç”¨åœºæ™¯">#</a> 1.9 å¸¸ç”¨åœºæ™¯</h2>
<p>åœ¨ä¸‹é¢çš„è®²è§£ä¸­ï¼Œéƒ½ä¼šæ˜¯ä»¥ <code>xml</code>  é…ç½®çš„æ–¹å¼æ¥è®²è§£çš„ï¼Œè¿™ä¹Ÿæ˜¯ <code>dubbo</code>  å®˜æ–¹æ¯”è¾ƒæ¨èçš„æ–¹å¼ã€‚ä»¥ä¸‹çš„æ“ä½œéƒ½æ˜¯åœ¨æœåŠ¡ç«¯çš„  <code>xml</code>  é…ç½®æ–‡ä»¶å’Œæ¶ˆè´¹ç«¯çš„é…ç½®æ–‡ä»¶æ¥è®²è§£çš„ã€‚</p>
<h3 id="191-å¯åŠ¨æ—¶æ£€æŸ¥"><a class="markdownIt-Anchor" href="#191-å¯åŠ¨æ—¶æ£€æŸ¥">#</a> 1.9.1 å¯åŠ¨æ—¶æ£€æŸ¥</h3>
<p><code>Dubbo</code>  ç¼ºçœä¼šåœ¨å¯åŠ¨æ—¶æ£€æŸ¥ä¾èµ–çš„æœåŠ¡æ˜¯å¦å¯ç”¨ï¼Œä¸å¯ç”¨æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢  <code>Spring</code>  åˆå§‹åŒ–å®Œæˆï¼Œä»¥ä¾¿ä¸Šçº¿æ—¶ï¼Œèƒ½åŠæ—©å‘ç°é—®é¢˜ï¼Œé»˜è®¤ <code>check=&quot;true&quot;</code> ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯éƒ½éœ€è¦å¯åŠ¨æ—¶å°±æ£€æŸ¥çš„ï¼Œæ¯”å¦‚æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦æ›´å¿«é€Ÿçš„å¯åŠ¨ï¼Œæ‰€ä»¥ï¼Œè¿™ç§åœºæ™¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯éœ€è¦å…³é—­è¿™ä¸ªåŠŸèƒ½çš„ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>åœ¨æœåŠ¡ç«¯æ³¨å†Œçš„æ—¶å€™ï¼ˆå®¢æˆ·ç«¯æ³¨å†Œæ—¶åŒæ ·é€‚ç”¨ï¼‰ï¼›</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2181,localhost:2182,localhost:2183&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å®¢æˆ·ç«¯å¼•ç”¨æœåŠ¡ç«¯æœåŠ¡çš„æ—¶å€™ï¼›</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå°±æ˜¯è¿™ä¹ˆå¼ºï¼</p>
<h3 id="192-é›†ç¾¤å®¹é”™"><a class="markdownIt-Anchor" href="#192-é›†ç¾¤å®¹é”™">#</a> 1.9.2 é›†ç¾¤å®¹é”™</h3>
<p><code>dubbo</code>  ä¹Ÿæ˜¯æ”¯æŒé›†ç¾¤å®¹é”™çš„ï¼ŒåŒæ—¶ä¹Ÿæœ‰å¾ˆå¤šå¯é€‰çš„æ–¹æ¡ˆï¼Œå…¶ä¸­ï¼Œé»˜è®¤çš„æ–¹æ¡ˆæ˜¯  <code>failover</code> ï¼Œä¹Ÿå°±æ˜¯é‡è¯•æœºåˆ¶ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæŠŠæ‰€æœ‰çš„å®¹é”™æœºåˆ¶éƒ½æ•´ç†ä¸€éï¼Œç„¶åå†çœ‹çœ‹ä½¿ç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>é›†ç¾¤æ¨¡å¼</th>
<th>è¯´æ˜</th>
<th>ä½¿ç”¨æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Failover Cluster</code></td>
<td>å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ <code>retries=&quot;2&quot;</code>  æ¥è®¾ç½®é‡è¯•æ¬¡æ•° (ä¸å«ç¬¬ä¸€æ¬¡)ã€‚</td>
<td><code>cluster=&quot;xxx&quot;</code> xxxï¼šé›†ç¾¤æ¨¡å¼åç§° ï¼Œä¾‹å¦‚ <code>cluster=&quot;failover&quot;</code></td>
</tr>
<tr>
<td><code>Failfast Cluster</code></td>
<td>å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>Failsafe Cluster</code></td>
<td>å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>Failback Cluster</code></td>
<td>å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚</td>
<td></td>
</tr>
<tr>
<td><code>Forking Cluster</code></td>
<td>å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ <code>forks=&quot;2&quot;</code>  æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>Broadcast Cluster</code></td>
<td>å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨å®ä¾‹</strong><br>
åœ¨å‘å¸ƒæœåŠ¡æˆ–è€…å¼•ç”¨æœåŠ¡çš„æ—¶å€™è®¾ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="193-è´Ÿè½½å‡è¡¡"><a class="markdownIt-Anchor" href="#193-è´Ÿè½½å‡è¡¡">#</a> 1.9.3 è´Ÿè½½å‡è¡¡</h3>
<p>è´Ÿè½½å‡è¡¡æƒ³å¿…æ˜¯ä¸€ä¸ªå†ç†Ÿæ‚‰ä¸è¿‡çš„æ¦‚å¿µäº†ï¼Œæ‰€ä»¥ï¼Œ <code>dubbo</code>  æ”¯æŒä¹Ÿæ˜¯å†æ­£å¸¸ä¸è¿‡äº†ï¼Œè¿™é‡Œä¹Ÿæ€»ç»“ä¸€ä¸‹ <code>dubbo</code>  æ”¯æŒçš„è´Ÿè½½å‡è¡¡çš„ä¸€äº›æ–¹æ¡ˆåŠä½¿ç”¨æ–¹æ³•ã€‚</p>
<table>
<thead>
<tr>
<th>è´Ÿè½½å‡è¡¡æ¨¡å¼</th>
<th>è¯´æ˜</th>
<th>ä½¿ç”¨æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Random LoadBalance</code></td>
<td>éšæœº æŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡</td>
<td><code>&lt;dubbo:service loadbalance=&quot;xxx&quot;/&gt;</code> xxxï¼šè´Ÿè½½å‡è¡¡æ–¹æ³•</td>
</tr>
<tr>
<td><code>RoundRobin LoadBalance</code></td>
<td>è½®è¯¢ æŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>LeastActive LoadBalance</code></td>
<td>æœ€å°‘æ´»è·ƒè°ƒç”¨æ•° ç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚</td>
<td></td>
</tr>
<tr>
<td><code>ConsistentHash LoadBalance</code></td>
<td>ä¸€è‡´æ€§  <code>Hash</code>  ç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="194-ç›´è¿æä¾›è€…"><a class="markdownIt-Anchor" href="#194-ç›´è¿æä¾›è€…">#</a> 1.9.4 ç›´è¿æä¾›è€…</h3>
<p>åœ¨å¼€å‘åŠæµ‹è¯•ç¯å¢ƒä¸‹ï¼Œç»å¸¸éœ€è¦ç»•è¿‡æ³¨å†Œä¸­å¿ƒï¼Œåªæµ‹è¯•æŒ‡å®šæœåŠ¡æä¾›è€…ï¼Œæ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç›´æ¥è¿æ¥æœåŠ¡ç«¯çš„åœ°å³å¯ï¼Œå…¶å®ï¼Œè¿™ç§æ–¹æ³•åœ¨å‰é¢çš„è®²è§£å·²ç»ä½¿ç”¨åˆ°äº†ï¼Œç¬¬ä¸€ç§è®²è§£çš„æ–¹å¼å°±æ˜¯è¿™ç§æ–¹å¼ï¼Œå› ä¸ºè¿™ç§æ–¹å¼ç®€å•ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">url</span>=<span class="string">&quot;dubbo://192.168.234.1:20880/com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šå¯ä»¥çœ‹åˆ°ï¼Œåªè¦åœ¨æ¶ˆè´¹ç«¯åœ¨ãƒ» <code>dubbo:reference</code>  èŠ‚ç‚¹ä½¿ç”¨ <code>url</code>  ç»™å‡ºæœåŠ¡ç«¯çš„æ–¹æ³•å³å¯ã€‚</p>
<h3 id="195-åªè®¢é˜…"><a class="markdownIt-Anchor" href="#195-åªè®¢é˜…">#</a> 1.9.5 åªè®¢é˜…</h3>
<p>åªè®¢é˜…å°±æ˜¯åªèƒ½å¤Ÿè®¢é˜…æœåŠ¡ç«¯çš„æœåŠ¡ï¼Œè€Œä¸èƒ½å¤Ÿæ³¨å†Œã€‚</p>
<p>å¼•ç”¨å®˜æ–¹çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>ä¸ºæ–¹ä¾¿å¼€å‘æµ‹è¯•ï¼Œç»å¸¸ä¼šåœ¨çº¿ä¸‹å…±ç”¨ä¸€ä¸ªæ‰€æœ‰æœåŠ¡å¯ç”¨çš„æ³¨å†Œä¸­å¿ƒï¼Œè¿™æ—¶ï¼Œå¦‚æœä¸€ä¸ªæ­£åœ¨å¼€å‘ä¸­çš„æœåŠ¡æä¾›è€…æ³¨å†Œï¼Œå¯èƒ½ä¼šå½±å“æ¶ˆè´¹è€…ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚<br>
å¯ä»¥è®©æœåŠ¡æä¾›è€…å¼€å‘æ–¹ï¼Œåªè®¢é˜…æœåŠ¡ (å¼€å‘çš„æœåŠ¡å¯èƒ½ä¾èµ–å…¶å®ƒæœåŠ¡)ï¼Œè€Œä¸æ³¨å†Œæ­£åœ¨å¼€å‘çš„æœåŠ¡ï¼Œé€šè¿‡ç›´è¿æµ‹è¯•æ­£åœ¨å¼€å‘çš„æœåŠ¡ã€‚</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">register</span>=<span class="string">&quot;false&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2181,localhost:2182,localhost:2183&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>1ã€ä½¿ç”¨åªè®¢é˜…æ–¹å¼<br>
å½“åœ¨æœåŠ¡æä¾›ç«¯ä½¿ç”¨  <code>register=&quot;false&quot;</code>  çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼è·å–æœåŠ¡ç«¯çš„æœåŠ¡ï¼›</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ä¿¡æ¯</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/82d1dafceb4d4562a5bf143dd1bcaed9.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å‘ç°ï¼Œè¿™æ—¶å€™å¹¶ä¸æ˜¯å‘æ³¨å†Œä¸­å¿ƒ  <code>zookeeper</code>  æ³¨å†Œï¼Œè€Œåªæ˜¯åšäº†å‘å¸ƒæœåŠ¡å’Œå¯åŠ¨ <code>netty</code> ã€‚</p>
<p>2ã€ä¸ä½¿ç”¨åªè®¢é˜…æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;dubbo:registry protocol=<span class="string">&quot;zookeeper&quot;</span> address=<span class="string">&quot;localhost:2181,localhost:2182,localhost:2183&quot;</span> check=<span class="string">&quot;false&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ä¿¡æ¯</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/752b5bf0d635420980b39495b8bf029d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å¯ä»¥å‘ç°ï¼Œè¿™é‡Œå°±å‘æ³¨å†Œä¸­å¿ƒ  <code>zookeeper</code>  æ³¨å†Œäº†ã€‚</p>
<h3 id="196-åªæ³¨å†Œ"><a class="markdownIt-Anchor" href="#196-åªæ³¨å†Œ">#</a> 1.9.6 åªæ³¨å†Œ</h3>
<p>åªæ³¨å†Œæ­£å¥½è·Ÿå‰é¢çš„åªè®¢é˜…ç›¸åï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼Œä½†æ˜¯ï¼Œæ¶ˆè´¹ç«¯å´ä¸èƒ½å¤Ÿè¯»åˆ°æœåŠ¡ã€‚</p>
<p><strong>åº”ç”¨åœºæ™¯</strong></p>
<blockquote>
<p>å¦‚æœæœ‰ä¸¤ä¸ªé•œåƒç¯å¢ƒï¼Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæœ‰ä¸€ä¸ªæœåŠ¡åªåœ¨å…¶ä¸­ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒæœ‰éƒ¨ç½²ï¼Œå¦ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒè¿˜æ²¡æ¥å¾—åŠéƒ¨ç½²ï¼Œè€Œä¸¤ä¸ªæ³¨å†Œä¸­å¿ƒçš„å…¶å®ƒåº”ç”¨éƒ½éœ€è¦ä¾èµ–æ­¤æœåŠ¡ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥è®©æœåŠ¡æä¾›è€…æ–¹åªæ³¨å†ŒæœåŠ¡åˆ°å¦ä¸€æ³¨å†Œä¸­å¿ƒï¼Œè€Œä¸ä»å¦ä¸€æ³¨å†Œä¸­å¿ƒè®¢é˜…æœåŠ¡ã€‚</p>
</blockquote>
<p><strong>ä½¿ç”¨è¯´æ˜</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">subscribe</span>=<span class="string">&quot;false&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2181&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:registry</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨æœåŠ¡ç«¯çš„  <code>dubbo:registry</code>  èŠ‚ç‚¹ä¸‹ä½¿ç”¨  <code>subscribe=&quot;false&quot;</code>  æ¥å£°æ˜è¿™ä¸ªæœåŠ¡æ˜¯åªæ³¨å†Œçš„æœåŠ¡ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æ¶ˆè´¹ç«¯è°ƒç”¨çš„æ—¶å€™æ˜¯ä¸èƒ½è°ƒç”¨çš„ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/272a429bc9a547108334d08a1188e774.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="197-å¤šåè®®æœºåˆ¶"><a class="markdownIt-Anchor" href="#197-å¤šåè®®æœºåˆ¶">#</a> 1.9.7 å¤šåè®®æœºåˆ¶</h3>
<p>åœ¨å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„åè®®éƒ½æ˜¯  <code>dubbo</code>  åè®®ï¼Œä½†æ˜¯  <code>dubbo</code>  é™¤äº†æ”¯æŒè¿™ç§åè®®å¤–è¿˜æ”¯æŒå…¶ä»–çš„åè®®ï¼Œæ¯”å¦‚ï¼Œ <code>rmiã€hessian</code>  ç­‰ï¼Œå¦å¤–ï¼Œè€Œä¸”è¿˜å¯ä»¥ç”¨å¤šç§åè®®åŒæ—¶æš´éœ²ä¸€ç§æœåŠ¡ã€‚</p>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong></p>
<p><strong>1ã€ä¸€ç§æ¥å£ä½¿ç”¨ä¸€ç§åè®®</strong></p>
<p>å…ˆå£°æ˜å¤šç§åè®®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å½“å‰æœåŠ¡å‘å¸ƒæ‰€ä¾èµ–çš„åè®®ï¼›webseroviceã€Thriftã€Hessainã€http--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1099&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨å‘å¸ƒæ¥å£çš„æ—¶å€™ä½¿ç”¨å…·ä½“åè®®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;rmi&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¾“å‡ºæ—¥å¿—ä¸­ï¼Œå°±å¯ä»¥æ‰¾åˆ° <code>rmi</code>  å‘å¸ƒçš„æ¥å£ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmi://192.168.234.1:1099/com.sihai.dubbo.provider.service.ProviderService?anyhost=true&amp;application=provider&amp;bean.name=com.sihai.dubbo.provider.service.ProviderService&amp;cluster=failover&amp;dubbo=2.0.2&amp;generic=false&amp;interface=com.sihai.dubbo.provider.service.ProviderService&amp;methods=SayHello&amp;owner=sihai&amp;pid=796&amp;retries=2&amp;side=provider&amp;timestamp=1564281053185, dubbo version: 2.6.6, current host: 192.168.234.1</span><br></pre></td></tr></table></figure>
<p><strong>2ã€ä¸€ç§æ¥å£ä½¿ç”¨å¤šç§åè®®</strong><br>
å£°æ˜åè®®å’Œä¸Šé¢çš„æ–¹å¼ä¸€æ ·ï¼Œåœ¨å‘å¸ƒæ¥å£çš„æ—¶å€™æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;rmi,dubbo&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š <code>protocol</code>  å±æ€§ï¼Œå¯ä»¥ç”¨ <code>,</code>  éš”å¼€ï¼Œä½¿ç”¨å¤šç§åè®®ã€‚</p>
<h3 id="198-å¤šæ³¨å†Œä¸­å¿ƒ"><a class="markdownIt-Anchor" href="#198-å¤šæ³¨å†Œä¸­å¿ƒ">#</a> 1.9.8 å¤šæ³¨å†Œä¸­å¿ƒ</h3>
<p><code>Dubbo</code>  æ”¯æŒåŒä¸€æœåŠ¡å‘å¤šæ³¨å†Œä¸­å¿ƒåŒæ—¶æ³¨å†Œï¼Œæˆ–è€…ä¸åŒæœåŠ¡åˆ†åˆ«æ³¨å†Œåˆ°ä¸åŒçš„æ³¨å†Œä¸­å¿ƒä¸Šå»ï¼Œç”šè‡³å¯ä»¥åŒæ—¶å¼•ç”¨æ³¨å†Œåœ¨ä¸åŒæ³¨å†Œä¸­å¿ƒä¸Šçš„åŒåæœåŠ¡ã€‚</p>
<p><strong>æœåŠ¡ç«¯å¤šæ³¨å†Œä¸­å¿ƒå‘å¸ƒæœåŠ¡</strong></p>
<p>ä¸€ä¸ªæœåŠ¡å¯ä»¥åœ¨ä¸åŒçš„æ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼Œå½“ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒå‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”¨å…¶ä»–çš„æ³¨å†Œä¸­å¿ƒã€‚</p>
<p><strong>æ³¨å†Œ</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¤šæ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg1&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2181&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg2&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2182&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg3&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2183&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>å‘å¸ƒæœåŠ¡</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šä½¿ç”¨ <code>registry=&quot;reg2&quot;</code>  æŒ‡å®šè¯¥æ¥å£ä½¿ç”¨çš„æ³¨å†Œä¸­å¿ƒï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª <code>ï¼Œ</code> ç”¨ï¼Œéš”å¼€ï¼Œä¾‹å¦‚ï¼Œ <code>registry=&quot;reg1,,reg2&quot;</code> ã€‚</p>
<p><strong>æ¶ˆè´¹ç«¯å¤šæ³¨å†Œä¸­å¿ƒå¼•ç”¨æœåŠ¡</strong></p>
<p>é¦–å…ˆï¼Œå…ˆå‘ä¸åŒæ³¨å†Œä¸­å¿ƒæ³¨å†Œï¼›</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¤šæ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg1&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2181&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg2&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2182&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">protocol</span>=<span class="string">&quot;zookeeper&quot;</span> <span class="attr">id</span>=<span class="string">&quot;reg3&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span> <span class="attr">address</span>=<span class="string">&quot;localhost:2183&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶æ¬¡ï¼Œä¸åŒçš„æ¶ˆè´¹ç«¯æœåŠ¡å¼•ç”¨ä½¿ç”¨ä¸åŒçš„æ³¨å†Œä¸­å¿ƒï¼›</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¸åŒçš„æœåŠ¡ä½¿ç”¨ä¸åŒçš„æ³¨å†Œä¸­å¿ƒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">id</span>=<span class="string">&quot;providerService&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">id</span>=<span class="string">&quot;providerService2&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šä¸Šé¢åˆ†åˆ«ä½¿ç”¨æ³¨å†Œä¸­å¿ƒ <code>1</code>  å’Œæ³¨å†Œä¸­å¿ƒ <code>2</code> ã€‚</p>
<h3 id="199-å¤šç‰ˆæœ¬"><a class="markdownIt-Anchor" href="#199-å¤šç‰ˆæœ¬">#</a> 1.9.9 å¤šç‰ˆæœ¬</h3>
<p>ä¸åŒçš„æœåŠ¡æ˜¯æœ‰ç‰ˆæœ¬ä¸åŒçš„ï¼Œç‰ˆæœ¬å¯ä»¥æ›´æ–°å¹¶ä¸”å‡çº§ï¼ŒåŒæ—¶ï¼Œä¸åŒçš„ç‰ˆæœ¬ä¹‹é—´æ˜¯ä¸å¯ä»¥è°ƒç”¨çš„ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡å‘å¸ƒçš„é…ç½®ï¼Œéœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg1&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">cluster</span>=<span class="string">&quot;failover&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">interface</span>=<span class="string">&quot;com.sihai.dubbo.provider.service.ProviderService&quot;</span></span></span><br><span class="line"><span class="tag">                   <span class="attr">ref</span>=<span class="string">&quot;providerService&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">registry</span>=<span class="string">&quot;reg2&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.0.0&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŠ å…¥äº†ç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<h3 id="1910-æ—¥å¿—ç®¡ç†"><a class="markdownIt-Anchor" href="#1910-æ—¥å¿—ç®¡ç†">#</a> 1.9.10 æ—¥å¿—ç®¡ç†</h3>
<p><code>dubbo</code>  ä¹Ÿå¯ä»¥å°†æ—¥å¿—ä¿¡æ¯è®°å½•æˆ–è€…ä¿å­˜åˆ°æ–‡ä»¶ä¸­çš„ã€‚</p>
<p>1ã€ä½¿ç”¨ <code>accesslog</code>  è¾“å‡ºåˆ° <code>log4j</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">accesslog</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">accesslog</span>=<span class="string">&quot;true&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1099&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>2ã€è¾“å‡ºåˆ°æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">accesslog</span>=<span class="string">&quot;http://localhost/log.txt&quot;</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20880&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">accesslog</span>=<span class="string">&quot;http://localhost/log2.txt&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1099&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next"><a href="/page/2/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/11/">11</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-12T04:13:41.000Z">2023-06-12</time></p><p class="title"><a href="/2023/06/12/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%89%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸‰æœŸ-å…¬ä¼—å·äº‹ä»¶å¤„ç†-è®¾è®¡æ¨¡å¼å®æˆ˜åˆ†äº«</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:13:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ-å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯-æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T17:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">ã€Sentinelã€‘Dockeræ­å»ºSentinel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T07:25:21.000Z">2023-06-05</time></p><p class="title"><a href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">ã€Gitã€‘Githubæäº¤ä»£ç é‡åˆ°é”™è¯¯ï¼šERROR Youâ€˜re using an RSA key with SHA-1, which is no longer allowed</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">62</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">43</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">151</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">æŠ€èƒ½æ”¹å˜äººç”Ÿï¼ŒçŸ¥è¯†æ”¹å˜å‘½è¿ã€‚</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ä¸­å›½Â·æ±Ÿè‹Â·æ— é”¡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">151</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ³ çµ(ç‰¹åˆ«é¸£è°¢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://github.com/Guoqing815/interview" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">é¢è¯•è®°Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://www.pgyer.com/interview_app_release" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">é¢è¯•è®°App(Android)</span></span><span class="level-right"><span class="level-item tag">www.pgyer.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(ç äº‘)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ˜é‡‘</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(é˜¿é‡Œäº‘)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(è…¾è®¯äº‘)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(Bç«™)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p><p class="is-size-7">Â© 2030</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>