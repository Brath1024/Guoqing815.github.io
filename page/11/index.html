<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.118Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.514Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">6 分钟读完 (大约966个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Elasticsearch%E3%80%91Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8Elasticsearch7/">Linux环境下安装并启动Elasticsearch7</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h3>
<p>​        Elasticsearch (ES) 是一个基于 Lucene 构建的开源、分布式、RESTful 接口全文搜索引擎。Elasticsearch 还是一个分布式文档数据库，其中每个字段均是被索引的数据且可被搜索，它能够扩展至数以百计的服务器存储以及处理 PB 级的数据。它可以在很短的时间内在存储、搜索和分析大量的数据。它通常作为具有复杂搜索场景情况下的核心发动机。es 是由 java 语言编写的。</p>
<pre><code>Elasticsearch就是为高可用和可扩展而生的。可以通过购置性能更强的服务器来完成。
</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">Elasticsearch：官方分布式搜索和分析引擎 | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/icon-default.png" alt="img">https://www.elastic.co/cn/elasticsearch/</a></p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="linux里部署es"><a class="markdownIt-Anchor" href="#linux里部署es">#</a> Linux 里部署 ES</h2>
<h3 id="下载地址"><a class="markdownIt-Anchor" href="#下载地址">#</a> 下载地址</h3>
<p>​        我下载的版本是 ES7.15.1</p>
<p>Elasticsearch 7.15.1 | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/apple-icon-57x57.png" alt="img"><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1</a></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/74a3f6fc611945ebb8e492204fe4b51f.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4490382f8fd54a48bbd8e2ffaf2ce6ea.png" alt="img"></p>
<h3 id="上传到linux"><a class="markdownIt-Anchor" href="#上传到linux">#</a> 上传到 Linux</h3>
<p>​    压缩包下载完成后上传到服务器</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3732b77fcd15428e8397739b50f6b3b1.png" alt="img"></p>
<h3 id="解压软件"><a class="markdownIt-Anchor" href="#解压软件">#</a> 解压软件</h3>
<p>​     解压到上级目录，然后进行改名</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压缩</span></span><br><span class="line">tar -zxvf elasticsearch-7.15.1-linux-x86_64.tar.gz -C ../</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改名</span></span><br><span class="line">mv elasticsearch-7.15.1 es-7.15.1</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e6ff579f0e6b4aa6994e17629bbaa96a.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/7678de3df173498e92409dc8300f09b5.png" alt="img"></p>
<p>在 /opt 目录下新建 module/es 目录，同时把 es-7.15.1 移到该目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv es-7.15.1 /opt/module/es</span><br></pre></td></tr></table></figure>
<h3 id="创建用户"><a class="markdownIt-Anchor" href="#创建用户">#</a> 创建用户</h3>
<p>​    因为安全问题， Elasticsearch 不允许 root 用户直接运行，所以要创建新用户，在 root 用户中创建新用户。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd es #新增 es 用户</span><br><span class="line">passwd es #为 es 用户设置密码</span><br><span class="line">userdel -r es #如果错了，可以删除再加</span><br><span class="line">chown -R es:es /opt/module/es/es-7.15.1 #文件夹所有者</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/cf9ac437254f47bfa9e26f4770fa9667.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3b5a89b6cdbb4a3bb6220423400e25d2.png" alt="img"></p>
<h3 id="修改配置文件"><a class="markdownIt-Anchor" href="#修改配置文件">#</a> 修改配置文件</h3>
<p>修改 /root/es-7.15.1/config/elasticsearch.yml 文件。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d40fbb16c317400495682be93a2e07d7.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 加入如下配置</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: node-1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/00e7d21c15c640ba949d3dda5e9ee885.png" alt="img"></p>
<h3 id="修改etcsecuritylimitsconf"><a class="markdownIt-Anchor" href="#修改etcsecuritylimitsconf">#</a> 修改 /etc/security/limits.conf</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 在文件末尾中增加下面内容</span><br><span class="line"># 每个进程可以打开的文件数的限制</span><br><span class="line">es soft nofile 65536</span><br><span class="line">es hard nofile 65536</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4d4441f8e29346a0bc5a0ac8959477d9.png" alt="img"></p>
<h3 id="修改etcsysctlconf"><a class="markdownIt-Anchor" href="#修改etcsysctlconf">#</a> 修改 /etc/sysctl.conf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在文件中增加下面内容</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个进程可以拥有的 VMA(虚拟内存区域)的数量,默认值为 65536</span></span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>
<h3 id="重新加载"><a class="markdownIt-Anchor" href="#重新加载">#</a> 重新加载</h3>
<p>sysctl -p</p>
<h3 id="注意"><a class="markdownIt-Anchor" href="#注意">#</a> 注意：</h3>
<p>​    启动前需要先切换到 es 用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su es</span><br></pre></td></tr></table></figure>
<h3 id="启动es"><a class="markdownIt-Anchor" href="#启动es">#</a> 启动 es</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动 进入bin目录：</span></span><br><span class="line">./elasticsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">后台启动</span></span><br><span class="line">./elasticsearch -d  </span><br></pre></td></tr></table></figure>
<h3 id="测试连接"><a class="markdownIt-Anchor" href="#测试连接">#</a> 测试连接</h3>
<p>​    浏览器中打开 <a target="_blank" rel="noopener" href="http://xn--ip-fr5c86lx7z:9200/">http:// 服务器 IP:9200/</a>, 出现如下则说明安装成功</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0197dcff901f47279750939332674547.png" alt="img"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.113Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.504Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">16 分钟读完 (大约2429个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90ElasticSearch%E3%80%91ElasticSearch%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/">ElasticSearch 处理检索海量数据“神器”？</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<hr>
<blockquote>
<p><strong>海量数据我们是如何去检索数据呢</strong>，如何快速定位呢，去查询后台数据库吗？<strong>还是走缓存</strong>，是什么缓存能承载这么大的符合呢，并且快速检索出来？对于海量的数据是<strong>对系统极大的压力</strong>，<em><strong>我们该从什么角度去处理这个棘手的问题呢</strong></em>？</p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/82bb3c20ec5d414c838322d08edd1015.png" alt="在这里插入图片描述"></p>
<h2 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ElasticSearch&amp;spm=1001.2101.3001.7020">ElasticSearch</a> 处理检索海量数据 “神器”？</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/aba293bd092b42368e36b7839eb7df10.png" alt="在这里插入图片描述"></p>
<h2 id="11-介绍"><a class="markdownIt-Anchor" href="#11-介绍">#</a> 1.1 介绍</h2>
<blockquote>
<p>Elasticsearch 是一个基于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Lucene&amp;spm=1001.2101.3001.7020"> Lucene</a> 的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful<br>
web 接口。Elasticsearch 是用 Java 语言开发的，并作为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Apache&amp;spm=1001.2101.3001.7020"> Apache</a> 许可条款下的开放源码发布，是一种流行的企业级搜索引擎。Elasticsearch 用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。官方客户端在 Java、.NET（C#）、PHP、Python、Apache<br>
Groovy、Ruby 和许多其他语言中都是可用的。根据 DB-Engines 的排名显示，Elasticsearch 是最受欢迎的企业搜索引擎，其次是 Apache<br>
Solr，也是基于 Lucene。</p>
</blockquote>
<h2 id="12-es-介绍官网地址们"><a class="markdownIt-Anchor" href="#12-es-介绍官网地址们">#</a> 1.2 es 介绍 “官网地址们”</h2>
<ol>
<li>官方文档</li>
<li>中文官方文档 3.<a target="_blank" rel="noopener" href="https://es.xiaoleilu.com/index.html"> 中文社区</a></li>
</ol>
<h2 id="21-基本介绍"><a class="markdownIt-Anchor" href="#21-基本介绍">#</a> 2.1 基本介绍</h2>
<blockquote>
<p><strong>1、Index（索引）</strong> 动词，相当于 MySQL 中的 insert； 名词，相当于 MySQL 中的 Database<br>
<strong>2、Type（类型）</strong> 在 Index（索引）中，可以定义一个或多个类型。 类似于 MySQL 中的 Table；每一种类型的数据放在一起；<br>
<strong>3、Document（文档）</strong><br>
保存在某个索引（Index）下，某种类型（Type）的一个数据（Document），文档是 JSON 格<br>
式的，Document 就像是 MySQL 中的某个 Table 里面的内容；</p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/906e9a7bc76e4bba979fb394fe61a6cc.png" alt="数据概念"></p>
<h2 id="22-es是如何进行检索的呢"><a class="markdownIt-Anchor" href="#22-es是如何进行检索的呢">#</a> 2.2 ES 是如何进行检索的呢</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/eddb7d02f575452fbfaa011cef1b75fa.png" alt="在这里插入图片描述"></p>
<h2 id="23-elasticsearch-长啥样呢有无操作界面"><a class="markdownIt-Anchor" href="#23-elasticsearch-长啥样呢有无操作界面">#</a> 2.3 ElasticSearch 长啥样呢，有无操作界面</h2>
<blockquote>
<p>ElasticSearch<br>
 是有操作界面的，它需要配置<strong> Kibana</strong>，和它一起操作方便，也是主流的一种搭配方式，安装这两个工具，不做过多介绍</p>
<p><em><strong>Kibana 介绍</strong></em> Kibana 是一款开源的数据分析和可视化平台，它是 Elastic Stack 成员之一，设计用于和 Elasticsearch 协作。您可以使用 Kibana 对 Elasticsearch 索引中的数据进行搜索、查看、交互操作。您可以很方便的利用图表、表格及地图对数据进行多元化的分析和呈现</p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b90b4864012740a2bb99f48f0f2e2ab6.png" alt="在这里插入图片描述"></p>
<h2 id="24-初步检索"><a class="markdownIt-Anchor" href="#24-初步检索">#</a> 2.4 初步检索</h2>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、_cat</span><br><span class="line">GET /_cat/nodes：查看所有节点</span><br><span class="line">GET /_cat/health：查看 es 健康状况</span><br><span class="line">GET /_cat/master：查看主节点</span><br><span class="line">GET /_cat/indices：查看所有索引 show databases;</span><br><span class="line"><span class="number">2</span>、索引一个文档（保存）</span><br><span class="line">保存一个数据，保存在哪个索引的哪个类型下，指定用哪个唯一标识</span><br><span class="line">PUT customer/external/<span class="number">1</span>；在 customer 索引下的 external 类型下保存 <span class="number">1</span> 号数据为</span><br><span class="line"><span class="number">12345678</span></span><br><span class="line">PUT 和 POST 都可以，</span><br><span class="line">POST 新增。如果不指定 id，会自动生成 id。指定 id 就会修改这个数据，并新增版本号</span><br><span class="line">PUT 可以新增可以修改。PUT 必须指定 id；由于 PUT 需要指定 id，我们一般都用来做修改</span><br><span class="line">操作，不指定 id 会报错</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>
<h2 id="241-在postman测试数据"><a class="markdownIt-Anchor" href="#241-在postman测试数据">#</a> 2.4.1 在 postMan 测试数据</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT customer/external/<span class="number">1</span></span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<p><strong>2.4.2、查询文档</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET customer/external/<span class="number">1</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line">结果：</span><br><span class="line">&#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;customer&quot;</span>, //在哪个索引</span><br><span class="line"><span class="string">&quot;_type&quot;</span>: <span class="string">&quot;external&quot;</span>, //在哪个类型</span><br><span class="line"><span class="string">&quot;_id&quot;</span>: <span class="string">&quot;1&quot;</span>, //记录 id</span><br><span class="line"><span class="string">&quot;_version&quot;</span>: <span class="number">2</span>, //版本号</span><br><span class="line"><span class="string">&quot;_seq_no&quot;</span>: <span class="number">1</span>, //并发控制字段，每次更新就会+<span class="number">1</span>，用来做乐观锁</span><br><span class="line"><span class="string">&quot;_primary_term&quot;</span>: <span class="number">1</span>, //同上，主分片重新分配，如重启，就会变化</span><br><span class="line"><span class="string">&quot;found&quot;</span>: true, <span class="string">&quot;_source&quot;</span>: &#123; //真正的内容</span><br><span class="line"><span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1234567891011</span></span><br></pre></td></tr></table></figure>
<p><strong>2.4.3、更新文档</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/<span class="number">1</span>/_update</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span>:&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doew&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">或者</span><br><span class="line">POST customer/external/<span class="number">1</span></span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe2&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">或者</span><br><span class="line">PUT customer/external/<span class="number">1</span></span><br><span class="line">&#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">? 不同：POST 操作会对比源文档数据，如果相同不会有什么操作，文档 version 不增加</span><br><span class="line">PUT 操作总会将数据重新保存并增加 version 版本；</span><br><span class="line">带_update 对比元数据如果一样就不进行任何操作。</span><br><span class="line">看场景；</span><br><span class="line">对于大并发更新，不带 update；</span><br><span class="line">对于大并发查询偶尔更新，带 update；对比更新，重新计算分配规则。</span><br><span class="line">? 更新同时增加属性</span><br><span class="line">POST customer/external/<span class="number">1</span>/_update</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span>: &#123; <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Jane Doe&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT 和 POST 不带_update 也可以</span><br><span class="line"><span class="number">1234567891011121314151617181920212223</span></span><br></pre></td></tr></table></figure>
<p><strong>2.4.4、删除文档 &amp; 索引</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DELETE customer/external/<span class="number">1</span></span><br><span class="line">DELETE customer</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<p><strong>2.4.5 bulk 批量 API</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/_bulk</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;1&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span> &#125;</span><br><span class="line">&#123;<span class="string">&quot;index&quot;</span>:&#123;<span class="string">&quot;_id&quot;</span>:<span class="string">&quot;2&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Jane Doe&quot;</span> &#125;</span><br><span class="line">语法格式：</span><br><span class="line">&#123; action: &#123; metadata &#125;&#125;\n</span><br><span class="line">&#123; request body &#125;\n</span><br><span class="line">&#123; action: &#123; metadata &#125;&#125;\n</span><br><span class="line">&#123; request body &#125;\n</span><br><span class="line">复杂实例：</span><br><span class="line">POST /_bulk</span><br><span class="line">&#123; <span class="string">&quot;delete&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;create&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;title&quot;</span>: <span class="string">&quot;My first blog post&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;index&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span> &#125;&#125;</span><br><span class="line">&#123; <span class="string">&quot;title&quot;</span>: <span class="string">&quot;My second blog post&quot;</span> &#125;</span><br><span class="line">&#123; <span class="string">&quot;update&quot;</span>: &#123; <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;website&quot;</span>, <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;blog&quot;</span>, <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;123&quot;</span>, <span class="string">&quot;_retry_on_conflict&quot;</span> : <span class="number">3</span>&#125; &#125;</span><br><span class="line">&#123; <span class="string">&quot;doc&quot;</span> : &#123;<span class="string">&quot;title&quot;</span> : <span class="string">&quot;My updated blog post&quot;</span>&#125; &#125;</span><br><span class="line">bulk API 以此按顺序执行所有的 action（动作）。如果一个单个的动作因任何原因而失败，</span><br><span class="line">它将继续处理它后面剩余的动作。当 bulk API 返回时，它将提供每个动作的状态（与发送</span><br><span class="line">的顺序相同），所以您可以检查是否一个指定的动作是不是失败了。</span><br><span class="line"><span class="number">12345678910111213141516171819202122</span></span><br></pre></td></tr></table></figure>
<h2 id="24-searchapi"><a class="markdownIt-Anchor" href="#24-searchapi">#</a> 2.4 SearchAPI</h2>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ES 支持两种基本方式检索 :</span><br><span class="line">? 一个是通过使用 REST request URI 发送搜索参数（uri+检索参数）</span><br><span class="line">? 另一个是通过使用 REST request body 来发送它们（uri+请求体）</span><br><span class="line"><span class="number">1</span>）、检索信息</span><br><span class="line">? 一切检索从_search 开始</span><br><span class="line">GET bank/_search 检索 bank 下所有信息，包括 <span class="keyword">type</span> 和 docs</span><br><span class="line">GET bank/_search?q=*&amp;sort=account_number:asc 请求参数方式检索</span><br><span class="line">响应结果解释：</span><br><span class="line">took - Elasticsearch 执行搜索的时间（毫秒）</span><br><span class="line">time_out - 告诉我们搜索是否超时</span><br><span class="line">_shards - 告诉我们多少个分片被搜索了，以及统计了成功/失败的搜索分片</span><br><span class="line">hits - 搜索结果</span><br><span class="line">hits.total - 搜索结果</span><br><span class="line">hits.hits - 实际的搜索结果数组（默认为前 <span class="number">10</span> 的文档）</span><br><span class="line">sort - 结果的排序 key（键）（没有则按 score 排序）</span><br><span class="line">score 和 max_score –相关性得分和最高得分（全文检索用）</span><br><span class="line"><span class="number">12345678910111213141516</span></span><br></pre></td></tr></table></figure>
<p><strong>其他在 Kibana 操作的语句，都可以在 es 官网去查询，不做过多的赘述！！！</strong></p>
<h2 id="25-mapping映射"><a class="markdownIt-Anchor" href="#25-mapping映射">#</a> 2.5、Mapping 映射</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/792e34eb6b8d40568272d2413c1c0aaf.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>Mapping（映射） Mapping 是用来定义一个文档（document），以及它所包含的属性（field）是如何存储和<br>
索引的。比如，使用 mapping 来定义： ? 哪些字符串属性应该被看做全文本属性（full text fields）。 ?<br>
 哪些属性包含数字，日期或者地理位置。 ? 文档中的所有属性是否都能被索引（_all 配置）。 ? 日期的格式。 ?<br>
 自定义映射规则来执行动态添加属性。</p>
</blockquote>
<h2 id="26-分词"><a class="markdownIt-Anchor" href="#26-分词">#</a> 2.6 分词</h2>
<blockquote>
<p>个 tokenizer（分词器）接收一个字符流，将之分割为独立的 tokens（词元，通常是独立 的单词），然后输出 tokens 流。<br>
例如，whitespace tokenizer 遇到空白字符时分割文本。它会将文本 “Quick brown fox!” 分割 为<br>
 [Quick, brown, fox!]。 该 tokenizer（分词器）还负责记录各个 term（词条）的顺序或 position<br>
 位置（用于 phrase 短 语和 word proximity 词近邻查询），以及 term（词条）所代表的原始 word（单词）的<br>
 start （起始）和 end（结束）的 character offsets（字符偏移量）（用于高亮显示搜索的内容）。<br>
Elasticsearch 提供了很多内置的分词器，可以用来构建 custom analyzers（自定义分词器）。</p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/a81d083a8d594324b2d58b6d398f0dbe.png" alt="在这里插入图片描述"><br>
<strong> 2.6.1 安装分词器</strong></p>
<blockquote>
<p>注意：不能用默认 elasticsearch-plugin install xxx.zip 进行自动安装<br>
<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.4.2"> https://github.com/medcl/elasticsearch-analysis-ik/releases?after=v6.4.2</a><br>
 对应 es 版本安装</p>
</blockquote>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h2>
<blockquote>
<p>elasticsearch<br>
 功能是非常强大的，可以作为生成环境的<strong> ELK 日志</strong>存储，方便检索，也可以部署集群，提高效率，最主要是它是走内存的，查询效率极高，为大数据检索而生！！！</p>
</blockquote>
<h2 id="使用场景es"><a class="markdownIt-Anchor" href="#使用场景es">#</a> 使用场景（Es）</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/157dbcd31b4a4534a70bf24b62050d10.png" alt="在这里插入图片描述"></p>
<hr>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.110Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.498Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">11 分钟读完 (大约1657个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Elasticsearch%E3%80%91Elasticsearch7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6/">ELASTICSEARCH7.X安全性之访问密码设置</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="elasticsearch7x安全性之访问密码设置"><a class="markdownIt-Anchor" href="#elasticsearch7x安全性之访问密码设置">#</a> ELASTICSEARCH7.X 安全性之访问密码设置</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当我们安装完ElasticSearch的时候发现，访问过程中我们没有任何安全认证就可以直接访问并操作。如果是生产环境，端口向外暴露的话，那么对数据的安全性是无法得到保障的。</span><br></pre></td></tr></table></figure>
<p>一般解决方案有</p>
<ul>
<li>开启 ElasticSearch 认证插件，访问的时候添加账密</li>
<li>当然也可以通过 nginx 作代理防护</li>
</ul>
<p>本文主要讲解通过启用 X-Pack 来设置 ElasticSearch 的访问密码。</p>
<p>集群与单据环境都适合次方法</p>
<ul>
<li>集群与单据环境配置的区别就是，集群需要在某一台生成证书然后拷贝到其它节点目录下。</li>
<li>集群环境重设置密码的时候需要整个集群节点都已启动，可在任一台处修改。</li>
</ul>
<h2 id="2x-pack简介"><a class="markdownIt-Anchor" href="#2x-pack简介">#</a> 2.X-PACK 简介</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Pack是Elastic Stack扩展功能，提供安全性，警报，监视，报告，机器学习和许多其他功能。 ES7.0+之后，默认情况下，当安装Elasticsearch时，会自动安装X-Pack，无需单独再安装。自6.8以及7.1+版本之后，基础级安全永久免费了。</span><br><span class="line">在使用的时候主要需要配置一下证书，以及修改配置文件（config/elasticsearch.yml ）</span><br></pre></td></tr></table></figure>
<h2 id="3证书配置"><a class="markdownIt-Anchor" href="#3证书配置">#</a> 3. 证书配置</h2>
<h3 id="31生成节点证书"><a class="markdownIt-Anchor" href="#31生成节点证书">#</a> 3.1 生成节点证书</h3>
<p>切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin<br>
 借助 elasticsearch-certutil 命令生成证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./elasticsearch-certutil ca -out config/certs/elastic-certificates.p12 -pass</span><br></pre></td></tr></table></figure>
<p>这里单独设置了一个 证书文件目录 config/certs<br>
<img src="https://www.freesion.com/images/951/a3d0c1934c0ed0f8440f830d63e96dbf.png" alt="在这里插入图片描述"></p>
<p>生成后的证书<br>
<img src="https://www.freesion.com/images/953/de92ac2cf73d1ed0da994f9d1066e8f1.png" alt="在这里插入图片描述"></p>
<h3 id="32修改配置"><a class="markdownIt-Anchor" href="#32修改配置">#</a> 3.2 修改配置</h3>
<p>配置通信证书 &gt; 需要在 config 目前下 elasticsearch.yml 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启xpack</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line"># 证书配置</span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="line">xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12</span><br><span class="line">xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其它配置（可选）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#跨域配置</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>注：若是集群环境则需要将证书文件目录，以及配置文件，在所有集群环境下都修改一下。</p>
<h3 id="33重启生效"><a class="markdownIt-Anchor" href="#33重启生效">#</a> 3.3. 重启生效</h3>
<p>需要重启 elasticsearch</p>
<p>注：若是集群环境下则需要启动所有集群节点，再统一设置密码</p>
<p>注：重启异常情况，若出现报错，类似 failed to load plugin class [org.elasticsearch.xpack.core.XPackPlugin]<br>
 请检查是否是使用 root 用户生成的证书，启动用户无权限导致。</p>
<h2 id="4设置用户密码"><a class="markdownIt-Anchor" href="#4设置用户密码">#</a> 4. 设置用户密码</h2>
<p>执行设置用户名和密码的命令，内置了部分用户<br>
切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin/</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 手动配置每个用户密码模式（需要一个一个的输入）</span><br><span class="line">./elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>也可以先自动配置密码后续再修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#自动配置每个用户密码（随机生成并返回字符串密码,需要保存好）</span><br><span class="line">./elasticsearch-setup-passwords auto  </span><br></pre></td></tr></table></figure>
<p>下图 1 是自动生成密码情况（一定拷贝下来要牢记密码）<br>
<img src="https://www.freesion.com/images/198/f383d0d38bab2a11f3293d44ffccf0ae.png" alt="在这里插入图片描述"></p>
<p>下图 2 是自定义密码情况<br>
分别为多个用户设置密码例如：elastic, kibana, logstash_system,beats_system,<br>
 设置密码的时候需要连续输入 2 遍。<br>
<img src="https://www.freesion.com/images/458/363890f3fdffcc0b1bcfaae3c8295952.png" alt="在这里插入图片描述"></p>
<p>部分内置账号的角色权限解释如下：</p>
<ul>
<li>elastic 账号：拥有 superuser 角色，是内置的超级用户。</li>
<li>kibana 账号：拥有 kibana_system 角色，用户 kibana 用来连接 elasticsearch 并与之通信。Kibana 服务器以该用户身份提交请求以访问集群监视 API 和 .kibana 索引。不能访问 index。</li>
<li>logstash_system 账号：拥有 logstash_system 角色。用户 Logstash 在 Elasticsearch 中存储监控信息时使用。</li>
</ul>
<p>至此单节点安全配置完毕，重启 es 后访问 9200 会出现用户名和密码的提示窗口，我们就可以通过用户生成的密码过行访问了</p>
<h2 id="5测试访问"><a class="markdownIt-Anchor" href="#5测试访问">#</a> 5. 测试访问</h2>
<p>通过查看证书方式，顺便测试一下密码是否生效了<br>
浏览器输入 <a target="_blank" rel="noopener" href="http://ip:9200/_license">http://IP:9200/_license</a> 可以看到，弹窗出来，需要输入密码了<br>
<img src="https://www.freesion.com/images/561/b7034fa6ab245e277567b01d40929119.png" alt="在这里插入图片描述"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9b1a95e8a4b361dd4f7e3012300d1115.png" alt="在这里插入图片描述"></p>
<h2 id="附录常见问题"><a class="markdownIt-Anchor" href="#附录常见问题">#</a> 附录：常见问题</h2>
<h3 id="1如何修改账号密码"><a class="markdownIt-Anchor" href="#1如何修改账号密码">#</a> 1. 如何修改账号密码</h3>
<p>以 elastic 账号为例，注意需要在 elasticsearch 服务已启动的情况下进行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -u elastic:123456 -XPUT &#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27; -d &#x27;&#123; &quot;password&quot; : &quot;1234567&quot; &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2客户端es-head连接问题"><a class="markdownIt-Anchor" href="#2客户端es-head连接问题">#</a> 2. 客户端 ES-HEAD 连接问题</h3>
<p>连接失败情况下先检查是否是跨域问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>例如下图连接的时候报错未授权<br>
<img src="https://www.freesion.com/images/96/57fa25b106cf1cdee9f44a2f8577e620.png" alt="在这里插入图片描述"></p>
<p>解决方案：在访问的 URL 中拼接授权账号信息<br>
示例：?auth_user=elastic&amp;auth_password=1234567</p>
<p>示例：指定服务端地址以及账户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://IP:9100/?base_uri=http://IP:9200&amp;auth_user=elastic&amp;auth_password=1234567</span><br></pre></td></tr></table></figure>
<h3 id="3启动报xpack相关错"><a class="markdownIt-Anchor" href="#3启动报xpack相关错">#</a> 3. 启动报 XPACK 相关错</h3>
<p><img src="https://www.freesion.com/images/947/90ff281ef660a79e49875391f87e474b.png" alt="在这里插入图片描述"></p>
<p>DecoderException: javax.net.ssl.SSLHandshakeException: No available authentication scheme<br>
<img src="https://www.freesion.com/images/485/efd6d897ad8655121334fd050eecd445.png" alt="在这里插入图片描述"></p>
<p>解决方案：请通过上文配置步骤，排查，检查证书是否已经配置好，以及配置是否填写正确</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.107Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.493Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">1 小时读完 (大约7699个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Elasticsearch%E3%80%91Elasticsearch/">Elasticsearch学习</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h1>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/elasticsearch.jpg" alt="img"></p>
<h2 id="目标"><a class="markdownIt-Anchor" href="#目标">#</a> 目标</h2>
<ul>
<li>了解 ES 中的基本概念</li>
<li>掌握 RESTFul 操作 ES 的 CRUD</li>
<li>掌握 Spring Data Elasticsearch 操作 ES</li>
</ul>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Elasticsearch 是一个基于 Lucene 的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<p>我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用 JSON 通过 HTTP 来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多用户，我们希望建立一个云的解决方案。因此我们利用 Elasticsearch 来解决所有这些问题及可能出现的更多其它问题。</p>
<h2 id="安装和运行"><a class="markdownIt-Anchor" href="#安装和运行">#</a> 安装和运行</h2>
<p>该软件是基于 Java 编写的解压即用的软件，只需要有 Java 的运行环境即可，把压缩包解压后，进入到 bin 目录运行 elasticsearch.bat，出现以下界面，表示成功启动服务器</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606092632.png" alt="img"></p>
<p>浏览器输入：<strong>localhost:9200</strong>，看到浏览器输出服务器的信息，表示安装成功，可以使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606093141.png" alt="img"></p>
<p>注意：程序启动后有两个端口 9200 和 9300，9200 端口用于 HTTP 协议，基于 RESTFul 来使用，9300 端口用于 TCP 协议，基于 jar 包来使用</p>
<h3 id="后台启动"><a class="markdownIt-Anchor" href="#后台启动">#</a> 后台启动</h3>
<p>使用<strong>安装目录 /bin/elasticsearch-service.bat</strong> 程序可以把 Elasticsearch 安装后服务列表中，以后我们可以在服务列表来启动该程序，也可以设置成开机启动模式</p>
<p>注意：设置后台启动需要手动配置 Java 虚拟机的路径，使用命令<strong> elasticsearch-service.bat manager</strong> 来配置</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190622211819.png" alt="img"></p>
<h3 id="安装head插件"><a class="markdownIt-Anchor" href="#安装head插件">#</a> 安装 head 插件</h3>
<p>Elasticsearch 默认的客户端工具是命令行形式的，操作起来不方便，也不直观看到数据的展示，所以我们需要去安装一个可视化插件，但是这些插件都是基于 H5 开发的，在谷歌的应用商店中找到<strong> elasticsearch-head</strong> 插件，然后安装，使用该插件能比较直观的展示服务器中的数据</p>
<h3 id="安装kibana"><a class="markdownIt-Anchor" href="#安装kibana">#</a> 安装 kibana</h3>
<p>该软件也是解压即用的工具，用于管理和监控 Elasticsearch 的运作，同时内部包含了客户端工具，支持 RESTFul 操作 Elasticsearch。解压后运行 bin/kibana.bat，看到启动成功的端口号即可以使用浏览器来使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606141235.png" alt="img"></p>
<p>浏览器输入：<a target="_blank" rel="noopener" href="http://localhost:5601/">http://localhost:5601</a></p>
<h2 id="概念名词"><a class="markdownIt-Anchor" href="#概念名词">#</a> 概念名词</h2>
<h3 id="数据存储图"><a class="markdownIt-Anchor" href="#数据存储图">#</a> 数据存储图</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604113843.png" alt="img"></p>
<p>注意：从 Elasticsearch6 开始一个索引里面只能有一个类型，后续计划删除类型这个概念，从 ES6 开始一般让索引名称和类型名称一致</p>
<h3 id="主要组件"><a class="markdownIt-Anchor" href="#主要组件">#</a> 主要组件</h3>
<ul>
<li>
<p>索引</p>
<p>ES 将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于 SQL 中的一个数据库，或者一个数据存储方案 (schema)。索引由其名称 (必须为全小写字符) 进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个 ES 集群中可以按需创建任意数目的索引。</p>
</li>
<li>
<p>类型</p>
<p>类型是索引内部的逻辑分区 (category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型 (type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于表。</p>
</li>
<li>
<p>映射</p>
<p>Mapping, 就是对索引库中索引的字段名称及其数据类型进行定义，类似于 mysql 中的表结构信息。不过 es 的 mapping 比数据库灵活很多，它可以动态识别字段。一般不需要指定 mapping 都可以，因为 es 会自动根据数据格式识别它的类型，如果你需要对某些字段添加特殊属性（如：定义使用其它分词器、是否分词、是否存储等），就必须手动添加 mapping。</p>
<p>需要注意的是映射是不可修改的，一旦确定就不允许改动，在使用自动识别功能时，会以第一个存入的文档为参考来建立映射，后面存入的文档也必须符合该映射才能存入</p>
</li>
<li>
<p>文档</p>
<p>文档是 Lucene 索引和搜索的原子单位，它是包含了一个或多个域的容器，基于 JSON 格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为多值域。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p>
</li>
</ul>
<h3 id="分片和副本"><a class="markdownIt-Anchor" href="#分片和副本">#</a> 分片和副本</h3>
<p>ES 的分片 (shard) 机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的 Lucene 索引完成索引数据的分割存储功能，这每一个物理的 Lucene 索引称为一个分片 (shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为 5 个。</p>
<p>Shard 有两种类型：primary 和 replica，即主 shard 及副本 shard。Primary shard 用于文档存储，每个新的索引会自动创建 5 个 Primary shard，当然此数量可在索引创建之前通过配置自行定义，不过，一旦创建完成，其 Primary shard 的数量将不可更改。Replica shard 是 Primary Shard 的副本，用于冗余数据及提高搜索性能。每个 Primary shard 默认配置了一个 Replica shard，但也可以配置多个，且其数量可动态更改。ES 会根据需要自动增加或减少这些 Replica shard 的数量。</p>
<h3 id="分词器"><a class="markdownIt-Anchor" href="#分词器">#</a> 分词器</h3>
<p>把文本内容按照标准进行切分，默认的是 standard，该分词器按照单词切分，内容转变为小写，去掉标点，遇到每个中文字符都当成 1 个单词处理，后面会安装开源的中文分词器插件（ik）</p>
<h4 id="感受分词器效果"><a class="markdownIt-Anchor" href="#感受分词器效果">#</a> 感受分词器效果</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">先创建一个名叫shop_product的索引，然后再感受分词效果</span><br><span class="line">PUT /shop_product</span><br><span class="line"></span><br><span class="line">默认分词器：</span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;</span><br><span class="line">&#125;</span><br><span class="line">结论：默认的分词器只能对英文正常分词，不能对中文正常分词</span><br></pre></td></tr></table></figure>
<h4 id="安装ik分词器"><a class="markdownIt-Anchor" href="#安装ik分词器">#</a> 安装 IK 分词器</h4>
<p>直接把压缩文件中的内容解压，然后放在 elasticsearch/plugins 下，然后重启即可</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190611130218.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IK分词器：</span><br><span class="line">ik_smart：粗力度分词</span><br><span class="line">ik_max_word：细力度分词</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结论：都能正常分词</span><br></pre></td></tr></table></figure>
<h4 id="拓展词库"><a class="markdownIt-Anchor" href="#拓展词库">#</a> 拓展词库</h4>
<p>最简单的方式就是找到 IK 插件中的<strong> config/main.dic</strong> 文件，往里面添加新的词汇，然后重启服务器即可</p>
<h3 id="倒排索引"><a class="markdownIt-Anchor" href="#倒排索引">#</a> 倒排索引</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604141259.png" alt="img"></p>
<h2 id="基本操作了解"><a class="markdownIt-Anchor" href="#基本操作了解">#</a> 基本操作（了解）</h2>
<h3 id="索引操作"><a class="markdownIt-Anchor" href="#索引操作">#</a> 索引操作</h3>
<p>建表索引，相当于在是在建立数据库</p>
<h4 id="建立索引"><a class="markdownIt-Anchor" href="#建立索引">#</a> 建立索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">在没有特殊设置的情况下，默认有5个分片，1个备份，也可以通过请求参数的方式来指定</span><br><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 5, //设置5个片区</span><br><span class="line">    &quot;number_of_replicas&quot;: 1 //设置1个备份</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="删除索引"><a class="markdownIt-Anchor" href="#删除索引">#</a> 删除索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名</span><br></pre></td></tr></table></figure>
<h3 id="映射操作"><a class="markdownIt-Anchor" href="#映射操作">#</a> 映射操作</h3>
<h4 id="建立索引和映射"><a class="markdownIt-Anchor" href="#建立索引和映射">#</a> 建立索引和映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    类型名: &#123;</span><br><span class="line">      &quot;properties..0&quot;: &#123;</span><br><span class="line">        字段名: &#123;</span><br><span class="line">          &quot;type&quot;: 字段类型, </span><br><span class="line">          &quot;analyzer&quot;: 分词器类型, </span><br><span class="line">          &quot;search_analyzer&quot;: 分词器类型,</span><br><span class="line">          ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">字段类型：double / long / integer / text / keyword / date / binary</span><br><span class="line">注意：text和keyword都是字符串类型，但是只有text类型的数据才能分词，字段的配置一旦确定就不能更改</span><br><span class="line">映射的配置项有很多，我们可以根据需要只配置用得上的属性</span><br></pre></td></tr></table></figure>
<h4 id="查询映射"><a class="markdownIt-Anchor" href="#查询映射">#</a> 查询映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：GET /索引名/_mapping</span><br></pre></td></tr></table></figure>
<h2 id="crud操作"><a class="markdownIt-Anchor" href="#crud操作">#</a> CRUD 操作</h2>
<h3 id="文档操作"><a class="markdownIt-Anchor" href="#文档操作">#</a> 文档操作</h3>
<h4 id="新增和替换文档"><a class="markdownIt-Anchor" href="#新增和替换文档">#</a> 新增和替换文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名/类型名/文档ID</span><br><span class="line">&#123;</span><br><span class="line">  field1: value1,</span><br><span class="line">  field2: value2,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：当索引/类型/映射不存在时，会使用默认设置自动添加</span><br><span class="line">ES中的数据一般是从别的数据库导入的，所以文档的ID会沿用原数据库中的ID</span><br><span class="line">索引库中没有该ID对应的文档时则新增，拥有该ID对应的文档时则替换</span><br><span class="line"></span><br><span class="line">需求1：新增一个文档</span><br><span class="line">需求2：替换一个文档</span><br></pre></td></tr></table></figure>
<p>每一个文档都内置以下字段</p>
<blockquote>
<p>_index：所属索引</p>
<p>_type：所属类型</p>
<p>_id：文档 ID</p>
<p>_version：乐观锁版本号</p>
<p>_source：数据内容</p>
</blockquote>
<h4 id="查询文档"><a class="markdownIt-Anchor" href="#查询文档">#</a> 查询文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">根据ID查询 -&gt; GET /索引名/类型名/文档ID</span><br><span class="line">查询所有（基本查询语句） -&gt; GET /索引名/类型名/_search</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID查询一个文档</span><br><span class="line">需求2：查询所有的文档</span><br></pre></td></tr></table></figure>
<p>查询所有结果中包含以下字段</p>
<blockquote>
<p>took：耗时</p>
<p>_shards.total：分片总数</p>
<p>hits.total：查询到的数量</p>
<p>hits.max_score：最大匹配度</p>
<p>hits.hits：查询到的结果</p>
<p>hits.hits._score：匹配度</p>
</blockquote>
<h4 id="删除文档"><a class="markdownIt-Anchor" href="#删除文档">#</a> 删除文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名/类型名/文档ID</span><br><span class="line">注意：这里的删除并且不是真正意义上的删除，仅仅是清空文档内容而已，并且标记该文档的状态为删除</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID删除一个文档</span><br><span class="line">需求2：替换刚刚删除的文档</span><br></pre></td></tr></table></figure>
<h2 id="高级查询"><a class="markdownIt-Anchor" href="#高级查询">#</a> 高级查询</h2>
<p>数据准备：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">PUT /shop_product</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;shop_product&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;price&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;double&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;intro&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;brand&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /shop_product/shop_product/_bulk</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:1,&quot;title&quot;:&quot;Apple iPhone XR (A2108) 128GB 白色 移动联通电信4G手机 双卡双待&quot;,&quot;price&quot;:5299,&quot;intro&quot;:&quot;【iPhoneXR限时特惠！】6.1英寸视网膜显示屏，A12仿生芯片，面容识别，无线充电，支持双卡！选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:2,&quot;title&quot;:&quot;Apple 2019款 Macbook Pro 13.3【带触控栏】八代i7 18G 256G RP645显卡 深空灰 苹果笔记本电脑 轻薄本 MUHN2CH/A&quot;,&quot;price&quot;:15299,&quot;intro&quot;:&quot;【八月精选】Pro2019年新品上市送三重好礼，现在购买领满8000减400元优惠神劵，劵后更优惠！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;Apple iPad Air 3 2019年新款平板电脑 10.5英寸（64G WLAN版/A12芯片/Retina显示屏/MUUL2CH/A）金色&quot;,&quot;price&quot;:3788,&quot;intro&quot;:&quot;8月尊享好礼！买iPad即送蓝牙耳机！领券立减！多款产品支持手写笔！【新一代iPad，总有一款适合你】选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 4&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;华为HUAWEI MateBook X Pro 2019款 英特尔酷睿i5 13.9英寸全面屏轻薄笔记本电脑(i5 8G 512G 3K 触控) 灰&quot;,&quot;price&quot;:7999,&quot;intro&quot;:&quot;3K全面屏开启无界视野;轻薄设计灵动有型，HuaweiShare一碰传&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 5&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:5,&quot;title&quot;:&quot;华为 HUAWEI Mate20 X (5G) 7nm工艺5G旗舰芯片全面屏超大广角徕卡三摄8GB+256GB翡冷翠5G双模全网通手机&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;【5G双模，支持SA/NSA网络，7.2英寸全景巨屏，石墨烯液冷散热】5G先驱，极速体验。&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 6&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:6,&quot;title&quot;:&quot;华为平板 M6 10.8英寸麒麟980影音娱乐平板电脑4GB+64GB WiFi（香槟金）&quot;,&quot;price&quot;:2299,&quot;intro&quot;:&quot;【华为暑期购】8月2日-4日，M5青春版指定爆款型号优惠100元，AI语音控制&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 7&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:7,&quot;title&quot;:&quot;荣耀20 PRO DXOMARK全球第二高分 4800万四摄 双光学防抖 麒麟980 全网通4G 8GB+128GB 蓝水翡翠 拍照手机&quot;,&quot;price&quot;:3199,&quot;intro&quot;:&quot;白条6期免息！麒麟980，4800万全焦段AI四摄！荣耀20系列2699起，4800万超广角AI四摄！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 8&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:8,&quot;title&quot;:&quot;荣耀MagicBook Pro 16.1英寸全面屏轻薄性能笔记本电脑（酷睿i7 8G 512G MX250 IPS FHD 指纹解锁）冰河银&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;16.1英寸无界全面屏金属轻薄本，100%sRGB色域，全高清IPS防眩光护眼屏，14小时长续航，指纹一健开机登录，魔法一碰传高速传输。&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 9&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:9,&quot;title&quot;:&quot;荣耀平板5 麒麟8核芯片 GT游戏加速 4G+128G 10.1英寸全高清屏影音平板电脑 WiFi版 冰川蓝&quot;,&quot;price&quot;:1549,&quot;intro&quot;:&quot;【爆款平板推荐】哈曼卡顿专业调音，10.1英寸全高清大屏，双喇叭立体环绕音，配置多重护眼，值得拥有！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 10&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:10,&quot;title&quot;:&quot;小米9 4800万超广角三摄 6GB+128GB全息幻彩蓝 骁龙855 全网通4G 双卡双待 水滴全面屏拍照智能游戏手机&quot;,&quot;price&quot;:2799,&quot;intro&quot;:&quot;限时优惠200，成交价2799！索尼4800万广角微距三摄，屏下指纹解锁！&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 11&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:11,&quot;title&quot;:&quot;小米(MI)Pro 2019款 15.6英寸金属轻薄笔记本(第八代英特尔酷睿i7-8550U 16G 512GSSD MX250 2G独显) 深空灰&quot;,&quot;price&quot;:6899,&quot;intro&quot;:&quot;【PCIE固态硬盘、72%NTSC高色域全高清屏】B面康宁玻璃覆盖、16G双通道大内存、第八代酷睿I7处理器、专业级调校MX150&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 12&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:12,&quot;title&quot;:&quot;联想(Lenovo)拯救者Y7000P 2019英特尔酷睿i7 15.6英寸游戏笔记本电脑(i7 9750H 16G 1T SSD GTX1660Ti 144Hz)&quot;,&quot;price&quot;:9299,&quot;intro&quot;:&quot;超大1T固态，升级双通道16G内存一步到位，GTX1660Ti电竞级独显，英特尔9代i7H高性能处理器，144Hz电竞屏窄边框！&quot;,&quot;brand&quot;:&quot;联想&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>Elasticsearch 基于 JSON 提供完整的查询 DSL（Domain Specific Language：领域特定语言）来定义查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">基本语法：</span><br><span class="line">GET /索引名/类型名/_search</span><br></pre></td></tr></table></figure>
<p>一般都是需要配合查询参数来使用的，配合不同的参数有不同的查询效果</p>
<p>参数配置项可以参考博客：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6333940621ec">https://www.jianshu.com/p/6333940621ec</a></p>
<h3 id="结果排序"><a class="markdownIt-Anchor" href="#结果排序">#</a> 结果排序</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;field: 排序规则&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">排序</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">排序规则：</span><br><span class="line">asc表示升序</span><br><span class="line">desc:表示降序</span><br><span class="line">没有配置排序的情况下，默认按照评分降序排列</span><br></pre></td></tr></table></figure>
<h3 id="分页查询"><a class="markdownIt-Anchor" href="#分页查询">#</a> 分页查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: start,</span><br><span class="line">  &quot;size&quot;: pageSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分页 从第几个开始 每页几个</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 2,</span><br><span class="line">  &quot;size&quot;: 4,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">需求1：查询所有文档按照价格降序排列</span><br><span class="line">需求2：分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br></pre></td></tr></table></figure>
<h3 id="检索查询"><a class="markdownIt-Anchor" href="#检索查询">#</a> 检索查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    检索方式: &#123;field: value&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 全文检索</span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;游戏 手机&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索查询 精准匹配</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: 15299</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 范围检索</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 5000,</span><br><span class="line">        &quot;lte&quot;: 10000</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索方式：</span><br><span class="line">term表示精确匹配，value值不会被分词器拆分，按照倒排索引匹配</span><br><span class="line">match表示全文检索，value值会被分词器拆分，然后去倒排索引中匹配</span><br><span class="line">range表示范围检索，其value值是一个对象，如&#123; &quot;range&quot;: &#123;field: &#123;比较规则: value, ...&#125;&#125; &#125;</span><br><span class="line">  比较规则有gt / gte / lt / lte 等</span><br><span class="line">  </span><br><span class="line">注意：term和match都能用在数值和字符上，range用在数值上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br></pre></td></tr></table></figure>
<h3 id="关键字查询"><a class="markdownIt-Anchor" href="#关键字查询">#</a> 关键字查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: value,</span><br><span class="line">      &quot;fields&quot;: [field1, field2, ...]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">关键字查询</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multi_match：表示在多个字段间做检索，只要其中一个字段满足条件就能查询出来，多用在字段上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br></pre></td></tr></table></figure>
<h3 id="高亮显示"><a class="markdownIt-Anchor" href="#高亮显示">#</a> 高亮显示</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; ... &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      field1: &#123;&#125;,</span><br><span class="line">      field2: &#123;&#125;,</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;: 开始标签,</span><br><span class="line">    &quot;post_tags&quot; 结束标签</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">高亮显示</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;&#125;,</span><br><span class="line">      &quot;intro&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;:&quot;&lt;h1&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;:&quot;&lt;/h1&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight：表示高亮显示，需要在fields中配置哪些字段中检索到该内容需要高亮显示</span><br><span class="line">  必须配合检索(term / match)一起使用</span><br><span class="line">  </span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br></pre></td></tr></table></figure>
<h3 id="逻辑查询"><a class="markdownIt-Anchor" href="#逻辑查询">#</a> 逻辑查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">参数格式： </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      逻辑规则: [</span><br><span class="line">        &#123;检索方式: &#123;field: value&#125;&#125;, </span><br><span class="line">        ...</span><br><span class="line">      ],</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;i7&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gt&quot;: 7000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 1000,</span><br><span class="line">            &quot;lte&quot;: 3000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑规则：must / should / must_not，相当于and / or / not</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br></pre></td></tr></table></figure>
<h3 id="过滤查询"><a class="markdownIt-Anchor" href="#过滤查询">#</a> 过滤查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123; 检索方式: &#123; field: value &#125; &#125;，            	</span><br><span class="line">        ...</span><br><span class="line">      ]</span><br><span class="line">    &#125;             </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">过滤查询 不评分</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">从效果上讲过滤查询和检索查询能做一样的效果</span><br><span class="line">区别在于过滤查询不评分，结果能缓存，检索查询要评分，结果不缓存</span><br><span class="line">一般是不会直接使用过滤查询，都是在检索了一定数据的基础上再使用</span><br></pre></td></tr></table></figure>
<p>关于 filter 的更多认知推荐大家读这篇博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/laoyang360/article/details/80468757">https://blog.csdn.net/laoyang360/article/details/80468757</a></p>
<h3 id="分组查询"><a class="markdownIt-Anchor" href="#分组查询">#</a> 分组查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    自定义分组字段: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: 分组字段, </span><br><span class="line">        &quot;order&quot;: &#123;自定义统计字段:排序规则&#125;, </span><br><span class="line">        &quot;size&quot;: 10  //默认显示10组 </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; //分组后的统计查询，相当于MySQL分组函数查询</span><br><span class="line">        自定义统计字段: &#123;</span><br><span class="line">          分组运算: &#123;</span><br><span class="line">            &quot;field&quot;: 统计字段</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;value_count&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;id&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group_aggs.count&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">          &quot;stats&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组运算：avg / sum / min / max / value_count / stats(执行以上所有功能的)</span><br><span class="line">注意：这里是size=0其目的是为了不要显示hit内容，专注点放在观察分组上</span><br><span class="line"></span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br></pre></td></tr></table></figure>
<h2 id="批处理了解"><a class="markdownIt-Anchor" href="#批处理了解">#</a> 批处理（了解）</h2>
<p>当需要集中的批量处理文档时，如果依然使用传统的操作单个 API 的方式，将会浪费大量网络资源，Elasticsearch 为了提高操作的性能，专门提供了批处理的 API</p>
<h3 id="mget批量查询"><a class="markdownIt-Anchor" href="#mget批量查询">#</a> mget 批量查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">GET /索引名/类型/_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;: [</span><br><span class="line">    &#123;&quot;_id&quot;: 文档ID&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bulk批量增删改"><a class="markdownIt-Anchor" href="#bulk批量增删改">#</a> bulk 批量增删改</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">POST /索引名/类型/_bulk</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line"></span><br><span class="line">动作：create / update / delete，其中delete只有1行JSON，其他操作都是有2行JSON，并且JSON不能格式化，如果是update动作，它的数据需要加个key为doc</span><br><span class="line">如：</span><br><span class="line">&#123;&quot;update&quot;: &#123;&quot;_id&quot;: xx&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;: &#123;&quot;xx&quot;:xx, &quot;xx&quot;:xx&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="spring-data-elasticsearch"><a class="markdownIt-Anchor" href="#spring-data-elasticsearch">#</a> Spring Data Elasticsearch</h2>
<h3 id="准备环境"><a class="markdownIt-Anchor" href="#准备环境">#</a> 准备环境</h3>
<h4 id="导入依赖"><a class="markdownIt-Anchor" href="#导入依赖">#</a> 导入依赖</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--SpringBoot整合Spring Data Elasticsearch的依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.8.3&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h4 id="编写domain"><a class="markdownIt-Anchor" href="#编写domain">#</a> 编写 DOMAIN</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  @Document：配置操作哪个索引下的哪个类型</span><br><span class="line">  @Id：标记文档ID字段</span><br><span class="line">  @Field：配置映射信息，如：分词器</span><br><span class="line"> */</span><br><span class="line">@Getter@Setter@ToString</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@Document(indexName=&quot;shop_product&quot;, type=&quot;shop_product&quot;)</span><br><span class="line">public class Product &#123;</span><br><span class="line">    @Id</span><br><span class="line">    private String id;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String title;</span><br><span class="line"></span><br><span class="line">    private Integer price;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String intro;</span><br><span class="line"></span><br><span class="line">    @Field(type=FieldType.Keyword)</span><br><span class="line">    private String brand;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置连接信息"><a class="markdownIt-Anchor" href="#配置连接信息">#</a> 配置连接信息</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#application.properties</span><br><span class="line"># 配置集群名称，名称写错会连不上服务器，默认elasticsearch</span><br><span class="line">spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"># 配置集群节点</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchrepository"><a class="markdownIt-Anchor" href="#elasticsearchrepository">#</a> ElasticsearchRepository</h3>
<p>该接口是框架封装的用于操作 Elastsearch 的高级接口，只要我们自己的写个接口去继承该接口就能直接对 Elasticsearch 进行 CRUD 操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  泛型1：domain的类型</span><br><span class="line">  泛型2：文档主键类型</span><br><span class="line">  该接口直接该给Spring，底层会使用JDK代理的方式创建对象，交给容器管理</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public interface ProductESRepository extends ElasticsearchRepository&lt;Product, String&gt; &#123;</span><br><span class="line">    // 符合Spring Data规范的高级查询方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完成crud分页排序"><a class="markdownIt-Anchor" href="#完成crud分页排序">#</a> 完成 CRUD + 分页 + 排序</h3>
<h3 id="组件介绍"><a class="markdownIt-Anchor" href="#组件介绍">#</a> 组件介绍</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ElasticsearchRepository：框架封装的用于便捷完成常用操作的工具接口</span><br><span class="line">ElasticsearchTemplate：框架封装的用于便捷操作Elasticsearch的模板类</span><br><span class="line"></span><br><span class="line">NativeSearchQueryBuilder：用于生成查询条件的构建器，需要去封装各种查询条件</span><br><span class="line">QueryBuilder：该接口表示一个查询条件，其对象可以通过QueryBuilders工具类中的方法快速生成各种条件</span><br><span class="line">  boolQuery()：生成bool条件，相当于 &quot;bool&quot;: &#123; &#125;</span><br><span class="line">  matchQuery()：生成match条件，相当于 &quot;match&quot;: &#123; &#125;</span><br><span class="line">  rangeQuery()：生成range条件，相当于 &quot;range&quot;: &#123; &#125;</span><br><span class="line">AbstractAggregationBuilder：用于生成分组查询的构建器，其对象通过AggregationBuilders工具类生成</span><br><span class="line">Pageable：表示分页参数，对象通过PageRequest.of(页数, 容量)获取</span><br><span class="line">SortBuilder：排序构建器，对象通过SortBuilders.fieldSort(字段).order(规则)获取</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchtemplate"><a class="markdownIt-Anchor" href="#elasticsearchtemplate">#</a> ElasticsearchTemplate</h3>
<p>该模板类，封装了便捷操作 Elasticsearch 的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作，该对象用起来会略微复杂些，尤其是对于查询，还需要把查询到的结果自己封装对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//该对象已经由SpringBoot完成自动配置，直接注入即可</span><br><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br></pre></td></tr></table></figure>
<p>一般情况下，ElasticsearchTemplate 和 ElasticsearchRepository 是分工合作的，ElasticsearchRepository 已经能完成绝大部分的功能，如果遇到复杂的查询则要使用 ElasticsearchTemplate，如多字段分组、高亮显示等</p>
<h3 id="实例代码"><a class="markdownIt-Anchor" href="#实例代码">#</a> 实例代码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">private ProductESRepository repository;</span><br><span class="line"></span><br><span class="line">// 新增或者覆盖一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testSaveOrUpdate() throws Exception &#123;</span><br><span class="line">    // 索引库中不存在则新增，存在则覆盖</span><br><span class="line">    Product p = new Product(&quot;13&quot;, &quot;华为手环 B5（Android 运动手环）&quot;, 999,</span><br><span class="line">                            &quot;高清彩屏 腕上蓝牙耳机 心率检测 来电消息提醒&quot;, &quot;华为&quot;);</span><br><span class="line">    repostitory.save(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testDelete() throws Exception &#123;</span><br><span class="line">    repostitory.deleteById(&quot;13&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 根据ID查询一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testGet() throws Exception &#123;</span><br><span class="line">    Optional&lt;Product&gt; optional = repostitory.findById(&quot;1&quot;);</span><br><span class="line">    optional.ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询所有文档</span><br><span class="line">@Test</span><br><span class="line">public void testList() throws Exception &#123;</span><br><span class="line">    Iterable&lt;Product&gt; iter = repostitory.findAll();</span><br><span class="line">    iter.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br><span class="line">@Test</span><br><span class="line">public void testQuery1() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置分页信息</span><br><span class="line">    builder.withPageable(PageRequest.of(1, 3));</span><br><span class="line">    // 设置排序信息</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.DESC));</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    System.out.println(page.getTotalElements()); //总记录数</span><br><span class="line">    System.out.println(page.getTotalPages()); //总页数</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery2() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.matchQuery(&quot;title&quot;, &quot;游戏 手机&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格等于15299的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery3() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.termQuery(&quot;price&quot;, 15299)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格在5000~9000之间商品，按照价格升序排列</span><br><span class="line">@Test</span><br><span class="line">public void testQuery4() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.rangeQuery(&quot;price&quot;)</span><br><span class="line">            .gte(5000).lte(9000)</span><br><span class="line">    );</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.ASC));</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery5() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery6() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">        .must(QueryBuilders.matchQuery(&quot;title&quot;, &quot;i7&quot;))</span><br><span class="line">        .must(QueryBuilders.rangeQuery(&quot;price&quot;).gt(7000))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery7() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">            .should(QueryBuilders.matchQuery(&quot;title&quot;, &quot;pro&quot;))</span><br><span class="line">            .should(QueryBuilders.rangeQuery(&quot;price&quot;).gte(1000).lte(3000))</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的数量</span><br><span class="line">@Test</span><br><span class="line">public void testQuery8() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; System.out.println(bucket.getDocCount()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的平均价格</span><br><span class="line">@Test</span><br><span class="line">public void testQuery9() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.avg(&quot;avgPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalAvg avgPrice = bucket.getAggregations().get(&quot;avgPrice&quot;);</span><br><span class="line">        System.out.println(avgPrice.getValue());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的价格数据</span><br><span class="line">@Test</span><br><span class="line">public void testQuery10() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.stats(&quot;statsPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalStats statsPrice = bucket.getAggregations().get(&quot;statsPrice&quot;);</span><br><span class="line">        System.out.println(statsPrice.getSumAsString());</span><br><span class="line">        System.out.println(statsPrice.getAvgAsString());</span><br><span class="line">        System.out.println(statsPrice.getMaxAsString());</span><br><span class="line">        System.out.println(statsPrice.getMinAsString());</span><br><span class="line">        System.out.println(statsPrice.getCount());</span><br><span class="line">        System.out.println(&quot;-----------------------&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">@Test</span><br><span class="line">public void testHighlight() throws Exception &#123;</span><br><span class="line">    // Java与JSON互转的工具对象</span><br><span class="line">    ObjectMapper mapper = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置查询哪个索引中的哪个类型</span><br><span class="line">    builder.withIndices(&quot;shop_product&quot;).withTypes(&quot;shop_product&quot;);</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    builder.withHighlightFields(</span><br><span class="line">        new HighlightBuilder.Field(&quot;title&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;),</span><br><span class="line">        new HighlightBuilder.Field(&quot;intro&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = template.queryForPage(builder.build(), Product.class, new SearchResultMapper() &#123;</span><br><span class="line">        public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse resp, Class&lt;T&gt; clazz, Pageable pageable) &#123;</span><br><span class="line">            List&lt;T&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">            try &#123;</span><br><span class="line">                for (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">                    // 把查询到的JSON字符串转换成Java对象</span><br><span class="line">                    T t = mapper.readValue(hit.getSourceAsString(), clazz);</span><br><span class="line">                    for (HighlightField field : hit.getHighlightFields().values()) &#123;</span><br><span class="line">                        // 替换需要高亮显示的字段，用到Apache的BeanUtils工具</span><br><span class="line">                        BeanUtils.setProperty(t, field.getName(), field.getFragments()[0].string());</span><br><span class="line">                    &#125;</span><br><span class="line">                    list.add(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            long total = resp.getHits().totalHits;</span><br><span class="line">            return new AggregatedPageImpl&lt;&gt;(list, pageable, total);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="springboot23x以上配置"><a class="markdownIt-Anchor" href="#springboot23x以上配置">#</a> springboot2.3.x 以上配置</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.0.1.RELEASE/reference/html/#new-features">配置关系对应</a></p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png" alt="截屏2021-08-14 14.17.14"></p>
</blockquote>
<ol>
<li>
<p>pom 相同</p>
</li>
<li>
<p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 旧版本以spring.data.elasticsearch.开头;访问地址配置不用声明访问协议,监听es的tcp端口</span><br><span class="line">#spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br><span class="line">#spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"></span><br><span class="line">## 新版本以spring.elasticsearch.rest.开头;访问地址配置需要声明访问协议,直接监听es访问端口</span><br><span class="line">spring.elasticsearch.rest.uris=http://localhost:9200</span><br><span class="line">spring.elasticsearch.rest.username=elasticsearch</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用</p>
<ul>
<li>
<p>旧版的核心访问对象是 ElasticsearchTemplate；新版的核心访问对象是 ElasticsearchRestTemplate；</p>
</li>
<li>
<p>实体类没有类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// @Document指定当前类是索引对象。indexName:索引名称;shards:创建索引时的分片数;replicas:创建索引时的备份数</span><br><span class="line">@Document(indexName = &quot;book_&quot;, shards = 5, replicas = 1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.102Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.480Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">4 分钟读完 (大约582个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%B0%E5%BD%95/">使用docker搭建开发环境记录</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="使用docker搭建开发环境记录"><a class="markdownIt-Anchor" href="#使用docker搭建开发环境记录">#</a> 使用 docker 搭建开发环境记录</h1>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器名</span><br><span class="line">docker stop 容器名</span><br><span class="line">docker restart 容器名</span><br><span class="line"></span><br><span class="line">docker run = docker create + docker start</span><br></pre></td></tr></table></figure>
<h3 id="mysql"><a class="markdownIt-Anchor" href="#mysql">#</a> mysql</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建实例并启动</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 映射端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--name 名称</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-v 映射文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e MYSQL_ROOT_PASSWORD mysql密码</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台运行并运行</span></span><br><span class="line">docker run -p 3306:3306 --name mysql -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器</span></span><br><span class="line">docker exec -it mysql /bin/bash</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出容器</span></span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置my.conf</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 1.在容器外编辑配置文件</span></span></span><br><span class="line">vi /mydata/mysql/conf/my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">init_connect=&#x27;SET conllation_connection = utf8_unicode_ci&#x27;</span><br><span class="line">init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class="line">character-set-server=utf8</span><br><span class="line">collation-server=utf8_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 2. 重启mysql容器</span></span></span><br><span class="line">docker restart mysql</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 3. 进入mysql容器验证</span></span></span><br><span class="line">docker exec -it mysql /bin/bash </span><br><span class="line">cat /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>
<h3 id="redis"><a class="markdownIt-Anchor" href="#redis">#</a> Redis</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull redis</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置文件</span></span><br><span class="line">本地：/mydata/redis/data/redis.conf 提前准备好</span><br><span class="line">主要配置</span><br><span class="line">bind 127.0.0.1 #注释掉这部分，使redis可以外部访问</span><br><span class="line">daemonize no#用守护线程的方式启动</span><br><span class="line">requirepass 你的密码#给redis设置密码</span><br><span class="line">appendonly yes#redis持久化　　默认是no</span><br><span class="line">tcp-keepalive 300 #防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建实例并启动</span></span><br><span class="line">docker run -p 6379:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="rabbitmq"><a class="markdownIt-Anchor" href="#rabbitmq">#</a> Rabbitmq</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像management带控制台</span></span><br><span class="line">docker pull rabbitmq:management</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建实例并启动</span></span><br><span class="line">docker run -d --hostname my-rabbit --name rabbit -v /mydata/rabbitmq:/var/lib/rabbitmq -e RABBITMQ_DEFAULT_USER=root -e RABBITMQ_DEFAULT_PASS=Mm_123456 -p 15672:15672 -p 5672:5672 rabbitmq:management</span><br></pre></td></tr></table></figure>
<h3 id="mongo"><a class="markdownIt-Anchor" href="#mongo">#</a> mongo</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像</span></span><br><span class="line">docker pull mongo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建实例并启动</span></span><br><span class="line">docker run -p 27017:27017 -v /mydata/mongo:/data/db --name mongodb -d mongo</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.099Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.487Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">3 分钟读完 (大约399个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91%E5%85%B3%E4%BA%8Edocker%E6%9C%8D%E5%8A%A1%E6%8A%A5%E9%94%99WARNING%20IPv4%20forwarding%20is%20disabled.%20Networking%20will%20not%20work/">【Docker】关于docker服务报错WARNING IPv4 forwarding is disabled. Networking will not work</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work"><a class="markdownIt-Anchor" href="#docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work">#</a> 【Docker】关于 docker 服务报错 WARNING IPv4 forwarding is disabled. Networking will not work</h3>
<p><strong>注意：在这里强调，强制进入或者进入镜像，进入后会引起 yum install 和 wget 等不能使用</strong></p>
<h2 id="一docker-运行直接报错"><a class="markdownIt-Anchor" href="#一docker-运行直接报错">#</a> <strong>一，docker 运行直接报错</strong></h2>
<p><strong>报错：</strong></p>
<p>[root@localhost /]# docker run -it ubuntu /bin/bash</p>
<p><em>WARNING: IPv4 forwarding is disabled. Networking will not work.</em></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/05472c924858164c6df96734a709fd3b.png" alt="img"></p>
<p>1. 解决方式：</p>
<p>第一步：在宿主机上执行 echo “net.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ipv4&amp;spm=1001.2101.3001.7020">ipv4</a>.ip_forward=1” &gt;&gt;/usr/lib/sysctl.d/00-system.conf</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/56fe262e97ffdd8fb3992692af566dd2.png" alt="img"></p>
<p>2. 第二步：重启 network 和 docker 服务</p>
<p>[root@localhost /]# systemctl restart network &amp;&amp; systemctl restart docker</p>
<p>3. 第三步：验证是否成功</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/fe9d3a924773707b13542350b4f77b2e.png" alt="img"></p>
<p>可见完美解决问题。</p>
<h2 id="二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了"><a class="markdownIt-Anchor" href="#二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了">#</a> 二，如果你是 docker 容器运行镜像的时候也是报这种错误，相对应得也是重启一下 docker 就可以完美解决了了。</h2>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.096Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.475Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">11 分钟读完 (大约1615个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/">【Docker】Linux部署Docker</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dockerlinux部署docker"><a class="markdownIt-Anchor" href="#dockerlinux部署docker">#</a> 【Docker】Linux 部署 Docker</h1>
<p>接触一段时间 docker，这个工具大大提高了开发者打包应用的效率。</p>
<p>一直都是直接把镜像扔到到 docker 里构建容器启动，并没有深入了解。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3eca951ddd044e9d9e1e6f2fcd5c680b.png" alt="在这里插入图片描述"><br>
本文由<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808?type=blog"> alpha0808</a> 大佬指导，如果要了解 docker 的概念以及命令，请去看大佬这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808/article/details/125699252?spm=1001.2014.3001.5502"> DOCKER 之入门篇</a></p>
<p>本篇文章集中于 linux 系统下对 docker 及相关组件的部署。</p>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#docker_9">一、安装 docker</a></li>
<li><a href="#_47">二、镜像加速</a></li>
<li>
<ul>
<li><a href="#_50">获取阿里云镜像地址</a></li>
<li><a href="#_56">添加加速器地址</a></li>
</ul>
</li>
<li><a href="#Portainer_75">三、可视化管理工具 Portainer</a></li>
<li>
<ul>
<li><a href="#_76">简介</a></li>
<li><a href="#_79">展示</a></li>
<li><a href="#_90">安装</a></li>
<li>
<ul>
<li><a href="#_92">镜像下载</a></li>
<li><a href="#_105">容器运行</a></li>
<li><a href="#_113">创建用户</a></li>
<li><a href="#docker_116">docker 连接管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_134">四、补充</a></li>
<li>
<ul>
<li><a href="#docker_135">docker 开机自启</a></li>
<li><a href="#_139">容器开机自启</a></li>
</ul>
</li>
</ul>
<h1 id="一-安装docker"><a class="markdownIt-Anchor" href="#一-安装docker">#</a> 一、安装 docker</h1>
<p>按照官网 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF">https://docs.docker.com/engine/install/centos/ 执行命令即可</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>yum检查更新</span><br><span class="line">sudo yum check-update</span><br><span class="line">#<span class="number">2.</span>删除旧版本</span><br><span class="line">sudo yum remove docker docker-client docker-client-latest  docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br><span class="line">#<span class="number">3.</span>安装gcc环境</span><br><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line">#<span class="number">4.</span>安装依赖项</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">#<span class="number">5.</span>将 Docker 存储库添加到 CentOS</span><br><span class="line">sudo yum-config-manager --add-repo https:<span class="comment">//download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line">#使用阿里服务器下载</span><br><span class="line">yum-config-manager --add-repo http:<span class="comment">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">#如果没有执行命令<span class="number">1</span>更新，那么此时执行命令即可</span><br><span class="line">yum makecache fast</span><br><span class="line">#<span class="number">6.</span>下载docker</span><br><span class="line">sudo yum install -y docker #注意这样下载需要接受GPG秘钥，相当于一个数字指纹，指纹格式：<span class="number">060</span>A <span class="number">61</span>C5 <span class="number">1B</span>55 <span class="number">8</span>A7F <span class="number">742B</span> <span class="number">77</span>AA C52F EB6B <span class="number">621</span>E <span class="number">9F</span>35</span><br><span class="line">#或者社区版本</span><br><span class="line">yum -y install docker-ce</span><br><span class="line">#<span class="number">7.</span>检查版本</span><br><span class="line">docker version</span><br><span class="line">#或者</span><br><span class="line">docker -v</span><br><span class="line">#<span class="number">8.</span>查看docker进程</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>执行第 8 步，如果报错<br>
 “<strong>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemo</strong>”<br>
 是因为 docker 还没启动</p>
<p>解决方案：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure>
<h1 id="二-镜像加速"><a class="markdownIt-Anchor" href="#二-镜像加速">#</a> 二、镜像加速</h1>
<p>使用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F&amp;spm=1001.2101.3001.7020">阿里云镜像</a>地址来加速镜像下载的速度</p>
<h2 id="获取阿里云镜像地址"><a class="markdownIt-Anchor" href="#获取阿里云镜像地址">#</a> 获取阿里云镜像地址</h2>
<p>点击<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">容器镜像服务</a><br>
<strong>镜像工具</strong>→<strong>镜像加速器</strong>，生成<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8A%A0%E9%80%9F%E5%99%A8&amp;spm=1001.2101.3001.7020">加速器</a>地址</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/644a2eab2b884c86874988c992891308.png" alt="在这里插入图片描述"></p>
<h2 id="添加加速器地址"><a class="markdownIt-Anchor" href="#添加加速器地址">#</a> 添加加速器地址</h2>
<p>切换目录至 /etc/docker</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/docker</span><br></pre></td></tr></table></figure>
<p>编辑 daemon.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;加速器地址&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%87%8D%E5%90%AFdocker&amp;spm=1001.2101.3001.7020">重启 docker</a> 的伴随线程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>
<p>重启 docker 服务</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1 id="三-可视化管理工具portainer"><a class="markdownIt-Anchor" href="#三-可视化管理工具portainer">#</a> 三、可视化管理工具 Portainer</h1>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Portainer 是 Docker 的<strong>图形化</strong>管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm 集群和服务等集中管理和操作、登录用户管理和控制等功能</p>
<h2 id="展示"><a class="markdownIt-Anchor" href="#展示">#</a> 展示</h2>
<ul>
<li>首页<br>
包含 docker-compose、容器、镜像、卷、网络总体概况<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/a02aadfe750448a2b68d3af149c24a3a.png" alt="在这里插入图片描述"></li>
<li>容器<br>
包含容器的启动、暂停、杀死进程、重启、新增，监控，日志查看，容器控制台等功能。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/906ebda299ae49dab32718dbd0519d2f.png" alt="在这里插入图片描述"></li>
<li>镜像<br>
包含镜像详细查看、删除、导入、导出等功能<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/14cc4c0cbaea403f895b07bbc006474a.png" alt="在这里插入图片描述"></li>
</ul>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装">#</a> 安装</h2>
<p>采用 docker 安装</p>
<h3 id="镜像下载"><a class="markdownIt-Anchor" href="#镜像下载">#</a> 镜像下载</h3>
<p>查询 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/52a91f8890aa4618999620689636e6ce.png" alt="在这里插入图片描述"></p>
<p>下载 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull portainer/portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/15a7b2b883bd41c78d66d8f391e791eb.png" alt="在这里插入图片描述"></p>
<h3 id="容器运行"><a class="markdownIt-Anchor" href="#容器运行">#</a> 容器运行</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>开放 9000 端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9000/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h3 id="创建用户"><a class="markdownIt-Anchor" href="#创建用户">#</a> 创建用户</h3>
<p>访问 9000 端口，第一次登录设置管理员账号和密码<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/90ff15efcc5e44f38105bf45c4a10faa.png" alt="在这里插入图片描述"></p>
<h3 id="docker连接管理"><a class="markdownIt-Anchor" href="#docker连接管理">#</a> docker 连接管理</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e0730e684e3c407fba300d41ad5dff7e.png" alt="在这里插入图片描述"><br>
可以选择管理本地 Local 和远程 Remote 的 Docker 两个选项，我们安装在本机，直接选择 Local，然后 Connect 进入管理界面<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/50e22542b48144a7bebcc9c2cc194dfc.png" alt="在这里插入图片描述"><br>
点击 connect，报错</p>
<blockquote>
<p>Failure dial unix /var/run/docker.sock: connect: permission denied</p>
</blockquote>
<p>可以猜测是 SElinux 的问题，看 SELinux 状态：sestatus 命令进行查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/sestatus -v      ##如果SELinux status参数为enabled即为开启状态</span><br><span class="line">SELinux status:                 enabled</span><br></pre></td></tr></table></figure>
<p>修改 /etc/selinux/config 文件，保存后重启机器</p>
<blockquote>
<p>将<strong> SELINUX=enforcing</strong> 改为<strong> SELINUX=disabled</strong></p>
</blockquote>
<p>再次访问 9000，连接 local，成功<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e2756cc7d9154993992f2c3a00d5ca58.png" alt="在这里插入图片描述"></p>
<h1 id="四-补充"><a class="markdownIt-Anchor" href="#四-补充">#</a> 四、补充</h1>
<h2 id="docker开机自启"><a class="markdownIt-Anchor" href="#docker开机自启">#</a> docker 开机自启</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>
<h2 id="容器开机自启"><a class="markdownIt-Anchor" href="#容器开机自启">#</a> 容器开机自启</h2>
<p>以上面的 docker 可视化管理工具 portainer 为例，希望开机的时候，自动启动镜像</p>
<p>启动命令加–restart=always</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer --restart=always  -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>如果已经在运行的镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always portainer</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.093Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.447Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">9 分钟读完 (大约1416个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91docker%E4%B8%AD%E8%AE%BE%E7%BD%AEelasticsearch%E3%80%81kibana%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E3%80%81%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/">docker中设置elasticsearch、kibana用户名密码、修改密码</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker中设置elasticsearch-kibana用户名密码-修改密码"><a class="markdownIt-Anchor" href="#docker中设置elasticsearch-kibana用户名密码-修改密码">#</a> docker 中设置 elasticsearch、kibana 用户名密码、修改密码</h1>
<h3 id=""><a class="markdownIt-Anchor" href="#">#</a> </h3>
<ul>
<li><a href="#_1">前言</a></li>
<li><a href="#elasticsearch_3">一、elasticsearch 设置密码</a></li>
<li>
<ul>
<li><a href="#_XPack_8">首先开启 X-Pack</a></li>
<li><a href="#_62">测试是否设置成功</a></li>
<li><a href="#_77">修改密码</a></li>
<li>
<ul>
<li><a href="#_78">已知密码修改</a></li>
<li><a href="#_107">忘记密码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kibanaelasticsearch_131">二、kibana 配置 elasticsearch 密码</a></li>
</ul>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p>之前在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020"> docker</a> 中安装过 elasticsearch 和 elasticsearchhead 以及 kibana 都没有配置密码，在此记录下设置过程。</p>
<h1 id="一-elasticsearch设置密码"><a class="markdownIt-Anchor" href="#一-elasticsearch设置密码">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=elasticsearch&amp;spm=1001.2101.3001.7020">elasticsearch</a> 设置密码</h1>
<p>参考 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-settings.html#token-service-settings">官方文档</a><br>
 xpack.security.enabled: true<br>
<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-api-change-password.html"> 设置引导性密码</a></p>
<blockquote>
<p>The setup-passwords tool is the simplest method to set the built-in users’ passwords for the first time. It uses the elastic user’s bootstrap password to run user management API requests. For example, you can run the command in an “interactive” mode, which prompts you to enter new passwords for the elastic, kibana, and logstash_system users:</p>
</blockquote>
<h2 id="首先开启-x-pack"><a class="markdownIt-Anchor" href="#首先开启-x-pack">#</a> 首先开启 X-Pack</h2>
<p>修改容器内或者修改挂载出来的 elasticsearch.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/elasticsearch/config/elasticsearch.yml		<span class="comment"># 挂载目录</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>elasticsearch.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;docker-cluster-01&quot;</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment"># 此处开启xpack</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<p>进入 docker 中的 elasticsearch 中，设置密码，执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/elasticsearch/bin/x-pack/setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>依次设置用户：elastic、apm_system、kibana_system、logstash_system、beats_system、remote_monitoring_user 共 6 个用户。<br>
内部用户<br>
 X-Pack 安全有三个内部用户（_system、_xpack 和_xpack_security），负责在 Elasticsearch 集群中进行的操作。</p>
<p>这些用户仅由源自集群内的请求使用。出于这个原因，它们不能用于对 API 进行身份验证，并且没有密码可以管理或重置。</p>
<p>有时，您可能会在日志中找到对这些用户之一的引用，包括审计日志。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved <span class="built_in">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line">Enter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Enter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Changed password <span class="keyword">for</span> user [apm_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana]</span><br><span class="line">Changed password <span class="keyword">for</span> user [logstash_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [beats_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [remote_monitoring_user]</span><br><span class="line">Changed password <span class="keyword">for</span> user [elastic]</span><br><span class="line">12345678910111213141516171819202122</span><br></pre></td></tr></table></figure>
<h2 id="测试是否设置成功"><a class="markdownIt-Anchor" href="#测试是否设置成功">#</a> 测试是否设置成功</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200</span><br></pre></td></tr></table></figure>
<p>结果显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-15-centos config]<span class="comment"># curl localhost:9200</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missi</span></span><br></pre></td></tr></table></figure>
<p>显示这个则设置成功。<br>
使用密码访问 elasticsearch 测试是否可以访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<p>就可以看到 elasticsearch 信息。</p>
<h2 id="修改密码"><a class="markdownIt-Anchor" href="#修改密码">#</a> 修改密码</h2>
<h3 id="已知密码修改"><a class="markdownIt-Anchor" href="#已知密码修改">#</a> 已知密码修改</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST _xpack/security/user/_password</span><br><span class="line">POST _xpack/security/user/&lt;username&gt;/_password</span><br><span class="line"><span class="comment"># 将用户elastic  密码改为elastic</span></span><br><span class="line">curl -u elastic -H <span class="string">&quot;Content-Type: application/json&quot;</span> -X POST <span class="string">&quot;localhost:9200/_xpack/security/user/elastic/_password&quot;</span> --data <span class="string">&#x27;&#123;&quot;password&quot;:&quot;elastic&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 测试是否修改成功</span></span><br><span class="line">curl localhost:9200 -u elastic</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>
<p>登录成功的结果展示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;384cda4775e5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster-01&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;SOH21TLnQdSZnJq0ZW2iDw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;6bc13727ce758c0e943c3c21653b3da82f627f75&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-09-15T10:18:09.722761972Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="忘记密码"><a class="markdownIt-Anchor" href="#忘记密码">#</a> 忘记密码</h3>
<p>创建本地超级账户，然后使用 api 接口本地超级账户重置 elastic 账户的密码</p>
<ol>
<li>停止 elasticsearch 服务</li>
<li>确保你的配置文件中支持本地账户认证支持，如果你使用的是 xpack 的默认配置则无需做特殊修改；如果你配置了其他认证方式则需要确保配置本地认证方式在 ES_HOME/config/elasticsearch.yml 中。</li>
<li>使用命令 ES_HOME/bin/x-pack/users 创建一个基于本地问价认证的超级管理员。</li>
<li>进入 docker 容器中 elasticsearch 中，执行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash</span><br><span class="line">bin/x-pack/users useradd test_admin -p test_password -r superuser</span><br></pre></td></tr></table></figure>
<ol>
<li>启动 elasticsearch 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<ol>
<li>通过 api 重置 elastic 超级管理员的密码</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u test_admin -XPUT  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> <span class="string">&#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27;</span> -d <span class="string">&#x27;&#123;&quot;password&quot; : &quot;新密码&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>校验下密码是否重置成功</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<h1 id="二-kibana配置elasticsearch密码"><a class="markdownIt-Anchor" href="#二-kibana配置elasticsearch密码">#</a> 二、kibana 配置 elasticsearch 密码</h1>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.16/settings.html">文档</a><br>
修改容器内或者修改挂载出来的 kibana.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it kibana /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/kibana/config/kibana.yml		<span class="comment"># 挂载目录</span></span><br></pre></td></tr></table></figure>
<p>kibana.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">server.shutdownTimeout:</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://172.17.0.3:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="comment"># 此处设置elastic的用户名和密码</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">elastic</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart kibana</span><br></pre></td></tr></table></figure>
<p>访问网址：<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f9ba8bb8f117485b8b8246d9d62599f8.png" alt="在这里插入图片描述"><br>
搞定！</p>
<blockquote>
<p>新手最近开始写文章，手敲不易，请多多支持！在此感谢每位读者 0.0</p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.089Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.470Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">19 分钟读完 (大约2840个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E7%94%A8%E6%B3%95%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/">Docker的基础用法</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="1-docker架构"><a class="markdownIt-Anchor" href="#1-docker架构">#</a> 1 Docker 架构</h1>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/60e8fc2bc92e48d0b96c0eaf079483c6.png" alt="在这里插入图片描述"></p>
<p>镜像 (Image)：Docker 镜像 (Image)，就相当于是 一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包 含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。<br>
容器 (Container)：镜像 (Image) 和容器 (Contain er) 的关系，就像是面向对象程序设计中的类和对象一 样，镜像是静态的定义，容器是镜像运行时的实体。容 器可以被创建、启动、停止、删除、暂停等。<br>
仓库 (Repository)：仓库可看成一个代码控制中心， 用来保存镜像</p>
<h1 id="2-docker镜像与镜像仓库"><a class="markdownIt-Anchor" href="#2-docker镜像与镜像仓库">#</a> 2 Docker 镜像与镜像仓库</h1>
<p>在 docker 中仓库的名字是以应用的名称取名的。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183520743.jpg" alt="在这里插入图片描述"></p>
<p>镜像是静态的，而容器是动态的，容器有其生命周期，镜像与容器的关系类似于程序与进程的关系。镜像类似于文件系统中的程序文件，而容器则类似于将一个程序运行起来的状态，也即进程。所以容器是可以删除的，容器被删除后其镜像是不会被删除的。</p>
<h1 id="3-docker对象"><a class="markdownIt-Anchor" href="#3-docker对象">#</a> 3 Docker 对象</h1>
<p>When you use docker, you are creating and using images, containers, networks, volumes, pluginns, and other objects.(当你使用 docker 时，你正在创建和使用镜像、容器、网络、卷、插件和其他对象)</p>
<p>IMAGES (镜像)</p>
<p>An image is a read-only template with instructions for creating a docker container.(镜像是一个只读模板，它带有创建 docker 容器的指令。)<br>
 Often, an image is based on another image, with some additional customization.(通常，一个镜像基于另一个镜像，并带有一些额外的自定义。)<br>
 You might create your own images or you might only use those created by others and published in a registry.(您可以创建自己的镜像，也可以使用其他人创建并在仓库中发布的镜像。)<br>
 CONTAINERS (容器)</p>
<p>A conntainer is a runnable instance of an image.(容器是镜像的可运行实例。)<br>
 You can create, run, stop, move, or delete a container using the docker API or CLI.(您可以通过 docker API 或 CLI 创建、运行、停止、移动或删除容器。)<br>
 You can connect a container to one or more networks, attach storage to it, or even create a new image based on its current state.(您可以将容器连接到一个或多个网络，为其附加存储，甚至可以根据其当前状态创建新镜像。)</p>
<h1 id="4-docker安装及使用"><a class="markdownIt-Anchor" href="#4-docker安装及使用">#</a> 4 Docker 安装及使用</h1>
<p>4.1 Docker 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">[root@Docker ~]# sed -i &#x27;s@https://download.docker.com@https://mirrors.tuna.tsinghua.edu.cn/docker-ce@g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">[root@Docker ~]# yum clean all</span><br><span class="line">21 文件已删除</span><br><span class="line">[root@Docker ~]# yum -y install docker-ce</span><br></pre></td></tr></table></figure>
<h1 id="42-docker加速"><a class="markdownIt-Anchor" href="#42-docker加速">#</a> 4.2 Docker 加速</h1>
<p>为什么需要加速器？因为 docker 在拉取镜像时，是去国外拉取的所以会比较慢，使用加速器可以解决这个问题</p>
<p>docker-ce 的配置文件是 /etc/docker/daemon.json，此文件默认不存在，需要我们手动创建并进行配置，而 docker 的加速就是通过配置此文件来实现的</p>
<h4 id="docker的加速有多种方式"><a class="markdownIt-Anchor" href="#docker的加速有多种方式">#</a> docker 的加速有多种方式</h4>
<ul>
<li>docker cn</li>
<li>中国科技大学加速器</li>
<li>阿里云加速器（需要通过阿里云开发者平台注册帐号，免费使用个人私有的加速器）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# systemctl enable --now docker    //启动docker服务</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@Docker ~]# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">     &quot;registry-mirrors&quot;: [&quot;https://xj3hc284.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">[root@Docker ~]# systemctl daemon-reload</span><br><span class="line">[root@Docker ~]# systemctl restart docker    //重启docker服务</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="43-docker常用操作"><a class="markdownIt-Anchor" href="#43-docker常用操作">#</a> 4.3 Docker 常用操作</h2>
<h3 id="431-docker-version查看版本号"><a class="markdownIt-Anchor" href="#431-docker-version查看版本号">#</a> 4.3.1 docker version (查看版本号)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker version</span><br><span class="line">Client: Docker Engine - Community    //docker客户端版本</span><br><span class="line"> Version:           20.10.11</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.16.9</span><br><span class="line"> Git commit:        dea9396</span><br><span class="line"> Built:             Thu Nov 18 00:36:58 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community    //docker服务端版本</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.11</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.16.9</span><br><span class="line">  Git commit:       847da18</span><br><span class="line">  Built:            Thu Nov 18 00:35:20 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:    //容器版本</span><br><span class="line">  Version:          1.4.12</span><br><span class="line">  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.2</span><br><span class="line">  GitCommit:        v1.0.2-0-g52b36a2</span><br><span class="line"> docker-init:    //docker初始化版本</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>
<h3 id="432-docker-info显示整个系统的信息"><a class="markdownIt-Anchor" href="#432-docker-info显示整个系统的信息">#</a> 4.3.2 docker info (显示整个系统的信息)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker info</span><br><span class="line">Client:        #docker客户端版本信息</span><br><span class="line"> Context:    default        #上下文</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Plugins:        #插件</span><br><span class="line">  app: Docker App (Docker Inc., v0.9.1-beta3)</span><br><span class="line">  buildx: Build with BuildKit (Docker Inc., v0.6.3-docker)</span><br><span class="line">  scan: Docker Scan (Docker Inc., v0.9.0)</span><br><span class="line"></span><br><span class="line">Server:        #docker服务端版本信息</span><br><span class="line"> Containers: 0        #容器个数</span><br><span class="line">  Running: 0        #运行个数</span><br><span class="line">  Paused: 0        #暂停状态个数</span><br><span class="line">  Stopped: 0        #停止状态个数</span><br><span class="line"> Images: 0        #镜像个数</span><br><span class="line"> Server Version: 20.10.11        #服务版本号</span><br><span class="line"> Storage Driver: overlay2        #存储驱动</span><br><span class="line">  Backing Filesystem: xfs        #后端文件系统</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line">  userxattr: false</span><br><span class="line"> Logging Driver: json-file        # 日志驱动</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Cgroup Version: 1</span><br><span class="line"> Plugins:        # 插件</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class="line"> runc version: v1.0.2-0-g52b36a2</span><br><span class="line"> init version: de40ad0</span><br><span class="line"> Security Options:        # 安全选项</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.18.0-257.el8.x86_64        # 内核版本号</span><br><span class="line"> Operating System: CentOS Stream 8        # 操作系统</span><br><span class="line"> OSType: linux        #操作系统 类型</span><br><span class="line"> Architecture: x86_64        #架构</span><br><span class="line"> CPUs: 4        # CPU核心数</span><br><span class="line"> Total Memory: 7.559GiB        #总内存 </span><br><span class="line"> Name: Docker</span><br><span class="line"> ID: 4MEZ:OEWB:CPHP:3PYE:54J3:46XO:B5CX:JHYB:OW5Q:TWJP:PWHO:JJSM           </span><br><span class="line"> Docker Root Dir: /var/lib/docker        #docker默认目录</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/        # 仓库地址</span><br><span class="line"> Labels:        #标签</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:        #加速器</span><br><span class="line">  https://xj3hc284.mirror.aliyuncs.com/</span><br><span class="line"> Live Restore Enabled: false</span><br></pre></td></tr></table></figure>
<h3 id="433-docker-search在docker-hub中搜索镜像"><a class="markdownIt-Anchor" href="#433-docker-search在docker-hub中搜索镜像">#</a> 4.3.3 docker search (在 docker hub 中搜索镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker search nginx</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        15893     [OK]       </span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy for docker con…   2098                 [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   819                  [OK]</span><br><span class="line">jc21/nginx-proxy-manager          Docker container for managing Nginx proxy ho…   285                  </span><br><span class="line">linuxserver/nginx                 An Nginx container, brought to you by LinuxS…   160                  </span><br><span class="line">tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp…   146                  [OK]</span><br><span class="line">jlesage/nginx-proxy-manager       Docker container for Nginx Proxy Manager        144                  [OK]</span><br><span class="line">alfg/nginx-rtmp                   NGINX, nginx-rtmp-module and FFmpeg from sou…   110                  [OK]</span><br><span class="line">nginxdemos/hello                  NGINX webserver that serves a simple page co…   79                   [OK]</span><br><span class="line">privatebin/nginx-fpm-alpine       PrivateBin running on an Nginx, php-fpm &amp; Al…   60                   [OK]</span><br><span class="line">nginx/nginx-ingress               NGINX and  NGINX Plus Ingress Controllers fo…   57                   </span><br><span class="line">nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles                  54                   </span><br><span class="line">nginxproxy/nginx-proxy            Automated Nginx reverse proxy for docker con…   28                   </span><br><span class="line">staticfloat/nginx-certbot         Opinionated setup for automatic TLS certs lo…   25                   [OK]</span><br><span class="line">nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter for NGINX and NGIN…   22                   </span><br><span class="line">schmunk42/nginx-redirect          A very simple container to redirect HTTP tra…   19                   [OK]</span><br><span class="line">centos/nginx-112-centos7          Platform for running nginx 1.12 or building …   16                   </span><br><span class="line">centos/nginx-18-centos7           Platform for running nginx 1.8 or building n…   13                   </span><br><span class="line">flashspys/nginx-static            Super Lightweight Nginx Image                   11                   [OK]</span><br><span class="line">bitwarden/nginx                   The Bitwarden nginx web server acting as a r…   11                   </span><br><span class="line">mailu/nginx                       Mailu nginx frontend                            9                    [OK]</span><br><span class="line">sophos/nginx-vts-exporter         Simple server that scrapes Nginx vts stats a…   7                    [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb   An APB to deploy NGINX                          3                    [OK]</span><br><span class="line">arnau/nginx-gate                  Docker image with Nginx with Lua enabled on …   1                    [OK]</span><br><span class="line">wodby/nginx                       Generic nginx                                   1                    [OK]</span><br></pre></td></tr></table></figure>
<h3 id="434-docker-pull拉取镜像"><a class="markdownIt-Anchor" href="#434-docker-pull拉取镜像">#</a> 4.3.4 docker pull (拉取镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">eff15d958d66: Pull complete </span><br><span class="line">1e5351450a59: Pull complete </span><br><span class="line">2df63e6ce2be: Pull complete </span><br><span class="line">9171c7ae368c: Pull complete </span><br><span class="line">020f975acd28: Pull complete </span><br><span class="line">266f639b35ad: Pull complete </span><br><span class="line">Digest: sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>
<h3 id="435-docker-images列出系统当前镜像"><a class="markdownIt-Anchor" href="#435-docker-images列出系统当前镜像">#</a> 4.3.5 docker images (列出系统当前镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>
<h3 id="436-docker-image-history查看指定镜像的历史"><a class="markdownIt-Anchor" href="#436-docker-image-history查看指定镜像的历史">#</a> 4.3.6 docker image history (查看指定镜像的历史)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker image history nginx</span><br><span class="line">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class="line">ea335eea17ab   13 days ago   /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  STOPSIGNAL SIGQUIT           0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;/docker-entr…   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:09a214a3e07c919a…   4.61kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0b866ff3fc1ef5b0…   1.96kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:65504f71f5855ca0…   1.2kB     </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c set -x     &amp;&amp; addgroup --system -…   61.1MB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV PKG_RELEASE=1~bullseye   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NJS_VERSION=0.7.0        0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NGINX_VERSION=1.21.4     0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop) ADD file:a2405ebb9892d98be…   80.4MB    </span><br></pre></td></tr></table></figure>
<h3 id="437-docker-image-inspect查看指定镜像的详细信息"><a class="markdownIt-Anchor" href="#437-docker-image-inspect查看指定镜像的详细信息">#</a> 4.3.7 docker image inspect (查看指定镜像的详细信息)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker image inspect nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:ea335eea17ab984571cd4a3bcf90a0413773b559c75ef4cda07d0ce952b00291&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;nginx:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;nginx@sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-11-17T10:38:14.652464384Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;8a038ff17987cf87d4b7d7e2c80cb83bd2474d66e2dd0719e2b4f7de2ad6d853&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;8a038ff17987&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="438-删除镜像"><a class="markdownIt-Anchor" href="#438-删除镜像">#</a> 4.3.8 删除镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   57 minutes ago   Exited (0) 6 minutes ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">httpd        latest    ad17c88403e2   12 days ago   143MB</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rmi ad17c88403e2</span><br><span class="line">Untagged: httpd:latest</span><br><span class="line">Untagged: httpd@sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class="line">Deleted: sha256:ad17c88403e2cedd27963b98be7f04bd3f903dfa7490586de397d0404424936d</span><br><span class="line">Deleted: sha256:a59e7dfeeb485a8a45b1fcce812b10fbd955d304fa2e9ca43b10b16a8ee1afb8</span><br><span class="line">Deleted: sha256:9592080464aa1890ed187c42a13ecc9f175e975a96a3fad28df0559ad0c08b9d</span><br><span class="line">Deleted: sha256:42d2debfa0c419f7f89affa3e9b62d1b7e54dc6654dbd186d4654ee3661c44c8</span><br><span class="line">Deleted: sha256:136822c50a75392f4ce06461fa4894aa7d1e060ec0dd4782e13e2d9829df50a3</span><br><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>
<h3 id="439-docker-create创建容器"><a class="markdownIt-Anchor" href="#439-docker-create创建容器">#</a> 4.3.9 docker create (创建容器)</h3>
<p>此命令只会创建容器，而不会运行容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker create nginx</span><br><span class="line">8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74</span><br></pre></td></tr></table></figure>
<h3 id="4310-docker-ps列出容器"><a class="markdownIt-Anchor" href="#4310-docker-ps列出容器">#</a> 4.3.10 docker ps (列出容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps         //查看正在运行的容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a        //查看所有容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   3 minutes ago   Created             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4311-docker-start启动容器"><a class="markdownIt-Anchor" href="#4311-docker-start启动容器">#</a> 4.3.11 docker start (启动容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker start 8442117bc0c7        #启动容器，后面接容器的ID号，ID号可以简写</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   8 minutes ago   Up 14 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4312-docker-attach进入容器"><a class="markdownIt-Anchor" href="#4312-docker-attach进入容器">#</a> 4.3.12 docker attach (进入容器)</h3>
<p>在当前 shell 下 attach 连接指定运行镜像，以这种方式进入容器，此时容器会一直占用前台，如果退出容器，容器就会停止</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   50 minutes ago   Up 30 seconds   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker attach 8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure>
<h3 id="4313-docker-exec进入容器"><a class="markdownIt-Anchor" href="#4313-docker-exec进入容器">#</a> 4.3.13 docker exec (进入容器)</h3>
<p>用这个命令进入容器后台运行就算是退出了容器，容器也不会停止运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   26 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker exec -it 8442117bc0c7 /bin/bash</span><br><span class="line">root@8442117bc0c7:/# ls</span><br><span class="line">bin  boot  dev	docker-entrypoint.d  docker-entrypoint.sh  etc	home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@8442117bc0c7:/# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   27 minutes ago   Up 23 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4314-docker-inspect查看容器的信息详细"><a class="markdownIt-Anchor" href="#4314-docker-inspect查看容器的信息详细">#</a> 4.3.14 docker inspect (查看容器的信息详细)</h3>
<p>通过查看详细信息可以查看其容器的 IP 地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker inspect 8442117bc0c7</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-12-01T07:28:48.929261547Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 5390,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-12-01T07:36:41.636489391Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="4315-docker-logs查看容器日志"><a class="markdownIt-Anchor" href="#4315-docker-logs查看容器日志">#</a> 4.3.15 docker logs (查看容器日志)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker logs 8442117bc0c7</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: nginx/1.21.4</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) </span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: OS: Linux 4.18.0-257.el8.x86_64</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker processes</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 31</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 32</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 33</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 34</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:23 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:44 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:45 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>
<h3 id="4316-docker-stop停止容器"><a class="markdownIt-Anchor" href="#4316-docker-stop停止容器">#</a> 4.3.16 docker stop (停止容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Up 8 minutes   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker stop 8442117bc0c7</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Exited (0) 5 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4317-docker-restart重启容器"><a class="markdownIt-Anchor" href="#4317-docker-restart重启容器">#</a> 4.3.17 docker restart (重启容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Exited (0) 46 seconds ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker restart 8442117bc0c7</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4318-docker-kill杀死正在运行的容器"><a class="markdownIt-Anchor" href="#4318-docker-kill杀死正在运行的容器">#</a> 4.3.18 docker kill (杀死正在运行的容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Up 2 minutes   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker kill 8442117bc0c7 </span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Exited (137) 4 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4319-docker-run创建并启动容器"><a class="markdownIt-Anchor" href="#4319-docker-run创建并启动容器">#</a> 4.3.19 docker run (创建并启动容器)</h3>
<p>此命令会做三件事情，首先先查看本地是否都对应的镜像，如果没有就拉取，然后创建容器，然后运行容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   35 minutes ago   Exited (0) 5 minutes ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker run -it httpd /bin/bash        #此命令的作用是，拉取一个httpd的镜像，然后创建容器并运行，-it表示以交互的方式进入终端，/bin/bash表示终端的环境</span><br><span class="line">Unable to find image &#x27;httpd:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line">eff15d958d66: Already exists </span><br><span class="line">ba1caf8ba86c: Pull complete </span><br><span class="line">ab86dc02235d: Pull complete </span><br><span class="line">0d58b11d2867: Pull complete </span><br><span class="line">e88da7cb925c: Pull complete </span><br><span class="line">Digest: sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class="line">Status: Downloaded newer image for httpd:latest</span><br><span class="line">root@a01b8d80a160:/usr/local/apache2# ls</span><br><span class="line">bin  build  cgi-bin  conf  error  htdocs  icons  include  logs	modules</span><br></pre></td></tr></table></figure>
<h3 id="4320-docker-rm删除容器"><a class="markdownIt-Anchor" href="#4320-docker-rm删除容器">#</a> 4.3.20 docker rm (删除容器)</h3>
<p>删除一个或者多个容器，只能删除停止状态的容器或者 - f 强制删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS         PORTS     NAMES</span><br><span class="line">a01b8d80a160   httpd     &quot;/bin/bash&quot;   10 minutes ago   Up 3 seconds   80/tcp    hardcore_varahamihira</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rm a01b8d80a160</span><br><span class="line">Error response from daemon: You cannot remove a running container a01b8d80a1609e81d8d8121b3fc3c0f53a676340b3b093b353a7f9bb498fe0e6. Stop the container before attempting removal or force remove</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rm -f a01b8d80a160</span><br><span class="line">a01b8d80a160</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   48 minutes ago   Exited (0) 18 minutes ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h1 id="5-docker-event-state"><a class="markdownIt-Anchor" href="#5-docker-event-state">#</a> 5 Docker event state</h1>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183609729.jpg" alt="在这里插入图片描述"></p>
<p>本文来自 CSDN</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46727129/article/details/121665668">https://blog.csdn.net/weixin_46727129/article/details/121665668</a></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.085Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.442Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">5 分钟读完 (大约791个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E4%B8%8B%E5%AE%89%E8%A3%85Canal%E5%B9%B6%E6%95%B4%E5%90%88SpringBoot/">【Docker】Docker下安装Canal并整合SpringBoot</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="canal"><a class="markdownIt-Anchor" href="#canal">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Canal&amp;spm=1001.2101.3001.7020">Canal</a> 是一个同步增量数据的一个工具</h1>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#_2">概念</a></li>
<li><a href="#Mysqlbinlog_5">Mysql 开启 binlog</a></li>
<li>
<ul>
<li><a href="#binlog_9">是否开启 binlog</a></li>
<li><a href="#binlog_16">开启 binlog 日志</a></li>
<li><a href="#_30">创建授权用户</a></li>
</ul>
</li>
<li><a href="#Canal_41">部署 Canal</a></li>
<li>
<ul>
<li><a href="#_43">拉取镜像</a></li>
<li><a href="#properties_47">挂载 properties 配置文件</a></li>
<li><a href="#_68">创建容器</a></li>
</ul>
</li>
</ul>
<h1 id="概念"><a class="markdownIt-Anchor" href="#概念">#</a> 概念</h1>
<p>canal 是阿里巴巴旗下的一款<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020">开源项目</a>，纯 Java 开发。基于数据库增量日志解析，提供增量数据订阅 &amp; 消费，目前主要支持了 MySQL（也支持 mariaDB）</p>
<h1 id="mysql开启binlog"><a class="markdownIt-Anchor" href="#mysql开启binlog">#</a> Mysql 开启 binlog</h1>
<p>在部署 Canal 之前，需要先安装 Mysql。</p>
<blockquote>
<p>我用的是 5.7.27 的 mysql</p>
</blockquote>
<h2 id="是否开启binlog"><a class="markdownIt-Anchor" href="#是否开启binlog">#</a> 是否开启 binlog</h2>
<p>输入以下命令，查看是否开启 binlog<br>
 为<strong> OFF</strong> 则表示<strong>未开启</strong> binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/cd4194a978a544b59e40d7c342d8683d.png" alt="在这里插入图片描述"></p>
<h2 id="开启binlog日志"><a class="markdownIt-Anchor" href="#开启binlog日志">#</a> 开启 binlog 日志</h2>
<p>修改 mysql 的配置文件，在 [mysqld] 下添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># server_id不重复即可，不要和canal的slaveId重复</span><br><span class="line">server_id=1</span><br><span class="line"># 开启binlog</span><br><span class="line">log_bin = mysql-bin</span><br><span class="line"># 选择row模式</span><br><span class="line">binlog_format = ROW</span><br></pre></td></tr></table></figure>
<hr>
<p>修改完毕，重启 mysql<br>
 查看是否开启<br>
<img src="https://img-blog.csdnimg.cn/df9f1104c79c42b3bd3cc2461f593f40.png" alt="在这里插入图片描述"></p>
<h2 id="创建授权用户"><a class="markdownIt-Anchor" href="#创建授权用户">#</a> 创建授权用户</h2>
<p>创建授权用户 canal 用于 cannal 服务监听 mysql 的 binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 新建用户 用户名：canal  密码：canal </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> canal IDENTIFIED <span class="keyword">by</span> <span class="string">&#x27;canal&#x27;</span>;</span><br><span class="line"># 授权</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"># 刷新MySQL的系统权限相关表</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h1 id="部署canal"><a class="markdownIt-Anchor" href="#部署canal">#</a> 部署 Canal</h1>
<p>如果没有部署过 docker，看我之前写的<a target="_blank" rel="noopener" href="https://brath.top/2023/03/16/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/"> Linux 部署 Docker</a></p>
<h2 id="拉取镜像"><a class="markdownIt-Anchor" href="#拉取镜像">#</a> 拉取镜像</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<h2 id="挂载properties配置文件"><a class="markdownIt-Anchor" href="#挂载properties配置文件">#</a> 挂载 properties 配置文件</h2>
<p>先进行第一次运行，拷贝 properties 配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>拷贝运行后的容器中配置文件，用来文件挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建canal宿主机挂载目录</span></span><br><span class="line">mkdir -p /opt/canal/conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看docker运行情况，复制容器<span class="built_in">id</span></span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝配置文件</span></span><br><span class="line">docker cp 容器id:/home/admin/canal-server/conf/example/instance.properties  /opt/canal/conf/</span><br></pre></td></tr></table></figure>
<p>移除当前容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop canal</span><br><span class="line">docker rm canal</span><br></pre></td></tr></table></figure>
<p>修改配置文件<br>
<img src="https://img-blog.csdnimg.cn/c51d4265e36e4e3d862f103eb0367a42.png" alt="在这里插入图片描述"></p>
<h2 id="创建容器"><a class="markdownIt-Anchor" href="#创建容器">#</a> 创建容器</h2>
<p>运行新的容器，同时挂载修改后的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -v /opt/canal/conf/instance.properties:/home/admin/canal-server/conf/example/instance.properties -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>开放端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=11111/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/10/">上一页</a></div><div class="pagination-next"><a href="/page/12/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/10/">10</a></li><li><a class="pagination-link is-current" href="/page/11/">11</a></li><li><a class="pagination-link" href="/page/12/">12</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.463Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E3%80%91%E8%85%BE%E8%AE%AF%E4%BA%91%E7%94%B3%E8%AF%B7%E7%9A%84%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91CDN%E5%92%8C%E4%BA%91%E7%9B%BE%E8%AF%81%E4%B9%A6%E4%B8%AD%E5%BF%83/">腾讯云申请的免费证书部署到阿里云CDN和云盾证书中心</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.459Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%A4%96%E8%AE%BE%E3%80%91%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98%E8%BD%B4%E4%BD%93%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F%E4%B8%89%E6%A8%A1%E7%83%AD%E6%8F%92%E6%8B%94%E5%8E%9F%E6%9D%A5%E6%98%AF%E8%BF%99%E4%B9%88%E5%9B%9E%E4%BA%8B/">【外设】机械键盘轴体怎么选？三模热插拔原来是这么回事</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.456Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91DDD%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/">【架构】DDD分层架构模型</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.452Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%91%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/">云服务器部署宝塔面板</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.448Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%91%E9%98%BF%E9%87%8C%E4%BA%91OSS%E7%9A%84CDN%E5%8A%A0%E9%80%9F%E5%92%8COSS%E4%BC%A0%E8%BE%93%E5%8A%A0%E9%80%9F%E7%9A%84%E5%8C%BA%E5%88%AB/">阿里云OSS的CDN加速和OSS传输加速的区别</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">118</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/7f71f67568cbf455bf7b2c32345f71e3.jpg" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">为了更好的你，也为了更好的世界。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">118</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>