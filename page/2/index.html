<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.746Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-09-30T19:58:45.000Z" title="2023/10/1 03:58:45">2023-10-01</time>更新</span><span class="level-item">3 分钟读完 (大约480个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Git%E3%80%91Github%E8%AE%BF%E9%97%AE%E5%8A%A0%E9%80%9F/">Github访问加速方法</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="1-获取延迟最小ip地址"><a class="markdownIt-Anchor" href="#1-获取延迟最小ip地址">#</a> 1. 获取延迟最小 IP 地址</h2>
<p>首先，打开</p>
<p><a target="_blank" rel="noopener" href="http://tool.chinaz.com/dns?type=1&amp;host=github.com&amp;ip=">http://tool.chinaz.com/dns?type=1&amp;host=github.com&amp;ip=</a></p>
<p>查询 Github 的地址，选择延迟最小的</p>
<p><img src="E:%5Cmd%E5%9B%BE%E7%89%87%5C1640222585966.png" alt="1640222585966"></p>
<h2 id="2-修改系统hosts文件"><a class="markdownIt-Anchor" href="#2-修改系统hosts文件">#</a> <strong>2. 修改系统 Hosts 文件</strong></h2>
<p>接着，打开系统 hosts 文件 (需管理员权限)。<br>
路径：C:\Windows\System32\drivers\etc</p>
<blockquote>
<p>mac 或者其他 linux 系统的话，是 /etc 下的 hosts 文件，需要切入到 root 用户修改</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) 1993-2009 Microsoft Corp. </span><br><span class="line"># </span><br><span class="line"># This is a sample HOSTS file used by Microsoft TCP/IP for Windows. </span><br><span class="line"># </span><br><span class="line"># This file contains the mappings of IP addresses to host names. Each </span><br><span class="line"># entry should be kept on an individual line. The IP address should </span><br><span class="line"># be placed in the first column followed by the corresponding host name. </span><br><span class="line"># The IP address and the host name should be separated by at least one </span><br><span class="line"># space. </span><br><span class="line"># </span><br><span class="line"># Additionally, comments (such as these) may be inserted on individual </span><br><span class="line"># lines or following the machine name denoted by a &#x27;#&#x27; symbol. </span><br><span class="line"># </span><br><span class="line"># For example: </span><br><span class="line"># </span><br><span class="line">#      102.54.94.97     rhino.acme.com          # source server </span><br><span class="line">#       38.25.63.10     x.acme.com              # x client host </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># localhost name resolution is handled within DNS itself. </span><br><span class="line">#   127.0.0.1       localhost </span><br><span class="line">#   ::1             localhost </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">52.192.72.89    github.com</span><br></pre></td></tr></table></figure>
<p>并在末尾添加记录并保存。(需管理员权限，注意 IP 地址与域名间需留有空格)</p>
<h2 id="3-刷新系统dns缓存"><a class="markdownIt-Anchor" href="#3-刷新系统dns缓存">#</a> <strong>3. 刷新系统 DNS 缓存</strong></h2>
<p>最后，Windows+X 打开系统命令行（管理员身份）或 powershell</p>
<p>运行 ipconfig /flushdns 手动刷新系统 DNS 缓存。</p>
<blockquote>
<p>mac 系统修改完 hosts 文件，保存并退出就可以了。不要要多一步刷新操作.<br>
centos 系统执行 /etc/init.d/network restart 命令 使得 hosts 生效</p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.744Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-09-10T12:08:47.000Z" title="2023/9/10 20:08:47">2023-09-10</time>更新</span><span class="level-item">4 分钟读完 (大约580个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E3%80%91%E8%85%BE%E8%AE%AF%E4%BA%91%E7%94%B3%E8%AF%B7%E7%9A%84%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91CDN%E5%92%8C%E4%BA%91%E7%9B%BE%E8%AF%81%E4%B9%A6%E4%B8%AD%E5%BF%83/">腾讯云申请的免费证书部署到阿里云CDN和云盾证书中心</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="腾讯云申请的免费证书部署到阿里云cdn和云盾证书中心"><a class="markdownIt-Anchor" href="#腾讯云申请的免费证书部署到阿里云cdn和云盾证书中心">#</a> 腾讯云申请的免费证书部署到阿里云 CDN 和云盾证书中心</h3>
<p>tips：以下内容仅支持有域名的小伙伴配置，没有域名请先申请域名</p>
<p>小伙伴们在有了自己的不知道如何部署 HTTPS？请看下面的操作</p>
<p>​	为什么不在阿里云申请 SSL 证书</p>
<p>​	答：阿里云免费证书很慢，而且付费的超级贵</p>
<p>所以本教程让大家在腾讯云官方申请 SSL 证书，注意：有效期只能为 1 年，过期不续费，只能重新申请和配置</p>
<p>1. 进入腾讯云证书官网： <a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/ssl">https://console.cloud.tencent.com/ssl</a></p>
<p>2. 点击申请免费证书</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101221781.png" alt="image-20230211101221781"></p>
<p>3. 输入绑定的域名、校验方式选择自动 DNS 验证、邮箱填写常用邮箱<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101232921.png" alt="image-20230211101232921"></p>
<p>点击提交申请，等待校验通过</p>
<p>4. 申请通过后会颁发证书</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101359187.png" alt="image-20230211101359187"></p>
<p>5. 点击右侧下载，选择 Nginx 证书压缩包</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101422722.png" alt="image-20230211101422722"></p>
<p>解压缩后可以看见如下文件</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101454344.png" alt="image-20230211101454344"></p>
<p>6. 进入阿里云 云盾证书管理 <a target="_blank" rel="noopener" href="https://yundunnext.console.aliyun.com/?spm=5176.11785003.domainDetail.14.4251142fPqrVnU&amp;p=cas#/certExtend/upload">https://yundunnext.console.aliyun.com/?spm=5176.11785003.domainDetail.14.4251142fPqrVnU&amp;p=cas#/certExtend/upload</a></p>
<p>点击上传证书</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101539890.png" alt="image-20230211101539890"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101638094.png" alt="image-20230211101638094"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101727709.png" alt="image-20230211101727709"></p>
<p>点击确定后上传成功。</p>
<p>接下来就可以在阿里云使用你在腾讯云申请的证书来支持你的 CDN HTTPS 服务拉！</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230211101919544.png" alt="image-20230211101919544"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.741Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-08-22T07:41:23.000Z" title="2023/8/22 15:41:23">2023-08-22</time>更新</span><span class="level-item">8 分钟读完 (大约1225个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Maven%E3%80%91Maven%E5%8A%A0%E5%BC%BA%E7%89%88%20%E2%80%94%20mvnd%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">Maven加强版 — mvnd的使用测试</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="maven加强版-mvnd的使用测试"><a class="markdownIt-Anchor" href="#maven加强版-mvnd的使用测试">#</a> Maven 加强版 — mvnd 的使用测试</h1>
<p>Maven、gradle 作为主流的构建工具，几乎所有的 Java 项目都使用，但是 Maven 相对 gradle 来说，构建还是太慢了。特别是构建十几个子项目的程序。</p>
<p>如果要把项目从 Maven 转换成 gradle，成本也是巨大的。</p>
<p>但是现在有了 maven-mvnd ，可以使构建变得更快。</p>
<h2 id="1-maven-mvnd介绍"><a class="markdownIt-Anchor" href="#1-maven-mvnd介绍">#</a> <strong>1、maven-mvnd 介绍</strong></h2>
<p><code>maven-mvnd</code>  是 <code>Apache Maven团队</code> 借鉴了 <code>Gradle</code>  和 <code>Takari</code>  的优点，衍生出来的更快的构建工具，是 maven 的 <code>强化版</code> 。</p>
<p>github 地址：<a href="https://link.zhihu.com/?target=https%3A//github.com/apache/maven-mvnd">https://github.com/apache/maven-mvnd</a></p>
<p>maven-mvnd 特性：</p>
<ul>
<li>嵌入 Maven (所以不需要单独安装 Maven)； <code>maven 过渡到 maven-mvnd</code>  的过程中实现  <code>无缝切换</code> ！所以不需要再安装 maven 或进行复杂的配置更改。</li>
<li>实际的构建发生在一个长期存在的后台进程中，也就是守护进程。如果没有为构建请求服务的空闲守护进程，则可以并行产生多个守护进程。</li>
<li>一个守护进程实例可以处理来自 mvnd 客户机的多个连续请求。</li>
<li>使用 GraalVM 构建的本地可执行文件。与传统的 JVM 相比，它启动更快，使用的内存更少。</li>
</ul>
<p>这种架构带来的优势有：</p>
<ul>
<li>运行实际构建的 JVM 不需要为每个构建重新启动，节省时间。</li>
<li>JVM 中的实时 (JIT) 编译器生成的本机代码也保留了下来。与 Maven 相比，JIT 编译花费的时间更少。在重复构建过程中，JIT 优化的代码可以立即使用。这不仅适用于来自 Maven 插件和 Maven Core 的代码，也适用于来自 JDK 本身的所有代码。</li>
</ul>
<h2 id="2-使用步骤"><a class="markdownIt-Anchor" href="#2-使用步骤">#</a> <strong>2、使用步骤</strong></h2>
<h3 id="21-下载"><a class="markdownIt-Anchor" href="#21-下载">#</a> <strong>2.1、下载</strong></h3>
<p>下载：<a href="https://link.zhihu.com/?target=https%3A//github.com/mvndaemon/mvnd/releases">https://github.com/mvndaemon/mvnd/releases</a></p>
<p><img src="https://brath.cloud/blogImg/v2-a58a6f79a75eeeb834275d74212cacb1_720w.jpg" alt="img"></p>
<p>我这里是 windows，下载  <code>mvnd-0.7.1-windows-amd64.zip</code>  版本即可。</p>
<h3 id="22-安装"><a class="markdownIt-Anchor" href="#22-安装">#</a> <strong>2.2、安装</strong></h3>
<p>直接解压。</p>
<p>然后配置环境变量：将 bin 目录添加到 PATH</p>
<h3 id="23-测试"><a class="markdownIt-Anchor" href="#23-测试">#</a> <strong>2.3、测试</strong></h3>
<p>打开 CMD 终端，输入  <code>mvnd -v</code></p>
<p>可以看到如下信息表示安装成功：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\HaC&gt; mvnd -v</span><br><span class="line">mvnd native client 0.7.1-windows-amd64 (97c587c11383a67b5bd0ff8388bd94c694b91c1e)</span><br><span class="line">Terminal: org.jline.terminal.impl.jansi.win.JansiWinSysTerminal</span><br><span class="line">Apache Maven 3.8.3 (ff8e977a158738155dc465c6a97ffaf31982d739)</span><br><span class="line">Maven home: E:\apache-mvnd-0.7.1-windows-amd64\mvn</span><br><span class="line">Java version: 1.8.0_131, vendor: Oracle Corporation, runtime: E:\JDK1.8\jre</span><br><span class="line">Default locale: zh_CN, platform encoding: GBK</span><br><span class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;</span><br></pre></td></tr></table></figure>
<p>可以看到 mvnd 集成了 Maven 3.8.3 版本。</p>
<h3 id="24-使用"><a class="markdownIt-Anchor" href="#24-使用">#</a> <strong>2.4、使用</strong></h3>
<p>在使用上和 Maven 一样，参数也一致。</p>
<p>Maven 使用  <code>mvn clean package</code>  ；使用 Maven-mvnd 只需要变成  <code>mvnd clean package</code>  即可，其他同理。</p>
<h3 id="25-配置修改"><a class="markdownIt-Anchor" href="#25-配置修改">#</a> <strong>2.5、配置修改</strong></h3>
<p>为了最小程度的兼容原来的 Maven，可以使用原来的  <code>setting.xml</code></p>
<p>打开 Maven-mvnd 安装目录下 的  <code>/conf/mvnd.properties</code>  文件，修改：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">maven.settings</span>=<span class="string">E://apache-maven-3.5.4-bin//apache-maven-3.5.4//conf//settings.xml</span></span><br></pre></td></tr></table></figure>
<p>（注意是  <code>//</code> ）</p>
<h2 id="3-打包对比"><a class="markdownIt-Anchor" href="#3-打包对比">#</a> <strong>3、打包对比</strong></h2>
<p>由于 mvnd-0.7.1 版本使用了 Maven 3.8.3 版本，我这里同样使用 Maven 3.8.3 进行对比。</p>
<p>命令：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># maven 打包命令</span><br><span class="line">mvn clean package -Dmaven.test.skip=true</span><br><span class="line"># mvnd 打包命令</span><br><span class="line">mvnd clean package -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>
<p>电脑配置：</p>
<p>CPU：Intel® Core™ i7-4790 CPU @ 3.60GHz 3.60 GHz</p>
<p>内存：16GB</p>
<p>结果如下：</p>
<ul>
<li>13 个子项目</li>
</ul>
<p><img src="https://brath.cloud/blogImg/v2-dd0b655c2c27661612a479ef242058c8_720w.jpg" alt="img">41 秒 vs 21 秒</p>
<p>可以看到 <strong>mvnd 打包的总时间比 mvn 快了不少</strong>，因为 mvnd 使用了 CPU 的多核心，可以看到每个子模块打包的时间都差不多，所以在单核的机器，就不要尝试使用 mvnd 了。</p>
<ul>
<li>19 个子项目</li>
</ul>
<p><img src="https://brath.cloud/blogImg/v2-0a301e678b6ebab5577d899b6230ffe5_720w.jpg" alt="img">32 秒 vs 10 秒</p>
<p>呈现子项目越多，相对速度更快的趋势。</p>
<p>总的来说：</p>
<p><strong>如果项目模块很多，可以尝试使用 mvnd 进行辅助打包，比如 测试、生产，可以节省很多时间；</strong></p>
<p><strong>开发则可以继续使用 mvn ，毕竟 IDEA 无法集成 mvnd，可以在 terminal 通过命令打包。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.739Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-08-20T21:44:23.000Z" title="2023/8/21 05:44:23">2023-08-21</time>更新</span><span class="level-item">11 分钟读完 (大约1657个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Elasticsearch%E3%80%91Elasticsearch7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6/">ELASTICSEARCH7.X安全性之访问密码设置</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="elasticsearch7x安全性之访问密码设置"><a class="markdownIt-Anchor" href="#elasticsearch7x安全性之访问密码设置">#</a> ELASTICSEARCH7.X 安全性之访问密码设置</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当我们安装完ElasticSearch的时候发现，访问过程中我们没有任何安全认证就可以直接访问并操作。如果是生产环境，端口向外暴露的话，那么对数据的安全性是无法得到保障的。</span><br></pre></td></tr></table></figure>
<p>一般解决方案有</p>
<ul>
<li>开启 ElasticSearch 认证插件，访问的时候添加账密</li>
<li>当然也可以通过 nginx 作代理防护</li>
</ul>
<p>本文主要讲解通过启用 X-Pack 来设置 ElasticSearch 的访问密码。</p>
<p>集群与单据环境都适合次方法</p>
<ul>
<li>集群与单据环境配置的区别就是，集群需要在某一台生成证书然后拷贝到其它节点目录下。</li>
<li>集群环境重设置密码的时候需要整个集群节点都已启动，可在任一台处修改。</li>
</ul>
<h2 id="2x-pack简介"><a class="markdownIt-Anchor" href="#2x-pack简介">#</a> 2.X-PACK 简介</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Pack是Elastic Stack扩展功能，提供安全性，警报，监视，报告，机器学习和许多其他功能。 ES7.0+之后，默认情况下，当安装Elasticsearch时，会自动安装X-Pack，无需单独再安装。自6.8以及7.1+版本之后，基础级安全永久免费了。</span><br><span class="line">在使用的时候主要需要配置一下证书，以及修改配置文件（config/elasticsearch.yml ）</span><br></pre></td></tr></table></figure>
<h2 id="3证书配置"><a class="markdownIt-Anchor" href="#3证书配置">#</a> 3. 证书配置</h2>
<h3 id="31生成节点证书"><a class="markdownIt-Anchor" href="#31生成节点证书">#</a> 3.1 生成节点证书</h3>
<p>切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin<br>
 借助 elasticsearch-certutil 命令生成证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./elasticsearch-certutil ca -out config/certs/elastic-certificates.p12 -pass</span><br></pre></td></tr></table></figure>
<p>这里单独设置了一个 证书文件目录 config/certs<br>
<img src="https://www.freesion.com/images/951/a3d0c1934c0ed0f8440f830d63e96dbf.png" alt="在这里插入图片描述"></p>
<p>生成后的证书<br>
<img src="https://www.freesion.com/images/953/de92ac2cf73d1ed0da994f9d1066e8f1.png" alt="在这里插入图片描述"></p>
<h3 id="32修改配置"><a class="markdownIt-Anchor" href="#32修改配置">#</a> 3.2 修改配置</h3>
<p>配置通信证书 &gt; 需要在 config 目前下 elasticsearch.yml 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启xpack</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line"># 证书配置</span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="line">xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12</span><br><span class="line">xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其它配置（可选）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#跨域配置</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>注：若是集群环境则需要将证书文件目录，以及配置文件，在所有集群环境下都修改一下。</p>
<h3 id="33重启生效"><a class="markdownIt-Anchor" href="#33重启生效">#</a> 3.3. 重启生效</h3>
<p>需要重启 elasticsearch</p>
<p>注：若是集群环境下则需要启动所有集群节点，再统一设置密码</p>
<p>注：重启异常情况，若出现报错，类似 failed to load plugin class [org.elasticsearch.xpack.core.XPackPlugin]<br>
 请检查是否是使用 root 用户生成的证书，启动用户无权限导致。</p>
<h2 id="4设置用户密码"><a class="markdownIt-Anchor" href="#4设置用户密码">#</a> 4. 设置用户密码</h2>
<p>执行设置用户名和密码的命令，内置了部分用户<br>
切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin/</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 手动配置每个用户密码模式（需要一个一个的输入）</span><br><span class="line">./elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>也可以先自动配置密码后续再修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#自动配置每个用户密码（随机生成并返回字符串密码,需要保存好）</span><br><span class="line">./elasticsearch-setup-passwords auto  </span><br></pre></td></tr></table></figure>
<p>下图 1 是自动生成密码情况（一定拷贝下来要牢记密码）<br>
<img src="https://www.freesion.com/images/198/f383d0d38bab2a11f3293d44ffccf0ae.png" alt="在这里插入图片描述"></p>
<p>下图 2 是自定义密码情况<br>
分别为多个用户设置密码例如：elastic, kibana, logstash_system,beats_system,<br>
 设置密码的时候需要连续输入 2 遍。<br>
<img src="https://www.freesion.com/images/458/363890f3fdffcc0b1bcfaae3c8295952.png" alt="在这里插入图片描述"></p>
<p>部分内置账号的角色权限解释如下：</p>
<ul>
<li>elastic 账号：拥有 superuser 角色，是内置的超级用户。</li>
<li>kibana 账号：拥有 kibana_system 角色，用户 kibana 用来连接 elasticsearch 并与之通信。Kibana 服务器以该用户身份提交请求以访问集群监视 API 和 .kibana 索引。不能访问 index。</li>
<li>logstash_system 账号：拥有 logstash_system 角色。用户 Logstash 在 Elasticsearch 中存储监控信息时使用。</li>
</ul>
<p>至此单节点安全配置完毕，重启 es 后访问 9200 会出现用户名和密码的提示窗口，我们就可以通过用户生成的密码过行访问了</p>
<h2 id="5测试访问"><a class="markdownIt-Anchor" href="#5测试访问">#</a> 5. 测试访问</h2>
<p>通过查看证书方式，顺便测试一下密码是否生效了<br>
浏览器输入 <a target="_blank" rel="noopener" href="http://ip:9200/_license">http://IP:9200/_license</a> 可以看到，弹窗出来，需要输入密码了<br>
<img src="https://www.freesion.com/images/561/b7034fa6ab245e277567b01d40929119.png" alt="在这里插入图片描述"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9b1a95e8a4b361dd4f7e3012300d1115.png" alt="在这里插入图片描述"></p>
<h2 id="附录常见问题"><a class="markdownIt-Anchor" href="#附录常见问题">#</a> 附录：常见问题</h2>
<h3 id="1如何修改账号密码"><a class="markdownIt-Anchor" href="#1如何修改账号密码">#</a> 1. 如何修改账号密码</h3>
<p>以 elastic 账号为例，注意需要在 elasticsearch 服务已启动的情况下进行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -u elastic:123456 -XPUT &#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27; -d &#x27;&#123; &quot;password&quot; : &quot;1234567&quot; &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2客户端es-head连接问题"><a class="markdownIt-Anchor" href="#2客户端es-head连接问题">#</a> 2. 客户端 ES-HEAD 连接问题</h3>
<p>连接失败情况下先检查是否是跨域问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>例如下图连接的时候报错未授权<br>
<img src="https://www.freesion.com/images/96/57fa25b106cf1cdee9f44a2f8577e620.png" alt="在这里插入图片描述"></p>
<p>解决方案：在访问的 URL 中拼接授权账号信息<br>
示例：?auth_user=elastic&amp;auth_password=1234567</p>
<p>示例：指定服务端地址以及账户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://IP:9100/?base_uri=http://IP:9200&amp;auth_user=elastic&amp;auth_password=1234567</span><br></pre></td></tr></table></figure>
<h3 id="3启动报xpack相关错"><a class="markdownIt-Anchor" href="#3启动报xpack相关错">#</a> 3. 启动报 XPACK 相关错</h3>
<p><img src="https://www.freesion.com/images/947/90ff281ef660a79e49875391f87e474b.png" alt="在这里插入图片描述"></p>
<p>DecoderException: javax.net.ssl.SSLHandshakeException: No available authentication scheme<br>
<img src="https://www.freesion.com/images/485/efd6d897ad8655121334fd050eecd445.png" alt="在这里插入图片描述"></p>
<p>解决方案：请通过上文配置步骤，排查，检查证书是否已经配置好，以及配置是否填写正确</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.735Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-08-01T23:15:02.000Z" title="2023/8/2 07:15:02">2023-08-02</time>更新</span><span class="level-item">6 分钟读完 (大约855个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90SpringCloud%E3%80%91%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E7%BB%86%E5%88%99/">微服务拆分细则</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>​	在微服务的设计过程中，微服务设计有多大，微服务粒度的把控，一直是设计人员需要考虑和设计的难点。</p>
<p>因为服务粒度设计过大，不能得到微服务架构带来的便利，例如：更加敏态的开发，更频繁的版本发布，由于服务功能划分的小，可以根据实际的业务场景，选择更加合适的技术进行代码重构等等。</p>
<p>​		但同时我们也要注意，不是服务越” 微 “越好，因为服务的过度拆分会使架构的设计复杂度大大提升，同时也会大大提升运维和测试的复杂度等。</p>
<p>​		所以对服务拆分粒度的把控，对设计人员来讲就至关重要了，甚至对项目的成败有非常重要的影响。</p>
<p>这篇文档提供了一些主要的微服务拆分原则，供您参考，来帮助您进行更加合理粒度的微服务设计。</p>
<h3 id="微服务的拆分原则-通用"><a class="markdownIt-Anchor" href="#微服务的拆分原则-通用">#</a> 微服务的拆分原则 - 通用</h3>
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>原则</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>原则 1</td>
<td>基于业务分析拆分</td>
<td>基于 TOGAF， ADA 等</td>
</tr>
<tr>
<td>原则 2</td>
<td>基于 DDD 领域驱动设计中的子域设计拆分</td>
<td>基于领域驱动设计</td>
</tr>
<tr>
<td>原则 3</td>
<td>根据动作和用例拆分</td>
<td>比如支付</td>
</tr>
<tr>
<td>原则 4</td>
<td>根据名词或者资源拆</td>
<td>比如账号</td>
</tr>
<tr>
<td>原则 5</td>
<td>架构稳定</td>
<td>拆分的结构稳定，不会经常修改</td>
</tr>
<tr>
<td>原则 6</td>
<td>服务是可测试的</td>
<td>集成测试要可定义，测试可回溯</td>
</tr>
<tr>
<td>原则 7</td>
<td>单一原则</td>
<td>一个服务做一个业务， 自己治理自己的数据库</td>
</tr>
<tr>
<td>原则 8</td>
<td>开闭原则</td>
<td>面向对象理论， 对扩展开放， 对修改关闭</td>
</tr>
<tr>
<td>原则 9</td>
<td>高内聚</td>
<td>强一致，强依赖关系的放在一起， 减少分布式事务</td>
</tr>
<tr>
<td>原则 10</td>
<td>低耦合</td>
<td>服务间互相独立</td>
</tr>
<tr>
<td>原则 11</td>
<td>足够小的团队可维护，最大两个 pizza team</td>
<td>6-10 人一个 pizza team</td>
</tr>
<tr>
<td>原则 12</td>
<td>团队自治，自己的服务的开发和发布要跟别的团队尽可能小的协调</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="微服务的拆分原则-技术侧重点"><a class="markdownIt-Anchor" href="#微服务的拆分原则-技术侧重点">#</a> 微服务的拆分原则 - 技术侧重点</h2>
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>原则</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>原则 1</td>
<td>潜在风险</td>
<td>服务的风险性</td>
</tr>
<tr>
<td>原则 2</td>
<td>资源性能计算性能硬盘性能内存容量网络带宽</td>
<td>机器的性能决定了方案的部分选择</td>
</tr>
<tr>
<td>原则 3</td>
<td>安全</td>
<td>安全要求是否很高，安全的策略</td>
</tr>
<tr>
<td>原则 4</td>
<td>高并发瞬时并发持续并发</td>
<td>并发的种类， 持续的时间</td>
</tr>
<tr>
<td>原则 5</td>
<td>数据库数据量大小读操作写操作数据类型</td>
<td>数据的类型， 读写的多少，数据量</td>
</tr>
</tbody>
</table>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.733Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-07-24T07:49:16.000Z" title="2023/7/24 15:49:16">2023-07-24</time>更新</span><span class="level-item">11 分钟读完 (大约1615个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/">【Docker】Linux部署Docker</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dockerlinux部署docker"><a class="markdownIt-Anchor" href="#dockerlinux部署docker">#</a> 【Docker】Linux 部署 Docker</h1>
<p>接触一段时间 docker，这个工具大大提高了开发者打包应用的效率。</p>
<p>一直都是直接把镜像扔到到 docker 里构建容器启动，并没有深入了解。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3eca951ddd044e9d9e1e6f2fcd5c680b.png" alt="在这里插入图片描述"><br>
本文由<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808?type=blog"> alpha0808</a> 大佬指导，如果要了解 docker 的概念以及命令，请去看大佬这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808/article/details/125699252?spm=1001.2014.3001.5502"> DOCKER 之入门篇</a></p>
<p>本篇文章集中于 linux 系统下对 docker 及相关组件的部署。</p>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#docker_9">一、安装 docker</a></li>
<li><a href="#_47">二、镜像加速</a></li>
<li>
<ul>
<li><a href="#_50">获取阿里云镜像地址</a></li>
<li><a href="#_56">添加加速器地址</a></li>
</ul>
</li>
<li><a href="#Portainer_75">三、可视化管理工具 Portainer</a></li>
<li>
<ul>
<li><a href="#_76">简介</a></li>
<li><a href="#_79">展示</a></li>
<li><a href="#_90">安装</a></li>
<li>
<ul>
<li><a href="#_92">镜像下载</a></li>
<li><a href="#_105">容器运行</a></li>
<li><a href="#_113">创建用户</a></li>
<li><a href="#docker_116">docker 连接管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_134">四、补充</a></li>
<li>
<ul>
<li><a href="#docker_135">docker 开机自启</a></li>
<li><a href="#_139">容器开机自启</a></li>
</ul>
</li>
</ul>
<h1 id="一-安装docker"><a class="markdownIt-Anchor" href="#一-安装docker">#</a> 一、安装 docker</h1>
<p>按照官网 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF">https://docs.docker.com/engine/install/centos/ 执行命令即可</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>yum检查更新</span><br><span class="line">sudo yum check-update</span><br><span class="line">#<span class="number">2.</span>删除旧版本</span><br><span class="line">sudo yum remove docker docker-client docker-client-latest  docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br><span class="line">#<span class="number">3.</span>安装gcc环境</span><br><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line">#<span class="number">4.</span>安装依赖项</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">#<span class="number">5.</span>将 Docker 存储库添加到 CentOS</span><br><span class="line">sudo yum-config-manager --add-repo https:<span class="comment">//download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line">#使用阿里服务器下载</span><br><span class="line">yum-config-manager --add-repo http:<span class="comment">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">#如果没有执行命令<span class="number">1</span>更新，那么此时执行命令即可</span><br><span class="line">yum makecache fast</span><br><span class="line">#<span class="number">6.</span>下载docker</span><br><span class="line">sudo yum install -y docker #注意这样下载需要接受GPG秘钥，相当于一个数字指纹，指纹格式：<span class="number">060</span>A <span class="number">61</span>C5 <span class="number">1B</span>55 <span class="number">8</span>A7F <span class="number">742B</span> <span class="number">77</span>AA C52F EB6B <span class="number">621</span>E <span class="number">9F</span>35</span><br><span class="line">#或者社区版本</span><br><span class="line">yum -y install docker-ce</span><br><span class="line">#<span class="number">7.</span>检查版本</span><br><span class="line">docker version</span><br><span class="line">#或者</span><br><span class="line">docker -v</span><br><span class="line">#<span class="number">8.</span>查看docker进程</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>执行第 8 步，如果报错<br>
 “<strong>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemo</strong>”<br>
 是因为 docker 还没启动</p>
<p>解决方案：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure>
<h1 id="二-镜像加速"><a class="markdownIt-Anchor" href="#二-镜像加速">#</a> 二、镜像加速</h1>
<p>使用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F&amp;spm=1001.2101.3001.7020">阿里云镜像</a>地址来加速镜像下载的速度</p>
<h2 id="获取阿里云镜像地址"><a class="markdownIt-Anchor" href="#获取阿里云镜像地址">#</a> 获取阿里云镜像地址</h2>
<p>点击<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">容器镜像服务</a><br>
<strong>镜像工具</strong>→<strong>镜像加速器</strong>，生成<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8A%A0%E9%80%9F%E5%99%A8&amp;spm=1001.2101.3001.7020">加速器</a>地址</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/644a2eab2b884c86874988c992891308.png" alt="在这里插入图片描述"></p>
<h2 id="添加加速器地址"><a class="markdownIt-Anchor" href="#添加加速器地址">#</a> 添加加速器地址</h2>
<p>切换目录至 /etc/docker</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/docker</span><br></pre></td></tr></table></figure>
<p>编辑 daemon.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;加速器地址&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%87%8D%E5%90%AFdocker&amp;spm=1001.2101.3001.7020">重启 docker</a> 的伴随线程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>
<p>重启 docker 服务</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1 id="三-可视化管理工具portainer"><a class="markdownIt-Anchor" href="#三-可视化管理工具portainer">#</a> 三、可视化管理工具 Portainer</h1>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Portainer 是 Docker 的<strong>图形化</strong>管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm 集群和服务等集中管理和操作、登录用户管理和控制等功能</p>
<h2 id="展示"><a class="markdownIt-Anchor" href="#展示">#</a> 展示</h2>
<ul>
<li>首页<br>
包含 docker-compose、容器、镜像、卷、网络总体概况<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/a02aadfe750448a2b68d3af149c24a3a.png" alt="在这里插入图片描述"></li>
<li>容器<br>
包含容器的启动、暂停、杀死进程、重启、新增，监控，日志查看，容器控制台等功能。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/906ebda299ae49dab32718dbd0519d2f.png" alt="在这里插入图片描述"></li>
<li>镜像<br>
包含镜像详细查看、删除、导入、导出等功能<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/14cc4c0cbaea403f895b07bbc006474a.png" alt="在这里插入图片描述"></li>
</ul>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装">#</a> 安装</h2>
<p>采用 docker 安装</p>
<h3 id="镜像下载"><a class="markdownIt-Anchor" href="#镜像下载">#</a> 镜像下载</h3>
<p>查询 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/52a91f8890aa4618999620689636e6ce.png" alt="在这里插入图片描述"></p>
<p>下载 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull portainer/portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/15a7b2b883bd41c78d66d8f391e791eb.png" alt="在这里插入图片描述"></p>
<h3 id="容器运行"><a class="markdownIt-Anchor" href="#容器运行">#</a> 容器运行</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>开放 9000 端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9000/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h3 id="创建用户"><a class="markdownIt-Anchor" href="#创建用户">#</a> 创建用户</h3>
<p>访问 9000 端口，第一次登录设置管理员账号和密码<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/90ff15efcc5e44f38105bf45c4a10faa.png" alt="在这里插入图片描述"></p>
<h3 id="docker连接管理"><a class="markdownIt-Anchor" href="#docker连接管理">#</a> docker 连接管理</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e0730e684e3c407fba300d41ad5dff7e.png" alt="在这里插入图片描述"><br>
可以选择管理本地 Local 和远程 Remote 的 Docker 两个选项，我们安装在本机，直接选择 Local，然后 Connect 进入管理界面<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/50e22542b48144a7bebcc9c2cc194dfc.png" alt="在这里插入图片描述"><br>
点击 connect，报错</p>
<blockquote>
<p>Failure dial unix /var/run/docker.sock: connect: permission denied</p>
</blockquote>
<p>可以猜测是 SElinux 的问题，看 SELinux 状态：sestatus 命令进行查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/sestatus -v      ##如果SELinux status参数为enabled即为开启状态</span><br><span class="line">SELinux status:                 enabled</span><br></pre></td></tr></table></figure>
<p>修改 /etc/selinux/config 文件，保存后重启机器</p>
<blockquote>
<p>将<strong> SELINUX=enforcing</strong> 改为<strong> SELINUX=disabled</strong></p>
</blockquote>
<p>再次访问 9000，连接 local，成功<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e2756cc7d9154993992f2c3a00d5ca58.png" alt="在这里插入图片描述"></p>
<h1 id="四-补充"><a class="markdownIt-Anchor" href="#四-补充">#</a> 四、补充</h1>
<h2 id="docker开机自启"><a class="markdownIt-Anchor" href="#docker开机自启">#</a> docker 开机自启</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>
<h2 id="容器开机自启"><a class="markdownIt-Anchor" href="#容器开机自启">#</a> 容器开机自启</h2>
<p>以上面的 docker 可视化管理工具 portainer 为例，希望开机的时候，自动启动镜像</p>
<p>启动命令加–restart=always</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer --restart=always  -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>如果已经在运行的镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always portainer</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.730Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-07-23T21:49:57.000Z" title="2023/7/24 05:49:57">2023-07-24</time>更新</span><span class="level-item">8 分钟读完 (大约1262个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90HEXO%E3%80%91%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/">【HEXO】使用Hexo搭建属于自己的博客</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="hexo使用hexo搭建属于自己的博客"><a class="markdownIt-Anchor" href="#hexo使用hexo搭建属于自己的博客">#</a> 【HEXO】使用 Hexo 搭建属于自己的博客</h1>
<p><strong>目录</strong></p>
<p><a href="#t0">一、查询当前博客发布地址</a></p>
<p><a href="#t1">二、域名注册</a></p>
<p><a href="#t2">1、这里博主以阿里云为例，首先进入阿里云官网，登录账号</a></p>
<p><a href="#t3">2、点击搜索按钮，搜索栏输入域名，点击搜索</a></p>
<p><a href="#t4">3、点击域名注册</a></p>
<p><a href="#t5">4、在搜索栏输入想要的域名，这里以 “wanwang” 举例，点击查询域名</a></p>
<p><a href="#t6">5、购买域名 </a></p>
<p><a href="#t7">6、购买完成后，返回查询域名页面，点击管理我的域名</a></p>
<p><a href="#t8">7、找到刚刚购买的域名，点击解析</a></p>
<p><a href="#t9">8、点击添加记录</a></p>
<p><a href="#t10">9、添加记录</a></p>
<p><a href="#t11">10、设置成功后，等待状态变为正常即可</a></p>
<p><a href="#t12">11、设置自定义域名</a></p>
<p><a href="#t13">三、完成</a></p>
<p><a href="#t14">1、访问刚才设置好的域名，“http:// 域名”，出现博客页面，表示成功。</a></p>
<hr>
<h1 id="一-查询当前博客发布地址"><a class="markdownIt-Anchor" href="#一-查询当前博客发布地址">#</a> 一、查询当前博客发布地址</h1>
<p>1、登录 GitHub，找到仓库（一般以 “.github.io” 结尾），点击进入</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f16f4f455be5402f9b95487ac16f362c.png" alt="img"></p>
<p>2、右上方点击 “Settings”, 左下方找到 “Pages” 点击后，蓝色字体为博客发布的网址，点击查看，网址一般为 “<a target="_blank" rel="noopener" href="https://xn--5mq40k5uk/%E2%80%9D">https:// 仓库名 /”</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e4b93952287a4830a07ef974e72890b3.png" alt="img"></p>
<h1 id="二-域名注册"><a class="markdownIt-Anchor" href="#二-域名注册">#</a> 二、域名注册</h1>
<p>注：博主这里提供国内域名商的官网，仅供参考！</p>
<p>阿里云网址</p>
<p><a target="_blank" rel="noopener" href="https://www.aliyun.com/">阿里云 - 上云就上阿里云<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://www.aliyun.com/</a></p>
<p>华为云网址</p>
<p><a target="_blank" rel="noopener" href="https://activity.huaweicloud.com/">最新优惠活动_云服务器特惠促销_打折云产品专场_特价低至 1 折 - 华为云<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://activity.huaweicloud.com/</a></p>
<p>腾讯云网址</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/">腾讯云 - 产业智变 云启未来<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://cloud.tencent.com/</a></p>
<h2 id="1-这里博主以阿里云为例首先进入阿里云官网登录账号"><a class="markdownIt-Anchor" href="#1-这里博主以阿里云为例首先进入阿里云官网登录账号">#</a> 1、这里博主以阿里云为例，首先进入阿里云官网，登录账号</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c294e851d3734e508c7aa093d656d2d1.png" alt="img"></p>
<h2 id="2-点击搜索按钮搜索栏输入域名点击搜索"><a class="markdownIt-Anchor" href="#2-点击搜索按钮搜索栏输入域名点击搜索">#</a> 2、点击搜索按钮，搜索栏输入域名，点击搜索</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2e3c87e917e047b68e69a5ecc6809576.png" alt="img"></p>
<h2 id="3-点击域名注册"><a class="markdownIt-Anchor" href="#3-点击域名注册">#</a> 3、点击域名注册</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0176ff2c3e104636b5c938a075f94101.png" alt="img"></p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="4-在搜索栏输入想要的域名这里以wanwang举例点击查询域名"><a class="markdownIt-Anchor" href="#4-在搜索栏输入想要的域名这里以wanwang举例点击查询域名">#</a> 4、在搜索栏输入想要的域名，这里以 “wanwang” 举例，点击查询域名</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ad6c7f9be87d4d4f877d2ddc145be9e8.png" alt="img"></p>
<h2 id="5-购买域名"><a class="markdownIt-Anchor" href="#5-购买域名">#</a> 5、购买域名</h2>
<p>搜索结果，可能出现已注册情况，建议选择未注册的域名，点击购买，各位朋友请根据自己的需求和自身的经济实力购买，域名没有永久的都是有时效性的，具体可以询问客服</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b761760294024ec5a015ba17b6e5256d.png" alt="img"></p>
<h2 id="6-购买完成后返回查询域名页面点击管理我的域名"><a class="markdownIt-Anchor" href="#6-购买完成后返回查询域名页面点击管理我的域名">#</a> 6、购买完成后，返回查询域名页面，点击管理我的域名</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/cfb0a55c15da4c99b4cf2054d01fe56c.png" alt="img"></p>
<h2 id="7-找到刚刚购买的域名点击解析"><a class="markdownIt-Anchor" href="#7-找到刚刚购买的域名点击解析">#</a> 7、找到刚刚购买的域名，点击解析</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/14a5a0a258914d078026d0e188c2d52b.png" alt="img"></p>
<h2 id="8-点击添加记录"><a class="markdownIt-Anchor" href="#8-点击添加记录">#</a> 8、点击添加记录</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/8ae1f0fd8ffa4c07a5a1c6c7ca0a52e4.png" alt="img"></p>
<h2 id="9-添加记录"><a class="markdownIt-Anchor" href="#9-添加记录">#</a> 9、添加记录</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ddcaacbaca9f440e98bd8f690d667b2d.png" alt="img"></p>
<h2 id="10-设置成功后等待状态变为正常即可"><a class="markdownIt-Anchor" href="#10-设置成功后等待状态变为正常即可">#</a> 10、设置成功后，等待状态变为正常即可</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/642fe813a4ab43339a94a23261f58d28.png" alt="img"></p>
<h2 id="11-设置自定义域名"><a class="markdownIt-Anchor" href="#11-设置自定义域名">#</a> 11、设置自定义域名</h2>
<p>右上方点击 “Settings”，左下方找到 “Pages” 点击后，在 “Custom domain”（自定义域名）下方文本栏中填写域名，勾选 “Enforce HTTPS”（强制使用 https 协议），点击 “Save”（保存），蓝色字体为博客发布的网址，点击查看，网址一般为 “<a target="_blank" rel="noopener" href="https://xn--eqrt2g/%E2%80%9D">https:// 域名 /”</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/df5af9f92fc44565b3be43e426b50cee.png" alt="img"></p>
<h1 id="三-完成"><a class="markdownIt-Anchor" href="#三-完成">#</a> 三、完成</h1>
<h2 id="1-访问刚才设置好的域名http域名出现博客页面表示成功"><a class="markdownIt-Anchor" href="#1-访问刚才设置好的域名http域名出现博客页面表示成功">#</a> 1、访问刚才设置好的域名，“<a target="_blank" rel="noopener" href="http://xn--eqrt2g">http:// 域名</a>”，出现博客页面，表示成功。</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/30baf16189c9448da5e343f87759774a.png" alt="img"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.727Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-07-03T04:34:24.000Z" title="2023/7/3 12:34:24">2023-07-03</time>更新</span><span class="level-item">13 分钟读完 (大约1945个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Java%E3%80%91Volatile%E5%85%B3%E9%94%AE%E5%AD%97/">Volatile关键字</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="volatile关键字"><a class="markdownIt-Anchor" href="#volatile关键字">#</a> Volatile 关键字</h1>
<p>Volatile 关键字的作用主要有如下两个：</p>
<p>线程的可见性：当一个线程修改一个共享变量时，另外一个线程能读到这个修改的值。</p>
<p>顺序一致性：禁止指令重排序。</p>
<h1 id="一-线程可见性"><a class="markdownIt-Anchor" href="#一-线程可见性">#</a> 一、线程可见性</h1>
<p>我们先通过一个例子来看看线程的可见性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileTest</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = <span class="literal">false</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改flag值为：&quot;</span> + <span class="built_in">this</span>.flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VolatileTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolatileTest</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (test.flag) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;结束&quot;</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;Thread1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                test.updateFlag();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果如下，我们可以看到虽然线程 Thread2 已经把 flag 修改为 false 了，但是线程 Thread1 没有读取到 flag 修改后的值，线程一直在运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改flag值为：false</span><br></pre></td></tr></table></figure>
<p>我们把 flag 变量加上 volatile：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatile  boolean flag = true;</span><br></pre></td></tr></table></figure>
<p>重新运行程序，打印结果如下。Thread1 结束，说明 Thread1 读取到了 flage 修改后的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改flag值为：false</span><br><span class="line">Thread1结束</span><br></pre></td></tr></table></figure>
<p>说到可见性，我们需要先了解一下 Java 内存模型，Java 内存模型如下所示：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d90e39f9caa340b0bb589ef1dbb2f667.png" alt="在这里插入图片描述"></p>
<p>线程之间的共享变量存储在主内存中（Main Memory）中，每个线程都一个都有一个私有的本地内存（Local Memory），本地内存中存储了该线程以读 / 写共享变量的副本。</p>
<p>所以当一个线程把主内存中的共享变量读取到自己的本地内存中，然后做了更新。在还没有把共享变量刷新的主内存的时候，另外一个线程是看不到的。</p>
<p>如何把修改后的值刷新到主内存中的？<br>
现代的处理器使用写缓冲区临时保存向内存写入的数据。写缓冲区可以保证指令流水线持续运行，它可以避免由于处理器停顿下来等向内存写入数据而产生的延迟。同时，通过以批处理的方式刷新写缓冲区，以及合并写缓冲区中对同一内存地址的多次写，较少对内存总线的占用。但是什么时候写入到内存是不知道的。<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f96ceb17a5644f7db67d3a64f8b888fa.png" alt="在这里插入图片描述"></p>
<p>所以就引入了 volatile，volatile 是如何保证可见性的呢？<br>
在 X86 处理器下通过工具获取 JIT 编译器生成的汇编指令来查看对 volatile 进行写操作时，会多出 lock addl。Lock 前缀的指令在多核处理器下会引发两件事情：</p>
<p>1. 将当前处理器缓存行的数据写回到系统内存。<br>
2. 这个写回内存的操作会使其他 cpu 里缓存了该内存地址的数据无效。<br>
如果声明了 volatile 的变量进行写操作，JVM 就会向处理器发送一条 Lock 前缀的指令，将这个变量所在缓存行的数据写回到系统内存。但是，就算写回到内存，如果其他处理器缓存的还是旧的，在执行操作就会有问题。所以，在多处理器下，为了保证各个处理器的缓存是一致的，就会实现缓存一致性协议，每个处理器通过嗅探在总线传播的数据来检查自己缓存的值是不是过期了，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存里。</p>
<h1 id="二-顺序一致性"><a class="markdownIt-Anchor" href="#二-顺序一致性">#</a> 二、顺序一致性</h1>
<p>在执行程序时，为了提高性能，编译器和处理器常常会对指令做重排序。重排序分为如下三种：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/39a6b41a1a1a4d0191f418b0519aa532.png" alt="在这里插入图片描述"></p>
<p>1 属于编译器重排序，2 和 3 属于处理器重排序。这些重排序可能会导致多线程程序出现内存可见性问题。<br>
当变量声明为 volatile 时，Java 编译器在生成指令序列时，会插入内存屏障指令。通过内存屏障指令来禁止重排序。<br>
JMM 内存屏障插入策略如下：<br>
在每个 volatile 写操作的前面插入一个 StoreStore 屏障，后面插入一个 StoreLoad 屏障。<br>
在每个 volatile 读操作后面插入一个 LoadLoad，LoadStore 屏障。</p>
<p>Volatile 写插入内存屏障后生成指令序列示意图：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f44d26762f704a28905e2f65b2a75d53.png" alt="在这里插入图片描述"></p>
<p>Volatile 读插入内存屏障后生成指令序列示意图：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/97e184ee75ed4e18b3066e1c8ab585e1.png" alt="在这里插入图片描述"></p>
<p>通过上面这些我们可以得出如下结论：编译器不会对 volatile 读与 volatile 读后面的任意内存操作重排序；编译器不会对 volatile 写与 volatile 写前面的任意内存操作重排序。</p>
<p>防止重排序使用案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeDoubleCheckedLocking</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Instance instane;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> Instance <span class="title function_">getInstane</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instane==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SafeDoubleCheckedLocking.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instane==<span class="literal">null</span>)&#123;</span><br><span class="line">                    instane=<span class="keyword">new</span> <span class="title class_">Instance</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instane;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个对象主要分为如下三步：</p>
<p>分配对象的内存空间。<br>
初始化对象。<br>
设置 instance 指向内存空间。<br>
如果 instane 不加 volatile，上面的 2，3 可能会发生重排序。假设 A，B 两个线程同时获取，A 线程获取到了锁，发生了指令重排序，先设置了 instance 指向内存空间。这个时候 B 线程也来获取，instance 不为空，这样 B 拿到了没有初始化完成的单例对象（如下图）</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/70457cf0d7904aa5a8b3edb1bffd4561.png" alt="在这里插入图片描述"></p>
<p>二、Volatile 与 Synchronized 比较<br>
 1.Volatile 是轻量级的 synchronized，因为它不会引起上下文的切换和调度，所以 Volatile 性能更好。<br>
2.Volatile 只能修饰变量，synchronized 可以修饰方法，静态方法，代码块。<br>
3.Volatile 对任意单个变量的读 / 写具有原子性，但是类似于 i++ 这种复合操作不具有原子性。而锁的互斥执行的特性可以确保对整个临界区代码执行具有原子性。<br>
4. 多线程访问 volatile 不会发生阻塞，而 synchronized 会发生阻塞。<br>
5.volatile 是变量在多线程之间的可见性，synchronize 是多线程之间访问资源的同步性。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.725Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-06-26T11:20:26.000Z" title="2023/6/26 19:20:26">2023-06-26</time>更新</span><span class="level-item">8 分钟读完 (大约1139个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90ELK%E3%80%91SpringBoot%E6%95%B4%E5%90%88ELK%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E6%97%A5%E5%BF%97%E6%90%9C%E7%B4%A2/">【ELK】SpringBoot整合ELK实现分布式日志搜索</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="elkspringboot整合elk实现分布式日志搜索"><a class="markdownIt-Anchor" href="#elkspringboot整合elk实现分布式日志搜索">#</a> 【ELK】SpringBoot 整合 ELK 实现分布式日志搜索</h1>
<h1 id="一环境准备"><a class="markdownIt-Anchor" href="#一环境准备">#</a> 一。环境准备：</h1>
<h3 id="安装elasticsearch-kibana-logstash"><a class="markdownIt-Anchor" href="#安装elasticsearch-kibana-logstash">#</a> 安装<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ElasticSearch&amp;spm=1001.2101.3001.7020"> ElasticSearch</a>、Kibana、LogStash。</h3>
<p>docker 内，下载需要的镜像。然后启动一个镜像。</p>
<h3 id="1es创建"><a class="markdownIt-Anchor" href="#1es创建">#</a> 1.Es 创建</h3>
<p><strong>创建并运行一个 ElasticSearch 容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">7.6.2 启动需要增加discovery.type=single-node</span></span><br><span class="line">docker run -e ES_JAVA_OPTS=&quot;-Xms256m -Xmx256m&quot; -e discovery.type=single-node  -d -p 9200:9200 -p 9300:9300 --name MyES elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>浏览器访问测试：<a target="_blank" rel="noopener" href="http://127.0.0.1:9200">http://127.0.0.1:9200</a>，应输出如下结果：</strong></p>
</blockquote>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;WQawbNC&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_uuid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;f6QviESlT_e5u3kaZFHoWA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.6.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_flavor&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_hash&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2f4c224&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2020-03-18T23:22:18.622755Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_snapshot&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lucene_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;7.7.2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.6.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_index_compatibility_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.0.0&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tagline&quot;</span><span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="2kibana创建"><a class="markdownIt-Anchor" href="#2kibana创建">#</a> 2.Kibana 创建</h2>
<p><strong>创建并运行运行一个 Kibana 容器：</strong><br>
创建之前，先查看 ES 在 docker 中的 ip 地址，因为我们的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=kibana&amp;spm=1001.2101.3001.7020"> kibana</a> 在启动的时候需要连接到 ES。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">先使用命令 docker ps 查看ES容器ID</span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出如下:</span></span><br><span class="line">CONTAINER ID   IMAGE                   COMMAND      CREATED        STATUS        PORTS      NAMES</span><br><span class="line">a266d1ff5c1b  elasticsearch:7.6.2   &quot;/usr/local/bin/dock…&quot;   19 hours ago   Up 18 hours   0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   MyES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过容器ID，查看容器IP地址。以上的a266d1ff5c1b就是我们ES的容器ID</span></span><br><span class="line">docker inspect --format &#x27;&#123;&#123; .NetworkSettings.IPAddress &#125;&#125;&#x27; a266d1ff5c1b</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输出如下:</span></span><br><span class="line">172.17.0.3</span><br></pre></td></tr></table></figure>
<p><strong>得到了 ES 容器 IP 地址之后，创建并运行一个 Kibana 容器。</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">注意，此处的ELASTICSEARCH_URL需替换成上面ES容器的IP地址，否则Kibana连接不到ES</span></span><br><span class="line">docker run -d --name MyKibana -p 5601:5601 -e ELASTICSEARCH_URL=http://172.17.0.3:9200 kibana:7.6.2</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>浏览器访问测试：<a target="_blank" rel="noopener" href="http://127.0.0.1:5601">http://127.0.0.1:5601</a>：</strong></p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2584c6896d84d3290cc097f47766912c.png" alt="image.png"></p>
<h2 id="3logstash创建"><a class="markdownIt-Anchor" href="#3logstash创建">#</a> 3.LogStash 创建</h2>
<p><strong>创建并运行运行一个 LogStash 容器：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9600:9600 -p 4560:4560 --name MyLogStash logstash:7.6.2</span><br></pre></td></tr></table></figure>
<p>运行后，进入容器内部。修改 logstash.yml 配置文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it 容器ID bash</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd config</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi logstash.yml</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改成如下配置</span></span><br><span class="line">http.host: &quot;0.0.0.0&quot;</span><br><span class="line">xpack.monitoring.elasticsearch.hosts: [ &quot;http://esIP地址:9200&quot; ]</span><br><span class="line">xpack.monitoring.elasticsearch.username: elastic</span><br><span class="line">xpack.monitoring.elasticsearch.password: your password</span><br></pre></td></tr></table></figure>
<p>修改 pipeline 下的 logstash.conf 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  tcp &#123;</span><br><span class="line">    #模式选择为server</span><br><span class="line">    mode =&gt; &quot;server&quot;</span><br><span class="line">    #ip和端口对应docker对外暴露logstash的地址可以使用下面命令查看</span><br><span class="line">    #docker inspect logstash | grep IPAddress</span><br><span class="line">    host =&gt; &quot;172.17.0.3&quot;</span><br><span class="line">    port =&gt; 4560</span><br><span class="line">    codec =&gt; json_lines</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">  elasticsearch &#123;</span><br><span class="line">        action =&gt; &quot;index&quot;</span><br><span class="line">    #这里是es的地址，多个es要写成数组的形式</span><br><span class="line">    hosts  =&gt; &quot;http://你的esIP:9200&quot;</span><br><span class="line">    user =&gt; elastic #如果es配置了账号密码，要配置账号密码</span><br><span class="line">    password =&gt; password #如果es配置了账号密码，要配置账号密码</span><br><span class="line">    manage_template =&gt; true</span><br><span class="line">    #用于kibana过滤，可以填项目名称 必须必须必须小写。</span><br><span class="line">    index  =&gt; &quot;demologs&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>最后重启我们的 logstash</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart MyLogStash</span><br></pre></td></tr></table></figure>
<h1 id="二-使elk与springboot集成"><a class="markdownIt-Anchor" href="#二-使elk与springboot集成">#</a> 二、 使 ELK 与 SpringBoot 集成</h1>
<p>maven 相关依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.elk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ch.qos.logback.version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">ch.qos.logback.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ch.qos.logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ch.qos.logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-access<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;ch.qos.logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>logback 配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;1 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/base.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stash&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.appender.LogstashTcpSocketAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">destination</span>&gt;</span>你的LogStashIP地址:4560<span class="tag">&lt;/<span class="name">destination</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- encoder必须配置,有多种可选 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">class</span>=<span class="string">&quot;net.logstash.logback.encoder.LogstashEncoder&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stash&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>日志记录：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ElkController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">elkAdd</span><span class="params">()</span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;日志记录&quot;</span>+System.currentTimeMillis());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Kibana 中查看创建索引及查看日志：<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2e66ba8d0e361daf4654481b328828bb.png" alt="image.png"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/937b6241405ccbedc5aca43fc79fdbbc.png" alt="image.png"></p>
<h4 id="可以看到我们的elk已经走通了后面就可以根据自己的实际业务需求去进行修改配置"><a class="markdownIt-Anchor" href="#可以看到我们的elk已经走通了后面就可以根据自己的实际业务需求去进行修改配置">#</a> 可以看到我们的 elk 已经走通了，后面就可以根据自己的实际业务需求去进行修改配置。</h4>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h2>
<p>本次通过 docker 搭建 elk+springboot 的过程还是花费了不少的时间的，还是有所收获的。碰到问题的话尽量去百度查资料，耐心点基本上都是可以解决的。有感兴趣的小伙伴可以一起交流学习呀。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.722Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-06-25T02:10:04.000Z" title="2023/6/25 10:10:04">2023-06-25</time>更新</span><span class="level-item">12 分钟读完 (大约1778个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Flutter%E3%80%91Flutter%E9%9B%86%E6%88%90%E4%B8%AD%E5%9B%BD%E7%A7%BB%E5%8A%A8%E4%B8%80%E9%94%AE%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%EF%BC%8C%E4%BA%B2%E6%B5%8B%E5%8F%AF%E8%A1%8C/">Flutter集成中国移动一键登录业务，亲测可行</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="flutter集成中国移动一键登录业务"><a class="markdownIt-Anchor" href="#flutter集成中国移动一键登录业务">#</a> Flutter 集成中国移动一键登录业务</h1>
<p>#本文适用于 Flutter 平台开发的小伙伴需要所谓一键登录的业务</p>
<p><img src="https://img.mukewang.com/szimg/5e3fda1b28fe88e205001000.jpg" alt="https://img.mukewang.com/szimg/5e3fda1b08fe88e203600780.jpg"></p>
<p>先贴上链接</p>
<p>中国移动互联网能力开放平台：<a target="_blank" rel="noopener" href="https://dev.10086.cn">https://dev.10086.cn</a></p>
<p>号码认证 Android_5.9.5 接入文档：<a target="_blank" rel="noopener" href="http://dev.10086.cn/dev10086/pub/loadAttach?attachId=9324E5A5EB8E4DF5BC5118221A93D3ED">http://dev.10086.cn/dev10086/pub/loadAttach?attachId=9324E5A5EB8E4DF5BC5118221A93D3ED</a></p>
<p>移动认证服务端接入文档：<a target="_blank" rel="noopener" href="https://dev.10086.cn/dev10086/pub/loadAttach?attachId=6EF75FD09D4F40D1973CB7C36C3DB2E2">https://dev.10086.cn/dev10086/pub/loadAttach?attachId=6EF75FD09D4F40D1973CB7C36C3DB2E2</a></p>
<p>话不多说，直接上正题，本文比某 SDN 的质量高不知道多少倍呢。</p>
<h3 id="1准备工作"><a class="markdownIt-Anchor" href="#1准备工作">#</a> 1. 准备工作</h3>
<h4 id="11注册账号并创建一个应用"><a class="markdownIt-Anchor" href="#11注册账号并创建一个应用">#</a> 1.1 注册账号并创建一个应用</h4>
<p>​	<img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112193829020.png" alt="image-20230112193829020"></p>
<h4 id="12-下载好统一认证sdk这里使用的版本是-quick_login_android_595jar"><a class="markdownIt-Anchor" href="#12-下载好统一认证sdk这里使用的版本是-quick_login_android_595jar">#</a> 1.2 下载好统一认证 SDK，这里使用的版本是 quick_login_android_5.9.5.jar</h4>
<p>请求我的服务器下载：<a target="_blank" rel="noopener" href="http://43.143.40.221:8080/quick_login_android_5.9.5.rar">http://43.143.40.221:8080/quick_login_android_5.9.5.rar</a><br>
 下载好后解压</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194426269.png" alt="image-20230112194426269"></p>
<h4 id="13-在移动开发平台申请好应用拿到appid-appkey"><a class="markdownIt-Anchor" href="#13-在移动开发平台申请好应用拿到appid-appkey">#</a> 1.3 在移动开发平台申请好应用拿到 appid、appkey</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112193937792.png" alt="image-20230112193937792"></p>
<h3 id="2开始接入"><a class="markdownIt-Anchor" href="#2开始接入">#</a> 2. 开始接入</h3>
<h4 id="21-使用as打开你的项目新建lib文件夹导入quick_login_android_595jar-右键aslibirary导入库"><a class="markdownIt-Anchor" href="#21-使用as打开你的项目新建lib文件夹导入quick_login_android_595jar-右键aslibirary导入库">#</a> 2.1 使用 AS 打开你的项目，新建 lib 文件夹，导入 quick_login_android_5.9.5.jar ，右键 asLibirary，导入库</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194530336.png" alt="image-20230112194530336"></p>
<p>打开项目视图</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194611295.png" alt="image-20230112194611295"></p>
<p>点击 APP 栏位，出现 quick_login_android_5.9.5.jar 即可</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194628573.png" alt="image-20230112194628573"></p>
<h4 id="22-在app级别下的-buildgradle-中的-dependencies-栏位导入依赖使用相对路径引入即可"><a class="markdownIt-Anchor" href="#22-在app级别下的-buildgradle-中的-dependencies-栏位导入依赖使用相对路径引入即可">#</a> 2.2 在 app 级别下的 build.gradle 中的 dependencies 栏位导入依赖，使用相对路径引入即可</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ···</span><br><span class="line">    implementation files(&#x27;..\\lib\\quick_login_android_5.9.5.jar&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194743574.png" alt="image-20230112194743574"></p>
<h4 id="23-打开-androidmanifestxml-在application引入-androidnetworksecurityconfigxmlnetwork_security_config"><a class="markdownIt-Anchor" href="#23-打开-androidmanifestxml-在application引入-androidnetworksecurityconfigxmlnetwork_security_config">#</a> 2.3 打开 AndroidManifest.xml 在 application 引入 android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194847830.png" alt="image-20230112194847830"></p>
<p>同时，在 res 目录下新建一个 xml 目录</p>
<p>新建 network_security_config.xml 文件 引入以下代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195214620.png" alt="image-20230112195214620"></p>
<p>下一步、将 SDK 集成的 GenLoginAuthActivity 引入主文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:name</span>=<span class="string">&quot;com.cmic.gen.sdk.view.GenLoginAuthActivity&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:configChanges</span>=<span class="string">&quot;orientation|keyboardHidden|screenSize&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:screenOrientation</span>=<span class="string">&quot;unspecified&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:theme</span>=<span class="string">&quot;@style/AuthPage&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTop&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195050430.png" alt="image-20230112195050430"></p>
<p>同时，在 res 目录下的两个 values 文件中的 styles.xml 中引入代码：（两个都需要引入）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AuthPage&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;@android:style/Theme.Holo.Light.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:background&quot;</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:colorBackground&quot;</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194947904.png" alt="image-20230112194947904"></p>
<p>下一步、引入权限代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_NETWORK_STATE&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195305682.png" alt="image-20230112195305682"></p>
<p>至此、主文件配置完成！</p>
<h4 id="24-将上面压缩包文件中sdk提供的demo程序中的res-umc文件目录引入到我们的main目录中与res同级"><a class="markdownIt-Anchor" href="#24-将上面压缩包文件中sdk提供的demo程序中的res-umc文件目录引入到我们的main目录中与res同级">#</a> 2.4 将上面压缩包文件中 SDK 提供的 Demo 程序中的 res-umc 文件目录引入到我们的 main 目录中，与 res 同级</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195514010.png" alt="image-20230112195514010"></p>
<p>将 res-umc 目录下的文件复制进入 res</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195543408.png" alt="image-20230112195543408"></p>
<p>最终效果：</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195605424.png" alt="image-20230112195605424"></p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195619339.png" alt="image-20230112195619339"></p>
<h4 id="25-打开-kotlin-下的-mainactivitykt-将代码全部复制进入如果导不到包可以看看你的jar包有没有成功引入"><a class="markdownIt-Anchor" href="#25-打开-kotlin-下的-mainactivitykt-将代码全部复制进入如果导不到包可以看看你的jar包有没有成功引入">#</a> 2.5 打开 kotlin 下的 MainActivity.kt ，将代码全部复制进入，如果导不到包可以看看你的 Jar 包有没有成功引入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.example.mobiledemo</span><br><span class="line"></span><br><span class="line">import android.os.Bundle</span><br><span class="line">import android.widget.Toast</span><br><span class="line">import com.cmic.gen.sdk.auth.GenAuthnHelper</span><br><span class="line">import com.cmic.gen.sdk.auth.GenTokenListener</span><br><span class="line">import com.cmic.gen.sdk.view.GenAuthThemeConfig</span><br><span class="line">import io.flutter.Log</span><br><span class="line">import io.flutter.embedding.android.FlutterActivity</span><br><span class="line">import io.flutter.plugin.common.MethodChannel</span><br><span class="line">import io.flutter.plugins.GeneratedPluginRegistrant</span><br><span class="line">import org.json.JSONObject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MainActivity : FlutterActivity() &#123;</span><br><span class="line">    private var mHelper: GenAuthnHelper? = null</span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        MethodChannel(</span><br><span class="line">            getFlutterEngine()?.getDartExecutor()?.getBinaryMessenger(),</span><br><span class="line">            &quot;TYRZ&quot;</span><br><span class="line">        ).setMethodCallHandler &#123; methodCall, result -&gt;</span><br><span class="line">            if (methodCall.method == &quot;loginAuth&quot;) &#123;</span><br><span class="line">                loginAuth(result)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.e(&quot;TYRZ&quot;, &quot;notImplemented&quot;)</span><br><span class="line">                result.notImplemented()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //创建AuthnHelper实例</span><br><span class="line">        mHelper = GenAuthnHelper.getInstance(this)</span><br><span class="line">        //打开SDK日志打印开关</span><br><span class="line">        GenAuthnHelper.setDebugMode(true)</span><br><span class="line">        //初始化授权页主题</span><br><span class="line">        mHelper?.setAuthThemeConfig(GenAuthThemeConfig.Builder().build())</span><br><span class="line">        getFlutterEngine()?.let &#123; GeneratedPluginRegistrant.registerWith(it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 统一认证SDK授权方法调用</span><br><span class="line">     */</span><br><span class="line">    private fun loginAuth(result: MethodChannel.Result) &#123;</span><br><span class="line">        //调用授权方法，这里要填写的appid、appkey为开发者在移动开发平台申请的appid、appkey</span><br><span class="line">        mHelper?.loginAuth(</span><br><span class="line">            &quot;300012327504&quot;,</span><br><span class="line">            &quot;2FDF3FA644E7476FE6733E123D968A82&quot;,</span><br><span class="line">            object : GenTokenListener &#123;</span><br><span class="line">                override fun onGetTokenComplete(i: Int, jsonObject: JSONObject) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        val resultCode = jsonObject.optString(&quot;resultCode&quot;, &quot;没有返回码！&quot;)</span><br><span class="line">                        Toast.makeText(this@MainActivity, resultCode, Toast.LENGTH_SHORT).show()</span><br><span class="line">                        //将结果回传给flutter</span><br><span class="line">                        result.success(resultCode)</span><br><span class="line">                    &#125; catch (e: Exception) &#123;</span><br><span class="line">                        e.printStackTrace()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3运行调试"><a class="markdownIt-Anchor" href="#3运行调试">#</a> 3. 运行调试</h3>
<p>3.1 demo 代码如下：</p>
<p>核心逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//调用方法通道 TYRZ，即我们在MainActivity中注册的方法，调用loginAuth登录方法</span><br><span class="line">String result = await const MethodChannel(&quot;TYRZ&quot;).invokeMethod(&quot;loginAuth&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: MyHomePage(title: <span class="string">&#x27;Flutter Demo Home Page&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  MyHomePage(&#123;Key? key, <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String?</span> title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyHomePageState createState() =&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//调用java方法</span></span><br><span class="line">  <span class="keyword">void</span> loginAuth() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;按钮点击！&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">String</span> result = <span class="keyword">await</span> <span class="keyword">const</span> MethodChannel(<span class="string">&quot;TYRZ&quot;</span>).invokeMethod(<span class="string">&quot;loginAuth&quot;</span>);</span><br><span class="line">      <span class="comment">//打印统一认证回调的响应码</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;resultCode = &quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建一个按钮，在点击按钮时调用统一认证的loginAuth方法拉起授权页。</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title!),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            RaisedButton(</span><br><span class="line">              child: <span class="keyword">const</span> Text(<span class="string">&quot;一键登录&quot;</span>),</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                loginAuth();</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="结果成功打印"><a class="markdownIt-Anchor" href="#结果成功打印">#</a> 结果：成功打印</h3>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112200118488.png" alt="image-20230112200118488"></p>
<p>客户端部分就此结束。</p>
<h2 id="服务端接入认证并请求移动接口获取用户手机号"><a class="markdownIt-Anchor" href="#服务端接入认证并请求移动接口获取用户手机号">#</a> 服务端接入认证并请求移动接口获取用户手机号：</h2>
<p>贴上部分代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">String mobile;</span><br><span class="line">     HashMap&lt;String, String&gt; res = <span class="literal">null</span>;</span><br><span class="line">     Map&lt;Object, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//获取到结果</span></span><br><span class="line">         res = JSONObject.parseObject(post(CHINA_MOBILE_OBTAINS_MOBILE_PHONE_NUMBER, JSONObject.toJSONString(getMD5NoEncryPtionRequestParamMap(token))), HashMap.class);</span><br><span class="line">         <span class="comment">//结果集判断</span></span><br><span class="line">         <span class="keyword">if</span> (AssertUtil.isEmpty(res) || !res.containsKey(<span class="string">&quot;msisdn&quot;</span>)) &#123;</span><br><span class="line">             logger.error(<span class="string">&quot;一键登录异常：&#123;&#125;,&#123;&#125;&quot;</span>, res, ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());<span class="comment">// 一键登录异常</span></span><br><span class="line">             result.put(ResponseCode.MOBILE_LOGIN_EXCEPTION.code(), ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());</span><br><span class="line">             <span class="keyword">return</span> result;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="comment">//获取到手机号</span></span><br><span class="line">             mobile = res.get(<span class="string">&quot;msisdn&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">&quot;一键登录异常：&#123;&#125;,&#123;&#125;&quot;</span>, res, ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());<span class="comment">// 一键登录异常</span></span><br><span class="line">         result.put(ResponseCode.MOBILE_LOGIN_EXCEPTION.code(), ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());</span><br><span class="line">         <span class="keyword">return</span> result;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>MD5 加密签名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calculates the MD5 digest and returns the value as a 32 character hex string.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data Data to digest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> MD5 digest as a hex string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5Hex</span><span class="params">(String data)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> org.apache.commons.codec.digest.DigestUtils.md5Hex(data).toUpperCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获取请求集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取MD5加密方式的无对称加密的请求集合</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> HashMap&lt;String, String&gt; <span class="title function_">getMD5NoEncryPtionRequestParamMap</span><span class="params">(String token)</span> &#123;</span><br><span class="line">     HashMap&lt;String, String&gt; param = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> UserUtil.createUUID();</span><br><span class="line">     <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMddHHmmssSSS&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">     param.put(<span class="string">&quot;version&quot;</span>, <span class="string">&quot;2.0&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;msgid&quot;</span>, msgId);</span><br><span class="line">     param.put(<span class="string">&quot;systemtime&quot;</span>, time);</span><br><span class="line">     param.put(<span class="string">&quot;strictcheck&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;appid&quot;</span>, appId);</span><br><span class="line">     param.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">     param.put(<span class="string">&quot;encryptionalgorithm&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;sign&quot;</span>, md5Hex(appId + <span class="string">&quot;2.0&quot;</span> + msgId + time + <span class="string">&quot;0&quot;</span> + token + APPSecret));</span><br><span class="line">     <span class="keyword">return</span> param;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>post 请求方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post</span><span class="params">(String URL, String json)</span> &#123;</span><br><span class="line">      <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultHttpClient</span>();</span><br><span class="line">      <span class="type">HttpPost</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(URL);</span><br><span class="line">      post.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">          <span class="type">StringEntity</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(json, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">          s.setContentEncoding(<span class="keyword">new</span> <span class="title class_">BasicHeader</span>(HTTP.CONTENT_TYPE,</span><br><span class="line">                  <span class="string">&quot;application/json&quot;</span>));</span><br><span class="line">          post.setEntity(s);</span><br><span class="line">          <span class="comment">// 发送请求</span></span><br><span class="line">          <span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> client.execute(post);</span><br><span class="line">          <span class="comment">// 获取响应输入流</span></span><br><span class="line">          <span class="type">InputStream</span> <span class="variable">inStream</span> <span class="operator">=</span> httpResponse.getEntity().getContent();</span><br><span class="line">          <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                  inStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">          <span class="type">StringBuilder</span> <span class="variable">strber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">          <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">          <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>)</span><br><span class="line">              strber.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">          inStream.close();</span><br><span class="line">          result = strber.toString();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">上一页</a></div><div class="pagination-next"><a href="/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/13/">13</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.773Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Flutter%E3%80%91Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/">Flutter开发中使用WIFI真机调试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.770Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90GOSN%E3%80%91Gosn%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/">【GOSN】Gosn是什么？怎么使用？</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.767Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Typora%E3%80%91typora%E9%85%8D%E7%BD%AEAliCloudOss%E5%9B%BE%E5%BA%93%E4%BD%BF%E7%94%A8picgo%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/">Typora使用gitee作为图库用picgo上传图片的教程~</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.765Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Docker%E3%80%91%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%B0%E5%BD%95/">使用docker搭建开发环境记录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.762Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Go%E3%80%91Go%E8%AF%AD%E8%A8%80%E4%B8%8EJava%E8%AF%AD%E8%A8%80%E5%AF%B9%E6%AF%94/">【Go】Go语言与Java语言对比</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">121</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>