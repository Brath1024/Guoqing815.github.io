<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.392Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:46:35.906Z" title="2023-3-21 15:46:35">2023-03-21</time>更新</span><span class="level-item">7 分钟读完 (大约1113个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Mysql%E3%80%91Mysql%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%8F%AA%E4%BF%9D%E7%95%99%E4%B8%80%E6%9D%A1/">【Mysql】Mysql删除重复数据只保留一条</a></p><div class="content"><h1 id="mysqlmysql删除重复数据只保留一条"><a class="markdownIt-Anchor" href="#mysqlmysql删除重复数据只保留一条">#</a> 【Mysql】Mysql 删除重复数据只保留一条</h1>
<p><strong>（1）以这张表为例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`  (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;注解id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名字&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test (id,`name`) <span class="keyword">VALUES</span> (replace(uuid(),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;张三&#x27;</span>),(replace(uuid(),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;张三&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>表里有两条数据，然后名字是相同的，但是 id 是不同的，现在要求是只留一条数据：</p>
<p><img src="https://img-blog.csdnimg.cn/888323c3cc9c4871ac5eeaf2aa7b55a1.png" alt="在这里插入图片描述"></p>
<p><strong>（2）查询 name 值重复的数据：</strong></p>
<blockquote>
<p>现实开发当中可能一个字段无法锁定重复值，可以采取 group by 多个值！利用多个值来锁定重复的行数据！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>（3）查询重复数据里面每个最小的 id：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="built_in">min</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>（4）查询去掉重复数据最小 id 的其他数据：也就是要删除的数据！</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span> ) </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="built_in">min</span>( id ) <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( NAME ) <span class="operator">&gt;</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><strong>（5）删除去掉重复数据最小 id 的其他数据：</strong></p>
<blockquote>
<p>可能这时候有人该说了，有了查询，直接改成 delete 不就可以了，真的是这样吗？其实不是的，如下运行报错：</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/917867c90bfc49fdacf3a1f5e45de26d.png" alt="在这里插入图片描述"></p>
<p>首先明确一点这个错误只会发生在 <code>delete</code>  语句或者 <code>update</code>  语句，拿 update 来举例 :  <code>update A表 set A列 = (select B列 from A表)；</code>  这种写法就会报这个错误，原因：你又要修改 A 表，然后又要从 A 表查数据，而且还是同层级。Mysql 就会认为是语法错误！</p>
<p>嵌套一层就可以解决， <code>update A表 set A列 = (select a.B列 from (select * from A表) a);</code>  当然这个只是个示例，这个示例也存在一定的问题，比如 <code>(select a.B列 from (select * from A表) a)</code>  他会查出来多条，然后赋值的时候会报  <code>1242 - Subquery returns more than 1 row</code> 。</p>
<p>嵌套一层他就可以和 update 撇清关系，会优先查括号里面的内容，查询结果出来过后会给存起来，类似临时表，可能有的人该好奇了， <code>update A表 set A列 = (select B列 from A表)；</code>  我明明加括号了呀，难道不算嵌套吗，当然不算，那个括号根本没有解决他们之间的层次关系！</p>
<p>详解看这篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43888891/article/details/127000534">https://blog.csdn.net/weixin_43888891/article/details/127000534</a></p>
<p><strong>（6）正确的写法：</strong></p>
<p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">IN</span> ( <span class="keyword">select</span> a.name <span class="keyword">from</span> (<span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span>) a) </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">select</span> a.id <span class="keyword">from</span> (<span class="keyword">SELECT</span>  <span class="built_in">min</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span>) a)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong> <code>注意：删除之前一定要先查询，然后再删除，否则一旦语法有问题导致删了不想删除的数据，想要恢复很麻烦！或者删除前备份好数据，不要嫌麻烦，一旦出问题，才是真正的大麻烦！</code> </strong></p>
</blockquote>
<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		t.id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME ) t)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（7）错误的写法：</strong> 这块我吃过一次亏，所以专门写出来，避免踩坑！</p>
<blockquote>
<p>千万千万不能这么搞，下面这个语法相当于是先按 name 分组，然后查出来大于 1 的，这时候假如大于 1 的有很多，然后外面嵌套的那一层，只取了最小的一条数据，然后再加上使用的是 <code>NOT IN</code> ，最终会导致数据全部被删除！！！</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/6c67f02195ef4b69b3f896f39f9d8b84.png" alt="在这里插入图片描述"></p>
<p>执行前有四条数据，实际上我们要的是张三留下来一条，然后李四留下来一条</p>
<p><img src="https://img-blog.csdnimg.cn/9f86345b6b9c4e009a0b596ddbb1c83e.png" alt="在这里插入图片描述"></p>
<p>执行结果：只留下了一条！</p>
<p><img src="https://img-blog.csdnimg.cn/be5a73336f5e4a26b93314e10231d998.png" alt="在这里插入图片描述"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.390Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:45:03.302Z" title="2023-3-21 15:45:03">2023-03-21</time>更新</span><span class="level-item">2 分钟读完 (大约351个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Flutter%E3%80%91flutter%20%E5%9C%A8%E7%9C%9F%E6%9C%BA%E4%B8%8A%E8%B0%83%E8%AF%95%E5%8D%B8%E8%BD%BD%E5%AE%89%E8%A3%85%E5%8C%85%E5%90%8E%E5%8D%A1%E4%BD%8F%E6%B2%A1%E5%8F%8D%E5%BA%94%E9%97%AE%E9%A2%98/">【Flutter】flutter 在真机上调试卸载安装包后卡住没反应问题</a></p><div class="content"><h1 id="flutterflutter-在真机上调试卸载安装包后卡住没反应问题"><a class="markdownIt-Anchor" href="#flutterflutter-在真机上调试卸载安装包后卡住没反应问题">#</a> 【Flutter】flutter 在真机上调试卸载安装包后卡住没反应问题</h1>
<h1 id="问题描述"><a class="markdownIt-Anchor" href="#问题描述">#</a> 问题描述</h1>
<p>把自己手机插上数据线后，用 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=flutter&amp;spm=1001.2101.3001.7020">flutter</a> 进行真机调试，本来配合 vscode 跑得好好的，不知道是写了 bug 还是咋地，目标效果出不来，以为是热更新失败了，最后只好把安装在手机上的 app 卸载了，想当然地以为运行  <code>flutter run</code>  后在手机上会贴心的提示我重装一遍，哪知给我突然卡住了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Running Gradle task &#x27;assembleDebug&#x27;...</span><br><span class="line">✓ Built build/app/outputs/flutter-apk/app-debug.apk.</span><br><span class="line">Installing build/app/outputs/flutter-apk/app.apk...</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>一直卡在这个安装环节上，等半天是一点反应都没有，试了各种方法重启应用、改用 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Andriod&amp;spm=1001.2101.3001.7020">Andriod</a> Studio 什么的，毛用没有，最后还得是在 <a target="_blank" rel="noopener" href="https://stackoverflow.com/">StackOveFlow</a> 上找到了法子：</p>
<h1 id="解决方法"><a class="markdownIt-Anchor" href="#解决方法">#</a> 解决方法：</h1>
<p>Change the applicationId in <strong>android\app\build.gradle</strong> file like this:</p>
<p>from :</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).</span></span><br><span class="line">	applicationId <span class="string">&quot;com.xxxxxxxxxxx.yyyyyy1&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>to :</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defaultConfig <span class="punctuation">&#123;</span></span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).</span></span><br><span class="line">	applicationId <span class="string">&quot;com.xxxxxxxxxxx.yyyyyy2&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>改一下 flutter 工程目录下  <code>andriod\app</code>  中  <code>build.gradle</code>  文件中的  <code>applicationId</code>  重新 build 就能重新在手机上安装调试 app 了，我丢！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.388Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:43:39.574Z" title="2023-3-21 15:43:39">2023-03-21</time>更新</span><span class="level-item">5 分钟读完 (大约696个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Java%E3%80%91canal%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%81%8D%E5%8E%86%E4%B8%8D%E5%88%B0%E6%95%B0%E6%8D%AE/">【Java】canal服务运行一段时间客户端遍历不到数据</a></p><div class="content"><h1 id="javacanal服务运行一段时间客户端遍历不到数据"><a class="markdownIt-Anchor" href="#javacanal服务运行一段时间客户端遍历不到数据">#</a> 【Java】canal 服务运行一段时间客户端遍历不到数据</h1>
<p>canal：阿里巴巴的一款开源中间件，用于读取数据库 binlog 日志，实时发送给客户端。</p>
<p>问题：使用 canal 后运行一段时间，客户端一直轮询，但是 batchId 始终为 - 1，手动改动数据库数据后，仍然还是获取不到。</p>
<p>1.canal 服务读取出错了<br>
检查 canal 日志关键是 logs\example 下的，看是否由报错提示，如报错列不匹配，或者类型转换异常等，可能是你修改了表结构导致，直接配置 tsdb 数据库，然后删除 meta.dat 缓存即可。可参考上一篇文章</p>
<p>2.canal 读取的 binlog 已被删除<br>
这里首先要介绍 meta.data<br>
 位置位于 conf\example 下</p>
<p>{“clientDatas”:[{“clientIdentity”:{“clientId”:1001,“destination”:“example”,“filter”:&quot;.<em>\…</em>&quot;},“cursor”:{“identity”:{“slaveId”:-1,“sourceAddress”:{“address”:“<a target="_blank" rel="noopener" href="http://rm-m5epj85txc6175on5zo.mysql.rds.aliyuncs.com">rm-m5epj85txc6175on5zo.mysql.rds.aliyuncs.com</a>”,“port”:3306}},“postion”:{“gtid”:&quot;&quot;,“included”:false,“journalName”:“mysql-bin.002943”,“position”:151295060,“serverId”:1430559368,“timestamp”:1627023747000}}}],“destination”:“example”}。</p>
<p>这个主要是用来记录 binlog 读取位置的。<br>
首先我们找到 journalName，对应的是 master 数据库 binlog 日志文件名。<br>
position 为读取到 binlog 的位置。<br>
而数据库的 binlog 会随着运行越来越多，所以它会自动删除之前的 binlog 日志。</p>
<p>然后去数据库执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master logs</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/084f87d796084db38bc9f90440fe7005.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI3Mjc1ODUx,size_16,color_FFFFFF,t_70" alt="数据库binlog"></p>
<p>log_name 则为现有的 binlog 日志，查找 binlog 是否和 meta.dat 里面记录的一致，若 meta.data 记录的 binlog 不在里面，则表示已被删除。<br>
可将 journalName 值改为现有的 binlog 日志，然后把 position 置为 4</p>
<p>为什么 canal 读取的 binlog 会被删除呢<br>
 1. 手动删除，服务器磁盘容易满，所以偶尔会有人手动删除 binlog 文件。</p>
<p>2.client 端报错，客户端读取到 canal 发过来的数据后进行处理，若处理出错，程序在逻辑上没有 ack 此 batchId，而是去反复执行，那么 client 端会一直执行此条 batchId 数据，此时后面数据会进入 client，而在后面的 batchid 数据进来后会报 canal 的错误，batchId ***，大致意思就是执行的前面的 batchId 发现后面的 batchid 了，然后 canal 就卡在这了，不在读取后面的 binlog，当后面的 binlog 被删除后，就和数据库的 binlog 对应不上了</p>
<p>首先要检查 client 端是否有报错，然后检查 canal 服务是否有报错，在检查 binlog 是否一致，若不一致再分析原因</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.386Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:40:46.795Z" title="2023-3-21 15:40:46">2023-03-21</time>更新</span><span class="level-item">34 分钟读完 (大约5148个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Java%E3%80%91Elastic%20canal%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E5%88%B0ES%E9%85%8D%E7%BD%AE%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99/">【Java】Elastic canal数据同步到ES配置常见报错</a></p><div class="content"><h1 id="javaelastic-canal数据同步到es配置常见报错"><a class="markdownIt-Anchor" href="#javaelastic-canal数据同步到es配置常见报错">#</a> 【Java】Elastic canal 数据同步到 ES 配置常见报错</h1>
<h1 id="0-引言"><a class="markdownIt-Anchor" href="#0-引言">#</a> 0. 引言</h1>
<p>所有报错均为博主在实操过程中遇到的错误和解决办法，如果有其他报错或者不同的解决办法，请留言告诉我</p>
<p>安装<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=canal&amp;spm=1001.2101.3001.7020"> canal</a> 过程中遇到问题，先在本文中查询是否有相同报错，将会为你节约大量排错时间</p>
<h2 id="环境"><a class="markdownIt-Anchor" href="#环境">#</a> 环境</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdk1.8</span><br><span class="line">canal 1.1.5</span><br><span class="line">mysql8.0</span><br><span class="line">es7.13.0</span><br></pre></td></tr></table></figure>
<h1 id="1-unknown-system-variable-query_cache_size"><a class="markdownIt-Anchor" href="#1-unknown-system-variable-query_cache_size">#</a> 1. Unknown system variable ‘query_cache_size’</h1>
<p>这是因为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql%E9%A9%B1%E5%8A%A8&amp;spm=1001.2101.3001.7020"> mysql 驱动</a>包的版本过低导致的，query cache 在 MySQL5.7.20 就已经过时了，而在 MySQL8.0 之后就已经被移除了</p>
<p>1、只需要将 lib 中的驱动器替换成 mysql-connector-java-8.0.22.jar</p>
<p>2、修改驱动器权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 lib/mysql-connector-java-8.0.22.jar</span><br><span class="line">chmod +st lib/mysql-connector-java-8.0.22.jar</span><br></pre></td></tr></table></figure>
<p>查看权限如图所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll lib</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/fb4993202deb4227a295dc8ffcfffafb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h1 id="2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring"><a class="markdownIt-Anchor" href="#2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring">#</a> 2. Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</h1>
<p>启动 canal-adapter 报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf.canal-adapters[0].groups[0].outer-adapters[1].properties&#x27; to java.util.Map&lt;java.lang.String, java.lang.String&gt;:</span><br><span class="line"></span><br><span class="line">    Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</span><br></pre></td></tr></table></figure>
<p>解决：<br>
观察报错信息可以得知是配置文件中的 outer2（0 基，所以 outer-adapter [1] 实际指的是 2）的 properties 配置有问题，我们观察配置文件，发现是 properties 下的 mode,cluster.name 等属性与 properties 同级了，将其如下图所示后退两字符即可。<br>
<img src="https://img-blog.csdnimg.cn/f5384eaf97234881bba9b3c8bcd663da.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="配置"></p>
<h1 id="3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx"><a class="markdownIt-Anchor" href="#3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx">#</a> 3. RuntimeException: java.lang.RuntimeException: No data source found: xxxx</h1>
<p>这个因为在 conf/es/xxx.yml 中配置的 dataSourceKey 并没有在 conf/application.yml 中的 srcDataSources 中维护</p>
<p>如下图所示，es 中的 dataSourceKey 需要在 applicaiton.yml 中设置，默认是 defaultDS<br>
<img src="https://img-blog.csdnimg.cn/14dacccf628d44e7b6f67c52bccdb93e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/5e57dd86bcb8417e9e7eda2a6d014956.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<h1 id="4-reason-unable-to-set-value-for-property-src-data-sources"><a class="markdownIt-Anchor" href="#4-reason-unable-to-set-value-for-property-src-data-sources">#</a> 4. Reason: Unable to set value for property src-data-sources</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf&#x27; to com.alibaba.otter.canal.adapter.launcher.config.AdapterCanalConfig:</span><br><span class="line"></span><br><span class="line">    Reason: Unable to set value for property src-data-sources</span><br></pre></td></tr></table></figure>
<p>原因一：<br>
mysql 驱动器导致的问题，使用的数据库是 8.x。驱动器是 5.x 的，将 mysql 驱动替换为 8.0.x 版本的。如上所示报错 1</p>
<p>原因二：<br>
检查该报错前的日志，是否有其他相关报错信息，比如无相关数据库，如下所示，根据其报错内容来检查配置项并且调整即可<br>
<img src="https://img-blog.csdnimg.cn/fbf719ab834648f9adfa37c65e402d71.png" alt="在这里插入图片描述"></p>
<h1 id="5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts"><a class="markdownIt-Anchor" href="#5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts">#</a> 5. java.sql.SQLException: null, message from server: “Host ‘172.16.188.2’ is blocked because of many connection errors; unblock with ‘mysqladmin flush-hosts’”</h1>
<p>同一个 ip 在短时间内产生太多中断的数据库连接而导致的阻塞</p>
<p>登录对应的 mysql，执行如下指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush hosts;</span><br></pre></td></tr></table></figure>
<h1 id="6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found"><a class="markdownIt-Anchor" href="#6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found">#</a> 6. IllegalStateException: Extension instance(name: es7, class: interface com.alibaba.otter.canal.client.adapter.OuterAdapter) could not be instantiated: class could not be found</h1>
<p>一般 <code> could not be instantiated: class could not be found</code>  这样的报错是配置文件的问题，如上的报错可以看到是 name: es7 中的错误，在官方的示例文档中使用的是 <code>name: es6 # or es7</code> 。</p>
<p>在 canal1.1.5 + 版本中设置的是 name: es6 # 或者 es7</p>
<p>但在 1.1.4 版本中直接使用 <code>name: es</code>  即可</p>
<h1 id="7-illegalargumentexception-not-found-the-mapping-info-of-index-user"><a class="markdownIt-Anchor" href="#7-illegalargumentexception-not-found-the-mapping-info-of-index-user">#</a> 7. IllegalArgumentException: Not found the mapping info of index: user</h1>
<p>1、这个报错是 ES 的 mapping 设置的问题，确保 es 中有该索引，并且确认是否有部分字段没有在 es 中设置 mapping, 这个要对应之前设置的 sql，以及 es 中的 mappings 来解决</p>
<p>2、使用了 elasticsearch 7.x，但 adapter1.1.4 默认支持 es6.x<br>
 解决方案：<br>
（1）修改 adapter 源码，将 es 依赖调整为 7.x；参考博客<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/355162399"> adapter1.1.4 修改源码支持 es7.x</a><br>
（2）换成 adapter1.1.5</p>
<h1 id="8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200"><a class="markdownIt-Anchor" href="#8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200">#</a> 8. IllegalArgumentException: Illegal character in scheme name at index 0: 172.16.188.7:9200</h1>
<p>如果连接 es 使用的是 rest 方式，那么 hosts 中的 ip 前要添加 <code>http://</code> ，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hosts: http://172.16.188.7:9200</span><br></pre></td></tr></table></figure>
<h1 id="9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource"><a class="markdownIt-Anchor" href="#9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource">#</a> 9. com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassCastException: com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.init(ES7xAdapter.java:54) ~[client-adapter.es7x-1.1.5-jar-with-dependencies.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.loadAdapter(CanalAdapterLoader.java:225) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.init(CanalAdapterLoader.java:56) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterService.init(CanalAdapterService.java:60) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_271]</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_271]</span><br></pre></td></tr></table></figure>
<p>原因：<br>
druid 包冲突<br>
解决：<br>
1、修改 client-adapter/escore/pom.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;!--add by whx 20220112--&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>2、重新打包<br>
<img src="https://img-blog.csdnimg.cn/dfe52cef447444469af1020bf5328ef5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
 3、将 client-adapter/es7x/target/client-adapter.es7x-1.1.5-jar-with-dependencies.jar 上传到服务器，替换 adataper/plugin 下的同名 jar 文件<br>
<img src="https://img-blog.csdnimg.cn/eb3b4b46f8ab47d391244904ecb6e89e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp client-adapter.es7x-1.1.5-jar-with-dependencies.jar root@172.16.188.2:/var/local</span><br></pre></td></tr></table></figure>
<p>4、给该文件赋权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/local/client-adapter.es7x-1.1.5-jar-with-dependencies.jar </span><br></pre></td></tr></table></figure>
<p>5、重启服务</p>
<h4 id="10-canalparseexception-javaioioexception-eof-encountered"><a class="markdownIt-Anchor" href="#10-canalparseexception-javaioioexception-eof-encountered">#</a> 10 CanalParseException: java.io.IOException: EOF encountered</h4>
<p>将 lib 目录下的 mysql 驱动器替换为<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql8&amp;spm=1001.2101.3001.7020"> mysql8</a>.0，并附权。参考上述</p>
<h1 id="11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack"><a class="markdownIt-Anchor" href="#11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack">#</a> 11. CanalClientException: java.io.IOException: Broken pipe Error sync but ACK</h1>
<p>服务连接断开了，将 deployer 和 adapter 都关闭，先启动 deployer 再启动 adapter</p>
<h1 id="12-documentmissingexception_doc1413298413755211778-document-missing"><a class="markdownIt-Anchor" href="#12-documentmissingexception_doc1413298413755211778-document-missing">#</a> 12. DocumentMissingException[[_doc][1413298413755211778]: document missing]</h1>
<p>1、es 集群出现问题，导致 doc 无法分配。常见的是分片数的问题，可能是副本分片过多，导致集群报黄<br>
解决：<br>
因为我的是 es 单节点，所以将主分片数设置为 1，副本分片设置为 0。不申明的话默认创建副本分片数为 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">PUT user</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;code&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;email&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;realName&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;roleId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;postId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;deptId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_replicas&quot;: 0,</span><br><span class="line">    &quot;number_of_shards&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、修改的 mysql 数据库数据，在 es 中不存在。先进行全量同步，再进行增量同步</p>
<p>在 conf/example/instance.properties 中修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 全量同步</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 上一次更新的时间</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception"><a class="markdownIt-Anchor" href="#13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception">#</a> 13. ERROR c.a.otter.canal.server.netty.handler.SessionHandler - something goes wrong with channel:[id: 0x23d9cad9, /127.0.0.1:46472 :&gt; /127.0.0.1:11111], exception=java.nio.channels.ClosedChannelException</h1>
<p>这是由于 deployer 中的 conf/example/meta.dat 与 instance.properties 文件中的 journalName,position,timestamp 不一致导致的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查询bin log位置</span><br><span class="line">show master status;</span><br><span class="line"># 如果显示的binlog不为000001可以执行以下语句重置binlog（轻易别操作，最好让专业的运维人员操作）</span><br><span class="line"># 该操作会重新生成binlog，之前的binlog就会清空，之前的数据就不会再同步</span><br><span class="line">reset master;</span><br><span class="line"># 刷新log日志，自此刻开始产生一个新编号的binlog日志文件</span><br><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/849d7b41b8c348dead0670db96717068.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="在这里插入图片描述"><br>
将 meta.dat 删除或者修改一致即可。删除后将会按照 instance.properties 中设置的起点同步，生产环境考虑好需要后再删除。</p>
<p>如果想要将之前的数据也同步的话，可以将数据库先导出，再重新导入一遍，即可重新生成 binlog，实现数据的全量同步</p>
<h1 id="14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 14. Received error packet: errno = 1236, sqlstate = HY000 errmsg = Could not find first log file name in binary log index file</h1>
<p>mysql bin log 数据不同步，刷新一下即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<h1 id="15-binlog也设置为000001了timestamp也设置了但就是无法实现全量同步"><a class="markdownIt-Anchor" href="#15-binlog也设置为000001了timestamp也设置了但就是无法实现全量同步">#</a> 15. binlog 也设置为 000001 了，timestamp 也设置了，但就是无法实现全量同步</h1>
<p>1、删除 conf/example/meta.dat<br>
2、调整 conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 上一次更新的时间</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<p>3、重启 deployer</p>
<p>另外需要注意的是如果 bin log 是只会记录增量操作的，也就是说开启 bin log 之前的历史数据是不会记录的，如果需要同步者之前的数据，解决这个问题有三个办法：<br>
（1）<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_24950043/article/details/122483061">通过 logstash-input-jdbc 来实现</a><br>
（2）通过业务代码来实现（后续会详细讲解这两种方式，可以关注我后续的博客）<br>
（3）复制原数据库数据到开启了 binlog 的从数据库，然后从从数据库同步</p>
<h1 id="16-adapter启动报错something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null"><a class="markdownIt-Anchor" href="#16-adapter启动报错something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null">#</a> 16. adapter 启动报错：something goes wrong when starting up the canal client adapters: java.lang.NullPointerException: null</h1>
<p>这个报错是空指针报错，很明显是哪里获取为空的，这种错误没有固定的原因，但大概率上可以锁定配置文件的问题</p>
<p>1、adapter 的配置文件中是有包含了 mysql、es、mq、zk 等配置，如果不需要的配置项，就将其注释掉，不要打开</p>
<p>比如我这里的报错原因就是因为打开了 zookeeperHosts，但是没有配置具体值，所以导致了空指针，因为我不需要 zk，将其注释掉即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># flatMessage: true</span><br><span class="line"># zookeeperHosts:</span><br></pre></td></tr></table></figure>
<p>2、某些必要的配置没有设置，快速排查的方式就是根据官方文档中给出的配置文件对比排错<br>
可以参考如下配置文件</p>
<p>3、配置文件中配置项排版错位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br><span class="line">    time-zone: GMT+8</span><br><span class="line">    default-property-inclusion: non_null</span><br><span class="line"></span><br><span class="line">canal.conf:</span><br><span class="line">  mode: tcp #tcp kafka rocketMQ rabbitMQ</span><br><span class="line">  flatMessage: true</span><br><span class="line">  zookeeperHosts:</span><br><span class="line">  syncBatchSize: 1000</span><br><span class="line">  retries: 0</span><br><span class="line">  timeout:</span><br><span class="line">  accessKey:</span><br><span class="line">  secretKey:</span><br><span class="line">  consumerProperties:</span><br><span class="line">    # canal tcp consumer</span><br><span class="line">    canal.tcp.server.host: 127.0.0.1:11111</span><br><span class="line">    canal.tcp.zookeeper.hosts:</span><br><span class="line">    canal.tcp.batch.size: 500</span><br><span class="line">    canal.tcp.username:</span><br><span class="line">    canal.tcp.password:</span><br><span class="line">    # kafka consumer</span><br><span class="line">    kafka.bootstrap.servers: 127.0.0.1:9092</span><br><span class="line">    kafka.enable.auto.commit: false</span><br><span class="line">    kafka.auto.commit.interval.ms: 1000</span><br><span class="line">    kafka.auto.offset.reset: latest</span><br><span class="line">    kafka.request.timeout.ms: 40000</span><br><span class="line">    kafka.session.timeout.ms: 30000</span><br><span class="line">    kafka.isolation.level: read_committed</span><br><span class="line">    kafka.max.poll.records: 1000</span><br><span class="line">    # rocketMQ consumer</span><br><span class="line">    rocketmq.namespace:</span><br><span class="line">    rocketmq.namesrv.addr: 127.0.0.1:9876</span><br><span class="line">    rocketmq.batch.size: 1000</span><br><span class="line">    rocketmq.enable.message.trace: false</span><br><span class="line">    rocketmq.customized.trace.topic:</span><br><span class="line">    rocketmq.access.channel:</span><br><span class="line">    rocketmq.subscribe.filter:</span><br><span class="line">    # rabbitMQ consumer</span><br><span class="line">    rabbitmq.host:</span><br><span class="line">    rabbitmq.virtual.host:</span><br><span class="line">    rabbitmq.username:</span><br><span class="line">    rabbitmq.password:</span><br><span class="line">    rabbitmq.resource.ownerId:</span><br><span class="line">  srcDataSources:</span><br><span class="line">    defaultDS:</span><br><span class="line">      url: jdbc:mysql://172.16.188.1:3306/bladex?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">  canalAdapters:</span><br><span class="line">  - instance: example # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g1</span><br><span class="line">      outerAdapters:</span><br><span class="line">      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        hosts: http://172.16.188.7:9200 # 集群地址，逗号隔开. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          # security.auth: test:123456 #  only used for rest mode</span><br><span class="line">          cluster.name: cluster1</span><br></pre></td></tr></table></figure>
<h1 id="17-field-error-in-object-target-on-field-esmapping-rejected-value"><a class="markdownIt-Anchor" href="#17-field-error-in-object-target-on-field-esmapping-rejected-value">#</a> 17 Field error in object ‘target’ on field ‘esMapping’: rejected value [];</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Field error in object &#x27;target&#x27; on field &#x27;esMapping&#x27;: rejected value []; codes </span><br><span class="line">[typeMismatch.target.esMapping,typeMismatch.esMapping,typeMismatch.com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping,typeMismatch]; </span><br><span class="line">arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [target.esMapping,esMapping]; arguments []; default message [esMapping]]; default message [Failed to convert property value of type &#x27;java.lang.String&#x27; to required type </span><br><span class="line">&#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;; nested </span><br><span class="line">exception is java.lang.IllegalStateException: Cannot convert value of type &#x27;java.lang.String&#x27; to required type</span><br><span class="line"> &#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;: no </span><br><span class="line"> matching editors or conversion strategy found]</span><br></pre></td></tr></table></figure>
<p>这是配置文件问题，检查 es 下的配置 yml 文件，特别是 sql 语句的语法是否有问题</p>
<h1 id="18-javautilnosuchelementexception"><a class="markdownIt-Anchor" href="#18-javautilnosuchelementexception">#</a> 18 java.util.NoSuchElementException</h1>
<p>没有找到对应字段导致</p>
<p>检查下 canal 配置文件中的字段是否在 es mapping 中有对应的，大小写是否一致，是否有遗漏</p>
<p>因为我的操作是 mysql 同步至 es，所以这里说明几项容易出错的地方：<br>
1、canal 配置文件中的 sql 中是否大小写一致，canal 是区分大小写的<br>
 2、sql 中设置的别名是否与 es mappings 中的名称一致，允许 es 中的部分字段为空，但是不允许 sql 中查询出来的字段在 es mappings 中找不到对应的字段<br>
 3、canal 配置文件中的 dataSourceKey 是否正确，其对应到 canal application.yml 配置文件中的数据库是否正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa</span><br></pre></td></tr></table></figure>
<p>application.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">srcDataSources:</span><br><span class="line">    aaa: # 与之对应</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/aaa?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    xxx:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/xxx?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    yyy:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/yyy?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br></pre></td></tr></table></figure>
<p>4、canal 配置文件中的排版是否正确，特别注意_index,_type 等属性要放在 esMappings 下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # 这里的key与上述application.yml中配置的数据源保持一致</span><br><span class="line">outerAdapterKey: esKey # 与上述application.yml中配置的outerAdapters.key一直</span><br><span class="line">destination: example # 默认为example,与application.yml中配置的instance保持一致</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: dept </span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id,</span><br><span class="line">        t.id as _id,</span><br><span class="line">        t.dept_name as deptName,</span><br><span class="line">        t.dept_category as deptCategory,</span><br><span class="line">        t.parent_id as parentId,</span><br><span class="line">        t.ancestors as ancestors,</span><br><span class="line">        t.third_party_id as thirdPartyId,</span><br><span class="line">        t.phone as phone,</span><br><span class="line">        t.address as address,</span><br><span class="line">        t.is_deleted as isDeleted</span><br><span class="line">      from</span><br><span class="line">         dept t&quot;</span><br><span class="line">  #etlCondition: &quot;where t.update_time&gt;=&#x27;&#123;0&#125;&#x27;&quot;</span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>5、sql 查询出来的字段类型与 es mappings 中的字段数据类型是否一致</p>
<p>6、多表同步到同一个索引时，如果都有同一个常量列且值不同时会报错。<br>
如下所示的两个配置文件都有 userSource 常量列用于区分不同的数据来源，但是如下的配置会报错。<br>
xxx.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # 这里的key与上述application.yml中配置的数据源保持一致</span><br><span class="line">outerAdapterKey: esKey # 与上述application.yml中配置的outerAdapters.key一直</span><br><span class="line">destination: example # 默认为example,与application.yml中配置的instance保持一致</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        0 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>yyy.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # 这里的key与上述application.yml中配置的数据源保持一致</span><br><span class="line">outerAdapterKey: esKey # 与上述application.yml中配置的outerAdapters.key一直</span><br><span class="line">destination: example # 默认为example,与application.yml中配置的instance保持一致</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        1 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user_wx t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<h1 id="19-adapter日志中没有报错但是没有读取binlog-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#19-adapter日志中没有报错但是没有读取binlog-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 19. adapter 日志中没有报错，但是没有读取 binlog ｜ Could not find first log file name in binary log index file</h1>
<p>adapter 日志中没有报错信息，于是去查看 deployer 日志，这里的 example 是你配置的实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat logs/example/example.log</span><br></pre></td></tr></table></figure>
<p>会发现报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not find first log file name in binary log index file</span><br></pre></td></tr></table></figure>
<p>解决：<br>
1、既然问题是没有找到数据库的 binglog 文件位置，那么就查看一下现在的 binlog 文件位置，登陆 mysql 执行</p>
<p>2.1 如果你是做增量同步，那么查询当前 binlog 位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="在这里插入图片描述"><br>
修改 conf/example/instance.properties 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># 这里的文件名要与上面的保持一致，我这里就是文件名不一致，写成了mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000003 </span><br><span class="line">canal.instance.master.position=5921</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>2.2 如果你要做全量同步，查询 binlog 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binary logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/b4736c68b0f64b80bb509d395a627fb1.png" alt="在这里插入图片描述"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># 这里的文件名要与上面的保持一致，我这里就是文件名不一致，写成了mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000001</span><br><span class="line"># 位置从0开始</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>3、重启 deployer 和 adapter</p>
<h1 id="20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception"><a class="markdownIt-Anchor" href="#20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception">#</a> 20. ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</h1>
<p>启动 adapter 报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 06:28:44.444 [pool-2-thread-1] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</span><br><span class="line">java.lang.RuntimeException: java.lang.NullPointerException</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:116) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:64) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:115) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:94) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.batchSync(AdapterProcessor.java:139) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$1(AdapterProcessor.java:97) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.CopyOnWriteArrayList.forEach(CopyOnWriteArrayList.java:895) ~[na:1.8.0_312]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$2(AdapterProcessor.java:94) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[na:1.8.0_312]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_312]</span><br><span class="line">Caused by: java.lang.NullPointerException: null</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es7x.support.ES7xTemplate.insert(ES7xTemplate.java:79) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.singleTableSimpleFiledInsert(ESSyncService.java:448) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.insert(ESSyncService.java:139) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:99) ~[na:na]</span><br><span class="line">        ... 11 common frames omitted</span><br><span class="line">2022-05-21 06:28:44.449 [Thread-4] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - Outer adapter sync failed!  Error sync but ACK!</span><br></pre></td></tr></table></figure>
<p>解决：<br>
1、修改 adapter/application.yml，给 outerAdapters 配置一个 key，注意这里如果有多个 adapter 实例，那么就配置不同的 key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">canalAdapters:</span><br><span class="line">  - instance: test # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g2</span><br><span class="line">      outerAdapters:</span><br><span class="line">#      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey3 # 配置key</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        #hosts: http://192.168.101.11:9200 # 集群地址，逗号隔开. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        hosts: http://192.168.244.11:9200 # 集群地址，逗号隔开. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          security.auth: elastic:elastic #  only used for rest mode</span><br><span class="line">          cluster.name: blade-cluster</span><br></pre></td></tr></table></figure>
<h1 id="21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table"><a class="markdownIt-Anchor" href="#21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table">#</a> 21. CanalParseException: parse row data failed. | column size is not match for table</h1>
<p>deployser 日志报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 07:45:15.651 [MultiStageCoprocessor-Parser-fleet-0] ERROR com.alibaba.otter.canal.common.utils.NamedThreadFactory - from MultiStageCoprocessor-Parser-fleet-0</span><br><span class="line">com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>解决：<br>
1、可以看到报错中已经给出明确提示了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>2、该错误官方中有解释<br>
<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/TableMetaTSDB">官方文档 TableMetaTSDB</a><br>
 在 instance.properties 中设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.tsdb.spring.xml=classpath:spring/tsdb/h2-tsdb.xml</span><br><span class="line"># table meta tsdb info</span><br><span class="line">canal.instance.tsdb.enable=true</span><br><span class="line"># 以下配置不用开启，因为在canal.properties中已经设置过了，只要没有手动关闭过就不用再配置了</span><br><span class="line">#canal.instance.tsdb.dir=$&#123;canal.file.data.dir:../conf&#125;/$&#123;canal.instance.destination:&#125;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;/h2;CACHE_SIZE=1000;MODE=MYSQL;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb</span><br><span class="line">#canal.instance.tsdb.dbUsername=canal</span><br><span class="line">#canal.instance.tsdb.dbPassword=canal</span><br></pre></td></tr></table></figure>
<p>3、一般将这个开启就解决了，但是我这里即时将其开启还是报错，查阅相关资料有说将 <code>canal.instance.tsdb.enable</code>  设置为 false 后重启解决的，但是我这里将其设置为 false 后依旧没有解决</p>
<p>实在没有其他办法了，查阅官方 github，导致这个问题发生的原因是因为表结构发生过变化，但是 binlog 中读取到的与现在的表结构不一致导致。</p>
<p>于是直接跳过该 binlog checkpoint，也就是将 binlog 的读取位置设置为当前的最新 binlog 位置</p>
<p>（1）查阅当前 binlog 最新位置，mysql 中执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="在这里插入图片描述"><br>
（2）将读取位置该为最新，修改 deployer conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=162.14.99.4:3306</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000002</span><br><span class="line">canal.instance.master.position=226586328</span><br><span class="line"># 当前时间的时间戳形式</span><br><span class="line">canal.instance.master.timestamp=1653140932</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>（3）重启 deployer , adapter<br>
（4）因为读取的是最新的 binlog。为了把当前的数据同步进来，将需要同步的表或库导出，然后再导入一遍。问题解决（注意：这里的解决方案要谨慎，生产环境因为时时刻刻在产生数据，可行性很低，所以看要么设置一个停机维护来进行实操）</p>
<h1 id="22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0"><a class="markdownIt-Anchor" href="#22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0">#</a> 22. use gtid and TableMeta TSDB should be config timestamp &gt; 0</h1>
<p>在 instance.properties 中设置时间戳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string"><a class="markdownIt-Anchor" href="#23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string">#</a> 23. RuntimeException: com.alibaba.fastjson.JSONException: unclosed string</h1>
<p>该错误是因为 sql 中使用了 <code>group_concat</code>  函数，但是该函数默认长度是 1024，超过的会被截取，导致出现了 json 格式的数据格式不正确，没有正确的关闭 json</p>
<p>解决：<br>
1、修改 my.cnf，扩大 group_concat_max_len</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat_max_len = 102400</span><br></pre></td></tr></table></figure>
<p>2、重启 mysql</p>
<h1 id="24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause"><a class="markdownIt-Anchor" href="#24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause">#</a> 24. MySQLSyntaxErrorException: Unknown column ‘_v._id’ in ‘where clause’</h1>
<p>sql 中没有 <code>_id</code>  字段导致，使用 as 将 id 命名别名： <code>select id as _id</code></p>
<h1 id="25-adapter中有同步日志打印但es中数据未同步"><a class="markdownIt-Anchor" href="#25-adapter中有同步日志打印但es中数据未同步">#</a> 25. adapter 中有同步日志打印，但 es 中数据未同步</h1>
<p>我这里出现这个问题是在 canal1.1.6 版本中，原因是 es7 文件夹中的 <code>.yml</code>  文件中书写的 sql 里使用了 `` 将表名括起来，导致未识别，如下所示</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name,age <span class="keyword">from</span> `<span class="keyword">user</span>`</span><br></pre></td></tr></table></figure>
<p>解决：<br>
将 `` 去掉即可</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.383Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:36:51.142Z" title="2023-3-21 15:36:51">2023-03-21</time>更新</span><span class="level-item">11 分钟读完 (大约1692个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Flutter%E3%80%91flutter%E5%8F%91%E5%B1%95%E5%89%8D%E6%99%AF%E5%A6%82%E4%BD%95%EF%BC%9F/">【Flutter】flutter发展前景如何？</a></p><div class="content"><p><img src="https://pic1.zhimg.com/80/v2-184c74e7aa102e484165122bb5cec4bd_720w.webp?source=1940ef5c" alt="img"></p>
<blockquote>
<p>在 <strong>Flutter</strong> 刚刚从 <strong>Google</strong> 刚刚推向 <strong>Android</strong> 市场的时候，我就开始对 <strong>Flutter</strong> 开始了<strong>学习之路</strong>；但由于当时 <strong>Flutter</strong> 许多东西<strong>尚未完善</strong>而没有推出<strong>稳定的版本</strong>，所以也就没有对其进行<strong>深入</strong>的学习，直到如今 <strong>Flutter</strong> 又<strong>重出江湖</strong>，在<strong>市场</strong>上也得到<strong>了蓬勃发展</strong>及许多业内<strong>大佬</strong>的<strong>力推</strong>，我便又再次<strong>入坑 Flutter</strong></p>
</blockquote>
<p><strong>实现 UI 和交互</strong>是<strong>高级开发者</strong>的<strong>必备技能</strong>，也是<strong>掌握 Flutter 开发</strong>的<strong>重点</strong>；同样 <strong>Flutter</strong> <strong>跨平台</strong>的<strong>特性</strong>是<strong>原生</strong>不能比拟的，更何况还有不弱的<strong>性能</strong>表现；而<strong>性能</strong>往往是由<strong>生命周期</strong>来决定的</p>
<h3 id="何为-flutter-的生命周期"><a class="markdownIt-Anchor" href="#何为-flutter-的生命周期">#</a> <strong>何为 Flutter 的生命周期？</strong></h3>
<p>如果你是一名<strong>开发</strong>人员，那么你一定不会对<strong>生命周期</strong>感到陌生；当你在学习 <strong>Flutter</strong> 的时候，<strong>Flutter 也有自己的生命周期</strong>，只有通过了解 <strong>Flutter</strong> 的<strong>生命周期</strong>，才能知道应该在哪里来写<strong>业务逻辑</strong></p>
<h3 id="flutter-生命周期"><a class="markdownIt-Anchor" href="#flutter-生命周期">#</a> <strong>Flutter 生命周期</strong></h3>
<p><img src="https://picx.zhimg.com/80/v2-6ae547ee1a88db89634eb9c6567146d8_720w.webp?source=1940ef5c" alt="img"></p>
<p>如上图所示，<strong>Flutter 生命周期</strong>大体上可以分为<strong>三个阶段：</strong> <strong>初始化、状态变化、销毁</strong>；下面依次说明各个阶段的工作</p>
<p><strong>初始化阶段</strong>（插入<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%B8%B2%E6%9F%93%E6%A0%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">渲染树</a>）</p>
<ul>
<li>对应执行构造方法和 initState</li>
</ul>
<p><strong>状态变化阶段</strong>（在渲染树中存在）</p>
<ul>
<li>开新的 widget 或者调用 setState 方法</li>
</ul>
<p><strong>销毁阶段</strong>（从渲染树种移除）</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=deactivate&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">deactivate</a> 和 dispose</li>
</ul>
<p>如果之前你对 <strong>Flutter</strong> 有一点点了解的话，你会发现 <strong>Flutter</strong> 中有<strong>两个</strong>主要的 <strong>Widget：</strong> <strong>StatelessWidget（无状态）</strong> 和 <strong>StatefulWidget（有状态）</strong></p>
<h3 id="statelesswidget"><a class="markdownIt-Anchor" href="#statelesswidget">#</a> <strong>StatelessWidget</strong></h3>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%97%A0%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">无状态组件</a>] 是不可变的</strong>，这意味着它们的<strong>属性不能变化</strong>，所有的值都是最终的；可以理解为将<strong>外部传入的数据转化为界面展示的内容，只会渲染一次</strong></li>
<li><strong>对于无状态组件生命周期只有 build 这个过程</strong>；无状态组件的构建方法通常只在三种情况下会被调用：<strong>小组件第一次被插入树中，小组件的父组件改变其配置，以及它所依赖的 InheritedWidget 发生变化时</strong></li>
</ul>
<h3 id="statefulwidget"><a class="markdownIt-Anchor" href="#statefulwidget">#</a> <strong>StatefulWidget</strong></h3>
<ul>
<li>有状态组件持有的状态可能在 Widget 生命周期中发生变化，是定义<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%BA%A4%E4%BA%92%E9%80%BB%E8%BE%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">交互逻辑</a>和业务逻辑；可以理解为具有动态可交互的内容界面，会根据数据的变化进行多次渲染</li>
</ul>
<h3 id="实现一个-statefulwidget-至少需要两个类"><a class="markdownIt-Anchor" href="#实现一个-statefulwidget-至少需要两个类">#</a> <strong>实现一个 StatefulWidget 至少需要两个类：</strong></h3>
<p><strong>一个是 StatefulWidget 类</strong> <strong>另一个是 Sate 类</strong></p>
<ul>
<li><strong>StatefulWidget 类本身是不可变的</strong>，但是 <strong>State 类</strong>在 <strong>Widget 生命周期中始终存在</strong></li>
<li><strong>StatefulWidget</strong> 将其<strong>可变</strong>的<strong>状态存储</strong>在由 <strong>createState</strong> 方法创建的 <strong>State</strong> 对象中，或者存储在该 <strong>State 订阅</strong>的对象中</li>
</ul>
<h3 id="fultter-的优势在哪里"><a class="markdownIt-Anchor" href="#fultter-的优势在哪里">#</a> <strong>Fultter 的优势在哪里？</strong></h3>
<h3 id="快速开发和迭代"><a class="markdownIt-Anchor" href="#快速开发和迭代">#</a> <strong>快速开发和迭代</strong></h3>
<p><strong>Flutter 自身具有热修复（<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%83%AD%E9%87%8D%E8%BD%BD&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">热重载</a>）<strong>的功能，尽管有使用的限制，但是它依然能够为</strong>开发过程</strong>提供<strong>更高的效率</strong>；另外，<strong>Flutter SDK</strong> 还允许我们<strong>修复崩溃</strong>和继续从<strong>应用程序</strong>停止的地方进行<strong>调试</strong></p>
<h3 id="页面流畅-样式美观"><a class="markdownIt-Anchor" href="#页面流畅-样式美观">#</a> <strong>页面流畅、样式美观</strong></h3>
<p><strong>对于不同的平台（Android 和 iOS）</strong>，<strong>Flutter</strong> 提供了<strong>风格不同</strong>的<strong>控件</strong>，以<strong>满足不同平台</strong>的<strong>设计理念</strong></p>
<h3 id="提供原生性能"><a class="markdownIt-Anchor" href="#提供原生性能">#</a> <strong>提供原生性能</strong></h3>
<p><strong>Flutter</strong> 提供了一种 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%93%8D%E5%BA%94%E5%BC%8F%E8%A7%86%E5%9B%BE&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 响应式视图</a><strong>，无须 <strong>JavaScript</strong> 做</strong>桥接 **；强大的 <strong>API</strong> 使得<strong>实现复杂的页面效果</strong>成为可能；高性能的 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 渲染机制</a> ** 使得 <strong>120 FPS 的高频率</strong> 可以轻而易举的实现；<strong>当界面上的图片数量越来越多时，与 React Native 相比，Flutter 的优势会越来越明显</strong></p>
<h3 id="灵活的跨平台开发"><a class="markdownIt-Anchor" href="#灵活的跨平台开发">#</a> <strong>灵活的跨平台开发</strong></h3>
<p><strong>Flutter</strong> 可以单独作为<strong>开发框架</strong>完成整个 <strong>App 的开发</strong>，也可以与现有<strong>原生代码</strong>相结合实现 <strong>Hybrid 混合模式的开发</strong></p>
<h3 id="那-flutter-需要学吗"><a class="markdownIt-Anchor" href="#那-flutter-需要学吗">#</a> <strong>那 Flutter 需要学吗？</strong></h3>
<p><strong>Flutter</strong> 抛弃了<strong>原生系统控件</strong>和 <strong>Webview</strong>，使用<strong>自研高性能渲染引擎</strong>来绘制 <strong>Widget</strong>，预先 (AOT) 编译，<strong>运行时直接执行 Native (arm) 代码</strong>，<strong>Dart 代码</strong>执行 (在 UI TaskRunner)，<strong>图片下载</strong> (IO TaskRunner)，<strong>真正的渲染</strong> (GPU TaskRunner) ，<strong>同平台的通信</strong>等 (Platform TaskRunner 即 <strong>Native 概念</strong>下的 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%B8%BB%E7%BA%BF%E7%A8%8B&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 主线程</a><strong>) 是</strong>互相隔离 ** 的</p>
<p>针对<strong>布局</strong>等的<strong>优</strong>化；<strong>布局</strong>计算时单次树走动即可完成；<strong>Relayout Boundary</strong> 机制：如果 <strong>Child</strong> 的 <strong>size</strong> 是<strong>固定</strong>的，那么不会因为 <strong>Child</strong> 的 <strong>Relayout</strong> 导致 <strong>Parent ReLayout</strong> 等<strong>布局优化</strong>，都让 <strong>Flutter 脱颖而出</strong></p>
<p>如上所述 <strong>Flutter</strong> 于谷歌而言，这是他们重新整理 <strong>跨平台生态环境</strong> 决心的体现，<strong>Flutter</strong> 所展现的内容，也是谷歌想拓展和维护的方向；对于长期苦恼于 <strong>跨平台</strong> 选择的广大 <strong>Android 开发者</strong> 而言，<strong>Flutter</strong> 可谓是谷歌为我们提供的 <strong>指路明灯</strong></p>
<p>以<strong>目前</strong>的<strong>开发速度</strong>，只要不出<strong>大的纰漏</strong>，<strong>按部就班</strong>的<strong>往前推进</strong>，在<strong>不久的将来</strong>， <strong>Google</strong> 一定可以把 <strong>Flutter</strong> 平台打造得非常完美，届时又会改变 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 移动开发技术</a><strong>的</strong>格局 ** 了</p>
<p>也许，<strong>Flutter</strong> 系列的<strong>部分库</strong>还没成熟到成为你<strong>工作的第一选择</strong>，但是，深入学习 <strong>Flutter</strong> 组件会为你日常的开发带来一些想法</p>
<p><strong>总的来说，Flutter</strong> 对广大开发者而言是 <strong>利远远大于弊的</strong></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.381Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:33:50.052Z" title="2023-3-21 15:33:50">2023-03-21</time>更新</span><span class="level-item">4 小时读完 (大约32793个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Go%E3%80%91Go%E8%AF%AD%E8%A8%80%E4%B8%8EJava%E8%AF%AD%E8%A8%80%E5%AF%B9%E6%AF%94/">【Go】Go语言与Java语言对比</a></p><div class="content"><h1 id="gogo语言与java语言对比"><a class="markdownIt-Anchor" href="#gogo语言与java语言对比">#</a> 【Go】Go 语言与 Java 语言对比</h1>
<h1 id="go与java"><a class="markdownIt-Anchor" href="#go与java">#</a> Go 与 Java</h1>
<h2 id="零goapi文档和中文社区网址"><a class="markdownIt-Anchor" href="#零goapi文档和中文社区网址">#</a> 零.GoApi 文档和中文社区网址</h2>
<p>Go 的中文 api 文档：<a target="_blank" rel="noopener" href="https://studygolang.com/pkgdoc">https://studygolang.com/pkgdoc</a></p>
<p>Go 中文社区网站：<a target="_blank" rel="noopener" href="https://studygolang.com/">https://studygolang.com/</a></p>
<h2 id="一关于java"><a class="markdownIt-Anchor" href="#一关于java">#</a> 一。关于 Java</h2>
<h3 id="1java的用途"><a class="markdownIt-Anchor" href="#1java的用途">#</a> 1.Java 的用途</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">	首先我们来回顾下Java的主要用途和应用场景：</span><br><span class="line">1</span><br><span class="line">	用途一：服务器后端系统开发(web后端、微服务后端支付系统、业务系统、管理后台，各种后台交互的接口服务)。</span><br><span class="line"> 	</span><br><span class="line"> 	用途二：大数据框架的底层实现和Java的API支持。(Hadoop)。</span><br><span class="line"></span><br><span class="line">	用途三：其它中间件的底层开发。(Tomcat、RocketMq、Hbase、Kafka(部分)、SpringCloud，Dubbo...)。</span><br></pre></td></tr></table></figure>
<h3 id="2java的优势和特点"><a class="markdownIt-Anchor" href="#2java的优势和特点">#</a> 2.Java 的优势和特点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">	那我们看Java语言有什么优势和特点呢？</span><br><span class="line">1</span><br><span class="line">	*.做服务端系统性能高。</span><br><span class="line"></span><br><span class="line">	*.有虚拟机，跨平台。</span><br><span class="line"></span><br><span class="line">	*.功能强大，支持的类库多，生态圈类库多，开发框架和工具更易找。</span><br><span class="line"></span><br><span class="line">	*.市场占有率高，约60%的中国程序员都是做Java相关的工作。</span><br></pre></td></tr></table></figure>
<h2 id="二关于go"><a class="markdownIt-Anchor" href="#二关于go">#</a> 二。关于 Go</h2>
<h3 id="1go的出生原因"><a class="markdownIt-Anchor" href="#1go的出生原因">#</a> 1.Go 的出生原因</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Go语言是Google内部公司大佬开发的，主要起因于Google公司有大量的C程序项目，但是开发起来效率太低，维护成本高，于是就开发了Go语言来提高效率，而且性能只是差一点。</span><br><span class="line"></span><br><span class="line">（Go是2007年开始研发，2009推出发布）</span><br></pre></td></tr></table></figure>
<h3 id="2宏观看go与java的差异"><a class="markdownIt-Anchor" href="#2宏观看go与java的差异">#</a> 2. 宏观看 Go 与 Java 的差异</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	接着，我们来看一下Go语言与Java的差异之处：</span><br><span class="line">1</span><br><span class="line">	*.无虚拟机，不跨平台(这里的平台指操作系统)(可以运行多个平台，每个平台打不同的二进制程序包)，需要打包编译成对应服务器操作系统版本(windows/linux)的可执行程序(比如windows是exe)。(注:说go跨平台的是指32位和64位相同操作系统之间的跨平台)</span><br><span class="line"></span><br><span class="line">	*.因为Go程序直接打包成操作系统可执行的文件，没有虚拟机在中间转换的一层，所以理论上执行效率会更高（理论上更高，实际情况需具体分析)。</span><br><span class="line"></span><br><span class="line">	*.相比Java的语言和代码编写风格，Go更简洁，可以用更少的代码实现同样的功能。</span><br><span class="line"></span><br><span class="line">	*.Go语言底层也是C实现的，又做了高并发的设计(Java出生时(1995)还没有多核cpu,所以他的并发支持后来添加上去的,Go(2009)出生时已经有了多核cpu的电脑，它在设计语言时就考虑了充分利用多核cpu(英特尔2005首次推出多核)的性能)，所以性能高，高并发的支持(高并发支持其中指的一个就是充分利用多核cpu的性能资源，比如go程序默认使用所有cpu(除非自己设置使用多少))也好。</span><br><span class="line"></span><br><span class="line">	*.天然的适用一些特定系统的开发，比如区块链类系统(如以太坊底层系统、以太坊上层应用程序)，云计算和容器（Docker，K8s底层都是go开发的）开发的(大公司自研运维管理项目也大多是用go做底层的开发)，网络编程(类似于java的Netty)。</span><br></pre></td></tr></table></figure>
<h3 id="3go和java的语言类型区别"><a class="markdownIt-Anchor" href="#3go和java的语言类型区别">#</a> 3.Go 和 Java 的语言类型区别</h3>
<p>计算机编程语言按照运行的方式可以分为编译型编程语言和解释型编译语言。</p>
<p>我来举一个例子，你要教别人一门沟通交流的语言，比如英语。</p>
<p>编译型的教的方式就是录 (这里的录相当于计算机中把程序编译成二进制可执行文件) 一个视频课程，语音课程，把每一句英语发音录下来，这样学生学的时候只要播放你的录音，然后跟着读就行，你只需要录制一次，学生就可以无数次听。</p>
<p>解释性的教的方式就是你亲自到学生家里给他补习，你当面教他，你读 (读相当于每次执行都重新用解释器解释一遍) 一句他学一句，</p>
<p>这样的话，你想要教他一句你必须就得先读一句，每次教都得重新一遍一遍的读。</p>
<p>这两种教学方式还有一个差别，你录 (编译) 视频语音教他，你录的英语他就只能学英语，空间环境一变，他现在要去日本，要学日语，你的视频语音教程因为已经录好了，是英语类型 (英语类型类比操作系统类型) 的，所以，你就得再录一套日语的语音教程。</p>
<p>而现场教他，你也会日语的话，你只需要读 (读相当于解释器解释) 日语给他听，让他学就行了，是不用考虑语言环境 (操作系统类型环境) 不同的问题的。</p>
<p>现在我们再来看编程语言，我们的程序执行有两种方式，一种是编译成操作系统可执行的二进制可执行程序，这样相当于编译一次，之后每次执行都不用再编译了，但是因为不同操作系统对于二进制文件的执行规范不同，不同的操作系统你要编译成不同的可执行文件。</p>
<p>解释型语言就是多了一个解释器，解释器我们可以类比为一个老师，你执行一行代码我们类比为学一句话的读音，解释器解释一句，就是老师先读一句，你跟着才能读一句，也就是解释器每解释一行代码为可运行的代码，操作系统执行一行代码，这样的话每次执行都需要解释器重新解释一遍，执行几次就得解释几次。</p>
<p>Go 是编译型的语言，运行在不同的平台需要打包成不同操作系统类型下的可执行文件。</p>
<p>Java 是半编译，半解释型语言。编译是指他的代码都会编译成 class 类型的文件，class 类型的文件只需要编译一次，可以在不同的操作系统的 Java 虚拟机上执行 ，半解释是指在 Java 虚拟机中，他还是需要一句一句的将 class 的二进制代码解释成对应操作系统可执行的代码。</p>
<h3 id="4go语言目前的主要应用场景"><a class="markdownIt-Anchor" href="#4go语言目前的主要应用场景">#</a> 4.Go 语言目前的主要应用场景</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*.和Java一样，Go语言最多的应用场景就是服务器后端系统的开发，包括Web后端，微服务后端接口。</span><br><span class="line"></span><br><span class="line">*.Go非常适用需要高性能高并发的网络编程，这里的网络编程是指不需要界面，底层只是用Socket相互传输数据的系统，类似于Java中Netty的用途。</span><br><span class="line"></span><br><span class="line">*.一些云计算容器，比如Docker，K8s，底层就是Go语言开发的，也可以用做底层自研运维项目的开发。</span><br><span class="line"></span><br><span class="line">*.一些游戏系统的开发，可以用Go语言。</span><br><span class="line"></span><br><span class="line">*.区块链的一些底层软件和一些应用软件。(区块链程序的第一开发语言)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="5现在市场上都有哪些公司在使用go语言"><a class="markdownIt-Anchor" href="#5现在市场上都有哪些公司在使用go语言">#</a> 5. 现在市场上都有哪些公司在使用 Go 语言？</h3>
<p>我们不讲虚的，直接 BOSS 直聘看哪些公司招，招的是干什么系统开发的。</p>
<p>这是腾讯的一个岗位。</p>
<p><img src="https://img-blog.csdnimg.cn/318d2012a8734cd9a294c0dc64faaeb0.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>看看岗位描述，是做互联网保险 产品的业务系统开发，业务系统是啥意思，和 JAVA 后端业务系统一样啊，说明腾讯的一部分项目已经用 Go 来开发业务系统了， 至少他这个保险团队是这样的。</p>
<p><img src="https://img-blog.csdnimg.cn/5dd2275e8d24456ab66238864b55da81.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>再看小米也是：</p>
<p><img src="https://img-blog.csdnimg.cn/2e6d50d2ee344316b6027cffc3e29c4b.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>也是后端，这是要和 JAVA 抢饭碗。。。</p>
<p><img src="https://img-blog.csdnimg.cn/25f74a9c4ffa4605a4600da20375d985.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>再看一个常见的，Go 非常适合开发运维管理系统，这个估计是开发维护阿里内部的自动化运维项目的，也就是说他们的运维支持可能是他们自己用 Go 语言写的项目。(实在不理解你就想下他们自己自研开发了一个类似于 Jenkins 和 Docker 之类的环境和代码流程发布的项目)</p>
<p><img src="https://img-blog.csdnimg.cn/f3598988ec5b46e68fc71a0783da5c79.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>再来看一个字节跳动的，也是开发内部流程自动部署自动运维程序的</p>
<p><img src="https://img-blog.csdnimg.cn/3a928549a795452b8cc2dde6a0abbdb6.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>再看华为的，好像 Java 架构师的要求啊，微服务，缓存，消息中间件，数据库。。。</p>
<p><img src="https://img-blog.csdnimg.cn/f2937196c1074fc5b2540394f0298457.jpeg#pic_center" alt="在这里插入图片描述"></p>
<p>这里不多看，自己看看去吧，大多数你能知道的大公司都有用 go 语言尝试的新部门，新项目，市场占有率虽然比 Java 少，但是岗位实际上蛮多的。自己可以去 BOSS 上详细查查。</p>
<h2 id="三go和java微观对比"><a class="markdownIt-Anchor" href="#三go和java微观对比">#</a> 三.Go 和 Java 微观对比</h2>
<h3 id="1gopath和java的classpath"><a class="markdownIt-Anchor" href="#1gopath和java的classpath">#</a> 1.GoPath 和 Java 的 ClassPath</h3>
<p>我们先来看看关于 Java 的 classpath：</p>
<p>在我们的开发环境中，一个 web 程序 (war 包) 有一个 classpath, 这个 classpath 在 IDEA 的开发工具中目录体现为 src 目录和 resource 目录，实际上在真正的 war 包中他定位的是指 WEB-INF 下的 classes 文件夹下的资源 (比如 class 文件)。</p>
<p>我们编译后的文件都放在 classpath (类路径) 下。我们多个项目程序会有多个 classpath 目录。</p>
<p>在 Go 语言中，GoPath 在同一系统上的同一用户，一般规定只有一个，无论这个用户创建多少个 go 项目，都只有一个 GoPath, 并且这些项目都放在 GoPath 下的 src 目录下。</p>
<p>GoPath 下有三个目录：</p>
<p>1.bin （用于存放项目编译后的可执行文件）</p>
<p>2.pkg (用于存放类库文件，比如.a 结尾的包模块)</p>
<p>3.src （用于存放项目代码源文件）</p>
<p>注意：当我们在 windows 上开发 Go 程序时，需要新建一个文件夹 (文件夹名任意) 作为 GOPATH 的文件目录，在其中新建三个文件夹分别是：bin,pkg,src。如果是在集成开发工具上开发的话，需要在设置中把 GOPATH 路径设置为你自定义的那个文件夹，之后产生的文件和相关内容都会在其中。</p>
<p>如果是在 linux 上想跑测试开发执行 go 程序，需要在 /etc/profile 添加名为 GOPATH 的环境变量，目录设置好自己新建的。</p>
<p>例如：全局用户设置 GOPATH 环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line"><span class="comment">#添加如下 目录可以灵活修改</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=/pub/go/gopath</span><br><span class="line">//立即刷新环境变量生效</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<p>单用户设置 GOPATH 环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi   ~/.bash_profile</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加如下 目录可以自己灵活修改</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=/home/user/local/soft/go/gopath</span><br><span class="line">//立即刷新环境变量生效</span><br><span class="line"><span class="built_in">source</span> vi   ~/.bash_profile</span><br></pre></td></tr></table></figure>
<p>注意：这是在 linux 上开发 go 程序才需要的，如果只是生产运行程序的话是不需要任何东西的，直接运行二进制可执行程序包即可，他所有的依赖全部打进包中了。</p>
<p>如果是在 windows 下的 cmd，dos 窗口运行相关的 go 命令和程序，则需要在 windows 的【此电脑】–&gt;【右键】–&gt;【属性】–&gt;【高级系统设置】–&gt;【环境变量】-【新建一个系统变量】–&gt;【变量名为 GOPATH，路径为你自己指定的自定义文件夹】（如果是在 IDEA 中开发，不需要在此配置环境变量，只需要在 IDEA 中配置好 GOPATH 的目录设置即可）</p>
<h3 id="2go的开发环境搭建"><a class="markdownIt-Anchor" href="#2go的开发环境搭建">#</a> 2.Go 的开发环境搭建</h3>
<p>（配置环境变量 GOPATH 参考上一节内容）</p>
<p>我们要开发 Go 的程序，需要如下两样东西：</p>
<p>1.Go SDK</p>
<p>GO 中文社区 SDK 下载地址：<a target="_blank" rel="noopener" href="https://studygolang.com/dl">https://studygolang.com/dl</a></p>
<p>go1.14 (最新的)</p>
<p>我们用 1.14 版就可以，因为 1.13 后才完全支持 Module 功能。</p>
<p>有两种安装模式，一种是压缩包解压的方式，一种是图形化安装。</p>
<p>推荐使用 windows 图形安装傻瓜式安装，windows 图形安装下载这个</p>
<p><a target="_blank" rel="noopener" href="https://studygolang.com/dl/golang/go1.14.6.windows-amd64.msi">https://studygolang.com/dl/golang/go1.14.6.windows-amd64.msi</a></p>
<ol>
<li>
<p>Go 的集成软件开发环境</p>
<p>参考三 (4) 中的 go 集成开发环境选择。</p>
</li>
</ol>
<h3 id="3go与java的文件结构对比"><a class="markdownIt-Anchor" href="#3go与java的文件结构对比">#</a> 3.Go 与 Java 的文件结构对比</h3>
<h4 id="1go文件结构模板"><a class="markdownIt-Anchor" href="#1go文件结构模板">#</a> 1).go 文件结构模板</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主程序必须是写成main包名</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">//导入别的类库</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">//全局常量定义</span></span><br><span class="line"><span class="keyword">const</span>  num = <span class="number">10</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">//全局变量定义</span></span><br><span class="line"><span class="keyword">var</span> name <span class="type">string</span> = <span class="string">&quot;li_ming&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//类型定义</span></span><br><span class="line"><span class="keyword">type</span> P <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//初始化函数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//main函数:程序入口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Hello World!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2java文件结构"><a class="markdownIt-Anchor" href="#2java文件结构">#</a> 2).Java 文件结构</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包名</span></span><br><span class="line"><span class="keyword">package</span> my_package;</span><br><span class="line">       </span><br><span class="line"><span class="comment">//导入包中的类</span></span><br><span class="line"><span class="keyword">import</span> java.io.*；</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Class MainTest&#123; </span><br><span class="line">	<span class="comment">//main方法:程序入口</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">static</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//people类</span></span><br><span class="line">Class People &#123;</span><br><span class="line">	<span class="comment">//成员变量</span></span><br><span class="line">	<span class="keyword">public</span> String name;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> age;</span><br><span class="line">            </span><br><span class="line">	<span class="comment">//成员方法</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">	            </span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4go与java的集成开发环境"><a class="markdownIt-Anchor" href="#4go与java的集成开发环境">#</a> 4.Go 与 Java 的集成开发环境</h3>
<h4 id="1go的集成开发环境"><a class="markdownIt-Anchor" href="#1go的集成开发环境">#</a> 1).Go 的集成开发环境</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">最常用的有三种：</span><br><span class="line"></span><br><span class="line">Visual Studio Code(VS Code) 微软开发的一款Go语言开发工具。</span><br><span class="line"></span><br><span class="line">LiteIDE 是国人开发的Go语言开发工具。</span><br><span class="line"></span><br><span class="line">GoLand 这个非常好用，和Java中的IDEA是一家公司。(推荐使用)</span><br></pre></td></tr></table></figure>
<h4 id="2java的集成开发环境"><a class="markdownIt-Anchor" href="#2java的集成开发环境">#</a> 2).Java 的集成开发环境</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyEclipse,Eclipse(已过时)。</span><br><span class="line"></span><br><span class="line">IntelliJ IDEA(大多数用这个)。</span><br></pre></td></tr></table></figure>
<h3 id="5go和java常用包的对比"><a class="markdownIt-Anchor" href="#5go和java常用包的对比">#</a> 5.Go 和 Java 常用包的对比</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Go中文API文档地址：</span><br><span class="line">https://studygolang.com/pkgdoc</span><br><span class="line">12</span><br><span class="line">     			Go                                              Java         </span><br><span class="line"></span><br><span class="line">IO流操作：      bufio/os                                     java.lang.io</span><br><span class="line">字符串操作：      strings                                    java.lang.String</span><br><span class="line">容器           container(heap/list/ring)           	      java.lang.Collection</span><br><span class="line">锁               sync                                       juc</span><br><span class="line">时间              time                                      java.time/java.lang.Date</span><br><span class="line">算数操作          math                                       java.math</span><br><span class="line">底层Unsafe       unsafe                                     unsafe类       </span><br></pre></td></tr></table></figure>
<h3 id="6go的常用基础数据类型和java的基础数据类型对比"><a class="markdownIt-Anchor" href="#6go的常用基础数据类型和java的基础数据类型对比">#</a> 6.Go 的常用基础数据类型和 Java 的基础数据类型对比</h3>
<h4 id="1go中的常用基础数据类型有"><a class="markdownIt-Anchor" href="#1go中的常用基础数据类型有">#</a> 1).go 中的常用基础数据类型有：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.布尔型：关键字【bool】： true   false</span><br><span class="line">2.有符号整形：头一位是代表正负</span><br><span class="line">            int   默认整形   4或8字节         		  32位或64位     </span><br><span class="line">            int8             1字节                     8位</span><br><span class="line">            int16            2字节                     16位</span><br><span class="line">            int32            4字节                     32位</span><br><span class="line">            in64             8字节                     64位</span><br><span class="line">       		【int是32还是64位取决于操作系统的位数，现在电脑一般都是64位的了，所以一般都是64位】</span><br><span class="line">3.无符号整形</span><br><span class="line">            uint             4或8字节          	 32位或64位</span><br><span class="line">            uint8             1字节                     8位</span><br><span class="line">            uint16            2字节                     16位</span><br><span class="line">            uint32            4字节                     32位</span><br><span class="line">            uint64            8字节                     64位</span><br><span class="line">4.浮点型</span><br><span class="line">            注：go语言没有float类型，只有float32和float64。</span><br><span class="line">            float32           32位浮点数  </span><br><span class="line">            float64           64位浮点数</span><br><span class="line">5.字符串</span><br><span class="line">            string</span><br><span class="line">6. byte     等同uint8，只是类似于一个别名的东西</span><br><span class="line">   rune     等同int32	 只是一个别名，强调表示编码概念对应的数字</span><br></pre></td></tr></table></figure>
<h4 id="2go中派生数据类型有"><a class="markdownIt-Anchor" href="#2go中派生数据类型有">#</a> 2).go 中派生数据类型有：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">注:这里简单列举一下</span><br><span class="line">指针  	Pointer</span><br><span class="line">数组  	Array[]</span><br><span class="line">结构体 	struct</span><br><span class="line">进程管道： channel </span><br><span class="line">函数 		 func</span><br><span class="line">切片  	slice</span><br><span class="line">接口 		interface</span><br><span class="line">哈希 		 map</span><br><span class="line">123456789</span><br></pre></td></tr></table></figure>
<h4 id="3java中的基础数据类型"><a class="markdownIt-Anchor" href="#3java中的基础数据类型">#</a> 3).Java 中的基础数据类型</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">byte</span><br><span class="line"></span><br><span class="line">short</span><br><span class="line"></span><br><span class="line">int</span><br><span class="line"></span><br><span class="line">long</span><br><span class="line"></span><br><span class="line">float</span><br><span class="line"></span><br><span class="line">double</span><br><span class="line"></span><br><span class="line">boolean</span><br><span class="line"></span><br><span class="line">char</span><br></pre></td></tr></table></figure>
<h3 id="7go和java的变量对比"><a class="markdownIt-Anchor" href="#7go和java的变量对比">#</a> 7.Go 和 Java 的变量对比</h3>
<h4 id="1go的变量"><a class="markdownIt-Anchor" href="#1go的变量">#</a> 1).go 的变量</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span>(</span><br><span class="line">   <span class="comment">//包含print函数</span></span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//var  变量名  变量类型 = 变量值</span></span><br><span class="line">   <span class="keyword">var</span> name <span class="type">string</span> = <span class="string">&quot;li_ming&quot;</span></span><br><span class="line">   <span class="comment">//方法内部可以直接使用 【 变量名 := 变量值 】 赋值，方法外不可以</span></span><br><span class="line">   name2:=<span class="string">&quot;xiao_hong&quot;</span></span><br><span class="line">   fmt.Println(<span class="string">&quot;name = &quot;</span>,name)</span><br><span class="line">   fmt.Println(<span class="string">&quot;name2 = &quot;</span>,name2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2java的变量"><a class="markdownIt-Anchor" href="#2java的变量">#</a> 2).Java 的变量</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//变量类型  变量名 = 变量值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;li_ming&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;name =&quot;</span>+name);</span><br><span class="line">        System.out.println(<span class="string">&quot;i =&quot;</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8go和java的常量对比"><a class="markdownIt-Anchor" href="#8go和java的常量对比">#</a> 8.Go 和 Java 的常量对比</h3>
<h4 id="1go的常量"><a class="markdownIt-Anchor" href="#1go的常量">#</a> 1).go 的常量</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">go中的常量和java中的常量含义有一个本质的区别：</span><br><span class="line">go中的常量是指在编译期间就能确定的量(数据)，</span><br><span class="line">而java中的常量是指被赋值一次后就不能修改的量(数据)。</span><br><span class="line">所以两者不一样，因为Java中的常量也是JVM跑起来后赋值的，只不过不允许更改；</span><br><span class="line">go的常量在编译后就确实是什么数值了。</span><br><span class="line">12345</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import(</span><br><span class="line">   //包含print函数</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line">func main() &#123;</span><br><span class="line">   //const  常量名  常量类型 = 常量值   显示推断类型</span><br><span class="line">   const name string = &quot;const_li_ming&quot;</span><br><span class="line">   //隐式推断类型</span><br><span class="line">   const name2 =&quot;const_xiao_hong&quot;</span><br><span class="line">   fmt.Println(&quot;name = &quot;,name)</span><br><span class="line">   fmt.Println(&quot;name2 = &quot;,name2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2java的常量"><a class="markdownIt-Anchor" href="#2java的常量">#</a> 2).Java 的常量</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="comment">//【访问修饰符】 【静态修饰符】final修饰符   常量类型   常量名 =  常量值；</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TAG</span> <span class="operator">=</span> <span class="string">&quot;A&quot;</span>;    <span class="comment">//一般设置为static静态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;tag= &quot;</span>+TAG);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9go与java的赋值对比"><a class="markdownIt-Anchor" href="#9go与java的赋值对比">#</a> 9.Go 与 Java 的赋值对比</h3>
<h4 id="1go的赋值"><a class="markdownIt-Anchor" href="#1go的赋值">#</a> 1).go 的赋值</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">Go方法内的赋值符号可以用  := ,也可以用 =,方法外只能用 = 。</span><br><span class="line">例如:</span><br><span class="line">12</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import(</span><br><span class="line">   //包含print函数</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">//方法外只能用 = 赋值</span><br><span class="line">var my_name  string = &quot;my_name&quot;</span><br><span class="line">var my_name2 = &quot;my_name2&quot;</span><br><span class="line">//my_name3:=&quot;my_name3&quot;    不在方法内，错误</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   fmt.Println(&quot;name = &quot;,my_name)</span><br><span class="line">   fmt.Println(&quot;name2 = &quot;,my_name2)</span><br><span class="line">&#125;</span><br><span class="line">12345678910111213141516</span><br><span class="line">Go支持多变量同时赋值：</span><br><span class="line">1</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import(</span><br><span class="line">   //包含print函数</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   //多变量同时赋值</span><br><span class="line">   var name,name2 = &quot;li_ming&quot;,&quot;xiao_hong&quot;</span><br><span class="line">   fmt.Println(&quot;name = &quot;,name)</span><br><span class="line">   fmt.Println(&quot;name2 = &quot;,name2)</span><br><span class="line">&#125;</span><br><span class="line">12345678910111213</span><br><span class="line">Go的丢弃赋值</span><br><span class="line">1</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">import(</span><br><span class="line">   //包含print函数</span><br><span class="line">   &quot;fmt&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   //丢弃赋值    把 1和2丢弃 只取3</span><br><span class="line">   //在必须一次取两个以上的值的场景下，又不想要其中一个值的时候使用，比如从map中取key,value</span><br><span class="line">   var _,_,num = 1,2,3</span><br><span class="line">   fmt.Println(&quot;num = &quot;,num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2java的赋值"><a class="markdownIt-Anchor" href="#2java的赋值">#</a> 2).java 的赋值</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//直接用 = 赋值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;li_ming&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;name =&quot;</span>+name);</span><br><span class="line">        System.out.println(<span class="string">&quot;i =&quot;</span>+i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10go与java的注释"><a class="markdownIt-Anchor" href="#10go与java的注释">#</a> 10.Go 与 Java 的注释</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Go中的注释写法和Java中的基本一样。</span><br><span class="line">例如：</span><br><span class="line">//单行注释,两者相同</span><br><span class="line">/*</span><br><span class="line">    Go的多行注释</span><br><span class="line">*/</span><br><span class="line">/**</span><br><span class="line">	Java多行注释</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<h3 id="11go和java的访问权限设置区别"><a class="markdownIt-Anchor" href="#11go和java的访问权限设置区别">#</a> 11.Go 和 Java 的访问权限设置区别</h3>
<p>首先我们来回忆一下，Java 的权限访问修饰符有哪些？</p>
<p>public 全局可见</p>
<p>protected 继承相关的类可见</p>
<p>default 同包可见</p>
<p>private 私有的，本类可见</p>
<p>关于 Java 中的访问权限修饰符，是用于修饰变量，方法，类的，被修饰的对象被不同的访问权限修饰符修饰后，其它程序代码要想访问它，必须在规定的访问范围内才可以，比如同包，同类，父子类，全局均可访问。</p>
<p>那么，Go 中的访问权限设置又有什么区别呢？</p>
<p>要理解这个问题，首先我们要来看一下一个 Go 程序的程序文件组织结构是什么样子的？</p>
<p>一个可运行的编译后的 Go 程序，必须有一个入口，程序从入口开始执行，这个入口必须是 main 包，并且从 main 包的 main 函数开始执行。</p>
<p>但是，为了开发的效率和管理开发任务的协调简单化，对于代码质量的可复用，可扩展等特性的要求，我们一般采用面向对象的，文件分模块式的开发。</p>
<p>比如，我是一个游戏程序，我的 main 函数启动后，首先要启动 UI 界面，那么关于 UI 界面相关的代码我们一般会专门分出一个模块去开发，然后这个模块有很多个程序文件，这里关于 UI 模块比如有 3 个文件，a.go,b.go,c.go，那么我们在实际当中会建一个以 ui 为名的包文件夹，然后把 a.go,b.go,c.go 全部放到 ui 这个包文件夹下，然后因为这个包没有 main 包，没有 main 函数，所以它打出来的一个程序文件就是以.a 结尾的工具包，类似于 Java 中的 jar 包，工具包文件名为 ui.a。</p>
<p>参考如下：</p>
<p>----com.add.mygame.ui</p>
<p>------------------------------------a.go</p>
<p>------------------------------------b.go</p>
<p>------------------------------------c.go</p>
<p>a.go 文件如下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//这里的ui，也就是package后面的名称尽量和包文件夹的名称一致，不一致也可以</span><br><span class="line">package ui</span><br><span class="line"></span><br><span class="line">//相关方法和业务</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">//启动游戏UI</span><br><span class="line">func StartGameUI() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要注意一个点，在程序中的 package 后面的 ui 包名可以和文件夹 com.mashibing.mygame.ui 中最后一层的 ui 文件夹名称不一致，</p>
<p>我们一般按规范写是要求写一致的，不一致时的区别如下：</p>
<p>我们把 ui.a 打包完毕后，我们就可以在别的程序中用 import 导入这个包模块 ，然后使用其中的内容了。</p>
<p>上面两个 ui 不同之处在于，在我们 import 的代码后面，需要写的模块名称是在 ${gopath}/src/ 下的文件夹名，也就是 com.mashibing.mygame.ui 中的 ui。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//游戏主程序</span><br><span class="line">package main</span><br><span class="line"></span><br><span class="line">//这里的ui是com.mashibing.mygame.ui的最后一层文件夹名</span><br><span class="line">import &quot;ui&quot;</span><br><span class="line"></span><br><span class="line">//相关方法和业务</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">	//这里的ui不是文件夹名，而是之前a.go程序中package后面写的包名</span><br><span class="line">	ui.StartGameUI()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/97e67873761b49d1a5db9164693282dc.png#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/2dd9e1a2ffac44fbb18253a2738a4199.png#pic_center" alt="在这里插入图片描述"></p>
<p>接下来进入主题，我们的 go 语言关于访问修饰符的是指的限制什么权限，以及如何实现？</p>
<p>我们之前可以看出来，实战中的 go 程序是有一个 main 程序 import 很多其它包模块，每个模块实现对应的功能，最后统一在 main 程序中组合来完成整个软件程序，那么有一些其它模块的函数和变量，我只想在本程序文件中调用，不想被其它程序 import 能调用到，如何实现？</p>
<p>import 后是否能调用对应包中的对象 (变量，结构体，函数之类的) 就是 go 关于访问权限的定义，import 后，可以访问，说明是开启了访问权限，不可以访问，是说明关闭了其它程序访问的权限。</p>
<p>在 go 中，为了遵循实现简洁，快速的原则，用默认的规范来规定访问权限设置。</p>
<p>默认规范是：某种类型（包括变量，结构体，函数，类型等）的名称定义首字母大写就是在其它包可以访问，首字母非大写，就是只能在自己的程序中访问。</p>
<p>这样我们就能理解为什么导入 fmt 包后，他的 PrintF 函数的首字母 P 是大写的。</p>
<p>参照如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package ui</span><br><span class="line"></span><br><span class="line">import &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">   //这里的P是大写</span><br><span class="line">   //所有调用别的包下的函数，都是首字母大写</span><br><span class="line">   fmt.Printf(&quot;aa&quot;)</span><br><span class="line">&#125;</span><br><span class="line">//这里的Person的首字母P也是表示外部程序导入该包后可以使用此Person类</span><br><span class="line">type Person struct&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//这里的D同上</span><br><span class="line">var Data string = &quot;li_ming&quot;</span><br></pre></td></tr></table></figure>
<h3 id="12go与java程序文件的后缀名对比"><a class="markdownIt-Anchor" href="#12go与java程序文件的后缀名对比">#</a> 12.Go 与 Java 程序文件的后缀名对比</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Java的编译文件是.class结尾,多个.class打成的一个可执行文件是.jar结尾,.jar不能直接在windows和linux上执行,得用java命令在JVM中执行。</span><br><span class="line"></span><br><span class="line">Go语言的程序文件后缀为.go,有main包main函数的,.go文件打包成二进制对应操作系统的可执行程序,如windows上的.exe结尾的可执行程序。</span><br><span class="line"></span><br><span class="line">Java的类库会以.jar结尾，Go语言非main包没有main函数的程序编译打包会打成一个类库，以.a结尾,也就是说Go语言的类库以.a结尾。</span><br><span class="line"></span><br><span class="line">Go的类库如下:</span><br><span class="line">            包名.a     </span><br><span class="line">            my_util.a</span><br><span class="line">注：my_util是最顶层文件夹名，里面包含着一个个程序文件。</span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>
<h3 id="13go与java选择结构的对比"><a class="markdownIt-Anchor" href="#13go与java选择结构的对比">#</a> 13.Go 与 Java 选择结构的对比</h3>
<h4 id="1if"><a class="markdownIt-Anchor" href="#1if">#</a> 1).if</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Go中的if和Java中的if使用相同，只不过是把小括号给去掉了。       </span><br></pre></td></tr></table></figure>
<p>示例 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">      单分支结构语法格式如下:</span></span><br><span class="line"><span class="comment">         if 条件判断 &#123;</span></span><br><span class="line"><span class="comment">            //代码块</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"></span><br><span class="line">   fmt.Printf(<span class="string">&quot;请输入数字&quot;</span>)</span><br><span class="line">   fmt.Scan(&amp;num)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> num &gt; <span class="number">10</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字大于10&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 2：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">      if else分支结构语法格式如下:</span></span><br><span class="line"><span class="comment">         if 条件判断 &#123;</span></span><br><span class="line"><span class="comment">            //代码块</span></span><br><span class="line"><span class="comment">         &#125; else &#123;</span></span><br><span class="line"><span class="comment">            //代码快2</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"></span><br><span class="line">   fmt.Printf(<span class="string">&quot;请输入数字&quot;</span>)</span><br><span class="line">   fmt.Scan(&amp;num)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> num &gt; <span class="number">10</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字大于10&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字不大于10&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 3：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">      if else分支结构语法格式如下:</span></span><br><span class="line"><span class="comment">         if 条件判断 &#123;</span></span><br><span class="line"><span class="comment">            //代码块</span></span><br><span class="line"><span class="comment">         &#125; else if 条件判断&#123;</span></span><br><span class="line"><span class="comment">            //代码块2</span></span><br><span class="line"><span class="comment">         &#125; else &#123;</span></span><br><span class="line"><span class="comment">            //代码块3</span></span><br><span class="line"><span class="comment">         &#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"></span><br><span class="line">   fmt.Printf(<span class="string">&quot;请输入数字&quot;</span>)</span><br><span class="line">   fmt.Scan(&amp;num)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> num &gt; <span class="number">10</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字大于10&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> num == <span class="number">10</span>&#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字等于10&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;您输入的数字小于10&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2switch"><a class="markdownIt-Anchor" href="#2switch">#</a> 2).switch</h4>
<p>示例 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> a = <span class="string">&quot;li_ming&quot;</span></span><br><span class="line">   <span class="keyword">switch</span> a &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;li_ming&quot;</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;Hello!LiMing&quot;</span>)</span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;xiao_hong&quot;</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;Hello!XiaoHong&quot;</span>)</span><br><span class="line">   <span class="keyword">default</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;No!&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 2：一分支多值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	</span><br><span class="line">   <span class="keyword">var</span> name = <span class="string">&quot;li_ming&quot;</span></span><br><span class="line">   <span class="keyword">var</span> name2 = <span class="string">&quot;xiao_hong&quot;</span></span><br><span class="line">   <span class="keyword">switch</span> name &#123;</span><br><span class="line">   <span class="comment">//li_ming或xiao_hong 均进入此</span></span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;li_ming&quot;</span>, <span class="string">&quot;xiao_hong&quot;</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;li_ming and xiao_hong&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">switch</span> name2 &#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="string">&quot;li_ming&quot;</span>, <span class="string">&quot;xiao_hong&quot;</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;li_ming and xiao_hong&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;g</span><br></pre></td></tr></table></figure>
<p>示例 3：switch 表达式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int</span> = <span class="number">11</span></span><br><span class="line">   <span class="keyword">switch</span>&#123;</span><br><span class="line">      <span class="keyword">case</span> num &gt; <span class="number">10</span> &amp;&amp; num &lt; <span class="number">20</span>:</span><br><span class="line">         fmt.Println(num)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 4：fallthrough 下面的 case 全部执行</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> num = <span class="number">11</span></span><br><span class="line">   <span class="keyword">switch</span> &#123;</span><br><span class="line">   <span class="keyword">case</span> num == <span class="number">11</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;==11&quot;</span>)</span><br><span class="line">      <span class="keyword">fallthrough</span></span><br><span class="line">   <span class="keyword">case</span> num &lt; <span class="number">10</span>:</span><br><span class="line">      fmt.Println(<span class="string">&quot;&lt;12&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="14go与java循环结构的对比"><a class="markdownIt-Anchor" href="#14go与java循环结构的对比">#</a> 14.Go 与 Java 循环结构的对比</h3>
<h4 id="1for循环"><a class="markdownIt-Anchor" href="#1for循环">#</a> 1).for 循环</h4>
<p>示例 1：省略小括号</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">      fmt.Println(i)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 2：和 while 相同，break,continue 同 java</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   i := <span class="number">0</span></span><br><span class="line">   <span class="comment">//省略另外两项，相当于java中的while</span></span><br><span class="line">   <span class="keyword">for</span> i &lt; <span class="number">3</span> &#123;</span><br><span class="line">      i++</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//break用法相同</span></span><br><span class="line">   <span class="keyword">for</span> i == <span class="number">3</span> &#123;</span><br><span class="line">      fmt.Println(i)</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 3：死循环，三项均省略</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">for</span> &#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> <span class="literal">true</span> &#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 4：嵌套循环和 java 也一样，不演示了</p>
<p>示例 5： range 循环</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> data [<span class="number">10</span>]<span class="type">int</span> = [<span class="number">10</span>]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>&#125;</span><br><span class="line">   <span class="keyword">for</span>  i, num := <span class="keyword">range</span> data &#123;</span><br><span class="line">      fmt.Println(i,num)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2goto"><a class="markdownIt-Anchor" href="#2goto">#</a> 2).goto</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//goto可以用在任何地方，但是不能跨函数使用</span></span><br><span class="line">   fmt.Println(<span class="string">&quot;start&quot;</span>)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//go to的作用是跳转，中间的语句不执行，无条件跳转</span></span><br><span class="line">   <span class="keyword">goto</span> my_location <span class="comment">//goto是关键字， my_location可以自定义，他叫标签</span></span><br><span class="line"></span><br><span class="line">   fmt.Println(<span class="string">&quot;over&quot;</span>)</span><br><span class="line">   my_location:</span><br><span class="line">   fmt.Println(<span class="string">&quot;location&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="15go与java的数组对比"><a class="markdownIt-Anchor" href="#15go与java的数组对比">#</a> 15.Go 与 Java 的数组对比</h3>
<p>1）go 的一维数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var 数组名 [数组长度]数组类型  = [数组长度]数组类型&#123;元素1，元素2...&#125;</span><br></pre></td></tr></table></figure>
<p>示例 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="comment">//全局</span></span><br><span class="line"><span class="keyword">var</span> my_arr [<span class="number">6</span>]<span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> my_arr_1 [<span class="number">3</span>]<span class="type">int</span> = [<span class="number">3</span>]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//方法内：</span></span><br><span class="line">   this_arr := [<span class="number">2</span>]<span class="type">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br><span class="line">   fmt.Println(my_arr)</span><br><span class="line">   fmt.Println(my_arr_1)</span><br><span class="line">   fmt.Println(this_arr)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2）二维数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="comment">//全局</span></span><br><span class="line"><span class="keyword">var</span> my_arr [<span class="number">4</span>][<span class="number">6</span>]<span class="type">int</span></span><br><span class="line"><span class="keyword">var</span> my_arr_1 [<span class="number">2</span>][<span class="number">3</span>]<span class="type">int</span> = [...][<span class="number">3</span>]<span class="type">int</span>&#123;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, &#123;<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//方法内：</span></span><br><span class="line">   this_arr := [<span class="number">2</span>][<span class="number">3</span>]<span class="type">int</span>&#123;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;, &#123;<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>&#125;&#125;</span><br><span class="line">   <span class="comment">// 第 2 纬度不能用 &quot;...&quot;。</span></span><br><span class="line">   this_arr2 := [...][<span class="number">2</span>]<span class="type">int</span>&#123;&#123;<span class="number">1</span>, <span class="number">1</span>&#125;, &#123;<span class="number">2</span>, <span class="number">2</span>&#125;, &#123;<span class="number">3</span>, <span class="number">3</span>&#125;&#125;</span><br><span class="line">   fmt.Println(my_arr)</span><br><span class="line">   fmt.Println(my_arr_1)</span><br><span class="line">   fmt.Println(this_arr)</span><br><span class="line">   fmt.Println(this_arr2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="16go有指针概念java没有指针概念"><a class="markdownIt-Anchor" href="#16go有指针概念java没有指针概念">#</a> 16.Go 有指针概念，Java 没有指针概念</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Go中有指针的概念，Java中没有指针的概念。</span><br><span class="line">指针简单的说就是存储一个【变量地址】的【变量】。</span><br><span class="line">12</span><br><span class="line">Go中使用指针的方法</span><br><span class="line">//*+变量类型 = 对应变量类型的指针类型，&amp;+变量名 = 获取变量引用地址    </span><br><span class="line">var  指针变量名 *指针变量类型 = &amp;变量名  </span><br><span class="line">例如：</span><br><span class="line">var my_point *int = &amp;num</span><br><span class="line">//通过&amp;+指针变量 = 修改原来的变量真实值</span><br><span class="line">&amp;指针变量名 = 修改的变量值</span><br><span class="line">例如：</span><br><span class="line">&amp;my_point = 100;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 声明实际变量</span></span><br><span class="line">	<span class="keyword">var</span> name <span class="type">string</span>=<span class="string">&quot;li_ming&quot;</span></span><br><span class="line">	<span class="comment">// 声明指针变量</span></span><br><span class="line">	<span class="keyword">var</span> name_point *<span class="type">string</span></span><br><span class="line">	<span class="comment">// 指针变量的存储地址</span></span><br><span class="line">	name_point = &amp;name</span><br><span class="line"></span><br><span class="line">	<span class="comment">//直接访问变量地址</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;name 变量的地址是:&quot;</span>, &amp;name  )</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 指针变量的存储地址</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;name_point变量储存的指针地址:&quot;</span>, name_point )</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 使用指针访问值</span></span><br><span class="line">	fmt.Println(<span class="string">&quot;*name_point 变量的值:&quot;</span>, *name_point )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name 变量的地址是: 0x10ae40f0</span><br><span class="line">name_point变量储存的指针地址: 0x10ae40f0</span><br><span class="line">*name_point 变量的值: li_ming</span><br></pre></td></tr></table></figure>
<h3 id="17go语言的中newmake和java中的new对象有什么区别"><a class="markdownIt-Anchor" href="#17go语言的中newmake和java中的new对象有什么区别">#</a> 17.Go 语言的中 new,make 和 Java 中的 new 对象有什么区别？</h3>
<p>首先，Java 中的 new 关键字代表创建关于某一个类的一个新的对象。</p>
<p>如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(); </span><br></pre></td></tr></table></figure>
<p>Go 中的创建一个 struct 结构体的对象，是不需要用 new 关键字的，参考【20】中有代码示例讲解如何创建结构体对象。</p>
<p>Go 中 new 的概念是和内存相关的，我们可以通过 new 来为基础数据类型申请一块内存地址空间，然后把这个把这个内存地址空间赋值给</p>
<p>一个指针变量上。（new 主要就是为基础数据类型申请内存空间的，当我们需要一个基础数据类型的指针变量，并且在初始化这个基础指针变量时，不能确定他的初始值，此时我们才需要用 new 去内存中申请一块空间，并把这空间绑定到对应的指针上，之后可以用该指针为这块内存空间写值。new 关键字在实际开发中很少使用，和 java 很多处用 new 的情况大不相同）</p>
<p>参考如下示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> num *<span class="type">int</span></span><br><span class="line">   <span class="comment">//此处num是nil</span></span><br><span class="line">   fmt.Println(num)</span><br><span class="line">   <span class="comment">//此处会报空指针异常，因为num为nil,没有申请内存空间，所以不能为nil赋值</span></span><br><span class="line">   *num = <span class="number">1</span></span><br><span class="line">   fmt.Println(*num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>改为如下代码即可：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//在内存中申请一块地址，并把内存地址存入num</span></span><br><span class="line">   <span class="keyword">var</span> num = <span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">   <span class="comment">//此处num的值是申请出来的内存空间地址值，一个十六进制的数字</span></span><br><span class="line">   fmt.Println(num)</span><br><span class="line">   <span class="comment">//正常</span></span><br><span class="line">   *num = <span class="number">1</span></span><br><span class="line">   fmt.Println(*num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我们来看一个 go 中的 make 是做什么用的？</p>
<p>go 中的 make 是用来创建 slice (切片)，map (映射表)，chan (线程通信管道) 这三个类型的对象的，返回的就是对应类型的对象，他的作用就相当于 Java 中 new 一个 ArrayList，new 一个 HashMap 时候的 new 的作用，只不过是 go 语法规定用 make 来创建 slice (切片)，map (映射表)，chan (线程通信管道)。</p>
<p>示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//make只能为map,channel,slice申请分配内存，只有这三种，没有第四种</span></span><br><span class="line">   <span class="comment">//所有通过make创建的这三种类型都是引用类型，传递参数时虽然是引用值传递，</span></span><br><span class="line">   <span class="comment">//但是对方法内引用变量参数的修改可以影响到外部的引用变量</span></span><br><span class="line">   <span class="comment">//1.通过make创建map对象  如下代码类似于Java中 Map&lt;String,Integer&gt; myMap = new HashMap&lt;&gt;();</span></span><br><span class="line">   <span class="comment">//在这里make就是申请分配map的内存，和java中创建map的new一样</span></span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">   myMap[<span class="string">&quot;li_ming&quot;</span>] = <span class="number">20</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//2.通过make创建channel,make函数内可以有一个参数，也可以有两个参数，有两个参数时第二个参数</span></span><br><span class="line">   <span class="comment">//为通道的缓存队列的长度</span></span><br><span class="line">   <span class="comment">//2.1) 只有一个参数，通道的缓存队列长度此时为0，也就是无缓存。</span></span><br><span class="line">   <span class="comment">//创建一个传输int类型数据的通道</span></span><br><span class="line">   myChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">   fmt.Println(myChan)</span><br><span class="line">   <span class="comment">//2.2) 有两个参数，第二个参数2代表此时代表缓存队列的长度为2</span></span><br><span class="line">   <span class="comment">//创建一个传输int类型数据的通道,缓存为2</span></span><br><span class="line">   mychan2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">2</span>)</span><br><span class="line">   fmt.Println(mychan2)</span><br><span class="line">   <span class="comment">//此处暂时不做通道缓存队列数多少有何区别的讲解</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//3.通过make创建slice切片</span></span><br><span class="line">   <span class="comment">//有两种方式，一种是两个参数，一种是三个参数</span></span><br><span class="line">   <span class="comment">//我们只有在创建一个空的切片时才会使用make</span></span><br><span class="line">   <span class="comment">//如果通过一个已有的数组创建切片往往是下面的形式</span></span><br><span class="line">   <span class="comment">//创建一个底层数组</span></span><br><span class="line">   myArr := []<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">   <span class="comment">//如果通过一个数组创建切片，往往是用 原始数组变量名[切片起始位置:切片结束位置] 创建一个切片</span></span><br><span class="line">   mySlice1 := myArr[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">   fmt.Println(mySlice1)</span><br><span class="line">   <span class="comment">//我们如果是想创建一个空的slice,则用make创建切片</span></span><br><span class="line">   <span class="comment">//如下形式 make(int[],num1,num2)</span></span><br><span class="line">   <span class="comment">//num1 = 切片的长度(默认分配内存空间的元素个数)</span></span><br><span class="line">   <span class="comment">//num2 = 切片的容量(解释：底层数组的长度/切片的容量，超过底层数组长度append新元素时会创建一个新的底层数组，</span></span><br><span class="line">   <span class="comment">//不超过则会使用原来的底层数组)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//代表底层数组的长度是4,默认给底层数组的前两个元素分配内存空间</span></span><br><span class="line">   <span class="comment">//切片指向前两个元素的地址，如果append新元素，在元素数小于4时都会</span></span><br><span class="line">   <span class="comment">//在原来的底层数组的最后一个元素新分配空间和赋值，</span></span><br><span class="line">   <span class="comment">//append超过4个元素时，因为原数组大小不可变，也也存储不下了，</span></span><br><span class="line">   <span class="comment">//所以会新创建一个新的底层数组，切片指向新的底层数组</span></span><br><span class="line">   mySliceEmpty := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line">   fmt.Println(mySliceEmpty)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//两个参数，代表切片的长度和切片的容量(底层数组长度)均为第二个参数那个值</span></span><br><span class="line">   mySliceEmpty2 := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">5</span>)</span><br><span class="line">   fmt.Println(mySliceEmpty2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18go相关的数据容器和java的集合框架对比"><a class="markdownIt-Anchor" href="#18go相关的数据容器和java的集合框架对比">#</a> 18.Go 相关的数据容器和 Java 的集合框架对比</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Go中有的数据结构：数组，切片，map，双向链表，环形链表，堆</span><br><span class="line">Go自己的类库中没有set,没有集合(List)，但是第三方库有实现。</span><br><span class="line">Java中有： Map,Set,List,Queue,Stack,数组</span><br><span class="line">Java中没有切片的概念。</span><br><span class="line">Go中的数组打印格式是[1,2,3,4,5] </span><br><span class="line">Go中的切片打印格式是[[1,2,3]]</span><br><span class="line">Go中切片的概念：切片是数组的一个子集，就是数组截取某一段。</span><br><span class="line">Go的map和Java的map大致相同</span><br></pre></td></tr></table></figure>
<h3 id="19go中的函数go的方法和java中的方法对比"><a class="markdownIt-Anchor" href="#19go中的函数go的方法和java中的方法对比">#</a> 19.Go 中的函数，Go 的方法和 Java 中的方法对比</h3>
<h4 id="1go中的函数定义"><a class="markdownIt-Anchor" href="#1go中的函数定义">#</a> 1).Go 中的函数定义</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Go中返回值可以有多个，不像Java中多个值得封装到实体或map返回</span><br><span class="line">//注：【】内的返回值可不写，无返回值直接把返回值部分全部去掉即可。</span><br><span class="line">func 函数名(变量1 变量类型，变量2 变量2类型...)【(返回值1 类型1，返回值2 类型2...)】  &#123;        //注意：这个方法的右中括号必须和func写在同一行才行，否则报错，不能按c语言中的换行写</span><br><span class="line">123</span><br></pre></td></tr></table></figure>
<p>示例 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//定义局部变量</span></span><br><span class="line">   <span class="keyword">var</span> a <span class="type">int</span> = <span class="number">100</span></span><br><span class="line">   <span class="keyword">var</span> b <span class="type">int</span> = <span class="number">200</span></span><br><span class="line">   <span class="keyword">var</span> result <span class="type">int</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//调用函数并返回最大值</span></span><br><span class="line">   result = max(a, b)</span><br><span class="line"></span><br><span class="line">   fmt.Println( <span class="string">&quot;最大值是 :&quot;</span>, result )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数返回两个数的最大值 */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(num1, num2 <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="comment">/* 定义局部变量 */</span></span><br><span class="line">   <span class="keyword">var</span> result <span class="type">int</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (num1 &gt; num2) &#123;</span><br><span class="line">      result = num1</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result = num2</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 2：返回多个值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   a, b := swap(<span class="string">&quot;li_ming&quot;</span>, <span class="string">&quot;xiao_hong&quot;</span>)</span><br><span class="line">   fmt.Println(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">swap</span><span class="params">(x, y <span class="type">string</span>)</span></span> (<span class="type">string</span>, <span class="type">string</span>) &#123;</span><br><span class="line">   <span class="comment">//返回多个值</span></span><br><span class="line">   <span class="keyword">return</span> y, x</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意点：函数的参数：基础类型是按值传递，复杂类型是按引用传递</p>
<p>示例 3： 函数的参数：变长参数传递</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	manyArgs(<span class="number">1</span>,<span class="number">2</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">	manyArgs(<span class="number">1</span>,<span class="number">2</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;5&quot;</span>,<span class="string">&quot;5&quot;</span>)</span><br><span class="line">	dataStr := []<span class="type">string</span>&#123;<span class="string">&quot;11&quot;</span>,<span class="string">&quot;11&quot;</span>,<span class="string">&quot;11&quot;</span>&#125;</span><br><span class="line">	<span class="comment">//传数组也可以，加三个点</span></span><br><span class="line">	manyArgs(<span class="number">1</span>,<span class="number">2</span>,dataStr...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可变参数必须放在最后面</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">manyArgs</span><span class="params">(a <span class="type">int</span>,b <span class="type">int</span> ,str ...<span class="type">string</span> )</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> i,s := <span class="keyword">range</span> str &#123;</span><br><span class="line">		fmt.Println(i,s)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意点：函数的返回值：如果有返回值，返回值的类型必须写，返回值得变量名根据情况可写可不写。</p>
<p>示例 4： defer：推迟执行 (类似于 java 中的 finally)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   testMyFunc();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDefer1</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;print defer1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDefer2</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;print defer2&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testMyFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//defer会在方法返回前执行，有点像java中的finally</span></span><br><span class="line">   <span class="comment">//defer写在任意位置均可，多个defer的话按照逆序依次执行</span></span><br><span class="line">   <span class="keyword">defer</span> testDefer2()</span><br><span class="line">   <span class="keyword">defer</span> testDefer1()</span><br><span class="line">   fmt.Println(<span class="string">&quot;print my func&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例 5 ：丢弃返回值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//方式一丢弃：丢弃num1和str</span></span><br><span class="line">   _,num2,_:= testFun(<span class="number">1</span>,<span class="number">2</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line">   fmt.Println(num2)</span><br><span class="line">   <span class="comment">//方式二丢弃：</span></span><br><span class="line">   _,num3,_:= testFun(<span class="number">1</span>,<span class="number">3</span>,<span class="string">&quot;4&quot;</span>);</span><br><span class="line">   fmt.Println(num3)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFun</span><span class="params">(num1,num2 <span class="type">int</span>,str <span class="type">string</span>)</span></span> (n1 <span class="type">int</span>,n2 <span class="type">int</span>,s1 <span class="type">string</span>)&#123;</span><br><span class="line">   n1 = num1</span><br><span class="line">   n2 = num2</span><br><span class="line">   s1 = str</span><br><span class="line">   <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testFun2</span><span class="params">(num1,num2 <span class="type">int</span>,str <span class="type">string</span>)</span></span> (<span class="type">int</span>,<span class="type">int</span>,<span class="type">string</span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> num1,num2,str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2java中的方法定义"><a class="markdownIt-Anchor" href="#2java中的方法定义">#</a> 2).Java 中的方法定义</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">访问修饰符   返回值类型   方法名(参数1类型  参数1，参数2类型 参数2...) &#123;</span><br><span class="line"></span><br><span class="line">      return 返回值;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Integer <span class="title function_">doSomething</span><span class="params">(String name,Integer age)</span> &#123;</span><br><span class="line">   </span><br><span class="line">		<span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="20go的内置函数和java的默认导入包javalang"><a class="markdownIt-Anchor" href="#20go的内置函数和java的默认导入包javalang">#</a> 20.Go 的内置函数和 Java 的默认导入包 java.lang.*</h3>
<p>为了在 Java 中快速开发，Java 语言的创造者把一些常用的类和接口都放到到 java.lang 包下，lang 包下的特点就是不用写 import 语句导入包就可以用里面的程序代码。</p>
<p>Go 中也有类似的功能，叫做 Go 的内置函数，Go 的内置函数是指不用导入任何包，直接就可以通过函数名进行调用的函数。</p>
<p>Go 中的内置函数有：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">close          关闭channel</span><br><span class="line"></span><br><span class="line">len            求长度</span><br><span class="line"></span><br><span class="line">make	      创建slice,map,chan对象</span><br><span class="line"></span><br><span class="line">append	      追加元素到切片(slice)中</span><br><span class="line"> </span><br><span class="line">panic         抛出异常，终止程序</span><br><span class="line"></span><br><span class="line">recover       尝试恢复异常，必须写在defer相关的代码块中</span><br></pre></td></tr></table></figure>
<p>参考示例代码 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   array := [<span class="number">5</span>]<span class="type">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">   str := <span class="string">&quot;myName&quot;</span></span><br><span class="line">   <span class="comment">//获取字符串长度</span></span><br><span class="line">   fmt.Println(<span class="built_in">len</span>(str))</span><br><span class="line">   <span class="comment">//获取数组长度</span></span><br><span class="line">   fmt.Println(<span class="built_in">len</span>(array))</span><br><span class="line">   <span class="comment">//获取切片长度</span></span><br><span class="line">   fmt.Println(<span class="built_in">len</span>(array[<span class="number">1</span>:]))</span><br><span class="line"></span><br><span class="line">   <span class="comment">//make创建channel示例</span></span><br><span class="line">   intChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">1</span>)</span><br><span class="line">   <span class="comment">//make创建map示例</span></span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">   <span class="comment">//make创建切片</span></span><br><span class="line">   mySlice := <span class="built_in">make</span>([]<span class="type">int</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">   fmt.Println(intChan)</span><br><span class="line">   fmt.Println(myMap)</span><br><span class="line">   fmt.Println(mySlice)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//关闭管道</span></span><br><span class="line">   <span class="built_in">close</span>(intChan)</span><br><span class="line">   <span class="comment">//为切片添加元素</span></span><br><span class="line">   array2 := <span class="built_in">append</span>(array[:],<span class="number">6</span>)</span><br><span class="line">   <span class="comment">//输出</span></span><br><span class="line">   fmt.Println(array2)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//new案例</span></span><br><span class="line">   num := <span class="built_in">new</span>(<span class="type">int</span>)</span><br><span class="line">   fmt.Println(num)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考示例代码 2：panic 和 recover 的使用</p>
<p>他们用于抛出异常和尝试捕获恢复异常</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func1</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">func2</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 刚刚打开某资源</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		err := <span class="built_in">recover</span>()</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		fmt.Println(<span class="string">&quot;释放资源..&quot;</span>)</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;抛出异常&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="number">2</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">func func3() &#123;</span></span><br><span class="line"><span class="string">	fmt.Println(&quot;</span><span class="number">3</span><span class="string">&quot;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">func main() &#123;</span></span><br><span class="line"><span class="string">	func1()</span></span><br><span class="line"><span class="string">	func2()</span></span><br><span class="line"><span class="string">	func3()</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Java 中的 java.lang 包下具体有什么在这里就不赘述了，请参考 JavaAPI 文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaAPI文档导航：https://www.oracle.com/cn/java/technologies/java-se-api-doc.html</span><br></pre></td></tr></table></figure>
<h3 id="21go的标准格式化输出库fmt和java的输出打印库对比"><a class="markdownIt-Anchor" href="#21go的标准格式化输出库fmt和java的输出打印库对比">#</a> 21.Go 的标准格式化输出库 fmt 和 java 的输出打印库对比</h3>
<p>Java 的标准输出流工具类是 java.lang 包下的 System 类，具体是其静态成员变量 PrintStream 类。</p>
<p>他有静态三个成员变量:</p>
<p>分别是 PrintStream 类型的 out,in,err</p>
<p>我们常见 System.out.println (), 实际上调用的就是 PrintStream 类对象的 println 方法。</p>
<hr>
<p>Go 中的格式化输出输入库是 fmt 模块。</p>
<p>fmt 在 Go 中提供了输入和输出的功能，类型 Java 中的 Scanner 和 PrintStream (println)。</p>
<p>它的使用方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Print:   原样输出到控制台，不做格式控制。</span><br><span class="line">Println: 输出到控制台并换行</span><br><span class="line">Printf : 格式化输出(按特定标识符指定格式替换)</span><br><span class="line">Sprintf：格式化字符串并把字符串返回，不输出，有点类似于Java中的拼接字符串然后返回。</span><br><span class="line">Fprintf：来格式化并输出到 io.Writers 而不是 os.Stdout</span><br></pre></td></tr></table></figure>
<p>详细占位符号如下：</p>
<p>代码示例如下：</p>
<h3 id="22go的面向对象相关知识"><a class="markdownIt-Anchor" href="#22go的面向对象相关知识">#</a> 22.Go 的面向对象相关知识</h3>
<h4 id="1封装属性结构体"><a class="markdownIt-Anchor" href="#1封装属性结构体">#</a> 1. 封装属性 (结构体)</h4>
<p>Go 中有一个数据类型是 Struct, 它在面向对象的概念中相当于 Java 的类，可以封装属性和封装方法，首先看封装属性如下示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//示例</span></span><br><span class="line"><span class="keyword">type</span> People <span class="keyword">struct</span> &#123;</span><br><span class="line">   name <span class="type">string</span></span><br><span class="line">   age <span class="type">int</span></span><br><span class="line">   sex <span class="type">bool</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//示例1：</span></span><br><span class="line">   <span class="keyword">var</span> l1 People</span><br><span class="line">   l1.name = <span class="string">&quot;li_ming&quot;</span></span><br><span class="line">   l1.age = <span class="number">22</span></span><br><span class="line">   l1.sex = <span class="literal">false</span></span><br><span class="line">   <span class="comment">//li_ming</span></span><br><span class="line">   fmt.Println(l1.name)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//示例2</span></span><br><span class="line">   <span class="keyword">var</span> l2 *People = <span class="built_in">new</span>(People)</span><br><span class="line">   l2.name = <span class="string">&quot;xiao_hong&quot;</span></span><br><span class="line">   l2.age = <span class="number">33</span></span><br><span class="line">   l2.sex = <span class="literal">true</span></span><br><span class="line">   <span class="comment">//xiao_hong xiao_hong</span></span><br><span class="line">   fmt.Println(l2.name,(*l2).name)</span><br><span class="line"></span><br><span class="line">   <span class="comment">//示例3:</span></span><br><span class="line">   <span class="keyword">var</span> l3 *People = &amp;People&#123; name:<span class="string">&quot;li_Ming&quot;</span>,age:<span class="number">25</span>,sex:<span class="literal">true</span>&#125;</span><br><span class="line">   <span class="comment">//li_Ming  li_Ming</span></span><br><span class="line">   fmt.Println(l3.name,(*l3).name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2封装方法方法接收器"><a class="markdownIt-Anchor" href="#2封装方法方法接收器">#</a> 2. 封装方法 (方法接收器)</h4>
<p>如果想为某个 Struct 类型添加一个方法，参考如下说明和代码：</p>
<p>go 的方法和 Java 中的方法对比，go 的函数和 go 方法的不同</p>
<p>Go 中的函数是不需要用结构体的对象来调用的，可以直接调用</p>
<p>Go 中的方法是必须用一个具体的结构体对象来调用的，有点像 Java 的某个类的对象调用其方法</p>
<p>我们可以把指定的函数绑定到对应的结构体上，使该函数成为这个结构体的方法，然后这个结构体的对象就可以通过。来调用这个方法了</p>
<p>绑定的形式是：在 func 和方法名之间写一个 (当前对象变量名 当前结构体类型)，这个叫方法的接受器，其中当前对象的变量名就是当前结构体调用该方法的对象的引用，相当于 java 中的 this 对象。</p>
<p>参考如下示例为 Student 学生添加一个 learn 学习的方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span>  &#123;</span><br><span class="line">   num <span class="type">int</span> <span class="comment">//学号</span></span><br><span class="line">   name <span class="type">string</span> <span class="comment">//姓名</span></span><br><span class="line">   class <span class="type">int</span>  <span class="comment">//班级</span></span><br><span class="line">   sex  <span class="type">bool</span>  <span class="comment">//性别</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//给Student添加一个方法</span></span><br><span class="line"><span class="comment">//这里的(stu Student)中的stu相当于java方法中的this对象</span></span><br><span class="line"><span class="comment">//stu是一个方法的接收器，接收是哪个对象调用了当方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu Student)</span></span> learn() &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;%s学生正在学习&quot;</span>,stu.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   stu := Student&#123;<span class="number">1</span>,<span class="string">&quot;li_ming&quot;</span>,<span class="number">10</span>,<span class="literal">true</span>&#125;</span><br><span class="line">   stu.learn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>方法的接收器也可以是指针类型的</p>
<p>参考如下案例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span>  &#123;</span><br><span class="line">   num <span class="type">int</span> <span class="comment">//学号</span></span><br><span class="line">   name <span class="type">string</span> <span class="comment">//姓名</span></span><br><span class="line">   class <span class="type">int</span>  <span class="comment">//班级</span></span><br><span class="line">   sex  <span class="type">bool</span>  <span class="comment">//性别</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里方法的接收器也可以是指针类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(stu *Student)</span></span> learn() &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;%s学生正在学习&quot;</span>,stu.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//指针类型</span></span><br><span class="line">   stu := &amp;Student&#123;<span class="number">1</span>,<span class="string">&quot;li_ming&quot;</span>,<span class="number">10</span>,<span class="literal">true</span>&#125;</span><br><span class="line">   stu.learn()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意有一种情况，当一个对象为 nil 空时，它调用方法时，接收器接受的对于自身的引用也是 nil，需要我们做一些健壮性的不为 nil 才做的判断处理。</p>
<h4 id="3go的继承结构体嵌入"><a class="markdownIt-Anchor" href="#3go的继承结构体嵌入">#</a> 3.Go 的继承 (结构体嵌入)</h4>
<p>Go 中可以用嵌入结构体实现类似于继承的功能：</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//电脑</span></span><br><span class="line"><span class="keyword">type</span> Computer <span class="keyword">struct</span> &#123;</span><br><span class="line">	screen <span class="type">string</span> <span class="comment">//电脑屏幕</span></span><br><span class="line">	keyboard <span class="type">string</span> <span class="comment">//键盘</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计算方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cp Computer)</span></span> compute(num1,num2 <span class="type">int</span>) <span class="type">int</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num1+num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//笔记本电脑</span></span><br><span class="line"><span class="keyword">type</span> NoteBookComputer <span class="keyword">struct</span>&#123;</span><br><span class="line">	Computer</span><br><span class="line">	wireless_network_adapter <span class="type">string</span> <span class="comment">//无线网卡</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> cp1 NoteBookComputer = NoteBookComputer&#123;&#125;</span><br><span class="line">	cp1.screen = <span class="string">&quot;高清屏&quot;</span></span><br><span class="line">	cp1.keyboard = <span class="string">&quot;防水键盘&quot;</span></span><br><span class="line">	cp1.wireless_network_adapter = <span class="string">&quot;新一代无线网卡&quot;</span></span><br><span class="line">	fmt.Println(cp1)</span><br><span class="line">	fmt.Println(cp1.compute(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，Go 中可以嵌入多个结构体，但是多个结构体不能有相同的方法，如果有参数和方法名完全相同的方法，在编译的时候就会报错。所以 Go 不存在嵌入多个结构体后，被嵌入的几个结构体有相同的方法，最后不知道选择执行哪个方法的情况，多个结构体方法相同时，直接编译就会报错。</p>
<p>参考如下示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   man := Man&#123;&#125;</span><br><span class="line">   fmt.Println(man)</span><br><span class="line">   <span class="comment">//下面的代码编译会报错</span></span><br><span class="line">   <span class="comment">//man.doEat()</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> Man <span class="keyword">struct</span> &#123;</span><br><span class="line">   FatherA</span><br><span class="line">   FatherB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p FatherA)</span></span>  doEat() &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;FatherA eat&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t FatherB)</span></span>  doEat() &#123;</span><br><span class="line">   fmt.Printf(<span class="string">&quot;FatherB eat&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FatherB <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> FatherA <span class="keyword">struct</span>  &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4go的多态接口"><a class="markdownIt-Anchor" href="#4go的多态接口">#</a> 4.Go 的多态 (接口)</h4>
<p>接下来我们讲 Go 中如何通过父类接口指向具体实现类对象，实现多态：</p>
<p>go 语言中的接口是非侵入式接口。</p>
<p>java 语言中的接口是侵入式接口。</p>
<p>侵入式接口是指需要显示的在类中写明实现哪些接口。</p>
<p>非侵入式接口是指不要显示的在类中写明要实现哪些接口，只需要方法名同名，参数一致即可。</p>
<p>参考如下代码示例：接口与多态</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//动物接口</span></span><br><span class="line"><span class="keyword">type</span> Animal <span class="keyword">interface</span>&#123;</span><br><span class="line">   eat()     <span class="comment">//吃饭接口方法</span></span><br><span class="line">   sleep()       <span class="comment">//睡觉接口方法</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小猫</span></span><br><span class="line"><span class="keyword">type</span> Cat <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小狗</span></span><br><span class="line"><span class="keyword">type</span> Dog <span class="keyword">struct</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小猫吃方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cat Cat)</span></span> eat() &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;小猫在吃饭&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小猫睡方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(cat Cat)</span></span> sleep()&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;小猫在睡觉&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小狗在吃饭</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(dog Dog)</span></span> eat()&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;小狗在吃饭&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//小狗在睡觉</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(dog Dog)</span></span> sleep()&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;小狗在睡觉&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> cat Animal = Cat&#123;&#125;</span><br><span class="line">   <span class="keyword">var</span> dog Animal = Dog&#123;&#125;</span><br><span class="line">   cat.eat()</span><br><span class="line">   cat.sleep()</span><br><span class="line">   dog.eat()</span><br><span class="line">   dog.sleep()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接口可以内嵌接口</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">//内嵌接口</span></span><br><span class="line"><span class="comment">//学习接口，内嵌听和看学习接口</span></span><br><span class="line"><span class="keyword">type</span> Learn <span class="keyword">interface</span> &#123;</span><br><span class="line">   LearnByHear</span><br><span class="line">   LearnByLook</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过听学习接口</span></span><br><span class="line"><span class="keyword">type</span> LearnByHear <span class="keyword">interface</span> &#123;</span><br><span class="line">   hear()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通过看学习</span></span><br><span class="line"><span class="keyword">type</span> LearnByLook <span class="keyword">interface</span> &#123;</span><br><span class="line">   look()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id=""><a class="markdownIt-Anchor" href="#">#</a> </h3>
<h3 id="23go语言中线程的实现和java语言中线程的实现"><a class="markdownIt-Anchor" href="#23go语言中线程的实现和java语言中线程的实现">#</a> 23.Go 语言中线程的实现和 Java 语言中线程的实现</h3>
<p>go 中的线程相关的概念是 Goroutines (并发)，是使用 go 关键字开启。</p>
<p>Java 中的线程是通过 Thread 类开启的。</p>
<p>在 go 语言中，一个线程就是一个 Goroutines，主函数就是（主） main Goroutines。</p>
<p>使用 go 语句来开启一个新的 Goroutines</p>
<p>比如：</p>
<p>普通方法执行</p>
<p>myFunction()</p>
<p>开启一个 Goroutines 来执行方法</p>
<p>go myFunction()</p>
<p>java 中是</p>
<p>new Thread(()-&gt;{</p>
<p>// 新线程逻辑代码</p>
<p>}).start();</p>
<p>参考下面的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//并发开启新线程goroutine测试</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//我的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;Hello!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//并发执行方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goroutineTestFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;Hello!!! Start Goroutine!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   myFunction()</span></span><br><span class="line"><span class="comment">   //go goroutineTestFunc()</span></span><br><span class="line"><span class="comment">   //此时因为主线程有时候结束的快，goroutineTestFunc方法得不到输出，由此可以看出是开启了新的线程。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">//打开第二段执行</span></span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   go goroutineTestFunc()</span></span><br><span class="line"><span class="comment">   time.Sleep(10*time.Second)//睡一段时间  10秒</span></span><br><span class="line"><span class="comment">   myFunction()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>线程间的通信：</p>
<p>java 线程间通信有很多种方式：</p>
<p>比如最原始的 wait/notify</p>
<p>到使用 juc 下高并发线程同步容器，Go 和 Java 关于 Socket 编程的对比同步队列</p>
<p>到 CountDownLatch 等一系列工具类</p>
<p>…</p>
<p>甚至是分布式系统不同机器之间的消息中间件，单机的 disruptor 等等。</p>
<p>Go 语言不同，线程间主要的通信方式是 Channel。</p>
<p>Channel 是实现 go 语言多个线程（goroutines）之间通信的一个机制。</p>
<p>Channel 是一个线程间传输数据的管道，创建 Channel 必须声明管道内的数据类型是什么</p>
<p>下面我们创建一个传输 int 类型数据的 Channel</p>
<p>代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">   fmt.Println(ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>channel 是引用类型，函数传参数时是引用传递而不是值拷贝的传递。</p>
<p>channel 的空值和别的应用类型一样是 nil。</p>
<p>== 可以比较两个 Channel 之间传输的数据类型是否相等。</p>
<p>channel 是一个管道，他可以收数据和发数据。</p>
<p>具体参照下面代码示例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//channel发送数据和接受数据用 &lt;-表示,是发送还是接受取决于chan在  &lt;-左边还是右边</span></span><br><span class="line"><span class="comment">//创建一个传输字符串数据类型的管道</span></span><br><span class="line"><span class="keyword">var</span>  chanStr  = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;main goroutine print Hello &quot;</span>)</span><br><span class="line">   <span class="comment">//默认channel是没有缓存的，阻塞的，也就是说，发送端发送后直到接受端接受到才会施放阻塞往下面走。</span></span><br><span class="line">   <span class="comment">//同样接收端如果先开启，直到接收到数据才会停止阻塞往下走</span></span><br><span class="line">   <span class="comment">//开启新线程发送数据</span></span><br><span class="line">   <span class="keyword">go</span> startNewGoroutineOne()</span><br><span class="line">   <span class="comment">//从管道中接收读取数据</span></span><br><span class="line">   <span class="keyword">go</span> startNewGoroutineTwo()</span><br><span class="line">   <span class="comment">//主线程等待，要不直接结束了</span></span><br><span class="line">   time.Sleep(<span class="number">100</span>*time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startNewGoroutineOne</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;send channel print Hello &quot;</span>)</span><br><span class="line">   <span class="comment">//管道发送数据</span></span><br><span class="line">   chanStr &lt;- <span class="string">&quot;Hello!!!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startNewGoroutineTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;receive channel print Hello &quot;</span>)</span><br><span class="line">   strVar := &lt;-chanStr</span><br><span class="line">   fmt.Println(strVar)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无缓存的 channel 可以起到一个多线程间线程数据同步锁安全的作用。</p>
<p>缓存的 channel 创建方式是</p>
<p>make (chan string, 缓存个数)</p>
<p>缓存个数是指直到多个数据没有消费或者接受后才进行阻塞。</p>
<p>类似于 java 中的 synchronized 和 lock</p>
<p>可以保证多线程并发下的数据一致性问题。</p>
<p>首先我们看一个线程不安全的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//多线程并发下的不安全问题</span></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA <span class="type">int</span> =<span class="number">1000</span></span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> moneyA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//正常逻辑，只够扣款一单，可以多线程环境下结果钱扣多了</span></span><br><span class="line">   time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>缓存为 1 的 channel 可以作为锁使用：</p>
<p>示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//多线程并发下使用channel改造</span></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA  = <span class="number">1000</span></span><br><span class="line"><span class="comment">//减少金额管道</span></span><br><span class="line"><span class="keyword">var</span> synchLock = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> moneyA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;-synchLock</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//这样类似于java中的Lock锁，不会扣多</span></span><br><span class="line">   time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>go 也有互斥锁</p>
<p>类似于 java 中的 Lock 接口</p>
<p>参考如下示例代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//多线程并发下使用channel改造</span></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA  = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex;</span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   lock.Lock()</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">   lock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   lock.Lock()</span><br><span class="line">   result := moneyA</span><br><span class="line">   lock.Unlock()</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//正常</span></span><br><span class="line">   time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="24go中的反射与java中的反射对比"><a class="markdownIt-Anchor" href="#24go中的反射与java中的反射对比">#</a> 24.Go 中的反射与 Java 中的反射对比</h3>
<p>整体概述：反射是一个通用的概念，是指在程序运行期间获取到变量或者对象，结构体的元信息，比如类型信息，并且能够取出其中变量的值，调用对应的方法。</p>
<p>首先我们先来回顾一下 Java 语言用到反射的场景有哪些？</p>
<p>1. 比如说我们的方法参数不能确定是什么类型，是 Object 类型，我们就可以通过反射在运行期间获取其真实的类型，然后做对应的逻辑处理。</p>
<p>2. 比如动态代理，我们需要在程序运行时，动态的加载一个类，创建一个类，使用一个类。</p>
<p>3. 比如在想要强行破解获取程序中被 private 的成员。</p>
<p>4.Java 的各种框架中用的非常多，框架中用反射来判断用户自定义的类是什么类型，然后做区别处理。</p>
<p>Go 中的反射大概也是相同的，比如，go 中有一个类型 interface,interface 类型相当于 Java 中的 Object 类，当以 interface 作为参数类型时，可以给这个参数传递任意类型的变量。</p>
<p>例如示例 1：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   testAllType(<span class="number">1</span>);</span><br><span class="line">   testAllType(<span class="string">&quot;Go&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//interface&#123;&#125;代表任意类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testAllType</span> <span class="params">(data <span class="keyword">interface</span>&#123;&#125;)</span></span>&#123;</span><br><span class="line">   fmt.Println(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么第一种应用场景就出现了，当我们在 go 中想实现一个函数 / 方法，这个函数 / 方法的参数类型在编写程序的时候不能确认，在运行时会有各种不同的类型传入这个通用的函数 / 方法中，我们需要对不同类型的参数做不同的处理，那么我们就得能获取到参数是什么类型的，然后根据这个类型信息做业务逻辑判断。</p>
<p>反射我们需要调用 reflect 包模块，使用 reflect.typeOf () 可以获取参数的类型信息对象，再根据类型信息对象的 kind 方法，获取到具体类型，详细参考下面代码。</p>
<p>例如示例 2：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   handleType(<span class="number">1</span>)</span><br><span class="line">   handleType(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleType</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">   <span class="comment">//获取类型对象</span></span><br><span class="line">   d := reflect.TypeOf(data)</span><br><span class="line">   <span class="comment">//kind方法是获取类型</span></span><br><span class="line">   fmt.Println(d.Kind())</span><br><span class="line">   <span class="keyword">switch</span> d.Kind() &#123;</span><br><span class="line">      <span class="keyword">case</span> reflect.Invalid:</span><br><span class="line">         <span class="comment">//无效类型逻辑处理</span></span><br><span class="line">         fmt.Println(<span class="string">&quot;无效类型&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> reflect.Int,reflect.Int8,reflect.Int16,reflect.Int32,reflect.Int64:</span><br><span class="line">         fmt.Println(<span class="string">&quot;整形&quot;</span>)</span><br><span class="line">      <span class="keyword">case</span> reflect.Bool:</span><br><span class="line">         fmt.Println(<span class="string">&quot;bool类型&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line">因为传入进来的都是<span class="keyword">interface</span>类型，所以我们需要用的时候要区分类型，然后取出其中真正类型的值。</span><br></pre></td></tr></table></figure>
<p>反射取出值得方法就是先通过 reflect.ValueOf () 获取参数值对象，然后再通过不同的具体方法获取到值对象，比如 int 和 bool</p>
<p>示例 3：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	handleValue(<span class="number">1</span>)</span><br><span class="line">	handleValue(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handleValue</span><span class="params">(data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">	<span class="comment">//获取类型对象</span></span><br><span class="line">	d := reflect.ValueOf(data)</span><br><span class="line">	<span class="comment">//kind方法是获取类型</span></span><br><span class="line">	fmt.Println(d.Kind())</span><br><span class="line">	<span class="keyword">switch</span> d.Kind() &#123;</span><br><span class="line">		<span class="keyword">case</span> reflect.Invalid:</span><br><span class="line">			<span class="comment">//无效类型逻辑处理</span></span><br><span class="line">			fmt.Println(<span class="string">&quot;无效类型&quot;</span>)</span><br><span class="line">		<span class="keyword">case</span> reflect.Int,reflect.Int8,reflect.Int16,reflect.Int32,reflect.Int64:</span><br><span class="line">			<span class="comment">//取出值</span></span><br><span class="line">			<span class="keyword">var</span> myNum = d.Int()</span><br><span class="line">			fmt.Println(myNum)</span><br><span class="line">		<span class="keyword">case</span> reflect.Bool:</span><br><span class="line">			<span class="comment">//取出bool值</span></span><br><span class="line">			<span class="keyword">var</span> myBool = d.Bool()</span><br><span class="line">			fmt.Println(myBool)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结构体中的属性和方法怎么获取呢？</p>
<p>获取结构体属性的个数是先 ValueOf 获取结构体值对象 v 后，用 v.NumField () 获取该结构体有几个属性，通过 v.Field (i) 来获取对应位置的属性的元类型。</p>
<p>示例代码 4：</p>
<p>后续反射还有几个 api 和代码示例和具体应用场景，正在补。。。</p>
<h3 id="25变量作用域的区别"><a class="markdownIt-Anchor" href="#25变量作用域的区别">#</a> 25. 变量作用域的区别</h3>
<p>Go 语言的变量作用域和 Java 中的一样，遵循最近原则，逐渐往外层找。</p>
<p>这个比较简单，就不做过多赘述了。</p>
<h3 id="26go语言和java语言字符串操作的区别"><a class="markdownIt-Anchor" href="#26go语言和java语言字符串操作的区别">#</a> 26.Go 语言和 Java 语言字符串操作的区别</h3>
<h3 id="27go语言和java语言io操作的区别"><a class="markdownIt-Anchor" href="#27go语言和java语言io操作的区别">#</a> 27.Go 语言和 Java 语言 IO 操作的区别</h3>
<h3 id="28go语言中有匿名函数有闭包java中没有高阶函数用法"><a class="markdownIt-Anchor" href="#28go语言中有匿名函数有闭包java中没有高阶函数用法">#</a> 28.Go 语言中有匿名函数，有闭包，Java 中没有 (高阶函数用法)</h3>
<p>函数也是一种类型，它可以作为一个参数进行传递，也可以作为一个返回值传递。</p>
<p>Go 中可以定义一个匿名函数，并把这个函数赋值给一个变量</p>
<p>示例 1： 匿名函数赋值给变量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个匿名函数并赋值给myFun变量</span></span><br><span class="line"><span class="keyword">var</span> myFun = <span class="function"><span class="keyword">func</span><span class="params">(x,y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//调用myFun</span></span><br><span class="line">   fmt.Println(myFun(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>
<p>Go 的函数内部是无法再声明一个有名字的函数的，Go 的函数内部只能声明匿名函数。</p>
<p>示例 2：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   myFunc3()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun1</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*此处报错，函数内部不能声明带有名称的函数</span></span><br><span class="line"><span class="comment">   func myFunc2() &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunc3</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//函数内部可以声明一个匿名函数，并把这个匿名函数赋值给f变量</span></span><br><span class="line">   <span class="keyword">var</span> f = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;Hi,boy!&quot;</span>)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//调用f</span></span><br><span class="line">   f()</span><br><span class="line">   <span class="comment">//如果不想赋值给变量，那就必须在最后加上(),表示立即执行</span></span><br><span class="line">   <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;Hello,girl!&quot;</span>)</span><br><span class="line">   &#125;()<span class="comment">//有参数可以写在这个小括号中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hi,boy!</span><br><span class="line">Hello,girl!</span><br></pre></td></tr></table></figure>
<p>Go 中有闭包的功能。(闭包是一个通用的编程概念，一些语言有，一些没有，javascript 中就有这个概念，Java 中没有)</p>
<p>闭包，通俗易懂的讲，就是你有一个 A 函数，A 函数有一个 a 参数，然后在 A 函数内部再定义或者调用或者写一个 B 函数，这个 B 函数叫做闭包函数。B 函数内部的代码可以访问它外部的 A 函数的 a 参数，正常 A 函数调用返回完毕，a 参数就不能用了，可是闭包函数 B 函数仍然可以访问这个 a 参数，B 函数能不受 A 函数的调用生命周期限制可以随时访问其中的 a 参数，这个能访问的状态叫做已经做了闭包，闭包闭的是把 a 参数封闭到了 B 函数中，不受 A 函数的限制。</p>
<p>也就是说，我们用程序实现一个闭包的功能，实质上就是写一个让外层的函数参数或者函数内变量封闭绑定到内层函数的功能。</p>
<p>接下来我们看代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//我们来看看实现闭包</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">var</span> f = f1(<span class="number">100</span>)</span><br><span class="line">   f(<span class="number">100</span>) <span class="comment">//print 200</span></span><br><span class="line">   f(<span class="number">100</span>) <span class="comment">//print 300</span></span><br><span class="line">   f(<span class="number">100</span>) <span class="comment">//print 400</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">(x <span class="type">int</span>)</span></span> <span class="function"><span class="keyword">func</span><span class="params">(<span class="type">int</span>)</span></span>&#123;</span><br><span class="line">   <span class="comment">//此时即使f1函数执行完毕，x也不会消失</span></span><br><span class="line">   <span class="comment">//x在func(y int)这个函数内一直存在并且叠加，</span></span><br><span class="line">   <span class="comment">//这里把x的值封闭到func(y int)这个返回函数中，使其函数一直能使用x的值</span></span><br><span class="line">   <span class="comment">//就叫做闭包，把x变量封闭到fun(y int)这个函数包内。</span></span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(y <span class="type">int</span>)</span></span>&#123;</span><br><span class="line">      x+=y</span><br><span class="line">      fmt.Printf(<span class="string">&quot;x=%d\n&quot;</span>,x)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x=200</span><br><span class="line">x=300</span><br><span class="line">x=400</span><br></pre></td></tr></table></figure>
<p>做下闭包的总结，如何实现一个闭包：</p>
<p>1. 定义一个 A 函数，此函数返回一个匿名函数。（定义一个返回匿名函数的 A 函数）</p>
<p>2. 把在 A 函数的 b 参数或 A 函数代码块中的 b 变量，放入匿名函数中，进行操作。</p>
<p>3. 这样我们调用 A 函数返回一个函数，这个函数不断的调用就可以一直使用之前 b 参数，b 变量，并且 b 值不会刷新，有点像在匿名函数外部自定义了一个 b 的成员变量（成员变量取自 Java 中类的相关概念）</p>
<h3 id="29go中的map和java中的hashmap"><a class="markdownIt-Anchor" href="#29go中的map和java中的hashmap">#</a> 29.Go 中的 map 和 Java 中的 HashMap</h3>
<p>Go 中的 map 也是一个存储 key-value，键值对的这么一种数据结构。</p>
<p>我们来看下如何使用：</p>
<p>如何创建一个 map?(map 是引用类型，默认值是 nil，必须用 make 为其创建才能使用)</p>
<p>创建一个 map 必须要用 make，否则会是 nil</p>
<p>格式为: make (map [key 类型] value 类型) (下面有代码示例)</p>
<p>往 Go 中的 map 赋值添加元素用 【 map 变量名称 [key] = value 】 的方式</p>
<p>示例 1：创建 map 以及添加元素</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//创建一个map必须要用make，否则会是nil</span></span><br><span class="line">   <span class="comment">//格式为:  make(map[key类型]value类型)</span></span><br><span class="line">   <span class="comment">//Java中:   Map&lt;String,Integer&gt; myMap = new HashMap&lt;&gt;();</span></span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">   <span class="comment">//往Go中的map赋值添加元素用 【 map变量名称[key] = value 】 的方式</span></span><br><span class="line">   <span class="comment">//区别于Java中的: myMap.put(&quot;li_age&quot;,20);</span></span><br><span class="line">   myMap[<span class="string">&quot;li_age&quot;</span>] = <span class="number">20</span></span><br><span class="line">   myMap[<span class="string">&quot;hong_age&quot;</span>] = <span class="number">30</span></span><br><span class="line">   <span class="comment">//打印一下map</span></span><br><span class="line">   fmt.Println(myMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们从 map 中取值得格式为： 【 mapValue := map 变量名 [key]】</p>
<p>当我们填写的 key 在 map 中找不到时返回对应的 value 默认值，int 是 0，引用类型是 nil</p>
<p>当我们的 key 取不到对应的值，而 value 的类型是一个 int 类型，我们如何判断这个 0 是实际值还是默认值呢</p>
<p>此时我们需要同时取两个值</p>
<p>通过 map 的 key 取出两个值，第二个参数为 bool 类型，false 为该值不存在，true 为成功取到值</p>
<p>参考下面：</p>
<p>示例 2：从 map 中取值</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//创建一个map必须要用make，否则会是nil</span></span><br><span class="line">   <span class="comment">//格式为:  make(map[key类型]value类型)</span></span><br><span class="line">   <span class="comment">//Java中:   Map&lt;String,Integer&gt; myMap = new HashMap&lt;&gt;();</span></span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">   <span class="comment">//往Go中的map赋值添加元素用 【 map变量名称[key] = value 】 的方式</span></span><br><span class="line">   <span class="comment">//区别于Java中的: myMap.put(&quot;li_age&quot;,20);</span></span><br><span class="line">   myMap[<span class="string">&quot;li_age&quot;</span>] = <span class="number">20</span></span><br><span class="line">   myMap[<span class="string">&quot;hong_age&quot;</span>] = <span class="number">30</span></span><br><span class="line">   <span class="comment">//打印一下map</span></span><br><span class="line">   fmt.Println(myMap)</span><br><span class="line">   <span class="comment">//不存在的值</span></span><br><span class="line">   fmt.Println(myMap[<span class="string">&quot;no&quot;</span>])</span><br><span class="line"></span><br><span class="line">   <span class="comment">//当我们的key取不到对应的值，而value的类型是一个int类型，我们如何判断这个0是实际值还是默认值呢</span></span><br><span class="line">   <span class="comment">//此时我们需要同时取两个值</span></span><br><span class="line">   <span class="comment">//通过map的key取出两个值，第二个参数为bool类型，false为该值不存在，true为成功取到值</span></span><br><span class="line">   value,existsValue := myMap[<span class="string">&quot;no&quot;</span>]</span><br><span class="line">   <span class="keyword">if</span> !existsValue &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;此值不存在&quot;</span>)</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">&quot;value = %d&quot;</span>,value)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Go 中因为返回值可以是两个，所以的 map 遍历很简单，不像 java 还得弄一个 Iterator 对象再逐个获取，它一次两个都能取出来，用 for 搭配 range 即可实现。</p>
<p>示例 3：遍历</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">   myMap[<span class="string">&quot;num1&quot;</span>] = <span class="number">1</span></span><br><span class="line">   myMap[<span class="string">&quot;num2&quot;</span>] = <span class="number">2</span></span><br><span class="line">   myMap[<span class="string">&quot;num3&quot;</span>] = <span class="number">3</span></span><br><span class="line">   myMap[<span class="string">&quot;num4&quot;</span>] = <span class="number">4</span></span><br><span class="line">   myMap[<span class="string">&quot;num5&quot;</span>] = <span class="number">5</span></span><br><span class="line">   myMap[<span class="string">&quot;num6&quot;</span>] = <span class="number">6</span></span><br><span class="line">   <span class="comment">//遍历key,value</span></span><br><span class="line">   <span class="keyword">for</span> key,value := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">      fmt.Println(key,value)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//写一个参数的时候只取key</span></span><br><span class="line">   <span class="keyword">for</span> key := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">      fmt.Println(key)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//如果只想取value，就需要用到之前的_标识符进行占位丢弃</span></span><br><span class="line">   <span class="keyword">for</span> _,value := <span class="keyword">range</span> myMap &#123;</span><br><span class="line">      fmt.Println(value)</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>删除函数：用内置函数 delete 删除</p>
<p>示例 4：删除 map 元素</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>)</span><br><span class="line">   myMap[<span class="string">&quot;num1&quot;</span>] = <span class="number">1</span></span><br><span class="line">   myMap[<span class="string">&quot;num2&quot;</span>] = <span class="number">2</span></span><br><span class="line">   myMap[<span class="string">&quot;num3&quot;</span>] = <span class="number">3</span></span><br><span class="line">   myMap[<span class="string">&quot;num4&quot;</span>] = <span class="number">4</span></span><br><span class="line">   myMap[<span class="string">&quot;num5&quot;</span>] = <span class="number">5</span></span><br><span class="line">   myMap[<span class="string">&quot;num6&quot;</span>] = <span class="number">6</span></span><br><span class="line">   <span class="comment">//第二个参数为删除的key</span></span><br><span class="line">   <span class="built_in">delete</span>(myMap,<span class="string">&quot;num6&quot;</span>)</span><br><span class="line">   <span class="comment">//此时已经没有值了，默认值为0</span></span><br><span class="line">   fmt.Println(myMap[<span class="string">&quot;num6&quot;</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Java 中有一些复杂的 Map 类型，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String,Map&lt;String,Object&gt;&gt; data = new HashMap&lt;&gt;();</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>实际上，在 Go 语言中，也有复杂的类型，我们举几个代码示例</p>
<p>示例 5：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//由map组成的切片</span></span><br><span class="line">   <span class="comment">//第一部分 make[] 声明切片</span></span><br><span class="line">   <span class="comment">//第二部分 map[string]int  声明该切片内部装的单个类型是map</span></span><br><span class="line">   <span class="comment">//第三部分 参数 5 表示该切片的长度和容量都是5</span></span><br><span class="line">   <span class="comment">//长度是用索引能取到第几个元素，索引不能超过长度-1，分配长度后都是默认值，int是0，引用类型是nil</span></span><br><span class="line">   <span class="comment">//容量至少比长度大，能索引到几个+未来可添加元素个数(目前没有任何东西，看不见)= 切片容量</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度，切片容量)</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度和容量等同)</span></span><br><span class="line">   slice := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line">   slice0 := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">   <span class="comment">//我们看看打印的东西</span></span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=&quot;</span>,slice)</span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=0&quot;</span>,slice0)</span><br><span class="line"></span><br><span class="line">   <span class="comment">///*   先看这段</span></span><br><span class="line">   <span class="comment">//因为有5个长度，所以初始化了5个map，但是map没有通过make申请内容空间，所以报错nil map</span></span><br><span class="line">   <span class="comment">//slice[0][&quot;age&quot;] = 10;//报错</span></span><br><span class="line">   <span class="comment">//下面不报错</span></span><br><span class="line">   slice[<span class="number">0</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">10</span>)</span><br><span class="line">   slice[<span class="number">0</span>][<span class="string">&quot;age&quot;</span>] = <span class="number">19</span></span><br><span class="line">   fmt.Println(slice[<span class="number">0</span>][<span class="string">&quot;age&quot;</span>])</span><br><span class="line">   <span class="comment">//*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">slice= [map[] map[] map[] map[] map[]]</span><br><span class="line">slice=0 []</span><br><span class="line">19</span><br><span class="line">123</span><br></pre></td></tr></table></figure>
<p>接下来继续看代码：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//由map组成的切片</span></span><br><span class="line">   <span class="comment">//第一部分 make[] 声明切片</span></span><br><span class="line">   <span class="comment">//第二部分 map[string]int  声明该切片内部装的单个类型是map</span></span><br><span class="line">   <span class="comment">//第三部分 参数 5 表示该切片的长度和容量都是5</span></span><br><span class="line">   <span class="comment">//长度是用索引能取到第几个元素，索引不能超过长度-1，分配长度后都是默认值，int是0，引用类型是nil</span></span><br><span class="line">   <span class="comment">//append元素到切片时，是添加到最末尾的位置，当元素未超过容量时，都是用的同一个底层数组</span></span><br><span class="line">   <span class="comment">//超过容量时会返回一个新的数组</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度，切片容量)</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度和容量等同)</span></span><br><span class="line">   slice := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line">   slice0 := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">   <span class="comment">//我们看看打印的东西</span></span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=&quot;</span>,slice)</span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=0&quot;</span>,slice0)</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*   先看这段</span></span><br><span class="line"><span class="comment">   //因为有5个长度，所以初始化了5个map，但是map没有通过make申请内容空间，所以报错nil map</span></span><br><span class="line"><span class="comment">   //slice[0][&quot;age&quot;] = 10;//报错</span></span><br><span class="line"><span class="comment">   //下面不报错</span></span><br><span class="line"><span class="comment">   slice[0] = make(map[string]int,10)</span></span><br><span class="line"><span class="comment">   slice[0][&quot;age&quot;] = 19</span></span><br><span class="line"><span class="comment">   fmt.Println(slice[0][&quot;age&quot;])</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panic: assignment to entry in nil map</span><br></pre></td></tr></table></figure>
<p>看下面这个报错：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//由map组成的切片</span></span><br><span class="line">   <span class="comment">//第一部分 make[] 声明切片</span></span><br><span class="line">   <span class="comment">//第二部分 map[string]int  声明该切片内部装的单个类型是map</span></span><br><span class="line">   <span class="comment">//第三部分 参数 5 表示该切片的长度和容量都是5</span></span><br><span class="line">   <span class="comment">//长度是用索引能取到第几个元素，索引不能超过长度-1，分配长度后都是默认值，int是0，引用类型是nil</span></span><br><span class="line">   <span class="comment">//append元素到切片时，是添加到最末尾的位置，当元素未超过容量时，都是用的同一个底层数组</span></span><br><span class="line">   <span class="comment">//超过容量时会返回一个新的数组</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度，切片容量)</span></span><br><span class="line">   <span class="comment">//make([]切片类型,切片长度和容量等同)</span></span><br><span class="line">   slice := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">5</span>,<span class="number">10</span>)</span><br><span class="line">   slice0 := <span class="built_in">make</span>([]<span class="keyword">map</span>[<span class="type">string</span>]<span class="type">int</span>,<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">   <span class="comment">//我们看看打印的东西</span></span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=&quot;</span>,slice)</span><br><span class="line">   fmt.Println(<span class="string">&quot;slice=0&quot;</span>,slice0)</span><br><span class="line"></span><br><span class="line">   <span class="comment">/*   先看这段</span></span><br><span class="line"><span class="comment">   //因为有5个长度，所以初始化了5个map，但是map没有通过make申请内容空间，所以报错nil map</span></span><br><span class="line"><span class="comment">   //slice[0][&quot;age&quot;] = 10;//报错</span></span><br><span class="line"><span class="comment">   //下面不报错</span></span><br><span class="line"><span class="comment">   slice[0] = make(map[string]int,10)</span></span><br><span class="line"><span class="comment">   slice[0][&quot;age&quot;] = 19</span></span><br><span class="line"><span class="comment">   fmt.Println(slice[0][&quot;age&quot;])</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">///*</span></span><br><span class="line">   <span class="comment">//因为初始化了0个长度，所以索引取不到值，报index out of range</span></span><br><span class="line">   slice0[<span class="number">0</span>][<span class="string">&quot;age&quot;</span>] = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice= [mappanic: runtime error: index out of range</span><br></pre></td></tr></table></figure>
<p>接下来我们看一个：类似于 Java 中常用的 map 类型</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//类似于Java中的Map&lt;String,HashMap&lt;String,Object&gt;&gt;</span></span><br><span class="line">   <span class="keyword">var</span> myMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;,<span class="number">10</span>)</span><br><span class="line">   fmt.Println(myMap)</span><br><span class="line">   <span class="comment">//记得make</span></span><br><span class="line">   myMap[<span class="string">&quot;li_ming_id_123&quot;</span>] = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;,<span class="number">5</span>)</span><br><span class="line">   myMap[<span class="string">&quot;li_ming_id_123&quot;</span>][<span class="string">&quot;school&quot;</span>] = <span class="string">&quot;清华大学&quot;</span></span><br><span class="line"></span><br><span class="line">   fmt.Println(myMap)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map[]</span><br><span class="line">map[li_ming_id_123:map[school:清华大学]]</span><br></pre></td></tr></table></figure>
<h3 id="30go中的time时间包模块和java中的时间api使用区别"><a class="markdownIt-Anchor" href="#30go中的time时间包模块和java中的时间api使用区别">#</a> 30.Go 中的 time 时间包模块和 Java 中的时间 API 使用区别</h3>
<p>Go 中关于时间处理的操作在 time 包中</p>
<p>1. 基本获取时间信息</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//获取当前时间</span></span><br><span class="line">   now := time.Now()</span><br><span class="line">   <span class="comment">//获取当前年份</span></span><br><span class="line">   year := now.Year()</span><br><span class="line">   <span class="comment">//获取当前月份</span></span><br><span class="line">   month := now.Month()</span><br><span class="line">   <span class="comment">//获取当前 日期</span></span><br><span class="line">   day := now.Day()</span><br><span class="line">   <span class="comment">//获取当前小时</span></span><br><span class="line">   hour := now.Hour()</span><br><span class="line">   <span class="comment">//获取当前分钟</span></span><br><span class="line">   min := now.Minute()</span><br><span class="line">   <span class="comment">//获取当前秒</span></span><br><span class="line">   second :=now.Second()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//获取当前时间戳，和其它编程语言一样，自1970年算起</span></span><br><span class="line">   timestamp := now.Unix()</span><br><span class="line">   <span class="comment">//纳秒时间戳</span></span><br><span class="line">   ntimestamp := now.UnixNano()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   fmt.Println(<span class="string">&quot;year=&quot;</span>,year)</span><br><span class="line">   fmt.Println(<span class="string">&quot;month=&quot;</span>,month)</span><br><span class="line">   fmt.Println(<span class="string">&quot;day=&quot;</span>,day)</span><br><span class="line">   fmt.Println(<span class="string">&quot;hour=&quot;</span>,hour)</span><br><span class="line">   fmt.Println(<span class="string">&quot;min=&quot;</span>,min)</span><br><span class="line">   fmt.Println(<span class="string">&quot;second=&quot;</span>,second)</span><br><span class="line">   fmt.Println(<span class="string">&quot;timestamp=&quot;</span>,timestamp)</span><br><span class="line">   fmt.Println(<span class="string">&quot;ntimestamp=&quot;</span>,ntimestamp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2. 格式化时间</p>
<p>Go 的时间格式化和其它语言不太一样，它比较特殊，取了 go 的出生日期作为参数标准</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//获取当前时间</span></span><br><span class="line">   now := time.Now()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//2006-01-02 15:04:05这个数值是一个标准写死的，只要改格式符号即可</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>))</span><br><span class="line">   fmt.Println(now.Format(<span class="string">&quot;2006/01/02 15:04:05&quot;</span>))</span><br><span class="line">   fmt.Println(now.Format(<span class="string">&quot;2006/01/02&quot;</span>))<span class="comment">//年月日</span></span><br><span class="line">   fmt.Println(now.Format(<span class="string">&quot;15:04:05&quot;</span>))<span class="comment">//时分秒</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="31go和java关于socket编程的对比"><a class="markdownIt-Anchor" href="#31go和java关于socket编程的对比">#</a> 31.Go 和 Java 关于 Socket 编程的对比</h3>
<h3 id="32聊聊go语言如何连接mysql数据库"><a class="markdownIt-Anchor" href="#32聊聊go语言如何连接mysql数据库">#</a> 32. 聊聊 Go 语言如何连接 Mysql 数据库</h3>
<h3 id="33聊聊go语言如何使用redis"><a class="markdownIt-Anchor" href="#33聊聊go语言如何使用redis">#</a> 33. 聊聊 Go 语言如何使用 Redis</h3>
<h3 id="34go中的依赖管理module对比java的maven"><a class="markdownIt-Anchor" href="#34go中的依赖管理module对比java的maven">#</a> 34.Go 中的依赖管理–Module, 对比 Java 的 maven</h3>
<h3 id="35go的协程高并发支持与java的区别"><a class="markdownIt-Anchor" href="#35go的协程高并发支持与java的区别">#</a> 35.Go 的协程高并发支持与 Java 的区别</h3>
<h3 id="36go的性能调优和java的性能调优"><a class="markdownIt-Anchor" href="#36go的性能调优和java的性能调优">#</a> 36.Go 的性能调优和 Java 的性能调优</h3>
<h3 id="37go的测试api与java的单元测试"><a class="markdownIt-Anchor" href="#37go的测试api与java的单元测试">#</a> 37.Go 的测试 API 与 Java 的单元测试</h3>
<h3 id="38自定义类型type"><a class="markdownIt-Anchor" href="#38自定义类型type">#</a> 38. 自定义类型 Type</h3>
<h3 id="39go的参数值传递与引用传递"><a class="markdownIt-Anchor" href="#39go的参数值传递与引用传递">#</a> 39.Go 的参数值传递与引用传递</h3>
<p>接下来我们讲一下 Go 中的参数传递原理。</p>
<p>关于参数传递是一个什么概念呢，参数传递相关的知识是在研究当调用一个函数时，把外部的一个变量传入函数内，在函数内修改这个参数是否会对外部的参数变量的值有影响。参数传递用在的一个地方是函数的参数传递。（还有方法的接收器参数传递）</p>
<p>比如李明今天没有写作业，到了学校后匆匆忙忙的找小红要作业本 (小红的作业本为方法调用处传入的参数)，想要抄一抄补上，所以李明有一个抄作业的任务 (抄作业的任务为函数)，那么他有两个选择可以完成抄作业的任务。</p>
<p>第一个是直接拿过来小红的作业本开始抄，这在函数中叫做引用传递，因为如果小明抄的时候不小心桌子上的水打翻了，弄湿了小红的作业本，小红的作业本就真湿了，没法交了。</p>
<p>第二个是用打印机把小红的作业打印一份，然后拿着打印的那份抄，这叫做值传递，也就是说我拷贝一份值来用，那么我在抄作业 (任务函数内) 无论怎么弄湿小红的作业本，小红真正的自己的作业本也不受到影响。</p>
<p>在编程语言的函数中，如果是值传递，则是一个拷贝，在方法内部修改该参数值无法对其本身造成影响，如果是引用传递的概念，则可以改变其对象本身的值。</p>
<p>在 Go 语言中只有值传递，也是是说，无论如何 Go 的参数传递的都是一个拷贝。</p>
<p>重点来了：</p>
<p>Go 中的值传递有两种类型，如下：</p>
<p>1. 第一种值传递是具体的类型对象值传递，可能是 int,string,struct 之类的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在此时，如果我们要自定义一个struct类型，传入参数中，可能遇到一个坑，因为是值传递，所以会拷贝一个struct对象，如果这个对象占内存比较大，而且这个函数调用频繁，会大量的拷贝消耗性能资源。</span><br></pre></td></tr></table></figure>
<p>2. 第二种传递是叫指针参数类型的值传递，此时参数是一个指针类型，到具体的方法中，我们的参数也要用指针类型的参数接受，但是此时 Go 语言的内部做了一个黑箱操作。</p>
<p>举例 (下面还有完整可执行代码示例，先文字和伪代码举例)：</p>
<p>我们有一个类型为 Boy 的结构体，还有一个方法 Mod</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func Mod(b  *Boy)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个 Mod 方法的参数是一个指针类型的 Boy 对象，</p>
<p>我们要调用的时候应该这样传参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var boy = Boy&#123;&#125; </span><br><span class="line">//用&amp;取boy对象的指针地址，然后传入Mod方法</span><br><span class="line">Mod(&amp;boy)</span><br></pre></td></tr></table></figure>
<p>我们看看下面的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Boy 结构体</span></span><br><span class="line"><span class="keyword">type</span> Boy <span class="keyword">struct</span> &#123;</span><br><span class="line">   name <span class="type">string</span></span><br><span class="line">   age <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Mod</span><span class="params">(b *Boy)</span></span> &#123;</span><br><span class="line">   <span class="comment">//这个是获取调用方法传入的参数的地址值</span></span><br><span class="line">   fmt.Printf(<span class="string">&quot;b的值(之前boy的地址)是%p\n&quot;</span>,b)</span><br><span class="line">   <span class="comment">//这个是获取本函数中 b这个指针变量的地址</span></span><br><span class="line">   fmt.Printf(<span class="string">&quot;b这个指针自己的地址是=%p\n&quot;</span>,&amp;b)</span><br><span class="line">   <span class="comment">//打印值</span></span><br><span class="line">   <span class="comment">//这里自动转换使指针可以直接点出来属性</span></span><br><span class="line">   fmt.Println(b.name,b.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    boy := Boy&#123;<span class="string">&quot;li_ming&quot;</span>,<span class="number">20</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;main函数中的boy地址是:%p\n&quot;</span>,&amp;boy)</span><br><span class="line">    <span class="comment">//将boy的地址 放入Mod函数的参数中</span></span><br><span class="line">    Mod(&amp;boy)</span><br><span class="line">    <span class="comment">//注意！！！下面有黑箱操作：</span></span><br><span class="line">    <span class="comment">/* //在&amp;boy并放入Mod传递的过程中实际上做了如下黑箱操作</span></span><br><span class="line"><span class="comment">    b := new(Boy)   //创建一个名为b的类型为Boy的指针变量</span></span><br><span class="line"><span class="comment">    b = &amp;boy      //把boy的地址存入b这个指针变量内</span></span><br><span class="line"><span class="comment">    //接着把b放入func Mod(b *Boy)的参数中，然后，开始执行Mod方法。</span></span><br><span class="line"><span class="comment">    fmt.Println(b.name,b.age)</span></span><br><span class="line"><span class="comment">    fmt.Printf(&quot;b的地址是:%p\n&quot;,&amp;b)</span></span><br><span class="line"><span class="comment">    fmt.Printf(&quot;b的值是:%p\n&quot;,b)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //输出结果</span></span><br><span class="line"><span class="comment">    //main函数中的boy地址是:0x10aec0c0</span></span><br><span class="line"><span class="comment">    //li_ming 20</span></span><br><span class="line"><span class="comment">    //b的地址是:0x10ae40f8</span></span><br><span class="line"><span class="comment">    //b的值是:0x10aec0c0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*//以下代码无用，是指为了加深理解new，可以试试输出结果</span></span><br><span class="line"><span class="comment">    boy2 := new(Boy)</span></span><br><span class="line"><span class="comment">    fmt.Printf(&quot;main函数中new的boy2地址是:%p\n&quot;,boy2)</span></span><br><span class="line"><span class="comment">    boy2.name = &quot;xiaohong&quot;</span></span><br><span class="line"><span class="comment">    boy2.age = 18</span></span><br><span class="line"><span class="comment">    Mod(boy2)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以，Go 中的参数传递所有的都是值传递，</p>
<p>只不过值传递中，值可以是指针类型，是创建了一个新的指针存储原来参数 (这个参数是原对象的地址) 的值。</p>
<p>所以你用原对象的地址改它的属性，是有点类似于引用类型传递的效果的。</p>
<p>为啥说指针类型也是值传递，因为他还是创建了一个新的指针对象，值传递就是拷贝，拷贝就得创建对象，只不过这个新的指针变量存储的值是原来的参数对象的地址。</p>
<p>最后总结一下：</p>
<p>1.Go 的参数传递都是值传递。</p>
<p>2. 指针类型的值传递可以改变原来对象的值。</p>
<p>3.make 和 new 从底层原理上创建的所有对象都是指针对象，所以 make 和 new 创建出来的 slice,map,chan 或者其它任何对象都是指针传递，改变值后都可以使原来的对象属性发生变化。</p>
<h3 id="40结构体转json"><a class="markdownIt-Anchor" href="#40结构体转json">#</a> 40. 结构体转 JSON</h3>
<h3 id="41go如何搭建http-server"><a class="markdownIt-Anchor" href="#41go如何搭建http-server">#</a> 41.Go 如何搭建 HTTP-Server</h3>
<h3 id="42go如何搭建http-client"><a class="markdownIt-Anchor" href="#42go如何搭建http-client">#</a> 42.Go 如何搭建 HTTP-Client</h3>
<h3 id="43go如何设置使用的cpu个数"><a class="markdownIt-Anchor" href="#43go如何设置使用的cpu个数">#</a> 43.Go 如何设置使用的 CPU 个数</h3>
<p>Go 语言天生支持高并发，其中一个体现就是如果你的 Go 程序不设置并发时使用的最大 cpu 核数的话，在高并发情况下 Go 会自动把所有 CPU 都用上，跑满。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">拓展阅读：</span><br><span class="line">我们简单理解一下cpu（懂得可以跳过）</span><br><span class="line">    举例：比如有一个专门做财务的公司(计算机)，他们的赚钱业务很简单(计算机工作)，就是帮别人做算术题(计算机工作的具体任务)，加减乘除之类的算术题，现在公司有4个员工(物理意义上的4个cpu核数)，有4本算数书(4个进程)，每本书有10道题(线程)，一共有40道算术题要算(40个线程任务)，于是4个人一起干活，在同一时间，有4道算术题被计算，最后大致上每个人算了10道算数题。</span><br><span class="line">    第二天，有8本算术书(8个进程)，他们为了快速完成任务，规定一人(每个人是一个物理cpu核数)管2本算数书(单物理cpu内部实际上是管理的两个不同的算数书，也就是相当于有两个不同的逻辑cpu)，为的就是如果第一本做烦了可以换着做第2本，混合着做，最后都做完就可以。</span><br><span class="line"></span><br><span class="line">    cpu是进行最终二进制计算的核心计算器，cpu核数是有两个概念，一个是真实世界的物理硬件核数，比如4核cpu,就是有4个物理硬件内核，然而我们在生产环境的linux服务器上top的时候，出现的cpu个数实际上是逻辑cpu数，有可能linux服务器只有4核物理cpu,可是每个物理cpu分为两个逻辑cpu，这个时候我们在linux上top看的时候就是有8个cpu信息行数据。</span><br></pre></td></tr></table></figure>
<p>我们回顾一下 Java，Java 运行时我们一般管理的都是线程数，而所有的 java 线程均在 JVM 这个虚拟机进程中，于是在高并发情况下，当 cpu 资源充足时，我们需要根据 cpu 的逻辑核数来确定我们的线程池线程数 (在高并发环境下一定要设置优化线程数啊！！！线程池就能设置线程数！！！)，比如我们是 4 个物理 cpu, 每个双核逻辑，一共逻辑八核 cpu, 此时，比如我们要做并发定时任务，这台服务器没有其它程序，8 个 cpu 全都给我们自己用，那么我们的线程数最少也要设置成 8，再细化，我们得根据程序执行的任务分别在 cpu 计算 (正常处理程序业务逻辑) 的耗时和 cpuIO 耗时（IO 耗时比如查 mysql 数据库数据），假如我们定时跑批任务一个任务计算用时 0.2 秒，查数据库 0.8 秒 (自己可以写程序监测)，那么可以参考如下公式：</p>
<p>总任务耗时 /cpu 耗时 = 多少个线程 (每个逻辑 cpu)</p>
<p>我们算出每个逻辑 cpu 要跑多少个线程后再乘以逻辑 cpu 的个数，就能算出来了</p>
<p>如下：</p>
<p>(0.2+0.8)/0.2=5 个线程 (每个逻辑 cpu)</p>
<p>5*8 = 40</p>
<p>于是我们在线程池的时候应该这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService fixedThreadPool = Executors.newFixedThreadPool(40);</span><br></pre></td></tr></table></figure>
<p>至于公式为什么要这么写，是因为 IO 操作的时候，cpu 是空闲的，也就是说，0.8 秒数据库操作的时候，cpu 都是空闲的，那么我们就多开几个线程让 cpu 在这 0.8 秒的时候工作，开几个呢，要等 0.8 秒，一个任务 cpu 要计算 0.2 秒，0.8/0.2=4 (个)，可是这个逻辑 cpu 还有一个主线程在那 0.8 秒上等着结果呢，所以是 4+1=5（个）线程。</p>
<p>上述我们回顾了 Java 中的线程数和 CPU 核数相关，接下来我们来看 Go 语言。</p>
<p>我们下面来仔细讲讲 Go 中的 goroutine (实际是协程)，是如何天然的支持高并发的，它与 Java 中的线程 Thread 又有什么区别，为什么它比线程能更好的支持高并发。</p>
<h3 id="44初始化结构体匿名结构体结构体指针再讲"><a class="markdownIt-Anchor" href="#44初始化结构体匿名结构体结构体指针再讲">#</a> 44. 初始化结构体，匿名结构体，结构体指针 (再讲)</h3>
<h3 id="45方法中的值接收和指针接收的区别方法进阶细节讲解"><a class="markdownIt-Anchor" href="#45方法中的值接收和指针接收的区别方法进阶细节讲解">#</a> 45. 方法中的值接收和指针接收的区别 (方法进阶细节讲解)</h3>
<p>我们之前讲了如果给一个类型绑定上一个接受者，就可以为这个类型添加一个这个类型独有的函数，只有这个类型对象自己能调用的函数，这个特殊的函数叫方法。</p>
<p>现在，我们讲一下方法关于传递接受者（自身引用）的进阶玩法。</p>
<p>Go 语言中的参数传递</p>
<h3 id="46基于包模块的init函数"><a class="markdownIt-Anchor" href="#46基于包模块的init函数">#</a> 46. 基于包模块的 Init 函数</h3>
<h3 id="47go-语言中的初始化依赖项"><a class="markdownIt-Anchor" href="#47go-语言中的初始化依赖项">#</a> 47.Go 语言中的初始化依赖项</h3>
<h3 id="48slice相关知识点"><a class="markdownIt-Anchor" href="#48slice相关知识点">#</a> 48.slice 相关知识点</h3>
<p>slice 的中文意思是切片。</p>
<p>要想理解切片，我们首先要理解数组。</p>
<p>数组是一个长度不能变化的容器，存储同一数据类型的数据。</p>
<p>比如：int 数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1,2,3,4,5,6]</span><br></pre></td></tr></table></figure>
<p>切片是对数组中一截，一小段，一个子集的地址的截取，切片存储的是它指向的底层数组中的一小截数据的地址，切片中不存数据，创建切片也不会把数组中的数据 copy 一份，切片只是存储着数组中一部分连续的数据的地址，切片的每一个元素实际上都指向具体的数组的中一个元素。</p>
<p>切片内部包含三个元素：</p>
<p>1. 底层数组（它指向的是哪一个数组）</p>
<p>我们要理解底层数组是什么，先举例：</p>
<p>[1,2,3] 这是一个 int 数组，其中元素 1 的地址是 0x0001, 元素 2 的地址是 0x0002，元素 3 的地址是 0x0003。</p>
<p>那么如果我们创建一个通过数组 [1,2,3] 创建一个切片 x。</p>
<p>这个 x 里面存储的并不是拷贝的另外一份新的 [1,2,3]。</p>
<p>切片 x 实际上是这样子的：</p>
<p>[0x0001,0x0002,0x0003]</p>
<p>当我们取出 x [0] 的时候，它操作的实际上是 0x0001 这个地址的元素，而这个地址实际上就是数组 [1,2,3] 中的 1 的地址。</p>
<p>也就是说，当我们修改了数组 [1,2,3] 中的 1 后，比如 0x0001 = 5 , 切片 x 中的 0 元素的取值自动也不一样了，因为 0x0001 地址上存储的 值已经被改成 5 了，而 x [0] 实际上还是 0x0001, 所以此时取出 x [0], 得到的就是 5。</p>
<p>切片存储的每一个元素实际上是它指向的底层数组的每一个元素的地址。</p>
<p>也就是说切片是一个引用类型，它不存储元素，不拷贝元素，它存储数组元素的引用，通过修改切片会修改原来数组的值。</p>
<p>2. 切片的长度</p>
<p>这个切片中有有几个元素，指向了数组中的几个连续的元素。</p>
<p>3. 切片的容量</p>
<p>从切片在底层数组的起始下标 (切片的首个元素) 到底层数组的最后一个元素，一共有几个元素，切片的容量就是几。</p>
<p>例如：(下面先用伪代码示例，后面有具体可执行代码)</p>
<p>原数组：a = [1,2,3,4,5,6,7,8]</p>
<p>切片: b = a [2:5] 从数组 a 的下标为 2 的开始，也就是具体数值是 3 开始，截取到下标为 5，下标为 5 的是 6，因为切片截取是左开右闭，所以切片中包括下标为 2 的数值 3，不包含下标为 5 的数值 6。</p>
<p>切片存储的地址指向的数据是：[3,4,5]</p>
<p>因为 3，4，5 有三个数，所以切片的长度是 3。</p>
<p>因为从切片的起始元素 3 到底层数组的末尾元素 8 之间有 6 个元素，所以切片的容量是 6。</p>
<p>修改切片实际上是修改切片指向的底层数组中的值。</p>
<h3 id="49go中类似于函数指针的功能"><a class="markdownIt-Anchor" href="#49go中类似于函数指针的功能">#</a> 49.Go 中类似于函数指针的功能</h3>
<p>Go 中要实现函数指针非常简单。</p>
<p>因为 Go 中的函数也是一种类型。</p>
<p>所以我们只要声明一个变量，把某一个函数赋值给这个变量，就能实现函数指针的效果。</p>
<p>如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//加法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myAddFun</span><span class="params">(x,y <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> x+y</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//减法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">mySubFun</span><span class="params">(x,y <span class="type">int</span> )</span></span> <span class="type">int</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> x-y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//函数变量(类似于函数指针)</span></span><br><span class="line"><span class="keyword">var</span> myPointFun <span class="function"><span class="keyword">func</span><span class="params">(x,y <span class="type">int</span>)</span></span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//加法函数赋值给该函数变量，相当于函数指针指向加法函数</span></span><br><span class="line">   myPointFun = myAddFun</span><br><span class="line">   fmt.Printf(<span class="string">&quot;a+b = %d\n&quot;</span>,myPointFun(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line">   <span class="comment">//减法函数赋值给该函数变量，相当于函数指针指向减法函数</span></span><br><span class="line">   myPointFun = mySubFun</span><br><span class="line">   fmt.Printf(<span class="string">&quot;a-b = %d\n&quot;</span>,myPointFun(<span class="number">100</span>,<span class="number">50</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a+b = 30</span><br><span class="line">a-b = 50</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<h3 id="50go有没有注解"><a class="markdownIt-Anchor" href="#50go有没有注解">#</a> 50.Go 有没有注解</h3>
<p>原生的 Go 语言的 SDK 是不支持注解功能的，但是有一些其它的第三方机构为了实现自己的某些功能需求编写了一些自定义的注解。</p>
<h3 id="51go不能做大数据相关的开发"><a class="markdownIt-Anchor" href="#51go不能做大数据相关的开发">#</a> 51.Go 不能做大数据相关的开发</h3>
<p>因为大数据的一些底层都是 Java 开发的，用 Java 实现接口开发功能非常方便快捷，对于 Go 语言的支持包比较少，另外就是一些算法库像 numpy,pandas 和一些机器学习，深度学习算法库 Python 支持的比较好，对于 Go 的支持很不好。</p>
<h3 id="52go没有泛型"><a class="markdownIt-Anchor" href="#52go没有泛型">#</a> 52.Go 没有泛型</h3>
<p>Go 中不支持泛型 (明确)</p>
<h3 id="53go如何产生随机数随机数和种子"><a class="markdownIt-Anchor" href="#53go如何产生随机数随机数和种子">#</a> 53.Go 如何产生随机数 (随机数和种子)</h3>
<h3 id="54go如何打类似于java-jar那种依赖包a的工具依赖包有了module后不用这个了"><a class="markdownIt-Anchor" href="#54go如何打类似于java-jar那种依赖包a的工具依赖包有了module后不用这个了">#</a> 54.Go 如何打类似于 (java jar 那种依赖包).a 的工具依赖包 (有了 Module 后不用这个了)</h3>
<p>Go 中也有很多通过命令来完成辅助开发的工具，就像 Java 中 jdk 中的 java javac javap 等指令那种命令工具。</p>
<p>比如有 go build xxx 命令，go clean xxx 命令， go run xxx 命令…</p>
<p>Java 中打 jar 包可以通过 IDEA 集成开发环境图形界面化直接打包，也可以使用 jar 命令在命令行操作中 (使用不同的参数) 进行打包。</p>
<p>与 java jar 命令打包对应的 Go 的命令是 go install, 这个 go install 也类似于 maven 中的 install, 它会把打成的.a 后缀名结尾的工具包文件</p>
<p>放入 ${GOPATH} /pkg 下。</p>
<p>具体使用如下示例：</p>
<p>注意：使用 go install 之前必须在操作系统的环境变量中定义 ${GOPATH} 这个环境变量</p>
<p>1. 查看我们当前的操作系统中环境变量有没有定义 GOPATH。</p>
<p>2. 查看 ${GOPATH} 目录下是否有 src,pkg,bin 目录，并且保证我们的代码是在 src 下的。</p>
<p>3. 打开一个命令行窗口，比如 windows 是 cmd 打开一个 dos 窗口。</p>
<p>4. 我们在最开始之前已经把 go 的安装包下的包含 Go 操作指令的 bin 目录配置在了 PATH 环境变量中，所以此时我们可以不用管目录直接使用 go install 命令。</p>
<ol>
<li>例如目录结构如下：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.mashibing.gotest</span><br></pre></td></tr></table></figure>
<p>-------------------------mygopackge</p>
<p>MyUtil.go</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">记住一点，此时MyUtil中不能是main包，也不能有main函数，否则打不出来.a结尾的依赖包。</span><br></pre></td></tr></table></figure>
<p>此时编写执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go  install com/mashibing/gotest/mygopackge</span><br></pre></td></tr></table></figure>
<p>此指令运行时，首先会去找 ${GOPATH} 目录</p>
<p>然后把后面的 com/mashibing/gotest/mygopackge 拼接上去</p>
<p>也就是 ${GOPATH}/com/mashibing/gotest/mygopackge</p>
<p>然后会把 ${GOPATH}/com/mashibing/gotest/mygopackge 下的所有.go 文件，比如 MyUtil.go 全部打包压缩进 mygopackge.a 文件</p>
<p>最后会把 mygopackage.a 放入 G O P A T H /p k g / {GOPATH}/pkg/<em>GOP<strong>A</strong>T**H</em>/<em>p<strong>k</strong>g</em>/{标示操作系统的一个名字 (这个不重要)}/com/mashibing/gotest/ 下。</p>
<p>最终.a 文件存储的结构是这样的：</p>
<p>${GOPATH}/pkg/com/mashibing/gotest/mygopackge.a</p>
<h3 id="55go中的依赖管理module使用"><a class="markdownIt-Anchor" href="#55go中的依赖管理module使用">#</a> 55.Go 中的依赖管理 Module 使用</h3>
<h4 id="1什么是gomodulego中module和包的区别"><a class="markdownIt-Anchor" href="#1什么是gomodulego中module和包的区别">#</a> 1. 什么是 GoModule?(Go 中 Module 和包的区别？)</h4>
<p>首先我们要理解一下 Go 的 Module 是一个什么概念？</p>
<p>我先简单的说一下，Go 中的 Module 是 GoSDK1.11 后提出的一个新的类似于包的机制，叫做模块，在 1.13 版本后成熟使用，GoSDK 中 Module 功能是和相当于一个包的增强版，一个模块类型的项目在根目录下必须有一个 go.mod 文件，这个模块项目内部可以有很多个不同的包，每个包下有不同的代码，我们下载依赖的时候是把这个模块下载下来 (模块以压缩包 (比如 zip) 的形式存储在 G O P A T H /p k g /m o d /c a c h e / 下，源码文件也会在 {GOPATH}/pkg/mod/cache/ 下，源码文件也会在<em> GOP<strong>A</strong>T**H</em>/<em>p<strong>k</strong>g</em>/<em>m<strong>o</strong>d</em>/<em>c<strong>a</strong>c<strong>h</strong>e</em> / 下，源码文件也会在 {GOPATH}/pkg/mod/ 下)。</p>
<p>我们导入模块的时候只需要引入一次，使用模块中不同的包的时候可以通过 import 模块下不同的包名，来引入不同包的功能。</p>
<p>比如下面的结构</p>
<p>-----------com.mashibing.module</p>
<p>-----------------------package1</p>
<p>--------------test1.go</p>
<p>------------------------package2</p>
<p>-------------test2.go</p>
<p>然后我们只需要在 go.mod 中引入这一个模块，就能在 import 的时候任意引入 package1 或 package2。</p>
<h4 id="2为什么要使用gomodule"><a class="markdownIt-Anchor" href="#2为什么要使用gomodule">#</a> 2. 为什么要使用 GoModule?</h4>
<h5 id="1团队协作开发中对于包的版本号的管理"><a class="markdownIt-Anchor" href="#1团队协作开发中对于包的版本号的管理">#</a> 1). 团队协作开发中对于包的版本号的管理</h5>
<p>在没有 Module 之前，我们都是把自己写的 Go 程序打成包，然后别的程序引用的话引入这个包。</p>
<p>可是在开发中这些包的版本有个明显的不能管理的问题。</p>
<p>比如我怎么知道这个包是今天开发的最新版还是明天开发的，我在团队协同开发中怎么把别人写的最新版本的包更新到我的项目中。</p>
<h5 id="2便于开发中的依赖包管理"><a class="markdownIt-Anchor" href="#2便于开发中的依赖包管理">#</a> 2）便于开发中的依赖包管理</h5>
<p>其次，我们在开发中下载了别人的项目，怎么快速的观察有哪些依赖包，如何快速的把所有依赖包从仓库中下载下来，都是一个问题，</p>
<p>这两个问题就可以通过观察项目根目录下的 go.mod 文件的依赖模块列表和执行 go mod download 命令快速从第三方模块仓库中下载依赖包来完成。</p>
<h5 id="3隔离管理不同类别的项目"><a class="markdownIt-Anchor" href="#3隔离管理不同类别的项目">#</a> 3). 隔离管理不同类别的项目</h5>
<p>有了 Module 后，我们可以把我们自己的项目和系统的项目隔离管理，我们的项目不用必须放在 ${GOPATH}/src 下了</p>
<h4 id="3哪些项目能使用gomodule"><a class="markdownIt-Anchor" href="#3哪些项目能使用gomodule">#</a> 3. 哪些项目能使用 GoModule?</h4>
<p>一个 GoModule 项目要想引入其它依赖模块，需要在根目录下的 go.mod 中添加对应的依赖模块地址。</p>
<p>注意：！！！重点来了！！！</p>
<p>GoModule 只能引用同样是 Module 类型的项目，经常用于引用内部自己的项目。</p>
<p>像 maven 仓库一样引用开源模块的依赖也是一个特别常用的场景。</p>
<p>不过我们需要修改代理地址访问国内的第三方 GoModule 提供商。</p>
<p><a target="_blank" rel="noopener" href="https://goproxy.cn/%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9B%BD%E5%86%85%E7%9A%84%E5%8F%AF%E8%AE%BF%E9%97%AE%E7%9A%84GoModule%E4%BE%9D%E8%B5%96%E4%BB%93%E5%BA%93%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8EJava%E4%B8%ADmaven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93%E7%9A%84%E6%A6%82%E5%BF%B5%E3%80%82">https://goproxy.cn/ 是一个国内的可访问的 GoModule 依赖仓库，类似于 Java 中 maven 中央仓库的概念。</a></p>
<h4 id="4gomodule的版本问题"><a class="markdownIt-Anchor" href="#4gomodule的版本问题">#</a> 4.GoModule 的版本问题？</h4>
<p>我们使用 Go module 之前，首先要保证我们的 Go SDK 是在 1.13 以及以上版本。(Go1.11 以上就可以使用 Module, 但是需要设置一些开启等，1.13 后默认开启)</p>
<p>因为在 1.13 版本上官方正式推荐使用，成为稳定版了。</p>
<p>Go 也有代码仓库，比如可以使用 github 作为 go 项目的代码仓库，Go 语言本身就提供了一个指令 go get 来从指定的仓库中</p>
<p>拉取依赖包和代码，不过 go get 这个指令在开启模块功能和关闭模块功能下用法不一样，下面有开启模块下的用法。</p>
<h4 id="5gomodule和java中maven的区别"><a class="markdownIt-Anchor" href="#5gomodule和java中maven的区别">#</a> 5.GoModule 和 Java 中 Maven 的区别？</h4>
<p>Go 中的 Module 和 Java 中的 Maven 不同：</p>
<p>首先，Module 是官方的 SDK 包自带的，它并非像 maven 一样还得安装 maven 插件之类的。</p>
<p>关于中央依赖仓库，Go 和 Java 中的概念是类似的，都是国内的第三方提供的。</p>
<h4 id="6如何开启gomodulego111module"><a class="markdownIt-Anchor" href="#6如何开启gomodulego111module">#</a> 6. 如何开启 GoModule?(GO111MODULE)</h4>
<p>具体我们如何使用 Module 呢？</p>
<p>我们首先要检查我们的 GoSDK 版本是 1.11 还是 1.13 之上。</p>
<p>如果是 1.11 的话我们需要设置一个操作系统的中的环境变量，用于开启 Module 功能，这个是否开启的环境变量名是 GO111MODULE，</p>
<p>他有三种状态：</p>
<p>第一个是 on 开启状态，在此状态开启下项目不会再去 ${GOPATH} 下寻找依赖包。</p>
<p>第二个是 off 不开启 Module 功能，在此状态下项目会去 ${GOPATH} 下寻找依赖包。</p>
<p>第三个是 auto 自动检测状态，在此状态下会判断项目是否在 G O P A T H /s r c 外，如果在外面，会判断项目根目录下是否有 g o . m o d 文件，如果均有则开启 M o d u l e 功能，如果缺任何一个则会从 {GOPATH}/src 外，如果在外面，会判断项目根目录下是否有 go.mod 文件，如果均有则开启 Module 功能，如果缺任何一个则会从<em> GOP<strong>A</strong>T**H</em>/<em>src</em> 外，如果在外面，会判断项目根目录下是否有<em> g**o</em>.<em>m<strong>o</strong>d</em> 文件，如果均有则开启<em> M<strong>o</strong>d<strong>u</strong>l**e</em> 功能，如果缺任何一个则会从 {GOPATH} 下寻找依赖包。</p>
<p>GoSDK1.13 版本后 GO111MODULE 的默认值是 auto，所以 1.13 版本后不用修改该变量。</p>
<p>注意：在使用模块的时候， <code>GOPATH</code>  是无意义的，不过它还是会把下载的依赖储存在  <code>$&#123;GOPATH&#125;/src/mod</code>  中，也会把  <code>go install</code>  的结果放在  <code>$&#123;GOPATH&#125;/bin</code>  中。</p>
<p>windows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GO111MODULE=on</span><br></pre></td></tr></table></figure>
<p>linux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export GO111MODULE=on</span><br></pre></td></tr></table></figure>
<h4 id="7gomodule的真实使用场景1"><a class="markdownIt-Anchor" href="#7gomodule的真实使用场景1">#</a> 7.GoModule 的真实使用场景 1：</h4>
<p>接下来我们代入具体的使用场景：</p>
<p>今天，小明要接手一个新的 Go 项目，他通过 GoLand 中的 git 工具，从公司的 git 仓库中下载了一个 Go 的项目。(下载到他电脑的非 ${GOPATH}/src 目录，比如下载到他电脑的任意一个自己的工作空间)</p>
<p>此时他要做的是：</p>
<p>1). 先打开项目根目录下的 go.mod 文件看看里面依赖了什么工具包。(这个就是随便了解一下项目)</p>
<p>2).Go 的中央模块仓库是 Go 的官网提供的，在国外是 https://proxy.golang.org 这个地址，可是在国内无法访问。</p>
<p>我们在国内需要使用如下的中央模块仓库地址：<a target="_blank" rel="noopener" href="https://goproxy.cn">https://goproxy.cn</a></p>
<p>我们 Go 中的 SDK 默认是去找国外的中央模块仓库的，如何修改成国内的呢？</p>
<p>我们知道，所有的下载拉取行为脚本实际上是从 go download 这个脚本代码中实现的，而在这个脚本中的源码实现里，肯定有一个代码是写的是取出操作系统中的一个环境变量，这个环境变量存储着一个地址，这个地址代表了去哪个中央模块仓库拉取。</p>
<p>在 GoSDK 中的默认实现里，这个操作系统的环境变量叫做 GOPROXY，在脚本中为其赋予了一个默认值，就是国外的 proxy.golang.org 这个值。</p>
<p>我们要想修改，只需要在当前电脑修改该环境变量的值即可：</p>
<p>(注意，这个变量值不带 https, 这只是一个变量，程序会自动拼接 https)</p>
<p>windows</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set GOPROXY=goproxy.cn</span><br></pre></td></tr></table></figure>
<p>linux</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export GOPROXY=goproxy.cn</span><br></pre></td></tr></table></figure>
<p>3). 切换到项目的根目录，也就是有 go.mod 的那层目录，打开命令行窗口。</p>
<p>执行 download 指令 (下载模块项目到 ${GOPATH}/pkg/mod 下)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go  mod  download</span><br></pre></td></tr></table></figure>
<p>4). 如果不报错，代表已经下载好了，可以使用了，此时在项目根目录会生成一个 go.sum 文件。</p>
<p>一会再讲解 sum 文件。</p>
<p>5). 此时可以进行开发了。</p>
<h4 id="8gomodule的真实使用场景2"><a class="markdownIt-Anchor" href="#8gomodule的真实使用场景2">#</a> 8.GoModule 的真实使用场景 2：</h4>
<p>场景 2：我们如何用命令创建一个 Module 的项目，(开发工具也能手动创建)。</p>
<p>切换到项目根目录，执行如下指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go  mod init 模块名(模块名可不写)</span><br></pre></td></tr></table></figure>
<p>然后会在根目录下生成一个 go.mod 文件</p>
<p>我们看看这个 go.mod 文件长啥样？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 刚才init指令后的模块名参数被写在module后了</span><br><span class="line">module 模块名</span><br><span class="line">//表示使用GoSDK的哪个版本</span><br><span class="line">go 1.14</span><br></pre></td></tr></table></figure>
<p>修改 go.mod 文件中的依赖即可。</p>
<p>我们有两种方式下载和更新依赖：</p>
<p>1. 修改 go.mod 文件，然后执行 go mod down 把模块依赖下载到自己 ${GOPATH}/pkg/mod 下，这里面装的是所有下载的 module 缓存依赖文件，其中有 zip 的包，也有源码，在一个项目文件夹下的不同文件夹下放着，还有版本号文件夹区分，每个版本都是一个文件夹。</p>
<p>2. 直接在命令行使用 go get package@version 更新或者下载依赖模块，升级或者降级模块的版本。(这里是开启模块后的 go get 指令用法)</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get  github.com/gin-contrib/sessions@v0.0.1</span><br></pre></td></tr></table></figure>
<p>这个指令执行过后，会自动修改 go.mod 中的文件内容，不需要我们手动修改 go.mod 文件中的内容。</p>
<h4 id="9gomod文件详解"><a class="markdownIt-Anchor" href="#9gomod文件详解">#</a> 9.go.mod 文件详解</h4>
<p>接下来我们讲讲核心配置文件 go.mod</p>
<p>go.mod 内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//表示本项目的module模块名称是什么,别的模块依赖此模块的时候写这个名字</span><br><span class="line">module test</span><br><span class="line">//表示使用GoSDK的哪个版本</span><br><span class="line">go 1.14</span><br><span class="line">//require中声明的是需要依赖的包和包版本号</span><br><span class="line">require (</span><br><span class="line">	//格式如下： 需要import导入的模块名  版本号</span><br><span class="line">	//		   需要import导入的模块名2  版本号2	</span><br><span class="line">	//			...					...</span><br><span class="line">    github.com/gin-contrib/sessions v0.0.1</span><br><span class="line">    github.com/gin-contrib/sse v0.1.0 // indirect</span><br><span class="line">    github.com/gin-gonic/gin v1.4.0</span><br><span class="line">    github.com/go-redis/redis v6.15.6+incompatible</span><br><span class="line">    github.com/go-sql-driver/mysql v1.4.1</span><br><span class="line">    github.com/golang/protobuf v1.3.2 // indirect</span><br><span class="line">    github.com/jinzhu/gorm v1.9.11</span><br><span class="line">    github.com/json-iterator/go v1.1.7 // indirect</span><br><span class="line">    github.com/kr/pretty v0.1.0 // indirect</span><br><span class="line">    github.com/mattn/go-isatty v0.0.10 // indirect</span><br><span class="line">    github.com/sirupsen/logrus v1.2.0</span><br><span class="line">    github.com/ugorji/go v1.1.7 // indirect</span><br><span class="line">)</span><br><span class="line">//replace写法如下，表示如果项目中有引入前面的依赖模块，改为引用=&gt;后面的依赖模块，</span><br><span class="line">//可以用于golang的国外地址访问改为指向国内的github地址,当然你在上面require直接写github就不用在这里repalce了</span><br><span class="line">replace (</span><br><span class="line">	golang.org/x/crypto v0.0.0-20190313024323-a1f597ede03a =&gt; github.com/golang/crypto v0.0.0-20190313024323-a1f597ede03a</span><br><span class="line">)</span><br><span class="line">//忽略依赖模块，表示在该项目中无论如何都使用不了该依赖模块，可以用于限制使用某个有bug版本的模块</span><br><span class="line">exclude(</span><br><span class="line">    github.com/ugorji/go v1.1.7 </span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>注：go.mod 提供了 module, require、replace 和 exclude 四个命令</p>
<p>module 语句指定包的名字（路径）<br>
require 语句指定的依赖项模块<br>
 replace 语句可以替换依赖项模块<br>
 exclude 语句可以忽略依赖项模块</p>
<p><a target="_blank" rel="noopener" href="http://xn--github-9o7i2021c.com/ugorji/go">上面 github.com/ugorji/go</a> v1.1.7 //indirect 有 indirect 和非 indirect</p>
<p>indirect 代表此模块是间接引用的，中间隔了几个项目</p>
<p>这个不用特殊写，可以注释写便于识别和开发</p>
<h4 id="10gomodule有哪些命令如何使用"><a class="markdownIt-Anchor" href="#10gomodule有哪些命令如何使用">#</a> 10.GoModule 有哪些命令？如何使用？</h4>
<p>Go 有如下关于 Module 的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//go mod   命令：</span><br><span class="line">download  //下载依赖模块到$&#123;GOPATH&#125;/pkg/mod</span><br><span class="line">edit      //一系列参数指令用于操作go.mod文件，参数太多，具体下面有例子</span><br><span class="line">graph     //输出显示每一个模块依赖了哪些模块</span><br><span class="line">init      //在一个非module项目的根目录下创建一个go.mod文件使其变为一个module管理的项目</span><br><span class="line">tidy      //根据项目实际使用的依赖包修改(删除和添加)go.mod中的文本内容</span><br><span class="line">vendor    //在项目根目录创建一个vender文件夹 然后把$&#123;GOPATH&#125;/pkg/mod下载的本项目需要的依赖模块拷贝到本项目的vender目录下</span><br><span class="line">verify    //校验$&#123;GOPATH&#125;/pkg/mod中的依赖模块下载到本地后是否被修改或者篡改过</span><br><span class="line">why       //一个说明文档的功能，用于说明一些包之间的为什么要这么依赖。(没啥用)</span><br></pre></td></tr></table></figure>
<h5 id="0-init和download"><a class="markdownIt-Anchor" href="#0-init和download">#</a> 0). init 和 download</h5>
<p>我们之前在案例中讲了 init,download 指令，这里不再赘述</p>
<h5 id="1go-mod-edit"><a class="markdownIt-Anchor" href="#1go-mod-edit">#</a> 1).go mod edit</h5>
<p>是指在命令行用指令通过不同的参数修改 go.mod 文件，这个指令必须得写参数才能正确执行，不能空执行 go mod edit</p>
<p>参数 1 ：-fmt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit -fmt</span><br></pre></td></tr></table></figure>
<p>格式化 go.mod 文件，只是格式规范一下，不做其它任何内容上的修改。</p>
<p>其它任何 edit 指令执行完毕后都会自动执行 - fmt 格式化操作。</p>
<p>这个使用场景就是我们如果不想做任何操作，就想试试 edit 指令，就只需要跟上 - fmt 就行，因为单独不加任何参数</p>
<p>只有 go mod edit 后面不跟参数是无法执行的。</p>
<p>我们如何升级降级依赖模块的版本，或者说添加新的依赖和移除旧的依赖呢</p>
<p>参数 2： -require=path@version /-droprequire=path flags</p>
<p>添加一个依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod  edit -require=github.com/gin-contrib/sessions@v0.0.1</span><br></pre></td></tr></table></figure>
<p>删除一个依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit -droprequire=github.com/gin-contrib/sessions@v0.0.1</span><br></pre></td></tr></table></figure>
<p>这两个和 go get package@version 功能差不多，但是官方文档更推荐使用 go get 来完成添加和修改依赖（go get 后的 package 和上面的 path 一个含义，都是模块全路径名）</p>
<p>参数 3：-exclude=path@version and -dropexclude=path@version</p>
<p>排除某个版本某个模块的使用，必须有该模块才可以写这个进行排除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit -exclude=github.com/gin-contrib/sessions@v0.0.1</span><br></pre></td></tr></table></figure>
<p>删除排除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod edit -dropexclude=github.com/gin-contrib/sessions@v0.0.1</span><br></pre></td></tr></table></figure>
<p>简单来说，执行这两个是为了我们在开发中避免使用到不应该使用的包</p>
<p>… 还有好几个，基本很少用，省略了</p>
<h5 id="2go-mod-graph"><a class="markdownIt-Anchor" href="#2go-mod-graph">#</a> 2).go mod graph</h5>
<p>命令用法： 输出每一个模块依赖了哪些模块 无参数，直接使用 ，在项目根目录下命令行执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod graph</span><br></pre></td></tr></table></figure>
<p>比如：</p>
<p>模块 1 依赖了模块 a</p>
<p>模块 1 依赖了模块 b</p>
<p>模块 1 依赖了模块 c</p>
<p>模块 2 依赖了模块 x</p>
<p>模块 2 依赖了模块 z</p>
<p>如下是具体例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\$&#123;GOPAHT&#125;\file\project&gt;go mod graph</span><br><span class="line">file\project github.com/edgexfoundry/go-mod-bootstrap@v0.0.35</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/BurntSushi/toml@v0.3.1</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/edgexfoundry/go-mod-configuration@v0.0.3</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/edgexfoundry/go-mod-core-contracts@v0.1.34</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/edgexfoundry/go-mod-registry@v0.1.17</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/edgexfoundry/go-mod-secrets@v0.0.17</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/gorilla/mux@v1.7.1</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/pelletier/go-toml@v1.2.0</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 github.com/stretchr/testify@v1.5.1</span><br><span class="line">github.com/edgexfoundry/go-mod-bootstrap@v0.0.35 gopkg.in/yaml.v2@v2.2.8</span><br><span class="line">github.com/edgexfoundry/go-mod-configuration@v0.0.3 github.com/cenkalti/backoff@v2.2.1+incompatible</span><br><span class="line">github.com/edgexfoundry/go-mod-configuration@v0.0.3 github.com/hashicorp/consul/api@v1.1.0</span><br></pre></td></tr></table></figure>
<h5 id="3go-mod-tidy"><a class="markdownIt-Anchor" href="#3go-mod-tidy">#</a> 3).go mod tidy</h5>
<p>根据实际项目使用到的依赖模块，在 go.mod 中添加或者删除文本引用</p>
<p>有一个参数可选项 -v 输出在 go.mod 文件中删除的引用模块信息</p>
<p>比如我们项目用到一个模块，go.mod 中没写，执行后 go.mod 中就会添加上该模块的文本引用。</p>
<p>如果我们在 go.mod 中引用了一个模块，检测在真实项目中并没有使用，则会在 go.mod 中删除该文本引用。</p>
<p>使用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go  mod  tidy -v</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unused github.com/edgexfoundry/go-mod-bootstrap</span><br></pre></td></tr></table></figure>
<p>输出表示检测项目没有使用到该模块，然后从 go.mod 中把该包的引用文字给删除了。</p>
<h5 id="4go-mod-vender"><a class="markdownIt-Anchor" href="#4go-mod-vender">#</a> 4).go mod vender</h5>
<p>该指令会在项目中建立一个 vender 目录，然后把 ${GOPATG}/pkg/mod 中下载的依赖拷贝到项目的 vender 目录中，方便管理和方便在 idea 中引用依赖。 -v 参数可以在控制台输出相关的结果信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod vender -v </span><br></pre></td></tr></table></figure>
<h5 id="5go-mod-verify"><a class="markdownIt-Anchor" href="#5go-mod-verify">#</a> 5).go mod verify</h5>
<p>验证下载到 ${GOPATH}/pkg/mod 中的依赖模块有没有被修改或者篡改。</p>
<p>结果会输出是否被修改过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod verify</span><br></pre></td></tr></table></figure>
<p>比如输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all modules verified</span><br></pre></td></tr></table></figure>
<p>这个是所有模块已经验证，代表没有被修改，如果被修改，会提示哪些被修改。</p>
<h5 id="6go-mod-why"><a class="markdownIt-Anchor" href="#6go-mod-why">#</a> 6).go mod why</h5>
<p>这个没啥用，说白了就是一个解释文档，输入参数和依赖他说明哪些包为啥要依赖这些包，不用看它，用处不大。</p>
<h4 id="11gosum详细讲解"><a class="markdownIt-Anchor" href="#11gosum详细讲解">#</a> 11.go.sum 详细讲解</h4>
<h5 id="1gosum什么时候会更新或者新建生成"><a class="markdownIt-Anchor" href="#1gosum什么时候会更新或者新建生成">#</a> 1).go.sum 什么时候会更新或者新建生成？</h5>
<p>当我们通过 go mod download 下载完依赖模块或者 go get package@version 更新了依赖包的时候</p>
<p>，会检查根目录下有没有一个叫 go.sum 的文件，没有的话则创建一个并写入内容，有的话会更新 go.sum 中的内容。</p>
<h5 id="2gosum是用来做什么的"><a class="markdownIt-Anchor" href="#2gosum是用来做什么的">#</a> 2).go.sum 是用来做什么的？</h5>
<p>go.sum 的作用是用来校验你下载的依赖模块是否是官方仓库提供的，对应的正确的版本的，并且中途没有被黑客篡改的。</p>
<p>go.sum 主要是起安全作用和保证依赖的版本肯定是官方的提供的那个版本，版本确认具体是确认你下载的那个模块版本里面的代码的和官方提供的模块的那个版本的代码完全相同，一字不差。</p>
<p>通过 go.sum 保证安全性是很有必要的，因为如果你的电脑被黑客攻击了，黑客可以截取你对外发送的文件，也可以修改发送给你的文件，那么就会产生一个问题：</p>
<p>本来的路径应该是这样的： 第三方模块依赖库 ------------&gt; 你的电脑</p>
<p>结果中间有黑客会变成这样:</p>
<p>第三方模块依赖库 --------&gt; 黑客修改了依赖库中的代码，植入病毒代码，并重新打成模块发送给你 ---------&gt; 你以为是官方的版本</p>
<p>结果黑客就把病毒代码植入到了你的项目中，你的项目就不安全了，面临着数据全部泄露的风险。</p>
<h5 id="3gosum是如何实现校验机制的它包含什么内容"><a class="markdownIt-Anchor" href="#3gosum是如何实现校验机制的它包含什么内容">#</a> 3).go.sum 是如何实现校验机制的？它包含什么内容？</h5>
<p>说到校验安全机制，有一种常规的玩法就是使用不可逆加密算法，不可逆加密算法是指将 a 文本通过算法加密成 b 文本后，b 文本永远也不能反着计算出 a 文本。</p>
<p>不可加密算法的具体是怎么应用的呢？它是如何起作用的？</p>
<p>我们在这里先讲一个不可逆的加密算法 SHA-256 算法。</p>
<p>SHA-256 算法的功能就是将一个任意长度的字符串转换成一个固定长度为 64 的字符串，比如:</p>
<p>4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce</p>
<p>这里从 4e07 代表四个字符串，按此算，这个加密后的字符串为 64 个。</p>
<p>为什么是 64 个呢？</p>
<p>因为 64 个字符串每两个字符为一组，比如 4e 是一组，07 是一组，也就是说有 32 组，每一组是一个十六进制的数值，一个十六进制的数值也就是两个字符用计算机中的 8 个字节内存空间存储，也就是一个十六进制的数字，有两个字符串，占 8 个字节，一个字节等同 8 位 (bit)(位只能存储 0 和 1 两个值)，也就是说:</p>
<p>32（32 个十六进制数，每个十六进制数用两个字符表示）*8 字节 = 256 位。</p>
<p>仔细看名字，SHA 代表是算法的加密方式类型，256 代表的是他这个是 256 位的版本。</p>
<p>具体原理实现是 SHA 内部定义了一系列固定数值的表，然后加密的时候无论是需要加密多少文字，它都按照一定的规则从需要加密的文字中按一定规则抽取其中的缩略一部分，然后拿缩略的一部分和 SHA 内部的固定数值表进行固定的 hash 映射和算术操作，这个 hash 映射和算术操作的顺序是固定写死的，公共数据表是写死的，这个写死的顺序和公共数据表就是这个算法的具体内容本质。</p>
<p>这样的话，因为抽取的是缩略的内容，所以我们可以把输出结果固定在 64 个字符，256 位。</p>
<p>因为是缩略的内容， 所以我们不可能通过缩略的内容反推出完整的结果。</p>
<p>但是，相同的文本按照这个算法加密出来的 64 个字符肯定是相同的，同时，只要改变原需要加密文本的一个字符，也会造成加密出来的 64 个字符大不相同。</p>
<p>我们用 SHA-256 通常是这么用的：</p>
<p>A 方 要 发送信息给 B 方</p>
<p>B 方 要确定信息是 A 方发送的，没有经过篡改</p>
<p>此时 A 和 B 同时约定一个密码字符串，比如 abc。</p>
<p>这个 abc 只有 A 方和 B 方知道。</p>
<p>A 方把 需要传输的文本拼接上 abc，然后通过 SHA-256 加密算出一个值，把原文本和算出的值全部发送给 B。</p>
<p>B 方 拿出原文本，拼接上 abc，进行 SHA256 计算，看看结果是否和传输过来的 A 传输的值一样，如果一样，代表中间没有被篡改。</p>
<p>为什么呢？</p>
<p>因为如果有一个黑客 C 想要篡改，他就得同时篡改原文本和算出的签名值。</p>
<p>可是 C 不知道密码是 abc，它也就不能把 abc 拼接到原文后，所以它算出来的签名和 B 算出来的签名肯定不一致。</p>
<p>所以 B 如果自己算出的签名值与接收到的签名值不一致，B 就知道不是 A 发过来的，就能校验发送端的源头是否是官方安全的了。</p>
<hr>
<p>接下来我们讲一下 go.sum 的验证机制。</p>
<p>首先说下 go.sum 中存储的内容，这个文件存储的每一行都是如下格式</p>
<p>模块名 版本号 hash 签名值</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">github.com/google/uuid v1.1.1 h1:Gkbcsh/GbpXz7lPftLA3P6TYMwjCLYm83jiFQZF/3gY=   </span><br><span class="line"></span><br><span class="line">github.com/google/uuid v1.1.1/go.mod h1:TIyPZe4MgqvfeYDBFedMoGGpEw/LqOeaOT+nhxU+yHo=</span><br></pre></td></tr></table></figure>
<p>这里的 hash 签名值是拿当前模块当前版本号内的所有代码字符串计算出来的一个值，就是通过上面讲解的 SHA-256 计算的。</p>
<p>所以哪怕是这个模块中的代码有一个字变了，计算出来的 hash 值也不相同。</p>
<p>第三方模块库在每发布一个新的模块版本后，会按照 SHA-256 计算出对应版本的 hash 值，然后提供给外部获取用于检验安全性。</p>
<p>当我们 go mod download 和 go get package@version 后 会更新 go.mod 中的模块路径和版本。</p>
<p>然后会更新或者创建根目录下 go.sum 文件中的模块名 版本号 和 hash 值。</p>
<p>在 go.sum 中的 hash 值是在下载和更新依赖包的时候，同时获取官方提供的版本号得来的。</p>
<p>也就是说，基本上 go.sum 中的文件都是从官网（外国）（中国是第三方模块仓库）上获得的正品版本号，这个版本号是仓库方自己算的，你只是获取到了存储到你自己的 go.sum 中。</p>
<p>具体如何获取版本号有个小知识点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go module机制在下载和更新依赖的时候会取出操作系统中名为`GOSUMDB`的环境变量中的值，这个服务器地址值代表了从哪个第三方仓库获取对应的正品版本号。</span><br></pre></td></tr></table></figure>
<p>重点来了，当你在 go build 打包创建 go 项目的时候，go build 的内部指令会去拿你本地的模块文件进行 SHA-256 计算，然后拿到一个计算出来的结果值，之后它会拿此值和 go.sum 中的正确的从官网拉取的值进行对比，如果不一样，说明这个模块包不是官方发布的，也就是你本地的模块包和官方发布的模块包中的代码肯定有差异。</p>
<h2 id="四专门详解go并发编程相关知识"><a class="markdownIt-Anchor" href="#四专门详解go并发编程相关知识">#</a> 四。专门详解 Go 并发编程相关知识</h2>
<h3 id="1go为什么天然支持高并发纤程比线程的优势是什么"><a class="markdownIt-Anchor" href="#1go为什么天然支持高并发纤程比线程的优势是什么">#</a> 1.Go 为什么天然支持高并发，纤程比线程的优势是什么？</h3>
<p>Go 语言在设计的时候就考虑了充分利用计算机的多核处理器，具体表现为，Go 中开启一个并发的任务以操作系统的线程资源调度为单位的，而是 Go 的创造者们自己写了一套管理多个任务的机制，在这个机制下，每一个并发的任务线程叫做纤程，这个纤程的作用等同一个线程，也是并发执行的，只不过纤程是在应用程序管理的，懂底层的可以讲是在用户态的一个线程，而 Java 中调度的线程是属于操作系统，也就是操作系统内核态的线程。</p>
<p>用户态的纤程归属于用户编写的软件管理和调度，优点是可以根据情况灵活实现堆栈的内存分配，最优化其中的运行资源配置。</p>
<p>内核态的线程归属于操作系统调度和管理，他底层是有 windows 或者 linux 操作系统底层的代码管理的，那么他就不灵活，每个线程分配的资源可能造成浪费，创建的线程数肯定也有一定的限制。</p>
<p>Go 的创造可以为自己的语言和任务灵活配置资源，Linux 和 windows 操作系统的代码是通用的，总不能为你这个语言修改源代码把。</p>
<p>在实际程序运行中，一个操作系统的内核态线程可能管理着好几个甚至数十个纤程 (根据实际情况和设置不同而不同)，所以省去了线程时间片上下文切换的时间。</p>
<p>同时因为内部机制灵活，所以执行效率高，占用内存也少。</p>
<p>这就是 Go 语言的并发优势的核心所在。</p>
<h3 id="2并发和并行的区别"><a class="markdownIt-Anchor" href="#2并发和并行的区别">#</a> 2. 并发和并行的区别？</h3>
<p>并发是指的一个角色在一段时间内通过来回切换处理了多个任务。</p>
<p>并行是指两个或者多个角色同时处理自己的任务。</p>
<p>举例：</p>
<p>并发：在一个小时内，你写了 10 分钟语文作业，又写了 10 分钟数学，之后又写了 10 分中英语作业，然后再从语文 10 分钟，数学 10 分钟，英文 10 分钟又来一次。</p>
<p>这个叫做你并发的写语文数学英语作业。</p>
<p>你一个一段时间（一个小时内）通过切换（一会写数学，一会写语文。。。），处理了多个任务（写了三门课的作业）</p>
<p>并行：你和小明同时写自己的作业。你们俩同时运行的状态叫做并行运作状态，强调的是你们两个人同时在处理任务 (做作业)。</p>
<p>你和小明 (两个以上的角色) 同时写作业 (处理自己的任务)。</p>
<p>在计算机中，比如有 4 个 cpu，4 个 cpu 同时工作，叫做这 4 个 cpu 并行执行任务，每个 cpu 通过时间片机制上下文切换处理 100 个小任务，叫做每个 cpu 并发的处理 100 个任务。</p>
<h3 id="3go是如何用channel进行协程间数据通信数据同步的"><a class="markdownIt-Anchor" href="#3go是如何用channel进行协程间数据通信数据同步的">#</a> 3.Go 是如何用 Channel 进行协程间数据通信数据同步的？</h3>
<p>go 中的线程相关的概念是 Goroutines (并发)，是使用 go 关键字开启。</p>
<p>Java 中的线程是通过 Thread 类开启的。</p>
<p>在 go 语言中，一个线程就是一个 Goroutines，主函数就是（主） main Goroutines。</p>
<p>使用 go 语句来开启一个新的 Goroutines</p>
<p>比如：</p>
<p>普通方法执行</p>
<p>myFunction()</p>
<p>开启一个 Goroutines 来执行方法</p>
<p>go myFunction()</p>
<p>java 中是</p>
<p>new Thread(()-&gt;{</p>
<p>// 新线程逻辑代码</p>
<p>}).start();</p>
<p>参考下面的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//并发开启新线程goroutine测试</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//我的方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunction</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;Hello!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//并发执行方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">goroutineTestFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;Hello!!! Start Goroutine!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   myFunction()</span></span><br><span class="line"><span class="comment">   //go goroutineTestFunc()</span></span><br><span class="line"><span class="comment">   //此时因为主线程有时候结束的快，goroutineTestFunc方法得不到输出，由此可以看出是开启了新的线程。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="comment">//打开第二段执行</span></span><br><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   go goroutineTestFunc()</span></span><br><span class="line"><span class="comment">   time.Sleep(10*time.Second)//睡一段时间  10秒</span></span><br><span class="line"><span class="comment">   myFunction()</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>线程间的通信：</p>
<p>java 线程间通信有很多种方式：</p>
<p>比如最原始的 wait/notify</p>
<p>到使用 juc 下高并发线程同步容器，同步队列</p>
<p>到 CountDownLatch 等一系列工具类</p>
<p>…</p>
<p>甚至是分布式系统不同机器之间的消息中间件，单机的 disruptor 等等。</p>
<p>Go 语言不同，线程间主要的通信方式是 Channel。</p>
<p>Channel 是实现 go 语言多个线程（goroutines）之间通信的一个机制。</p>
<p>Channel 是一个线程间传输数据的管道，创建 Channel 必须声明管道内的数据类型是什么</p>
<p>下面我们创建一个传输 int 类型数据的 Channel</p>
<p>代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>)</span><br><span class="line">   fmt.Println(ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>channel 是引用类型，函数传参数时是引用传递而不是值拷贝的传递。</p>
<p>channel 的空值和别的应用类型一样是 nil。</p>
<p>== 可以比较两个 Channel 之间传输的数据类型是否相等。</p>
<p>channel 是一个管道，他可以收数据和发数据。</p>
<p>具体参照下面代码示例:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">//channel发送数据和接受数据用 &lt;-表示,是发送还是接受取决于chan在  &lt;-左边还是右边</span></span><br><span class="line"><span class="comment">//创建一个传输字符串数据类型的管道</span></span><br><span class="line"><span class="keyword">var</span>  chanStr  = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">string</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;main goroutine print Hello &quot;</span>)</span><br><span class="line">   <span class="comment">//默认channel是没有缓存的，阻塞的，也就是说，发送端发送后直到接受端接受到才会施放阻塞往下面走。</span></span><br><span class="line">   <span class="comment">//同样接收端如果先开启，直到接收到数据才会停止阻塞往下走</span></span><br><span class="line">   <span class="comment">//开启新线程发送数据</span></span><br><span class="line">   <span class="keyword">go</span> startNewGoroutineOne()</span><br><span class="line">   <span class="comment">//从管道中接收读取数据</span></span><br><span class="line">   <span class="keyword">go</span> startNewGoroutineTwo()</span><br><span class="line">   <span class="comment">//主线程等待，要不直接结束了</span></span><br><span class="line">   time.Sleep(<span class="number">100</span>*time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startNewGoroutineOne</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;send channel print Hello &quot;</span>)</span><br><span class="line">   <span class="comment">//管道发送数据</span></span><br><span class="line">   chanStr &lt;- <span class="string">&quot;Hello!!!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startNewGoroutineTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">   fmt.Println(<span class="string">&quot;receive channel print Hello &quot;</span>)</span><br><span class="line">   strVar := &lt;-chanStr</span><br><span class="line">   fmt.Println(strVar)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>无缓存的 channel 可以起到一个多线程间线程数据同步锁安全的作用。</p>
<p>缓存的 channel 创建方式是</p>
<p>make (chan string, 缓存个数)</p>
<p>缓存个数是指直到多个数据没有消费或者接受后才进行阻塞。</p>
<p>类似于 java 中的 synchronized 和 lock</p>
<p>可以保证多线程并发下的数据一致性问题。</p>
<p>首先我们看一个线程不安全的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//多线程并发下的不安全问题</span></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA <span class="type">int</span> =<span class="number">1000</span></span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> moneyA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//正常逻辑，只够扣款一单，可以多线程环境下结果钱扣多了</span></span><br><span class="line">   time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>缓存为 1 的 channel 可以作为锁使用：</p>
<p>示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//多线程并发下使用channel改造</span></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA  = <span class="number">1000</span></span><br><span class="line"><span class="comment">//减少金额管道</span></span><br><span class="line"><span class="keyword">var</span> synchLock = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> moneyA;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">      &lt;-synchLock</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;</span><br><span class="line">      synchLock&lt;<span class="number">-10</span></span><br><span class="line">   &#125;()</span><br><span class="line">   <span class="comment">//这样类似于java中的Lock锁，不会扣多</span></span><br><span class="line">   time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4go中的goroutine使用和gmp模型"><a class="markdownIt-Anchor" href="#4go中的goroutine使用和gmp模型">#</a> 4.Go 中的 Goroutine 使用和 GMP 模型？</h3>
<p>Go 中的线程 (实际是纤程) goroutine 的底层管理和调度是在 runtime 包中自己实现的，其中遵循了 GMP 模型。</p>
<p>G 就是一个 goroutine，包括它自身的一些元信息。</p>
<p>M 是指操作系统内核态的线程的一个虚拟表示，一个 M 就是操作系统内核态的一个线程。</p>
<p>P 是一个组列表，P 管理着多个 goroutines,P 还有一些用于组管理的元数据信息。</p>
<h3 id="5go的select怎么用"><a class="markdownIt-Anchor" href="#5go的select怎么用">#</a> 5.Go 的 select 怎么用？</h3>
<p>Go 中的 select 是专门用于支持更好的使用管道 (channel) 的。</p>
<p>我们之前虽然讲了能从管道中读取数据，但是这有一个缺陷，就是我们在一个 Goroutine 中不能同时处理读取多个 channel，因为在一个 Goroutine 中，一个 channel 阻塞后就无法继续运行了，所以无法在一个 Goroutine 处理多个 channel, 而 select 很好的解决了这个问题。</p>
<p>select 相当于 Java 中 Netty 框架的多路复用器的功能。</p>
<p>举例代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//创建一个缓存为1的chan</span></span><br><span class="line">   myChan := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">int</span>,<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++&#123;</span><br><span class="line">      <span class="comment">//select 的用法是，从上到下依次判断case 是否可执行，如果可执行，则执行完毕跳出select,如果不能执行，尝试下一个执行</span></span><br><span class="line">      <span class="comment">//这里的可执行是指的不阻塞，也就是说，select从上到下开始挑选一个不阻塞的case执行，执行完毕后跳出，</span></span><br><span class="line">      <span class="comment">//如果所有case都阻塞，则执行default</span></span><br><span class="line">      <span class="comment">//如下输出结果，i=奇数的时候走case   myChan&lt;-i:，把奇数放入mychan</span></span><br><span class="line">      <span class="comment">//走偶数的时候因为myChan中有数据了，则把上一个奇数打印出来。</span></span><br><span class="line">      <span class="comment">//所以结果是 1  3  5  7  ...</span></span><br><span class="line">      <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span>  data := &lt;-myChan:</span><br><span class="line">               fmt.Println(data)</span><br><span class="line">            <span class="keyword">case</span>   myChan&lt;-i:</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">               fmt.Println(<span class="string">&quot;default !!!&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="6go中的互斥锁类似于java中的reentrantlock"><a class="markdownIt-Anchor" href="#6go中的互斥锁类似于java中的reentrantlock">#</a> 6.Go 中的互斥锁 (类似于 Java 中的 ReentrantLock)</h3>
<p>先按线程不安全的数据错误的代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局变量</span></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	wait.Add(<span class="number">5</span>)</span><br><span class="line">	<span class="keyword">go</span> myAdd()</span><br><span class="line">	<span class="keyword">go</span> myAdd()</span><br><span class="line">	<span class="keyword">go</span> myAdd()</span><br><span class="line">	<span class="keyword">go</span> myAdd()</span><br><span class="line">	<span class="keyword">go</span> myAdd()</span><br><span class="line">	wait.Wait()</span><br><span class="line">	<span class="comment">//预期值等于5万，可是因为线程不安全错误，小于5万</span></span><br><span class="line">	fmt.Printf(<span class="string">&quot;num = %d\n&quot;</span>,num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span>  <span class="title">myAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> wait.Done()</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span> ;i&lt;<span class="number">10000</span>;i++ &#123;</span><br><span class="line">		num+=<span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num = 38626  </span><br></pre></td></tr></table></figure>
<p>互斥锁示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局变量</span></span><br><span class="line"><span class="keyword">var</span> num <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lock sync.Mutex</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   wait.Add(<span class="number">5</span>)</span><br><span class="line">   <span class="keyword">go</span> myAdd()</span><br><span class="line">   <span class="keyword">go</span> myAdd()</span><br><span class="line">   <span class="keyword">go</span> myAdd()</span><br><span class="line">   <span class="keyword">go</span> myAdd()</span><br><span class="line">   <span class="keyword">go</span> myAdd()</span><br><span class="line">   wait.Wait()</span><br><span class="line">   <span class="comment">//预期值等于5万，可是因为线程不安全错误，小于5万</span></span><br><span class="line">   fmt.Printf(<span class="string">&quot;num = %d\n&quot;</span>,num)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span>  <span class="title">myAdd</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="keyword">for</span> i:=<span class="number">0</span> ;i&lt;<span class="number">10000</span>;i++ &#123;</span><br><span class="line">      lock.Lock()</span><br><span class="line">      num+=<span class="number">1</span></span><br><span class="line">      lock.Unlock()</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7go中的读写锁类似于java中的reentrantreadwritelock"><a class="markdownIt-Anchor" href="#7go中的读写锁类似于java中的reentrantreadwritelock">#</a> 7.Go 中的读写锁 (类似于 Java 中的 ReentrantReadWriteLock)</h3>
<p>读写锁用于读多写少的情况，多个线程并发读不上锁，写的时候才上锁互斥</p>
<p>读写锁示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA  = <span class="number">1000</span></span><br><span class="line"><span class="comment">//读写锁</span></span><br><span class="line"><span class="keyword">var</span> rwLock sync.RWMutex;</span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   rwLock.Lock()</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">   rwLock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   rwLock.RLock()</span><br><span class="line">   result := moneyA</span><br><span class="line">   rwLock.RUnlock()</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   wait.Add(<span class="number">2</span>)</span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wait.Done()</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wait.Done()</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   wait.Wait()</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8go中的并发安全map类似于currenthashmap"><a class="markdownIt-Anchor" href="#8go中的并发安全map类似于currenthashmap">#</a> 8.Go 中的并发安全 Map (类似于 CurrentHashMap)</h3>
<p>Go 中自己通过 make 创建的 map 不是线程安全的，具体体现在多线程添加值和修改值下会报如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal error : concurrent map writes</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>这个错类似于 java 中多线程读写线程不安全的容器时报的错。</p>
<p>Go 为了解决这个问题，专门给我们提供了一个并发安全的 map，这个并发安全的 map 不用通过 make 创建，拿来即可用，并且他提供了一些不同于普通 map 的操作方法。</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个sync包下的线程安全map对象</span></span><br><span class="line"><span class="keyword">var</span> myConcurrentMap = sync.Map&#123;&#125;</span><br><span class="line"><span class="comment">//遍历数据用的</span></span><br><span class="line"><span class="keyword">var</span> myRangeMap = sync.Map&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//存储数据</span></span><br><span class="line">   myConcurrentMap.Store(<span class="number">1</span>,<span class="string">&quot;li_ming&quot;</span>)</span><br><span class="line">   <span class="comment">//取出数据</span></span><br><span class="line">   name,ok := myConcurrentMap.Load(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">if</span>(!ok) &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;不存在&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//打印值  li_ming</span></span><br><span class="line">   fmt.Println(name)</span><br><span class="line">   <span class="comment">//该key有值,则ok为true,返回它原来存在的值，不做任何操作；该key无值，则执行添加操作，ok为false,返回新添加的值</span></span><br><span class="line">   name2, ok2 := myConcurrentMap.LoadOrStore(<span class="number">1</span>,<span class="string">&quot;xiao_hong&quot;</span>)</span><br><span class="line">   <span class="comment">//因为key=1存在，所以打印是   li_ming true</span></span><br><span class="line">   fmt.Println(name2,ok2)</span><br><span class="line">   name3, ok3 := myConcurrentMap.LoadOrStore(<span class="number">2</span>,<span class="string">&quot;xiao_hong&quot;</span>)</span><br><span class="line">   <span class="comment">//因为key=2不存在，所以打印是   xiao_hong false</span></span><br><span class="line">   fmt.Println(name3,ok3)</span><br><span class="line">   <span class="comment">//标记删除值</span></span><br><span class="line">   myConcurrentMap.Delete(<span class="number">1</span>)</span><br><span class="line">   <span class="comment">//取出数据</span></span><br><span class="line">   <span class="comment">//name4,ok4 := myConcurrentMap.Load(1)</span></span><br><span class="line">   <span class="comment">//if(!ok4) &#123;</span></span><br><span class="line">   <span class="comment">// fmt.Println(&quot;name4=不存在&quot;)</span></span><br><span class="line">   <span class="comment">// return</span></span><br><span class="line">   <span class="comment">//&#125;</span></span><br><span class="line">   <span class="comment">//fmt.Println(name4)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//遍历数据</span></span><br><span class="line">   rangeFunc()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rangeFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">   myRangeMap.Store(<span class="number">1</span>,<span class="string">&quot;xiao_ming&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">2</span>,<span class="string">&quot;xiao_li&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">3</span>,<span class="string">&quot;xiao_ke&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">4</span>,<span class="string">&quot;xiao_lei&quot;</span>)</span><br><span class="line"></span><br><span class="line">   myRangeMap.Range(<span class="function"><span class="keyword">func</span><span class="params">(k, v <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;data_key_value = :&quot;</span>,k,v)</span><br><span class="line">      <span class="comment">//return true代表继续遍历下一个，return false代表结束遍历操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9go中的atomicxxx原子操作类类似于java中的atocmicinteger之类的"><a class="markdownIt-Anchor" href="#9go中的atomicxxx原子操作类类似于java中的atocmicinteger之类的">#</a> 9.Go 中的 AtomicXXX 原子操作类 (类似于 Java 中的 AtocmicInteger 之类的)</h3>
<p>Go 中的 atomic 包里面的功能和 Java 中的 Atomic 一样，原子操作类，原理也是 cas, 甚至提供了 cas 的 api 函数，这里不做过多讲解，</p>
<p>简单举一个代码示例，因为方法太多，详细的请参考 api 文档中的 atomic 包：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync/atomic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//简单举例</span></span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int64</span> = <span class="number">20</span></span><br><span class="line">   atomic.AddInt64(&amp;num,<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10go中的waitgroup类似于java中的countdownlatch"><a class="markdownIt-Anchor" href="#10go中的waitgroup类似于java中的countdownlatch">#</a> 10.Go 中的 WaitGroup (类似于 Java 中的 CountDownLatch)</h3>
<p>现在让我们看一个需求，比如我们开启三个并发任务，然后三个并发任务执行处理完毕后我们才让主线程继续往下面走。</p>
<p>这时候肯定不能用睡眠了，因为不知道睡眠多长时间。</p>
<p>这是 Go 中的 sync 包提供了一个 WaitGroup 的工具，他基本上和 Java 中的 CountDownLatch 的功能一致。</p>
<p>接下来让我们看代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取类似于CountDownLatch的对象</span></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//设置计数器任务为3，当3个任务全部done后，wait.Wait()才会松开阻塞</span></span><br><span class="line">   wait.Add(<span class="number">3</span>)</span><br><span class="line">   <span class="keyword">go</span> myFun1()</span><br><span class="line">   <span class="keyword">go</span> myFun2()</span><br><span class="line">   <span class="keyword">go</span> myFun3()</span><br><span class="line">   <span class="comment">//阻塞</span></span><br><span class="line">   wait.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span>  <span class="title">myFun1</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun1执行完毕&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun2</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun2执行完毕&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun3</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun3执行完毕&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">码如下：</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`go</span></span><br><span class="line"><span class="string">package main</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import (</span></span><br><span class="line"><span class="string">   &quot;fmt&quot;</span></span><br><span class="line"><span class="string">   &quot;sync&quot;</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//全局变量</span></span><br><span class="line"><span class="string">var num int</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var wait sync.WaitGroup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">var lock sync.Mutex</span></span><br><span class="line"><span class="string">func main() &#123;</span></span><br><span class="line"><span class="string">   wait.Add(5)</span></span><br><span class="line"><span class="string">   go myAdd()</span></span><br><span class="line"><span class="string">   go myAdd()</span></span><br><span class="line"><span class="string">   go myAdd()</span></span><br><span class="line"><span class="string">   go myAdd()</span></span><br><span class="line"><span class="string">   go myAdd()</span></span><br><span class="line"><span class="string">   wait.Wait()</span></span><br><span class="line"><span class="string">   //预期值等于5万，可是因为线程不安全错误，小于5万</span></span><br><span class="line"><span class="string">   fmt.Printf(&quot;num = %d\n&quot;,num)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">func  myAdd() &#123;</span></span><br><span class="line"><span class="string">   defer wait.Done()</span></span><br><span class="line"><span class="string">   for i:=0 ;i&lt;10000;i++ &#123;</span></span><br><span class="line"><span class="string">      lock.Lock()</span></span><br><span class="line"><span class="string">      num+=1</span></span><br><span class="line"><span class="string">      lock.Unlock()</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="7go中的读写锁类似于java中的reentrantreadwritelock-2"><a class="markdownIt-Anchor" href="#7go中的读写锁类似于java中的reentrantreadwritelock-2">#</a> 7.Go 中的读写锁 (类似于 Java 中的 ReentrantReadWriteLock)</h3>
<p>读写锁用于读多写少的情况，多个线程并发读不上锁，写的时候才上锁互斥</p>
<p>读写锁示例代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//金额</span></span><br><span class="line"><span class="keyword">var</span> moneyA  = <span class="number">1000</span></span><br><span class="line"><span class="comment">//读写锁</span></span><br><span class="line"><span class="keyword">var</span> rwLock sync.RWMutex;</span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"><span class="comment">//添加金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">subtractMoney</span><span class="params">(subMoney <span class="type">int</span>)</span></span> &#123;</span><br><span class="line">   rwLock.Lock()</span><br><span class="line">   time.Sleep(<span class="number">3</span>*time.Second)</span><br><span class="line">   moneyA-=subMoney</span><br><span class="line">   rwLock.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询金额</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getMoney</span><span class="params">()</span></span> <span class="type">int</span> &#123;</span><br><span class="line">   rwLock.RLock()</span><br><span class="line">   result := moneyA</span><br><span class="line">   rwLock.RUnlock()</span><br><span class="line">   <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   wait.Add(<span class="number">2</span>)</span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wait.Done()</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">200</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">200</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;200元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line"></span><br><span class="line">   <span class="comment">//添加查询金额</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wait.Done()</span><br><span class="line">      <span class="keyword">if</span>(getMoney()&gt;<span class="number">900</span>) &#123;</span><br><span class="line">         subtractMoney(<span class="number">900</span>)</span><br><span class="line">         fmt.Printf(<span class="string">&quot;900元扣款成功，剩下：%d元\n&quot;</span>,getMoney())</span><br><span class="line">      &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         fmt.Println(<span class="string">&quot;余额不足，无法扣款&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;()</span><br><span class="line">   wait.Wait()</span><br><span class="line">   fmt.Println(getMoney())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8go中的并发安全map类似于currenthashmap-2"><a class="markdownIt-Anchor" href="#8go中的并发安全map类似于currenthashmap-2">#</a> 8.Go 中的并发安全 Map (类似于 CurrentHashMap)</h3>
<p>Go 中自己通过 make 创建的 map 不是线程安全的，具体体现在多线程添加值和修改值下会报如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal error : concurrent map writes</span><br></pre></td></tr></table></figure>
<p>这个错类似于 java 中多线程读写线程不安全的容器时报的错。</p>
<p>Go 为了解决这个问题，专门给我们提供了一个并发安全的 map，这个并发安全的 map 不用通过 make 创建，拿来即可用，并且他提供了一些不同于普通 map 的操作方法。</p>
<p>参考如下代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个sync包下的线程安全map对象</span></span><br><span class="line"><span class="keyword">var</span> myConcurrentMap = sync.Map&#123;&#125;</span><br><span class="line"><span class="comment">//遍历数据用的</span></span><br><span class="line"><span class="keyword">var</span> myRangeMap = sync.Map&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//存储数据</span></span><br><span class="line">   myConcurrentMap.Store(<span class="number">1</span>,<span class="string">&quot;li_ming&quot;</span>)</span><br><span class="line">   <span class="comment">//取出数据</span></span><br><span class="line">   name,ok := myConcurrentMap.Load(<span class="number">1</span>)</span><br><span class="line">   <span class="keyword">if</span>(!ok) &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;不存在&quot;</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//打印值  li_ming</span></span><br><span class="line">   fmt.Println(name)</span><br><span class="line">   <span class="comment">//该key有值,则ok为true,返回它原来存在的值，不做任何操作；该key无值，则执行添加操作，ok为false,返回新添加的值</span></span><br><span class="line">   name2, ok2 := myConcurrentMap.LoadOrStore(<span class="number">1</span>,<span class="string">&quot;xiao_hong&quot;</span>)</span><br><span class="line">   <span class="comment">//因为key=1存在，所以打印是   li_ming true</span></span><br><span class="line">   fmt.Println(name2,ok2)</span><br><span class="line">   name3, ok3 := myConcurrentMap.LoadOrStore(<span class="number">2</span>,<span class="string">&quot;xiao_hong&quot;</span>)</span><br><span class="line">   <span class="comment">//因为key=2不存在，所以打印是   xiao_hong false</span></span><br><span class="line">   fmt.Println(name3,ok3)</span><br><span class="line">   <span class="comment">//标记删除值</span></span><br><span class="line">   myConcurrentMap.Delete(<span class="number">1</span>)</span><br><span class="line">   <span class="comment">//取出数据</span></span><br><span class="line">   <span class="comment">//name4,ok4 := myConcurrentMap.Load(1)</span></span><br><span class="line">   <span class="comment">//if(!ok4) &#123;</span></span><br><span class="line">   <span class="comment">// fmt.Println(&quot;name4=不存在&quot;)</span></span><br><span class="line">   <span class="comment">// return</span></span><br><span class="line">   <span class="comment">//&#125;</span></span><br><span class="line">   <span class="comment">//fmt.Println(name4)</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">//遍历数据</span></span><br><span class="line">   rangeFunc()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">rangeFunc</span><span class="params">()</span></span>&#123;</span><br><span class="line">   myRangeMap.Store(<span class="number">1</span>,<span class="string">&quot;xiao_ming&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">2</span>,<span class="string">&quot;xiao_li&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">3</span>,<span class="string">&quot;xiao_ke&quot;</span>)</span><br><span class="line">   myRangeMap.Store(<span class="number">4</span>,<span class="string">&quot;xiao_lei&quot;</span>)</span><br><span class="line"></span><br><span class="line">   myRangeMap.Range(<span class="function"><span class="keyword">func</span><span class="params">(k, v <span class="keyword">interface</span>&#123;&#125;)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">&quot;data_key_value = :&quot;</span>,k,v)</span><br><span class="line">      <span class="comment">//return true代表继续遍历下一个，return false代表结束遍历操作</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">   &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9go中的atomicxxx原子操作类类似于java中的atocmicinteger之类的-2"><a class="markdownIt-Anchor" href="#9go中的atomicxxx原子操作类类似于java中的atocmicinteger之类的-2">#</a> 9.Go 中的 AtomicXXX 原子操作类 (类似于 Java 中的 AtocmicInteger 之类的)</h3>
<p>Go 中的 atomic 包里面的功能和 Java 中的 Atomic 一样，原子操作类，原理也是 cas, 甚至提供了 cas 的 api 函数，这里不做过多讲解，</p>
<p>简单举一个代码示例，因为方法太多，详细的请参考 api 文档中的 atomic 包：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync/atomic&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//简单举例</span></span><br><span class="line">   <span class="keyword">var</span> num <span class="type">int64</span> = <span class="number">20</span></span><br><span class="line">   atomic.AddInt64(&amp;num,<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10go中的waitgroup类似于java中的countdownlatch-2"><a class="markdownIt-Anchor" href="#10go中的waitgroup类似于java中的countdownlatch-2">#</a> 10.Go 中的 WaitGroup (类似于 Java 中的 CountDownLatch)</h3>
<p>现在让我们看一个需求，比如我们开启三个并发任务，然后三个并发任务执行处理完毕后我们才让主线程继续往下面走。</p>
<p>这时候肯定不能用睡眠了，因为不知道睡眠多长时间。</p>
<p>这是 Go 中的 sync 包提供了一个 WaitGroup 的工具，他基本上和 Java 中的 CountDownLatch 的功能一致。</p>
<p>接下来让我们看代码示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">   <span class="string">&quot;fmt&quot;</span></span><br><span class="line">   <span class="string">&quot;sync&quot;</span></span><br><span class="line">   <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取类似于CountDownLatch的对象</span></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//设置计数器任务为3，当3个任务全部done后，wait.Wait()才会松开阻塞</span></span><br><span class="line">   wait.Add(<span class="number">3</span>)</span><br><span class="line">   <span class="keyword">go</span> myFun1()</span><br><span class="line">   <span class="keyword">go</span> myFun2()</span><br><span class="line">   <span class="keyword">go</span> myFun3()</span><br><span class="line">   <span class="comment">//阻塞</span></span><br><span class="line">   wait.Wait()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span>  <span class="title">myFun1</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun1执行完毕&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun2</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun2执行完毕&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFun3</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">//计数器减1</span></span><br><span class="line">   <span class="keyword">defer</span> wait.Done()</span><br><span class="line">   <span class="comment">//睡眠五秒</span></span><br><span class="line">   time.Sleep(time.Second*<span class="number">5</span>)</span><br><span class="line">   fmt.Println(<span class="string">&quot;fun3执行完毕&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.379Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:24:56.049Z" title="2023-3-21 15:24:56">2023-03-21</time>更新</span><span class="level-item">3 分钟读完 (大约382个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Vue%E3%80%91el-upload%E9%99%90%E5%88%B6%E5%8F%AA%E4%B8%8A%E4%BC%A0%E4%B8%80%E5%BC%A0%E5%9B%BE%E7%89%87%E5%B9%B6%E9%9A%90%E8%97%8F%E5%8F%B3%E4%BE%A7%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%8C%BA%E5%9F%9F/">【Vue】el-upload限制只上传一张图片并隐藏右侧的上传区域</a></p><div class="content"><h1 id="vueel-upload限制只上传一张图片并隐藏右侧的上传区域"><a class="markdownIt-Anchor" href="#vueel-upload限制只上传一张图片并隐藏右侧的上传区域">#</a> 【Vue】el-upload 限制只上传一张图片并隐藏右侧的上传区域</h1>
<p>使用 element UI 中的 el-upload 如何限制上传一张图片后隐藏右侧的上传区域</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8c0456f090629e60b774748ac33ee22b.png" alt="img"></p>
<p>主要代码块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">监听事件</span><br><span class="line"><span class="attr">watch</span>: &#123;</span><br><span class="line">  <span class="attr">onChangeImgUrl</span>: &#123;</span><br><span class="line">    <span class="title function_">handler</span>(<span class="params">newName</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> aa = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.el-upload--picture-card&#x27;</span>)</span><br><span class="line">      <span class="keyword">if</span> (newName) &#123;</span><br><span class="line">        aa.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span> </span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          aa.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline-block&#x27;</span></span><br><span class="line">        &#125;, <span class="number">1100</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>原理：</p>
<p>因为只上传一张图片，监听图片的 url 即可。听过监听图片的 url 存在与否，通过获取 dom 元素设置不同的样式。</p>
<p>以下完整代码实现如下效果:</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/b3c00ea22f8c0efde7e61125a35a7083.png" alt="img"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">父组件setBank.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;setBank&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addInfo&quot;</span>&gt;</span>入驻<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-dialog</span> <span class="attr">:visible.sync</span>=<span class="string">&quot;checkDialogVisible&quot;</span> <span class="attr">title</span>=<span class="string">&quot;入驻&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Upload</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-dialog</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Upload</span> <span class="keyword">from</span> <span class="string">&#x27;./upload.vue&#x27;</span></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">components</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title class_">Upload</span></span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">checkDialogVisible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//  入驻</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">addInfo</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">checkDialogVisible</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">子组件 upload.vue</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;con_form&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">ref</span>=<span class="string">&quot;addForm&quot;</span> <span class="attr">:model</span>=<span class="string">&quot;addForm&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo-comCreditForm&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;200px&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;企业名称：&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;name&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;转贷机构名称&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;统一社会信用代码：&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;code&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">&quot;addForm.code&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入统一社会信用代码&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload_icon&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;上传：&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;addForm&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:auto-upload</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:limit</span>=<span class="string">&quot;limitCount&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:on-remove</span>=<span class="string">&quot;handleRemove&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:on-change</span>=<span class="string">&quot;onChange&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:on-success</span>=<span class="string">&quot;handleSuccess&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:file-list</span>=<span class="string">&quot;fileList&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:data</span>=<span class="string">&quot;uploadData&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">:before-upload</span>=<span class="string">&quot;beforeAvatarUpload&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">action</span>=<span class="string">&quot;#&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;avatar-uploader&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">list-type</span>=<span class="string">&quot;picture-card&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">accept</span>=<span class="string">&quot;image/jpg,image/jpeg,image/png&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-if</span>=<span class="string">&quot;url&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;url&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-upload-list__item-thumbnail&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">v-else</span> <span class="attr">slot</span>=<span class="string">&quot;default&quot;</span> <span class="attr">class</span>=<span class="string">&quot;el-icon-plus&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;el-upload__tip&quot;</span>&gt;</span>jpg.jpeg、png格式，大小5M以内<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">limitCount</span>: <span class="number">1</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">onChangeImgUrl</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">uploadData</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;testFile&#x27;</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">fileList</span>: [],</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">//  申请入驻银行 表单</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">addForm</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">code</span>: <span class="string">&#x27;&#x27;</span> <span class="comment">//  社会信用代码</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">watch</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">onChangeImgUrl</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">handler</span>(<span class="params">newName</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> aa = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.el-upload--picture-card&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (newName) &#123;</span></span><br><span class="line"><span class="language-javascript">          aa.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            aa.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline-block&#x27;</span></span></span><br><span class="line"><span class="language-javascript">          &#125;, <span class="number">1100</span>)</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">onChange</span>(<span class="params">file, fileList</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">onChangeImgUrl</span> = file.<span class="property">url</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleRemove</span>(<span class="params">file, fileList</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">onChangeImgUrl</span> = <span class="string">&#x27;&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleSuccess</span>(<span class="params">file, fileList</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$set(<span class="variable language_">this</span>.<span class="property">myForm</span>, <span class="string">&#x27;netTgThumbnail&#x27;</span>, fileList.<span class="property">response</span>.<span class="property">bean</span>.<span class="property">result</span>.<span class="property">fileUrlPath</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 限制图片大小</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">beforeAvatarUpload</span>(<span class="params">file</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> isLt5M = file.<span class="property">size</span> / <span class="number">1024</span> / <span class="number">1024</span> &lt; <span class="number">5</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!isLt5M) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">&#x27;上传头像图片大小不能超过 2MB!&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> isLt5M</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span> <span class="attr">lang</span>=<span class="string">&quot;scss&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">/deep/<span class="selector-class">.upload_icon</span> <span class="selector-class">.el-form-item__content</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: relative;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">190px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.avatar-uploader</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">145px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">145px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">top</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"><span class="selector-class">.con_form</span> <span class="selector-class">.upload_icon</span> <span class="selector-class">.el-form-item__content</span> <span class="selector-class">.el-upload__tip</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">position</span>: absolute;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">left</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.377Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:20:02.431Z" title="2023-3-21 15:20:02">2023-03-21</time>更新</span><span class="level-item">5 分钟读完 (大约753个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Vue%E3%80%91vue-json-editor%20json%E7%BC%96%E8%BE%91%E5%99%A8/">【Vue】vue-json-editor json编辑器.md</a></p><div class="content"><h1 id="vuevue-json-editor-json编辑器md"><a class="markdownIt-Anchor" href="#vuevue-json-editor-json编辑器md">#</a> 【Vue】vue-json-editor <a target="_blank" rel="noopener" href="http://xn--json-303gr86s2dya.md">json 编辑器.md</a></h1>
<h1 id="一-概述"><a class="markdownIt-Anchor" href="#一-概述">#</a> 一、概述</h1>
<p>现有一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=vue%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020"> vue 项目</a>，需要一个 json 编辑器，能够格式化 json 数据，同时也支持编辑功能。</p>
<p>vue-json-editor 插件就可以实现这个功能</p>
<h1 id="二-vue-json-editor-使用"><a class="markdownIt-Anchor" href="#二-vue-json-editor-使用">#</a> 二、vue-json-editor 使用</h1>
<h2 id="安装插件"><a class="markdownIt-Anchor" href="#安装插件">#</a> 安装插件</h2>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue<span class="operator">-</span>json<span class="operator">-</span>editor <span class="comment">--save</span></span><br></pre></td></tr></table></figure>
<h2 id="使用"><a class="markdownIt-Anchor" href="#使用">#</a> 使用</h2>
<p>test.vue</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 70%;margin-left: 30px;margin-top: 30px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">vue-json-editor</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;resultInfo&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:showBtns</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:mode</span>=<span class="string">&quot;&#x27;code&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">     </span></span><br><span class="line"><span class="tag">      @<span class="attr">json-change</span>=<span class="string">&quot;onJsonChange&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">json-save</span>=<span class="string">&quot;onJsonSave&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">has-error</span>=<span class="string">&quot;onError&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;checkJson&quot;</span>&gt;</span>确定<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 导入模块</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> vueJsonEditor <span class="keyword">from</span> <span class="string">&#x27;vue-json-editor&#x27;</span></span></span><br><span class="line"><span class="language-javascript"> </span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 注册组件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">components</span>: &#123; vueJsonEditor &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">hasJsonFlag</span>:<span class="literal">true</span>,  <span class="comment">// json是否验证通过</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// json数据</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">resultInfo</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="string">&#x27;employees&#x27;</span>: [</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Bill&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="string">&#x27;lastName&#x27;</span>: <span class="string">&#x27;Gates&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;George&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;lastName&#x27;</span>: <span class="string">&#x27;Bush&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;firstName&#x27;</span>: <span class="string">&#x27;Thomas&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="string">&#x27;lastName&#x27;</span>: <span class="string">&#x27;Carter&#x27;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">          ]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">mounted</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      onJsonChange (value) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(&#x27;更改value:&#x27;, value);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 实时保存</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">onJsonSave</span>(value)</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      onJsonSave (value) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(&#x27;保存value:&#x27;, value);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">resultInfo</span> = value</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">hasJsonFlag</span> = <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">onError</span>(<span class="params">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// console.log(&quot;json错误了value:&quot;, value);</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">hasJsonFlag</span> = <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 检查json</span></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">checkJson</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hasJsonFlag</span> == <span class="literal">false</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// console.log(&quot;json验证失败&quot;)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.$message.error(&quot;json验证失败&quot;)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">alert</span>(<span class="string">&quot;json验证失败&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// console.log(&quot;json验证成功&quot;)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// this.$message.success(&quot;json验证成功&quot;)</span></span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">alert</span>(<span class="string">&quot;json验证成功&quot;</span>)</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>插件参数说明：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vue-json-editor</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-model</span>=<span class="string">&quot;resultInfo&quot;</span>  // <span class="attr">绑定数据resultInfo</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:showBtns</span>=<span class="string">&quot;false&quot;</span>  // <span class="attr">是否显示保存按钮</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:mode</span>=<span class="string">&quot;&#x27;code&#x27;&quot;</span>  // <span class="attr">默认编辑模式</span></span></span><br><span class="line"><span class="tag">       // <span class="attr">显示中文</span>，<span class="attr">默认英文</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">json-change</span>=<span class="string">&quot;onJsonChange&quot;</span>  // <span class="attr">数据改变事件</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">json-save</span>=<span class="string">&quot;onJsonSave&quot;</span>  // <span class="attr">数据保存事件</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">has-error</span>=<span class="string">&quot;onError&quot;</span>  // <span class="attr">数据错误事件</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br></pre></td></tr></table></figure>
<p>相关说明：</p>
<p><strong>resultInfo 默认绑定的变量，这个变量可以为空，编辑器会显示为 {}</strong></p>
<p><strong>:showBtns 这里不显示保存按钮，为什么呢？原因有 2 个。1. 默认样式不好看。2. 只能当 json 数据正确，才能点击保存按钮，否则禁止点击。</strong></p>
<p><strong>json-change，json-save，has-error 这 3 个事件，是会实时触发的。</strong></p>
<p>这里我额外加了一个检测方法，用来判断 json 数据是否正确。默认标记为 true，当不正确时，会改变状态为 false。</p>
<h2 id="访问"><a class="markdownIt-Anchor" href="#访问">#</a> 访问</h2>
<p>点击确定，提示成功</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f9195e9eeb26d90a8751d345ccdc6c16.png" alt="img"></p>
<p>改为错误的，点击确定，会提示失败。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/c290d807c751bfc2b24672522aa35b6d.png" alt="img"></p>
<p>注意：这个 json 编辑会带有下来菜单，实际项目中，需要去除，比较用户误操作。</p>
<p>在实际使用中发现几个问题：</p>
<p>\1. 输入中文时，传给后端的值不多</p>
<p>\2. 输入大量 json 时，会有部分数据丢失。</p>
<p>因此，我们使用下面的编辑器 bin-code-editor</p>
<h1 id="三-bin-code-editor"><a class="markdownIt-Anchor" href="#三-bin-code-editor">#</a> 三、bin-code-editor</h1>
<h2 id="安装模块"><a class="markdownIt-Anchor" href="#安装模块">#</a> 安装模块</h2>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install bin-code-editor -d</span><br></pre></td></tr></table></figure>
<h2 id="引入"><a class="markdownIt-Anchor" href="#引入">#</a> 引入</h2>
<p>在 main.js 中写入 2 行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">CodeEditor</span> <span class="keyword">from</span> <span class="string">&#x27;bin-code-editor&#x27;</span>;</span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">CodeEditor</span>);</span><br></pre></td></tr></table></figure>
<p>test.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;width: 70%;margin-left: 30px;margin-top: 30px;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">b-code-editor</span> <span class="attr">v-model</span>=<span class="string">&quot;jsonStr&quot;</span> <span class="attr">:auto-format</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:smart-indent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">theme</span>=<span class="string">&quot;dracula&quot;</span> <span class="attr">:indent-unit</span>=<span class="string">&quot;4&quot;</span> <span class="attr">:line-wrap</span>=<span class="string">&quot;false&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;editor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b-code-editor</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSubumit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> jsonData =<span class="string">`&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &quot;employees&quot;: [&#123;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;firstName&quot;: &quot;Bill&quot;,</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;lastName&quot;: &quot;Gates&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &#125;, &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;firstName&quot;: &quot;George&quot;,</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;lastName&quot;: &quot;Bush&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &#125;, &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;firstName&quot;: &quot;Thomas&quot;,</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">      &quot;lastName&quot;: &quot;Carter&quot;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &#125;]</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">  &#125;`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">jsonStr</span>:jsonData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">methods</span>: &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 检测json格式</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">isJSON</span>(<span class="params">str</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (<span class="keyword">typeof</span> str == <span class="string">&#x27;string&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">try</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">var</span> obj=<span class="title class_">JSON</span>.<span class="title function_">parse</span>(str);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">if</span>(<span class="keyword">typeof</span> obj == <span class="string">&#x27;object&#x27;</span> &amp;&amp; obj )&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;<span class="keyword">else</span>&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"> </span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125; <span class="keyword">catch</span>(e) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">return</span> <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> str == <span class="string">&#x27;object&#x27;</span>  &amp;&amp; str) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">onSubumit</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isJSON</span>(<span class="variable language_">this</span>.<span class="property">jsonStr</span>))&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">error</span>(<span class="string">`json格式错误`</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">return</span> <span class="literal">false</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">this</span>.<span class="property">$message</span>.<span class="title function_">success</span>(<span class="string">&#x27;json格式正确&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>访问测试页面，效果如下：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/a4e861d97e8c5834037dd0c38546c01c.png" alt="img"></p>
<p>输入错误的值，点击执行，会有提示</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0d0f360a6b1cc9c221a0d8608dfe81da.png" alt="img"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.375Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:26:21.080Z" title="2023-3-21 15:26:21">2023-03-21</time>更新</span><span class="level-item">6 分钟读完 (大约835个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Java%E3%80%91Integer%E7%9A%84%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6/">【Java】Integer的缓存机制</a></p><div class="content"><h1 id="integer的缓存机制"><a class="markdownIt-Anchor" href="#integer的缓存机制">#</a> Integer 的缓存机制</h1>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li><a href="#__1">一 现象</a></li>
<li><a href="#_Integer_19">二 Integer 的缓存机制</a></li>
<li>
<ul>
<li><a href="#21_valueOf_20">2.1 自动装箱等效于 valueOf</a></li>
<li><a href="#22_valueOf_29">2.2 valueOf</a></li>
<li><a href="#23_IntegerCache_39">2.3 IntegerCache</a></li>
</ul>
</li>
<li><a href="#__76">三 为什么要有缓存机制</a></li>
<li>
<ul>
<li><a href="#31__77">3.1 原因</a></li>
<li><a href="#32__79">3.2 其他包装对象的缓存</a></li>
</ul>
</li>
</ul>
<h1 id="一-现象"><a class="markdownIt-Anchor" href="#一-现象">#</a> 一 现象</h1>
<p>在引入 Integer 的缓存机制前，可以先判断一下以下几种情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   # 一：自动装箱</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">      <span class="type">Integer</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">      System.out.println(s1 == s2);</span><br><span class="line">      # 答案为<span class="literal">true</span></span><br><span class="line">     	</span><br><span class="line"># 二：</span><br><span class="line"><span class="type">Integer</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">2</span>);</span><br><span class="line"><span class="type">Integer</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">2</span>);</span><br><span class="line">System.out.println(s1 == s2);</span><br><span class="line"># 答案为<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>情况二很好理解，虽然传值相同，但是 Integer 是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8C%85%E8%A3%85%E7%B1%BB&amp;spm=1001.2101.3001.7020">包装类</a>，不同对象的引用地址是不一样的，而 “==” 比的是引用地址，那为什么情况一中会得到结果 true<br>
 这里就不得不提到 Integer 的缓存机制了</p>
<h1 id="二-integer的缓存机制"><a class="markdownIt-Anchor" href="#二-integer的缓存机制">#</a> 二 Integer 的缓存机制</h1>
<h2 id="21-自动装箱等效于valueof"><a class="markdownIt-Anchor" href="#21-自动装箱等效于valueof">#</a> 2.1 自动装箱等效于 valueOf</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#以上代码的情况一的自动装箱等效于Integer中的ValueOf()方法，如下：</span><br><span class="line">	<span class="type">Integer</span> <span class="variable">s1</span> <span class="operator">=</span> Integer.valueOf(<span class="number">2</span>);</span><br><span class="line">	<span class="type">Integer</span> <span class="variable">s2</span> <span class="operator">=</span> Integer.valueOf(<span class="number">2</span>);</span><br><span class="line">	System.out.println(s1 == s2);</span><br></pre></td></tr></table></figure>
<h2 id="22-valueof"><a class="markdownIt-Anchor" href="#22-valueof">#</a> 2.2 valueOf</h2>
<p>以下是 valueOf () 方法的具体实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">valueOf</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</span><br><span class="line">         <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(i);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>可以看见，其实现方式和 IntegerCache 有关</p>
<h2 id="23-integercache"><a class="markdownIt-Anchor" href="#23-integercache">#</a> 2.3 IntegerCache</h2>
<p>IntegerCache 是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Interger&amp;spm=1001.2101.3001.7020"> Interger</a> 的一个静态内部类，实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">IntegerCache</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> -<span class="number">128</span>;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> high;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">final</span> Integer cache[];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> &#123;</span><br><span class="line">            <span class="comment">// high value may be configured by property</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">127</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">integerCacheHighPropValue</span> <span class="operator">=</span></span><br><span class="line">                sun.misc.VM.getSavedProperty(<span class="string">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (integerCacheHighPropValue != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> parseInt(integerCacheHighPropValue);</span><br><span class="line">                    i = Math.max(i, <span class="number">127</span>);</span><br><span class="line">                    <span class="comment">// Maximum array size is Integer.MAX_VALUE</span></span><br><span class="line">                    h = Math.min(i, Integer.MAX_VALUE - (-low) -<span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span>( NumberFormatException nfe) &#123;</span><br><span class="line">                    <span class="comment">// If the property cannot be parsed into an int, ignore it.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            high = h;</span><br><span class="line"></span><br><span class="line">            cache = <span class="keyword">new</span> <span class="title class_">Integer</span>[(high - low) + <span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> low;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; cache.length; k++)</span><br><span class="line">                cache[k] = <span class="keyword">new</span> <span class="title class_">Integer</span>(j++);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span></span><br><span class="line">            <span class="keyword">assert</span> IntegerCache.high &gt;= <span class="number">127</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，默认情况下，该<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB&amp;spm=1001.2101.3001.7020">静态内部类</a>会直接缓存 - 127 到 128 的 Integer 对象，因此，在 valueOf () 方法中，如果值在 - 127-128 之间，都会直接返回缓存中的该对象而不会重新生成对象，引用地址当然相同了。<br>
而且 java5 引入时，该范围还是固定的，而在 java6 之后，Integer 的缓存中还可以通过 Integer.IntegerCache.high 来设置最大值。由于这个缓存机制，程序中第一次使用 Integer 的时候还需要一定的时间家长该缓存类</p>
<h1 id="三-为什么要有缓存机制"><a class="markdownIt-Anchor" href="#三-为什么要有缓存机制">#</a> 三 为什么要有缓存机制</h1>
<h2 id="31-原因"><a class="markdownIt-Anchor" href="#31-原因">#</a> 3.1 原因</h2>
<p>因为我们常见的基本数据类型中，使用包装类包装数值时会创建大量对象，如果没有缓存的话，会有大量的包装类被创建，占用内存，降低效率。选择最常用的数值范围设置缓存机制，就可以优化这一现象</p>
<h2 id="32-其他包装对象的缓存"><a class="markdownIt-Anchor" href="#32-其他包装对象的缓存">#</a> 3.2 其他包装对象的缓存</h2>
<p>既然缓存机制的原因我们知道了，那除了 Integer 之外，其他包装类有这种缓存机制吗？肯定是有的</p>
<ul>
<li>ByteCache：缓存 Byte 对象</li>
<li>ShortChche：缓存 Short 对象</li>
<li>LongChche：缓存 Long 对象</li>
<li>CharacterChche：缓存 Character 对象<br>
 Byte，Short，Long 的缓存范围都是 - 128-127，Character 的缓存范围是 0-127，除了 Integer，其他的缓存范围都是固定的</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-21T07:46:57.373Z" title="2023-3-21 15:46:57">2023-03-21</time>发表</span><span class="level-item"><time dateTime="2023-03-21T07:22:53.704Z" title="2023-3-21 15:22:53">2023-03-21</time>更新</span><span class="level-item">1 分钟读完 (大约148个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/21/%E3%80%90Vue%E3%80%91Element%20UI%20el-tag%20%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C%E7%8A%B6%E6%80%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%B1%95%E7%A4%BA%E4%B8%8D%E5%90%8C%E9%A2%9C%E8%89%B2%E7%9A%84%E6%A0%87%E7%AD%BE/">【Vue】Element UI el-tag 根据不同状态的数据展示不同颜色的标签</a></p><div class="content"><h1 id="vueelement-ui-el-tag-根据不同状态的数据展示不同颜色的标签"><a class="markdownIt-Anchor" href="#vueelement-ui-el-tag-根据不同状态的数据展示不同颜色的标签">#</a> 【Vue】Element UI el-tag 根据不同状态的数据展示不同颜色的标签</h1>
<h2 id="element-ui-根据不同状态的数据展示不同颜色的标签"><a class="markdownIt-Anchor" href="#element-ui-根据不同状态的数据展示不同颜色的标签">#</a> Element UI 根据不同状态的数据展示不同颜色的标签</h2>
<p>展示标签可以使用 el-tag，不同的数据可以使用三目运算进行管控<br>
代码如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-tag :type=<span class="string">&quot;(scope.row.auditstatus == &#x27;0&#x27; ? &#x27;&#x27; : (scope.row.auditstatus == &#x27;1&#x27; ? &#x27;success&#x27; : (scope.row.auditstatus == &#x27;2&#x27; ? &#x27;danger&#x27; : (scope.row.auditstatus == &#x27;3&#x27; ? &#x27;warning&#x27; : &#x27;danger&#x27;))))&quot;</span> size=<span class="string">&quot;mini&quot;</span>&gt;</span><br><span class="line">	&#123;&#123; scope<span class="selector-class">.row</span><span class="selector-class">.auditstatus</span> == &#x27;<span class="number">0</span>&#x27; ? &#x27;初始值&#x27; : (scope.row.auditstatus == <span class="string">&#x27;1&#x27;</span> ? <span class="string">&#x27;审核通过&#x27;</span> : (scope.row.auditstatus == <span class="string">&#x27;2&#x27;</span> ? <span class="string">&#x27;审核不通过&#x27;</span> : (scope.row.auditstatus == <span class="string">&#x27;3&#x27;</span> ? <span class="string">&#x27;待审核&#x27;</span> : <span class="string">&#x27;删除&#x27;</span>))) &#125;&#125;</span><br><span class="line">&lt;/el-tag&gt;</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>
<p>效果图如下：<br>
<img src="https://img-blog.csdnimg.cn/20200918092202308.png#pic_center" alt="在这里插入图片描述"><br>
<img src="https://img-blog.csdnimg.cn/20200918092237888.png#pic_center" alt="在这里插入图片描述"></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/">上一页</a></div><div class="pagination-next"><a href="/page/3/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link is-current" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/11/">11</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-12T08:58:14.851Z">2023-04-12</time></p><p class="title"><a href="/2023/04/12/%E3%80%90Java%E3%80%91Graalvm%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E4%B8%8Espringboot3.0%E5%B0%9D%E9%B2%9C/">【Java】Graalvm安装配置与springboot3.0尝鲜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-12T08:51:29.975Z">2023-04-12</time></p><p class="title"><a href="/2023/04/12/%E3%80%90SpringBoot%E3%80%91SpringBoot3.0%20%E4%BA%91%E5%8E%9F%E7%94%9F%E6%97%B6%E4%BB%A3%E5%8D%B3%E5%B0%86%E6%9D%A5%E4%B8%B4%EF%BC%81/">【SpringBoot】SpringBoot3.0 云原生时代即将来临！</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-12T06:27:52.331Z">2023-04-12</time></p><p class="title"><a href="/2023/04/12/%E3%80%90Java%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%B0%86%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BAList%E9%9B%86%E5%90%88/">【Java】如何优雅的将数组转换为List集合</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-11T09:18:33.616Z">2023-04-11</time></p><p class="title"><a href="/2023/04/11/%E3%80%90Redis%E3%80%91SpringBoot%E6%95%B4%E5%90%88Redis%EF%BC%8C%E7%BC%93%E5%AD%98%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%20%20redisTemplate.keys(pattern)%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E6%89%BE%E4%B8%8D%E5%88%B0keys%EF%BC%8C%E2%80%9C%20%20%E2%80%9C%20%E9%80%9A%E9%85%8D%E7%AC%A6%E6%97%A0%E6%95%88/">【Redis】SpringBoot整合Redis，缓存批量删除  redisTemplate.keys(pattern)模糊查询找不到keys，“  “ 通配符无效</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-11T07:25:27.293Z">2023-04-11</time></p><p class="title"><a href="/2023/04/11/%E3%80%90MySQL%E3%80%91MySql%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96%E5%88%86%E4%BA%AB/">【MySQL】MySql相关优化分享</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">48</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">56</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/7f71f67568cbf455bf7b2c32345f71e3.jpg" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">为了更好的你，也为了更好的世界。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">104</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>