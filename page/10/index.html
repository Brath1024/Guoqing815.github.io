<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:description" content="ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/avatar.png"}},"description":"ä¸ºäº†æ›´å¥½çš„ä½ ï¼Œä¹Ÿä¸ºäº†æ›´å¥½çš„ä¸–ç•Œ"}</script><link rel="icon" href="https://brath.cloud/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ä¸»é¡µ</a><a class="navbar-item" href="/archives">æ–‡ç« åˆ—è¡¨</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">æ›´å¤š</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-20T13:10:20.000Z" title="2021-4-20 21:10:20">2021-04-20</time>å‘è¡¨</span><span class="level-item"><time dateTime="2020-01-17T08:24:41.000Z" title="2020-1-17 16:24:41">2020-01-17</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦962ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/20/%E3%80%90Vue%E3%80%91Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2VUE%E9%A1%B9%E7%9B%AE/">LinuxæœåŠ¡å™¨ä¸‹éƒ¨ç½²vue 2.0é¡¹ç›®</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="ä¸€-å®‰è£…vueç¯å¢ƒ"><a class="markdownIt-Anchor" href="#ä¸€-å®‰è£…vueç¯å¢ƒ">#</a> ä¸€ã€å®‰è£… VUE ç¯å¢ƒ</h3>
<p>1.wget æŒ‡å®šè¿›è¡Œä¸‹è½½ï¼Œä¸‹è½½åæ–‡ä»¶é»˜è®¤å­˜åœ¨æ ¹ç›®å½•ä¸‹çš„ root åŒ…ä¸‹é¢ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://nodejs.org/dist/v16.14.0/node-v16.14.0-linux-x64.tar.xz</span><br></pre></td></tr></table></figure>
<p>è§£å‹ç¼©</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xz -d node-v16.14.0-linux-x64.tar.xz  #å°†xzæ ¼å¼è§£å‹ä¸ºtar</span><br><span class="line"></span><br><span class="line">tar -xvf node-v16.14.0-linux-x64.tar  #å°†tarè§£å‹ä¸ºæ–‡ä»¶</span><br></pre></td></tr></table></figure>
<p>é‡å‘½åæ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv node-v16.14.0-linux-x64 nodeJS-V16.14.0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é…ç½® node.js ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶æœ€ä¸‹é¢åŠ ä¸Šå¦‚ä¸‹å­—æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NODEJS_HOME=/root/nodeJS-V16.14.0</span><br><span class="line">export PATH=$NODEJS_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>ä¸ªäººæ¯”è¾ƒå–œæ¬¢ç”¨ Xftp å°† profile æ–‡ä»¶ä¼ è¾“åˆ° windows ç³»ç»Ÿä¸‹è¿›è¡Œé…ç½®åå†è¦†ç›–å›å»</p>
<p>é…ç½®å®Œæˆåä½¿ç”¨ source å‘½ä»¤é‡æ–°æ‰§è¡Œåˆšä¿®æ”¹çš„åˆå§‹åŒ–æ–‡ä»¶ï¼Œä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆï¼Œè€Œä¸å¿…æ³¨é”€å¹¶é‡æ–°ç™»å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>
<p>å®‰è£… WebPackage</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack -g --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<h3 id="äºŒ-nginxç¯å¢ƒæ­å»ºé…ç½®"><a class="markdownIt-Anchor" href="#äºŒ-nginxç¯å¢ƒæ­å»ºé…ç½®">#</a> äºŒã€Nginx ç¯å¢ƒæ­å»ºé…ç½®</h3>
<p>wget æŒ‡å®šè¿›è¡Œä¸‹è½½ï¼Œä¸‹è½½åæ–‡ä»¶é»˜è®¤å­˜åœ¨æ ¹ç›®å½•ä¸‹çš„ root ä¸‹é¢ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.wget https://nginx.org/download/nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure>
<p>è§£å‹ç¼©</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ nginx æ–‡ä»¶å¤¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /root/nginx-1.21.6</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>
<p>å®‰è£… gcc ç¯å¢ƒï¼Œæœ‰å°±ä¸éœ€è¦å®‰è£…äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>
<p>å®‰è£… PCRE ä¾èµ–åº“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>
<p>å®‰è£… zlib ä¾èµ–åº“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>
<p>å®‰è£… OpenSSL å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡æ‰§è¡Œé…ç½®æ£€æŸ¥å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘å®‰è£… nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾é»˜è®¤å®‰è£…è·¯å¾„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>
<p>é…ç½® nginx ç¯å¢ƒå˜é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥ç¼–è¾‘ï¼Œåœ¨æ–‡ä»¶æœ€ä¸‹é¢åŠ ä¸Šå¦‚ä¸‹å­—æ®µ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=$PATH:/usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>
<p>ä¸ªäººæ¯”è¾ƒå–œæ¬¢ç”¨ Xftp å°† profile æ–‡ä»¶ä¼ è¾“åˆ° windows ç³»ç»Ÿä¸‹è¿›è¡Œé…ç½®åå†è¦†ç›–å›å»</p>
<p>åˆå§‹åŒ–é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦é…ç½®æˆåŠŸ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -v</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨ nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ nginx æ˜¯å¦å¯åŠ¨ï¼Œè¿œç¨‹è®¿é—®æœåŠ¡å™¨ï¼Œè·³å‡º nginx æ¬¢è¿ç•Œé¢å°±ç®—é…ç½®æˆåŠŸäº†ï¼</p>
<p>nginx å¸¸ç”¨å‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨æœåŠ¡ï¼šnginx</span><br><span class="line">é€€å‡ºæœåŠ¡ï¼šnginx -s quit</span><br><span class="line">å¼ºåˆ¶å…³é—­æœåŠ¡ï¼šnginx -s stop</span><br><span class="line">é‡è½½æœåŠ¡ï¼šnginx -s reloadã€€ã€€ï¼ˆé‡è½½æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œç±»ä¼¼äºé‡å¯ï¼Œä½†æœåŠ¡ä¸ä¼šä¸­æ­¢ï¼‰</span><br><span class="line">éªŒè¯é…ç½®æ–‡ä»¶ï¼šnginx -t</span><br><span class="line">ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼šnginx -c &quot;é…ç½®æ–‡ä»¶è·¯å¾„&quot;</span><br><span class="line">ä½¿ç”¨å¸®åŠ©ï¼šnginx -h</span><br></pre></td></tr></table></figure>
<h3 id="ä¸‰-å‘å¸ƒvueé¡¹ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å‘å¸ƒvueé¡¹ç›®">#</a> ä¸‰ã€å‘å¸ƒ VUE é¡¹ç›®</h3>
<h5 id="æ‰“åŒ…vueé¡¹ç›®"><a class="markdownIt-Anchor" href="#æ‰“åŒ…vueé¡¹ç›®">#</a> æ‰“åŒ… VUE é¡¹ç›®</h5>
<p>1. é¦–å…ˆé…ç½®å¥½çº¿ä¸Šç¯å¢ƒçš„è·¯å¾„ï¼šprod.env</p>
<p><img src="https://brath.cloud/blogImg/image-20220428084247115.png" alt="image-20220428084247115"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">	NODE_ENV: &#x27;&quot;production&quot;&#x27;,</span><br><span class="line">	ENV_CONFIG: &#x27;&quot;prod&quot;&#x27;,</span><br><span class="line">	MANAGEMENT_SERVICE_API: &#x27;&quot;http://42.193.125.92:7815&quot;&#x27;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2. æ§åˆ¶å°è¾“å…¥ npm run build:prod</p>
<p><img src="https://brath.cloud/blogImg/image-20220428084349346.png" alt="image-20220428084349346"></p>
<p>3. æ‰“åŒ…å®Œä¼šç”Ÿæˆä¸€ä¸ª dist æ–‡ä»¶å¤¹</p>
<p><img src="https://brath.cloud/blogImg/image-20220428084359625.png" alt="image-20220428084359625"></p>
<p>4. å°† dist æ–‡ä»¶å¤¹å†…å®¹è¦†ç›–åˆ° /usr/local/nginx/html ç›®å½•ä¸‹é¢</p>
<p><img src="https://brath.cloud/blogImg/image-20220428084414353.png" alt="image-20220428084414353"></p>
<p>5. ä¿®æ”¹ nginx é…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/conf/nginx.conf ç¼–è¾‘æ‰“å¼€</span><br></pre></td></tr></table></figure>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span>  <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">include</span>       mime.types;</span><br><span class="line">    <span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">sendfile</span>        <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span>       <span class="number">8099</span>;  <span class="comment">#é…ç½®å½“å‰æœåŠ¡ç«¯å£</span></span><br><span class="line">        <span class="attribute">server_name</span>  localhost; <span class="comment">#é…ç½®å½“å‰æœåŠ¡IP</span></span><br><span class="line">        </span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html/dist; <span class="comment">#é…ç½®æœåŠ¡æ ¹ç›®å½•</span></span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm; <span class="comment">#é…ç½®æœåŠ¡ç´¢å¼•é¡µé¢</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">error_page</span>   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /50x.html;</span><br><span class="line">        <span class="section">location</span> = /50x.html &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6. é‡å¯æˆ–å…³é—­é‡å¼€ Nginx</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">nginx</span> -s reload <span class="comment">#é‡å¯</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nginx -s stop <span class="comment">#å¼ºåˆ¶åœæ­¢</span></span><br><span class="line"></span><br><span class="line">nginx <span class="comment">#å¼€å¯</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-01T22:45:39.000Z" title="2021-4-2 6:45:39">2021-04-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2020-01-04T09:06:42.000Z" title="2020-1-4 17:06:42">2020-01-04</time>æ›´æ–°</span><span class="level-item">17 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2566ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/02/%E3%80%90MySQL%E3%80%91%E3%80%90Redis%E3%80%91Redis%E4%B8%8EMysql%20Master%E4%B8%8ESlave%E5%90%8C%E6%AD%A5%EF%BC%9Acanal%E6%95%99%E5%AD%A6/">Redisä¸Mysql | Masterä¸SlaveåŒæ­¥ï¼šcanalæ•™å­¦</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€ï¼š</h2>
<p>â€‹		ä½œè€…æœ€è¿‘åœ¨åšè‡ªå·±çš„é¡¹ç›®ï¼Œä½¿ç”¨åˆ° Redisï¼Œéœ€è¦çƒ­æ›´æ–°ï¼Œä¿®æ”¹ Mysql ååŒæ­¥ Redis ç¼“å­˜ï¼Œå‡ºäºå¯¹åœˆå­çš„è´¡çŒ®ï¼Œä¹Ÿè¾ƒäºå½“å‰çš„ canal çš„åšå®¢å¤§å¤šæ•°ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæ‰€ä»¥å†™ä¸‹è¿™ç¯‡æ–‡ç« ï¼Œæ—¶é—´æ˜¯ 2022 å¹´ 6 æœˆ 29 æ—¥ã€‚ç›®çš„æ˜¯å¸®åŠ©æ›´å¤šçš„äººï¼Œå¸Œæœ›èƒ½ä¸ºåœ¨ç¥–å›½çš„ç»æµå‘å±•ä½œå‡ºå°å°çš„è´¡çŒ®ã€‚</p>
<p>â€‹		end</p>
<h4 id="å­¦ä¹ canalåŸºæœ¬éœ€è¦"><a class="markdownIt-Anchor" href="#å­¦ä¹ canalåŸºæœ¬éœ€è¦">#</a> å­¦ä¹  Canal åŸºæœ¬éœ€è¦ï¼š</h4>
<p>â€‹	Linux æœåŠ¡å™¨ï¼Œæ€§èƒ½æ— å¤§è¦æ±‚</p>
<p>â€‹	Java åŸºç¡€</p>
<p>â€‹	Mysqlï¼ŒRedis åŸºç¡€</p>
<h3 id="ä¿—è¯è¯´è¦äº†è§£ä¸€ä¸ªä¸œè¥¿å…ˆäº†è§£ä»–çš„ç”±æ¥"><a class="markdownIt-Anchor" href="#ä¿—è¯è¯´è¦äº†è§£ä¸€ä¸ªä¸œè¥¿å…ˆäº†è§£ä»–çš„ç”±æ¥">#</a> ä¿—è¯è¯´ï¼Œè¦äº†è§£ä¸€ä¸ªä¸œè¥¿ï¼Œå…ˆäº†è§£ä»–çš„ç”±æ¥ï¼š</h3>
<h2 id="ä¸€-canalèµ·æº"><a class="markdownIt-Anchor" href="#ä¸€-canalèµ·æº">#</a> ä¸€ã€Canal èµ·æº</h2>
<p>â€‹		é˜¿é‡Œå·´å·´å› ä¸ºä¸šåŠ¡ç‰¹æ€§ï¼Œä¹°å®¶é›†ä¸­åœ¨å›½å¤–ï¼Œè¡ç”Ÿå‡ºäº†æ­å·ç¾å›½å¼‚åœ°æ•°æ®åŒæ­¥éœ€æ±‚ï¼Œä» 2010 å¹´å¼€å§‹ï¼Œé˜¿é‡Œå·´å·´å¼€å§‹å¼€å‘ canalï¼Œcanal æ˜¯åŸºäº Java å¼€å‘çš„æ•°æ®åº“å¢é‡æ—¥å¿—è§£æï¼Œæä¾›å¢é‡æ•°æ®è®¢é˜… &amp; æ¶ˆè´¹çš„ä¸­é—´ä»¶ã€‚Canal ä¸»è¦æ”¯æŒäº† Mysql å’Œ Bilog è§£æï¼Œè§£æå®Œæˆååˆ©ç”¨ canal Client æ¥å¤„ç†è·å–ç›¸å…³æ•°æ®ã€‚</p>
<p>äº†è§£å®Œ canal çš„èµ·æºï¼Œå†æ¥çœ‹çœ‹ canal çš„æ ¸å¿ƒä¸šåŠ¡ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ mysql çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼šbinary_log ç®€ç§°ï¼šBinlog</p>
<h2 id="äºŒ-binlog"><a class="markdownIt-Anchor" href="#äºŒ-binlog">#</a> äºŒã€Binlog</h2>
<p>â€‹		binlog æŒ‡äºŒè¿›åˆ¶æ—¥å¿—ï¼Œå®ƒè®°å½•äº†æ•°æ®åº“ä¸Šçš„æ‰€æœ‰æ”¹å˜ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥çœ‹æ•°æ®åº“çš„å˜æ›´å†å²ã€æ•°æ®åº“å¢é‡å¤‡ä»½å’Œæ¢å¤ã€MySQL çš„å¤åˆ¶ï¼ˆä¸»ä»æ•°æ®åº“çš„å¤åˆ¶ï¼‰ã€‚</p>
<h4 id="binlogæœ‰ä¸‰ç§æ ¼å¼"><a class="markdownIt-Anchor" href="#binlogæœ‰ä¸‰ç§æ ¼å¼">#</a> binlog æœ‰ä¸‰ç§æ ¼å¼ï¼š</h4>
<p>statementï¼šåŸºäº SQL è¯­å¥çš„å¤åˆ¶ï¼ˆstatement-based replicationï¼ŒSBRï¼‰<br>
rowï¼šåŸºäºè¡Œçš„å¤åˆ¶ï¼ˆrow-based replicationï¼ŒRBRï¼‰<br>
mixedï¼šæ··åˆæ¨¡å¼å¤åˆ¶ï¼ˆmixed-based replicationï¼ŒMBRï¼‰</p>
<h4 id="statementè¯­å¥çº§åˆ«"><a class="markdownIt-Anchor" href="#statementè¯­å¥çº§åˆ«">#</a> statementï¼šè¯­å¥çº§åˆ«</h4>
<p>æ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„ sql éƒ½ä¼šè®°å½•åœ¨ binlog ä¸­ã€‚</p>
<p>â€‹		ä¼˜ç‚¹ï¼šä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº† binlog æ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº† IOï¼Œæé«˜æ€§èƒ½ã€‚ä½†æ˜¯æ³¨æ„ statement ç›¸æ¯”äº row èƒ½èŠ‚çº¦å¤šå°‘æ€§èƒ½ä¸æ—¥å¿—é‡ï¼Œå–å†³äºåº”ç”¨çš„ SQL æƒ…å†µã€‚æ­£å¸¸åŒä¸€æ¡è®°å½•ä¿®æ”¹æˆ–è€…æ’å…¥ row æ ¼å¼æ‰€äº§ç”Ÿçš„æ—¥å¿—é‡è¿˜å°äº Statement äº§ç”Ÿçš„æ—¥å¿—é‡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å¦‚æœå¸¦æ¡ä»¶çš„ update æ“ä½œï¼Œä»¥åŠæ•´è¡¨åˆ é™¤ï¼Œalter è¡¨ç­‰æ“ä½œï¼ŒROW æ ¼å¼ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œå› æ­¤åœ¨è€ƒè™‘æ˜¯å¦ä½¿ç”¨ ROW æ ¼å¼æ—¥å¿—æ—¶åº”è¯¥è·Ÿæ®åº”ç”¨çš„å®é™…æƒ…å†µï¼Œå…¶æ‰€äº§ç”Ÿçš„æ—¥å¿—é‡ä¼šå¢åŠ å¤šå°‘ï¼Œä»¥åŠå¸¦æ¥çš„ IO æ€§èƒ½é—®é¢˜ã€‚</p>
<p>â€‹		ç¼ºç‚¹ï¼šç”±äºè®°å½•çš„åªæ˜¯æ‰§è¡Œè¯­å¥ï¼Œä¸ºäº†è¿™äº›è¯­å¥åœ¨ slave ä¸Šæ­£ç¡®è¿è¡Œï¼Œæˆ‘ä»¬è¿˜å¿…é¡»è®°å½•æ¯æ¡è¯­å¥åœ¨æ‰§è¡Œæ—¶å€™çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¿è¯æ‰€æœ‰è¯­å¥èƒ½åœ¨ slave å¾—åˆ°å’Œåœ¨ master ç«¯æ‰§è¡Œæ—¶ç›¸åŒçš„ç»“æœã€‚å¦å¤–ï¼Œä¸€äº›ç‰¹å®šçš„å‡½æ•°åŠŸèƒ½å¦‚æœè¦åœ¨ slave å’Œ master ä¸Šä¿æŒä¸€è‡´ä¼šæœ‰å¾ˆå¤šç›¸å…³é—®é¢˜ã€‚</p>
<h4 id="rowè¡Œæ•°æ®çº§åˆ«"><a class="markdownIt-Anchor" href="#rowè¡Œæ•°æ®çº§åˆ«">#</a> rowï¼šè¡Œæ•°æ®çº§åˆ«</h4>
<p>5.1.5 ç‰ˆæœ¬çš„ MySQL æ‰å¼€å§‹æ”¯æŒ row level çš„å¤åˆ¶ï¼Œå®ƒä¸è®°å½• sql è¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ã€‚</p>
<p>â€‹		ä¼˜ç‚¹ï¼šbinlog ä¸­å¯ä»¥ä¸è®°å½•æ‰§è¡Œçš„ sql è¯­å¥çš„ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯ï¼Œä»…éœ€è¦è®°å½•é‚£ä¸€æ¡è®°å½•è¢«ä¿®æ”¹æˆä»€ä¹ˆäº†ã€‚æ‰€ä»¥ row level çš„æ—¥å¿—ä¼šéå¸¸æ¸…æ¥šçš„è®°ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ã€‚è€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ– functionï¼Œä»¥åŠ trigger çš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</p>
<p>â€‹		ç¼ºç‚¹ï¼šæ‰€æœ‰çš„æ‰§è¡Œçš„è¯­å¥å½“è®°å½•åˆ°æ—¥å¿—ä¸­çš„æ—¶å€™ï¼Œéƒ½å°†ä»¥æ¯è¡Œè®°å½•çš„ä¿®æ”¹æ¥è®°å½•ï¼Œè¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—å†…å®¹ã€‚ä½†æ˜¯æ–°ç‰ˆæœ¬çš„ MySQL å¯¹ row level æ¨¡å¼è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šä»¥ row level æ¥è®°å½•ï¼Œåƒé‡åˆ°è¡¨ç»“æ„å˜æ›´çš„æ—¶å€™å°±ä¼šä»¥ statement æ¨¡å¼æ¥è®°å½•ï¼Œå¦‚æœ sql è¯­å¥ç¡®å®å°±æ˜¯ update æˆ–è€… delete ç­‰ä¿®æ”¹æ•°æ®çš„è¯­å¥ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šè®°å½•æ‰€æœ‰è¡Œçš„å˜æ›´ã€‚</p>
<h4 id="mixedæ··åˆçº§åˆ«"><a class="markdownIt-Anchor" href="#mixedæ··åˆçº§åˆ«">#</a> mixedï¼šæ··åˆçº§åˆ«</h4>
<p>ä» 5.1.8 ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQL æä¾›äº† Mixed æ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯ Statement ä¸ Row çš„ç»“åˆã€‚</p>
<p>â€‹		åœ¨ Mixed æ¨¡å¼ä¸‹ï¼Œä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨ statment æ ¼å¼ä¿å­˜ binlogï¼Œå¦‚æœä¸€äº›å‡½æ•°ï¼Œstatement æ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™é‡‡ç”¨ row æ ¼å¼ä¿å­˜ binlogï¼ŒMySQL ä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„ sql è¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨ Statement å’Œ Row ä¹‹é—´é€‰æ‹©ä¸€ç§ã€‚</p>
<h5 id="ç”±äº-statement-å’Œ-mixed-çš„ç‰¹æ®Šæ€§é€šè¿‡sqlæ¥å¤‡ä»½æ€»ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæ¯”å¦‚nowå‡½æ•°"><a class="markdownIt-Anchor" href="#ç”±äº-statement-å’Œ-mixed-çš„ç‰¹æ®Šæ€§é€šè¿‡sqlæ¥å¤‡ä»½æ€»ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µæ¯”å¦‚nowå‡½æ•°">#</a> ç”±äº statement å’Œ mixed çš„ç‰¹æ®Šæ€§ï¼Œé€šè¿‡ sql æ¥å¤‡ä»½ï¼Œæ€»ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œæ¯”å¦‚ï¼šnow () å‡½æ•°ã€‚</h5>
<h5 id="æ‰€ä»¥ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ä½¿ç”¨-rowçº§åˆ«ä¹Ÿå°±æ˜¯è¡Œçº§åˆ«è¿™æ ·ä¿è¯æˆ‘ä»¬å¤‡ä»½çš„æ•°æ®å’Œå‡ºå£çš„æ•°æ®ç›¸ä¸€è‡´"><a class="markdownIt-Anchor" href="#æ‰€ä»¥ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ä½¿ç”¨-rowçº§åˆ«ä¹Ÿå°±æ˜¯è¡Œçº§åˆ«è¿™æ ·ä¿è¯æˆ‘ä»¬å¤‡ä»½çš„æ•°æ®å’Œå‡ºå£çš„æ•°æ®ç›¸ä¸€è‡´">#</a> æ‰€ä»¥ç»å¤§å¤šæ•°åœºæ™¯ä¸‹ä½¿ç”¨ Row çº§åˆ«ï¼Œä¹Ÿå°±æ˜¯è¡Œçº§åˆ«ï¼Œè¿™æ ·ä¿è¯æˆ‘ä»¬å¤‡ä»½çš„æ•°æ®å’Œå‡ºå£çš„æ•°æ®ç›¸ä¸€è‡´ã€‚</h5>
<h3 id="ä¸‰-ä¸‹è½½å’Œå®‰è£…canalå·¥å…·"><a class="markdownIt-Anchor" href="#ä¸‰-ä¸‹è½½å’Œå®‰è£…canalå·¥å…·">#</a> ä¸‰ã€ä¸‹è½½å’Œå®‰è£… Canal å·¥å…·</h3>
<p>ä¸‹è½½å‰ï¼Œåœ¨ mysql åˆ›å»º canal ç”¨æˆ·ï¼Œå› ä¸º canal æœåŠ¡ç«¯éœ€è¦è¿æ¥ mysql æ•°æ®åº“</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- ä½¿ç”¨å‘½ä»¤ç™»å½•ï¼šmysql -u root -p</span><br><span class="line">-- åˆ›å»ºç”¨æˆ· ç”¨æˆ·åï¼šcanal å¯†ç ï¼šCanal@123456</span><br><span class="line">create user <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;Canal@123456&#x27;</span>;</span><br><span class="line">-- æˆæƒ *.*è¡¨ç¤ºæ‰€æœ‰åº“</span><br><span class="line">grant SELECT, REPLICATION SLAVE, REPLICATION CLIENT on *.* to <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;Canal@123456&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹åé‡å¯mysqlä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æ‰“å¼€binlogæ¨¡å¼"><a class="markdownIt-Anchor" href="#æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹åé‡å¯mysqlä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æ‰“å¼€binlogæ¨¡å¼">#</a> æ”¹äº†é…ç½®æ–‡ä»¶ä¹‹åï¼Œé‡å¯ MySQLï¼Œä½¿ç”¨å‘½ä»¤æŸ¥çœ‹æ˜¯å¦æ‰“å¼€ binlog æ¨¡å¼ï¼š</h4>
<p><img src="https://brath.cloud/blogImg/20200808151606261.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="æŸ¥çœ‹binlogæ—¥å¿—æ–‡ä»¶åˆ—è¡¨"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹binlogæ—¥å¿—æ–‡ä»¶åˆ—è¡¨">#</a> æŸ¥çœ‹ binlog æ—¥å¿—æ–‡ä»¶åˆ—è¡¨ï¼š</h4>
<p><img src="https://brath.cloud/blogImg/20200808151715291.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="ç‚¹æ­¤ä¸‹è½½canal"><a class="markdownIt-Anchor" href="#ç‚¹æ­¤ä¸‹è½½canal">#</a> ç‚¹æ­¤ä¸‹è½½ CanalğŸ‘‡</h3>
<p><a target="_blank" rel="noopener" href="https://ghproxy.com/https://github.com/alibaba/canal/releases/download/canal-1.1.2/canal.deployer-1.1.2.tar.gz">https://ghproxy.com/https://github.com/alibaba/canal/releases/download/canal-1.1.2/canal.deployer-1.1.2.tar.gz</a></p>
<p>æ­¤é“¾æ¥ä¸º github ä»£ç†æä¾›è¿æ¥ï¼Œä»…ä¾›å‚è€ƒï¼Œæ­¤å¤„æ— å¹¿å‘Šæ„ä¹‰ã€‚</p>
<p><img src="https://brath.cloud/blogImg/image-20220629152616754.png" alt="image-20220629152616754"></p>
<p>ä¸‹è½½å¥½åä¸Šä¼ è‡³ linux æœåŠ¡å™¨ï¼Œåˆ›å»º canal æ–‡ä»¶å¤¹å¹¶è§£å‹åˆ° canal æ–‡ä»¶å¤¹ä¸­</p>
<p><img src="https://brath.cloud/blogImg/image-20220629153150741.png" alt="image-20220629153150741"></p>
<p>å®Œæˆåä¼šå¾—åˆ°ä»¥ä¸Šå››ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼šbinï¼Œconfï¼Œlibï¼Œlogs</p>
<p>éœ€è¦ä¿®æ”¹ä¸€å¤„é…ç½®æ–‡ä»¶ï¼š</p>
<p>â€‹		/canal/conf/example ä¸‹çš„ instance.properties</p>
<p><img src="https://brath.cloud/blogImg/image-20220629153511220.png" alt="image-20220629153511220"></p>
<p>ä¿®æ”¹å®Œæˆåä¿å­˜é€€å‡º</p>
<p>æ¥ä¸‹æ¥è¿›å…¥ bin ç›®å½• sh <a target="_blank" rel="noopener" href="http://startUp.sh">startUp.sh</a> å¯åŠ¨ canal æœåŠ¡ç«¯</p>
<h4 id="è‡³æ­¤æœåŠ¡ç«¯çš„æ“ä½œåŸºæœ¬å®Œæˆ"><a class="markdownIt-Anchor" href="#è‡³æ­¤æœåŠ¡ç«¯çš„æ“ä½œåŸºæœ¬å®Œæˆ">#</a> è‡³æ­¤æœåŠ¡ç«¯çš„æ“ä½œåŸºæœ¬å®Œæˆ</h4>
<p>Java å®¢æˆ·ç«¯æ“ä½œ<br>
é¦–å…ˆå¼•å…¥ maven ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.otter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>canal.client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååˆ›å»ºä¸€ä¸ª canal é¡¹ç›®ï¼Œä½¿ç”¨ SpringBoot æ„å»ºï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåˆ›å»º canal åŒ…ï¼š</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20220629153956493.png" alt="image-20220629153956493"></p>
<p>canal å·¥å…·ç±»ï¼Œä»…ä¾›å‚è€ƒ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.brath.canal;</span><br><span class="line"><span class="keyword">import</span> java.awt.print.Printable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.brath.common.redis.service.TokenService;</span><br><span class="line"><span class="keyword">import</span> cn.brath.common.redis.util.RedisKeys;</span><br><span class="line"><span class="keyword">import</span> cn.brath.common.utils.AssertUtil;</span><br><span class="line"><span class="keyword">import</span> cn.brath.common.utils.UserTokenManager;</span><br><span class="line"><span class="keyword">import</span> cn.brath.entity.IvUser;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.client.CanalConnector;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.client.CanalConnectors;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.*;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.otter.canal.protocol.Message;</span><br><span class="line"><span class="keyword">import</span> com.google.protobuf.InvalidProtocolBufferException;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.print.attribute.standard.MediaPrintableArea;</span><br><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.time.ZoneId;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CanalClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * SLF4Jæ—¥å¿—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CanalClient.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;***.***.***.***&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">port</span> <span class="operator">=</span> <span class="string">&quot;11111&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">destination</span> <span class="operator">=</span> <span class="string">&quot;example&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·ä»¤ç‰Œä¸šåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> TokenService tokenService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">TokenServiceIn</span><span class="params">(TokenService tokenService)</span> &#123;</span><br><span class="line">        CanalClient.tokenService = tokenService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * canalå¯åŠ¨æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!AssertUtil.isEmptys(host, port, destination)) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;canalå®¢æˆ·ç«¯è¿æ¥å¤±è´¥ï¼Œå½“å‰æœåŠ¡ç«¯hostï¼š&#123;&#125;ï¼Œportï¼š&#123;&#125;ï¼Œdestinationï¼š&#123;&#125;&quot;</span>, host, port, destination);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">CanalConnector</span> <span class="variable">connector</span> <span class="operator">=</span> CanalConnectors.newSingleConnector(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(host, Integer.valueOf(port)), destination, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å»ºç«‹è¿æ¥</span></span><br><span class="line">            connector.connect();</span><br><span class="line">            <span class="comment">//ç›®æ ‡ä¸ºå…¨éƒ¨è¡¨</span></span><br><span class="line">            connector.subscribe(<span class="string">&quot;.*\\..*&quot;</span>);</span><br><span class="line">            connector.rollback();</span><br><span class="line">            logger.info(<span class="string">&quot;canalå®¢æˆ·ç«¯è¿æ¥å®Œæˆï¼Œå½“å‰æœåŠ¡ç«¯hostï¼š&#123;&#125;ï¼Œportï¼š&#123;&#125;ï¼Œdestinationï¼š&#123;&#125;&quot;</span>, host, port, destination);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                    <span class="comment">//å°è¯•ä»masteré‚£è¾¹æ‹‰å»æ•°æ®batchSizeæ¡è®°å½•ï¼Œæœ‰å¤šå°‘å–å¤šå°‘</span></span><br><span class="line">                    <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> connector.getWithoutAck(batchSize);</span><br><span class="line">                    <span class="type">long</span> <span class="variable">batchId</span> <span class="operator">=</span> message.getId();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> message.getEntries().size();</span><br><span class="line">                    <span class="keyword">if</span> (batchId == -<span class="number">1</span> || size == <span class="number">0</span>) &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        logger.info(<span class="string">&quot;åŒæ­¥ä»»åŠ¡è¿›è¡Œä¸­ï¼Œæ£€æµ‹åˆ°ä¿®æ”¹æ•°æ®ï¼Œæ‰§è¡ŒåŒæ­¥Redis&quot;</span>);</span><br><span class="line">                        dataHandle(message.getEntries());</span><br><span class="line">                    &#125;</span><br><span class="line">                    connector.ack(batchId);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            connector.disconnect();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ•°æ®å¤„ç†</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> entrys</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dataHandle</span><span class="params">(List&lt;Entry&gt; entrys)</span> <span class="keyword">throws</span> InvalidProtocolBufferException &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">beforeData</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">afterData</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Entry entry : entrys) &#123;</span><br><span class="line">            <span class="keyword">if</span> (EntryType.ROWDATA.equals(entry.getEntryType())) &#123;</span><br><span class="line">                <span class="comment">//ååºåˆ—åŒ–rowdata</span></span><br><span class="line">                <span class="type">RowChange</span> <span class="variable">rowChange</span> <span class="operator">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class="line">                <span class="comment">//è·å–æ•°æ®é›†</span></span><br><span class="line">                List&lt;RowData&gt; rowDataList = rowChange.getRowDatasList();</span><br><span class="line">                <span class="comment">//è·å–æ•°æ®éå†</span></span><br><span class="line">                <span class="keyword">for</span> (RowData rowData : rowDataList) &#123;</span><br><span class="line">                    afterData = <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">                    List&lt;Column&gt; afterColumnsList = rowData.getAfterColumnsList();</span><br><span class="line">                    <span class="keyword">for</span> (Column column : afterColumnsList) &#123;</span><br><span class="line">                        afterData.put(column.getName(), column.getValue());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//å› ä¸ºä½œè€…è¿™é‡ŒåªåšåŒæ­¥Redisï¼Œä¸è€ƒè™‘åˆ°æ“ä½œç±»å‹ï¼Œåªéœ€è¦è¦†ç›–ç›¸åŒé”®å€¼æ•°æ®</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//å†™å…¥Redis</span></span><br><span class="line">                executeRedisWarehousing(afterData);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡ŒRedisç”¨æˆ·æ•°æ®å…¥åº“</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> afterData</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">executeRedisWarehousing</span><span class="params">(JSONObject afterData)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å¼€å§‹æ‰§è¡ŒRedisçƒ­æ›´æ–°å…¥åº“åŒæ­¥Mysql -- &quot;</span>);</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">do</span>...</span><br><span class="line">        </span><br><span class="line">        logger.info(<span class="string">&quot;å…¥åº“å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨ç±»ä½¿ç”¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨ç±»ä½¿ç”¨">#</a> å¯åŠ¨ç±»ä½¿ç”¨ï¼š</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(InterviewUserServiceApplication.class, args);</span><br><span class="line">        <span class="comment">//é¡¹ç›®å¯åŠ¨ï¼Œæ‰§è¡Œcanalå®¢æˆ·ç«¯ç›‘å¬</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">CanalClient</span>().run();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            log.error(<span class="string">&quot; canalå®¢æˆ·ç«¯ç›‘å¬ å¯åŠ¨å¤±è´¥ï¼ŒåŸå› å¯èƒ½æ˜¯ï¼š&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥å¯åŠ¨é¡¹ç›®è¿è¡Œï¼ŒæˆåŠŸè¿æ¥ canal åæˆ‘ä»¬å°è¯•ä¿®æ”¹ä¸€ä¸ª mysql çš„æ•°æ®ï¼Œå‘ç°åœ¨å®¢æˆ·ç«¯æˆåŠŸå®Œæˆäº†ä¸ Redis çš„åŒæ­¥æ“ä½œ</p>
<p><img src="https://brath.cloud/blogImg/image-20220629154454409.png" alt="image-20220629154454409"></p>
<h3 id="ç›¸å…³å¼‚å¸¸"><a class="markdownIt-Anchor" href="#ç›¸å…³å¼‚å¸¸">#</a> ç›¸å…³å¼‚å¸¸ï¼š</h3>
<p>Canal å¼‚å¸¸ï¼š</p>
<p>dump address /124.222.106.122:3306 has an error, retrying. caused by <a target="_blank" rel="noopener" href="http://java.la">java.la</a></p>
<p>è§£å†³åŠæ³•ï¼šé‡å¯ Mysqlï¼Œåˆ é™¤ example ä¸‹çš„ dat åç¼€æ–‡ä»¶åé‡å¯ canal</p>
<p>å…¶ä»–ï¼š</p>
<p>â€‹	æ˜¯å¦å¼€æ”¾ç«¯å£ 11111</p>
<p>â€‹	mysql æ˜¯å¦è¿æ¥æˆåŠŸï¼ŒæŸ¥çœ‹ logs/example/example.log</p>
<p>â€‹	æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æ˜¯å¦è¿æ¥æˆåŠŸï¼ŒæŸ¥çœ‹å½“å‰é¡¹ç›®æ—¥å¿—å³å¯</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-04-01T18:28:37.000Z" title="2021-4-2 2:28:37">2021-04-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2020-07-03T23:40:08.000Z" title="2020-7-4 7:40:08">2020-07-04</time>æ›´æ–°</span><span class="level-item">9 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1332ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/04/02/%E3%80%90ELK%E3%80%91%E4%BD%BF%E7%94%A8Docker%E6%90%AD%E5%BB%BAELK/">ã€ELKã€‘ä½¿ç”¨Dockeræ­å»ºELK</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="æ–‡ç« ç›®å½•"><a class="markdownIt-Anchor" href="#æ–‡ç« ç›®å½•">#</a> æ–‡ç« ç›®å½•</h3>
<ul>
<li>
<ul>
<li><a href="#_1">æ¦‚å¿µï¼š</a></li>
<li><a href="#elkdocker_7">å®‰è£… elk (è¿™é‡Œé€šè¿‡ docker è¿›è¡Œå®‰è£…)</a></li>
<li>
<ul>
<li>
<ul>
<li><a href="#es_8">å®‰è£… es</a></li>
<li><a href="#kikana_35">å®‰è£… kikana</a></li>
<li><a href="#logstash_59">å®‰è£… logstash</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#æ¦‚å¿µ">#</a> æ¦‚å¿µï¼š</h2>
<blockquote>
<p>é‚£ä¹ˆï¼Œ<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ELK&amp;spm=1001.2101.3001.7020">ELK</a> åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ â€œELKâ€ æ˜¯ä¸‰ä¸ªå¼€æºé¡¹ç›®çš„é¦–å­—æ¯ç¼©å†™ï¼Œè¿™ä¸‰ä¸ªé¡¹ç›®åˆ†åˆ«æ˜¯ï¼šElasticsearchã€Logstash å’Œ Kibanaã€‚Elasticsearch æ˜¯ä¸€ä¸ªæœç´¢å’Œåˆ†æå¼•æ“ã€‚Logstash æ˜¯æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤ŸåŒæ—¶ä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°è¯¸å¦‚ Elasticsearch ç­‰ â€œå­˜å‚¨åº“â€ ä¸­ã€‚Kibana åˆ™å¯ä»¥è®©ç”¨æˆ·åœ¨ Elasticsearch ä¸­ä½¿ç”¨å›¾å½¢å’Œå›¾è¡¨å¯¹æ•°æ®è¿›è¡Œå¯è§†åŒ–</p>
</blockquote>
<ul>
<li>å·¥ä½œæµç¨‹<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/18dbff4e772c4bff918a06fc22562782.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>åœ¨åç»­ elk å¼•å…¥äº† beats (æ•°æ®é‡‡é›†å™¨) åè¢«ç§°ä¸º Elastic Stack æˆ–è€… ELK</li>
</ul>
<h2 id="å®‰è£…elkè¿™é‡Œé€šè¿‡dockerè¿›è¡Œå®‰è£…"><a class="markdownIt-Anchor" href="#å®‰è£…elkè¿™é‡Œé€šè¿‡dockerè¿›è¡Œå®‰è£…">#</a> å®‰è£… elk (è¿™é‡Œé€šè¿‡ docker è¿›è¡Œå®‰è£…)</h2>
<h4 id="å®‰è£…es"><a class="markdownIt-Anchor" href="#å®‰è£…es">#</a> å®‰è£… es</h4>
<ul>
<li>åœ¨ dockerhub ä¸Šæœç´¢ es<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/6f76e4d9d5504501902ef113cc4bbc69.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æ‰¾åˆ°éœ€è¦çš„ es ç‰ˆæœ¬<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/6d5331d1e29649c8b784fd82a01a078c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æ‹‰å– es é•œåƒ <code>docker pull elasticsearch:tag</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/da59ef5b031243f094ef24340170bb99.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/44544fc5864a4db7a11b4864768446f4.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>åœ¨ dockerhub å®˜ç½‘ä¸Šå¯ä»¥çœ‹åˆ° es çš„å¯åŠ¨å‘½ä»¤<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d0a24c581d37472b9f6b51e2946902c3.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å…ˆåˆ›å»ºè‡ªå®šä¹‰ docker ç½‘ç»œ <code>docker network create elastic</code> ï¼Œé»˜è®¤æ˜¯æ¡¥æ¥æ¨¡å¼<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2e96d2e71e594a28bfbf5c14a7e50bbc.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æŸ¥çœ‹åˆ›å»ºçš„ç½‘ç»œ<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1335acab2ae14d908a9c70249c11d1a8.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å¯åŠ¨ es é•œåƒï¼Œè¿™é‡Œæˆ‘ä»¥å•æœºçš„å½¢å¼å¯åŠ¨ <code>docker run -d --name elasticsearch --net elastic -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:tag</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/cab7b5b16f7444f98587b73977f5784f.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å¯åŠ¨ä¹‹åè®¿é—® <code>localhost:9200</code> ï¼Œæœ‰æ•°æ®è¿”å›è¯´æ˜å¯åŠ¨æˆåŠŸï¼Œå¦‚ä¸‹å›¾<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b007a9897a384d45b4f99719a8e80d2b.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>ä¿®æ”¹ es é…ç½®ï¼Œè¿›å…¥å®¹å™¨ <code>docker exec -it a804 /bin/sh</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f3b2629fdf69469eb752ce1b23d60ab5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>åœ¨ <code>config</code>  ç›®å½•ä¸‹çš„ <code>elasticsearch.yml</code>  æ–‡ä»¶æ·»åŠ </li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ä¿®æ”¹å®Œé…ç½®ä¹‹åï¼Œé€€å‡ºå®¹å™¨å¹¶é‡å¯<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/18e0f04b59144d16bf0c19f730cbfe72.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<h4 id="å®‰è£…kikana"><a class="markdownIt-Anchor" href="#å®‰è£…kikana">#</a> å®‰è£… kikana</h4>
<ul>
<li>ä» dockerhub æ‹‰å–ä¸ es å¯¹åº”ç‰ˆæœ¬çš„ kibana  <code>docker pull kibana:tag</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/786540852f3848ef91b6dc9172c62e06.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å¯åŠ¨ kibana  <code>docker run --name kib-7.6 --net elastic -d -p 5601:5601 kibana:tag</code></li>
<li>å¯åŠ¨ä¹‹åè®¿é—®<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/aed86ba45de34bbdb960c67a10eba2e1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>å‡ºç°ä¸Šå›¾æ˜¯ç”±äº kibanakibana.ymlï¼Œé»˜è®¤çš„åœ°å€æ˜¯ http://elasticsearch:9200, éœ€è¦ä¿®æ”¹ä¸º es æœåŠ¡ ip</li>
<li>è¿›å…¥åˆ° es å®¹å™¨é‡Œé¢ <code>docker -it å®¹å™¨ç¼–å· /bin/sh</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/30cda118f3b344b6ac611f143d8cb941.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>æŸ¥çœ‹ es çš„å®¹å™¨è¯¦æƒ… <code>docker inspect a80402dbe9f5</code></li>
<li>æ‰¾åˆ°ç½‘ç»œè¯¦æƒ…ï¼Œæ‰¾åˆ° es æœåŠ¡çš„ ip åœ°å€<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/810fc12347fd4c4fbb02cb2ca219e4d6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡ <code>docker inspect -f '&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;' a804</code>  è·å– ip<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/61ff14db933c4b4889fa6d6eb5d6d17d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>è¿›å…¥åˆ° kibana å®¹å™¨ï¼Œåˆ‡æ¢åˆ° <code>/usr/share/kibana/config</code>  ç›®å½•<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/41867b50de204c558b90c08d0fdd8e88.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>ä¿®æ”¹ kibana.yml æ–‡ä»¶<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0941ebe9bb9445aa9e715440a490e0a2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3f1b21a66c2b48a8bc46e391f39a1fa6.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>ä¿®æ”¹å®Œ kibana.yml ä¹‹åé‡å¯ kibana å®¹å™¨</li>
<li>è®¿é—® kibana <code>localhost:5601</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b179a708ace346fca404be4c1ada73ef.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d0756690b86f4f57be7919f08210b388.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>åˆ°è¿™é‡Œ kibana å°±å®‰è£…æˆåŠŸäº†</li>
</ul>
<h4 id="å®‰è£…logstash"><a class="markdownIt-Anchor" href="#å®‰è£…logstash">#</a> å®‰è£…<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=logstash&amp;spm=1001.2101.3001.7020"> logstash</a></h4>
<ul>
<li>ä» dockerhub æ‹‰å– logstash <code>docker pull logstash:7.6.2</code> <br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b1ec7cb4c13b48a188e45bcd0d125d58.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-02-14T10:13:04.000Z" title="2021-2-14 18:13:04">2021-02-14</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-12-10T11:23:28.000Z" title="2021-12-10 19:23:28">2021-12-10</time>æ›´æ–°</span><span class="level-item">23 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦3434ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/02/14/%E3%80%90Redis%E3%80%91SpringBoot+Redis%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E5%BC%BA%E6%94%AF%E6%8C%81%E7%9A%84%E7%82%B9%E8%B5%9E-%E6%9F%A5%E7%9C%8B%E6%94%B6%E8%97%8F%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1/">SpringBoot+Rediså®ç°é«˜æ€§èƒ½ï¼Œå¼ºæ”¯æŒçš„ç‚¹èµ-æŸ¥çœ‹æ”¶è—æµç¨‹è®¾è®¡</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="springbootrediså®ç°é«˜æ€§èƒ½å¼ºæ”¯æŒçš„ç‚¹èµæµç¨‹è®¾è®¡"><a class="markdownIt-Anchor" href="#springbootrediså®ç°é«˜æ€§èƒ½å¼ºæ”¯æŒçš„ç‚¹èµæµç¨‹è®¾è®¡">#</a> SpringBoot+Redis å®ç°é«˜æ€§èƒ½ï¼Œå¼ºæ”¯æŒçš„ç‚¹èµæµç¨‹è®¾è®¡</h1>
<h2 id="å‰è¨€"><a class="markdownIt-Anchor" href="#å‰è¨€">#</a> å‰è¨€</h2>
<p>æœ¬æ–‡åŸºäº SpringCloudAlibaba, ç”¨æˆ·å‘èµ·ç‚¹èµã€å–æ¶ˆç‚¹èµï¼Œåå…ˆå­˜å…¥ Redis ä¸­ï¼Œå†æ¯éš”ä¸¤å°æ—¶ä» Redis è¯»å–ç‚¹èµæ•°æ®å†™å…¥æ•°æ®åº“ä¸­åšæŒä¹…åŒ–å­˜å‚¨ã€‚</p>
<p>ç‚¹èµåŠŸèƒ½åœ¨å¾ˆå¤šç³»ç»Ÿä¸­éƒ½æœ‰ï¼Œä½†åˆ«çœ‹åŠŸèƒ½å°ï¼Œæƒ³è¦åšå¥½éœ€è¦è€ƒè™‘çš„ä¸œè¥¿è¿˜æŒºå¤šçš„ã€‚</p>
<p>ç‚¹èµã€å–æ¶ˆç‚¹èµæ˜¯é«˜é¢‘æ¬¡çš„æ“ä½œï¼Œè‹¥æ¯æ¬¡éƒ½è¯»å†™æ•°æ®åº“ï¼Œå¤§é‡çš„æ“ä½œä¼šå½±å“æ•°æ®åº“æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦åšç¼“å­˜ã€‚</p>
<p>è‡³äºå¤šä¹…ä» Redis å–ä¸€æ¬¡æ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µå®šå§ï¼Œæˆ‘æ˜¯æš‚æ—¶è®¾äº†ä¸¤ä¸ªå°æ—¶ã€‚</p>
<p>é¡¹ç›®éœ€æ±‚éœ€è¦æŸ¥çœ‹éƒ½è°ç‚¹èµäº†ï¼Œæ‰€ä»¥è¦å­˜å‚¨æ¯ä¸ªç‚¹èµçš„ç‚¹èµäººã€è¢«ç‚¹èµäººï¼Œä¸èƒ½ç®€å•çš„åšè®¡æ•°ã€‚</p>
<h3 id="æ–‡ç« åˆ†å››éƒ¨åˆ†ä»‹ç»"><a class="markdownIt-Anchor" href="#æ–‡ç« åˆ†å››éƒ¨åˆ†ä»‹ç»">#</a> æ–‡ç« åˆ†å››éƒ¨åˆ†ä»‹ç»ï¼š</h3>
<ul>
<li>
<p>Redis ç¼“å­˜è®¾è®¡åŠå®ç°</p>
</li>
<li>
<p>æ•°æ®åº“è®¾è®¡</p>
</li>
<li>
<p>æ•°æ®åº“æ“ä½œ</p>
</li>
<li>
<p>å¼€å¯å®šæ—¶ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“</p>
</li>
</ul>
<h2 id="ä¸€-redis-ç¼“å­˜è®¾è®¡åŠå®ç°"><a class="markdownIt-Anchor" href="#ä¸€-redis-ç¼“å­˜è®¾è®¡åŠå®ç°">#</a> ä¸€ã€Redis ç¼“å­˜è®¾è®¡åŠå®ç°</h2>
<h3 id="11-redis-å®‰è£…åŠè¿è¡Œ"><a class="markdownIt-Anchor" href="#11-redis-å®‰è£…åŠè¿è¡Œ">#</a> 1.1 Redis å®‰è£…åŠè¿è¡Œ</h3>
<p>Redis å®‰è£…è¯·è‡ªè¡ŒæŸ¥é˜…ç›¸å…³æ•™ç¨‹ã€‚</p>
<p>è¯´ä¸‹ Docker å®‰è£…è¿è¡Œ Redis</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">6379</span>:<span class="number">6379</span> redis:<span class="number">4.0</span><span class="number">.8</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœå·²ç»å®‰è£…äº† Redisï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥å¯åŠ¨ Redis çš„å‘½ä»¤</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="built_in">server</span></span><br></pre></td></tr></table></figure>
<h3 id="12-redis-ä¸-springboot-é¡¹ç›®çš„æ•´åˆ"><a class="markdownIt-Anchor" href="#12-redis-ä¸-springboot-é¡¹ç›®çš„æ•´åˆ">#</a> 1.2 Redis ä¸ SpringBoot é¡¹ç›®çš„æ•´åˆ</h3>
<ol>
<li>åœ¨  <code>pom.xml</code>  ä¸­å¼•å…¥ä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨é‡Š  <code>@EnableCaching</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;com.solo.coderiver.project.client&quot;)</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ç¼–å†™ Redis é…ç½®ç±»  <code>RedisConfig</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(</span></span><br><span class="line"><span class="params">            RedisConnectionFactory redisConnectionFactory)</span></span><br><span class="line">            <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line"></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;Object&gt;(Object.class);</span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        template.setKeySerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.setHashKeySerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(StringRedisTemplate.class)</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(</span></span><br><span class="line"><span class="params">            RedisConnectionFactory redisConnectionFactory)</span></span><br><span class="line">            <span class="keyword">throws</span> UnknownHostException &#123;</span><br><span class="line">        <span class="type">StringRedisTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ Redis åœ¨ SpringBoot é¡¹ç›®ä¸­çš„é…ç½®å·²ç»å®Œæˆï¼Œå¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†ã€‚</p>
<h3 id="13-redis-çš„æ•°æ®ç»“æ„ç±»å‹"><a class="markdownIt-Anchor" href="#13-redis-çš„æ•°æ®ç»“æ„ç±»å‹">#</a> 1.3 Redis çš„æ•°æ®ç»“æ„ç±»å‹</h3>
<p>Redis å¯ä»¥å­˜å‚¨é”®ä¸ 5 ç§ä¸åŒæ•°æ®ç»“æ„ç±»å‹ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™ 5 ç§æ•°æ®ç»“æ„ç±»å‹åˆ†åˆ«ä¸º Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚</p>
<p>ä¸‹é¢æ¥å¯¹è¿™ 5 ç§æ•°æ®ç»“æ„ç±»å‹ä½œç®€å•çš„ä»‹ç»ï¼š</p>
<table>
<thead>
<tr>
<th>ç»“æ„ç±»å‹</th>
<th>ç»“æ„å­˜å‚¨çš„å€¼</th>
<th>ç»“æ„çš„è¯»å†™èƒ½åŠ›</th>
</tr>
</thead>
<tbody>
<tr>
<td>String</td>
<td>å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°</td>
<td>å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹è±¡å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢ (increment) æˆ–è€…è‡ªå‡ (decrement)</td>
</tr>
<tr>
<td>List</td>
<td>ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸²</td>
<td>ä»é“¾è¡¨çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œä¿®å‰ª (trim)ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æ¥æŸ¥æ‰¾æˆ–è€…ç§»é™¤å…ƒç´ </td>
</tr>
<tr>
<td>Set</td>
<td>åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨ (unorderedcollection)ï¼Œå¹¶ä¸”è¢«åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€å„ä¸ç›¸åŒ</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œå–å¼„éšæœºè·å–å…ƒç´ </td>
</tr>
<tr>
<td>Hash</td>
<td>åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td>
<td>æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹</td>
</tr>
<tr>
<td>Zset</td>
<td>å­—ç¬¦ä¸²æˆå‘˜ (member) ä¸æµ®ç‚¹æ•°åˆ†å€¼ (score) ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†å€¼çš„å¤§å°å†³å®š</td>
<td>æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´ (range) æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´ </td>
</tr>
</tbody>
</table>
<h3 id="14-ç‚¹èµæ•°æ®åœ¨-redis-ä¸­çš„å­˜å‚¨æ ¼å¼"><a class="markdownIt-Anchor" href="#14-ç‚¹èµæ•°æ®åœ¨-redis-ä¸­çš„å­˜å‚¨æ ¼å¼">#</a> 1.4 ç‚¹èµæ•°æ®åœ¨ Redis ä¸­çš„å­˜å‚¨æ ¼å¼</h3>
<p>ç”¨ Redis å­˜å‚¨ä¸¤ç§æ•°æ®ï¼Œä¸€ç§æ˜¯è®°å½•ç‚¹èµäººã€è¢«ç‚¹èµäººã€ç‚¹èµçŠ¶æ€çš„æ•°æ®ï¼Œå¦ä¸€ç§æ˜¯æ¯ä¸ªç”¨æˆ·è¢«ç‚¹èµäº†å¤šå°‘æ¬¡ï¼Œåšä¸ªç®€å•çš„è®¡æ•°ã€‚</p>
<p>ç”±äºéœ€è¦è®°å½•ç‚¹èµäººå’Œè¢«ç‚¹èµäººï¼Œè¿˜æœ‰ç‚¹èµçŠ¶æ€ï¼ˆç‚¹èµã€å–æ¶ˆç‚¹èµï¼‰ï¼Œè¿˜è¦å›ºå®šæ—¶é—´é—´éš”å–å‡º Redis ä¸­æ‰€æœ‰ç‚¹èµæ•°æ®ï¼Œåˆ†æäº†ä¸‹ Redis æ•°æ®æ ¼å¼ä¸­  <code>Hash</code>  æœ€åˆé€‚ã€‚</p>
<p>å› ä¸º  <code>Hash</code>  é‡Œçš„æ•°æ®éƒ½æ˜¯å­˜åœ¨ä¸€ä¸ªé”®é‡Œï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªé”®å¾ˆæ–¹ä¾¿çš„æŠŠæ‰€æœ‰çš„ç‚¹èµæ•°æ®éƒ½å–å‡ºã€‚è¿™ä¸ªé”®é‡Œé¢çš„æ•°æ®è¿˜å¯ä»¥å­˜æˆé”®å€¼å¯¹çš„å½¢å¼ï¼Œæ–¹ä¾¿å­˜å…¥ç‚¹èµäººã€è¢«ç‚¹èµäººå’Œç‚¹èµçŠ¶æ€ã€‚</p>
<p>è®¾ç‚¹èµäººçš„ id ä¸º  <code>likedPostId</code> ï¼Œè¢«ç‚¹èµäººçš„ id ä¸º  <code>likedUserId</code>  ï¼Œç‚¹èµæ—¶çŠ¶æ€ä¸º 1ï¼Œå–æ¶ˆç‚¹èµçŠ¶æ€ä¸º 0ã€‚å°†ç‚¹èµäºº id å’Œè¢«ç‚¹èµäºº id ä½œä¸ºé”®ï¼Œä¸¤ä¸ª id ä¸­é—´ç”¨  <code>::</code>   éš”å¼€ï¼Œç‚¹èµçŠ¶æ€ä½œä¸ºå€¼ã€‚</p>
<p>æ‰€ä»¥å¦‚æœç”¨æˆ·ç‚¹èµï¼Œå­˜å‚¨çš„é”®ä¸ºï¼š <code>likedUserId::likedPostId</code> ï¼Œå¯¹åº”çš„å€¼ä¸º 1 ã€‚</p>
<p>å–æ¶ˆç‚¹èµï¼Œå­˜å‚¨çš„é”®ä¸ºï¼š <code>likedUserId::likedPostId</code> ï¼Œå¯¹åº”çš„å€¼ä¸º 0 ã€‚</p>
<p>å–æ•°æ®æ—¶æŠŠé”®ç”¨  <code>::</code>  åˆ‡å¼€å°±å¾—åˆ°äº†ä¸¤ä¸ª idï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ã€‚</p>
<h3 id="15-æ“ä½œ-redis"><a class="markdownIt-Anchor" href="#15-æ“ä½œ-redis">#</a> 1.5 æ“ä½œ Redis</h3>
<p>Redis å„ç§æ•°æ®æ ¼å¼çš„æ“ä½œæ–¹æ³•å¯ä»¥çœ‹çœ‹ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2F7bf5dc61ca06%2F">è¿™ç¯‡æ–‡ç« </a> ï¼Œå†™çš„éå¸¸å¥½ã€‚</p>
<p>å°†å…·ä½“æ“ä½œæ–¹æ³•å°è£…åˆ°äº†  <code>RedisService</code>  æ¥å£é‡Œ</p>
<blockquote>
<p>RedisService.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.dto.LikedCountDTO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RedisService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç‚¹èµã€‚çŠ¶æ€ä¸º1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveLiked2Redis</span><span class="params">(String likedUserId, String likedPostId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆç‚¹èµã€‚å°†çŠ¶æ€æ”¹å˜ä¸º0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlikeFromRedis</span><span class="params">(String likedUserId, String likedPostId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»Redisä¸­åˆ é™¤ä¸€æ¡ç‚¹èµæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteLikedFromRedis</span><span class="params">(String likedUserId, String likedPostId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯¥ç”¨æˆ·çš„ç‚¹èµæ•°åŠ 1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">incrementLikedCount</span><span class="params">(String likedUserId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¯¥ç”¨æˆ·çš„ç‚¹èµæ•°å‡1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrementLikedCount</span><span class="params">(String likedUserId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–Redisä¸­å­˜å‚¨çš„æ‰€æœ‰ç‚¹èµæ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UserLike&gt; <span class="title function_">getLikedDataFromRedis</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–Redisä¸­å­˜å‚¨çš„æ‰€æœ‰ç‚¹èµæ•°é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;LikedCountDTO&gt; <span class="title function_">getLikedCountFromRedis</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å®ç°ç±» RedisServiceImpl.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.dto.LikedCountDTO;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.enums.LikedStatusEnum;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.service.LikedService;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.service.RedisService;</span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.utils.RedisKeyUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.Cursor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ScanOptions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">RedisService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LikedService likedService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveLiked2Redis</span><span class="params">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class="line">        redisTemplate.opsForHash().put(RedisKeyUtils.MAP_KEY_USER_LIKED, key, LikedStatusEnum.LIKE.getCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlikeFromRedis</span><span class="params">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class="line">        redisTemplate.opsForHash().put(RedisKeyUtils.MAP_KEY_USER_LIKED, key, LikedStatusEnum.UNLIKE.getCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteLikedFromRedis</span><span class="params">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class="line">        redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementLikedCount</span><span class="params">(String likedUserId)</span> &#123;</span><br><span class="line">        redisTemplate.opsForHash().increment(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, likedUserId, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrementLikedCount</span><span class="params">(String likedUserId)</span> &#123;</span><br><span class="line">        redisTemplate.opsForHash().increment(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, likedUserId, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;UserLike&gt; <span class="title function_">getLikedDataFromRedis</span><span class="params">()</span> &#123;</span><br><span class="line">        Cursor&lt;Map.Entry&lt;Object, Object&gt;&gt; cursor = redisTemplate.opsForHash().scan(RedisKeyUtils.MAP_KEY_USER_LIKED, ScanOptions.NONE);</span><br><span class="line">        List&lt;UserLike&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (cursor.hasNext())&#123;</span><br><span class="line">            Map.Entry&lt;Object, Object&gt; entry = cursor.next();</span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String) entry.getKey();</span><br><span class="line">            <span class="comment">//åˆ†ç¦»å‡º likedUserIdï¼ŒlikedPostId</span></span><br><span class="line">            String[] split = key.split(<span class="string">&quot;::&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">likedUserId</span> <span class="operator">=</span> split[<span class="number">0</span>];</span><br><span class="line">            <span class="type">String</span> <span class="variable">likedPostId</span> <span class="operator">=</span> split[<span class="number">1</span>];</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> (Integer) entry.getValue();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ç»„è£…æˆ UserLike å¯¹è±¡</span></span><br><span class="line">            <span class="type">UserLike</span> <span class="variable">userLike</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserLike</span>(likedUserId, likedPostId, value);</span><br><span class="line">            list.add(userLike);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å­˜åˆ° list åä» Redis ä¸­åˆ é™¤</span></span><br><span class="line">            redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED, key);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;LikedCountDTO&gt; <span class="title function_">getLikedCountFromRedis</span><span class="params">()</span> &#123;</span><br><span class="line">        Cursor&lt;Map.Entry&lt;Object, Object&gt;&gt; cursor = redisTemplate.opsForHash().scan(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, ScanOptions.NONE);</span><br><span class="line">        List&lt;LikedCountDTO&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (cursor.hasNext())&#123;</span><br><span class="line">            Map.Entry&lt;Object, Object&gt; map = cursor.next();</span><br><span class="line">            <span class="comment">//å°†ç‚¹èµæ•°é‡å­˜å‚¨åœ¨ LikedCountDT</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> (String)map.getKey();</span><br><span class="line">            <span class="type">LikedCountDTO</span> <span class="variable">dto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LikedCountDTO</span>(key, (Integer) map.getValue());</span><br><span class="line">            list.add(dto);</span><br><span class="line">            <span class="comment">//ä»Redisä¸­åˆ é™¤è¿™æ¡è®°å½•</span></span><br><span class="line">            redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨åˆ°çš„å·¥å…·ç±»å’Œæšä¸¾ç±»</p>
<blockquote>
<p>RedisKeyUtils, ç”¨äºæ ¹æ®ä¸€å®šè§„åˆ™ç”Ÿæˆ key</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisKeyUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿å­˜ç”¨æˆ·ç‚¹èµæ•°æ®çš„key</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">MAP_KEY_USER_LIKED</span> = <span class="string">&quot;MAP_USER_LIKED&quot;</span>;</span><br><span class="line">    <span class="comment">//ä¿å­˜ç”¨æˆ·è¢«ç‚¹èµæ•°é‡çš„key</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="title class_">String</span> <span class="variable constant_">MAP_KEY_USER_LIKED_COUNT</span> = <span class="string">&quot;MAP_USER_LIKED_COUNT&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‹¼æ¥è¢«ç‚¹èµçš„ç”¨æˆ·idå’Œç‚¹èµçš„äººçš„idä½œä¸ºkeyã€‚æ ¼å¼ 222222::333333</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId è¢«ç‚¹èµçš„äººid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId ç‚¹èµçš„äººçš„id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="title class_">String</span> <span class="title function_">getLikedKey</span>(<span class="params"><span class="built_in">String</span> likedUserId, <span class="built_in">String</span> likedPostId</span>)&#123;</span><br><span class="line">        <span class="title class_">StringBuilder</span> builder = <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        builder.<span class="title function_">append</span>(likedUserId);</span><br><span class="line">        builder.<span class="title function_">append</span>(<span class="string">&quot;::&quot;</span>);</span><br><span class="line">        builder.<span class="title function_">append</span>(likedPostId);</span><br><span class="line">        <span class="keyword">return</span> builder.<span class="title function_">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>LikedStatusEnum ç”¨æˆ·ç‚¹èµçŠ¶æ€çš„æšä¸¾ç±»</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solo.coderiver.user.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ç‚¹èµçš„çŠ¶æ€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> LikedStatusEnum &#123;</span><br><span class="line">    LIKE(<span class="number">1</span>, <span class="string">&quot;ç‚¹èµ&quot;</span>),</span><br><span class="line">    UNLIKE(<span class="number">0</span>, <span class="string">&quot;å–æ¶ˆç‚¹èµ/æœªç‚¹èµ&quot;</span>),</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    LikedStatusEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="äºŒ-æ•°æ®åº“è®¾è®¡"><a class="markdownIt-Anchor" href="#äºŒ-æ•°æ®åº“è®¾è®¡">#</a> äºŒã€æ•°æ®åº“è®¾è®¡</h2>
<p>æ•°æ®åº“è¡¨ä¸­è‡³å°‘è¦åŒ…å«ä¸‰ä¸ªå­—æ®µï¼šè¢«ç‚¹èµç”¨æˆ· idï¼Œç‚¹èµç”¨æˆ· idï¼Œç‚¹èµçŠ¶æ€ã€‚å†åŠ ä¸Šä¸»é”® idï¼Œåˆ›å»ºæ—¶é—´ï¼Œä¿®æ”¹æ—¶é—´å°±è¡Œäº†ã€‚</p>
<p>å»ºè¡¨è¯­å¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table <span class="string">`user_like`</span>(</span><br><span class="line">	<span class="string">`id`</span> int not <span class="literal">null</span> auto_increment,</span><br><span class="line">	<span class="string">`liked_user_id`</span> <span class="title function_">varchar</span>(<span class="number">32</span>) not <span class="literal">null</span> comment <span class="string">&#x27;è¢«ç‚¹èµçš„ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">	<span class="string">`liked_post_id`</span> <span class="title function_">varchar</span>(<span class="number">32</span>) not <span class="literal">null</span> comment <span class="string">&#x27;ç‚¹èµçš„ç”¨æˆ·id&#x27;</span>,</span><br><span class="line">	<span class="string">`status`</span> <span class="title function_">tinyint</span>(<span class="number">1</span>) <span class="keyword">default</span> <span class="string">&#x27;1&#x27;</span> comment <span class="string">&#x27;ç‚¹èµçŠ¶æ€ï¼Œ0å–æ¶ˆï¼Œ1ç‚¹èµ&#x27;</span>,</span><br><span class="line">	<span class="string">`create_time`</span> timestamp not <span class="literal">null</span> <span class="keyword">default</span> current_timestamp comment <span class="string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,</span><br><span class="line">  <span class="string">`update_time`</span> timestamp not <span class="literal">null</span> <span class="keyword">default</span> current_timestamp on update current_timestamp comment <span class="string">&#x27;ä¿®æ”¹æ—¶é—´&#x27;</span>,</span><br><span class="line">	primary <span class="title function_">key</span>(<span class="string">`id`</span>),</span><br><span class="line">	<span class="variable constant_">INDEX</span> <span class="string">`liked_user_id`</span>(<span class="string">`liked_user_id`</span>),</span><br><span class="line">	<span class="variable constant_">INDEX</span> <span class="string">`liked_post_id`</span>(<span class="string">`liked_post_id`</span>)</span><br><span class="line">) comment <span class="string">&#x27;ç”¨æˆ·ç‚¹èµè¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„å¯¹è±¡  <code>UserLike</code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.enums.LikedStatusEnum;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ç‚¹èµè¡¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLike</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¢«ç‚¹èµçš„ç”¨æˆ·çš„id</span></span><br><span class="line">    <span class="keyword">private</span> String likedUserId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç‚¹èµçš„ç”¨æˆ·çš„id</span></span><br><span class="line">    <span class="keyword">private</span> String likedPostId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç‚¹èµçš„çŠ¶æ€.é»˜è®¤æœªç‚¹èµ</span></span><br><span class="line">    <span class="keyword">private</span> Integer status = LikedStatusEnum.UNLIKE.getCode();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserLike() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> UserLike(String likedUserId, String likedPostId, Integer status) &#123;</span><br><span class="line">        <span class="keyword">this</span>.likedUserId = likedUserId;</span><br><span class="line">        <span class="keyword">this</span>.likedPostId = likedPostId;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‰-æ•°æ®åº“æ“ä½œ"><a class="markdownIt-Anchor" href="#ä¸‰-æ•°æ®åº“æ“ä½œ">#</a> ä¸‰ã€æ•°æ®åº“æ“ä½œ</h2>
<p>æ“ä½œæ•°æ®åº“åŒæ ·å°è£…åœ¨æ¥å£ä¸­</p>
<blockquote>
<p>LikedService</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Page;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.domain.Pageable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LikedService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¿å­˜ç‚¹èµè®°å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userLike</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserLike <span class="title function_">save</span><span class="params">(UserLike userLike)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰¹é‡ä¿å­˜æˆ–ä¿®æ”¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;UserLike&gt; <span class="title function_">saveAll</span><span class="params">(List&lt;UserLike&gt; list)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®è¢«ç‚¹èµäººçš„idæŸ¥è¯¢ç‚¹èµåˆ—è¡¨ï¼ˆå³æŸ¥è¯¢éƒ½è°ç»™è¿™ä¸ªäººç‚¹èµè¿‡ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId è¢«ç‚¹èµäººçš„id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;UserLike&gt; <span class="title function_">getLikedListByLikedUserId</span><span class="params">(String likedUserId, Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç‚¹èµäººçš„idæŸ¥è¯¢ç‚¹èµåˆ—è¡¨ï¼ˆå³æŸ¥è¯¢è¿™ä¸ªäººéƒ½ç»™è°ç‚¹èµè¿‡ï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageable</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Page&lt;UserLike&gt; <span class="title function_">getLikedListByLikedPostId</span><span class="params">(String likedPostId, Pageable pageable)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡è¢«ç‚¹èµäººå’Œç‚¹èµäººidæŸ¥è¯¢æ˜¯å¦å­˜åœ¨ç‚¹èµè®°å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedUserId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> likedPostId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    UserLike <span class="title function_">getByLikedUserIdAndLikedPostId</span><span class="params">(String likedUserId, String likedPostId)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†Redisé‡Œçš„ç‚¹èµæ•°æ®å­˜å…¥æ•°æ®åº“ä¸­</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transLikedFromRedis2DB</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†Redisä¸­çš„ç‚¹èµæ•°é‡æ•°æ®å­˜å…¥æ•°æ®åº“</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transLikedCountFromRedis2DB</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>LikedServiceImpl å®ç°ç±»</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">dataobject</span>.<span class="property">UserInfo</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">dataobject</span>.<span class="property">UserLike</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">dto</span>.<span class="property">LikedCountDTO</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">enums</span>.<span class="property">LikedStatusEnum</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">repository</span>.<span class="property">UserLikeRepository</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">service</span>.<span class="property">LikedService</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">service</span>.<span class="property">RedisService</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">solo</span>.<span class="property">coderiver</span>.<span class="property">user</span>.<span class="property">service</span>.<span class="property">UserService</span>;</span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">extern</span>.<span class="property">slf4j</span>.<span class="property">Slf4j</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">data</span>.<span class="property">domain</span>.<span class="property">Page</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">data</span>.<span class="property">domain</span>.<span class="property">Pageable</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Service</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">transaction</span>.<span class="property">annotation</span>.<span class="property">Transactional</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">List</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LikedServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LikedService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="title class_">UserLikeRepository</span> likeRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="title class_">RedisService</span> redisService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="title class_">UserService</span> userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">UserLike</span> <span class="title function_">save</span>(<span class="params">UserLike userLike</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> likeRepository.<span class="title function_">save</span>(userLike);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">List</span>&lt;<span class="title class_">UserLike</span>&gt; <span class="title function_">saveAll</span>(<span class="params">List&lt;UserLike&gt; list</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> likeRepository.<span class="title function_">saveAll</span>(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Page</span>&lt;<span class="title class_">UserLike</span>&gt; <span class="title function_">getLikedListByLikedUserId</span>(<span class="params"><span class="built_in">String</span> likedUserId, Pageable pageable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> likeRepository.<span class="title function_">findByLikedUserIdAndStatus</span>(likedUserId, <span class="title class_">LikedStatusEnum</span>.<span class="property">LIKE</span>.<span class="title function_">getCode</span>(), pageable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">Page</span>&lt;<span class="title class_">UserLike</span>&gt; <span class="title function_">getLikedListByLikedPostId</span>(<span class="params"><span class="built_in">String</span> likedPostId, Pageable pageable</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> likeRepository.<span class="title function_">findByLikedPostIdAndStatus</span>(likedPostId, <span class="title class_">LikedStatusEnum</span>.<span class="property">LIKE</span>.<span class="title function_">getCode</span>(), pageable);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">UserLike</span> <span class="title function_">getByLikedUserIdAndLikedPostId</span>(<span class="params"><span class="built_in">String</span> likedUserId, <span class="built_in">String</span> likedPostId</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> likeRepository.<span class="title function_">findByLikedUserIdAndLikedPostId</span>(likedUserId, likedPostId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">transLikedFromRedis2DB</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">UserLike</span>&gt; list = redisService.<span class="title function_">getLikedDataFromRedis</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">UserLike</span> like : list) &#123;</span><br><span class="line">            <span class="title class_">UserLike</span> ul = <span class="title function_">getByLikedUserIdAndLikedPostId</span>(like.<span class="title function_">getLikedUserId</span>(), like.<span class="title function_">getLikedPostId</span>());</span><br><span class="line">            <span class="keyword">if</span> (ul == <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//æ²¡æœ‰è®°å½•ï¼Œç›´æ¥å­˜å…¥</span></span><br><span class="line">                <span class="title function_">save</span>(like);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//æœ‰è®°å½•ï¼Œéœ€è¦æ›´æ–°</span></span><br><span class="line">                ul.<span class="title function_">setStatus</span>(like.<span class="title function_">getStatus</span>());</span><br><span class="line">                <span class="title function_">save</span>(ul);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">transLikedCountFromRedis2DB</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">List</span>&lt;<span class="title class_">LikedCountDTO</span>&gt; list = redisService.<span class="title function_">getLikedCountFromRedis</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="title class_">LikedCountDTO</span> dto : list) &#123;</span><br><span class="line">            <span class="title class_">UserInfo</span> user = userService.<span class="title function_">findById</span>(dto.<span class="title function_">getId</span>());</span><br><span class="line">            <span class="comment">//ç‚¹èµæ•°é‡å±äºæ— å…³ç´§è¦çš„æ“ä½œï¼Œå‡ºé”™æ— éœ€æŠ›å¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (user != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="title class_">Integer</span> likeNum = user.<span class="title function_">getLikeNum</span>() + dto.<span class="title function_">getCount</span>();</span><br><span class="line">                user.<span class="title function_">setLikeNum</span>(likeNum);</span><br><span class="line">                <span class="comment">//æ›´æ–°ç‚¹èµæ•°é‡</span></span><br><span class="line">                userService.<span class="title function_">updateInfo</span>(user);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•°æ®åº“çš„æ“ä½œå°±è¿™äº›ï¼Œä¸»è¦è¿˜æ˜¯å¢åˆ æ”¹æŸ¥ã€‚</p>
<h2 id="å››-å¼€å¯å®šæ—¶ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“"><a class="markdownIt-Anchor" href="#å››-å¼€å¯å®šæ—¶ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“">#</a> å››ã€å¼€å¯å®šæ—¶ä»»åŠ¡æŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“</h2>
<p>å®šæ—¶ä»»åŠ¡  <code>Quartz</code>  å¾ˆå¼ºå¤§ï¼Œå°±ç”¨å®ƒäº†ã€‚</p>
<p><code>Quartz</code>  ä½¿ç”¨æ­¥éª¤ï¼š</p>
<ol>
<li>æ·»åŠ ä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>
<ol>
<li>ç¼–å†™é…ç½®æ–‡ä»¶</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solo.coderiver.user.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.task.LikeTask;</span><br><span class="line"><span class="keyword">import</span> org.quartz.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuartzConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> String LIKE_TASK_IDENTITY = <span class="string">&quot;LikeTaskQuartz&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> JobDetail quartzDetail()&#123;</span><br><span class="line">        <span class="keyword">return</span> JobBuilder.newJob(LikeTask.<span class="keyword">class</span>).withIdentity(LIKE_TASK_IDENTITY).storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Trigger quartzTrigger()&#123;</span><br><span class="line">        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule()</span><br><span class="line"><span class="comment">//                .withIntervalInSeconds(10)  //è®¾ç½®æ—¶é—´å‘¨æœŸå•ä½ç§’</span></span><br><span class="line">                .withIntervalInHours(<span class="number">2</span>)  <span class="comment">//ä¸¤ä¸ªå°æ—¶æ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">                .repeatForever();</span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(quartzDetail())</span><br><span class="line">                .withIdentity(LIKE_TASK_IDENTITY)</span><br><span class="line">                .withSchedule(scheduleBuilder)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ç¼–å†™æ‰§è¡Œä»»åŠ¡çš„ç±»ç»§æ‰¿è‡ª  <code>QuartzJobBean</code></li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.solo.coderiver.user.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.solo.coderiver.user.service.<span class="type">LikedService</span>;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.<span class="type">Slf4j</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.time.<span class="type">DateUtils</span>;</span><br><span class="line"><span class="keyword">import</span> org.quartz.<span class="type">JobExecutionContext</span>;</span><br><span class="line"><span class="keyword">import</span> org.quartz.<span class="type">JobExecutionException</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.<span class="type">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.quartz.<span class="type">QuartzJobBean</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.<span class="type">SimpleDateFormat</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Date</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç‚¹èµçš„å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">LikeTask</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="type">LikedService</span> likedService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SimpleDateFormat</span> sdf = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> void executeInternal(<span class="type">JobExecutionContext</span> jobExecutionContext) <span class="keyword">throws</span> <span class="type">JobExecutionException</span> &#123;</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;LikeTask-------- &#123;&#125;&quot;</span>, sdf.format(<span class="keyword">new</span> <span class="type">Date</span>()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å°† Redis é‡Œçš„ç‚¹èµä¿¡æ¯åŒæ­¥åˆ°æ•°æ®åº“é‡Œ</span></span><br><span class="line">        likedService.transLikedFromRedis2DB();</span><br><span class="line">        likedService.transLikedCountFromRedis2DB();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>åœ¨å®šæ—¶ä»»åŠ¡ä¸­ç›´æ¥è°ƒç”¨  <code>LikedService</code>  å°è£…çš„æ–¹æ³•å®Œæˆæ•°æ®åŒæ­¥ã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-02-04T03:52:32.000Z" title="2021-2-4 11:52:32">2021-02-04</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-12-04T07:02:21.000Z" title="2022-12-4 15:02:21">2022-12-04</time>æ›´æ–°</span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦11024ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/02/04/%E3%80%90Activiti%E3%80%91Java%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%BC%95%E6%93%8E%20Activiti%20%E4%B8%87%E5%AD%97%E8%AF%A6%E7%BB%86%E5%85%A5%E9%97%A8/">ã€Activitiã€‘Javaå·¥ä½œæµå¼•æ“ Activiti ä¸‡å­—è¯¦ç»†å…¥é—¨</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="activitijavaå·¥ä½œæµå¼•æ“-activiti-ä¸‡å­—è¯¦ç»†å…¥é—¨"><a class="markdownIt-Anchor" href="#activitijavaå·¥ä½œæµå¼•æ“-activiti-ä¸‡å­—è¯¦ç»†å…¥é—¨">#</a> ã€Activitiã€‘Java å·¥ä½œæµå¼•æ“ Activiti ä¸‡å­—è¯¦ç»†å…¥é—¨</h1>
<h1 id="activiti7"><a class="markdownIt-Anchor" href="#activiti7">#</a> Activiti7</h1>
<h1 id="ä¸€-å·¥ä½œæµä»‹ç»"><a class="markdownIt-Anchor" href="#ä¸€-å·¥ä½œæµä»‹ç»">#</a> ä¸€ã€å·¥ä½œæµä»‹ç»</h1>
<h2 id="11-æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#11-æ¦‚å¿µ">#</a> 1.1 æ¦‚å¿µ</h2>
<p>å·¥ä½œæµ (Workflow)ï¼Œå°±æ˜¯é€šè¿‡è®¡ç®—æœºå¯¹ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–æ‰§è¡Œç®¡ç†ã€‚å®ƒä¸»è¦è§£å†³çš„æ˜¯ â€œä½¿åœ¨å¤šä¸ªå‚ä¸è€…ä¹‹é—´æŒ‰ç…§æŸç§é¢„å®šä¹‰çš„è§„åˆ™è‡ªåŠ¨è¿›è¡Œä¼ é€’æ–‡æ¡£ã€ä¿¡æ¯æˆ–ä»»åŠ¡çš„è¿‡ç¨‹ï¼Œä»è€Œå®ç°æŸä¸ªé¢„æœŸçš„ä¸šåŠ¡ç›®æ ‡ï¼Œæˆ–è€…ä¿ƒä½¿æ­¤ç›®æ ‡çš„å®ç°â€ã€‚</p>
<h2 id="12-å·¥ä½œæµç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#12-å·¥ä½œæµç³»ç»Ÿ">#</a> 1.2 å·¥ä½œæµç³»ç»Ÿ</h2>
<p>ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿä¸­å…·æœ‰å·¥ä½œæµçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä¸ºå·¥ä½œæµç³»ç»Ÿï¼Œä¸€ä¸ªç³»ç»Ÿä¸­å·¥ä½œæµçš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯å¯¹ç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹è¿›è¡Œè‡ªåŠ¨åŒ–ç®¡ç†ï¼Œæ‰€ä»¥å·¥ä½œæµæ˜¯å»ºç«‹åœ¨ä¸šåŠ¡æµç¨‹çš„åŸºç¡€ä¸Šï¼Œæ‰€ä»¥ä¸€ä¸ªè½¯ä»¶çš„ç³»ç»Ÿæ ¸å¿ƒæ ¹æœ¬ä¸Šè¿˜æ˜¯ç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹ï¼Œå·¥ä½œæµåªæ˜¯ååŠ©è¿›è¡Œä¸šåŠ¡æµç¨‹ç®¡ç†ã€‚å³ä½¿æ²¡æœ‰å·¥ä½œæµä¸šåŠ¡ç³»ç»Ÿä¹Ÿå¯ä»¥å¼€å‘è¿è¡Œï¼Œåªä¸è¿‡æœ‰äº†å·¥ä½œæµå¯ä»¥æ›´å¥½çš„ç®¡ç†ä¸šåŠ¡æµç¨‹ï¼Œæé«˜ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€‚</p>
<h2 id="13-é€‚ç”¨è¡Œä¸š"><a class="markdownIt-Anchor" href="#13-é€‚ç”¨è¡Œä¸š">#</a> 1.3 é€‚ç”¨è¡Œä¸š</h2>
<p>æ¶ˆè´¹å“è¡Œä¸šï¼Œåˆ¶é€ ä¸šï¼Œç”µä¿¡æœåŠ¡ä¸šï¼Œé“¶è¯é™©ç­‰é‡‘èæœåŠ¡ä¸šï¼Œç‰©æµæœåŠ¡ä¸šï¼Œç‰©ä¸šæœåŠ¡ä¸šï¼Œç‰©ä¸šç®¡ç†ï¼Œå¤§ä¸­å‹è¿›å‡ºå£è´¸æ˜“å…¬å¸ï¼Œæ”¿åºœäº‹ä¸šæœºæ„ï¼Œç ”ç©¶é™¢æ‰€åŠæ•™è‚²æœåŠ¡ä¸šç­‰ï¼Œç‰¹åˆ«æ˜¯å¤§çš„è·¨å›½ä¼ä¸šå’Œé›†å›¢å…¬å¸ã€‚</p>
<h2 id="14-å…·ä½“åº”ç”¨"><a class="markdownIt-Anchor" href="#14-å…·ä½“åº”ç”¨">#</a> 1.4 å…·ä½“åº”ç”¨</h2>
<p>1ã€å…³é”®ä¸šåŠ¡æµç¨‹ï¼šè®¢å•ã€æŠ¥ä»·å¤„ç†ã€åˆåŒå®¡æ ¸ã€å®¢æˆ·ç”µè¯å¤„ç†ã€ä¾›åº”é“¾ç®¡ç†ç­‰</p>
<p>2ã€è¡Œæ”¿ç®¡ç†ç±»ï¼šå‡ºå·®ç”³è¯·ã€åŠ ç­ç”³è¯·ã€è¯·å‡ç”³è¯·ã€ç”¨è½¦ç”³è¯·ã€å„ç§åŠå…¬ç”¨å“ç”³è¯·ã€è´­ä¹°ç”³è¯·ã€æ—¥æŠ¥å‘¨æŠ¥ç­‰å‡¡æ˜¯åŸæ¥æ‰‹å·¥æµè½¬å¤„ç†çš„è¡Œæ”¿è¡¨å•ã€‚</p>
<p>3ã€äººäº‹ç®¡ç†ç±»ï¼šå‘˜å·¥åŸ¹è®­å®‰æ’ã€ç»©æ•ˆè€ƒè¯„ã€èŒä½å˜åŠ¨å¤„ç†ã€å‘˜å·¥æ¡£æ¡ˆä¿¡æ¯ç®¡ç†ç­‰ã€‚</p>
<p>4ã€è´¢åŠ¡ç›¸å…³ç±»ï¼šä»˜æ¬¾è¯·æ±‚ã€åº”æ”¶æ¬¾å¤„ç†ã€æ—¥å¸¸æŠ¥é”€å¤„ç†ã€å‡ºå·®æŠ¥é”€ã€é¢„ç®—å’Œè®¡åˆ’ç”³è¯·ç­‰ã€‚</p>
<p>5ã€å®¢æˆ·æœåŠ¡ç±»ï¼šå®¢æˆ·ä¿¡æ¯ç®¡ç†ã€å®¢æˆ·æŠ•è¯‰ã€è¯·æ±‚å¤„ç†ã€å”®åæœåŠ¡ç®¡ç†ç­‰ã€‚</p>
<p>6ã€ç‰¹æ®ŠæœåŠ¡ç±»ï¼šISO ç³»åˆ—å¯¹åº”æµç¨‹ã€è´¨é‡ç®¡ç†å¯¹åº”æµç¨‹ã€äº§å“æ•°æ®ä¿¡æ¯ç®¡ç†ã€è´¸æ˜“å…¬å¸æŠ¥å…³å¤„ç†ã€ç‰©æµå…¬å¸è´§ç‰©è·Ÿè¸ªå¤„ç†ç­‰å„ç§é€šè¿‡è¡¨å•é€æ­¥æ‰‹å·¥æµè½¬å®Œæˆçš„ä»»åŠ¡å‡å¯åº”ç”¨å·¥ä½œæµè½¯ä»¶è‡ªåŠ¨è§„èŒƒåœ°å®æ–½ã€‚</p>
<h2 id="15-å®ç°æ–¹å¼"><a class="markdownIt-Anchor" href="#15-å®ç°æ–¹å¼">#</a> 1.5 å®ç°æ–¹å¼</h2>
<p>åœ¨æ²¡æœ‰ä¸“é—¨çš„å·¥ä½œæµå¼•æ“ä¹‹å‰ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸ºäº†å®ç°æµç¨‹æ§åˆ¶ï¼Œé€šå¸¸çš„åšæ³•å°±æ˜¯é‡‡ç”¨çŠ¶æ€å­—æ®µçš„å€¼æ¥è·Ÿè¸ªæµç¨‹çš„å˜åŒ–æƒ…å†µã€‚è¿™æ ·ä¸åŒè§’è‰²çš„ç”¨æˆ·ï¼Œé€šè¿‡çŠ¶æ€å­—æ®µçš„å–å€¼æ¥å†³å®šè®°å½•æ˜¯å¦æ˜¾ç¤ºã€‚</p>
<p>é’ˆå¯¹æœ‰æƒé™å¯ä»¥æŸ¥çœ‹çš„è®°å½•ï¼Œå½“å‰ç”¨æˆ·æ ¹æ®è‡ªå·±çš„è§’è‰²æ¥å†³å®šå®¡æ‰¹æ˜¯å¦åˆæ ¼çš„æ“ä½œã€‚å¦‚æœåˆæ ¼å°†çŠ¶æ€å­—æ®µè®¾ç½®ä¸€ä¸ªå€¼ï¼Œæ¥ä»£è¡¨åˆæ ¼ï¼›å½“ç„¶å¦‚æœä¸åˆæ ¼ä¹Ÿéœ€è¦è®¾ç½®ä¸€ä¸ªå€¼æ¥ä»£è¡¨ä¸åˆæ ¼çš„æƒ…å†µã€‚</p>
<p>è¿™æ˜¯ä¸€ç§æœ€ä¸ºåŸå§‹çš„æ–¹å¼ã€‚é€šè¿‡çŠ¶æ€å­—æ®µè™½ç„¶åšåˆ°äº†æµç¨‹æ§åˆ¶ï¼Œä½†æ˜¯å½“æˆ‘ä»¬çš„æµç¨‹å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼æ‰€ç¼–å†™çš„ä»£ç ä¹Ÿè¦è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸“ä¸šçš„æ–¹å¼æ¥å®ç°å·¥ä½œæµçš„ç®¡ç†å‘¢ï¼Ÿå¹¶ä¸”å¯ä»¥åšåˆ°ä¸šåŠ¡æµç¨‹å˜åŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯ä»¥ä¸ç”¨æ”¹å˜ï¼Œå¦‚æœå¯ä»¥å®ç°è¿™æ ·çš„æ•ˆæœï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿçš„é€‚åº”èƒ½åŠ›å°±å¾—åˆ°äº†æå¤§æå‡ã€‚</p>
<h1 id="äºŒ-activiti7æ¦‚è¿°"><a class="markdownIt-Anchor" href="#äºŒ-activiti7æ¦‚è¿°">#</a> äºŒã€Activiti7 æ¦‚è¿°</h1>
<h2 id="21-ä»‹ç»"><a class="markdownIt-Anchor" href="#21-ä»‹ç»">#</a> 2.1 ä»‹ç»</h2>
<p>Alfresco è½¯ä»¶åœ¨ 2010 å¹´ 5 æœˆ 17 æ—¥å®£å¸ƒ Activiti ä¸šåŠ¡æµç¨‹ç®¡ç†ï¼ˆBPMï¼‰å¼€æºé¡¹ç›®çš„æ­£å¼å¯åŠ¨ï¼Œå…¶é¦–å¸­æ¶æ„å¸ˆç”±ä¸šåŠ¡æµç¨‹ç®¡ç† BPM çš„ä¸“å®¶ Tom Baeyens æ‹…ä»»ï¼ŒTom Baeyens å°±æ˜¯åŸæ¥ jbpm çš„æ¶æ„å¸ˆï¼Œè€Œ jbpm æ˜¯ä¸€ä¸ªéå¸¸æœ‰åçš„å·¥ä½œæµå¼•æ“ï¼Œå½“ç„¶ activiti ä¹Ÿæ˜¯ä¸€ä¸ªå·¥ä½œæµå¼•æ“ã€‚</p>
<p>Activiti æ˜¯ä¸€ä¸ªå·¥ä½œæµå¼•æ“ï¼Œ activiti å¯ä»¥å°†ä¸šåŠ¡ç³»ç»Ÿä¸­å¤æ‚çš„ä¸šåŠ¡æµç¨‹æŠ½å–å‡ºæ¥ï¼Œä½¿ç”¨ä¸“é—¨çš„å»ºæ¨¡è¯­è¨€ BPMN2.0 è¿›è¡Œå®šä¹‰ï¼Œä¸šåŠ¡æµç¨‹æŒ‰ç…§é¢„å…ˆå®šä¹‰çš„æµç¨‹è¿›è¡Œæ‰§è¡Œï¼Œå®ç°äº†ç³»ç»Ÿçš„æµç¨‹ç”± activiti è¿›è¡Œç®¡ç†ï¼Œå‡å°‘ä¸šåŠ¡ç³»ç»Ÿç”±äºæµç¨‹å˜æ›´è¿›è¡Œç³»ç»Ÿå‡çº§æ”¹é€ çš„å·¥ä½œé‡ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¥å£®æ€§ï¼ŒåŒæ—¶ä¹Ÿå‡å°‘äº†ç³»ç»Ÿå¼€å‘ç»´æŠ¤æˆæœ¬ã€‚</p>
<p>å®˜æ–¹ç½‘ç«™ï¼š<a target="_blank" rel="noopener" href="https://www.activiti.org/">https://www.activiti.org/</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6d5fa212cb5c4186af366a6af2359a80.png" alt="img"></p>
<p>ç»å†çš„ç‰ˆæœ¬:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b2b6a0483819682db174c2d0bcaacd31.png" alt="img"></p>
<p>ç›®å‰æœ€æ–°ç‰ˆæœ¬ï¼šActiviti7.0.0.Beta</p>
<h3 id="211-bpm"><a class="markdownIt-Anchor" href="#211-bpm">#</a> 2.1.1 BPM</h3>
<p>BPMï¼ˆBusiness Process Managementï¼‰ï¼Œå³ä¸šåŠ¡æµç¨‹ç®¡ç†ï¼Œæ˜¯ä¸€ç§è§„èŒƒåŒ–çš„æ„é€ ç«¯åˆ°ç«¯çš„ä¸šåŠ¡æµç¨‹ï¼Œä»¥æŒç»­çš„æé«˜ç»„ç»‡ä¸šåŠ¡æ•ˆç‡ã€‚å¸¸è§å•†ä¸šç®¡ç†æ•™è‚²å¦‚ EMBAã€MBA ç­‰å‡å°† BPM åŒ…å«åœ¨å†…ã€‚</p>
<h3 id="212-bpmè½¯ä»¶"><a class="markdownIt-Anchor" href="#212-bpmè½¯ä»¶">#</a> 2.1.2 BPM è½¯ä»¶</h3>
<p>BPM è½¯ä»¶å°±æ˜¯æ ¹æ®ä¼ä¸šä¸­ä¸šåŠ¡ç¯å¢ƒçš„å˜åŒ–ï¼Œæ¨è¿›äººä¸äººä¹‹é—´ã€äººä¸ç³»ç»Ÿä¹‹é—´ä»¥åŠç³»ç»Ÿä¸ç³»ç»Ÿä¹‹é—´çš„æ•´åˆåŠè°ƒæ•´çš„ç»è¥æ–¹æ³•ä¸è§£å†³æ–¹æ¡ˆçš„ IT å·¥å…·ã€‚</p>
<p>é€šè¿‡ BPM è½¯ä»¶å¯¹ä¼ä¸šå†…éƒ¨åŠå¤–éƒ¨çš„ä¸šåŠ¡æµç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸè¿›è¡Œå»ºæ¨¡ã€è‡ªåŠ¨åŒ–ã€ç®¡ç†ç›‘æ§å’Œä¼˜åŒ–ï¼Œä½¿ä¼ä¸šæˆæœ¬é™ä½ï¼Œåˆ©æ¶¦å¾—ä»¥å¤§å¹…æå‡ã€‚</p>
<p>BPM è½¯ä»¶åœ¨ä¼ä¸šä¸­åº”ç”¨é¢†åŸŸå¹¿æ³›ï¼Œå‡¡æ˜¯æœ‰ä¸šåŠ¡æµç¨‹çš„åœ°æ–¹éƒ½å¯ä»¥ BPM è½¯ä»¶è¿›è¡Œç®¡ç†ï¼Œæ¯”å¦‚ä¼ä¸šäººäº‹åŠå…¬ç®¡ç†ã€é‡‡è´­æµç¨‹ç®¡ç†ã€å…¬æ–‡å®¡æ‰¹æµç¨‹ç®¡ç†ã€è´¢åŠ¡ç®¡ç†ç­‰ã€‚</p>
<h3 id="213-bpmn"><a class="markdownIt-Anchor" href="#213-bpmn">#</a> 2.1.3 BPMN</h3>
<p>BPMNï¼ˆBusiness Process Model AndNotationï¼‰- ä¸šåŠ¡æµç¨‹æ¨¡å‹å’Œç¬¦å· æ˜¯ç”± BPMIï¼ˆBusinessProcess Management Initiativeï¼‰å¼€å‘çš„ä¸€å¥—æ ‡å‡†çš„ä¸šåŠ¡æµç¨‹å»ºæ¨¡ç¬¦å·ï¼Œä½¿ç”¨ BPMN æä¾›çš„ç¬¦å·å¯ä»¥åˆ›å»ºä¸šåŠ¡æµç¨‹ã€‚</p>
<p>2004 å¹´ 5 æœˆå‘å¸ƒäº† BPMN1.0 è§„èŒƒ.BPMI äº 2005 å¹´ 9 æœˆå¹¶å…¥ OMGï¼ˆThe Object Management Group å¯¹è±¡ç®¡ç†ç»„ç»‡) ç»„ç»‡ã€‚OMG äº 2011 å¹´ 1 æœˆå‘å¸ƒ BPMN2.0 çš„æœ€ç»ˆç‰ˆæœ¬ã€‚</p>
<p>å…·ä½“å‘å±•å†å²å¦‚ä¸‹:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4a5c9b0e87bab71979a722ea5967d1df.png" alt="img"></p>
<p>BPMN æ˜¯ç›®å‰è¢«å„ BPM å‚å•†å¹¿æ³›æ¥å—çš„ BPM æ ‡å‡†ã€‚Activiti å°±æ˜¯ä½¿ç”¨ BPMN 2.0 è¿›è¡Œæµç¨‹å»ºæ¨¡ã€æµç¨‹æ‰§è¡Œç®¡ç†ï¼Œå®ƒåŒ…æ‹¬å¾ˆå¤šçš„å»ºæ¨¡ç¬¦å·ï¼Œæ¯”å¦‚ï¼š</p>
<p>Event</p>
<p>ç”¨ä¸€ä¸ªåœ†åœˆè¡¨ç¤ºï¼Œå®ƒæ˜¯æµç¨‹ä¸­è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c62d43f73620718b749276dd6e9c8c53.png" alt="img"></p>
<p>æ´»åŠ¨ç”¨åœ†è§’çŸ©å½¢è¡¨ç¤ºï¼Œä¸€ä¸ªæµç¨‹ç”±ä¸€ä¸ªæ´»åŠ¨æˆ–å¤šä¸ªæ´»åŠ¨ç»„æˆ</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2e9e2be515de8ff8a0cdd4e238bc35d0.png" alt="img"></p>
<p>Bpmn å›¾å½¢å…¶å®æ˜¯é€šè¿‡ xml è¡¨ç¤ºä¸šåŠ¡æµç¨‹ï¼Œä¸Šè¾¹çš„.bpmn æ–‡ä»¶ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:activiti</span>=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.activiti.org/test&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;myProcess&quot;</span> <span class="attr">name</span>=<span class="string">&quot;My process&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Start&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">startEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;åˆ›å»ºè¯·å‡å•&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow1&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;éƒ¨é—¨ç»ç†å®¡æ ¸&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow2&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;äººäº‹å¤æ ¸&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow3&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;endevent1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;End&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow4&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;endevent1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bpmndi:BPMNDiagram</span> <span class="attr">id</span>=<span class="string">&quot;BPMNDiagram_myProcess&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bpmndi:BPMNPlane</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;myProcess&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNPlane_myProcess&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_startevent1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;130.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;160.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;210.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;510.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;endevent1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_endevent1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;660.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;160.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;165.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;210.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;315.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;465.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;510.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow4&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;615.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;660.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bpmndi:BPMNPlane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bpmndi:BPMNDiagram</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="22-ä½¿ç”¨æ­¥éª¤"><a class="markdownIt-Anchor" href="#22-ä½¿ç”¨æ­¥éª¤">#</a> 2.2 ä½¿ç”¨æ­¥éª¤</h2>
<h3 id="éƒ¨ç½²activiti"><a class="markdownIt-Anchor" href="#éƒ¨ç½²activiti">#</a> éƒ¨ç½² activiti</h3>
<p>Activiti æ˜¯ä¸€ä¸ªå·¥ä½œæµå¼•æ“ï¼ˆå…¶å®å°±æ˜¯ä¸€å † jar åŒ… APIï¼‰ï¼Œä¸šåŠ¡ç³»ç»Ÿè®¿é—® (æ“ä½œ) activiti çš„æ¥å£ï¼Œå°±å¯ä»¥æ–¹ä¾¿çš„æ“ä½œæµç¨‹ç›¸å…³æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå·¥ä½œæµç¯å¢ƒä¸ä¸šåŠ¡ç³»ç»Ÿçš„ç¯å¢ƒé›†æˆåœ¨ä¸€èµ·ã€‚</p>
<h3 id="æµç¨‹å®šä¹‰"><a class="markdownIt-Anchor" href="#æµç¨‹å®šä¹‰">#</a> æµç¨‹å®šä¹‰</h3>
<p>ä½¿ç”¨ activiti æµç¨‹å»ºæ¨¡å·¥å…· (activity-designer) å®šä¹‰ä¸šåŠ¡æµç¨‹ (.bpmn æ–‡ä»¶) ã€‚</p>
<p>.bpmn æ–‡ä»¶å°±æ˜¯ä¸šåŠ¡æµç¨‹å®šä¹‰æ–‡ä»¶ï¼Œé€šè¿‡ xml å®šä¹‰ä¸šåŠ¡æµç¨‹ã€‚</p>
<h3 id="æµç¨‹å®šä¹‰éƒ¨ç½²"><a class="markdownIt-Anchor" href="#æµç¨‹å®šä¹‰éƒ¨ç½²">#</a> æµç¨‹å®šä¹‰éƒ¨ç½²</h3>
<p>activiti éƒ¨ç½²ä¸šåŠ¡æµç¨‹å®šä¹‰ï¼ˆ.bpmn æ–‡ä»¶ï¼‰ã€‚</p>
<p>ä½¿ç”¨ activiti æä¾›çš„ api æŠŠæµç¨‹å®šä¹‰å†…å®¹å­˜å‚¨èµ·æ¥ï¼Œåœ¨ Activiti æ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æŸ¥è¯¢å®šä¹‰çš„å†…å®¹</p>
<p>Activiti æ‰§è¡ŒæŠŠæµç¨‹å®šä¹‰å†…å®¹å­˜å‚¨åœ¨æ•°æ®åº“ä¸­</p>
<h3 id="å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹"><a class="markdownIt-Anchor" href="#å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹">#</a> å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹</h3>
<p>æµç¨‹å®ä¾‹ä¹Ÿå«ï¼šProcessInstance</p>
<p>å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹è¡¨ç¤ºå¼€å§‹ä¸€æ¬¡ä¸šåŠ¡æµç¨‹çš„è¿è¡Œã€‚</p>
<p>åœ¨å‘˜å·¥è¯·å‡æµç¨‹å®šä¹‰éƒ¨ç½²å®Œæˆåï¼Œå¦‚æœå¼ ä¸‰è¦è¯·å‡å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹ï¼Œå¦‚æœæå››è¦è¯·å‡ä¹Ÿå¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹ï¼Œä¸¤ä¸ªæµç¨‹çš„æ‰§è¡Œäº’ç›¸ä¸å½±å“ã€‚</p>
<h3 id="ç”¨æˆ·æŸ¥è¯¢å¾…åŠä»»åŠ¡task"><a class="markdownIt-Anchor" href="#ç”¨æˆ·æŸ¥è¯¢å¾…åŠä»»åŠ¡task">#</a> ç”¨æˆ·æŸ¥è¯¢å¾…åŠä»»åŠ¡ (Task)</h3>
<p>å› ä¸ºç°åœ¨ç³»ç»Ÿçš„ä¸šåŠ¡æµç¨‹å·²ç»äº¤ç»™ activiti ç®¡ç†ï¼Œé€šè¿‡ activiti å°±å¯ä»¥æŸ¥è¯¢å½“å‰æµç¨‹æ‰§è¡Œåˆ°å“ªäº†ï¼Œå½“å‰ç”¨æˆ·éœ€è¦åŠç†ä»€ä¹ˆä»»åŠ¡äº†ï¼Œè¿™äº› activiti å¸®æˆ‘ä»¬ç®¡ç†äº†ï¼Œè€Œä¸éœ€è¦å¼€å‘äººå‘˜è‡ªå·±ç¼–å†™åœ¨ sql è¯­å¥æŸ¥è¯¢ã€‚</p>
<h3 id="ç”¨æˆ·åŠç†ä»»åŠ¡"><a class="markdownIt-Anchor" href="#ç”¨æˆ·åŠç†ä»»åŠ¡">#</a> ç”¨æˆ·åŠç†ä»»åŠ¡</h3>
<p>ç”¨æˆ·æŸ¥è¯¢å¾…åŠä»»åŠ¡åï¼Œå°±å¯ä»¥åŠç†æŸä¸ªä»»åŠ¡ï¼Œå¦‚æœè¿™ä¸ªä»»åŠ¡åŠç†å®Œæˆè¿˜éœ€è¦å…¶å®ƒç”¨æˆ·åŠç†ï¼Œæ¯”å¦‚é‡‡è´­å•åˆ›å»ºåç”±éƒ¨é—¨ç»ç†å®¡æ ¸ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ç”± activiti å¸®æˆ‘ä»¬å®Œæˆäº†ã€‚</p>
<h3 id="æµç¨‹ç»“æŸ"><a class="markdownIt-Anchor" href="#æµç¨‹ç»“æŸ">#</a> æµç¨‹ç»“æŸ</h3>
<p>å½“ä»»åŠ¡åŠç†å®Œæˆæ²¡æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡ç»“ç‚¹äº†ï¼Œè¿™ä¸ªæµç¨‹å®ä¾‹å°±å®Œæˆäº†ã€‚</p>
<h1 id="ä¸‰-activitiç¯å¢ƒ"><a class="markdownIt-Anchor" href="#ä¸‰-activitiç¯å¢ƒ">#</a> ä¸‰ã€Activiti ç¯å¢ƒ</h1>
<h2 id="31-å¼€å‘ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#31-å¼€å‘ç¯å¢ƒ">#</a> 3.1 å¼€å‘ç¯å¢ƒ</h2>
<p>Jdk1.8 æˆ–ä»¥ä¸Šç‰ˆæœ¬</p>
<p>Mysql 5 åŠä»¥ä¸Šçš„ç‰ˆæœ¬</p>
<p>Tomcat8.5</p>
<p>IDEA</p>
<p><strong>æ³¨æ„ï¼šactiviti çš„æµç¨‹å®šä¹‰å·¥å…·æ’ä»¶å¯ä»¥å®‰è£…åœ¨ IDEA ä¸‹ï¼Œä¹Ÿå¯ä»¥å®‰è£…åœ¨ Eclipse å·¥å…·ä¸‹</strong></p>
<h2 id="32-activitiç¯å¢ƒ"><a class="markdownIt-Anchor" href="#32-activitiç¯å¢ƒ">#</a> 3.2 Activiti ç¯å¢ƒ</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ï¼šActiviti7.0.0.Beta1 é»˜è®¤æ”¯æŒ spring5</p>
<h3 id="321-ä¸‹è½½activiti7"><a class="markdownIt-Anchor" href="#321-ä¸‹è½½activiti7">#</a> 3.2.1 ä¸‹è½½ activiti7</h3>
<p>Activiti ä¸‹è½½åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://activiti.org/download.html">http://activiti.org/download.html</a> ï¼ŒMaven çš„ä¾èµ–å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.0.Beta1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>1)</strong> <strong>Database</strong>ï¼š</p>
<p>activiti è¿è¡Œéœ€è¦æœ‰æ•°æ®åº“çš„æ”¯æŒï¼Œæ”¯æŒçš„æ•°æ®åº“æœ‰ï¼šh2, mysql, oracle, postgres, mssql, db2ã€‚</p>
<h3 id="322-æµç¨‹è®¾è®¡å™¨ideaä¸‹å®‰è£…"><a class="markdownIt-Anchor" href="#322-æµç¨‹è®¾è®¡å™¨ideaä¸‹å®‰è£…">#</a> 3.2.2 æµç¨‹è®¾è®¡å™¨ IDEA ä¸‹å®‰è£…</h3>
<p>åœ¨ IDEA çš„ File èœå•ä¸­æ‰¾åˆ°å­èœå•â€Settingsâ€, åé¢æˆ‘ä»¬å†é€‰æ‹©å·¦ä¾§çš„ â€œpluginsâ€ èœå•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4222667fb5d6374e5d494385bcbf04b4.png" alt="img"></p>
<p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æœç´¢åˆ° actiBPM æ’ä»¶ï¼Œå®ƒå°±æ˜¯ Activiti Designer çš„ IDEA ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ç‚¹å‡» Install å®‰è£…ã€‚</p>
<p>å®‰è£…å¥½åï¼Œé¡µé¢å¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f5a2177202ea9dd4630e255c403d7100.png" alt="img"></p>
<p>æç¤ºéœ€è¦é‡å¯ ideaï¼Œç‚¹å‡»é‡å¯ã€‚</p>
<p>é‡å¯å®Œæˆåï¼Œå†æ¬¡æ‰“å¼€ Settings ä¸‹çš„ Pluginsï¼ˆæ’ä»¶åˆ—è¡¨ï¼‰ï¼Œç‚¹å‡»å³ä¾§çš„ Installedï¼ˆå·²å®‰è£…çš„æ’ä»¶ï¼‰ï¼Œåœ¨åˆ—è¡¨ä¸­çœ‹åˆ° actiBPMï¼Œå°±è¯´æ˜å·²ç»å®‰è£…æˆåŠŸäº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/988e0af68496e1b4d219c78685ab7f2c.png" alt="img"></p>
<p>åé¢çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨è¿™ä¸ªæµç¨‹è®¾è®¡å™¨è¿›è¡Œ Activiti çš„æµç¨‹è®¾è®¡ã€‚</p>
<h2 id="33-activitiçš„æ•°æ®åº“æ”¯æŒ"><a class="markdownIt-Anchor" href="#33-activitiçš„æ•°æ®åº“æ”¯æŒ">#</a> 3.3 Activiti çš„æ•°æ®åº“æ”¯æŒ</h2>
<p>Activiti åœ¨è¿è¡Œæ—¶éœ€è¦æ•°æ®åº“çš„æ”¯æŒï¼Œä½¿ç”¨ 25 å¼ è¡¨ï¼ŒæŠŠæµç¨‹å®šä¹‰èŠ‚ç‚¹å†…å®¹è¯»å–åˆ°æ•°æ®åº“è¡¨ä¸­ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚</p>
<h3 id="331-activiti-æ”¯æŒçš„æ•°æ®åº“"><a class="markdownIt-Anchor" href="#331-activiti-æ”¯æŒçš„æ•°æ®åº“">#</a> 3.3.1 Activiti æ”¯æŒçš„æ•°æ®åº“</h3>
<p>activiti æ”¯æŒçš„æ•°æ®åº“å’Œç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>æ•°æ®åº“ç±»å‹</th>
<th>ç‰ˆæœ¬</th>
<th>JDBC è¿æ¥ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>h2</td>
<td>1.3.168</td>
<td>jdbc:h2:tcp://localhost/activiti</td>
<td>é»˜è®¤é…ç½®çš„æ•°æ®åº“</td>
</tr>
<tr>
<td>mysql</td>
<td>5.1.21</td>
<td>jdbc:mysql://localhost:3306/activiti?autoReconnect=true</td>
<td>ä½¿ç”¨ mysql-connector-java é©±åŠ¨æµ‹è¯•</td>
</tr>
<tr>
<td>oracle</td>
<td>11.2.0.1.0</td>
<td>jdbc:oracle:thin:@localhost:1521:xe</td>
<td></td>
</tr>
<tr>
<td>postgres</td>
<td>8.1</td>
<td>jdbc:postgresql://localhost:5432/activiti</td>
<td></td>
</tr>
<tr>
<td>db2</td>
<td>DB2 10.1 using db2jcc4</td>
<td>jdbc:db2://localhost:50000/activiti</td>
<td></td>
</tr>
<tr>
<td>mssql</td>
<td>2008 using sqljdbc4</td>
<td>jdbc:sqlserver://localhost:1433/activiti</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="332-åœ¨mysqlç”Ÿæˆè¡¨"><a class="markdownIt-Anchor" href="#332-åœ¨mysqlç”Ÿæˆè¡¨">#</a> 3.3.2 åœ¨ MySQL ç”Ÿæˆè¡¨</h3>
<h4 id="3321-åˆ›å»ºæ•°æ®åº“"><a class="markdownIt-Anchor" href="#3321-åˆ›å»ºæ•°æ®åº“">#</a> 3.3.2.1 åˆ›å»ºæ•°æ®åº“</h4>
<p>åˆ›å»º mysql æ•°æ®åº“ activiti ï¼ˆåå­—ä»»æ„ï¼‰ï¼š</p>
<p>CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;</p>
<h4 id="3322-ä½¿ç”¨javaä»£ç ç”Ÿæˆè¡¨"><a class="markdownIt-Anchor" href="#3322-ä½¿ç”¨javaä»£ç ç”Ÿæˆè¡¨">#</a> 3.3.2.2 ä½¿ç”¨ java ä»£ç ç”Ÿæˆè¡¨</h4>
<h5 id="1-åˆ›å»º-java-å·¥ç¨‹"><a class="markdownIt-Anchor" href="#1-åˆ›å»º-java-å·¥ç¨‹">#</a> 1ï¼‰ åˆ›å»º java å·¥ç¨‹</h5>
<p>ä½¿ç”¨ idea åˆ›å»º java çš„ maven å·¥ç¨‹ï¼Œå–åï¼šactiviti01ã€‚</p>
<h5 id="2-åŠ å…¥-maven-ä¾èµ–çš„åæ ‡jar-åŒ…"><a class="markdownIt-Anchor" href="#2-åŠ å…¥-maven-ä¾èµ–çš„åæ ‡jar-åŒ…">#</a> 2ï¼‰ åŠ å…¥ maven ä¾èµ–çš„åæ ‡ï¼ˆjar åŒ…ï¼‰</h5>
<p>é¦–å…ˆéœ€è¦åœ¨ java å·¥ç¨‹ä¸­åŠ å…¥ ProcessEngine æ‰€éœ€è¦çš„ jar åŒ…ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>activiti-engine-7.0.0.beta1.jar</li>
<li>activiti ä¾èµ–çš„ jar åŒ…ï¼š mybatisã€ alf4jã€ log4j ç­‰</li>
<li>activiti ä¾èµ–çš„ spring åŒ…</li>
<li>mysql æ•°æ®åº“é©±åŠ¨</li>
<li>ç¬¬ä¸‰æ–¹æ•°æ®è¿æ¥æ±  dbcp</li>
<li>å•å…ƒæµ‹è¯• Junit-4.12.jar</li>
</ol>
<p>æˆ‘ä»¬ä½¿ç”¨ maven æ¥å®ç°é¡¹ç›®çš„æ„å»ºï¼Œæ‰€ä»¥åº”å½“å¯¼å…¥è¿™äº› jar æ‰€å¯¹åº”çš„åæ ‡åˆ° pom.xml æ–‡ä»¶ä¸­ã€‚</p>
<p>å®Œæ•´çš„ä¾èµ–å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.6<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activiti.version</span>&gt;</span>7.0.0.Beta1<span class="tag">&lt;/<span class="name">activiti.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn æ¨¡å‹å¤„ç† --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn è½¬æ¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-converter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn jsonæ•°æ®è½¬æ¢ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-json-converter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn å¸ƒå±€ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-layout<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- activiti äº‘æ”¯æŒ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-cloud-services-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.40<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é“¾æ¥æ±  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log start --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3-æ·»åŠ log4jæ—¥å¿—é…ç½®"><a class="markdownIt-Anchor" href="#3-æ·»åŠ log4jæ—¥å¿—é…ç½®">#</a> 3ï¼‰ æ·»åŠ  log4j æ—¥å¿—é…ç½®</h5>
<p>æˆ‘ä»¬ä½¿ç”¨ log4j æ—¥å¿—åŒ…ï¼Œå¯ä»¥å¯¹æ—¥å¿—è¿›è¡Œé…ç½®</p>
<p>åœ¨ resources ä¸‹åˆ›å»º log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set root category priority to INFO and its only appender to CONSOLE.</span></span><br><span class="line"><span class="comment">#log4j.rootCategory=INFO, CONSOLE debug info warn error fatal</span></span><br><span class="line"><span class="attr">log4j.rootCategory</span>=<span class="string">debug, CONSOLE, LOGFILE</span></span><br><span class="line"><span class="comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span></span><br><span class="line"><span class="attr">log4j.logger.org.apache.axis.enterprise</span>=<span class="string">FATAL, CONSOLE</span></span><br><span class="line"><span class="comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span></span><br><span class="line"><span class="comment"># LOGFILE is set to be a File appender using a PatternLayout.</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.File</span>=<span class="string">f:\act\activiti.log</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.Append</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span></span><br></pre></td></tr></table></figure>
<h5 id="4-æ·»åŠ activitié…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#4-æ·»åŠ activitié…ç½®æ–‡ä»¶">#</a> 4ï¼‰ æ·»åŠ  activiti é…ç½®æ–‡ä»¶</h5>
<p>æˆ‘ä»¬ä½¿ç”¨ activiti æä¾›çš„é»˜è®¤æ–¹å¼æ¥åˆ›å»º mysql çš„è¡¨ã€‚</p>
<p>é»˜è®¤æ–¹å¼çš„è¦æ±‚æ˜¯åœ¨ resources ä¸‹åˆ›å»º activiti.cfg.xml æ–‡ä»¶ï¼Œæ³¨æ„ï¼šé»˜è®¤æ–¹å¼ç›®å½•å’Œæ–‡ä»¶åä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸º activiti çš„æºç ä¸­å·²ç»è®¾ç½®ï¼Œåˆ°å›ºå®šçš„ç›®å½•è¯»å–å›ºå®šæ–‡ä»¶åçš„æ–‡ä»¶ã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="5-åœ¨-activiticfgxml-ä¸­è¿›è¡Œé…ç½®"><a class="markdownIt-Anchor" href="#5-åœ¨-activiticfgxml-ä¸­è¿›è¡Œé…ç½®">#</a> 5ï¼‰ åœ¨ activiti.cfg.xml ä¸­è¿›è¡Œé…ç½®</h5>
<p>é»˜è®¤æ–¹å¼è¦åœ¨åœ¨ activiti.cfg.xml ä¸­ bean çš„åå­—å« processEngineConfigurationï¼Œåå­—ä¸å¯ä¿®æ”¹</p>
<p>åœ¨è¿™é‡Œæœ‰ 2 ä¸­é…ç½®æ–¹å¼ï¼šä¸€ç§æ˜¯å•ç‹¬é…ç½®æ•°æ®æºï¼Œä¸€ç§æ˜¯ä¸å•ç‹¬é…ç½®æ•°æ®æº</p>
<h6 id="1-ç›´æ¥é…ç½®processengineconfiguration"><a class="markdownIt-Anchor" href="#1-ç›´æ¥é…ç½®processengineconfiguration">#</a> 1ã€ç›´æ¥é…ç½® processEngineConfiguration</h6>
<p>processEngineConfiguration ç”¨æ¥åˆ›å»º ProcessEngineï¼Œåœ¨åˆ›å»º ProcessEngine æ—¶ä¼šæ‰§è¡Œæ•°æ®åº“çš„æ“ä½œã€‚</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é»˜è®¤idå¯¹åº”çš„å€¼ ä¸ºprocessEngineConfiguration --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- processEngine Activitiçš„æµç¨‹å¼•æ“ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcDriver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUsername&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcPassword&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- activitiæ•°æ®åº“è¡¨å¤„ç†ç­–ç•¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="2-é…ç½®æ•°æ®æºååœ¨processengineconfiguration-å¼•ç”¨"><a class="markdownIt-Anchor" href="#2-é…ç½®æ•°æ®æºååœ¨processengineconfiguration-å¼•ç”¨">#</a> 2ã€é…ç½®æ•°æ®æºåï¼Œåœ¨ processEngineConfiguration å¼•ç”¨</h6>
<p>é¦–å…ˆé…ç½®æ•°æ®æº</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- è¿™é‡Œå¯ä»¥ä½¿ç”¨ é“¾æ¥æ±  dbcp--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•ç”¨æ•°æ®æº ä¸Šé¢å·²ç»è®¾ç½®å¥½äº†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- activitiæ•°æ®åº“è¡¨å¤„ç†ç­–ç•¥ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="6-javaç±»ç¼–å†™ç¨‹åºç”Ÿæˆè¡¨"><a class="markdownIt-Anchor" href="#6-javaç±»ç¼–å†™ç¨‹åºç”Ÿæˆè¡¨">#</a> 6ï¼‰ java ç±»ç¼–å†™ç¨‹åºç”Ÿæˆè¡¨</h5>
<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±»ï¼Œè°ƒç”¨ activiti çš„å·¥å…·ç±»ï¼Œç”Ÿæˆ acitivti éœ€è¦çš„æ•°æ®åº“è¡¨ã€‚</p>
<p>ç›´æ¥ä½¿ç”¨ activiti æä¾›çš„å·¥å…·ç±» ProcessEnginesï¼Œä¼šé»˜è®¤è¯»å– classpath ä¸‹çš„ activiti.cfg.xml æ–‡ä»¶ï¼Œè¯»å–å…¶ä¸­çš„æ•°æ®åº“é…ç½®ï¼Œåˆ›å»º ProcessEngineï¼Œåœ¨åˆ›å»º ProcessEngine æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºè¡¨ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.activiti01.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆ activitiçš„æ•°æ®åº“è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateDbTable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨classpathä¸‹çš„activiti.cfg.xmlä¸­çš„é…ç½®åˆ›å»ºprocessEngine</span></span><br><span class="line">		<span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">		System.out.println(processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š<br>
1ã€è¿è¡Œä»¥ä¸Šç¨‹åºæ®µå³å¯å®Œæˆ activiti è¡¨åˆ›å»ºï¼Œé€šè¿‡æ”¹å˜ activiti.cfg.xml ä¸­ databaseSchemaUpdate å‚æ•°çš„å€¼æ‰§è¡Œä¸åŒçš„æ•°æ®è¡¨å¤„ç†ç­–ç•¥ã€‚<br>
2 ã€ ä¸Š è¾¹ çš„ æ–¹æ³• getDefaultProcessEngine æ–¹æ³•åœ¨æ‰§è¡Œæ—¶ï¼Œä» activiti.cfg.xml ä¸­æ‰¾å›ºå®šçš„åç§° processEngineConfiguration ã€‚</p>
<p>åœ¨æµ‹è¯•ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œidea çš„æ§åˆ¶å°ä¼šè¾“å‡ºæ—¥å¿—ï¼Œè¯´æ˜ç¨‹åºæ­£åœ¨åˆ›å»ºæ•°æ®è¡¨ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼Œæ³¨æ„çº¢çº¿å†…å®¹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/303798960a34b13286c1078b3cdbba1b.png" alt="img"></p>
<p>æ‰§è¡Œå®Œæˆåæˆ‘ä»¬æŸ¥çœ‹æ•°æ®åº“ï¼Œ åˆ›å»ºäº† 25 å¼ è¡¨ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/abf223e14cf32150f025c12b84be2eab.png" alt="img"></p>
<p>åˆ°è¿™ï¼Œæˆ‘ä»¬å°±å®Œæˆ activiti è¿è¡Œéœ€è¦çš„æ•°æ®åº“å’Œè¡¨çš„åˆ›å»ºã€‚</p>
<h2 id="34-è¡¨ç»“æ„ä»‹ç»"><a class="markdownIt-Anchor" href="#34-è¡¨ç»“æ„ä»‹ç»">#</a> 3.4 è¡¨ç»“æ„ä»‹ç»</h2>
<h3 id="341-è¡¨çš„å‘½åè§„åˆ™å’Œä½œç”¨"><a class="markdownIt-Anchor" href="#341-è¡¨çš„å‘½åè§„åˆ™å’Œä½œç”¨">#</a> 3.4.1 è¡¨çš„å‘½åè§„åˆ™å’Œä½œç”¨</h3>
<p>çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„è¡¨ï¼Œæˆ‘ä»¬å‘ç° Activiti çš„è¡¨éƒ½ä»¥ ACT_ å¼€å¤´ã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†æ˜¯è¡¨ç¤ºè¡¨çš„ç”¨é€”çš„ä¸¤ä¸ªå­—æ¯æ ‡è¯†ã€‚ ç”¨é€”ä¹Ÿå’ŒæœåŠ¡çš„ API å¯¹åº”ã€‚<br>
<strong>ACT_RE</strong> ï¼š'REâ€™è¡¨ç¤º repositoryã€‚ è¿™ä¸ªå‰ç¼€çš„è¡¨åŒ…å«äº†æµç¨‹å®šä¹‰å’Œæµç¨‹é™æ€èµ„æº ï¼ˆå›¾ç‰‡ï¼Œè§„åˆ™ï¼Œç­‰ç­‰ï¼‰ã€‚<br>
<strong>ACT_RU</strong>ï¼š'RUâ€™è¡¨ç¤º runtimeã€‚ è¿™äº›è¿è¡Œæ—¶çš„è¡¨ï¼ŒåŒ…å«æµç¨‹å®ä¾‹ï¼Œä»»åŠ¡ï¼Œå˜é‡ï¼Œå¼‚æ­¥ä»»åŠ¡ï¼Œç­‰è¿è¡Œä¸­çš„æ•°æ®ã€‚ Activiti åªåœ¨æµç¨‹å®ä¾‹æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿å­˜è¿™äº›æ•°æ®ï¼Œ åœ¨æµç¨‹ç»“æŸæ—¶å°±ä¼šåˆ é™¤è¿™äº›è®°å½•ã€‚ è¿™æ ·è¿è¡Œæ—¶è¡¨å¯ä»¥ä¸€ç›´å¾ˆå°é€Ÿåº¦å¾ˆå¿«ã€‚<br>
<strong>ACT_HI</strong>ï¼š'HIâ€™è¡¨ç¤º historyã€‚ è¿™äº›è¡¨åŒ…å«å†å²æ•°æ®ï¼Œæ¯”å¦‚å†å²æµç¨‹å®ä¾‹ï¼Œ å˜é‡ï¼Œä»»åŠ¡ç­‰ç­‰ã€‚<br>
<strong>ACT_GE</strong> ï¼š GE è¡¨ç¤º generalã€‚ é€šç”¨æ•°æ®ï¼Œ ç”¨äºä¸åŒåœºæ™¯ä¸‹</p>
<h3 id="342-activitiæ•°æ®è¡¨ä»‹ç»"><a class="markdownIt-Anchor" href="#342-activitiæ•°æ®è¡¨ä»‹ç»">#</a> 3.4.2 Activiti æ•°æ®è¡¨ä»‹ç»</h3>
<table>
<thead>
<tr>
<th><strong>è¡¨åˆ†ç±»</strong></th>
<th><strong>è¡¨å</strong></th>
<th><strong>è§£é‡Š</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸€èˆ¬æ•°æ®</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_BYTEARRAY]</td>
<td>é€šç”¨çš„æµç¨‹å®šä¹‰å’Œæµç¨‹èµ„æº</td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_PROPERTY]</td>
<td>ç³»ç»Ÿç›¸å…³å±æ€§</td>
</tr>
<tr>
<td>æµç¨‹å†å²è®°å½•</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ACTINST]</td>
<td>å†å²çš„æµç¨‹å®ä¾‹</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ATTACHMENT]</td>
<td>å†å²çš„æµç¨‹é™„ä»¶</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_COMMENT]</td>
<td>å†å²çš„è¯´æ˜æ€§ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_DETAIL]</td>
<td>å†å²çš„æµç¨‹è¿è¡Œä¸­çš„ç»†èŠ‚ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_IDENTITYLINK]</td>
<td>å†å²çš„æµç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ç”¨æˆ·å…³ç³»</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_PROCINST]</td>
<td>å†å²çš„æµç¨‹å®ä¾‹</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_TASKINST]</td>
<td>å†å²çš„ä»»åŠ¡å®ä¾‹</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_VARINST]</td>
<td>å†å²çš„æµç¨‹è¿è¡Œä¸­çš„å˜é‡ä¿¡æ¯</td>
</tr>
<tr>
<td>æµç¨‹å®šä¹‰è¡¨</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_DEPLOYMENT]</td>
<td>éƒ¨ç½²å•å…ƒä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_MODEL]</td>
<td>æ¨¡å‹ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_PROCDEF]</td>
<td>å·²éƒ¨ç½²çš„æµç¨‹å®šä¹‰</td>
</tr>
<tr>
<td>è¿è¡Œå®ä¾‹è¡¨</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EVENT_SUBSCR]</td>
<td>è¿è¡Œæ—¶äº‹ä»¶</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EXECUTION]</td>
<td>è¿è¡Œæ—¶æµç¨‹æ‰§è¡Œå®ä¾‹</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_IDENTITYLINK]</td>
<td>è¿è¡Œæ—¶ç”¨æˆ·å…³ç³»ä¿¡æ¯ï¼Œå­˜å‚¨ä»»åŠ¡èŠ‚ç‚¹ä¸å‚ä¸è€…çš„ç›¸å…³ä¿¡æ¯</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_JOB]</td>
<td>è¿è¡Œæ—¶ä½œä¸š</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_TASK]</td>
<td>è¿è¡Œæ—¶ä»»åŠ¡</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_VARIABLE]</td>
<td>è¿è¡Œæ—¶å˜é‡è¡¨</td>
</tr>
</tbody>
</table>
<h1 id="å››-activitiç±»å…³ç³»å›¾"><a class="markdownIt-Anchor" href="#å››-activitiç±»å…³ç³»å›¾">#</a> å››ã€Activiti ç±»å…³ç³»å›¾</h1>
<p>ä¸Šé¢æˆ‘ä»¬å®Œæˆäº† Activiti æ•°æ®åº“è¡¨çš„ç”Ÿæˆï¼Œjava ä»£ç ä¸­æˆ‘ä»¬è°ƒç”¨ Activiti çš„å·¥å…·ç±»ï¼Œä¸‹é¢æ¥äº†è§£ Activiti çš„ç±»å…³ç³»</p>
<h2 id="41-ç±»å…³ç³»å›¾"><a class="markdownIt-Anchor" href="#41-ç±»å…³ç³»å›¾">#</a> 4.1 ç±»å…³ç³»å›¾</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/eb571b5c4a1dff4f54dd504a537e4ade.png" alt="img"></p>
<p>åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®éªŒå¯ä»¥å‘ç° IdentityServiceï¼ŒFormService ä¸¤ä¸ª Serivce éƒ½å·²ç»åˆ é™¤äº†ã€‚</p>
<p>æ‰€ä»¥åé¢æˆ‘ä»¬å¯¹äºè¿™ä¸¤ä¸ª Service ä¹Ÿä¸è®²è§£äº†ï¼Œä½†è€ç‰ˆæœ¬ä¸­è¿˜æ˜¯æœ‰è¿™ä¸¤ä¸ª Serviceï¼ŒåŒå­¦ä»¬éœ€è¦äº†è§£ä¸€ä¸‹</p>
<h2 id="42-activiticfgxml"><a class="markdownIt-Anchor" href="#42-activiticfgxml">#</a> 4.2 activiti.cfg.xml</h2>
<p>activiti çš„å¼•æ“é…ç½®æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼šProcessEngineConfiguration çš„å®šä¹‰ã€æ•°æ®æºå®šä¹‰ã€äº‹åŠ¡ç®¡ç†å™¨ç­‰ï¼Œæ­¤æ–‡ä»¶å…¶å®å°±æ˜¯ä¸€ä¸ª spring é…ç½®æ–‡ä»¶ã€‚</p>
<h2 id="43-æµç¨‹å¼•æ“é…ç½®ç±»"><a class="markdownIt-Anchor" href="#43-æµç¨‹å¼•æ“é…ç½®ç±»">#</a> 4.3 æµç¨‹å¼•æ“é…ç½®ç±»</h2>
<p>æµç¨‹å¼•æ“çš„é…ç½®ç±»ï¼ˆProcessEngineConfigurationï¼‰ï¼Œé€šè¿‡ ProcessEngineConfiguration å¯ä»¥åˆ›å»ºå·¥ä½œæµå¼•æ“ ProceccEngineï¼Œå¸¸ç”¨çš„ä¸¤ç§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<h3 id="431-standaloneprocessengineconfiguration"><a class="markdownIt-Anchor" href="#431-standaloneprocessengineconfiguration">#</a> 4.3.1 StandaloneProcessEngineConfiguration</h3>
<p>ä½¿ç”¨ StandaloneProcessEngineConfigurationActiviti å¯ä»¥å•ç‹¬è¿è¡Œï¼Œæ¥åˆ›å»º ProcessEngineï¼ŒActiviti ä¼šè‡ªå·±å¤„ç†äº‹åŠ¡ã€‚</p>
<p>é…ç½®æ–‡ä»¶æ–¹å¼ï¼š</p>
<p>é€šå¸¸åœ¨ activiti.cfg.xml é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ª id ä¸º processEngineConfiguration çš„ bean.</p>
<p>æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--é…ç½®æ•°æ®åº“ç›¸å…³çš„ä¿¡æ¯--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“é©±åŠ¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcDriver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“é“¾æ¥--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“ç”¨æˆ·å--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUsername&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“å¯†ç --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcPassword&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--actvitiæ•°æ®åº“è¡¨åœ¨ç”Ÿæˆæ—¶çš„ç­–ç•¥  true - å¦‚æœæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ç›¸åº”çš„è¡¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šåˆ›å»º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¿˜å¯ä»¥åŠ å…¥è¿æ¥æ± :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åœ¨é»˜è®¤æ–¹å¼ä¸‹ beançš„id  å›ºå®šä¸º processEngineConfiguration--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¼•å…¥ä¸Šé¢é…ç½®å¥½çš„ é“¾æ¥æ± --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--actvitiæ•°æ®åº“è¡¨åœ¨ç”Ÿæˆæ—¶çš„ç­–ç•¥  true - å¦‚æœæ•°æ®åº“ä¸­å·²ç»å­˜åœ¨ç›¸åº”çš„è¡¨ï¼Œé‚£ä¹ˆç›´æ¥ä½¿ç”¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä¼šåˆ›å»º--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="432-springprocessengineconfiguration"><a class="markdownIt-Anchor" href="#432-springprocessengineconfiguration">#</a> 4.3.2 SpringProcessEngineConfiguration</h3>
<p>é€šè¿‡<strong> org.activiti.spring.SpringProcessEngineConfiguration ä¸</strong> Spring æ•´åˆã€‚</p>
<p>åˆ›å»º spring ä¸ activiti çš„æ•´åˆé…ç½®æ–‡ä»¶ï¼š</p>
<p>activity-spring.cfg.xmlï¼ˆåç§°å¯ä¿®æ”¹ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/beans/spring-beans-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/aop/spring-aop-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/tx/spring-tx-3.1.xsd &quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å·¥ä½œæµå¼•æ“é…ç½®bean --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- ä½¿ç”¨springäº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- æ•°æ®åº“ç­–ç•¥ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;drop-create&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- activitiçš„å®šæ—¶ä»»åŠ¡å…³é—­ --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobExecutorActivate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æµç¨‹å¼•æ“ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- èµ„æºæœåŠ¡service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;repositoryService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getRepositoryService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æµç¨‹è¿è¡Œservice --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runtimeService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getRuntimeService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- ä»»åŠ¡ç®¡ç†service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taskService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getTaskService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å†å²ç®¡ç†service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;historyService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getHistoryService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- ç”¨æˆ·ç®¡ç†service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;identityService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getIdentityService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- å¼•æ“ç®¡ç†service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;managementService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getManagementService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- æ•°æ®æº --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/activiti&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- é€šçŸ¥ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- ä¼ æ’­è¡Œä¸º --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;save*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- åˆ‡é¢ï¼Œæ ¹æ®å…·ä½“é¡¹ç›®ä¿®æ”¹åˆ‡ç‚¹é…ç½® --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span>  <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.itheima.ihrm.service.impl.*.(..))&quot;</span>* /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºprocessengineconfiguration"><a class="markdownIt-Anchor" href="#åˆ›å»ºprocessengineconfiguration">#</a> åˆ›å»º processEngineConfiguration</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹çš„ä»£ç è¦æ±‚ activiti.cfg.xml ä¸­å¿…é¡»æœ‰ä¸€ä¸ª processEngineConfiguration çš„ bean</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹è¾¹çš„æ–¹æ³•ï¼Œæ›´æ”¹ bean çš„åå­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);</span><br></pre></td></tr></table></figure>
<h2 id="44-å·¥ä½œæµå¼•æ“åˆ›å»º"><a class="markdownIt-Anchor" href="#44-å·¥ä½œæµå¼•æ“åˆ›å»º">#</a> 4.4 å·¥ä½œæµå¼•æ“åˆ›å»º</h2>
<p>å·¥ä½œæµå¼•æ“ï¼ˆProcessEngineï¼‰ï¼Œç›¸å½“äºä¸€ä¸ªé—¨é¢æ¥å£ï¼Œé€šè¿‡ ProcessEngineConfiguration åˆ›å»º processEngineï¼Œé€šè¿‡ ProcessEngine åˆ›å»ºå„ä¸ª service æ¥å£ã€‚</p>
<h3 id="441-é»˜è®¤åˆ›å»ºæ–¹å¼"><a class="markdownIt-Anchor" href="#441-é»˜è®¤åˆ›å»ºæ–¹å¼">#</a> 4.4.1 é»˜è®¤åˆ›å»ºæ–¹å¼</h3>
<p>å°† activiti.cfg.xml æ–‡ä»¶ååŠè·¯å¾„å›ºå®šï¼Œä¸” activiti.cfg.xml æ–‡ä»¶ä¸­æœ‰ processEngineConfiguration çš„é…ç½®ï¼Œ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç åˆ›å»º processEngine:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç›´æ¥ä½¿ç”¨å·¥å…·ç±» ProcessEnginesï¼Œä½¿ç”¨classpathä¸‹çš„activiti.cfg.xmlä¸­çš„é…ç½®åˆ›å»ºprocessEngine</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">System.out.println(processEngine);</span><br></pre></td></tr></table></figure>
<h3 id="442-ä¸€èˆ¬åˆ›å»ºæ–¹å¼"><a class="markdownIt-Anchor" href="#442-ä¸€èˆ¬åˆ›å»ºæ–¹å¼">#</a> 4.4.2 ä¸€èˆ¬åˆ›å»ºæ–¹å¼</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…ˆæ„å»ºProcessEngineConfiguration</span></span><br><span class="line"><span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>);</span><br><span class="line"><span class="comment">//é€šè¿‡ProcessEngineConfigurationåˆ›å»ºProcessEngineï¼Œæ­¤æ—¶ä¼šåˆ›å»ºæ•°æ®åº“</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br></pre></td></tr></table></figure>
<h2 id="45-servcieæœåŠ¡æ¥å£"><a class="markdownIt-Anchor" href="#45-servcieæœåŠ¡æ¥å£">#</a> 4.5 Servcie æœåŠ¡æ¥å£</h2>
<p>Service æ˜¯å·¥ä½œæµå¼•æ“æä¾›ç”¨äºè¿›è¡Œå·¥ä½œæµéƒ¨ç½²ã€æ‰§è¡Œã€ç®¡ç†çš„æœåŠ¡æ¥å£ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›æ¥å£å¯ä»¥å°±æ˜¯æ“ä½œæœåŠ¡å¯¹åº”çš„æ•°æ®è¡¨</p>
<h3 id="451-serviceåˆ›å»ºæ–¹å¼"><a class="markdownIt-Anchor" href="#451-serviceåˆ›å»ºæ–¹å¼">#</a> 4.5.1 Service åˆ›å»ºæ–¹å¼</h3>
<p>é€šè¿‡ ProcessEngine åˆ›å»º Service</p>
<p>æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"><span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br></pre></td></tr></table></figure>
<h3 id="452-serviceæ€»è§ˆ"><a class="markdownIt-Anchor" href="#452-serviceæ€»è§ˆ">#</a> 4.5.2 Service æ€»è§ˆ</h3>
<table>
<thead>
<tr>
<th>service åç§°</th>
<th>service ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>RepositoryService</td>
<td>activiti çš„èµ„æºç®¡ç†ç±»</td>
</tr>
<tr>
<td>RuntimeService</td>
<td>activiti çš„æµç¨‹è¿è¡Œç®¡ç†ç±»</td>
</tr>
<tr>
<td>TaskService</td>
<td>activiti çš„ä»»åŠ¡ç®¡ç†ç±»</td>
</tr>
<tr>
<td>HistoryService</td>
<td>activiti çš„å†å²ç®¡ç†ç±»</td>
</tr>
<tr>
<td>ManagerService</td>
<td>activiti çš„å¼•æ“ç®¡ç†ç±»</td>
</tr>
</tbody>
</table>
<p>ç®€å•ä»‹ç»ï¼š</p>
<p><strong>RepositoryService</strong></p>
<p>æ˜¯ activiti çš„èµ„æºç®¡ç†ç±»ï¼Œæä¾›äº†ç®¡ç†å’Œæ§åˆ¶æµç¨‹å‘å¸ƒåŒ…å’Œæµç¨‹å®šä¹‰çš„æ“ä½œã€‚ä½¿ç”¨å·¥ä½œæµå»ºæ¨¡å·¥å…·è®¾è®¡çš„ä¸šåŠ¡æµç¨‹å›¾éœ€è¦ä½¿ç”¨æ­¤ service å°†æµç¨‹å®šä¹‰æ–‡ä»¶çš„å†…å®¹éƒ¨ç½²åˆ°è®¡ç®—æœºã€‚</p>
<p>é™¤äº†éƒ¨ç½²æµç¨‹å®šä¹‰ä»¥å¤–è¿˜å¯ä»¥ï¼šæŸ¥è¯¢å¼•æ“ä¸­çš„å‘å¸ƒåŒ…å’Œæµç¨‹å®šä¹‰ã€‚</p>
<p>æš‚åœæˆ–æ¿€æ´»å‘å¸ƒåŒ…ï¼Œå¯¹åº”å…¨éƒ¨å’Œç‰¹å®šæµç¨‹å®šä¹‰ã€‚ æš‚åœæ„å‘³ç€å®ƒä»¬ä¸èƒ½å†æ‰§è¡Œä»»ä½•æ“ä½œäº†ï¼Œæ¿€æ´»æ˜¯å¯¹åº”çš„åå‘æ“ä½œã€‚è·å¾—å¤šç§èµ„æºï¼Œåƒæ˜¯åŒ…å«åœ¨å‘å¸ƒåŒ…é‡Œçš„æ–‡ä»¶ï¼Œ æˆ–å¼•æ“è‡ªåŠ¨ç”Ÿæˆçš„æµç¨‹å›¾ã€‚</p>
<p>è·å¾—æµç¨‹å®šä¹‰çš„ pojo ç‰ˆæœ¬ï¼Œ å¯ä»¥ç”¨æ¥é€šè¿‡ java è§£ææµç¨‹ï¼Œè€Œä¸å¿…é€šè¿‡ xmlã€‚</p>
<h4 id="runtimeservice"><a class="markdownIt-Anchor" href="#runtimeservice">#</a> RuntimeService</h4>
<p>Activiti çš„æµç¨‹è¿è¡Œç®¡ç†ç±»ã€‚å¯ä»¥ä»è¿™ä¸ªæœåŠ¡ç±»ä¸­è·å–å¾ˆå¤šå…³äºæµç¨‹æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯</p>
<h4 id="taskservice"><a class="markdownIt-Anchor" href="#taskservice">#</a> TaskService</h4>
<p>Activiti çš„ä»»åŠ¡ç®¡ç†ç±»ã€‚å¯ä»¥ä»è¿™ä¸ªç±»ä¸­è·å–ä»»åŠ¡çš„ä¿¡æ¯ã€‚</p>
<h4 id="historyservice"><a class="markdownIt-Anchor" href="#historyservice">#</a> HistoryService</h4>
<p>Activiti çš„å†å²ç®¡ç†ç±»ï¼Œå¯ä»¥æŸ¥è¯¢å†å²ä¿¡æ¯ï¼Œæ‰§è¡Œæµç¨‹æ—¶ï¼Œå¼•æ“ä¼šä¿å­˜å¾ˆå¤šæ•°æ®ï¼ˆæ ¹æ®é…ç½®ï¼‰ï¼Œæ¯”å¦‚æµç¨‹å®ä¾‹å¯åŠ¨æ—¶é—´ï¼Œä»»åŠ¡çš„å‚ä¸è€…ï¼Œ å®Œæˆä»»åŠ¡çš„æ—¶é—´ï¼Œæ¯ä¸ªæµç¨‹å®ä¾‹çš„æ‰§è¡Œè·¯å¾„ï¼Œç­‰ç­‰ã€‚ è¿™ä¸ªæœåŠ¡ä¸»è¦é€šè¿‡æŸ¥è¯¢åŠŸèƒ½æ¥è·å¾—è¿™äº›æ•°æ®ã€‚</p>
<h4 id="managementservice"><a class="markdownIt-Anchor" href="#managementservice">#</a> ManagementService</h4>
<p>Activiti çš„å¼•æ“ç®¡ç†ç±»ï¼Œæä¾›äº†å¯¹ Activiti æµç¨‹å¼•æ“çš„ç®¡ç†å’Œç»´æŠ¤åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸åœ¨å·¥ä½œæµé©±åŠ¨çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ï¼Œä¸»è¦ç”¨äº Activiti ç³»ç»Ÿçš„æ—¥å¸¸ç»´æŠ¤ã€‚</p>
<h1 id="äº”-activitiå…¥é—¨"><a class="markdownIt-Anchor" href="#äº”-activitiå…¥é—¨">#</a> äº”ã€Activiti å…¥é—¨</h1>
<p>åœ¨æœ¬ç« å†…å®¹ä¸­ï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª Activiti å·¥ä½œæµï¼Œå¹¶å¯åŠ¨è¿™ä¸ªæµç¨‹ã€‚</p>
<p>åˆ›å»º Activiti å·¥ä½œæµä¸»è¦åŒ…å«ä»¥ä¸‹å‡ æ­¥ï¼š</p>
<p>1ã€å®šä¹‰æµç¨‹ï¼ŒæŒ‰ç…§ BPMN çš„è§„èŒƒï¼Œä½¿ç”¨æµç¨‹å®šä¹‰å·¥å…·ï¼Œç”¨<strong>æµç¨‹ç¬¦å·</strong>æŠŠæ•´ä¸ªæµç¨‹æè¿°å‡ºæ¥</p>
<p>2ã€éƒ¨ç½²æµç¨‹ï¼ŒæŠŠç”»å¥½çš„æµç¨‹å®šä¹‰æ–‡ä»¶ï¼ŒåŠ è½½åˆ°æ•°æ®åº“ä¸­ï¼Œç”Ÿæˆè¡¨çš„æ•°æ®</p>
<p>3ã€å¯åŠ¨æµç¨‹ï¼Œä½¿ç”¨ java ä»£ç æ¥æ“ä½œæ•°æ®åº“è¡¨ä¸­çš„å†…å®¹</p>
<h2 id="51-æµç¨‹ç¬¦å·"><a class="markdownIt-Anchor" href="#51-æµç¨‹ç¬¦å·">#</a> 5.1 æµç¨‹ç¬¦å·</h2>
<p>BPMN 2.0 æ˜¯ä¸šåŠ¡æµç¨‹å»ºæ¨¡ç¬¦å· 2.0 çš„ç¼©å†™ã€‚</p>
<p>å®ƒç”± Business Process Management Initiative è¿™ä¸ªéè¥åˆ©åä¼šåˆ›å»ºå¹¶ä¸æ–­å‘å±•ã€‚ä½œä¸ºä¸€ç§æ ‡è¯†ï¼ŒBPMN 2.0 æ˜¯ä½¿ç”¨ä¸€äº›<strong>ç¬¦å·</strong>æ¥æ˜ç¡®ä¸šåŠ¡æµç¨‹è®¾è®¡æµç¨‹å›¾çš„ä¸€æ•´å¥—ç¬¦å·è§„èŒƒï¼Œå®ƒèƒ½å¢è¿›ä¸šåŠ¡å»ºæ¨¡æ—¶çš„æ²Ÿé€šæ•ˆç‡ã€‚</p>
<p>ç›®å‰ BPMN2.0 æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå®ƒç”¨äºåœ¨ BPM ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œå¸ƒå±€å’Œå¯è§†åŒ–çš„æ²Ÿé€šã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥äº†è§£åœ¨æµç¨‹è®¾è®¡ä¸­å¸¸è§çš„ ç¬¦å·ã€‚</p>
<p>BPMN2.0 çš„<strong>åŸºæœ¬ç¬¦åˆ</strong>ä¸»è¦åŒ…å«ï¼š</p>
<h3 id="äº‹ä»¶-event"><a class="markdownIt-Anchor" href="#äº‹ä»¶-event">#</a> äº‹ä»¶ Event</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/55da0d46ad4664bec6f38a53aec9e98f.png" alt="1574522151044"></p>
<h3 id="æ´»åŠ¨-activity"><a class="markdownIt-Anchor" href="#æ´»åŠ¨-activity">#</a> æ´»åŠ¨ Activity</h3>
<p>æ´»åŠ¨æ˜¯å·¥ä½œæˆ–ä»»åŠ¡çš„ä¸€ä¸ªé€šç”¨æœ¯è¯­ã€‚ä¸€ä¸ªæ´»åŠ¨å¯ä»¥æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼Œè¿˜å¯ä»¥æ˜¯ä¸€ä¸ªå½“å‰æµç¨‹çš„å­å¤„ç†æµç¨‹ï¼› å…¶æ¬¡ï¼Œä½ è¿˜å¯ä»¥ä¸ºæ´»åŠ¨æŒ‡å®šä¸åŒçš„ç±»å‹ã€‚å¸¸è§æ´»åŠ¨å¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fa7d32728f189f729285e260a68c966b.png" alt="1574562726375"></p>
<h3 id="ç½‘å…³-gateway"><a class="markdownIt-Anchor" href="#ç½‘å…³-gateway">#</a> ç½‘å…³ GateWay</h3>
<p>ç½‘å…³ç”¨æ¥å¤„ç†å†³ç­–ï¼Œæœ‰å‡ ç§å¸¸ç”¨ç½‘å…³éœ€è¦äº†è§£ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4e671fa1ca691aae89fcba2f6cd9c7f4.png" alt="1574563600305"></p>
<h4 id="æ’ä»–ç½‘å…³-x"><a class="markdownIt-Anchor" href="#æ’ä»–ç½‘å…³-x">#</a> æ’ä»–ç½‘å…³ (x)</h4>
<p>â€”â€” åªæœ‰ä¸€æ¡è·¯å¾„ä¼šè¢«é€‰æ‹©ã€‚æµç¨‹æ‰§è¡Œåˆ°è¯¥ç½‘å…³æ—¶ï¼ŒæŒ‰ç…§è¾“å‡ºæµçš„é¡ºåºé€ä¸ªè®¡ç®—ï¼Œå½“æ¡ä»¶çš„è®¡ç®—ç»“æœä¸º true æ—¶ï¼Œç»§ç»­æ‰§è¡Œå½“å‰ç½‘å…³çš„è¾“å‡ºæµï¼›</p>
<p>å¦‚æœå¤šæ¡çº¿è·¯è®¡ç®—ç»“æœéƒ½æ˜¯ trueï¼Œåˆ™ä¼šæ‰§è¡Œç¬¬ä¸€ä¸ªå€¼ä¸º true çš„çº¿è·¯ã€‚å¦‚æœæ‰€æœ‰ç½‘å…³è®¡ç®—ç»“æœæ²¡æœ‰ trueï¼Œåˆ™å¼•æ“ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æ’ä»–ç½‘å…³éœ€è¦å’Œæ¡ä»¶é¡ºåºæµç»“åˆä½¿ç”¨ï¼Œdefault å±æ€§æŒ‡å®šé»˜è®¤é¡ºåºæµï¼Œå½“æ‰€æœ‰çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ä¼šæ‰§è¡Œé»˜è®¤é¡ºåºæµã€‚</p>
<h4 id="å¹¶è¡Œç½‘å…³"><a class="markdownIt-Anchor" href="#å¹¶è¡Œç½‘å…³">#</a> å¹¶è¡Œç½‘å…³ (+)</h4>
<p>â€”â€” æ‰€æœ‰è·¯å¾„ä¼šè¢«åŒæ—¶é€‰æ‹©</p>
<p>æ‹†åˆ† â€”â€” å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰è¾“å‡ºé¡ºåºæµï¼Œä¸ºæ¯ä¸€æ¡é¡ºåºæµåˆ›å»ºä¸€ä¸ªå¹¶è¡Œæ‰§è¡Œçº¿è·¯ã€‚</p>
<p>åˆå¹¶ â€”â€” æ‰€æœ‰ä»å¹¶è¡Œç½‘å…³æ‹†åˆ†å¹¶æ‰§è¡Œå®Œæˆçš„çº¿è·¯å‡åœ¨æ­¤ç­‰å€™ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿è·¯éƒ½æ‰§è¡Œå®Œæˆæ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p>
<h4 id="åŒ…å®¹ç½‘å…³"><a class="markdownIt-Anchor" href="#åŒ…å®¹ç½‘å…³">#</a> åŒ…å®¹ç½‘å…³ (+)</h4>
<p>â€”â€” å¯ä»¥åŒæ—¶æ‰§è¡Œå¤šæ¡çº¿è·¯ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘å…³ä¸Šè®¾ç½®æ¡ä»¶</p>
<p>æ‹†åˆ† â€”â€” è®¡ç®—æ¯æ¡çº¿è·¯ä¸Šçš„è¡¨è¾¾å¼ï¼Œå½“è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸º true æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå¹¶è¡Œçº¿è·¯å¹¶ç»§ç»­æ‰§è¡Œ</p>
<p>åˆå¹¶ â€”â€” æ‰€æœ‰ä»å¹¶è¡Œç½‘å…³æ‹†åˆ†å¹¶æ‰§è¡Œå®Œæˆçš„çº¿è·¯å‡åœ¨æ­¤ç­‰å€™ï¼Œç›´åˆ°æ‰€æœ‰çš„çº¿è·¯éƒ½æ‰§è¡Œå®Œæˆæ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p>
<h4 id="äº‹ä»¶ç½‘å…³"><a class="markdownIt-Anchor" href="#äº‹ä»¶ç½‘å…³">#</a> äº‹ä»¶ç½‘å…³ (+)</h4>
<p>â€”â€” ä¸“é—¨ä¸ºä¸­é—´æ•è·äº‹ä»¶è®¾ç½®çš„ï¼Œå…è®¸è®¾ç½®å¤šä¸ªè¾“å‡ºæµæŒ‡å‘å¤šä¸ªä¸åŒçš„ä¸­é—´æ•è·äº‹ä»¶ã€‚å½“æµç¨‹æ‰§è¡Œåˆ°äº‹ä»¶ç½‘å…³åï¼Œæµç¨‹å¤„äºç­‰å¾…çŠ¶æ€ï¼Œéœ€è¦ç­‰å¾…æŠ›å‡ºäº‹ä»¶æ‰èƒ½å°†ç­‰å¾…çŠ¶æ€è½¬æ¢ä¸ºæ´»åŠ¨çŠ¶æ€ã€‚</p>
<h3 id="æµå‘-flow"><a class="markdownIt-Anchor" href="#æµå‘-flow">#</a> æµå‘ <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Flow&amp;spm=1001.2101.3001.7020">Flow</a></h3>
<p>æµæ˜¯è¿æ¥ä¸¤ä¸ªæµç¨‹èŠ‚ç‚¹çš„è¿çº¿ã€‚å¸¸è§çš„æµå‘åŒ…å«ä»¥ä¸‹å‡ ç§ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3628cf5044d11d8aa723d8d62de112a9.png" alt="1574563937457"></p>
<h2 id="52-æµç¨‹è®¾è®¡å™¨ä½¿ç”¨"><a class="markdownIt-Anchor" href="#52-æµç¨‹è®¾è®¡å™¨ä½¿ç”¨">#</a> 5.2 æµç¨‹è®¾è®¡å™¨ä½¿ç”¨</h2>
<h3 id="activiti-designerä½¿ç”¨"><a class="markdownIt-Anchor" href="#activiti-designerä½¿ç”¨">#</a> Activiti-Designer ä½¿ç”¨</h3>
<h4 id="paletteç”»æ¿"><a class="markdownIt-Anchor" href="#paletteç”»æ¿">#</a> Paletteï¼ˆç”»æ¿ï¼‰</h4>
<p>åœ¨ idea ä¸­å®‰è£…æ’ä»¶å³å¯ä½¿ç”¨ï¼Œç”»æ¿ä¸­åŒ…æ‹¬ä»¥ä¸‹ç»“ç‚¹ï¼š</p>
<p>Connectionâ€” è¿æ¥</p>
<p>Eventâ€” äº‹ä»¶</p>
<p>Taskâ€” ä»»åŠ¡</p>
<p>Gatewayâ€” ç½‘å…³</p>
<p>Containerâ€” å®¹å™¨</p>
<p>Boundary eventâ€” è¾¹ç•Œäº‹ä»¶</p>
<p>Intermediate event- - ä¸­é—´äº‹ä»¶</p>
<p>æµç¨‹å›¾è®¾è®¡å®Œæ¯•ä¿å­˜ç”Ÿæˆ.bpmn æ–‡ä»¶</p>
<h4 id="æ–°å»ºæµç¨‹ideaå·¥å…·"><a class="markdownIt-Anchor" href="#æ–°å»ºæµç¨‹ideaå·¥å…·">#</a> æ–°å»ºæµç¨‹ (IDEA å·¥å…·)</h4>
<p>é¦–å…ˆé€‰ä¸­å­˜æ”¾å›¾å½¢çš„ç›®å½• (é€‰æ‹© resources ä¸‹çš„ bpmn ç›®å½•)ï¼Œç‚¹å‡»èœå•ï¼šNew -&gt; BpmnFileï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a29cab07f2cdeeecf23a121b955f1f38.png" alt="1575106985823"></p>
<p>å¼¹å‡ºå¦‚ä¸‹å›¾æ‰€ç¤ºæ¡†ï¼Œè¾“å…¥ evection è¡¨ç¤º å‡ºå·®å®¡æ‰¹æµç¨‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b73038594eb6a617ab01d06ecd67d71f.png" alt="1575107231004"></p>
<p>èµ·å®Œåå­— evection åï¼ˆé»˜è®¤æ‰©å±•åä¸º bpmnï¼‰ï¼Œå°±å¯ä»¥çœ‹åˆ°æµç¨‹è®¾è®¡é¡µé¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5e11bd3ce21ca2170f3aab1954de69af.png" alt="1575107336431"></p>
<p>å·¦ä¾§åŒºåŸŸæ˜¯ç»˜å›¾åŒºï¼Œå³ä¾§åŒºåŸŸæ˜¯ palette ç”»æ¿åŒºåŸŸ</p>
<p>é¼ æ ‡å…ˆç‚¹å‡»ç”»æ¿çš„å…ƒç´ å³å¯åœ¨å·¦ä¾§ç»˜å›¾</p>
<h3 id="ç»˜åˆ¶æµç¨‹"><a class="markdownIt-Anchor" href="#ç»˜åˆ¶æµç¨‹">#</a> ç»˜åˆ¶æµç¨‹</h3>
<p>ä½¿ç”¨æ»‘æ¿æ¥ç»˜åˆ¶æµç¨‹ï¼Œé€šè¿‡ä»å³ä¾§æŠŠå›¾æ ‡æ‹–æ‹½åˆ°å·¦ä¾§çš„ç”»æ¿ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1938218ad58d78c29863e3c3cbaf13ac.png" alt="1575107648105"></p>
<h3 id="æŒ‡å®šæµç¨‹å®šä¹‰key"><a class="markdownIt-Anchor" href="#æŒ‡å®šæµç¨‹å®šä¹‰key">#</a> æŒ‡å®šæµç¨‹å®šä¹‰ Key</h3>
<p>æµç¨‹å®šä¹‰ key å³æµç¨‹å®šä¹‰çš„æ ‡è¯†ï¼Œé€šè¿‡ properties è§†å›¾æŸ¥çœ‹æµç¨‹çš„ key</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/80e8ed41d420a613bb3601866bccc0b3.png" alt="1575115474865"></p>
<h3 id="æŒ‡å®šä»»åŠ¡è´Ÿè´£äºº"><a class="markdownIt-Anchor" href="#æŒ‡å®šä»»åŠ¡è´Ÿè´£äºº">#</a> æŒ‡å®šä»»åŠ¡è´Ÿè´£äºº</h3>
<p>åœ¨ properties è§†å›¾æŒ‡å®šæ¯ä¸ªä»»åŠ¡ç»“ç‚¹çš„è´Ÿè´£äººï¼Œå¦‚ï¼šå¡«å†™å‡ºå·®ç”³è¯·çš„è´Ÿè´£äººä¸º zhangsan</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f5c59207b9f63ed98c0b14b07c35e172.png" alt="1575121491752"></p>
<p>ç»ç†å®¡æ‰¹è´Ÿè´£äººä¸º jerry</p>
<p>æ€»ç»ç†å®¡æ‰¹è´Ÿè´£äººä¸º jack</p>
<p>è´¢åŠ¡å®¡æ‰¹è´Ÿè´£äººä¸º rose</p>
<h1 id="å…­-æµç¨‹æ“ä½œ"><a class="markdownIt-Anchor" href="#å…­-æµç¨‹æ“ä½œ">#</a> å…­ã€æµç¨‹æ“ä½œ</h1>
<h2 id="61-æµç¨‹å®šä¹‰"><a class="markdownIt-Anchor" href="#61-æµç¨‹å®šä¹‰">#</a> 6.1 æµç¨‹å®šä¹‰</h2>
<h3 id="æ¦‚è¿°"><a class="markdownIt-Anchor" href="#æ¦‚è¿°">#</a> æ¦‚è¿°</h3>
<p>æµç¨‹å®šä¹‰æ˜¯çº¿ä¸‹æŒ‰ç…§ bpmn2.0 æ ‡å‡†å»æè¿° ä¸šåŠ¡æµç¨‹ï¼Œé€šå¸¸ä½¿ç”¨ idea ä¸­çš„æ’ä»¶å¯¹ä¸šåŠ¡æµç¨‹è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>ä½¿ç”¨ idea ä¸‹çš„ designer è®¾è®¡å™¨ç»˜åˆ¶æµç¨‹ï¼Œå¹¶ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š.bpmn å’Œ.png</p>
<h3 id="bpmnæ–‡ä»¶"><a class="markdownIt-Anchor" href="#bpmnæ–‡ä»¶">#</a> .bpmn æ–‡ä»¶</h3>
<p>ä½¿ç”¨ activiti-desinger è®¾è®¡ä¸šåŠ¡æµç¨‹ï¼Œä¼šç”Ÿæˆ.bpmn æ–‡ä»¶ï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»åˆ›å»ºå¥½äº† bpmn æ–‡ä»¶</p>
<p>BPMN 2.0 æ ¹èŠ‚ç‚¹æ˜¯ definitions èŠ‚ç‚¹ã€‚ è¿™ä¸ªå…ƒç´ ä¸­ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªæµç¨‹å®šä¹‰ï¼ˆä¸è¿‡æˆ‘ä»¬å»ºè®®æ¯ä¸ªæ–‡ä»¶åªåŒ…å«ä¸€ä¸ªæµç¨‹å®šä¹‰ï¼Œ å¯ä»¥ç®€åŒ–å¼€å‘è¿‡ç¨‹ä¸­çš„ç»´æŠ¤éš¾åº¦ï¼‰ã€‚ æ³¨æ„ï¼Œdefinitions å…ƒç´  æœ€å°‘ä¹Ÿè¦åŒ…å« xmlns å’Œ targetNamespace çš„å£°æ˜ã€‚ targetNamespace å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œå®ƒç”¨æ¥å¯¹æµç¨‹å®ä¾‹è¿›è¡Œåˆ†ç±»ã€‚</p>
<p>æµç¨‹å®šä¹‰éƒ¨åˆ†ï¼šå®šä¹‰äº†æµç¨‹æ¯ä¸ªç»“ç‚¹çš„æè¿°åŠç»“ç‚¹ä¹‹é—´çš„æµç¨‹æµè½¬ã€‚</p>
<p>æµç¨‹å¸ƒå±€å®šä¹‰ï¼šå®šä¹‰æµç¨‹æ¯ä¸ªç»“ç‚¹åœ¨æµç¨‹å›¾ä¸Šçš„ä½ç½®åæ ‡ç­‰ä¿¡æ¯ã€‚</p>
<h3 id="ç”Ÿæˆpngå›¾ç‰‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ç”Ÿæˆpngå›¾ç‰‡æ–‡ä»¶">#</a> ç”Ÿæˆ.png å›¾ç‰‡æ–‡ä»¶</h3>
<p>IDEA å·¥å…·ä¸­çš„æ“ä½œæ–¹å¼</p>
<h4 id="1-ä¿®æ”¹æ–‡ä»¶åç¼€ä¸ºxml"><a class="markdownIt-Anchor" href="#1-ä¿®æ”¹æ–‡ä»¶åç¼€ä¸ºxml">#</a> 1ã€ä¿®æ”¹æ–‡ä»¶åç¼€ä¸º xml</h4>
<p>é¦–å…ˆå°† evection.bpmn æ–‡ä»¶æ”¹åä¸º evection.xmlï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/68e0b7ef038641fe75c8b4789bc9fd82.png" alt="1575108966935"></p>
<p>evection.xml ä¿®æ”¹å‰çš„ bpmn æ–‡ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210624233410152.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h4 id="2-ä½¿ç”¨designerè®¾è®¡å™¨æ‰“å¼€xmlæ–‡ä»¶"><a class="markdownIt-Anchor" href="#2-ä½¿ç”¨designerè®¾è®¡å™¨æ‰“å¼€xmlæ–‡ä»¶">#</a> 2ã€ä½¿ç”¨ designer è®¾è®¡å™¨æ‰“å¼€.xml æ–‡ä»¶</h4>
<p>åœ¨ evection.xml æ–‡ä»¶ä¸Šé¢ï¼Œç‚¹å³é”®å¹¶é€‰æ‹© Diagrams èœå•ï¼Œå†é€‰æ‹© Show BPMN2.0 Designerâ€¦</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/56cf4c6dbe90593db85bff1b5c0b10dc.png" alt="1575109268443"></p>
<h4 id="3-æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶"><a class="markdownIt-Anchor" href="#3-æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶">#</a> 3ã€æŸ¥çœ‹æ‰“å¼€çš„æ–‡ä»¶</h4>
<p>æ‰“å¼€åï¼Œå´å‡ºç°ä¹±ç ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/98adf795b3a3c57761fc49084a28af51.png" alt="1575109366989"></p>
<h4 id="4-è§£å†³ä¸­æ–‡ä¹±ç "><a class="markdownIt-Anchor" href="#4-è§£å†³ä¸­æ–‡ä¹±ç ">#</a> 4ã€è§£å†³ä¸­æ–‡ä¹±ç </h4>
<p>1ã€æ‰“å¼€ Settingsï¼Œæ‰¾åˆ° File Encodingsï¼ŒæŠŠ encoding çš„é€‰é¡¹éƒ½é€‰æ‹© UTF-8</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/223fbee930641ac8f6d65a467a5d36c2.png" alt="1575112075626"></p>
<p>2ã€æ‰“å¼€ IDEA å®‰è£…è·¯å¾„ï¼Œæ‰¾åˆ°å¦‚ä¸‹çš„å®‰è£…ç›®å½•</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4a5e3f122c63db4551f7e675fd36fa4e.png" alt="1575109627745"></p>
<p>æ ¹æ®è‡ªå·±æ‰€å®‰è£…çš„ç‰ˆæœ¬æ¥å†³å®šï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ 64 ä½çš„ ideaï¼Œæ‰€ä»¥åœ¨ idea64.exe.vmoptions æ–‡ä»¶çš„æœ€åä¸€è¡Œè¿½åŠ ä¸€æ¡å‘½ä»¤ï¼š -Dfile.encoding=UTF-8</p>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b393629505f3409a3aca9578840b8606.png" alt="https://images2017.cnblogs.com/blog/963440/201712/963440-20171221132445475-1259807908.png"></p>
<p>ä¸€å®šæ³¨æ„ï¼Œä¸è¦æœ‰ç©ºæ ¼ï¼Œå¦åˆ™é‡å¯ IDEA æ—¶ä¼šæ‰“ä¸å¼€ï¼Œç„¶å é‡å¯ IDEAã€‚</p>
<p>å¦‚æœä»¥ä¸Šæ–¹æ³•å·²ç»åšå®Œï¼Œè¿˜å‡ºç°ä¹±ç ï¼Œå°±å†ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ï¼š -Dfile.encoding=UTF-8ï¼Œç„¶åé‡å¯ ideaï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ff19450a5625b5ae625128507546bb3c.png" alt="1575113551947"></p>
<p>æœ€åé‡æ–°åœ¨ evection.xml æ–‡ä»¶ä¸Šé¢ï¼Œç‚¹å³é”®å¹¶é€‰æ‹© Diagrams èœå•ï¼Œå†é€‰æ‹© Show BPMN2.0 Designerâ€¦ï¼Œçœ‹åˆ°ç”Ÿæˆå›¾ç‰‡ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5b284f4d81d5207b8ea7e857f2f58ba1.png" alt="1575113951966"></p>
<p>åˆ°æ­¤ï¼Œè§£å†³ä¹±ç é—®é¢˜</p>
<h4 id="5-å¯¼å‡ºä¸ºå›¾ç‰‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#5-å¯¼å‡ºä¸ºå›¾ç‰‡æ–‡ä»¶">#</a> 5ã€å¯¼å‡ºä¸ºå›¾ç‰‡æ–‡ä»¶</h4>
<p>ç‚¹å‡» Export To File çš„å°å›¾æ ‡ï¼Œæ‰“å¼€å¦‚ä¸‹çª—å£ï¼Œæ³¨æ„å¡«å†™æ–‡ä»¶ååŠæ‰©å±•åï¼Œé€‰æ‹©å¥½ä¿å­˜å›¾ç‰‡çš„ä½ç½®ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/31410de865cf7a691087db4009d0fcd2.png" alt="1575114245068"></p>
<p>ç„¶åï¼Œæˆ‘ä»¬æŠŠ png æ–‡ä»¶æ‹·è´åˆ° resources ä¸‹çš„ bpmn ç›®å½•ï¼Œå¹¶ä¸”æŠŠ evection.xml æ”¹åä¸º evection.bpmnã€‚</p>
<h2 id="62-æµç¨‹å®šä¹‰éƒ¨ç½²"><a class="markdownIt-Anchor" href="#62-æµç¨‹å®šä¹‰éƒ¨ç½²">#</a> 6.2 æµç¨‹å®šä¹‰éƒ¨ç½²</h2>
<h3 id="æ¦‚è¿°-2"><a class="markdownIt-Anchor" href="#æ¦‚è¿°-2">#</a> æ¦‚è¿°</h3>
<p>å°†ä¸Šé¢åœ¨è®¾è®¡å™¨ä¸­å®šä¹‰çš„æµç¨‹éƒ¨ç½²åˆ° activiti æ•°æ®åº“ä¸­ï¼Œå°±æ˜¯æµç¨‹å®šä¹‰éƒ¨ç½²ã€‚</p>
<p>é€šè¿‡è°ƒç”¨ activiti çš„ api å°†æµç¨‹å®šä¹‰çš„ bpmn å’Œ png ä¸¤ä¸ªæ–‡ä»¶ä¸€ä¸ªä¸€ä¸ªæ·»åŠ éƒ¨ç½²åˆ° activiti ä¸­ï¼Œä¹Ÿå¯ä»¥å°†ä¸¤ä¸ªæ–‡ä»¶æ‰“æˆ zip åŒ…è¿›è¡Œéƒ¨ç½²ã€‚</p>
<h3 id="å•ä¸ªæ–‡ä»¶éƒ¨ç½²æ–¹å¼"><a class="markdownIt-Anchor" href="#å•ä¸ªæ–‡ä»¶éƒ¨ç½²æ–¹å¼">#</a> å•ä¸ªæ–‡ä»¶éƒ¨ç½²æ–¹å¼</h3>
<p>åˆ†åˆ«å°† bpmn æ–‡ä»¶å’Œ png å›¾ç‰‡æ–‡ä»¶éƒ¨ç½²ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivitiDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éƒ¨ç½²æµç¨‹å®šä¹‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeployment</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        1ã€åˆ›å»ºProcessEngine</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2ã€å¾—åˆ°RepositoryServiceå®ä¾‹</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3ã€ä½¿ç”¨RepositoryServiceè¿›è¡Œéƒ¨ç½²</span></span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.bpmn&quot;</span>) <span class="comment">// æ·»åŠ bpmnèµ„æº</span></span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.png&quot;</span>)  <span class="comment">// æ·»åŠ pngèµ„æº</span></span><br><span class="line">                .name(<span class="string">&quot;å‡ºå·®ç”³è¯·æµç¨‹&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line"><span class="comment">//        4ã€è¾“å‡ºéƒ¨ç½²ä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æµç¨‹éƒ¨ç½²idï¼š&quot;</span> + deployment.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;æµç¨‹éƒ¨ç½²åç§°ï¼š&quot;</span> + deployment.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ­¤æ“ä½œå activiti ä¼šå°†ä¸Šè¾¹ä»£ç ä¸­æŒ‡å®šçš„ bpm æ–‡ä»¶å’Œå›¾ç‰‡æ–‡ä»¶ä¿å­˜åœ¨ activiti æ•°æ®åº“ã€‚</p>
<h3 id="å‹ç¼©åŒ…éƒ¨ç½²æ–¹å¼"><a class="markdownIt-Anchor" href="#å‹ç¼©åŒ…éƒ¨ç½²æ–¹å¼">#</a> å‹ç¼©åŒ…éƒ¨ç½²æ–¹å¼</h3>
<p>å°† evection.bpmn å’Œ evection.png å‹ç¼©æˆ zip åŒ…ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcessByZip</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// å®šä¹‰zipè¾“å…¥æµ</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span></span><br><span class="line">				.getClass()</span><br><span class="line">				.getClassLoader()</span><br><span class="line">				.getResourceAsStream(</span><br><span class="line">						<span class="string">&quot;bpmn/evection.zip&quot;</span>);</span><br><span class="line">		<span class="type">ZipInputStream</span> <span class="variable">zipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(inputStream);</span><br><span class="line">		<span class="comment">// è·å–repositoryService</span></span><br><span class="line">		<span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine</span><br><span class="line">				.getRepositoryService();</span><br><span class="line">		<span class="comment">// æµç¨‹éƒ¨ç½²</span></span><br><span class="line">		<span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">				.addZipInputStream(zipInputStream)</span><br><span class="line">				.deploy();</span><br><span class="line">		System.out.println(<span class="string">&quot;æµç¨‹éƒ¨ç½²idï¼š&quot;</span> + deployment.getId());</span><br><span class="line">		System.out.println(<span class="string">&quot;æµç¨‹éƒ¨ç½²åç§°ï¼š&quot;</span> + deployment.getName());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ­¤æ“ä½œå activiti ä¼šå°†ä¸Šè¾¹ä»£ç ä¸­æŒ‡å®šçš„ bpm æ–‡ä»¶å’Œå›¾ç‰‡æ–‡ä»¶ä¿å­˜åœ¨ activiti æ•°æ®åº“ã€‚</p>
<h3 id="æ“ä½œæ•°æ®è¡¨"><a class="markdownIt-Anchor" href="#æ“ä½œæ•°æ®è¡¨">#</a> æ“ä½œæ•°æ®è¡¨</h3>
<p>æµç¨‹å®šä¹‰éƒ¨ç½²åæ“ä½œ activiti çš„ 3 å¼ è¡¨å¦‚ä¸‹ï¼š</p>
<p>act_re_deployment æµç¨‹å®šä¹‰éƒ¨ç½²è¡¨ï¼Œæ¯éƒ¨ç½²ä¸€æ¬¡å¢åŠ ä¸€æ¡è®°å½•</p>
<p>act_re_procdef æµç¨‹å®šä¹‰è¡¨ï¼Œéƒ¨ç½²æ¯ä¸ªæ–°çš„æµç¨‹å®šä¹‰éƒ½ä¼šåœ¨è¿™å¼ è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•</p>
<p>act_ge_bytearray æµç¨‹èµ„æºè¡¨</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå†™å…¥äº†ä»€ä¹ˆæ•°æ®ï¼š</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_re_deployment #æµç¨‹å®šä¹‰éƒ¨ç½²è¡¨ï¼Œè®°å½•æµç¨‹éƒ¨ç½²ä¿¡æ¯</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/bcf465a3c35a6e66e2ca075a0f793dd1.png" alt="1575116732147"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_re_procdef #æµç¨‹å®šä¹‰è¡¨ï¼Œè®°å½•æµç¨‹å®šä¹‰ä¿¡æ¯</span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p>æ³¨æ„ï¼ŒKEY è¿™ä¸ªå­—æ®µæ˜¯ç”¨æ¥å”¯ä¸€è¯†åˆ«ä¸åŒæµç¨‹çš„å…³é”®å­—</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f84eb1d97f90541675bd5a538b51d381.png" alt="1575116797665"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_ge_bytearray #èµ„æºè¡¨ </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»“æœï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210624233344315.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>æ³¨æ„ï¼š</p>
<p>act_re_deployment å’Œ act_re_procdef ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€æ¬¡éƒ¨ç½²åœ¨æµç¨‹éƒ¨ç½²è¡¨ç”Ÿæˆä¸€æ¡è®°å½•ï¼Œä½†ä¸€æ¬¡éƒ¨ç½²å¯ä»¥éƒ¨ç½²å¤šä¸ªæµç¨‹å®šä¹‰ï¼Œæ¯ä¸ªæµç¨‹å®šä¹‰åœ¨æµç¨‹å®šä¹‰è¡¨ç”Ÿæˆä¸€æ¡è®°å½•ã€‚æ¯ä¸€ä¸ªæµç¨‹å®šä¹‰åœ¨ act_ge_bytearray ä¼šå­˜åœ¨ä¸¤ä¸ªèµ„æºè®°å½•ï¼Œbpmn å’Œ pngã€‚</p>
<p>å»ºè®®ï¼šä¸€æ¬¡éƒ¨ç½²ä¸€ä¸ªæµç¨‹ï¼Œè¿™æ ·éƒ¨ç½²è¡¨å’Œæµç¨‹å®šä¹‰è¡¨æ˜¯ä¸€å¯¹ä¸€æœ‰å…³ç³»ï¼Œæ–¹ä¾¿è¯»å–æµç¨‹éƒ¨ç½²åŠæµç¨‹å®šä¹‰ä¿¡æ¯ã€‚</p>
<h2 id="63-å¯åŠ¨æµç¨‹å®ä¾‹"><a class="markdownIt-Anchor" href="#63-å¯åŠ¨æµç¨‹å®ä¾‹">#</a> 6.3 å¯åŠ¨æµç¨‹å®ä¾‹</h2>
<p>æµç¨‹å®šä¹‰éƒ¨ç½²åœ¨ activiti åå°±å¯ä»¥é€šè¿‡å·¥ä½œæµç®¡ç†ä¸šåŠ¡æµç¨‹äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šè¾¹éƒ¨ç½²çš„å‡ºå·®ç”³è¯·æµç¨‹å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p>é’ˆå¯¹è¯¥æµç¨‹ï¼Œå¯åŠ¨ä¸€ä¸ªæµç¨‹è¡¨ç¤ºå‘èµ·ä¸€ä¸ªæ–°çš„å‡ºå·®ç”³è¯·å•ï¼Œè¿™å°±ç›¸å½“äº java ç±»ä¸ java å¯¹è±¡çš„å…³ç³»ï¼Œç±»å®šä¹‰å¥½åéœ€è¦ new åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä½¿ç”¨ï¼Œå½“ç„¶å¯ä»¥ new å¤šä¸ªå¯¹è±¡ã€‚å¯¹äºè¯·å‡ºå·®ç”³è¯·æµç¨‹ï¼Œå¼ ä¸‰å‘èµ·ä¸€ä¸ªå‡ºå·®ç”³è¯·å•éœ€è¦å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹ï¼Œå‡ºå·®ç”³è¯·å•å‘èµ·ä¸€ä¸ªå‡ºå·®å•ä¹Ÿéœ€è¦å¯åŠ¨ä¸€ä¸ªæµç¨‹å®ä¾‹ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯åŠ¨æµç¨‹å®ä¾‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStartProcess</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        1ã€åˆ›å»ºProcessEngine</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2ã€è·å–RunTimeService</span></span><br><span class="line">        <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"><span class="comment">//        3ã€æ ¹æ®æµç¨‹å®šä¹‰Idå¯åŠ¨æµç¨‹</span></span><br><span class="line">        <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">                .startProcessInstanceByKey(<span class="string">&quot;myEvection&quot;</span>);</span><br><span class="line"><span class="comment">//        è¾“å‡ºå†…å®¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æµç¨‹å®šä¹‰idï¼š&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">        System.out.println(<span class="string">&quot;æµç¨‹å®ä¾‹idï¼š&quot;</span> + processInstance.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;å½“å‰æ´»åŠ¨Idï¼š&quot;</span> + processInstance.getActivityId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1638a3cecc5fbee4dc99ceb37e4647dd.png" alt="1575117588624"></p>
<p><strong>æ“ä½œæ•°æ®è¡¨</strong></p>
<p>act_hi_actinst æµç¨‹å®ä¾‹æ‰§è¡Œå†å²</p>
<p>act_hi_identitylink æµç¨‹çš„å‚ä¸ç”¨æˆ·å†å²ä¿¡æ¯</p>
<p>act_hi_procinst æµç¨‹å®ä¾‹å†å²ä¿¡æ¯</p>
<p>act_hi_taskinst æµç¨‹ä»»åŠ¡å†å²ä¿¡æ¯</p>
<p>act_ru_execution æµç¨‹æ‰§è¡Œä¿¡æ¯</p>
<p>act_ru_identitylink æµç¨‹çš„å‚ä¸ç”¨æˆ·ä¿¡æ¯</p>
<p>act_ru_task ä»»åŠ¡ä¿¡æ¯</p>
<h2 id="64-ä»»åŠ¡æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#64-ä»»åŠ¡æŸ¥è¯¢">#</a> 6.4 ä»»åŠ¡æŸ¥è¯¢</h2>
<p>æµç¨‹å¯åŠ¨åï¼Œä»»åŠ¡çš„è´Ÿè´£äººå°±å¯ä»¥æŸ¥è¯¢è‡ªå·±å½“å‰éœ€è¦å¤„ç†çš„ä»»åŠ¡ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„ä»»åŠ¡éƒ½æ˜¯è¯¥ç”¨æˆ·çš„å¾…åŠä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢å½“å‰ä¸ªäººå¾…æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindPersonalTaskList</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        ä»»åŠ¡è´Ÿè´£äºº</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">assignee</span> <span class="operator">=</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        åˆ›å»ºTaskService</span></span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line"><span class="comment">//        æ ¹æ®æµç¨‹key å’Œ ä»»åŠ¡è´Ÿè´£äºº æŸ¥è¯¢ä»»åŠ¡</span></span><br><span class="line">        List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//æµç¨‹Key</span></span><br><span class="line">                .taskAssignee(assignee)<span class="comment">//åªæŸ¥è¯¢è¯¥ä»»åŠ¡è´Ÿè´£äººçš„ä»»åŠ¡</span></span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹å®ä¾‹idï¼š&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡idï¼š&quot;</span> + task.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡è´Ÿè´£äººï¼š&quot;</span> + task.getAssignee());</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡åç§°ï¼š&quot;</span> + task.getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æµç¨‹å®ä¾‹idï¼š2501</span><br><span class="line">ä»»åŠ¡idï¼š2505</span><br><span class="line">ä»»åŠ¡è´Ÿè´£äººï¼šzhangsan</span><br><span class="line">ä»»åŠ¡åç§°ï¼šåˆ›å»ºå‡ºå·®ç”³è¯·</span><br></pre></td></tr></table></figure>
<h2 id="65-æµç¨‹ä»»åŠ¡å¤„ç†"><a class="markdownIt-Anchor" href="#65-æµç¨‹ä»»åŠ¡å¤„ç†">#</a> 6.5 æµç¨‹ä»»åŠ¡å¤„ç†</h2>
<p>ä»»åŠ¡è´Ÿè´£äººæŸ¥è¯¢å¾…åŠä»»åŠ¡ï¼Œé€‰æ‹©ä»»åŠ¡è¿›è¡Œå¤„ç†ï¼Œå®Œæˆä»»åŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®Œæˆä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completTask</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        è·å–å¼•æ“</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        è·å–taskService</span></span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        æ ¹æ®æµç¨‹key å’Œ ä»»åŠ¡çš„è´Ÿè´£äºº æŸ¥è¯¢ä»»åŠ¡</span></span><br><span class="line"><span class="comment">//        è¿”å›ä¸€ä¸ªä»»åŠ¡å¯¹è±¡</span></span><br><span class="line">        <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//æµç¨‹Key</span></span><br><span class="line">                .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//è¦æŸ¥è¯¢çš„è´Ÿè´£äºº</span></span><br><span class="line">                .singleResult();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        å®Œæˆä»»åŠ¡,å‚æ•°ï¼šä»»åŠ¡id</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="66-æµç¨‹å®šä¹‰ä¿¡æ¯æŸ¥è¯¢"><a class="markdownIt-Anchor" href="#66-æµç¨‹å®šä¹‰ä¿¡æ¯æŸ¥è¯¢">#</a> 6.6 æµç¨‹å®šä¹‰ä¿¡æ¯æŸ¥è¯¢</h2>
<p>æŸ¥è¯¢æµç¨‹ç›¸å…³ä¿¡æ¯ï¼ŒåŒ…å«æµç¨‹å®šä¹‰ï¼Œæµç¨‹éƒ¨ç½²ï¼Œæµç¨‹å®šä¹‰ç‰ˆæœ¬</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æµç¨‹å®šä¹‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryProcessDefinition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//        è·å–å¼•æ“</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        å¾—åˆ°ProcessDefinitionQuery å¯¹è±¡</span></span><br><span class="line">        <span class="type">ProcessDefinitionQuery</span> <span class="variable">processDefinitionQuery</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery();</span><br><span class="line"><span class="comment">//          æŸ¥è¯¢å‡ºå½“å‰æ‰€æœ‰çš„æµç¨‹å®šä¹‰</span></span><br><span class="line"><span class="comment">//          æ¡ä»¶ï¼šprocessDefinitionKey =evection</span></span><br><span class="line"><span class="comment">//          orderByProcessDefinitionVersion æŒ‰ç…§ç‰ˆæœ¬æ’åº</span></span><br><span class="line"><span class="comment">//        descå€’å™</span></span><br><span class="line"><span class="comment">//        list è¿”å›é›†åˆ</span></span><br><span class="line">        List&lt;ProcessDefinition&gt; definitionList = processDefinitionQuery.processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .orderByProcessDefinitionVersion()</span><br><span class="line">                .desc()</span><br><span class="line">                .list();</span><br><span class="line"><span class="comment">//      è¾“å‡ºæµç¨‹å®šä¹‰ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹å®šä¹‰ id=&quot;</span>+processDefinition.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹å®šä¹‰ name=&quot;</span>+processDefinition.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹å®šä¹‰ key=&quot;</span>+processDefinition.getKey());</span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹å®šä¹‰ Version=&quot;</span>+processDefinition.getVersion());</span><br><span class="line">            System.out.println(<span class="string">&quot;æµç¨‹éƒ¨ç½²ID =&quot;</span>+processDefinition.getDeploymentId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æµç¨‹å®šä¹‰idï¼šmyEvection:1:4</span><br><span class="line">æµç¨‹å®šä¹‰åç§°ï¼šå‡ºå·®ç”³è¯·å•</span><br><span class="line">æµç¨‹å®šä¹‰keyï¼šmyEvection</span><br><span class="line">æµç¨‹å®šä¹‰ç‰ˆæœ¬ï¼š1</span><br></pre></td></tr></table></figure>
<h2 id="67-æµç¨‹åˆ é™¤"><a class="markdownIt-Anchor" href="#67-æµç¨‹åˆ é™¤">#</a> 6.7 æµç¨‹åˆ é™¤</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDeployment</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// æµç¨‹éƒ¨ç½²id</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">deploymentId</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">		</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// é€šè¿‡æµç¨‹å¼•æ“è·å–repositoryService</span></span><br><span class="line">		<span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine</span><br><span class="line">				.getRepositoryService();</span><br><span class="line">		<span class="comment">//åˆ é™¤æµç¨‹å®šä¹‰ï¼Œå¦‚æœè¯¥æµç¨‹å®šä¹‰å·²æœ‰æµç¨‹å®ä¾‹å¯åŠ¨åˆ™åˆ é™¤æ—¶å‡ºé”™</span></span><br><span class="line">		repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">		<span class="comment">//è®¾ç½®true çº§è”åˆ é™¤æµç¨‹å®šä¹‰ï¼Œå³ä½¿è¯¥æµç¨‹æœ‰æµç¨‹å®ä¾‹å¯åŠ¨ä¹Ÿå¯ä»¥åˆ é™¤ï¼Œè®¾ç½®ä¸ºfalseéçº§åˆ«åˆ é™¤æ–¹å¼ï¼Œå¦‚æœæµç¨‹</span></span><br><span class="line">		<span class="comment">//repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>
<pre><code>  ä½¿ç”¨repositoryServiceåˆ é™¤æµç¨‹å®šä¹‰ï¼Œå†å²è¡¨ä¿¡æ¯ä¸ä¼šè¢«åˆ é™¤
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">     å¦‚æœè¯¥æµç¨‹å®šä¹‰ä¸‹æ²¡æœ‰æ­£åœ¨è¿è¡Œçš„æµç¨‹ï¼Œåˆ™å¯ä»¥ç”¨æ™®é€šåˆ é™¤ã€‚</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ol>
<p>å¦‚æœè¯¥æµç¨‹å®šä¹‰ä¸‹å­˜åœ¨å·²ç»è¿è¡Œçš„æµç¨‹ï¼Œä½¿ç”¨æ™®é€šåˆ é™¤æŠ¥é”™ï¼Œå¯ç”¨çº§è”åˆ é™¤æ–¹æ³•å°†æµç¨‹åŠç›¸å…³è®°å½•å…¨éƒ¨åˆ é™¤ã€‚</p>
<p>å…ˆåˆ é™¤æ²¡æœ‰å®Œæˆæµç¨‹èŠ‚ç‚¹ï¼Œæœ€åå°±å¯ä»¥å®Œå…¨åˆ é™¤æµç¨‹å®šä¹‰ä¿¡æ¯</p>
<p>é¡¹ç›®å¼€å‘ä¸­çº§è”åˆ é™¤æ“ä½œä¸€èˆ¬åªå¼€æ”¾ç»™è¶…çº§ç®¡ç†å‘˜ä½¿ç”¨.</p>
<h2 id="68-æµç¨‹èµ„æºä¸‹è½½"><a class="markdownIt-Anchor" href="#68-æµç¨‹èµ„æºä¸‹è½½">#</a> 6.8 æµç¨‹èµ„æºä¸‹è½½</h2>
<p>ç°åœ¨æˆ‘ä»¬çš„æµç¨‹èµ„æºæ–‡ä»¶å·²ç»ä¸Šä¼ åˆ°æ•°æ®åº“äº†ï¼Œå¦‚æœå…¶ä»–ç”¨æˆ·æƒ³è¦æŸ¥çœ‹è¿™äº›èµ„æºæ–‡ä»¶ï¼Œå¯ä»¥ä»æ•°æ®åº“ä¸­æŠŠèµ„æºæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæœ‰ï¼š</p>
<p>1ã€jdbc å¯¹ blob ç±»å‹ï¼Œclob ç±»å‹æ•°æ®è¯»å–å‡ºæ¥ï¼Œä¿å­˜åˆ°æ–‡ä»¶ç›®å½•</p>
<p>2ã€ä½¿ç”¨ activiti çš„ api æ¥å®ç°</p>
<p>ä½¿ç”¨ commons-io.jar è§£å†³ IO çš„æ“ä½œ</p>
<p>å¼•å…¥ commons-io ä¾èµ–åŒ…</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æµç¨‹å®šä¹‰å¯¹è±¡è·å–æµç¨‹å®šä¹‰èµ„æºï¼Œè·å– bpmn å’Œ png</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDeployment</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        è·å–å¼•æ“</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        è·å–repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        æ ¹æ®éƒ¨ç½²id åˆ é™¤éƒ¨ç½²ä¿¡æ¯,å¦‚æœæƒ³è¦çº§è”åˆ é™¤ï¼Œå¯ä»¥æ·»åŠ ç¬¬äºŒä¸ªå‚æ•°ï¼Œtrue</span></span><br><span class="line">        repositoryService.deleteDeployment(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">queryBpmnFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        1ã€å¾—åˆ°å¼•æ“</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2ã€è·å–repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3ã€å¾—åˆ°æŸ¥è¯¢å™¨ï¼šProcessDefinitionQueryï¼Œè®¾ç½®æŸ¥è¯¢æ¡ä»¶,å¾—åˆ°æƒ³è¦çš„æµç¨‹å®šä¹‰</span></span><br><span class="line">        <span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line"><span class="comment">//        4ã€é€šè¿‡æµç¨‹å®šä¹‰ä¿¡æ¯ï¼Œå¾—åˆ°éƒ¨ç½²ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">deploymentId</span> <span class="operator">=</span> processDefinition.getDeploymentId();</span><br><span class="line"><span class="comment">//        5ã€é€šè¿‡repositoryServiceçš„æ–¹æ³•ï¼Œå®ç°è¯»å–å›¾ç‰‡ä¿¡æ¯å’Œbpmnä¿¡æ¯</span></span><br><span class="line"><span class="comment">//        pngå›¾ç‰‡çš„æµ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">pngInput</span> <span class="operator">=</span> repositoryService.getResourceAsStream(deploymentId, processDefinition.getDiagramResourceName());</span><br><span class="line"><span class="comment">//        bpmnæ–‡ä»¶çš„æµ</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">bpmnInput</span> <span class="operator">=</span> repositoryService.getResourceAsStream(deploymentId, processDefinition.getResourceName());</span><br><span class="line"><span class="comment">//        6ã€æ„é€ OutputStreamæµ</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file_png</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/evectionflow01.png&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file_bpmn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/evectionflow01.bpmn&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">bpmnOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file_bpmn);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">pngOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file_png);</span><br><span class="line"><span class="comment">//        7ã€è¾“å…¥æµï¼Œè¾“å‡ºæµçš„è½¬æ¢</span></span><br><span class="line">        IOUtils.copy(pngInput,pngOut);</span><br><span class="line">        IOUtils.copy(bpmnInput,bpmnOut);</span><br><span class="line"><span class="comment">//        8ã€å…³é—­æµ</span></span><br><span class="line">        pngOut.close();</span><br><span class="line">        bpmnOut.close();</span><br><span class="line">        pngInput.close();</span><br><span class="line">        bpmnInput.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ol>
<li>
<pre><code>  deploymentIdä¸ºæµç¨‹éƒ¨ç½²ID
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">     resource_nameä¸ºact_ge_bytearrayè¡¨ä¸­NAME_åˆ—çš„å€¼</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
<li>
<pre><code>  ä½¿ç”¨repositoryServiceçš„getDeploymentResourceNamesæ–¹æ³•å¯ä»¥è·å–æŒ‡å®šéƒ¨ç½²ä¸‹å¾—æ‰€æœ‰æ–‡ä»¶çš„åç§°
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ```</span><br><span class="line">     ä½¿ç”¨repositoryServiceçš„getResourceAsStreamæ–¹æ³•ä¼ å…¥éƒ¨ç½²IDå’Œèµ„æºå›¾ç‰‡åç§°å¯ä»¥è·å–éƒ¨ç½²ä¸‹æŒ‡å®šåç§°æ–‡ä»¶çš„è¾“å…¥æµ</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ol>
<p>æœ€åçš„å°†è¾“å…¥æµä¸­çš„å›¾ç‰‡èµ„æºè¿›è¡Œè¾“å‡ºã€‚</p>
<h2 id="69-æµç¨‹å†å²ä¿¡æ¯çš„æŸ¥çœ‹"><a class="markdownIt-Anchor" href="#69-æµç¨‹å†å²ä¿¡æ¯çš„æŸ¥çœ‹">#</a> 6.9 æµç¨‹å†å²ä¿¡æ¯çš„æŸ¥çœ‹</h2>
<p>å³ä½¿æµç¨‹å®šä¹‰å·²ç»åˆ é™¤äº†ï¼Œæµç¨‹æ‰§è¡Œçš„å†å²ä¿¡æ¯é€šè¿‡å‰é¢çš„åˆ†æï¼Œä¾ç„¶ä¿å­˜åœ¨ activiti çš„ act_hi_* ç›¸å…³çš„è¡¨ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥æŸ¥è¯¢æµç¨‹æ‰§è¡Œçš„å†å²ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ HistoryService æ¥æŸ¥çœ‹ç›¸å…³çš„å†å²è®°å½•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥çœ‹å†å²ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findHistoryInfo</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//      è·å–å¼•æ“</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        è·å–HistoryService</span></span><br><span class="line">        <span class="type">HistoryService</span> <span class="variable">historyService</span> <span class="operator">=</span> processEngine.getHistoryService();</span><br><span class="line"><span class="comment">//        è·å– actinstè¡¨çš„æŸ¥è¯¢å¯¹è±¡</span></span><br><span class="line">        <span class="type">HistoricActivityInstanceQuery</span> <span class="variable">instanceQuery</span> <span class="operator">=</span> historyService.createHistoricActivityInstanceQuery();</span><br><span class="line"><span class="comment">//        æŸ¥è¯¢ actinstè¡¨ï¼Œæ¡ä»¶ï¼šæ ¹æ® InstanceId æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">//        instanceQuery.processInstanceId(&quot;2501&quot;);</span></span><br><span class="line"><span class="comment">//        æŸ¥è¯¢ actinstè¡¨ï¼Œæ¡ä»¶ï¼šæ ¹æ® DefinitionId æŸ¥è¯¢</span></span><br><span class="line">        instanceQuery.processDefinitionId(<span class="string">&quot;myEvection:1:4&quot;</span>);</span><br><span class="line"><span class="comment">//        å¢åŠ æ’åºæ“ä½œ,orderByHistoricActivityInstanceStartTime æ ¹æ®å¼€å§‹æ—¶é—´æ’åº asc å‡åº</span></span><br><span class="line">        instanceQuery.orderByHistoricActivityInstanceStartTime().asc();</span><br><span class="line"><span class="comment">//        æŸ¥è¯¢æ‰€æœ‰å†…å®¹</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; activityInstanceList = instanceQuery.list();</span><br><span class="line"><span class="comment">//        è¾“å‡º</span></span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance hi : activityInstanceList) &#123;</span><br><span class="line">            System.out.println(hi.getActivityId());</span><br><span class="line">            System.out.println(hi.getActivityName());</span><br><span class="line">            System.out.println(hi.getProcessDefinitionId());</span><br><span class="line">            System.out.println(hi.getProcessInstanceId());</span><br><span class="line">            System.out.println(<span class="string">&quot;&lt;==========================&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a class="markdownIt-Anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h1>
<ul>
<li>åŸºæœ¬åŠŸèƒ½ä»‹ç»ä»¥åŠå®Œæˆäº†ï¼Œå¦‚æœè¿˜éœ€è¦æ›´åŠ é«˜çº§çš„åŠŸèƒ½æ¯”å¦‚æŒ‚èµ·ã€æ¿€æ´»æµç¨‹å®ä¾‹ã€æµç¨‹å˜é‡ç­‰è¯·å‚è€ƒ<a target="_blank" rel="noopener" href="https://andyoung.blog.csdn.net/article/details/118345330">ã€https://andyoung.blog.csdn.net/article/details/118345330ã€‘</a>ã€‚</li>
<li>å·¥ä½œæµå¼•æ“ Activiti ä¸ Spring boot ç»“åˆä¼šæ˜¯å¼€å‘è·Ÿç®€å•ï¼Œä¸å¦‚æ¥çœ‹ä¸‹ <a target="_blank" rel="noopener" href="https://andyoung.blog.csdn.net/article/details/118372175">ã€å·¥ä½œæµå¼•æ“ Activiti å®æˆ˜ç³»åˆ—ã€‘</a></li>
</ul>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ <code>Java</code>  ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="å›¾ç‰‡"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"> éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-02-03T16:20:23.000Z" title="2021-2-4 0:20:23">2021-02-04</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-10-10T16:10:23.000Z" title="2022-10-11 0:10:23">2022-10-11</time>æ›´æ–°</span><span class="level-item">4 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦549ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/02/04/%E3%80%90Redis%E3%80%91SpringBoot%E6%95%B4%E5%90%88Redis%EF%BC%8C%E7%BC%93%E5%AD%98%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%20%20redisTemplate.keys(pattern)%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E6%89%BE%E4%B8%8D%E5%88%B0keys%EF%BC%8C%E2%80%9C%20%20%E2%80%9C%20%E9%80%9A%E9%85%8D%E7%AC%A6%E6%97%A0%E6%95%88/">ã€Redisã€‘SpringBootæ•´åˆRedisï¼Œç¼“å­˜æ‰¹é‡åˆ é™¤  redisTemplate.keys(pattern)æ¨¡ç³ŠæŸ¥è¯¢æ‰¾ä¸åˆ°keysï¼Œâ€œ  â€œ é€šé…ç¬¦æ— æ•ˆ</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="redisspringbootæ•´åˆredisç¼“å­˜æ‰¹é‡åˆ é™¤-redistemplatekeyspatternæ¨¡ç³ŠæŸ¥è¯¢æ‰¾ä¸åˆ°keys-é€šé…ç¬¦æ— æ•ˆ"><a class="markdownIt-Anchor" href="#redisspringbootæ•´åˆredisç¼“å­˜æ‰¹é‡åˆ é™¤-redistemplatekeyspatternæ¨¡ç³ŠæŸ¥è¯¢æ‰¾ä¸åˆ°keys-é€šé…ç¬¦æ— æ•ˆ">#</a> ã€Redisã€‘SpringBoot æ•´åˆ Redisï¼Œç¼“å­˜æ‰¹é‡åˆ é™¤  redisTemplate.keys (pattern) æ¨¡ç³ŠæŸ¥è¯¢æ‰¾ä¸åˆ° keysï¼Œâ€œ  â€œ é€šé…ç¬¦æ— æ•ˆ</h1>
<h3 id="å¼•è¨€"><a class="markdownIt-Anchor" href="#å¼•è¨€">#</a> å¼•è¨€</h3>
<p>æœ€è¿‘ï¼Œåœ¨å­¦ä¹  Spring Boot æ•´åˆ Redis çš„çŸ¥è¯†ï¼Œåœ¨ä¸šåŠ¡ä¸­éœ€è¦åˆ é™¤æŸä¸ªå‰ç¼€çš„æ‰€æœ‰<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Redis%E7%BC%93%E5%AD%98&amp;spm=1001.2101.3001.7020"> Redis ç¼“å­˜</a>ï¼Œé¦–å…ˆä½¿ç”¨ <strong>RedisTemplate.keys () æ¨¡ç³ŠæŸ¥è¯¢</strong>å‡ºæ‰€æœ‰åˆé€‚çš„ keysï¼Œå†ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=redisTemplate&amp;spm=1001.2101.3001.7020">redisTemplate</a>.delete () æ–¹æ³•è¿›è¡Œæ‰¹é‡åˆ é™¤ã€‚å‚è€ƒä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; keys = redisTemplate.keys(prefix + <span class="string">&quot;*&quot;</span>);</span><br><span class="line">redisTemplate.delete(pageKeys);</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œï¼Œå‘ç° redisTemplate.keys (prefix + â€œ*â€ ) æ¨¡ç³ŠæŸ¥è¯¢ï¼Œæ€»æ˜¯è¿”å›ä¸€ä¸ªç©ºçš„é›†åˆï¼Œæ‰¾ä¸åˆ° keyã€‚</p>
<p>åœ¨æ—¥å¿—ä¸­æ‰“å°æŸ¥è¯¢çš„ keys é›†åˆï¼Œä¸€ç›´ä¸ºç©ºé›†åˆï¼š</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e157868f134c4420b9989e3d3e41365a.png" alt="img"></p>
<h3 id="1-é—®é¢˜åˆ†æ"><a class="markdownIt-Anchor" href="#1-é—®é¢˜åˆ†æ">#</a> <strong>1ã€é—®é¢˜åˆ†æï¼š</strong></h3>
<p>é¦–å…ˆï¼Œç¡®ä¿æŸ¥è¯¢å­—ç¬¦ä¸²æ­£ç¡®ã€‚</p>
<p>ç„¶åï¼Œå°è¯• redisTemplate.keys (key) ï¼Œç”¨å®Œæ•´çš„ä¸€ä¸ª key è¿›è¡ŒæŸ¥è¯¢ï¼Œå‘ç°èƒ½æ­£å¸¸è¿”å›åªæœ‰ä¸€ä¸ª key çš„é›†åˆã€‚</p>
<p>è¯´æ˜æ¨¡ç³ŠæŸ¥è¯¢ çš„ é€šé…ç¬¦ <strong>&quot; * &quot;</strong> æ²¡æœ‰å‘æŒ¥ä½œç”¨ï¼Œå¯èƒ½åªæ˜¯è¢«å½“ä½œä¸€ä¸ªæ™®é€šçš„å­—ç¬¦äº†ã€‚</p>
<h3 id="2-é—®é¢˜è§£å†³"><a class="markdownIt-Anchor" href="#2-é—®é¢˜è§£å†³">#</a> <strong>2ã€é—®é¢˜è§£å†³ï¼š</strong></h3>
<p>ä¸º redis æ·»åŠ é…ç½®æ–‡ä»¶ RedisConfigï¼Œé‡æ–°å®šä¹‰ RedisTemplate çš„ key ä¸º String ç±»å‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="type">StringRedisSerializer</span> <span class="variable">redisSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>();</span><br><span class="line">        <span class="comment">// keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">// hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(redisSerializer);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†æ¬¡æµ‹è¯• redisTemplate.keys (prefix + â€œ*â€ ) æ¨¡ç³ŠæŸ¥è¯¢ï¼Œå¯ä»¥æ­£å¸¸è¿”å›ç¼“å­˜ä¸­çš„ keys é›†åˆï¼ï¼ï¼</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-10T22:26:17.000Z" title="2021-1-11 6:26:17">2021-01-11</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-08-24T22:52:35.000Z" title="2021-8-25 6:52:35">2021-08-25</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦966ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/11/%E3%80%90Elasticsearch%E3%80%91Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8Elasticsearch7/">Linuxç¯å¢ƒä¸‹å®‰è£…å¹¶å¯åŠ¨Elasticsearch7</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h3>
<p>â€‹        Elasticsearch (ES) æ˜¯ä¸€ä¸ªåŸºäº Lucene æ„å»ºçš„å¼€æºã€åˆ†å¸ƒå¼ã€RESTful æ¥å£å…¨æ–‡æœç´¢å¼•æ“ã€‚Elasticsearch è¿˜æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡æ¡£æ•°æ®åº“ï¼Œå…¶ä¸­æ¯ä¸ªå­—æ®µå‡æ˜¯è¢«ç´¢å¼•çš„æ•°æ®ä¸”å¯è¢«æœç´¢ï¼Œå®ƒèƒ½å¤Ÿæ‰©å±•è‡³æ•°ä»¥ç™¾è®¡çš„æœåŠ¡å™¨å­˜å‚¨ä»¥åŠå¤„ç† PB çº§çš„æ•°æ®ã€‚å®ƒå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…åœ¨å­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡çš„æ•°æ®ã€‚å®ƒé€šå¸¸ä½œä¸ºå…·æœ‰å¤æ‚æœç´¢åœºæ™¯æƒ…å†µä¸‹çš„æ ¸å¿ƒå‘åŠ¨æœºã€‚es æ˜¯ç”± java è¯­è¨€ç¼–å†™çš„ã€‚</p>
<pre><code>Elasticsearchå°±æ˜¯ä¸ºé«˜å¯ç”¨å’Œå¯æ‰©å±•è€Œç”Ÿçš„ã€‚å¯ä»¥é€šè¿‡è´­ç½®æ€§èƒ½æ›´å¼ºçš„æœåŠ¡å™¨æ¥å®Œæˆã€‚
</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">Elasticsearchï¼šå®˜æ–¹åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/icon-default.png" alt="img">https://www.elastic.co/cn/elasticsearch/</a></p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="linuxé‡Œéƒ¨ç½²es"><a class="markdownIt-Anchor" href="#linuxé‡Œéƒ¨ç½²es">#</a> Linux é‡Œéƒ¨ç½² ES</h2>
<h3 id="ä¸‹è½½åœ°å€"><a class="markdownIt-Anchor" href="#ä¸‹è½½åœ°å€">#</a> ä¸‹è½½åœ°å€</h3>
<p>â€‹        æˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ ES7.15.1</p>
<p>Elasticsearch 7.15.1 | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/apple-icon-57x57.png" alt="img"><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1</a></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/74a3f6fc611945ebb8e492204fe4b51f.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4490382f8fd54a48bbd8e2ffaf2ce6ea.png" alt="img"></p>
<h3 id="ä¸Šä¼ åˆ°linux"><a class="markdownIt-Anchor" href="#ä¸Šä¼ åˆ°linux">#</a> ä¸Šä¼ åˆ° Linux</h3>
<p>â€‹    å‹ç¼©åŒ…ä¸‹è½½å®Œæˆåä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3732b77fcd15428e8397739b50f6b3b1.png" alt="img"></p>
<h3 id="è§£å‹è½¯ä»¶"><a class="markdownIt-Anchor" href="#è§£å‹è½¯ä»¶">#</a> è§£å‹è½¯ä»¶</h3>
<p>â€‹     è§£å‹åˆ°ä¸Šçº§ç›®å½•ï¼Œç„¶åè¿›è¡Œæ”¹å</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹ç¼©</span></span><br><span class="line">tar -zxvf elasticsearch-7.15.1-linux-x86_64.tar.gz -C ../</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ”¹å</span></span><br><span class="line">mv elasticsearch-7.15.1 es-7.15.1</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e6ff579f0e6b4aa6994e17629bbaa96a.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/7678de3df173498e92409dc8300f09b5.png" alt="img"></p>
<p>åœ¨ /opt ç›®å½•ä¸‹æ–°å»º module/es ç›®å½•ï¼ŒåŒæ—¶æŠŠ es-7.15.1 ç§»åˆ°è¯¥ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv es-7.15.1 /opt/module/es</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºç”¨æˆ·"><a class="markdownIt-Anchor" href="#åˆ›å»ºç”¨æˆ·">#</a> åˆ›å»ºç”¨æˆ·</h3>
<p>â€‹    å› ä¸ºå®‰å…¨é—®é¢˜ï¼Œ Elasticsearch ä¸å…è®¸ root ç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œæ‰€ä»¥è¦åˆ›å»ºæ–°ç”¨æˆ·ï¼Œåœ¨ root ç”¨æˆ·ä¸­åˆ›å»ºæ–°ç”¨æˆ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd es #æ–°å¢ es ç”¨æˆ·</span><br><span class="line">passwd es #ä¸º es ç”¨æˆ·è®¾ç½®å¯†ç </span><br><span class="line">userdel -r es #å¦‚æœé”™äº†ï¼Œå¯ä»¥åˆ é™¤å†åŠ </span><br><span class="line">chown -R es:es /opt/module/es/es-7.15.1 #æ–‡ä»¶å¤¹æ‰€æœ‰è€…</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/cf9ac437254f47bfa9e26f4770fa9667.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3b5a89b6cdbb4a3bb6220423400e25d2.png" alt="img"></p>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¿®æ”¹é…ç½®æ–‡ä»¶">#</a> ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<p>ä¿®æ”¹ /root/es-7.15.1/config/elasticsearch.yml æ–‡ä»¶ã€‚</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d40fbb16c317400495682be93a2e07d7.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åŠ å…¥å¦‚ä¸‹é…ç½®</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: node-1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/00e7d21c15c640ba949d3dda5e9ee885.png" alt="img"></p>
<h3 id="ä¿®æ”¹etcsecuritylimitsconf"><a class="markdownIt-Anchor" href="#ä¿®æ”¹etcsecuritylimitsconf">#</a> ä¿®æ”¹ /etc/security/limits.conf</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span><br><span class="line"># æ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°çš„é™åˆ¶</span><br><span class="line">es soft nofile 65536</span><br><span class="line">es hard nofile 65536</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4d4441f8e29346a0bc5a0ac8959477d9.png" alt="img"></p>
<h3 id="ä¿®æ”¹etcsysctlconf"><a class="markdownIt-Anchor" href="#ä¿®æ”¹etcsysctlconf">#</a> ä¿®æ”¹ /etc/sysctl.conf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„ VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡,é»˜è®¤å€¼ä¸º 65536</span></span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>
<h3 id="é‡æ–°åŠ è½½"><a class="markdownIt-Anchor" href="#é‡æ–°åŠ è½½">#</a> é‡æ–°åŠ è½½</h3>
<p>sysctl -p</p>
<h3 id="æ³¨æ„"><a class="markdownIt-Anchor" href="#æ³¨æ„">#</a> æ³¨æ„ï¼š</h3>
<p>â€‹    å¯åŠ¨å‰éœ€è¦å…ˆåˆ‡æ¢åˆ° es ç”¨æˆ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su es</span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨es"><a class="markdownIt-Anchor" href="#å¯åŠ¨es">#</a> å¯åŠ¨ es</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨ è¿›å…¥binç›®å½•ï¼š</span></span><br><span class="line">./elasticsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åå°å¯åŠ¨</span></span><br><span class="line">./elasticsearch -d  </span><br></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•è¿æ¥"><a class="markdownIt-Anchor" href="#æµ‹è¯•è¿æ¥">#</a> æµ‹è¯•è¿æ¥</h3>
<p>â€‹    æµè§ˆå™¨ä¸­æ‰“å¼€ <a target="_blank" rel="noopener" href="http://xn--ip-fr5c86lx7z:9200/">http:// æœåŠ¡å™¨ IP:9200/</a>, å‡ºç°å¦‚ä¸‹åˆ™è¯´æ˜å®‰è£…æˆåŠŸ</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0197dcff901f47279750939332674547.png" alt="img"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-08T06:37:17.000Z" title="2021-1-8 14:37:17">2021-01-08</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-10-08T18:01:59.000Z" title="2023-10-9 2:01:59">2023-10-09</time>æ›´æ–°</span><span class="level-item">2 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦306ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/08/%E3%80%90Flutter%E3%80%91Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/">Flutterå¼€å‘ä¸­ä½¿ç”¨WIFIçœŸæœºè°ƒè¯•</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="flutterå¼€å‘ä¸­ä½¿ç”¨wifiçœŸæœºè°ƒè¯•"><a class="markdownIt-Anchor" href="#flutterå¼€å‘ä¸­ä½¿ç”¨wifiçœŸæœºè°ƒè¯•">#</a> Flutter å¼€å‘ä¸­ä½¿ç”¨ WIFI çœŸæœºè°ƒè¯•</h1>
<h4 id="ä½¿ç”¨vscodeå¼€å‘flutterç”¨wifi-æˆ–è€…-æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ-æ— çº¿è°ƒè¯•è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#ä½¿ç”¨vscodeå¼€å‘flutterç”¨wifi-æˆ–è€…-æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ-æ— çº¿è°ƒè¯•è¿‡ç¨‹">#</a> ä½¿ç”¨ vscode å¼€å‘ flutterï¼Œç”¨ wifi æˆ–è€… æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ æ— çº¿è°ƒè¯•è¿‡ç¨‹</h4>
<h4 id="1æ‰‹æœºè¿æ¥wifiååœ¨è®¾ç½®ä¸­æ‰¾åˆ°ipå’Œç«¯å£"><a class="markdownIt-Anchor" href="#1æ‰‹æœºè¿æ¥wifiååœ¨è®¾ç½®ä¸­æ‰¾åˆ°ipå’Œç«¯å£">#</a> 1. æ‰‹æœºè¿æ¥ wifi ååœ¨è®¾ç½®ä¸­æ‰¾åˆ° ip å’Œç«¯å£</h4>
<h4 id="2åœ¨vscodeç»ˆç«¯è¾“å…¥-adb-connect-æ‰‹æœºipæ‰‹æœºç«¯å£"><a class="markdownIt-Anchor" href="#2åœ¨vscodeç»ˆç«¯è¾“å…¥-adb-connect-æ‰‹æœºipæ‰‹æœºç«¯å£">#</a> 2. åœ¨ vscode ç»ˆç«¯è¾“å…¥ adb connect æ‰‹æœº IP: æ‰‹æœºç«¯å£</h4>
<h4 id="3ä½œè€…åœ¨csdnè¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯å…¨æ˜¯ç²˜è´´çš„æ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ç²˜è´´å¯ä»¥æŠ„è¢­å¯è€»"><a class="markdownIt-Anchor" href="#3ä½œè€…åœ¨csdnè¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯å…¨æ˜¯ç²˜è´´çš„æ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ç²˜è´´å¯ä»¥æŠ„è¢­å¯è€»">#</a> 3. ä½œè€…åœ¨ CSDN è¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå…¨æ˜¯ç²˜è´´çš„ï¼Œæ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ï¼Œä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ï¼Œç²˜è´´å¯ä»¥ï¼ŒæŠ„è¢­å¯è€»ï¼</h4>
<h4 id="4å®Œæˆä»¥ä¸Šæ­¥éª¤æ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#4å®Œæˆä»¥ä¸Šæ­¥éª¤æ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼">#</a> 4. å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œæ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºï¼Œè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼ã€‚</h4>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-01T18:18:05.000Z" title="2021-1-2 2:18:05">2021-01-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-09-17T05:27:20.000Z" title="2023-9-17 13:27:20">2023-09-17</time>æ›´æ–°</span><span class="level-item">8 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1170ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/02/%E3%80%90Vue%E3%80%91JSON%E7%BC%96%E8%BE%91%E5%99%A8Bin-Coder/">ã€Vueã€‘JSONç¼–è¾‘å™¨Bin-Coder</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="vuejsonç¼–è¾‘å™¨bin-coder"><a class="markdownIt-Anchor" href="#vuejsonç¼–è¾‘å™¨bin-coder">#</a> ã€Vueã€‘JSON ç¼–è¾‘å™¨ Bin-Coder</h1>
<p><a target="_blank" rel="noopener" href="https://wangbin3162.gitee.io/bin-code-editor/#/guide">Bin Code Editor</a></p>
<h1 id="1-å®‰è£…"><a class="markdownIt-Anchor" href="#1-å®‰è£…">#</a> 1 å®‰è£…</h1>
<h2 id="11-cdn-å®‰è£…"><a class="markdownIt-Anchor" href="#11-cdn-å®‰è£…">#</a> 1.1 CDN å®‰è£…</h2>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="keyword">import</span> <span class="title class_">Vue</span>.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;!-- <span class="keyword">import</span> stylesheet --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://unpkg.com/bin-code-editor@0.1.0/lib/styles/index.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- import bin-code-editor --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/bin-code-editor@0.1.0/lib/bin-code-editor.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>@0.1.0 è¡¨ç¤ºç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å»ºè®®é”å®šç‰ˆæœ¬å·æ¥ä¿è¯ä»£ç çš„ç¨³å®šæ€§</p>
<h2 id="12-npm-å®‰è£…"><a class="markdownIt-Anchor" href="#12-npm-å®‰è£…">#</a> 1.2 npm å®‰è£…</h2>
<p>æ¨èä½¿ç”¨ npm å®‰è£…ï¼Œå®ƒèƒ½æ›´å¥½åœ°å’Œ<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=webpack%E6%89%93%E5%8C%85&amp;spm=1001.2101.3001.7020"> webpack æ‰“åŒ…</a>å·¥å…·é…åˆä½¿ç”¨ã€‚è€Œä¸”å¯ä»¥æ›´å¥½çš„å’Œ es6 é…åˆä½¿ç”¨ã€‚å¹¶ä¸”æ”¯æŒæŒ‰éœ€å¼•å…¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i bin-code-editor -S</span><br><span class="line"># or </span><br><span class="line">yarn add bin-code-editor</span><br></pre></td></tr></table></figure>
<h1 id="2-å¼•å…¥"><a class="markdownIt-Anchor" href="#2-å¼•å…¥">#</a> 2 å¼•å…¥</h1>
<p>åœ¨ main.js ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CodeEditor</span> <span class="keyword">from</span> <span class="string">&#x27;bin-code-editor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bin-code-editor/lib/style/index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">CodeEditor</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="3-ç”¨æ³•"><a class="markdownIt-Anchor" href="#3-ç”¨æ³•">#</a> 3 ç”¨æ³•</h1>
<p>æ³¨æ„ï¼Œåˆå§‹åŒ–å¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ä¼šé»˜è®¤æ ¼å¼åŒ–ä¸€æ¬¡ï¼Œæ ¼å¼åŒ–å¿«æ·é”®é»˜è®¤ä¸º F7, ä½¿ç”¨æ—¶å¯ä»¥è¿›è¡Œæ ¼å¼åŒ–ç»“æ„ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSON.stringify(JSON.parse(jsonData),null,2)`å¯ä»¥å°†é»˜è®¤jsonè¿›è¡Œé¢„æ ¼å¼åŒ–,ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘formatCode()æ¥æ ¼å¼åŒ–</span><br><span class="line">`JSON.stringify(value[, replacer[, space]])</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>value: å¿…éœ€ï¼Œ è¦è½¬æ¢çš„ JavaScript å€¼ï¼ˆé€šå¸¸ä¸ºå¯¹è±¡æˆ–æ•°ç»„ï¼‰ã€‚</li>
<li>replacer: å¯é€‰ã€‚ç”¨äºè½¬æ¢ç»“æœçš„å‡½æ•°æˆ–æ•°ç»„ã€‚å¦‚æœ replacer ä¸ºå‡½æ•°ï¼Œåˆ™ JSON.stringify å°†è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶ä¼ å…¥æ¯ä¸ªæˆå‘˜çš„é”®å’Œå€¼ã€‚ä½¿ç”¨è¿”å›å€¼è€Œä¸æ˜¯åŸå§‹å€¼ã€‚å¦‚æœæ­¤å‡½æ•°è¿”å› undefinedï¼Œåˆ™æ’é™¤æˆå‘˜ã€‚æ ¹å¯¹è±¡çš„é”®æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼šâ€œâ€ã€‚å¦‚æœ replacer æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™ä»…è½¬æ¢è¯¥æ•°ç»„ä¸­å…·æœ‰é”®å€¼çš„æˆå‘˜ã€‚æˆå‘˜çš„è½¬æ¢é¡ºåºä¸é”®åœ¨æ•°ç»„ä¸­çš„é¡ºåºä¸€æ ·ã€‚</li>
<li>space: å¯é€‰ï¼Œæ–‡æœ¬æ·»åŠ ç¼©è¿›ã€ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œå¦‚æœ space æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œåˆ™è¿”å›å€¼æ–‡æœ¬åœ¨æ¯ä¸ªçº§åˆ«ç¼©è¿›æŒ‡å®šæ•°ç›®çš„ç©ºæ ¼ï¼Œå¦‚æœ space å¤§äº 10ï¼Œåˆ™æ–‡æœ¬ç¼©è¿› 10 ä¸ªç©ºæ ¼ã€‚space ä¹Ÿå¯ä»¥ä½¿ç”¨éæ•°å­—ï¼Œå¦‚ï¼š\tã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/ba155f2c67e14cc0b063a92a683220ff.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">b-code-editor</span> <span class="attr">v-model</span>=<span class="string">&quot;jsonStr&quot;</span> <span class="attr">:indent-unit</span>=<span class="string">&quot;4&quot;</span> <span class="attr">height</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> jsonData = <span class="string">`&#123;&quot;title&quot;:&quot;æµ‹è¯•jsonæ•°æ®&quot;,&quot;children&quot;:[&#123;&quot;name&quot;:&quot;å­é¡¹åç§°&quot;, &quot;desc&quot;:&quot;å­é¡¹è¯´æ˜&quot; &#125;,&#123;&quot;name&quot;:&quot;å­é¡¹åç§°1&quot;, &quot;desc&quot;:&quot;å­é¡¹è¯´æ˜1&quot; &#125;]&#125;`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">jsonStr</span>: jsonData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="4-å…¶ä»–é…ç½®é¡¹"><a class="markdownIt-Anchor" href="#4-å…¶ä»–é…ç½®é¡¹">#</a> 4 å…¶ä»–é…ç½®é¡¹</h1>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
<th>å¯é€‰å€¼</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>ç»‘å®šæ•°æ®ï¼Œå¯ç”¨ v-model</td>
<td>String</td>
<td>â€”</td>
<td>0</td>
</tr>
<tr>
<td>show-number</td>
<td>æ˜¾ç¤ºè¡Œå·</td>
<td>Boolean</td>
<td>â€”</td>
<td>true</td>
</tr>
<tr>
<td>mode</td>
<td>æ¨¡å¼</td>
<td>String</td>
<td>â€˜application/jsonâ€™,â€˜text/javascriptâ€™</td>
<td>â€˜application/jsonâ€™</td>
</tr>
<tr>
<td>theme</td>
<td>æä¾›è‹¥å¹²ä¸ªé»˜è®¤æ¯”è¾ƒå¥½çœ‹çš„çš®è‚¤</td>
<td>String</td>
<td>å¯é€‰å€¼å‚è€ƒå…¶ä»–é…ç½®é¡¹ä¸­åˆ—å‡º</td>
<td>idea</td>
</tr>
<tr>
<td>lint</td>
<td>æ˜¯å¦è¿›è¡Œ lint æ£€æŸ¥</td>
<td>Boolean</td>
<td>æš‚æ—¶åªæ”¯æŒ json</td>
<td>true</td>
</tr>
<tr>
<td>readonly</td>
<td>åªè¯»æ¨¡å¼</td>
<td>Boolean</td>
<td>-</td>
<td>false</td>
</tr>
<tr>
<td>auto-format</td>
<td>æ˜¯å¦è‡ªåŠ¨æ ¼å¼åŒ–</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>indent-unit</td>
<td>ç¼©è¿›å­—ç¬¦</td>
<td>Number</td>
<td>-</td>
<td>2</td>
</tr>
<tr>
<td>smart-indent</td>
<td>æ˜¯å¦è‡ªåŠ¨ç¼©è¿›</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>line-wrap</td>
<td>ä»£ç æ¢è¡Œ</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>gutter</td>
<td>ä»£ç æŠ˜å </td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>height</td>
<td>é»˜è®¤ç¼–è¾‘å™¨é«˜åº¦</td>
<td>String</td>
<td>â€”</td>
<td>300px</td>
</tr>
</tbody>
</table>
<h1 id="5-events-äº‹ä»¶"><a class="markdownIt-Anchor" href="#5-events-äº‹ä»¶">#</a> 5 Events äº‹ä»¶</h1>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	  <span class="tag">&lt;<span class="name">b-code-editor</span> <span class="attr">v-model</span>=<span class="string">&quot;jsonStr&quot;</span> <span class="attr">:indent-unit</span>=<span class="string">&quot;4&quot;</span> <span class="attr">height</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">	  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b-button</span> @<span class="attr">click</span>=<span class="string">&quot;$refs[&#x27;editor&#x27;].formatCode()&quot;</span>&gt;</span>æ‰‹åŠ¨è§¦å‘æ ¼å¼åŒ–<span class="tag">&lt;/<span class="name">b-button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>äº‹ä»¶å</th>
<th>è¯´æ˜</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>on-change</td>
<td>è¾“å…¥é¡¹æ”¹å˜äº‹ä»¶</td>
<td>value</td>
</tr>
<tr>
<td>formatCode</td>
<td>æ‰‹åŠ¨è§¦å‘æ ¼å¼åŒ–æ–¹æ³•</td>
<td>-</td>
</tr>
<tr>
<td>refresh</td>
<td>æ‰‹åŠ¨åˆ·æ–°æ–¹æ³•</td>
<td>-</td>
</tr>
<tr>
<td>getValue</td>
<td>è‡ªè¡Œè·å–å€¼</td>
<td>-</td>
</tr>
</tbody>
</table>
<h1 id="6-theme-çš®è‚¤å±æ€§"><a class="markdownIt-Anchor" href="#6-theme-çš®è‚¤å±æ€§">#</a> 6 theme çš®è‚¤å±æ€§</h1>
<p><code>theme</code>  å±æ€§å¯é€‰å€¼</p>
<ul>
<li>idea<br>
<img src="https://img-blog.csdnimg.cn/774c7c41e1fd4dad81c4a8c4d56fb608.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>eclipse<br>
<img src="https://img-blog.csdnimg.cn/97d00490aa2c452e96cc64717798c9d5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>duotone-light<br>
<img src="https://img-blog.csdnimg.cn/a9a97cd2eff84e60b687ddf8368c6e50.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>mdn-like<br>
<img src="https://img-blog.csdnimg.cn/68288d52b01d41fab7653d9c3dcfb10a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>xq-light<br>
<img src="https://img-blog.csdnimg.cn/988f7ebe12ff42ef80f6b1a527bed1c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>dracula<br>
<img src="https://img-blog.csdnimg.cn/2aa62e024dbd41158a8bc66db799ef82.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>rubyblue<br>
<img src="https://img-blog.csdnimg.cn/04b909ae46234a0c871daa0545215526.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>monokai<br>
<img src="https://img-blog.csdnimg.cn/7baa723e068747a885ae2fa3b80048d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>material<br>
<img src="https://img-blog.csdnimg.cn/f949cc3c5f7344dc98c38751bd8db085.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>material-darker<br>
<img src="https://img-blog.csdnimg.cn/48f9a957450641e4b0ebb269f09aba7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-20T00:42:43.000Z" title="2020-12-20 8:42:43">2020-12-20</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-11-26T06:52:52.000Z" title="2023-11-26 14:52:52">2023-11-26</time>æ›´æ–°</span><span class="level-item">15 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2268ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/20/%E3%80%90MySQL%E3%80%91Mysql%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4/">Mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£ï¼Œå®ç°è¯»å†™åˆ†ç¦»</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£å®ç°è¯»å†™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£å®ç°è¯»å†™åˆ†ç¦»">#</a> Mysql ä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£ï¼Œå®ç°è¯»å†™åˆ†ç¦»</h2>
<p>â€‹		æœ€è¿‘åœ¨è‡ªå·±å†™çš„é¡¹ç›®ä¸­éœ€è¦åº”å¯¹å¤§é‡çš„ç”¨æˆ·æŸ¥è¯¢è¯»å†™æ“ä½œï¼Œä¸€å°æœåŠ¡å™¨å½“ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥åœ¨è¾¹å­¦è¾¹æ•²çš„èƒŒæ™¯ä¸‹ï¼Œè®°å½•è¿™ç¯‡ç¬”è®°ï¼Œä» 0 å¼€å§‹æ­å»ºä¸»ä»é›†ç¾¤ã€‚</p>
<h4 id="ä¸‹é¢å¼€å§‹æ“ä½œ"><a class="markdownIt-Anchor" href="#ä¸‹é¢å¼€å§‹æ“ä½œ">#</a> ä¸‹é¢ğŸ‘‡å¼€å§‹æ“ä½œï¼š</h4>
<p>1. åˆ†åˆ«åœ¨ä¸¤å°æœåŠ¡å™¨æ­å»º mysql æœåŠ¡</p>
<p>â€‹		ä¸¤å°æœåŠ¡å™¨çš„ IP åœ°å€åˆ†åˆ«ä¸ºä¸»æœåŠ¡å™¨ï¼ˆ192.168.20.1ï¼‰å’Œä»æœåŠ¡å™¨ï¼ˆ192.168.20.2ï¼‰ã€‚<br>
2. é…ç½®æ–‡ä»¶ my.cnf çš„ä¿®æ”¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œç¼–è¾‘my.cnfæ–‡ä»¶</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨[mysqld]ä¸­æ·»åŠ ï¼š</span></span><br><span class="line">server-id=1</span><br><span class="line">log_bin=master-bin</span><br><span class="line">log_bin_index=master-bin.index</span><br><span class="line">binlog_do_db=test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_bin å¯åŠ¨MySQLäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå³æ•°æ®åŒæ­¥è¯­å¥ï¼Œä»æ•°æ®åº“ä¼šä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œè¿™äº›è¯­å¥ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_do_db æŒ‡å®šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ï¼Œå³éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œå¦‚æœå¤åˆ¶å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_ignore_db æŒ‡å®šä¸è®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ï¼Œå³ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbinlog_do_dbå’Œbinlog_ignore_dbä¸ºäº’æ–¥é€‰é¡¹ï¼Œä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªå³å¯ã€‚</span></span><br></pre></td></tr></table></figure>
<p>3. åˆ›å»ºä»æœåŠ¡å™¨çš„ç”¨æˆ·å’Œæƒé™</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºä»æ•°æ®åº“çš„rootç”¨æˆ·å’Œæƒé™</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave on *.* to root@<span class="string">&#x27;192.168.20.%&#x27;</span> identified by <span class="string">&#x27;Lgq081538&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">grant replication slave on *.* to &#x27;123456&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">192.168.20.%é€šé…ç¬¦ï¼Œè¡¨ç¤º0-255çš„IPéƒ½å¯è®¿é—®ä¸»æœåŠ¡å™¨ï¼Œæ­£å¼ç¯å¢ƒè¯·é…ç½®æŒ‡å®šä»æœåŠ¡å™¨IP</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è‹¥å°† 192.168.20.% æ”¹ä¸º %ï¼Œåˆ™ä»»ä½•ipå‡å¯ä½œä¸ºå…¶ä»æ•°æ®åº“æ¥è®¿é—®ä¸»æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€€å‡ºmysql</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span>;</span></span><br></pre></td></tr></table></figure>
<p>4. é‡å¯ mysql æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>5. æŸ¥çœ‹ä¸»æœåŠ¡å™¨çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ä¸»æœåŠ¡å™¨çŠ¶æ€</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| master-bin.000001 |      154 | test         |                  |                   |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>6.slave ä»æœåŠ¡å™¨çš„é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®æ–‡ä»¶my.cnfçš„ä¿®æ”¹</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œç¼–è¾‘my.cnfæ–‡ä»¶</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨[mysqld]ä¸­æ·»åŠ ï¼š</span></span><br><span class="line">server-id=2</span><br><span class="line">relay-log=slave-relay-bin</span><br><span class="line">relay-log-index=slave-relay-bin.index</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db=<span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœæœ‰å¤šä¸ªä»æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„server-idä¸èƒ½é‡å¤ï¼Œè·ŸIPä¸€æ ·æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœä½ æ²¡è®¾ç½®server-idæˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™ä»æœåŠ¡å™¨ä¸ä¼šè¿æ¥åˆ°ä¸»æœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">relay-log å¯åŠ¨MySQLäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¯ä»¥ç”¨æ¥åšæ•°æ®å¤‡ä»½å’Œå´©æºƒæ¢å¤ï¼Œæˆ–ä¸»æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œå°†æ­¤ä»æœåŠ¡å™¨ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœå¤åˆ¶å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚è‹¥åœ¨masterç«¯ä¸æŒ‡å®šbinlog-do-dbï¼Œåˆ™åœ¨slaveç«¯å¯ç”¨replication-do-dbæ¥è¿‡æ»¤ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-ignore-db ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œreplicate-do-dbå’Œreplicate-ignore-dbä¸ºäº’æ–¥é€‰é¡¹ï¼Œä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªå³å¯ã€‚</span></span><br></pre></td></tr></table></figure>
<p>7. é‡å¯ mysql æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>8. è¿æ¥ master ä¸»æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿æ¥masterä¸»æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to master_host=<span class="string">&#x27;192.168.20.1&#x27;</span>,master_port=3306,master_user=<span class="string">&#x27;root&#x27;</span>,master_password=<span class="string">&#x27;123456&#x27;</span>,master_log_file=<span class="string">&#x27;master-bin.000009&#x27;</span>,master_log_pos=473127;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_hostå¯¹åº”ä¸»æœåŠ¡å™¨çš„IPåœ°å€ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_portå¯¹åº”ä¸»æœåŠ¡å™¨çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_fileå¯¹åº”show master statusæ˜¾ç¤ºçš„Fileåˆ—ï¼šmaster-bin.000001ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_poså¯¹åº”show master statusæ˜¾ç¤ºçš„Positionåˆ—ï¼š154ã€‚</span></span><br></pre></td></tr></table></figure>
<p>9. å¯åŠ¨ slave æ•°æ®åŒæ­¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨slaveæ•°æ®åŒæ­¥</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœæ­¢slaveæ•°æ®åŒæ­¥ï¼ˆè‹¥æœ‰éœ€è¦ï¼‰</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">stop slave;</span></span><br><span class="line">3.5 æŸ¥çœ‹slaveä¿¡æ¯</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status\G;</span></span><br><span class="line">Slave_IO_Runningå’ŒSlave_SQL_Runningéƒ½ä¸ºyesï¼Œåˆ™è¡¨ç¤ºåŒæ­¥æˆåŠŸã€‚</span><br></pre></td></tr></table></figure>
<p>10. æµ‹è¯•</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰åœ¨ä¸»æœåŠ¡å™¨ä¸Šç™»é™†mysqlï¼Œä¸”è¿›å…¥testæ•°æ®åº“ï¼Œåˆ›å»ºtestè¡¨ï¼Œä¸”æ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line">æç¤ºï¼šè¿™é‡Œæœ€å¥½ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¦‚nacicatï¼‰æ¥æ“ä½œã€‚</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºtb_testè¡¨</span></span><br><span class="line">create table tb_test(ID varchar(36) primary key comment &#x27;ä¸»é”®ID&#x27;,MEMO varchar(500) not null comment &#x27;ä¿¡æ¯&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ’å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line">insert into tb_test(ID,MEMO) values(&#x27;1&#x27;,&#x27;one test&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æäº¤</span></span><br><span class="line">commit;</span><br><span class="line">ï¼ˆ2ï¼‰åœ¨ä»æœåŠ¡å™¨ä¸Šç™»é™†mysqlï¼Œä¸”è¿›å…¥testæ•°æ®åº“</span><br><span class="line">ä½ ä¼šå‘ç°ä»æ•°æ®åº“ä¸­ï¼Œä¹Ÿå‡ºç°äº†tb_testè¡¨ï¼Œä¸”è¡¨ä¸­è¿˜æœ‰one testæ•°æ®å­˜åœ¨ï¼Œè¯æ˜åŒæ­¥æ•°æ®æˆåŠŸã€‚</span><br></pre></td></tr></table></figure>
<h3 id="è‡³æ­¤mysqlä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ"><a class="markdownIt-Anchor" href="#è‡³æ­¤mysqlä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ">#</a> è‡³æ­¤ Mysql ä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ</h3>
<p>ä¸‹é¢å¼€å§‹æ­å»º Spring Boot é¡¹ç›®ä¸­çš„ç›¸å…³é…ç½®ä»¥åŠå®ç°ğŸ‘‡</p>
<p>â€‹		è¯»å†™åˆ†ç¦»è¦åšçš„äº‹æƒ…å°±æ˜¯å¯¹äºä¸€æ¡ SQL è¯¥é€‰æ‹©å“ªä¸ªæ•°æ®åº“å»æ‰§è¡Œï¼Œè‡³äºè°æ¥åšé€‰æ‹©æ•°æ®åº“è¿™ä»¶äº‹ï¼Œä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºï¼š<br>
1. ä½¿ç”¨ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ Atlasï¼Œcobarï¼ŒTDDLï¼Œmycatï¼Œheisenbergï¼ŒOceanusï¼Œvitessï¼ŒOneProxy ç­‰<br>
 2. ä½¿ç”¨ç¨‹åºè‡ªå·±å®ç°ï¼Œåˆ©ç”¨ Spring Boot æä¾›çš„è·¯ç”±æ•°æ®æºä»¥åŠ AOPï¼Œå®ç°èµ·æ¥ç®€å•å¿«æ·<br>
â€‹</p>
<p>â€‹		æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ Spring Boot æ•°æ®æºè·¯ç”± + AOP ï¼Œè¿™æ ·èƒ½æ›´å¥½çš„æ§åˆ¶æµç¨‹ï¼Œä¹Ÿä¾¿äºåæœŸæå‡æ€§èƒ½ï¼›</p>
<p>ä»£ç å®ç°<br>
 1. é¦–å…ˆé…ç½®ä¸‹ pom.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=xml&amp;spm=1001.2101.3001.7020">xml</a> å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ aop å®ç°ï¼Œæ‰€ä»¥éœ€è¦ aop ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2. æ•°æ®æºè·¯ç”±ç±»åŠŸèƒ½ RoutingDataSource.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®æºè·¯ç”±ç±»åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DBContext.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3. æ•°æ®æºä¸Šä¸‹æ–‡ç±» DBContext.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®æºä¸Šä¸‹æ–‡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;DBTypeEnum&gt; dbContext = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(DBTypeEnum dbType)</span> &#123;</span><br><span class="line">        dbContext.set(dbType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DBTypeEnum <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dbContext.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">master</span><span class="params">()</span> &#123;</span><br><span class="line">        set(DBTypeEnum.MASTER);</span><br><span class="line">        log.info(<span class="string">&quot;åˆ‡æ¢åˆ°masteråº“&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">slave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//  è¯»åº“è´Ÿè½½å‡è¡¡(è½®è¯¢æ–¹å¼)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> counter.getAndIncrement() % <span class="number">2</span>;</span><br><span class="line">        log.info(<span class="string">&quot;slaveåº“è®¿é—®çº¿ç¨‹æ•°==&gt;&#123;&#125;&quot;</span>, counter.get());</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE1);</span><br><span class="line">            log.info(<span class="string">&quot;åˆ‡æ¢åˆ°slave1åº“&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE2);</span><br><span class="line">            log.info(<span class="string">&quot;åˆ‡æ¢åˆ°slave2åº“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4. æ•°æ®åº“æšä¸¾ç±» DBTypeEnum.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“æšä¸¾ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DBTypeEnum</span> &#123;</span><br><span class="line">    MASTER, <span class="comment">//ä¸»åº“</span></span><br><span class="line">    SLAVE1, <span class="comment">//ä»åº“1</span></span><br><span class="line">    SLAVE2  <span class="comment">//ä»åº“2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬é…ç½®ä¸‰ä¸ªåº“ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªå†™åº“ Masterï¼Œ2 ä¸ªè¯»åº“ slave1,slave2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfigs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.master&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">masterDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave1DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave2DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">myRoutingDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;masterDataSource&quot;)</span> DataSource masterDataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave1DataSource&quot;)</span> DataSource slave1DataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave2DataSource&quot;)</span> DataSource slave2DataSource)</span> &#123;</span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DBTypeEnum.MASTER, masterDataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE1, slave1DataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE2, slave2DataSource);</span><br><span class="line">        <span class="type">RoutingDataSource</span> <span class="variable">routingDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoutingDataSource</span>();</span><br><span class="line">        routingDataSource.setDefaultTargetDataSource(masterDataSource);</span><br><span class="line">        routingDataSource.setTargetDataSources(targetDataSources);</span><br><span class="line">        <span class="keyword">return</span> routingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6. åˆ‡é¢ç±» DataSourceAop.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * åˆ‡é¢ç±»DataSourceAop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAop</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.insert*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.create*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.save*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.add*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.update*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.edit*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.delete*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.remove*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writePointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;!@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;&amp;&amp; (execution(* com.example.demo.*.service..*.select*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.list*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.count*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.get*(..)))&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readPointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;writePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.master();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;readPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.slave();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>7. æ³¨è§£ç±» Master.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ³¨è§£ç±»Master ä¸»åº“ï¼Œå¯è¯»å†™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Master &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-18T23:25:31.000Z" title="2020-12-19 7:25:31">2020-12-19</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-03-06T00:33:09.000Z" title="2023-3-6 8:33:09">2023-03-06</time>æ›´æ–°</span><span class="level-item">12 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1779ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/19/%E3%80%90Nginx%E3%80%91Nginx%E4%BB%A5%E5%8F%8Akeepalived%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/">Nginxä»¥åŠKeepalivedå®‰è£…ä»¥åŠéƒ¨ç½²</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>â€‹		åå‘ä»£ç†ï¼šæŒ‡çš„æ˜¯ç”¨æˆ·è¦è®¿é—® youtube, ä½†æ˜¯ youtube æ‚„æ‚„åœ°æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™åå° N å°æœåŠ¡å™¨ä¸­çš„å…¶ä¸­ä¸€å°æ¥åšï¼Œè¿™ç§æ–¹å¼å°±æ˜¯åå‘ä»£ç†äº†ã€‚</p>
<p>â€‹		è´Ÿè½½å‡è¡¡ï¼š</p>
<p>1) ä½¿ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚ä½¿ç”¨ F5,Array ç­‰è´Ÿè½½å‡è¡¡å™¨.</p>
<p>2) ä½¿ç”¨è½¯ä»¶è¿›è¡Œè´Ÿè½½å‡è¡¡<br>
 3) å¦‚ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨å‡è¡¡ SLB<br>
4) ä½¿ç”¨æˆ‘ä»¬ä»Šå¤©æ‰€å­¦ä¹ çš„ Nginx+Keepalived<br>
5) å…¶ä»–è½¯ä»¶è´Ÿè½½å‡è¡¡å¦‚ LVS (Linux Virtual Server),haproxy ç­‰æŠ€æœ¯</p>
<h3 id="ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#ç¯å¢ƒæ­å»º">#</a> ç¯å¢ƒæ­å»ºï¼š</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">æ­¥éª¤:</span><br><span class="line"><span class="number">1.</span>è¿›è¡Œå®‰è£…:tar -zxvf /root/software/nginx-<span class="number">1.6</span><span class="number">.2</span>.tar.gz -C /usr/local/</span><br><span class="line"><span class="number">2.</span>ä¸‹è½½æ‰€éœ€è¦çš„ä¾èµ–åº“æ–‡ä»¶:</span><br><span class="line">   yum install pcre -y</span><br><span class="line">   yum install pcre-devel -y</span><br><span class="line">   yum install zlib -y</span><br><span class="line">   yum install zlib-devel -y</span><br><span class="line"><span class="number">3.</span>è¿›è¡Œconfigureé…ç½®,æŸ¥çœ‹æ˜¯å¦æŠ¥é”™</span><br><span class="line">   cd nginx-<span class="number">1.6</span><span class="number">.2</span></span><br><span class="line">   ./configure --prefix=/usr/local/nginx</span><br><span class="line"><span class="number">4.</span>ç¼–è¯‘å®‰è£…:make &amp;&amp; make install</span><br><span class="line"><span class="number">5.</span>åœ¨ /usr/local/nginxç›®å½•ä¸‹,å¯ä»¥çœ‹åˆ°å¦‚ä¸‹<span class="number">4</span>ä¸ªç›®å½•</span><br><span class="line">   confé…ç½®æ–‡ä»¶,htmlç½‘é¡µæ–‡ä»¶,logsæ—¥å¿—æ–‡ä»¶,sbinä¸»è¦äºŒè¿›åˆ¶ç¨‹åº</span><br><span class="line"><span class="number">6.</span>å¯åŠ¨å‘½ä»¤:/usr/local/nginx/sbin/nginx</span><br><span class="line">  å…³é—­å‘½ä»¤:/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">  é‡å¯å‘½ä»¤:/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line"><span class="number">7.</span>è®¿é—®æµè§ˆå™¨:http:<span class="comment">//192.168.122.133(çœ‹åˆ°æ¬¢è¿é¡µé¢è¯´æ˜æ²¡é—®é¢˜)</span></span><br><span class="line"></span><br><span class="line">æ³¨æ„:å¦‚æœå‡ºç°è¿™ä¸ªé”™è¯¯:./configure: error: C compiler cc is not found</span><br><span class="line">æ‰§è¡Œè¿™ä¸ªå‘½ä»¤:yum -y install gcc gcc-c++ autoconf automake make</span><br></pre></td></tr></table></figure>
<p>Keepalivedï¼š</p>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ Keepalived, å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æœåŠ¡å™¨é«˜å¯ç”¨æˆ–çƒ­å¤‡è§£å†³æ–¹æ¡ˆï¼ŒKeepalived ä¸»è¦é˜²æ­¢æœåŠ¡å™¨å•ç‚¹æ•…éšœçš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸ Nginx çš„é…åˆå®ç° web æœåŠ¡å™¨ç«¯çš„é«˜å¯ç”¨.<br>
Keepalived ä»¥ VRRP åè®®ä¸ºå®ç°åŸºç¡€ï¼Œä½¿ç”¨ VRRP åè®®æ¥å®ç°é«˜å¯ç”¨æ€§ (HA).VRRP (Virtual Router Redundacy Protocol) åè®®ç”¨äºå®ç°è·¯ç”±å™¨å†—ä½™çš„åè®®ï¼ŒVRRP åè®®å°†ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨è®¾å¤‡è™šæ‹Ÿæˆä¸€ä¸ªè®¾å¤‡ï¼Œå‘å¤–æä¾›è™šæ‹Ÿè·¯ç”± IP (ä¸€ä¸ªæˆ–å¤šä¸ª)ã€‚</p>
<p>å®‰è£…ä»¥åŠéƒ¨ç½²ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€æ­¥ï¼šå®‰è£…keepalivedä¾èµ–çš„åŒ…</span><br><span class="line">	yum install -y gcc</span><br><span class="line">    yum install -y openssl-devel</span><br><span class="line">	yum install -y libnl3-devel</span><br><span class="line">	yum install -y popt-devel</span><br><span class="line">	yum install -y iptables-devel</span><br><span class="line">	yum install -y libnfnetlink-devel</span><br><span class="line">	yum install -y psmisc</span><br><span class="line">ç¬¬äºŒæ­¥ï¼šç¼–è¯‘å®‰è£…keepalived</span><br><span class="line">	å°†keepalivedçš„å®‰è£…åŒ… ä¸Šä¼ åˆ°/usr/local/software ç›®å½•ä¸‹  </span><br><span class="line">	cd /usr/local/software</span><br><span class="line">	tar -zxvf keepalived-<span class="number">1.2</span><span class="number">.19</span>.tar.gz -C /usr/local  </span><br><span class="line">	cd /usr/local/keepalived-<span class="number">1.2</span><span class="number">.19</span>  </span><br><span class="line">	./configure --prefix=/usr/local/keepalived  </span><br><span class="line">	make &amp;&amp; make install </span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼šå°† keepalived å®‰è£…æˆ Linux ç³»ç»ŸæœåŠ¡</span><br><span class="line">	å®‰è£…å®Œæˆä¹‹åï¼Œ éœ€è¦åšä¸€äº›å·¥ä½œå¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶åˆ° é»˜è®¤è·¯å¾„  </span><br><span class="line">	mkdir /etc/keepalived  </span><br><span class="line">	cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/  </span><br><span class="line">	cp /usr/local/keepalived/sbin/keepalived /usr/sbin/  </span><br><span class="line">	cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/  </span><br><span class="line">	cd /usr/local/keepalived-<span class="number">1.2</span><span class="number">.19</span>  </span><br><span class="line">	cp ./keepalived/etc/init.d/keepalived.init /etc/init.d/</span><br><span class="line">	chmod <span class="number">755</span> /etc/init.d/keepalived.init </span><br><span class="line">ç¬¬å››æ­¥ï¼šç¼–å†™nginxæ£€æµ‹è„šæœ¬:</span><br><span class="line">vi /etc/keepalived/nginx_check.sh</span><br><span class="line">å†…å®¹å¦‚ä¸‹ï¼š  </span><br><span class="line">#!/bin/bash  </span><br><span class="line">A=`ps -C nginx â€“no-header |wc -l`  </span><br><span class="line"><span class="keyword">if</span> [ $A -eq <span class="number">0</span> ];then  </span><br><span class="line">    /usr/local/nginx/sbin/nginx  </span><br><span class="line">    sleep <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq <span class="number">0</span> ];then  </span><br><span class="line">        killall keepalived  </span><br><span class="line">    fi  </span><br><span class="line">fi  </span><br><span class="line">èµ‹äºˆæ‰§è¡Œæƒé™  </span><br><span class="line">chmod +x /etc/keepalived/nginx_check.sh </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯åŠ¨å‘½ä»¤:</span><br><span class="line">  keepalived</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ Master é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹keepalivedçš„Masteré…ç½®æ–‡ä»¶:vi /etc/keepalived/keepalived.conf </span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived       </span><br><span class="line">global_defs &#123;      </span><br><span class="line">   router_id wolfcode                           ##è·¯ç”±å™¨æ ‡å¿—    </span><br><span class="line">&#125;    </span><br><span class="line"># é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆtrack_scriptè¿›è¡Œ    </span><br><span class="line">vrrp_script check_haproxy &#123;    </span><br><span class="line">	script <span class="string">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„  </span><br><span class="line">	interval <span class="number">2</span>  #æ£€æµ‹æ—¶é—´é—´éš”  </span><br><span class="line">	weight -<span class="number">20</span>  #æ¡ä»¶æˆç«‹ æƒé‡å‡<span class="number">20</span>  </span><br><span class="line">&#125;    </span><br><span class="line">vrrp_instance PROXY &#123;    </span><br><span class="line">	# è®¾ç½®å½“å‰ä¸»æœºä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¤‡ç”¨èŠ‚ç‚¹ï¼Œåˆ™è®¾ç½®ä¸ºBACKUP   </span><br><span class="line">	state MASTER</span><br><span class="line">	# æŒ‡å®šHAç›‘æµ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥ç”¨ifconfigæŸ¥çœ‹æ¥å†³å®šè®¾ç½®å“ªä¸€ä¸ª    </span><br><span class="line">	<span class="keyword">interface</span> <span class="title class_">ens32</span></span><br><span class="line">	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹è¦ä½¿ç”¨åŒä¸€ä¸ªæ ‡è¯†ï¼Œä¸»å¤‡æœº    </span><br><span class="line">	virtual_router_id <span class="number">80</span>    </span><br><span class="line">	# å› ä¸ºå½“å‰ç¯å¢ƒä¸­VRRPç»„æ’­æœ‰é—®é¢˜ï¼Œæ”¹ä¸ºä½¿ç”¨å•æ’­å‘é€VRRPæŠ¥æ–‡  å¦‚æœVRRPç»„æ’­æ²¡é—®é¢˜ï¼Œä»¥ä¸‹è¿™å—çš„å†…å®¹å¯ä»¥æ³¨é‡Šæ‰ã€‚  </span><br><span class="line">	# è¿™ä¸ªåœ°æ–¹éœ€è¦å…³æ³¨ï¼Œä¹‹å‰æœªåšæ­¤è®¾ç½®ï¼Œç»“æœä¸»å¤‡èŠ‚ç‚¹äº’ç›¸ä¸èƒ½å‘ç°ï¼Œå› æ­¤ä¸»å¤‡èŠ‚ç‚¹éƒ½å‡çº§æˆäº†MASTERï¼Œå¹¶ä¸”ç»‘å®šäº†VIP    </span><br><span class="line">	# ä¸»èŠ‚ç‚¹æ—¶ï¼Œå†…å®¹ä¸ºï¼š    </span><br><span class="line">	unicast_src_ip <span class="number">192.168</span><span class="number">.122</span><span class="number">.133</span></span><br><span class="line">	# è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿ä¸»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§é«˜è¿‡å¤‡ç”¨èŠ‚ç‚¹  </span><br><span class="line">	priority <span class="number">100</span>    </span><br><span class="line">	# ç”¨äºè®¾å®šä¸»å¤‡èŠ‚ç‚¹é—´åŒæ­¥æ£€æŸ¥æ—¶é—´é—´éš”    </span><br><span class="line">	advert_int <span class="number">2</span>    </span><br><span class="line">	# è®¾ç½®ä¸»å¤‡èŠ‚ç‚¹é—´çš„é€šä¿¡éªŒè¯ç±»å‹åŠå¯†ç ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹ä¸­éœ€ä¸€è‡´    </span><br><span class="line">	authentication &#123;    </span><br><span class="line">		auth_type PASS    </span><br><span class="line">		auth_pass wolfcode</span><br><span class="line">	&#125;    </span><br><span class="line">	# é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆvrrp_scriptè¿›è¡Œ    </span><br><span class="line">	track_script &#123;    </span><br><span class="line">		check_haproxy    </span><br><span class="line">	&#125;    </span><br><span class="line">	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå½“keepalivedçŠ¶æ€åˆ‡æ¢ä¸ºMASTERæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿä¸­    </span><br><span class="line">	# å½“çŠ¶æ€åˆ‡æ¢åˆ°BACKUPæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨ä»ç³»ç»Ÿä¸­åˆ é™¤    </span><br><span class="line">	# å¯ä»¥é€šè¿‡å‘½ä»¤ip addæŸ¥çœ‹åˆ‡æ¢åçš„çŠ¶æ€    </span><br><span class="line">	virtual_ipaddress &#123;    </span><br><span class="line">		<span class="number">192.168</span><span class="number">.122</span><span class="number">.110</span>  #è™šæ‹Ÿipé…ç½®å®Œä¹‹åå°±ç”¨å®ƒè®¿é—®    </span><br><span class="line">	&#125;    </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ Slave é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹keepalivedçš„Slaveé…ç½®æ–‡ä»¶:vi /etc/keepalived/keepalived.conf </span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived       </span><br><span class="line">global_defs &#123;      </span><br><span class="line">   router_id wolfcode                           ##è·¯ç”±å™¨æ ‡å¿—    </span><br><span class="line">&#125;    </span><br><span class="line"># é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆtrack_scriptè¿›è¡Œ    </span><br><span class="line">vrrp_script check_haproxy &#123;    </span><br><span class="line">	script <span class="string">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„  </span><br><span class="line">	interval <span class="number">2</span>  #æ£€æµ‹æ—¶é—´é—´éš”  </span><br><span class="line">	weight -<span class="number">20</span>  #æ¡ä»¶æˆç«‹ æƒé‡å‡<span class="number">20</span>  </span><br><span class="line">&#125;    </span><br><span class="line">vrrp_instance PROXY &#123;    </span><br><span class="line">	# è®¾ç½®å½“å‰ä¸»æœºä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¤‡ç”¨èŠ‚ç‚¹ï¼Œåˆ™è®¾ç½®ä¸ºBACKUP   </span><br><span class="line">	state BACKUP</span><br><span class="line">	# æŒ‡å®šHAç›‘æµ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥ç”¨ifconfigæŸ¥çœ‹æ¥å†³å®šè®¾ç½®å“ªä¸€ä¸ª    </span><br><span class="line">	<span class="keyword">interface</span> <span class="title class_">ens32</span></span><br><span class="line">	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹è¦ä½¿ç”¨åŒä¸€ä¸ªæ ‡è¯†ï¼Œä¸»å¤‡æœº    </span><br><span class="line">	virtual_router_id <span class="number">80</span>    </span><br><span class="line">	# å› ä¸ºå½“å‰ç¯å¢ƒä¸­VRRPç»„æ’­æœ‰é—®é¢˜ï¼Œæ”¹ä¸ºä½¿ç”¨å•æ’­å‘é€VRRPæŠ¥æ–‡  å¦‚æœVRRPç»„æ’­æ²¡é—®é¢˜ï¼Œä»¥ä¸‹è¿™å—çš„å†…å®¹å¯ä»¥æ³¨é‡Šæ‰ã€‚  </span><br><span class="line">	# è¿™ä¸ªåœ°æ–¹éœ€è¦å…³æ³¨ï¼Œä¹‹å‰æœªåšæ­¤è®¾ç½®ï¼Œç»“æœä¸»å¤‡èŠ‚ç‚¹äº’ç›¸ä¸èƒ½å‘ç°ï¼Œå› æ­¤ä¸»å¤‡èŠ‚ç‚¹éƒ½å‡çº§æˆäº†MASTERï¼Œå¹¶ä¸”ç»‘å®šäº†VIP    </span><br><span class="line">	# ä¸»èŠ‚ç‚¹æ—¶ï¼Œå†…å®¹ä¸ºï¼š    </span><br><span class="line">	unicast_src_ip <span class="number">192.168</span><span class="number">.122</span><span class="number">.134</span>  </span><br><span class="line">	# è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿ä¸»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§é«˜è¿‡å¤‡ç”¨èŠ‚ç‚¹  </span><br><span class="line">	priority <span class="number">90</span>    </span><br><span class="line">	# ç”¨äºè®¾å®šä¸»å¤‡èŠ‚ç‚¹é—´åŒæ­¥æ£€æŸ¥æ—¶é—´é—´éš”    </span><br><span class="line">	advert_int <span class="number">2</span>    </span><br><span class="line">	# è®¾ç½®ä¸»å¤‡èŠ‚ç‚¹é—´çš„é€šä¿¡éªŒè¯ç±»å‹åŠå¯†ç ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹ä¸­éœ€ä¸€è‡´    </span><br><span class="line">	authentication &#123;    </span><br><span class="line">		auth_type PASS    </span><br><span class="line">		auth_pass wolfcode</span><br><span class="line">	&#125;    </span><br><span class="line">	# é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆvrrp_scriptè¿›è¡Œ    </span><br><span class="line">	track_script &#123;    </span><br><span class="line">		check_haproxy    </span><br><span class="line">	&#125;    </span><br><span class="line">	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå½“keepalivedçŠ¶æ€åˆ‡æ¢ä¸ºMASTERæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿä¸­    </span><br><span class="line">	# å½“çŠ¶æ€åˆ‡æ¢åˆ°BACKUPæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨ä»ç³»ç»Ÿä¸­åˆ é™¤    </span><br><span class="line">	# å¯ä»¥é€šè¿‡å‘½ä»¤ip addæŸ¥çœ‹åˆ‡æ¢åçš„çŠ¶æ€    </span><br><span class="line">	virtual_ipaddress &#123;    </span><br><span class="line">		<span class="number">192.168</span><span class="number">.122</span><span class="number">.110</span>  #è™šæ‹Ÿipé…ç½®å®Œä¹‹åå°±ç”¨å®ƒè®¿é—®    </span><br><span class="line">	&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-16T11:20:47.000Z" title="2020-12-16 19:20:47">2020-12-16</time>å‘è¡¨</span><span class="level-item"><time dateTime="2019-10-28T12:16:44.000Z" title="2019-10-28 20:16:44">2019-10-28</time>æ›´æ–°</span><span class="level-item">3 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦493ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/16/%E3%80%90RocketMQ%E3%80%91Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%83%A8%E7%BD%B2RocketMQ%E4%BB%A5%E5%8F%8AConsole/">Dockerç¯å¢ƒä¸‹éƒ¨ç½²RocketMQä»¥åŠConsole</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dockerç¯å¢ƒä¸‹éƒ¨ç½²rocketmqä»¥åŠconsole"><a class="markdownIt-Anchor" href="#dockerç¯å¢ƒä¸‹éƒ¨ç½²rocketmqä»¥åŠconsole">#</a> Docker ç¯å¢ƒä¸‹éƒ¨ç½² RocketMQ ä»¥åŠ Console</h1>
<h2 id="1docker-å®‰è£…rocketmqé•œåƒ"><a class="markdownIt-Anchor" href="#1docker-å®‰è£…rocketmqé•œåƒ">#</a> 1.docker å®‰è£… rocketmq é•œåƒ</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#æ‹‰å–é•œåƒ </span><br><span class="line">docker pull foxiswho/rocketmq:server-4.7.0</span><br><span class="line">docker pull foxiswho/rocketmq:broker-4.7.0</span><br></pre></td></tr></table></figure>
<h2 id="2åˆ›å»ºserverå’Œbrokerç›®å½•å¹¶åœ¨ç›®å½•optä¸‹åˆ›å»ºbrokerconf"><a class="markdownIt-Anchor" href="#2åˆ›å»ºserverå’Œbrokerç›®å½•å¹¶åœ¨ç›®å½•optä¸‹åˆ›å»ºbrokerconf">#</a> 2. åˆ›å»º server å’Œ broker ç›®å½•ï¼Œå¹¶åœ¨ç›®å½• /opt ä¸‹åˆ›å»º broker.conf</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•</span></span><br><span class="line">mkdir /opt/rocketmq-server</span><br><span class="line">mkdir /opt/rocketmq-broker/conf -p</span><br><span class="line">[root@localhost opt]# cat /opt/rocketmq-broker/conf/broker.conf </span><br><span class="line">namesrvAddr=ã€ä½ çš„IPåœ°å€ã€‘:9876</span><br><span class="line">brokerClusterName = DefaultCluster</span><br><span class="line">brokerName = broker-a</span><br><span class="line">brokerId = 0</span><br><span class="line">deleteWhen = 04</span><br><span class="line">fileReservedTime = 48</span><br><span class="line">brokerRole = ASYNC_MASTER</span><br><span class="line">flushDiskType = ASYNC_FLUSH</span><br><span class="line">brokerIP1 = ã€ä½ çš„IPåœ°å€ã€‘</span><br><span class="line">listenPort=10911</span><br></pre></td></tr></table></figure>
<h2 id="3å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£-9876-10911-11011"><a class="markdownIt-Anchor" href="#3å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£-9876-10911-11011">#</a> 3. å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£ 9876 ã€10911 ã€11011</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">RocketMQé»˜è®¤ä½¿ç”¨3ä¸ªç«¯å£ï¼š9876 ã€10911 ã€11011</span><br><span class="line">å¦‚æœé˜²ç«å¢™æ²¡æœ‰å…³é—­çš„è¯ï¼Œé‚£ä¹ˆé˜²ç«å¢™å°±å¿…é¡»å¼€æ”¾è¿™äº›ç«¯å£ï¼š</span><br><span class="line">nameserver é»˜è®¤ä½¿ç”¨ 9876 ç«¯å£</span><br><span class="line">master é»˜è®¤ä½¿ç”¨ 10911 ç«¯å£</span><br><span class="line">slave é»˜è®¤ä½¿ç”¨11011 ç«¯å£</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨rocketmq-server</span></span><br><span class="line">docker run -d \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqnamesrv \</span><br><span class="line">-p 9876:9876 \</span><br><span class="line">-v /opt/rocketmq-server/logs:/root/logs \</span><br><span class="line">-v /opt/rocketmq-server/store:/root/store \</span><br><span class="line">-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \</span><br><span class="line">foxiswho/rocketmq:4.7.0 \</span><br><span class="line">sh mqnamesrv</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨rocketmq-broker</span></span><br><span class="line">docker run -d  \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqbroker \</span><br><span class="line">--link rmqnamesrv:namesrv \</span><br><span class="line">-p 10911:10911 \</span><br><span class="line">-p 10909:10909 \</span><br><span class="line">-v  /opt/rocketmq-broker/logs:/root/logs \</span><br><span class="line">-v  /opt/rocketmq-broker/store:/root/store \</span><br><span class="line">-v /opt/rocketmq-broker/conf/broker.conf:/opt/rocketmq-broker/conf/broker.conf \</span><br><span class="line">-e &quot;NAMESRV_ADDR=ã€ä½ çš„IPåœ°å€ã€‘:9876&quot; \</span><br><span class="line">-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \</span><br><span class="line">-e &quot;autoCreateTopicEnable=true&quot; \</span><br><span class="line">foxiswho/rocketmq:4.7.0 \</span><br><span class="line">sh mqbroker -c /opt/rocketmq-broker/conf/broker.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨RocketMQçš„ç®¡ç†å·¥å…·rocketmq-console</span></span><br><span class="line">docker run -itd -e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=ã€ä½ çš„IPåœ°å€ã€‘:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; -p 9877:8080 -t styletang/rocketmq-console-ng:latest</span><br></pre></td></tr></table></figure>
<h2 id="4æµ‹è¯•è®¿é—®consoleæ§åˆ¶å°"><a class="markdownIt-Anchor" href="#4æµ‹è¯•è®¿é—®consoleæ§åˆ¶å°">#</a> 4. æµ‹è¯•è®¿é—® console æ§åˆ¶å°</h2>
<p>æµè§ˆå™¨è¾“å…¥ï¼š192.168.1.200:9877</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230104082814121.png" alt="image-20230104082814121"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-10T19:36:11.000Z" title="2020-12-11 3:36:11">2020-12-11</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-10-27T19:44:36.000Z" title="2022-10-28 3:44:36">2022-10-28</time>æ›´æ–°</span><span class="level-item">35 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦5295ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/11/%E3%80%90Java%E3%80%91Elastic%20canal%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E5%88%B0ES%E9%85%8D%E7%BD%AE%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99/">ã€Javaã€‘Elastic canalæ•°æ®åŒæ­¥åˆ°ESé…ç½®å¸¸è§æŠ¥é”™</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javaelastic-canalæ•°æ®åŒæ­¥åˆ°esé…ç½®å¸¸è§æŠ¥é”™"><a class="markdownIt-Anchor" href="#javaelastic-canalæ•°æ®åŒæ­¥åˆ°esé…ç½®å¸¸è§æŠ¥é”™">#</a> ã€Javaã€‘Elastic canal æ•°æ®åŒæ­¥åˆ° ES é…ç½®å¸¸è§æŠ¥é”™</h1>
<h1 id="0-å¼•è¨€"><a class="markdownIt-Anchor" href="#0-å¼•è¨€">#</a> 0. å¼•è¨€</h1>
<p>æ‰€æœ‰æŠ¥é”™å‡ä¸ºåšä¸»åœ¨å®æ“è¿‡ç¨‹ä¸­é‡åˆ°çš„é”™è¯¯å’Œè§£å†³åŠæ³•ï¼Œå¦‚æœæœ‰å…¶ä»–æŠ¥é”™æˆ–è€…ä¸åŒçš„è§£å†³åŠæ³•ï¼Œè¯·ç•™è¨€å‘Šè¯‰æˆ‘</p>
<p>å®‰è£…<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=canal&amp;spm=1001.2101.3001.7020"> canal</a> è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå…ˆåœ¨æœ¬æ–‡ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰ç›¸åŒæŠ¥é”™ï¼Œå°†ä¼šä¸ºä½ èŠ‚çº¦å¤§é‡æ’é”™æ—¶é—´</p>
<h2 id="ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#ç¯å¢ƒ">#</a> ç¯å¢ƒ</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdk1.8</span><br><span class="line">canal 1.1.5</span><br><span class="line">mysql8.0</span><br><span class="line">es7.13.0</span><br></pre></td></tr></table></figure>
<h1 id="1-unknown-system-variable-query_cache_size"><a class="markdownIt-Anchor" href="#1-unknown-system-variable-query_cache_size">#</a> 1. Unknown system variable â€˜query_cache_sizeâ€™</h1>
<p>è¿™æ˜¯å› ä¸º<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql%E9%A9%B1%E5%8A%A8&amp;spm=1001.2101.3001.7020"> mysql é©±åŠ¨</a>åŒ…çš„ç‰ˆæœ¬è¿‡ä½å¯¼è‡´çš„ï¼Œquery cache åœ¨ MySQL5.7.20 å°±å·²ç»è¿‡æ—¶äº†ï¼Œè€Œåœ¨ MySQL8.0 ä¹‹åå°±å·²ç»è¢«ç§»é™¤äº†</p>
<p>1ã€åªéœ€è¦å°† lib ä¸­çš„é©±åŠ¨å™¨æ›¿æ¢æˆ mysql-connector-java-8.0.22.jar</p>
<p>2ã€ä¿®æ”¹é©±åŠ¨å™¨æƒé™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 lib/mysql-connector-java-8.0.22.jar</span><br><span class="line">chmod +st lib/mysql-connector-java-8.0.22.jar</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æƒé™å¦‚å›¾æ‰€ç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll lib</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/fb4993202deb4227a295dc8ffcfffafb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring"><a class="markdownIt-Anchor" href="#2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring">#</a> 2. Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</h1>
<p>å¯åŠ¨ canal-adapter æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf.canal-adapters[0].groups[0].outer-adapters[1].properties&#x27; to java.util.Map&lt;java.lang.String, java.lang.String&gt;:</span><br><span class="line"></span><br><span class="line">    Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
è§‚å¯ŸæŠ¥é”™ä¿¡æ¯å¯ä»¥å¾—çŸ¥æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ outer2ï¼ˆ0 åŸºï¼Œæ‰€ä»¥ outer-adapter [1] å®é™…æŒ‡çš„æ˜¯ 2ï¼‰çš„ properties é…ç½®æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬è§‚å¯Ÿé…ç½®æ–‡ä»¶ï¼Œå‘ç°æ˜¯ properties ä¸‹çš„ mode,cluster.name ç­‰å±æ€§ä¸ properties åŒçº§äº†ï¼Œå°†å…¶å¦‚ä¸‹å›¾æ‰€ç¤ºåé€€ä¸¤å­—ç¬¦å³å¯ã€‚<br>
<img src="https://img-blog.csdnimg.cn/f5384eaf97234881bba9b3c8bcd663da.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="é…ç½®"></p>
<h1 id="3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx"><a class="markdownIt-Anchor" href="#3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx">#</a> 3. RuntimeException: java.lang.RuntimeException: No data source found: xxxx</h1>
<p>è¿™ä¸ªå› ä¸ºåœ¨ conf/es/xxx.yml ä¸­é…ç½®çš„ dataSourceKey å¹¶æ²¡æœ‰åœ¨ conf/application.yml ä¸­çš„ srcDataSources ä¸­ç»´æŠ¤</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œes ä¸­çš„ dataSourceKey éœ€è¦åœ¨ applicaiton.yml ä¸­è®¾ç½®ï¼Œé»˜è®¤æ˜¯ defaultDS<br>
<img src="https://img-blog.csdnimg.cn/14dacccf628d44e7b6f67c52bccdb93e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://img-blog.csdnimg.cn/5e57dd86bcb8417e9e7eda2a6d014956.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="4-reason-unable-to-set-value-for-property-src-data-sources"><a class="markdownIt-Anchor" href="#4-reason-unable-to-set-value-for-property-src-data-sources">#</a> 4. Reason: Unable to set value for property src-data-sources</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf&#x27; to com.alibaba.otter.canal.adapter.launcher.config.AdapterCanalConfig:</span><br><span class="line"></span><br><span class="line">    Reason: Unable to set value for property src-data-sources</span><br></pre></td></tr></table></figure>
<p>åŸå› ä¸€ï¼š<br>
mysql é©±åŠ¨å™¨å¯¼è‡´çš„é—®é¢˜ï¼Œä½¿ç”¨çš„æ•°æ®åº“æ˜¯ 8.xã€‚é©±åŠ¨å™¨æ˜¯ 5.x çš„ï¼Œå°† mysql é©±åŠ¨æ›¿æ¢ä¸º 8.0.x ç‰ˆæœ¬çš„ã€‚å¦‚ä¸Šæ‰€ç¤ºæŠ¥é”™ 1</p>
<p>åŸå› äºŒï¼š<br>
æ£€æŸ¥è¯¥æŠ¥é”™å‰çš„æ—¥å¿—ï¼Œæ˜¯å¦æœ‰å…¶ä»–ç›¸å…³æŠ¥é”™ä¿¡æ¯ï¼Œæ¯”å¦‚æ— ç›¸å…³æ•°æ®åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ ¹æ®å…¶æŠ¥é”™å†…å®¹æ¥æ£€æŸ¥é…ç½®é¡¹å¹¶ä¸”è°ƒæ•´å³å¯<br>
<img src="https://img-blog.csdnimg.cn/fbf719ab834648f9adfa37c65e402d71.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts"><a class="markdownIt-Anchor" href="#5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts">#</a> 5. java.sql.SQLException: null, message from server: â€œHost â€˜172.16.188.2â€™ is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™â€</h1>
<p>åŒä¸€ä¸ª ip åœ¨çŸ­æ—¶é—´å†…äº§ç”Ÿå¤ªå¤šä¸­æ–­çš„æ•°æ®åº“è¿æ¥è€Œå¯¼è‡´çš„é˜»å¡</p>
<p>ç™»å½•å¯¹åº”çš„ mysqlï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush hosts;</span><br></pre></td></tr></table></figure>
<h1 id="6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found"><a class="markdownIt-Anchor" href="#6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found">#</a> 6. IllegalStateException: Extension instance(name: es7, class: interface com.alibaba.otter.canal.client.adapter.OuterAdapter) could not be instantiated: class could not be found</h1>
<p>ä¸€èˆ¬ <code> could not be instantiated: class could not be found</code>  è¿™æ ·çš„æŠ¥é”™æ˜¯é…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œå¦‚ä¸Šçš„æŠ¥é”™å¯ä»¥çœ‹åˆ°æ˜¯ name: es7 ä¸­çš„é”™è¯¯ï¼Œåœ¨å®˜æ–¹çš„ç¤ºä¾‹æ–‡æ¡£ä¸­ä½¿ç”¨çš„æ˜¯ <code>name: es6 # or es7</code> ã€‚</p>
<p>åœ¨ canal1.1.5 + ç‰ˆæœ¬ä¸­è®¾ç½®çš„æ˜¯ name: es6 # æˆ–è€… es7</p>
<p>ä½†åœ¨ 1.1.4 ç‰ˆæœ¬ä¸­ç›´æ¥ä½¿ç”¨ <code>name: es</code>  å³å¯</p>
<h1 id="7-illegalargumentexception-not-found-the-mapping-info-of-index-user"><a class="markdownIt-Anchor" href="#7-illegalargumentexception-not-found-the-mapping-info-of-index-user">#</a> 7. IllegalArgumentException: Not found the mapping info of index: user</h1>
<p>1ã€è¿™ä¸ªæŠ¥é”™æ˜¯ ES çš„ mapping è®¾ç½®çš„é—®é¢˜ï¼Œç¡®ä¿ es ä¸­æœ‰è¯¥ç´¢å¼•ï¼Œå¹¶ä¸”ç¡®è®¤æ˜¯å¦æœ‰éƒ¨åˆ†å­—æ®µæ²¡æœ‰åœ¨ es ä¸­è®¾ç½® mapping, è¿™ä¸ªè¦å¯¹åº”ä¹‹å‰è®¾ç½®çš„ sqlï¼Œä»¥åŠ es ä¸­çš„ mappings æ¥è§£å†³</p>
<p>2ã€ä½¿ç”¨äº† elasticsearch 7.xï¼Œä½† adapter1.1.4 é»˜è®¤æ”¯æŒ es6.x<br>
 è§£å†³æ–¹æ¡ˆï¼š<br>
ï¼ˆ1ï¼‰ä¿®æ”¹ adapter æºç ï¼Œå°† es ä¾èµ–è°ƒæ•´ä¸º 7.xï¼›å‚è€ƒåšå®¢<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/355162399"> adapter1.1.4 ä¿®æ”¹æºç æ”¯æŒ es7.x</a><br>
ï¼ˆ2ï¼‰æ¢æˆ adapter1.1.5</p>
<h1 id="8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200"><a class="markdownIt-Anchor" href="#8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200">#</a> 8. IllegalArgumentException: Illegal character in scheme name at index 0: 172.16.188.7:9200</h1>
<p>å¦‚æœè¿æ¥ es ä½¿ç”¨çš„æ˜¯ rest æ–¹å¼ï¼Œé‚£ä¹ˆ hosts ä¸­çš„ ip å‰è¦æ·»åŠ  <code>http://</code> ï¼Œå¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hosts: http://172.16.188.7:9200</span><br></pre></td></tr></table></figure>
<h1 id="9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource"><a class="markdownIt-Anchor" href="#9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource">#</a> 9. com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassCastException: com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.init(ES7xAdapter.java:54) ~[client-adapter.es7x-1.1.5-jar-with-dependencies.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.loadAdapter(CanalAdapterLoader.java:225) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.init(CanalAdapterLoader.java:56) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterService.init(CanalAdapterService.java:60) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_271]</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_271]</span><br></pre></td></tr></table></figure>
<p>åŸå› ï¼š<br>
druid åŒ…å†²çª<br>
è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ client-adapter/escore/pom.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;!--add by whx 20220112--&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>2ã€é‡æ–°æ‰“åŒ…<br>
<img src="https://img-blog.csdnimg.cn/dfe52cef447444469af1020bf5328ef5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
 3ã€å°† client-adapter/es7x/target/client-adapter.es7x-1.1.5-jar-with-dependencies.jar ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ›¿æ¢ adataper/plugin ä¸‹çš„åŒå jar æ–‡ä»¶<br>
<img src="https://img-blog.csdnimg.cn/eb3b4b46f8ab47d391244904ecb6e89e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp client-adapter.es7x-1.1.5-jar-with-dependencies.jar root@172.16.188.2:/var/local</span><br></pre></td></tr></table></figure>
<p>4ã€ç»™è¯¥æ–‡ä»¶èµ‹æƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/local/client-adapter.es7x-1.1.5-jar-with-dependencies.jar </span><br></pre></td></tr></table></figure>
<p>5ã€é‡å¯æœåŠ¡</p>
<h4 id="10-canalparseexception-javaioioexception-eof-encountered"><a class="markdownIt-Anchor" href="#10-canalparseexception-javaioioexception-eof-encountered">#</a> 10 CanalParseException: java.io.IOException: EOF encountered</h4>
<p>å°† lib ç›®å½•ä¸‹çš„ mysql é©±åŠ¨å™¨æ›¿æ¢ä¸º<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql8&amp;spm=1001.2101.3001.7020"> mysql8</a>.0ï¼Œå¹¶é™„æƒã€‚å‚è€ƒä¸Šè¿°</p>
<h1 id="11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack"><a class="markdownIt-Anchor" href="#11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack">#</a> 11. CanalClientException: java.io.IOException: Broken pipe Error sync but ACK</h1>
<p>æœåŠ¡è¿æ¥æ–­å¼€äº†ï¼Œå°† deployer å’Œ adapter éƒ½å…³é—­ï¼Œå…ˆå¯åŠ¨ deployer å†å¯åŠ¨ adapter</p>
<h1 id="12-documentmissingexception_doc1413298413755211778-document-missing"><a class="markdownIt-Anchor" href="#12-documentmissingexception_doc1413298413755211778-document-missing">#</a> 12. DocumentMissingException[[_doc][1413298413755211778]: document missing]</h1>
<p>1ã€es é›†ç¾¤å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´ doc æ— æ³•åˆ†é…ã€‚å¸¸è§çš„æ˜¯åˆ†ç‰‡æ•°çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯å‰¯æœ¬åˆ†ç‰‡è¿‡å¤šï¼Œå¯¼è‡´é›†ç¾¤æŠ¥é»„<br>
è§£å†³ï¼š<br>
å› ä¸ºæˆ‘çš„æ˜¯ es å•èŠ‚ç‚¹ï¼Œæ‰€ä»¥å°†ä¸»åˆ†ç‰‡æ•°è®¾ç½®ä¸º 1ï¼Œå‰¯æœ¬åˆ†ç‰‡è®¾ç½®ä¸º 0ã€‚ä¸ç”³æ˜çš„è¯é»˜è®¤åˆ›å»ºå‰¯æœ¬åˆ†ç‰‡æ•°ä¸º 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">PUT user</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;code&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;email&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;realName&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;roleId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;postId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;deptId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_replicas&quot;: 0,</span><br><span class="line">    &quot;number_of_shards&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€ä¿®æ”¹çš„ mysql æ•°æ®åº“æ•°æ®ï¼Œåœ¨ es ä¸­ä¸å­˜åœ¨ã€‚å…ˆè¿›è¡Œå…¨é‡åŒæ­¥ï¼Œå†è¿›è¡Œå¢é‡åŒæ­¥</p>
<p>åœ¨ conf/example/instance.properties ä¸­ä¿®æ”¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å…¨é‡åŒæ­¥</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 ä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception"><a class="markdownIt-Anchor" href="#13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception">#</a> 13. ERROR c.a.otter.canal.server.netty.handler.SessionHandler - something goes wrong with channel:[id: 0x23d9cad9, /127.0.0.1:46472 :&gt; /127.0.0.1:11111], exception=java.nio.channels.ClosedChannelException</h1>
<p>è¿™æ˜¯ç”±äº deployer ä¸­çš„ conf/example/meta.dat ä¸ instance.properties æ–‡ä»¶ä¸­çš„ journalName,position,timestamp ä¸ä¸€è‡´å¯¼è‡´çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢bin logä½ç½®</span><br><span class="line">show master status;</span><br><span class="line"># å¦‚æœæ˜¾ç¤ºçš„binlogä¸ä¸º000001å¯ä»¥æ‰§è¡Œä»¥ä¸‹è¯­å¥é‡ç½®binlogï¼ˆè½»æ˜“åˆ«æ“ä½œï¼Œæœ€å¥½è®©ä¸“ä¸šçš„è¿ç»´äººå‘˜æ“ä½œï¼‰</span><br><span class="line"># è¯¥æ“ä½œä¼šé‡æ–°ç”Ÿæˆbinlogï¼Œä¹‹å‰çš„binlogå°±ä¼šæ¸…ç©ºï¼Œä¹‹å‰çš„æ•°æ®å°±ä¸ä¼šå†åŒæ­¥</span><br><span class="line">reset master;</span><br><span class="line"># åˆ·æ–°logæ—¥å¿—ï¼Œè‡ªæ­¤åˆ»å¼€å§‹äº§ç”Ÿä¸€ä¸ªæ–°ç¼–å·çš„binlogæ—¥å¿—æ–‡ä»¶</span><br><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/849d7b41b8c348dead0670db96717068.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å°† meta.dat åˆ é™¤æˆ–è€…ä¿®æ”¹ä¸€è‡´å³å¯ã€‚åˆ é™¤åå°†ä¼šæŒ‰ç…§ instance.properties ä¸­è®¾ç½®çš„èµ·ç‚¹åŒæ­¥ï¼Œç”Ÿäº§ç¯å¢ƒè€ƒè™‘å¥½éœ€è¦åå†åˆ é™¤ã€‚</p>
<p>å¦‚æœæƒ³è¦å°†ä¹‹å‰çš„æ•°æ®ä¹ŸåŒæ­¥çš„è¯ï¼Œå¯ä»¥å°†æ•°æ®åº“å…ˆå¯¼å‡ºï¼Œå†é‡æ–°å¯¼å…¥ä¸€éï¼Œå³å¯é‡æ–°ç”Ÿæˆ binlogï¼Œå®ç°æ•°æ®çš„å…¨é‡åŒæ­¥</p>
<h1 id="14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 14. Received error packet: errno = 1236, sqlstate = HY000 errmsg = Could not find first log file name in binary log index file</h1>
<p>mysql bin log æ•°æ®ä¸åŒæ­¥ï¼Œåˆ·æ–°ä¸€ä¸‹å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<h1 id="15-binlogä¹Ÿè®¾ç½®ä¸º000001äº†timestampä¹Ÿè®¾ç½®äº†ä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥"><a class="markdownIt-Anchor" href="#15-binlogä¹Ÿè®¾ç½®ä¸º000001äº†timestampä¹Ÿè®¾ç½®äº†ä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥">#</a> 15. binlog ä¹Ÿè®¾ç½®ä¸º 000001 äº†ï¼Œtimestamp ä¹Ÿè®¾ç½®äº†ï¼Œä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥</h1>
<p>1ã€åˆ é™¤ conf/example/meta.dat<br>
2ã€è°ƒæ•´ conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 ä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<p>3ã€é‡å¯ deployer</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ bin log æ˜¯åªä¼šè®°å½•å¢é‡æ“ä½œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å¯ bin log ä¹‹å‰çš„å†å²æ•°æ®æ˜¯ä¸ä¼šè®°å½•çš„ï¼Œå¦‚æœéœ€è¦åŒæ­¥è€…ä¹‹å‰çš„æ•°æ®ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸‰ä¸ªåŠæ³•ï¼š<br>
ï¼ˆ1ï¼‰<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_24950043/article/details/122483061">é€šè¿‡ logstash-input-jdbc æ¥å®ç°</a><br>
ï¼ˆ2ï¼‰é€šè¿‡ä¸šåŠ¡ä»£ç æ¥å®ç°ï¼ˆåç»­ä¼šè¯¦ç»†è®²è§£è¿™ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥å…³æ³¨æˆ‘åç»­çš„åšå®¢ï¼‰<br>
ï¼ˆ3ï¼‰å¤åˆ¶åŸæ•°æ®åº“æ•°æ®åˆ°å¼€å¯äº† binlog çš„ä»æ•°æ®åº“ï¼Œç„¶åä»ä»æ•°æ®åº“åŒæ­¥</p>
<h1 id="16-adapterå¯åŠ¨æŠ¥é”™something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null"><a class="markdownIt-Anchor" href="#16-adapterå¯åŠ¨æŠ¥é”™something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null">#</a> 16. adapter å¯åŠ¨æŠ¥é”™ï¼šsomething goes wrong when starting up the canal client adapters: java.lang.NullPointerException: null</h1>
<p>è¿™ä¸ªæŠ¥é”™æ˜¯ç©ºæŒ‡é’ˆæŠ¥é”™ï¼Œå¾ˆæ˜æ˜¾æ˜¯å“ªé‡Œè·å–ä¸ºç©ºçš„ï¼Œè¿™ç§é”™è¯¯æ²¡æœ‰å›ºå®šçš„åŸå› ï¼Œä½†å¤§æ¦‚ç‡ä¸Šå¯ä»¥é”å®šé…ç½®æ–‡ä»¶çš„é—®é¢˜</p>
<p>1ã€adapter çš„é…ç½®æ–‡ä»¶ä¸­æ˜¯æœ‰åŒ…å«äº† mysqlã€esã€mqã€zk ç­‰é…ç½®ï¼Œå¦‚æœä¸éœ€è¦çš„é…ç½®é¡¹ï¼Œå°±å°†å…¶æ³¨é‡Šæ‰ï¼Œä¸è¦æ‰“å¼€</p>
<p>æ¯”å¦‚æˆ‘è¿™é‡Œçš„æŠ¥é”™åŸå› å°±æ˜¯å› ä¸ºæ‰“å¼€äº† zookeeperHostsï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®å…·ä½“å€¼ï¼Œæ‰€ä»¥å¯¼è‡´äº†ç©ºæŒ‡é’ˆï¼Œå› ä¸ºæˆ‘ä¸éœ€è¦ zkï¼Œå°†å…¶æ³¨é‡Šæ‰å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># flatMessage: true</span><br><span class="line"># zookeeperHosts:</span><br></pre></td></tr></table></figure>
<p>2ã€æŸäº›å¿…è¦çš„é…ç½®æ²¡æœ‰è®¾ç½®ï¼Œå¿«é€Ÿæ’æŸ¥çš„æ–¹å¼å°±æ˜¯æ ¹æ®å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶å¯¹æ¯”æ’é”™<br>
å¯ä»¥å‚è€ƒå¦‚ä¸‹é…ç½®æ–‡ä»¶</p>
<p>3ã€é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹æ’ç‰ˆé”™ä½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br><span class="line">    time-zone: GMT+8</span><br><span class="line">    default-property-inclusion: non_null</span><br><span class="line"></span><br><span class="line">canal.conf:</span><br><span class="line">  mode: tcp #tcp kafka rocketMQ rabbitMQ</span><br><span class="line">  flatMessage: true</span><br><span class="line">  zookeeperHosts:</span><br><span class="line">  syncBatchSize: 1000</span><br><span class="line">  retries: 0</span><br><span class="line">  timeout:</span><br><span class="line">  accessKey:</span><br><span class="line">  secretKey:</span><br><span class="line">  consumerProperties:</span><br><span class="line">    # canal tcp consumer</span><br><span class="line">    canal.tcp.server.host: 127.0.0.1:11111</span><br><span class="line">    canal.tcp.zookeeper.hosts:</span><br><span class="line">    canal.tcp.batch.size: 500</span><br><span class="line">    canal.tcp.username:</span><br><span class="line">    canal.tcp.password:</span><br><span class="line">    # kafka consumer</span><br><span class="line">    kafka.bootstrap.servers: 127.0.0.1:9092</span><br><span class="line">    kafka.enable.auto.commit: false</span><br><span class="line">    kafka.auto.commit.interval.ms: 1000</span><br><span class="line">    kafka.auto.offset.reset: latest</span><br><span class="line">    kafka.request.timeout.ms: 40000</span><br><span class="line">    kafka.session.timeout.ms: 30000</span><br><span class="line">    kafka.isolation.level: read_committed</span><br><span class="line">    kafka.max.poll.records: 1000</span><br><span class="line">    # rocketMQ consumer</span><br><span class="line">    rocketmq.namespace:</span><br><span class="line">    rocketmq.namesrv.addr: 127.0.0.1:9876</span><br><span class="line">    rocketmq.batch.size: 1000</span><br><span class="line">    rocketmq.enable.message.trace: false</span><br><span class="line">    rocketmq.customized.trace.topic:</span><br><span class="line">    rocketmq.access.channel:</span><br><span class="line">    rocketmq.subscribe.filter:</span><br><span class="line">    # rabbitMQ consumer</span><br><span class="line">    rabbitmq.host:</span><br><span class="line">    rabbitmq.virtual.host:</span><br><span class="line">    rabbitmq.username:</span><br><span class="line">    rabbitmq.password:</span><br><span class="line">    rabbitmq.resource.ownerId:</span><br><span class="line">  srcDataSources:</span><br><span class="line">    defaultDS:</span><br><span class="line">      url: jdbc:mysql://172.16.188.1:3306/bladex?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">  canalAdapters:</span><br><span class="line">  - instance: example # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g1</span><br><span class="line">      outerAdapters:</span><br><span class="line">      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        hosts: http://172.16.188.7:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          # security.auth: test:123456 #  only used for rest mode</span><br><span class="line">          cluster.name: cluster1</span><br></pre></td></tr></table></figure>
<h1 id="17-field-error-in-object-target-on-field-esmapping-rejected-value"><a class="markdownIt-Anchor" href="#17-field-error-in-object-target-on-field-esmapping-rejected-value">#</a> 17 Field error in object â€˜targetâ€™ on field â€˜esMappingâ€™: rejected value [];</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Field error in object &#x27;target&#x27; on field &#x27;esMapping&#x27;: rejected value []; codes </span><br><span class="line">[typeMismatch.target.esMapping,typeMismatch.esMapping,typeMismatch.com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping,typeMismatch]; </span><br><span class="line">arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [target.esMapping,esMapping]; arguments []; default message [esMapping]]; default message [Failed to convert property value of type &#x27;java.lang.String&#x27; to required type </span><br><span class="line">&#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;; nested </span><br><span class="line">exception is java.lang.IllegalStateException: Cannot convert value of type &#x27;java.lang.String&#x27; to required type</span><br><span class="line"> &#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;: no </span><br><span class="line"> matching editors or conversion strategy found]</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯é…ç½®æ–‡ä»¶é—®é¢˜ï¼Œæ£€æŸ¥ es ä¸‹çš„é…ç½® yml æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ sql è¯­å¥çš„è¯­æ³•æ˜¯å¦æœ‰é—®é¢˜</p>
<h1 id="18-javautilnosuchelementexception"><a class="markdownIt-Anchor" href="#18-javautilnosuchelementexception">#</a> 18 java.util.NoSuchElementException</h1>
<p>æ²¡æœ‰æ‰¾åˆ°å¯¹åº”å­—æ®µå¯¼è‡´</p>
<p>æ£€æŸ¥ä¸‹ canal é…ç½®æ–‡ä»¶ä¸­çš„å­—æ®µæ˜¯å¦åœ¨ es mapping ä¸­æœ‰å¯¹åº”çš„ï¼Œå¤§å°å†™æ˜¯å¦ä¸€è‡´ï¼Œæ˜¯å¦æœ‰é—æ¼</p>
<p>å› ä¸ºæˆ‘çš„æ“ä½œæ˜¯ mysql åŒæ­¥è‡³ esï¼Œæ‰€ä»¥è¿™é‡Œè¯´æ˜å‡ é¡¹å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼š<br>
1ã€canal é…ç½®æ–‡ä»¶ä¸­çš„ sql ä¸­æ˜¯å¦å¤§å°å†™ä¸€è‡´ï¼Œcanal æ˜¯åŒºåˆ†å¤§å°å†™çš„<br>
 2ã€sql ä¸­è®¾ç½®çš„åˆ«åæ˜¯å¦ä¸ es mappings ä¸­çš„åç§°ä¸€è‡´ï¼Œå…è®¸ es ä¸­çš„éƒ¨åˆ†å­—æ®µä¸ºç©ºï¼Œä½†æ˜¯ä¸å…è®¸ sql ä¸­æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µåœ¨ es mappings ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„å­—æ®µ<br>
 3ã€canal é…ç½®æ–‡ä»¶ä¸­çš„ dataSourceKey æ˜¯å¦æ­£ç¡®ï¼Œå…¶å¯¹åº”åˆ° canal application.yml é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“æ˜¯å¦æ­£ç¡®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa</span><br></pre></td></tr></table></figure>
<p>application.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">srcDataSources:</span><br><span class="line">    aaa: # ä¸ä¹‹å¯¹åº”</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/aaa?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    xxx:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/xxx?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    yyy:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/yyy?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br></pre></td></tr></table></figure>
<p>4ã€canal é…ç½®æ–‡ä»¶ä¸­çš„æ’ç‰ˆæ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ³¨æ„_index,_type ç­‰å±æ€§è¦æ”¾åœ¨ esMappings ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: dept </span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id,</span><br><span class="line">        t.id as _id,</span><br><span class="line">        t.dept_name as deptName,</span><br><span class="line">        t.dept_category as deptCategory,</span><br><span class="line">        t.parent_id as parentId,</span><br><span class="line">        t.ancestors as ancestors,</span><br><span class="line">        t.third_party_id as thirdPartyId,</span><br><span class="line">        t.phone as phone,</span><br><span class="line">        t.address as address,</span><br><span class="line">        t.is_deleted as isDeleted</span><br><span class="line">      from</span><br><span class="line">         dept t&quot;</span><br><span class="line">  #etlCondition: &quot;where t.update_time&gt;=&#x27;&#123;0&#125;&#x27;&quot;</span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>5ã€sql æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µç±»å‹ä¸ es mappings ä¸­çš„å­—æ®µæ•°æ®ç±»å‹æ˜¯å¦ä¸€è‡´</p>
<p>6ã€å¤šè¡¨åŒæ­¥åˆ°åŒä¸€ä¸ªç´¢å¼•æ—¶ï¼Œå¦‚æœéƒ½æœ‰åŒä¸€ä¸ªå¸¸é‡åˆ—ä¸”å€¼ä¸åŒæ—¶ä¼šæŠ¥é”™ã€‚<br>
å¦‚ä¸‹æ‰€ç¤ºçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½æœ‰ userSource å¸¸é‡åˆ—ç”¨äºåŒºåˆ†ä¸åŒçš„æ•°æ®æ¥æºï¼Œä½†æ˜¯å¦‚ä¸‹çš„é…ç½®ä¼šæŠ¥é”™ã€‚<br>
xxx.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        0 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>yyy.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        1 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user_wx t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<h1 id="19-adapteræ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æ²¡æœ‰è¯»å–binlog-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#19-adapteræ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æ²¡æœ‰è¯»å–binlog-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 19. adapter æ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯æ²¡æœ‰è¯»å– binlog ï½œ Could not find first log file name in binary log index file</h1>
<p>adapter æ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œäºæ˜¯å»æŸ¥çœ‹ deployer æ—¥å¿—ï¼Œè¿™é‡Œçš„ example æ˜¯ä½ é…ç½®çš„å®ä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat logs/example/example.log</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not find first log file name in binary log index file</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€æ—¢ç„¶é—®é¢˜æ˜¯æ²¡æœ‰æ‰¾åˆ°æ•°æ®åº“çš„ binglog æ–‡ä»¶ä½ç½®ï¼Œé‚£ä¹ˆå°±æŸ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„ binlog æ–‡ä»¶ä½ç½®ï¼Œç™»é™† mysql æ‰§è¡Œ</p>
<p>2.1 å¦‚æœä½ æ˜¯åšå¢é‡åŒæ­¥ï¼Œé‚£ä¹ˆæŸ¥è¯¢å½“å‰ binlog ä½ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ä¿®æ”¹ conf/example/instance.properties æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># è¿™é‡Œçš„æ–‡ä»¶åè¦ä¸ä¸Šé¢çš„ä¿æŒä¸€è‡´ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯æ–‡ä»¶åä¸ä¸€è‡´ï¼Œå†™æˆäº†mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000003 </span><br><span class="line">canal.instance.master.position=5921</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>2.2 å¦‚æœä½ è¦åšå…¨é‡åŒæ­¥ï¼ŒæŸ¥è¯¢ binlog æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binary logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/b4736c68b0f64b80bb509d395a627fb1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># è¿™é‡Œçš„æ–‡ä»¶åè¦ä¸ä¸Šé¢çš„ä¿æŒä¸€è‡´ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯æ–‡ä»¶åä¸ä¸€è‡´ï¼Œå†™æˆäº†mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000001</span><br><span class="line"># ä½ç½®ä»0å¼€å§‹</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>3ã€é‡å¯ deployer å’Œ adapter</p>
<h1 id="20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception"><a class="markdownIt-Anchor" href="#20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception">#</a> 20. ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</h1>
<p>å¯åŠ¨ adapter æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 06:28:44.444 [pool-2-thread-1] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</span><br><span class="line">java.lang.RuntimeException: java.lang.NullPointerException</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:116) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:64) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:115) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:94) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.batchSync(AdapterProcessor.java:139) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$1(AdapterProcessor.java:97) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.CopyOnWriteArrayList.forEach(CopyOnWriteArrayList.java:895) ~[na:1.8.0_312]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$2(AdapterProcessor.java:94) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[na:1.8.0_312]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_312]</span><br><span class="line">Caused by: java.lang.NullPointerException: null</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es7x.support.ES7xTemplate.insert(ES7xTemplate.java:79) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.singleTableSimpleFiledInsert(ESSyncService.java:448) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.insert(ESSyncService.java:139) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:99) ~[na:na]</span><br><span class="line">        ... 11 common frames omitted</span><br><span class="line">2022-05-21 06:28:44.449 [Thread-4] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - Outer adapter sync failed!  Error sync but ACK!</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ adapter/application.ymlï¼Œç»™ outerAdapters é…ç½®ä¸€ä¸ª keyï¼Œæ³¨æ„è¿™é‡Œå¦‚æœæœ‰å¤šä¸ª adapter å®ä¾‹ï¼Œé‚£ä¹ˆå°±é…ç½®ä¸åŒçš„ key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">canalAdapters:</span><br><span class="line">  - instance: test # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g2</span><br><span class="line">      outerAdapters:</span><br><span class="line">#      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey3 # é…ç½®key</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        #hosts: http://192.168.101.11:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        hosts: http://192.168.244.11:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          security.auth: elastic:elastic #  only used for rest mode</span><br><span class="line">          cluster.name: blade-cluster</span><br></pre></td></tr></table></figure>
<h1 id="21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table"><a class="markdownIt-Anchor" href="#21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table">#</a> 21. CanalParseException: parse row data failed. | column size is not match for table</h1>
<p>deployser æ—¥å¿—æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 07:45:15.651 [MultiStageCoprocessor-Parser-fleet-0] ERROR com.alibaba.otter.canal.common.utils.NamedThreadFactory - from MultiStageCoprocessor-Parser-fleet-0</span><br><span class="line">com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¸­å·²ç»ç»™å‡ºæ˜ç¡®æç¤ºäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>2ã€è¯¥é”™è¯¯å®˜æ–¹ä¸­æœ‰è§£é‡Š<br>
<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/TableMetaTSDB">å®˜æ–¹æ–‡æ¡£ TableMetaTSDB</a><br>
 åœ¨ instance.properties ä¸­è®¾ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.tsdb.spring.xml=classpath:spring/tsdb/h2-tsdb.xml</span><br><span class="line"># table meta tsdb info</span><br><span class="line">canal.instance.tsdb.enable=true</span><br><span class="line"># ä»¥ä¸‹é…ç½®ä¸ç”¨å¼€å¯ï¼Œå› ä¸ºåœ¨canal.propertiesä¸­å·²ç»è®¾ç½®è¿‡äº†ï¼Œåªè¦æ²¡æœ‰æ‰‹åŠ¨å…³é—­è¿‡å°±ä¸ç”¨å†é…ç½®äº†</span><br><span class="line">#canal.instance.tsdb.dir=$&#123;canal.file.data.dir:../conf&#125;/$&#123;canal.instance.destination:&#125;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;/h2;CACHE_SIZE=1000;MODE=MYSQL;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb</span><br><span class="line">#canal.instance.tsdb.dbUsername=canal</span><br><span class="line">#canal.instance.tsdb.dbPassword=canal</span><br></pre></td></tr></table></figure>
<p>3ã€ä¸€èˆ¬å°†è¿™ä¸ªå¼€å¯å°±è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå³æ—¶å°†å…¶å¼€å¯è¿˜æ˜¯æŠ¥é”™ï¼ŒæŸ¥é˜…ç›¸å…³èµ„æ–™æœ‰è¯´å°† <code>canal.instance.tsdb.enable</code>  è®¾ç½®ä¸º false åé‡å¯è§£å†³çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå°†å…¶è®¾ç½®ä¸º false åä¾æ—§æ²¡æœ‰è§£å†³</p>
<p>å®åœ¨æ²¡æœ‰å…¶ä»–åŠæ³•äº†ï¼ŒæŸ¥é˜…å®˜æ–¹ githubï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› æ˜¯å› ä¸ºè¡¨ç»“æ„å‘ç”Ÿè¿‡å˜åŒ–ï¼Œä½†æ˜¯ binlog ä¸­è¯»å–åˆ°çš„ä¸ç°åœ¨çš„è¡¨ç»“æ„ä¸ä¸€è‡´å¯¼è‡´ã€‚</p>
<p>äºæ˜¯ç›´æ¥è·³è¿‡è¯¥ binlog checkpointï¼Œä¹Ÿå°±æ˜¯å°† binlog çš„è¯»å–ä½ç½®è®¾ç½®ä¸ºå½“å‰çš„æœ€æ–° binlog ä½ç½®</p>
<p>ï¼ˆ1ï¼‰æŸ¥é˜…å½“å‰ binlog æœ€æ–°ä½ç½®ï¼Œmysql ä¸­æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ï¼ˆ2ï¼‰å°†è¯»å–ä½ç½®è¯¥ä¸ºæœ€æ–°ï¼Œä¿®æ”¹ deployer conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=162.14.99.4:3306</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000002</span><br><span class="line">canal.instance.master.position=226586328</span><br><span class="line"># å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³å½¢å¼</span><br><span class="line">canal.instance.master.timestamp=1653140932</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰é‡å¯ deployer , adapter<br>
ï¼ˆ4ï¼‰å› ä¸ºè¯»å–çš„æ˜¯æœ€æ–°çš„ binlogã€‚ä¸ºäº†æŠŠå½“å‰çš„æ•°æ®åŒæ­¥è¿›æ¥ï¼Œå°†éœ€è¦åŒæ­¥çš„è¡¨æˆ–åº“å¯¼å‡ºï¼Œç„¶åå†å¯¼å…¥ä¸€éã€‚é—®é¢˜è§£å†³ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆè¦è°¨æ…ï¼Œç”Ÿäº§ç¯å¢ƒå› ä¸ºæ—¶æ—¶åˆ»åˆ»åœ¨äº§ç”Ÿæ•°æ®ï¼Œå¯è¡Œæ€§å¾ˆä½ï¼Œæ‰€ä»¥çœ‹è¦ä¹ˆè®¾ç½®ä¸€ä¸ªåœæœºç»´æŠ¤æ¥è¿›è¡Œå®æ“ï¼‰</p>
<h1 id="22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0"><a class="markdownIt-Anchor" href="#22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0">#</a> 22. use gtid and TableMeta TSDB should be config timestamp &gt; 0</h1>
<p>åœ¨ instance.properties ä¸­è®¾ç½®æ—¶é—´æˆ³</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string"><a class="markdownIt-Anchor" href="#23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string">#</a> 23. RuntimeException: com.alibaba.fastjson.JSONException: unclosed string</h1>
<p>è¯¥é”™è¯¯æ˜¯å› ä¸º sql ä¸­ä½¿ç”¨äº† <code>group_concat</code>  å‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°é»˜è®¤é•¿åº¦æ˜¯ 1024ï¼Œè¶…è¿‡çš„ä¼šè¢«æˆªå–ï¼Œå¯¼è‡´å‡ºç°äº† json æ ¼å¼çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæ²¡æœ‰æ­£ç¡®çš„å…³é—­ json</p>
<p>è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ my.cnfï¼Œæ‰©å¤§ group_concat_max_len</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat_max_len = 102400</span><br></pre></td></tr></table></figure>
<p>2ã€é‡å¯ mysql</p>
<h1 id="24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause"><a class="markdownIt-Anchor" href="#24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause">#</a> 24. MySQLSyntaxErrorException: Unknown column â€˜_v._idâ€™ in â€˜where clauseâ€™</h1>
<p>sql ä¸­æ²¡æœ‰ <code>_id</code>  å­—æ®µå¯¼è‡´ï¼Œä½¿ç”¨ as å°† id å‘½ååˆ«åï¼š <code>select id as _id</code></p>
<h1 id="25-adapterä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ä½†esä¸­æ•°æ®æœªåŒæ­¥"><a class="markdownIt-Anchor" href="#25-adapterä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ä½†esä¸­æ•°æ®æœªåŒæ­¥">#</a> 25. adapter ä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ï¼Œä½† es ä¸­æ•°æ®æœªåŒæ­¥</h1>
<p>æˆ‘è¿™é‡Œå‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯åœ¨ canal1.1.6 ç‰ˆæœ¬ä¸­ï¼ŒåŸå› æ˜¯ es7 æ–‡ä»¶å¤¹ä¸­çš„ <code>.yml</code>  æ–‡ä»¶ä¸­ä¹¦å†™çš„ sql é‡Œä½¿ç”¨äº† `` å°†è¡¨åæ‹¬èµ·æ¥ï¼Œå¯¼è‡´æœªè¯†åˆ«ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name,age <span class="keyword">from</span> `<span class="keyword">user</span>`</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
å°† `` å»æ‰å³å¯</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-06T10:46:26.000Z" title="2020-12-6 18:46:26">2020-12-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-10T05:17:15.806Z" title="2023-5-10 13:17:15">2023-05-10</time>æ›´æ–°</span><span class="level-item">19 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2868ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/06/%E3%80%90MYSQL%E3%80%91%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%85%AC%E5%85%B1%E8%A1%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%92%8C%E8%AE%B2%E8%A7%A3/">ã€MYSQLã€‘æ°´å¹³åˆ†è¡¨ã€åˆ†åº“å’Œå‚ç›´åˆ†è¡¨ã€åˆ†åº“å’Œå…¬å…±è¡¨çš„ä»£ç å®ç°å’Œè®²è§£</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="æ–‡ç« ç›®å½•"><a class="markdownIt-Anchor" href="#æ–‡ç« ç›®å½•">#</a> æ–‡ç« ç›®å½•</h3>
<ul>
<li><a href="#_1">ä¸€ã€æ•™å­¦è®²è§£è§†é¢‘</a></li>
<li><a href="#_3">äºŒã€ç¯å¢ƒå‡†å¤‡</a></li>
<li><a href="#_99">ä¸‰ã€æ°´å¹³åˆ†è¡¨</a></li>
<li>
<ul>
<li><a href="#1_100">1. æ¦‚å¿µ</a></li>
<li><a href="#2_114">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_221">å››ã€æ°´å¹³åˆ†åº“</a></li>
<li>
<ul>
<li><a href="#1_223">1. æ¦‚å¿µ</a></li>
<li><a href="#2_229">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_351">äº”ã€å‚ç›´åˆ†è¡¨</a></li>
<li>
<ul>
<li><a href="#1_352">1. æ¦‚å¿µ</a></li>
<li><a href="#2_356">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_358">å…­ã€å‚ç›´åˆ†åº“</a></li>
<li>
<ul>
<li><a href="#1_359">1. æ¦‚å¿µ</a></li>
<li><a href="#2_362">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_364">ä¸ƒã€å…¬å…±è¡¨</a></li>
<li>
<ul>
<li><a href="#1_365">1. æ¦‚å¿µ</a></li>
<li><a href="#2_367">2. ä»£ç </a></li>
</ul>
</li>
</ul>
<h1 id="ä¸€-æ•™å­¦è®²è§£è§†é¢‘"><a class="markdownIt-Anchor" href="#ä¸€-æ•™å­¦è®²è§£è§†é¢‘">#</a> ä¸€ã€æ•™å­¦è®²è§£è§†é¢‘</h1>
<p>æ•™å­¦è®²è§£è§†é¢‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tx4y1371w">è§†é¢‘åœ°å€</a></p>
<h1 id="äºŒ-ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#äºŒ-ç¯å¢ƒå‡†å¤‡">#</a> äºŒã€ç¯å¢ƒå‡†å¤‡</h1>
<ul>
<li>
<p>æ“ä½œç³»ç»Ÿï¼šWin10</p>
</li>
<li>
<p>æ•°æ®åº“ï¼šMySQL5.7</p>
</li>
<li>
<p>JDKï¼š64 ä½ jdk1.8.0_202</p>
</li>
<li>
<p>åº”ç”¨æ¡†æ¶ï¼šspring-boot-2.1.3.RELEASE</p>
</li>
<li>
<p>Sharding-JDBCï¼šsharding-jdbc-spring-boot-starter-4.0.0-RC1</p>
</li>
</ul>
<p>å¯¹åº”çš„ pom.xml ä¾èµ–ä»£ç </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yjq.programmer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥mysqlè¿æ¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥sharding-jdbcè¿æ¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0-RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥é˜¿é‡Œå·´å·´druidè¿æ¥æ± --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥æµ‹è¯•ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é›†æˆmybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é›†æˆjunitæµ‹è¯• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="ä¸‰-æ°´å¹³åˆ†è¡¨"><a class="markdownIt-Anchor" href="#ä¸‰-æ°´å¹³åˆ†è¡¨">#</a> ä¸‰ã€æ°´å¹³åˆ†è¡¨</h1>
<h2 id="1æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ">#</a> 1. æ¦‚å¿µ</h2>
<p>æ°´å¹³åˆ†è¡¨æ˜¯åœ¨ <code>åŒä¸€ä¸ª</code> æ•°æ®åº“å†…ï¼ŒæŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ® <code>æŒ‰ä¸€å®šè§„åˆ™</code> æ‹†åˆ†åˆ°å¤šä¸ª <code>è¡¨</code> ä¸­ã€‚<br>
å› æ­¤ï¼Œç›®å‰æˆ‘åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­å‡†å¤‡äº†ä¸¤ä¸ªè¡¨ï¼Œ <code>t_user_1</code>  å’Œ <code>t_user_2</code> ï¼Œå¦‚ä¸‹å›¾ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b9b8ccb2a36e4028bb013590fc3e84ea.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
è¡¨ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_user_1` (</span><br><span class="line">  `<span class="built_in">id</span>` bigint(20) NOT NULL,</span><br><span class="line">  `name` varchar(100) DEFAULT NULL,</span><br><span class="line">  `sex` int(2) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="2ä»£ç "><a class="markdownIt-Anchor" href="#2ä»£ç ">#</a> 2. ä»£ç </h2>
<p>â‘ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬çš„ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰æ•°æ®æº</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actualâ€dataâ€nodes=m1.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºSNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥åŒ…æ‹¬åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.shardingâ€column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.algorithmâ€expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ—¥å¿—é…ç½®</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€sqlè¾“å‡ºæ—¥å¿—</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapperæ–‡ä»¶æ‰«æè·¯å¾„</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆå®šä¹‰æ•°æ®æº m1ï¼Œå¹¶å¯¹ m1 è¿›è¡Œå®é™…çš„å‚æ•°é…ç½®ã€‚</li>
<li>æŒ‡å®š t_user è¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä»–åˆ†å¸ƒåœ¨ m1.t_user_1ï¼Œm1.t_user_2ã€‚</li>
<li>æŒ‡å®š t_user è¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸º SNOWFLAKEï¼ŒSNOWFLAKE æ˜¯ä¸€ç§åˆ†å¸ƒå¼è‡ªå¢ç®—æ³•ï¼Œä¿è¯ id å…¨å±€å”¯ä¸€ã€‚</li>
<li>å®šä¹‰ t_user åˆ†è¡¨ç­–ç•¥ï¼Œid ä¸ºå¶æ•°çš„æ•°æ®è½åœ¨ t_user_1ï¼Œä¸ºå¥‡æ•°çš„è½åœ¨ t_user_2ï¼Œæ‰€ä»¥åˆ†è¡¨ç­–ç•¥çš„è¡¨è¾¾å¼ä¸º t_user_$-&gt;{id% 2 + 1}ã€‚</li>
</ul>
<p><strong>è¸©å‘æ³¨æ„ï¼</strong> å¦‚æœå¯åŠ¨é¡¹ç›®æœ‰å¦‚ä¸‹æŠ¥é”™ï¼Œå¯èƒ½æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ <code>-&gt;</code>  æ²¡æœ‰ç”¨è‹±æ–‡ç±»å‹çš„ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1b3e0aca06df43c4bb2671eabc7a2e9d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9a9e406ab2bd4e3db3c55aac18a9b178.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„æ°´å¹³åˆ†è¡¨æƒ…å†µä¸‹ <code>æ’å…¥</code> å’Œ <code>æŸ¥è¯¢</code> çš„ç»“æœã€‚</p>
<p><code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name) values (<span class="comment">#&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;å°æ˜&quot;</span> + i);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser();</span><br><span class="line">    logger.info(<span class="string">&quot;æŸ¥è¯¢ç»“æœï¼š&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
 id ä¸ºå¥‡æ•°çš„è¢«æ’å…¥åˆ° t_user_2 è¡¨ï¼Œä¸ºå¶æ•°çš„è¢«æ’å…¥åˆ° t_user_1 è¡¨ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚<br>
 <code>æŸ¥è¯¢</code> <br>
<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=sharding-jdbc&amp;spm=1001.2101.3001.7020"> sharding-jdbc</a> åˆ†åˆ«å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ï¼›<strong>å¦‚æœæœ‰ä¼ å…¥ id è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¹Ÿä¼šæ ¹æ® t_user çš„åˆ†è¡¨ç­–ç•¥å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®</strong>ã€‚</p>
<h1 id="å››-æ°´å¹³åˆ†åº“"><a class="markdownIt-Anchor" href="#å››-æ°´å¹³åˆ†åº“">#</a> å››ã€æ°´å¹³åˆ†åº“</h1>
<h2 id="1æ¦‚å¿µ-2"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-2">#</a> 1. æ¦‚å¿µ</h2>
<p>æ°´å¹³åˆ†åº“æ˜¯æŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ <code>ä¸€å®šè§„åˆ™</code> æ‹†åˆ†åˆ°ä¸åŒçš„ <code>æ•°æ®åº“</code> ä¸­ï¼Œæ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚<br>
ç°åœ¨ï¼Œæˆ‘åœ¨ <code>æ°´å¹³åˆ†è¡¨</code> çš„åŸºç¡€ä¸Šå¤šåŠ äº†ä¸€ä¸ª db_user2 çš„æ•°æ®åº“ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/80d1a3af2700414b9a0850ae9172034a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ç„¶åä¸¤ä¸ªæ•°æ®åº“ä¸­çš„è¡¨ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œè¡¨ç»“æ„å’Œä¸Šé¢æ°´å¹³åˆ†è¡¨ç”¨çš„ä¿æŒä¸€æ ·ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9354ea1b1af043238412581e0769b3dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="2ä»£ç -2"><a class="markdownIt-Anchor" href="#2ä»£ç -2">#</a> 2. ä»£ç </h2>
<p>â‘ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬çš„ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰æ•°æ®æº</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1,m2</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m2.url=jdbc:mysql://127.0.0.1:3306/db_user2?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m2.username=root</span><br><span class="line">spring.shardingsphere.datasource.m2.password=</span><br><span class="line">spring.shardingsphere.datasource.m2.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m2.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.databaseâ€strategy.inline.shardingâ€column=sex</span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.databaseâ€strategy.inline.algorithmâ€expression=m$-&gt;&#123;sex % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actualâ€dataâ€nodes=m$-&gt;&#123;1..2&#125;.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºSNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥åŒ…æ‹¬åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.shardingâ€column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.algorithmâ€expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ—¥å¿—é…ç½®</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€sqlè¾“å‡ºæ—¥å¿—</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapperæ–‡ä»¶æ‰«æè·¯å¾„</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>é…ç½®äº†ä¸¤ä¸ªæ•°æ®æºï¼Œåˆ†é…æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“ db_user1 å’Œ db_user2ã€‚</li>
<li>é…ç½®åˆ†åº“ç­–ç•¥ï¼Œsex å­—æ®µä¸ºå¶æ•°çš„æ•°æ®è½åœ¨ m1 æ•°æ®æºï¼Œä¸ºå¥‡æ•°çš„è½åœ¨ m2 æ•°æ®æºï¼Œæ‰€ä»¥åˆ†åº“ç­–ç•¥çš„è¡¨è¾¾å¼ä¸º m$-&gt;{sex % 2 + 1}ã€‚</li>
<li>é…ç½®åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥å’Œä¸Šé¢æ°´å¹³åˆ†è¡¨ä¿æŒä¸€è‡´ã€‚</li>
<li>ä¹Ÿå°±æ˜¯å½“æœ‰æ•°æ®æ¥æ—¶ï¼Œå…ˆæ ¹æ® sex å­—æ®µåˆ¤æ–­è½å…¥å“ªä¸ªæ•°æ®æºï¼Œç„¶åå†æ ¹æ® id å­—æ®µæ¥åˆ¤æ–­è½å…¥å“ªä¸ªè¡¨ä¸­ã€‚</li>
</ul>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„æ°´å¹³åˆ†è¡¨æƒ…å†µä¸‹ <code>æ’å…¥</code> å’Œ <code>æŸ¥è¯¢</code> çš„ç»“æœã€‚</p>
<p><code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name, sex) values (<span class="comment">#&#123;name&#125;, #&#123;sex&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user t <span class="built_in">where</span> t.sex = <span class="comment">#&#123;sex&#125; and t.id = #&#123;id&#125;</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;å°æ˜&quot;</span> + i);</span><br><span class="line">        user.setSex(1);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setSex(1);</span><br><span class="line">    user.setId(821357967667363840L);</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser(user);</span><br><span class="line">    logger.info(<span class="string">&quot;æŸ¥è¯¢ç»“æœï¼š&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
 sex å­—æ®µä¸ºå¥‡æ•°çš„æ•°æ®è½å…¥ m2 æ•°æ®æºï¼Œä¸ºå¶æ•°çš„è½å…¥ m1 æ•°æ®æºã€‚åŒæ—¶ id å­—æ®µå€¼ä¸ºå¥‡æ•°çš„ï¼Œæ’å…¥ t_user_2 è¡¨ä¸­ï¼Œä¸ºå¶æ•°çš„æ’å…¥ t_user_1 è¡¨ä¸­ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚<br>
 <code>æŸ¥è¯¢</code> <br>
 sharding-jdbc åˆ†åˆ«å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ï¼›<strong>å¦‚æœæœ‰ä¼ å…¥ sex è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¼šæ ¹æ® t_user çš„åˆ†åº“ç­–ç•¥å»é”å®šæŸ¥å“ªä¸ªåº“ï¼Œå¦‚æœæœ‰ä¼ å…¥ id è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¼šæ ¹æ® t_user çš„åˆ†è¡¨ç­–ç•¥å»é”å®šæŸ¥å“ªä¸ªè¡¨</strong>ã€‚</p>
<h1 id="äº”-å‚ç›´åˆ†è¡¨"><a class="markdownIt-Anchor" href="#äº”-å‚ç›´åˆ†è¡¨">#</a> äº”ã€å‚ç›´åˆ†è¡¨</h1>
<h2 id="1æ¦‚å¿µ-3"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-3">#</a> 1. æ¦‚å¿µ</h2>
<p>å‚ç›´åˆ†è¡¨ä¸€èˆ¬å°±æ˜¯æŠŠè¡¨çš„ç»“æ„è¿›è¡Œæ”¹é€ ï¼Œå…³äºå¦‚ä½•æ”¹é€ ï¼Œå¯ä»¥æµè§ˆæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">åˆ†åº“åˆ†è¡¨ï¼šå‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ã€æ°´å¹³åˆ†è¡¨å››ä¸ªæ¦‚å¿µ</a><br>
<strong>å¤§è‡´çš„æ€è·¯å°±æ˜¯ï¼šå°†ä¸€ä¸ªè¡¨æŒ‰ç…§å­—æ®µåˆ†æˆå¤šè¡¨ï¼Œæ¯ä¸ªè¡¨å­˜å‚¨å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µã€‚</strong></p>
<h2 id="2ä»£ç -3"><a class="markdownIt-Anchor" href="#2ä»£ç -3">#</a> 2. ä»£ç </h2>
<p>æ— ä»£ç ï¼Œå‚ç›´åˆ†è¡¨å±äºè¡¨ç»“æ„è®¾è®¡å±‚é¢ã€‚</p>
<h1 id="å…­-å‚ç›´åˆ†åº“"><a class="markdownIt-Anchor" href="#å…­-å‚ç›´åˆ†åº“">#</a> å…­ã€å‚ç›´åˆ†åº“</h1>
<h2 id="1æ¦‚å¿µ-4"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-4">#</a> 1. æ¦‚å¿µ</h2>
<p>å‚ç›´åˆ†åº“å°±æ˜¯åœ¨ <code>å‚ç›´åˆ†è¡¨</code> æŠŠè¡¨è¿›è¡Œåˆ†ç±»åï¼Œæ”¾åˆ° <code>ä¸åŒçš„æ•°æ®åº“</code> ä¸­ã€‚æ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ <code>ä¸“åº“ä¸“ç”¨</code> ã€‚å…³äºå¦‚ä½•æ”¹é€ ï¼ŒåŒæ ·å¯ä»¥æµè§ˆæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">åˆ†åº“åˆ†è¡¨ï¼šå‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ã€æ°´å¹³åˆ†è¡¨å››ä¸ªæ¦‚å¿µ</a></p>
<h2 id="2ä»£ç -4"><a class="markdownIt-Anchor" href="#2ä»£ç -4">#</a> 2. ä»£ç </h2>
<p>æ— ä»£ç ï¼Œå‚ç›´åˆ†åº“å±äºæ•°æ®åº“è®¾è®¡å±‚é¢ã€‚</p>
<h1 id="ä¸ƒ-å…¬å…±è¡¨"><a class="markdownIt-Anchor" href="#ä¸ƒ-å…¬å…±è¡¨">#</a> ä¸ƒã€å…¬å…±è¡¨</h1>
<h2 id="1æ¦‚å¿µ-5"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-5">#</a> 1. æ¦‚å¿µ</h2>
<p>å…¬å…±è¡¨å±äºç³»ç»Ÿä¸­æ•°æ®é‡è¾ƒå°ï¼Œå˜åŠ¨å°‘ï¼Œè€Œä¸”å±äºé«˜é¢‘è”åˆæŸ¥è¯¢çš„ä¾èµ–è¡¨ã€‚å‚æ•°è¡¨ã€æ•°æ®å­—å…¸è¡¨ç­‰å±äºæ­¤ç±»å‹ã€‚ <code>å¯ä»¥å°†è¿™ç±»è¡¨åœ¨æ¯ä¸ªæ•°æ®åº“éƒ½ä¿å­˜ä¸€ä»½</code> ï¼Œæ‰€æœ‰æ›´æ–°æ“ä½œéƒ½åŒæ—¶å‘é€åˆ°æ‰€æœ‰åˆ†åº“æ‰§è¡Œã€‚</p>
<h2 id="2ä»£ç -5"><a class="markdownIt-Anchor" href="#2ä»£ç -5">#</a> 2. ä»£ç </h2>
<p>â‘ åªéœ€è¦åœ¨ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä¸­åŠ å…¥ä¸‹é¢è¿™è¡Œæ¥æŒ‡æ˜å…¬å…±è¡¨å°±è¡Œã€‚<br>
 <code>å¦‚æœæœ‰å¤šä¸ªå…¬å…±è¡¨ï¼Œç”¨é€—å·æ‹¼æ¥å°±è¡Œ</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¬å…±è¡¨è®¾ç½®</span></span><br><span class="line">spring.shardingsphere.sharding.broadcastâ€tables=t_dict</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„å…¬å…±è¡¨çš„ <code>æ’å…¥</code> çš„ç»“æœã€‚<br>
 <code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface DictDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertDict(Dict dict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.DictDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertDict&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.Dict&quot;</span>&gt;</span><br><span class="line">        insert into t_dict(<span class="built_in">id</span>, name) values (<span class="comment">#&#123;id&#125;, #&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsertDict</span></span>() &#123;</span><br><span class="line">    Dict dict = new Dict();</span><br><span class="line">    dict.setId(1);</span><br><span class="line">    dict.setName(<span class="string">&quot;å­—å…¸åç§°&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(dictDao.insertDict(dict) == 1) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
æ’å…¥çš„æ•°æ®åœ¨ <code>æ¯ä¸ªåº“ä¸­çš„å¯¹åº”çš„å…¬å…±è¡¨</code> ä¸­éƒ½èƒ½çœ‹åˆ°ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/9/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/page/11/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/9/">9</a></li><li><a class="pagination-link is-current" href="/page/10/">10</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:13:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬äºŒæœŸ-å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯-æ¨¡æ¿æ¨¡å¼å®æˆ˜åˆ†äº«</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T17:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">ã€Sentinelã€‘Dockeræ­å»ºSentinel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T07:25:21.000Z">2023-06-05</time></p><p class="title"><a href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">ã€Gitã€‘Githubæäº¤ä»£ç é‡åˆ°é”™è¯¯ï¼šERROR Youâ€˜re using an RSA key with SHA-1, which is no longer allowed</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T02:04:23.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/%E3%80%90Linux%E3%80%91%E9%98%BF%E9%87%8C%E4%BA%91linux%20%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98%E5%B9%B6docker%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E8%BF%81%E7%A7%BB%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98/">ã€Linuxã€‘é˜¿é‡Œäº‘linux æŒ‚è½½æ•°æ®ç›˜å¹¶dockerå·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">40</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">61</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">43</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">149</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">æŠ€èƒ½æ”¹å˜äººç”Ÿï¼ŒçŸ¥è¯†æ”¹å˜å‘½è¿ã€‚</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ä¸­å›½Â·æ±Ÿè‹Â·æ— é”¡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">149</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ³ çµ(ç‰¹åˆ«å‘œè°¢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://github.com/Guoqing815/interview" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">é¢è¯•è®°Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://www.pgyer.com/interview_app_release" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">é¢è¯•è®°App(Android)</span></span><span class="level-right"><span class="level-item tag">www.pgyer.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(ç äº‘)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ˜é‡‘</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(é˜¿é‡Œäº‘)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(è…¾è®¯äº‘)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(Bç«™)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p><p class="is-size-7">Â© 2030</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>