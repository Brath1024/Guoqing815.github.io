<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-18T06:55:06.000Z" title="2021/12/18 14:55:06">2021-12-18</time>发表</span><span class="level-item"><time dateTime="2021-03-28T10:57:08.000Z" title="2021/3/28 18:57:08">2021-03-28</time>更新</span><span class="level-item">6 分钟读完 (大约890个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/18/%E3%80%90Java%E3%80%91Canal%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%EF%BC%8C%E6%8E%A5%E6%94%B6%E4%B8%8D%E5%88%B0Rowdata%E7%B1%BB%E5%9E%8B/">Canal数据同步，接收不到Rowdata类型</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="canal数据同步接收不到rowdata类型"><a class="markdownIt-Anchor" href="#canal数据同步接收不到rowdata类型">#</a> Canal 数据同步，接收不到 Rowdata 类型</h1>
<blockquote>
<p>问题描述如下图，只能接收到 TRANSACTIONBEGIN 和 TRANSACTIONEND 日志，收不到 ROWDATA 类型数据，所以问题还是出在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F&amp;spm=1001.2101.3001.7020">正则表达式</a>身上。由于我本身客户端也有一份订阅正则表达式，覆盖了本身的正则表达式，一度改为 <code>.*\\..*</code>  也不好使，所以一开始被迷惑掉了。我们再回顾一下他的规范<br>
 <code>常见例子：</code> <br>
 <code>1. 所有表：.* or .*\\..*</code> <br>
 <code>2. canal schema下所有表： canal\\..*</code> <br>
 <code>3. canal下的以canal打头的表：canal\\.canal.*</code> <br>
 <code>4. canal schema下的一张表：canal\\.test1</code> <br>
 <code>5. 多个规则组合使用：canal\\..*,mysql.test1,mysql.test2 (逗号分隔)</code> <br>
 我们在覆盖客户端的订阅的时候，他在有的 Issue 上或者很多博客中也有回复使用 <code>.*\\..*</code>  会覆盖服务端配置，这样确实会，但是这样会所有的表都不能匹配到该正则上。</p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20200925100828242.png" alt="被过滤的表DML语句日志将不会被分析"></p>
<h3 id="问题发现"><a class="markdownIt-Anchor" href="#问题发现">#</a> 问题发现</h3>
<blockquote>
<p>发现问题是在修改了五六个小时之后回家睡觉的第二个早上，静下心来又分析了一次日志发现了问题所在。<br>
下面图表示我的服务器端配置正则 (没有问题正确的), 客户端的正则 (有问题的)。昨天心态崩了没有发现这一点细节。Cananl 文档中是有提的库和表中间有两个 \，其中一个就是用来转义的作用 (毕竟服务器端读取配置需要读取文件并进行编码)。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20200925101906176.png" alt="注意看两个订阅正则"></p>
</blockquote>
<blockquote>
<p>在客户端订阅的时候<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/ClientExample">官方文档</a>示例也是两个 \，如下图。所以理所当然的就将两个 \ 的订阅配置加入客户端配置中。但是，就会出现上面的日志，客户端的错误订阅 (多了一个) 正则刷新掉了服务端的正确正则导致所有的表都被过滤掉了，就发生了只会出现事务日志的问题。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20200925102551553.png" alt="在这里插入图片描述"></p>
</blockquote>
<h3 id="正确客户端配置"><a class="markdownIt-Anchor" href="#正确客户端配置">#</a> 正确客户端配置</h3>
<blockquote>
<p>声明环境，我的配置都是在 nacos 上，所以转义符对我来说没有意义，所以我的正则为 <code>.*\..*</code>  也就是去掉一个 \。比如我监控的 monitor 库中 monitor 开头的表就是 <code>monitor\.monitor.*</code>  即可。下面成功。<br>
还有一个注意点就是 <code>如果你直接写到代码中的订阅也不需要加转义符，请忽略官方文档的那行代码示例</code></p>
</blockquote>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20200925100948374.png" alt="正则匹配到的表DML日志被分析传递"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-10T01:37:51.000Z" title="2021/12/10 09:37:51">2021-12-10</time>发表</span><span class="level-item"><time dateTime="2020-05-25T02:41:32.000Z" title="2020/5/25 10:41:32">2020-05-25</time>更新</span><span class="level-item">10 分钟读完 (大约1444个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/10/%E3%80%90JavaScript%E3%80%91JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE/">【JavaScript】JavaScript原型链</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javascriptjavascript原型链"><a class="markdownIt-Anchor" href="#javascriptjavascript原型链">#</a> 【JavaScript】JavaScript 原型链</h1>
<h5 id="2023417-重温一下多年前的八股文"><a class="markdownIt-Anchor" href="#2023417-重温一下多年前的八股文">#</a> 2023/4/17 重温一下多年前的八股文</h5>
<h2 id="对象"><a class="markdownIt-Anchor" href="#对象">#</a> 对象</h2>
<p>要清楚原型链，首先要弄清楚对象：</p>
<ul>
<li>
<p>普通对象</p>
</li>
<li>
<ul>
<li>最普通的对象：有__proto__属性（指向其原型链），没有 prototype 属性。</li>
<li>原型对象 (Person.prototype 原型对象还有 constructor 属性（指向构造函数对象）)</li>
</ul>
</li>
<li>
<p>函数对象：</p>
<ul>
<li>凡是通过 new Function () 创建的都是函数对象。</li>
</ul>
</li>
</ul>
<p>拥有__proto__、prototype 属性（指向原型对象）。</p>
<p>Function、Object、Array、Date、String、自定义函数</p>
<p>特例： Function.prototype (是原型对象，却是函数对象，下面会有解释)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//函数对象  </span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">F1</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">F2</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">F3</span> = <span class="keyword">function</span>(<span class="params"><span class="string">&quot;n1&quot;</span>,<span class="string">&quot;n2&quot;</span>,<span class="string">&quot;return n1+n2&quot;</span></span>);  </span><br><span class="line">  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="variable constant_">F1</span>);  <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="variable constant_">F2</span>);  <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="variable constant_">F3</span>);   <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Object</span>);   <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Array</span>);   <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">String</span>);   <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Date</span>);   <span class="comment">//function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Function</span>);   <span class="comment">//function  </span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic3.zhimg.com/80/v2-261209138284cee7af75fd5bd4d98eea_720w.webp" alt="img"></p>
<p>Array 是函数对象，是 Function 的实例对象，Array 是通过 newFunction 创建出来的。因为 Array 是 Function 的实例，所以 Array.<strong>proto</strong> === Function.prototype</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通对象  </span></span><br><span class="line"><span class="keyword">var</span> o1 = <span class="keyword">new</span> <span class="title function_">F1</span>();   </span><br><span class="line"><span class="keyword">var</span> o2 = &#123;&#125;;         </span><br><span class="line"><span class="keyword">var</span> o3 = <span class="keyword">new</span> <span class="title class_">Object</span>();   </span><br><span class="line">  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> o1);  <span class="comment">//Object  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> o2);   <span class="comment">//Object  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> o3);   <span class="comment">//Object  </span></span><br></pre></td></tr></table></figure>
<h1 id="原型对象"><a class="markdownIt-Anchor" href="#原型对象">#</a> 原型对象</h1>
<p>每创建一个函数都会有一个 prototype 属性，这个属性是一个指针，指向一个对象（通过该构造函数创建实例对象的原型对象）。原型对象是包含特定类型的所有实例共享的属性和方法。原型对象的好处是，可以让所有实例对象共享它所包含的属性和方法。</p>
<p>第一块中有提到，原型对象属于普通对象。Function.prototype 是个例外，它是原型对象，却又是函数对象，作为一个函数对象，它又没有 prototype 属性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line">  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">//Object  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// Object  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// 特殊 Function  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> <span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">//undefined 函数对象却没有prototype属性 </span></span><br></pre></td></tr></table></figure>
<p>解释：</p>
<p>其实原型对象就是构造函数的一个实例对象。person.prototype 就是 person 的一个实例对象。相当于在 person 创建的时候，自动创建了一个它的实例，并且把这个实例赋值给了 prototype。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> <span class="title class_">Person</span>();  </span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span> = temp;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Function</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line"><span class="keyword">var</span> temp = <span class="keyword">new</span> <span class="title class_">Function</span>();  </span><br><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span> = temp; <span class="comment">//由new Function()产生的对象都是函数对象  </span></span><br></pre></td></tr></table></figure>
<p>从一张图看懂原型对象、构造函数、实例对象之间的关系</p>
<p><img src="https://pic1.zhimg.com/80/v2-830f96ed4a5765089776e9702120d484_720w.webp" alt="img"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params"></span>)&#123;&#125;;  </span><br><span class="line">  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = <span class="string">&quot;小黄&quot;</span>;  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">age</span> =  <span class="number">13</span>;  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getAge</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> dog1 = <span class="keyword">new</span> <span class="title class_">Dog</span>();  </span><br><span class="line"><span class="keyword">var</span> dog2 = <span class="keyword">new</span> <span class="title class_">Dog</span>();  </span><br><span class="line">  </span><br><span class="line">dog2.<span class="property">name</span> = <span class="string">&quot;小黑&quot;</span>;  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog1.<span class="property">name</span>); <span class="comment">// 小黄 来自原型  </span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(dog2.<span class="property">name</span>); <span class="comment">// 小黑 来自实例  </span></span><br></pre></td></tr></table></figure>
<p><img src="https://pic3.zhimg.com/80/v2-5d7fc42b450728c6a5b72a903ee3fc36_720w.webp" alt="img"></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//图中的一些关系  </span><br><span class="line">dog1.__proto__ === Dog.prototype  </span><br><span class="line">  </span><br><span class="line">Dog.prototype.__proto__ === Object.prototype //继承Object 下面原型链说  </span><br><span class="line">  </span><br><span class="line">dog1.__proto__.__proto__ === Object.prototype  </span><br><span class="line">  </span><br><span class="line">Dog.prototype.constructor === Dog   </span><br><span class="line">  </span><br><span class="line">Dog.prototype.isPrototypeOf(dog1)  </span><br><span class="line">  </span><br><span class="line">//获取对象的原型  </span><br><span class="line">dog1.__proto__  //不推荐  </span><br><span class="line">Object.getPrototypeOf(dog1) === Dog.prototype   //推荐  </span><br></pre></td></tr></table></figure>
<h1 id="原型链"><a class="markdownIt-Anchor" href="#原型链">#</a> 原型链</h1>
<p>原型链是实现继承的主要方法。</p>
<p>先说一下继承，许多 OO 语言都支持两张继承方式：接口继承、实现继承。</p>
<p>|- 接口继承：只继承方法签名</p>
<p>|- 实现继承：继承实际的方法</p>
<p>由于函数没有签名，在 ECMAScript 中无法实现接口继承，只支持实现继承，而实现继承主要是依靠原型链来实现。</p>
<p>原型链基本思路：</p>
<p>利用原型让一个引用类型继承另一个引用类型的属性和方法。</p>
<p>每个构造函数都有一个原型对象，原型对象都包含一个指向构造函数想指针 (constructor)，而实例对象都包含一个指向原型对象的内部指针 (<strong>proto</strong>)。如果让原型对象等于另一个类型的实例，此时的原型对象将包含一个指向另一个原型的指针 (<strong>proto</strong>)，另一个原型也包含着一个指向另一个构造函数的指针 (constructor)。假如另一个原型又是另一个类型的实例…… 这就构成了实例与原型的链条。</p>
<p>原型链基本思路（图解）：</p>
<p><img src="https://pic3.zhimg.com/80/v2-901202a60d3f6e9fcc90a69d06fe0282_720w.webp" alt="img"></p>
<p>举例说明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Animal</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = <span class="string">&quot;animal&quot;</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getType</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">type</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Dog</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = <span class="string">&quot;dog&quot;</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();  </span><br><span class="line">  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> xiaohuang = <span class="keyword">new</span> <span class="title class_">Dog</span>();  </span><br><span class="line"><span class="comment">//原型链关系  </span></span><br><span class="line">xiaohuang.<span class="property">__proto__</span> === <span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>  </span><br><span class="line"><span class="title class_">Dog</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>  </span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>  </span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">__proto__</span> === <span class="literal">null</span>  </span><br></pre></td></tr></table></figure>
<p>图解:</p>
<p><img src="https://pic4.zhimg.com/80/v2-b47a3e4984d49bec824db6217cf03ea7_720w.webp" alt="img"></p>
<p>详细图</p>
<p><img src="https://pic4.zhimg.com/80/v2-2087bd26483d9aafccbb0e83904f4d1b_720w.webp" alt="img"></p>
<p>（图片修正：笔误，第一行应该是 xiaohuang.<strong>proto</strong> === Dog.prototype）</p>
<p>从 xiaohuang 这个实例，看出整个链条</p>
<p>总结：</p>
<p>Xiaohuang 这个 Dog 的实例对象继承了 Animal，Animal 继承了 Object。</p>
<p><img src="https://pic1.zhimg.com/80/v2-58d80f6a14ef493efe6c255b4991a670_720w.webp" alt="img"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-08T17:07:45.000Z" title="2021/12/9 01:07:45">2021-12-09</time>发表</span><span class="level-item"><time dateTime="2019-01-09T06:52:45.000Z" title="2019/1/9 14:52:45">2019-01-09</time>更新</span><span class="level-item">8 分钟读完 (大约1262个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/09/%E3%80%90HEXO%E3%80%91%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/">【HEXO】使用Hexo搭建属于自己的博客</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="hexo使用hexo搭建属于自己的博客"><a class="markdownIt-Anchor" href="#hexo使用hexo搭建属于自己的博客">#</a> 【HEXO】使用 Hexo 搭建属于自己的博客</h1>
<p><strong>目录</strong></p>
<p><a href="#t0">一、查询当前博客发布地址</a></p>
<p><a href="#t1">二、域名注册</a></p>
<p><a href="#t2">1、这里博主以阿里云为例，首先进入阿里云官网，登录账号</a></p>
<p><a href="#t3">2、点击搜索按钮，搜索栏输入域名，点击搜索</a></p>
<p><a href="#t4">3、点击域名注册</a></p>
<p><a href="#t5">4、在搜索栏输入想要的域名，这里以 “wanwang” 举例，点击查询域名</a></p>
<p><a href="#t6">5、购买域名 </a></p>
<p><a href="#t7">6、购买完成后，返回查询域名页面，点击管理我的域名</a></p>
<p><a href="#t8">7、找到刚刚购买的域名，点击解析</a></p>
<p><a href="#t9">8、点击添加记录</a></p>
<p><a href="#t10">9、添加记录</a></p>
<p><a href="#t11">10、设置成功后，等待状态变为正常即可</a></p>
<p><a href="#t12">11、设置自定义域名</a></p>
<p><a href="#t13">三、完成</a></p>
<p><a href="#t14">1、访问刚才设置好的域名，“http:// 域名”，出现博客页面，表示成功。</a></p>
<hr>
<h1 id="一-查询当前博客发布地址"><a class="markdownIt-Anchor" href="#一-查询当前博客发布地址">#</a> 一、查询当前博客发布地址</h1>
<p>1、登录 GitHub，找到仓库（一般以 “.github.io” 结尾），点击进入</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f16f4f455be5402f9b95487ac16f362c.png" alt="img"></p>
<p>2、右上方点击 “Settings”, 左下方找到 “Pages” 点击后，蓝色字体为博客发布的网址，点击查看，网址一般为 “<a target="_blank" rel="noopener" href="https://xn--5mq40k5uk/%E2%80%9D">https:// 仓库名 /”</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e4b93952287a4830a07ef974e72890b3.png" alt="img"></p>
<h1 id="二-域名注册"><a class="markdownIt-Anchor" href="#二-域名注册">#</a> 二、域名注册</h1>
<p>注：博主这里提供国内域名商的官网，仅供参考！</p>
<p>阿里云网址</p>
<p><a target="_blank" rel="noopener" href="https://www.aliyun.com/">阿里云 - 上云就上阿里云<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://www.aliyun.com/</a></p>
<p>华为云网址</p>
<p><a target="_blank" rel="noopener" href="https://activity.huaweicloud.com/">最新优惠活动_云服务器特惠促销_打折云产品专场_特价低至 1 折 - 华为云<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://activity.huaweicloud.com/</a></p>
<p>腾讯云网址</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/">腾讯云 - 产业智变 云启未来<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/icon-default.png" alt="img">https://cloud.tencent.com/</a></p>
<h2 id="1-这里博主以阿里云为例首先进入阿里云官网登录账号"><a class="markdownIt-Anchor" href="#1-这里博主以阿里云为例首先进入阿里云官网登录账号">#</a> 1、这里博主以阿里云为例，首先进入阿里云官网，登录账号</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c294e851d3734e508c7aa093d656d2d1.png" alt="img"></p>
<h2 id="2-点击搜索按钮搜索栏输入域名点击搜索"><a class="markdownIt-Anchor" href="#2-点击搜索按钮搜索栏输入域名点击搜索">#</a> 2、点击搜索按钮，搜索栏输入域名，点击搜索</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2e3c87e917e047b68e69a5ecc6809576.png" alt="img"></p>
<h2 id="3-点击域名注册"><a class="markdownIt-Anchor" href="#3-点击域名注册">#</a> 3、点击域名注册</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/0176ff2c3e104636b5c938a075f94101.png" alt="img"></p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="4-在搜索栏输入想要的域名这里以wanwang举例点击查询域名"><a class="markdownIt-Anchor" href="#4-在搜索栏输入想要的域名这里以wanwang举例点击查询域名">#</a> 4、在搜索栏输入想要的域名，这里以 “wanwang” 举例，点击查询域名</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ad6c7f9be87d4d4f877d2ddc145be9e8.png" alt="img"></p>
<h2 id="5-购买域名"><a class="markdownIt-Anchor" href="#5-购买域名">#</a> 5、购买域名</h2>
<p>搜索结果，可能出现已注册情况，建议选择未注册的域名，点击购买，各位朋友请根据自己的需求和自身的经济实力购买，域名没有永久的都是有时效性的，具体可以询问客服</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b761760294024ec5a015ba17b6e5256d.png" alt="img"></p>
<h2 id="6-购买完成后返回查询域名页面点击管理我的域名"><a class="markdownIt-Anchor" href="#6-购买完成后返回查询域名页面点击管理我的域名">#</a> 6、购买完成后，返回查询域名页面，点击管理我的域名</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/cfb0a55c15da4c99b4cf2054d01fe56c.png" alt="img"></p>
<h2 id="7-找到刚刚购买的域名点击解析"><a class="markdownIt-Anchor" href="#7-找到刚刚购买的域名点击解析">#</a> 7、找到刚刚购买的域名，点击解析</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/14a5a0a258914d078026d0e188c2d52b.png" alt="img"></p>
<h2 id="8-点击添加记录"><a class="markdownIt-Anchor" href="#8-点击添加记录">#</a> 8、点击添加记录</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/8ae1f0fd8ffa4c07a5a1c6c7ca0a52e4.png" alt="img"></p>
<h2 id="9-添加记录"><a class="markdownIt-Anchor" href="#9-添加记录">#</a> 9、添加记录</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ddcaacbaca9f440e98bd8f690d667b2d.png" alt="img"></p>
<h2 id="10-设置成功后等待状态变为正常即可"><a class="markdownIt-Anchor" href="#10-设置成功后等待状态变为正常即可">#</a> 10、设置成功后，等待状态变为正常即可</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/642fe813a4ab43339a94a23261f58d28.png" alt="img"></p>
<h2 id="11-设置自定义域名"><a class="markdownIt-Anchor" href="#11-设置自定义域名">#</a> 11、设置自定义域名</h2>
<p>右上方点击 “Settings”，左下方找到 “Pages” 点击后，在 “Custom domain”（自定义域名）下方文本栏中填写域名，勾选 “Enforce HTTPS”（强制使用 https 协议），点击 “Save”（保存），蓝色字体为博客发布的网址，点击查看，网址一般为 “<a target="_blank" rel="noopener" href="https://xn--eqrt2g/%E2%80%9D">https:// 域名 /”</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/df5af9f92fc44565b3be43e426b50cee.png" alt="img"></p>
<h1 id="三-完成"><a class="markdownIt-Anchor" href="#三-完成">#</a> 三、完成</h1>
<h2 id="1-访问刚才设置好的域名http域名出现博客页面表示成功"><a class="markdownIt-Anchor" href="#1-访问刚才设置好的域名http域名出现博客页面表示成功">#</a> 1、访问刚才设置好的域名，“<a target="_blank" rel="noopener" href="http://xn--eqrt2g">http:// 域名</a>”，出现博客页面，表示成功。</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/30baf16189c9448da5e343f87759774a.png" alt="img"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-27T07:09:07.000Z" title="2021/10/27 15:09:07">2021-10-27</time>发表</span><span class="level-item"><time dateTime="2021-06-15T13:25:36.000Z" title="2021/6/15 21:25:36">2021-06-15</time>更新</span><span class="level-item">3 分钟读完 (大约480个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/27/%E3%80%90Git%E3%80%91Github%E8%AE%BF%E9%97%AE%E5%8A%A0%E9%80%9F/">Github访问加速方法</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="1-获取延迟最小ip地址"><a class="markdownIt-Anchor" href="#1-获取延迟最小ip地址">#</a> 1. 获取延迟最小 IP 地址</h2>
<p>首先，打开</p>
<p><a target="_blank" rel="noopener" href="http://tool.chinaz.com/dns?type=1&amp;host=github.com&amp;ip=">http://tool.chinaz.com/dns?type=1&amp;host=github.com&amp;ip=</a></p>
<p>查询 Github 的地址，选择延迟最小的</p>
<p><img src="E:%5Cmd%E5%9B%BE%E7%89%87%5C1640222585966.png" alt="1640222585966"></p>
<h2 id="2-修改系统hosts文件"><a class="markdownIt-Anchor" href="#2-修改系统hosts文件">#</a> <strong>2. 修改系统 Hosts 文件</strong></h2>
<p>接着，打开系统 hosts 文件 (需管理员权限)。<br>
路径：C:\Windows\System32\drivers\etc</p>
<blockquote>
<p>mac 或者其他 linux 系统的话，是 /etc 下的 hosts 文件，需要切入到 root 用户修改</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Copyright (c) 1993-2009 Microsoft Corp. </span><br><span class="line"># </span><br><span class="line"># This is a sample HOSTS file used by Microsoft TCP/IP for Windows. </span><br><span class="line"># </span><br><span class="line"># This file contains the mappings of IP addresses to host names. Each </span><br><span class="line"># entry should be kept on an individual line. The IP address should </span><br><span class="line"># be placed in the first column followed by the corresponding host name. </span><br><span class="line"># The IP address and the host name should be separated by at least one </span><br><span class="line"># space. </span><br><span class="line"># </span><br><span class="line"># Additionally, comments (such as these) may be inserted on individual </span><br><span class="line"># lines or following the machine name denoted by a &#x27;#&#x27; symbol. </span><br><span class="line"># </span><br><span class="line"># For example: </span><br><span class="line"># </span><br><span class="line">#      102.54.94.97     rhino.acme.com          # source server </span><br><span class="line">#       38.25.63.10     x.acme.com              # x client host </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># localhost name resolution is handled within DNS itself. </span><br><span class="line">#   127.0.0.1       localhost </span><br><span class="line">#   ::1             localhost </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">52.192.72.89    github.com</span><br></pre></td></tr></table></figure>
<p>并在末尾添加记录并保存。(需管理员权限，注意 IP 地址与域名间需留有空格)</p>
<h2 id="3-刷新系统dns缓存"><a class="markdownIt-Anchor" href="#3-刷新系统dns缓存">#</a> <strong>3. 刷新系统 DNS 缓存</strong></h2>
<p>最后，Windows+X 打开系统命令行（管理员身份）或 powershell</p>
<p>运行 ipconfig /flushdns 手动刷新系统 DNS 缓存。</p>
<blockquote>
<p>mac 系统修改完 hosts 文件，保存并退出就可以了。不要要多一步刷新操作.<br>
centos 系统执行 /etc/init.d/network restart 命令 使得 hosts 生效</p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-15T16:39:31.000Z" title="2021/10/16 00:39:31">2021-10-16</time>发表</span><span class="level-item"><time dateTime="2021-01-05T13:59:29.000Z" title="2021/1/5 21:59:29">2021-01-05</time>更新</span><span class="level-item">22 分钟读完 (大约3293个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/16/%E3%80%90Java%E3%80%91%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0/">设计模式（一）</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="设计模式笔记-__brathli"><a class="markdownIt-Anchor" href="#设计模式笔记-__brathli">#</a> 设计模式笔记  <strong>__Brath.Li</strong></h3>
<h3 id="gof2323种设计模式"><a class="markdownIt-Anchor" href="#gof2323种设计模式">#</a> GoF23：23 种设计模式</h3>
<p>​		<strong>设计模式的本质是面向对象设原则的实际运用，是对类的封装性，继承性，多态性以及类的关联关系和组合关系的充分理解。</strong></p>
<p>​			<strong>正确使用设计模式具有以下优点：</strong></p>
<p>​			<strong>1. 提高程序员思维能力，编程能力和设计能力</strong></p>
<p>​			<strong>2. 使程序设计更加标准化，代码编制更加工程化，使软件开发效率大大提高，从而缩短软件的开的周期。</strong></p>
<p>​			<strong>3. 使设计的代码可重用性高、可读性强、可靠性高、灵活性好、可维护性强。</strong></p>
<h3 id="创建型模式"><a class="markdownIt-Anchor" href="#创建型模式">#</a> <strong>创建型模式：</strong></h3>
<p>​			<strong>单例模式、工厂模式、抽象工厂模式、建造者模式、原型模式。</strong></p>
<h3 id="结构型模式"><a class="markdownIt-Anchor" href="#结构型模式">#</a> <strong>结构型模式：</strong></h3>
<p>​			<strong>适配器模式、桥接模式、装饰模式、组合模式、外欧冠模式、享元模式、代理模式。</strong></p>
<h3 id="行为性模式"><a class="markdownIt-Anchor" href="#行为性模式">#</a> <strong>行为性模式：</strong></h3>
<p>​			<strong>模板方法模式、命令模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式、状态模式、策略模式、责任链模式、访问者模式。</strong></p>
<h4 id="oop面向对象七大原则"><a class="markdownIt-Anchor" href="#oop面向对象七大原则">#</a> OOP 面向对象七大原则：</h4>
<p><strong>1.OCP 开闭原则：</strong></p>
<p>​			<strong>软件实体（包括类、模块、功能等）应该对扩展开放，但是对修改关闭。</strong></p>
<p><strong>2. 里氏替换原则：</strong></p>
<p>​			<strong>继承必须确保超类锁拥有的性质在子类中仍然成立。</strong></p>
<p><strong>3. 依赖倒置原则：</strong></p>
<p>​			<strong>面向接口编程，不要面向实现编程。</strong></p>
<p><strong>4. 单一职责原则：</strong></p>
<p>​			<strong>控制类粒度大小、将对象解耦合、提高内聚性。</strong></p>
<p><strong>5. 接口隔离原则：</strong></p>
<p>​			<strong>要为各个类建立他们需要的专用接口。</strong></p>
<p><strong>6. 迪米特法则：</strong></p>
<p>​			** 只与你的直接朋友交谈、不跟 “陌生人” 说话。 **</p>
<p><strong>7. 合成复用原则：</strong></p>
<p>​			<strong>尽量先使用组合或者聚合等关联关系来实现，其次才考虑使用继承关系来实现。</strong></p>
<h2 id="单例设计模式"><a class="markdownIt-Anchor" href="#单例设计模式">#</a> 单例设计模式：</h2>
<p>作用：让一个类只能创建一个实例（因为频繁的创建对象，回收对象会造成系统性能下降。）。解决对象的唯一性，保证了内存中一个对象是唯一的 。</p>
<h4 id="饿汉式hunary"><a class="markdownIt-Anchor" href="#饿汉式hunary">#</a> 饿汉式：Hunary</h4>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C%E9%A5%BF%E6%B1%89%E5%BC%8F.png" alt="饿汉式"></p>
<p><strong>步骤：1. 私有化构造器  2. 直接创建静态对象 3. 创建一个静态的方法，供外部调用实例</strong></p>
<p>优点：类初始化的时候，会立即加载该对象，线程天生安全，调用效率高。</p>
<p>缺点：无法避免被反射破解，不安全</p>
<h4 id="懒汉式lazyman"><a class="markdownIt-Anchor" href="#懒汉式lazyman">#</a> 懒汉式：LazyMan</h4>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910151318667.png" alt="image-20210910151318667"></p>
<p>步骤：1. 私有化构造器，不会直接创建对象  2. 向外暴露调用对象方法，在方法中先进行对象判空，为空才创建对象，这就是懒汉式</p>
<p>优点：类初始化时，不会初始化该对象，真正需要使用的时候才会去创建该对象，具备懒加载功能。</p>
<p>缺点：</p>
<p>1. 判空浪费时间</p>
<p>2. 不加 Synchronized 的懒汉式线程不安全，需要用到 volatile 关键字保持 new 对象的原子性一致</p>
<p>懒汉式单线程下是 OK 的，但是多线程并发下不安全。</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153316119.png" alt="image-20210910153316119"> 开启十次线程测试</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153327761.png" alt="image-20210910153327761"></p>
<p><strong>每次重启线程数都不一致</strong>，线程不安全。</p>
<p>怎么解决：</p>
<p>Tips：懒汉式也是可以实现线程安全的：只要加上 Synchronized 加锁即可：</p>
<p>但是这样一来，会降低整个访问的速度，而且每次都要判断。那么有没有更好的方式来实现呢？</p>
<p>解决方案：</p>
<p><strong>double-check-lock 双重加锁</strong></p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910152638263.png" alt="image-20210910152638263"></p>
<p>所谓双重加锁机制。指的是，并不是每次进入 getInstance 方法都需要同步，而是先不同步，进入方法之后先检查实例是否存在，如果不存在才进入下面 Synchronized 加锁，之后会再次检查实例是否存在，如果还不存在才创建实例。</p>
<p>双重检测方式（因为 JVM 本身重排序的原因，可能会出现多次的初始化）</p>
<p>这种模式下的懒汉式，称为<strong> DCL 懒汉式</strong>！</p>
<p>你以为这样就没问题了？大错特错，注意：这里的 new 对象操作不是原子性的</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153630120.png" alt="image-20210910153630120"></p>
<p>new 一个对象的执行顺序 ↓</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 1.分配内存空间</span></span><br><span class="line"><span class="comment">  * 2.执行构造方法初始化对象</span></span><br><span class="line"><span class="comment">  * 3.把这个对象指向内存空间</span></span><br><span class="line"><span class="comment">  * 这是创建对象的步骤 正确顺序为 123</span></span><br><span class="line"><span class="comment">  * 举例：</span></span><br><span class="line"><span class="comment">  * 线程A 创建对象 步骤为 123, 我们的代码没有问题</span></span><br><span class="line"><span class="comment">  * 线程B 创建对象 因为操作步骤不是原子性的，可能会走成 1 3 2，先指向了内存空间，再去构造对象</span></span><br><span class="line"><span class="comment">  * 这时会出现一个问题，指令重排：双重检测模式会失效，因为此时我们的类，不为空了，但是里面返回的对象是空的。</span></span><br><span class="line"><span class="comment">  * 所以就要用到一个关键字volatile，避免指令重排，保持操作原子性</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153756918.png" alt="image-20210910153756918"></p>
<h4 id="静态内部类模式"><a class="markdownIt-Anchor" href="#静态内部类模式">#</a> 静态内部类模式：</h4>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910155204370.png" alt="image-20210910155204370"></p>
<p>步骤：1. 私有化构造器  2. 创建一个静态内部类，类中创建外部类的实例  3. 向外暴露一个方法获取静态内部类中创建的对象</p>
<p>优点：结合了懒汉式和饿汉式各自的优点，真正需要对象的时候才会加载，加载类是线程安全的。</p>
<p>缺点：每次调用都会创建多余的对象</p>
<h3 id="以上单例设计模式都会被反射破解枚举不会"><a class="markdownIt-Anchor" href="#以上单例设计模式都会被反射破解枚举不会">#</a> 以上单例设计模式都会被反射破解，枚举不会！</h3>
<p>枚举：枚举本身是一个类，继承了 Enum 的实例就成为了枚举类</p>
<p>使用枚举实现单例模式，实现简单、调用效率高，枚举本身就是单例，由 JVM 从根本上提供保障，避免通过反射和反序列化的漏洞，缺点是没有延迟加载。</p>
<p>在源码 Constructor 中<img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150042754.png" alt="image-20210910150042754"></p>
<p>如果是对象是通过反射机制创建的会抛出一个异常</p>
<p>IllegalArgumentException: Cannot reflectively create enum objects</p>
<p>枚举类在 traget 输出的代码中，构造器是空的，隐藏起来了，用 javap -p 反编译也看不见构造器</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150706569.png" alt="image-20210910150706569"></p>
<p>我们用反射机制获取空构造器会获取不到对象，这时候用 jad 反编译工具，得到的 java 文件中，</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150400927.png" alt="image-20210910150400927"></p>
<p>可以看见构造器其实是有数据的，我们把数据放到反射中实现，就会得到这个异常 Cannot reflectively create enum objects</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150429958.png" alt="image-20210910150429958"></p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150418256.png" alt="image-20210910150418256"></p>
<p>由此可见，反射不能破坏枚举的单例模式</p>
<p>优点：实现简单，线程安全，防止反射攻击等。</p>
<p>缺点： 在不需要的时候可能就加载了，造成内存浪费</p>
<p>Tips：利用反射破解懒汉式。懒汉式不是安全的！</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910160648326.png" alt="image-20210910160648326"></p>
<p>私有化构造器的时候判断外面的字段 guoqing 是否 ==false，等于的话就设置为 true，如果不等于的话就抛出运行异常，这样设计的话在我们用反射机制获取构造器的时候，就获取不到对象了</p>
<p>但是有解决方法：利用反射强大的机制，假如我们反编译，知道要破解的字段是 guoqing，那我们直接用反射获取 guoqing 字段，然后设置解除私有化限制，在创建构造器实例的时候，把 guoqing 设置为 true，就可以破解 DCL 懒汉式了</p>
<p><img src="C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910160638735.png" alt="image-20210910160638735"></p>
<h2 id="工厂设计模式-factory-model"><a class="markdownIt-Anchor" href="#工厂设计模式-factory-model">#</a> 工厂设计模式 Factory Model：</h2>
<p>​		<strong>核心本质：</strong></p>
<p>​			<strong>实例化对象不使用 new，用工厂方法代替</strong></p>
<p>​			<strong>将选择实现类，创建对象统一管理和控制。从而将调用者跟我们的实现类解耦。</strong></p>
<p>​		<strong>详细分类：</strong></p>
<p>​			<strong>简单工厂模式</strong></p>
<p>​						<strong>用来生产同一等级结构中的任意产品：扩展性差</strong></p>
<p>​			<strong>工厂方法模式</strong></p>
<p>​						<strong>用来生产同一等级结构中的固定产品：扩展性强</strong></p>
<p>​			<strong>抽象工厂模式</strong></p>
<p>​						<strong>围绕一个超级工厂创建其他工厂。该超级工厂又称为其他工厂的工厂。</strong></p>
<p><strong>工厂设计模式应用场景：</strong></p>
<p>​			<strong>JDK 中的 Calendar 的 getInstance 方法</strong></p>
<p>​			<strong>JDBC 中的 Connection 对象的获取</strong></p>
<p>​			<strong>Spring 的 IOC 容器创建管理 Bean 对象</strong></p>
<p>​			<strong>反射 Class 对象的 newInsetance 方法</strong></p>
<h2 id="建造者模式"><a class="markdownIt-Anchor" href="#建造者模式">#</a> 建造者模式：</h2>
<p>​	<strong>建造者模式也属于创建型模式，它提供了一种创建对象的最佳方式。</strong></p>
<p>​	<strong>定义：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示</strong></p>
<p>​	<strong>主要作用：在用户不知道对象的建造过程和细节的情况下就可以直接创建复杂对象。</strong></p>
<p>​	<strong>用户只需要给出指定复杂对象的类型和内容，建造者模式负责将按顺序创建复杂对象（把内部的建造过程和细节隐藏起来）</strong></p>
<p>​	<strong>例子：</strong></p>
<p>​			<strong>工厂（建造者模式）：负责制造汽车（组装过程和细节在工厂内）</strong></p>
<p>​			<strong>汽车购买者（用户）：你只需要说你需要的型号（对象的类型和内容），然后直接购买就可以了（不需要知道汽车是怎么组装的（发动机、变速箱、轮毂、车门））</strong></p>
<h2 id="原型模式"><a class="markdownIt-Anchor" href="#原型模式">#</a> 原型模式：</h2>
<p>​		创建型模式之一。</p>
<p>​</p>
<h2 id="适配器模式"><a class="markdownIt-Anchor" href="#适配器模式">#</a> 适配器模式</h2>
<p>​		将一个类的接口转换成客户希望的另外一个接口，Adapter 模式使得原本由于接口不兼容而不能一起工作的那些类可以在一起工作！</p>
<p>​		角色分析：</p>
<p>​				1 . 目标接口：客户所期待的接口，目标可以使具体或抽象的类，也可以是接口。</p>
<p>​				2 . 需要适配的类：需要适配的类或者适配者类。</p>
<p>​				3 . 适配器：通过包装一个需要适配的对象，将原接口转换成目标对象。</p>
<p>​		对象适配器优点</p>
<p>​				1 . 一个对象适配器可以把多个不同的适配者适配到同一个目标</p>
<p>​				2 . 可以适配一个适配者的子类，由于适配器和适配者之间是关联关系，根据 “里氏代换原则” ，适配者的子类也可以通过该适配器进行适配。</p>
<p>​		类适配器缺点：</p>
<p>​				1 . 对于 Java、C# 等不支持多重类继承的语言，一次最多只能适配一个适配者类，不能同时适配多个适配者。</p>
<p>​				2 . 在 Java、C# 等语言中，适配器模式中的目标抽象类只能为接口，不能为类，其使用有一定的局限性。</p>
<p>​		适用场景：</p>
<p>​				1 . 系统需要使用一些现有的类，而这些类的接口不符合系统的需要，甚至没有这些类的代码。</p>
<p>​				2 . 想创建一个可以重复使用的类，用于与一些彼此之间没有太大关联的一些类，包括一些可能在将来引进的类一起工作。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-15T08:17:22.000Z" title="2021/10/15 16:17:22">2021-10-15</time>发表</span><span class="level-item"><time dateTime="2023-12-15T15:07:33.000Z" title="2023/12/15 23:07:33">2023-12-15</time>更新</span><span class="level-item">16 分钟读完 (大约2446个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/15/%E3%80%90%E5%A4%96%E8%AE%BE%E3%80%91%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98%E8%BD%B4%E4%BD%93%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F%E4%B8%89%E6%A8%A1%E7%83%AD%E6%8F%92%E6%8B%94%E5%8E%9F%E6%9D%A5%E6%98%AF%E8%BF%99%E4%B9%88%E5%9B%9E%E4%BA%8B/">【外设】机械键盘轴体怎么选？三模热插拔原来是这么回事</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p>​		随着科技进步和生活品质的提高，机械键盘凭借其超长的使用寿命和非凡的手感夺回曾被薄膜键盘抢走十余年的金交椅，成为外设发烧友与游戏玩家的掌中爱物。除去寿命和使用手感，三模热插拔机械键盘可以根据玩家个人喜好使用需求，让自己心爱的机械键盘拥有独一无二的外观。</p>
<h2 id="三模热插拔键盘是什么"><a class="markdownIt-Anchor" href="#三模热插拔键盘是什么">#</a> 三模热插拔键盘是什么？</h2>
<p><strong>三模</strong>是一种键盘的连接模式，<strong>是指键盘支持有线、蓝牙和无线 2.4G 三种模式的连接方式</strong>。<strong>有线</strong>的连接方式简单，延迟率低，能提供更好的稳定性和兼容性。<strong>无线</strong> 2.4G 是需要电脑插入接收器，使键盘与接收器互联但容易受到同频段干扰。<strong>蓝牙</strong>模式则同时与平板电脑、手机等多设备进行快速无缝切换。市场上的单模、双模键盘更换率高、性能单一，三模键盘无疑是多设备简洁党玩家的首选，不管用不用得上买就对了。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095508676.png" alt="image-20230420095508676"></p>
<p><strong>热插拔即带电插拔</strong>，热插拔功能就是允许用户在不关闭系统，不切断电源的情况下更换零件后能立即识别且及时恢复公用，不需要系统对键盘进行二次识别。这样一来又能对机械键盘进行 DIY。</p>
<p>即使不为 DIY，买机械键盘也离不开对轴体的选择。</p>
<h2 id="轴体的结构组成"><a class="markdownIt-Anchor" href="#轴体的结构组成">#</a> 轴体的结构组成：</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095523273.png" alt="image-20230420095523273"></p>
<p>轴体结构分化图</p>
<h2 id="机械轴体主要分为线性轴和段落轴"><a class="markdownIt-Anchor" href="#机械轴体主要分为线性轴和段落轴">#</a> 机械轴体主要分为线性轴和段落轴。</h2>
<p>对于选择困难户来说，轴体型号五花八门，不同的轴体具有不同的特性。</p>
<p>先来说说段落轴。顾名思义段落轴按到一半会触发一个段落变化，有很明显的段落感，声音大。</p>
<p>（1） <strong>青轴</strong>：必须承认樱桃青轴的经典设计。段落感强，具有<strong>明显</strong>清脆的<strong>敲击声</strong>，有阻滞感，易疲劳且有极大的<strong>噪音污染</strong>。住宿的学生党和长时间文字输入用户不建议使用。</p>
<p>（2） <strong>BOX 白轴</strong>：按压时带来清脆整齐的 “圆珠笔” 音，回弹力度大。声音、段落感比青轴轻，手感也比较不易疲累，是一款防尘防水的段落轴，在老式的机械键盘上经常出现。</p>
<p>（3） <strong>静音月白轴</strong>：一款把段落手感前置的轴体。加入了<strong>双重降噪设计</strong>，手感上具有十分有力的回弹。强烈的大段落手感更加接近早期的段落轴但没有白轴的沉重感。想体验<strong>提前大段落手感</strong>并且有静音处理的用户不妨试试。</p>
<p>（4） <strong>茶轴</strong>：一款入门级高性价比的机械键盘轴体，人称 “万能轴”。主要体现在各方面表现比较均衡，段落感较弱，不易误触、敲击声小、手感柔和、舒适感强是大多数人能接受的轴体。在职场办公想要有明晰的段落感又不想打扰到别人，那茶轴是一个不可多得的选择。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095528949.png" alt="image-20230420095528949"></p>
<p>追求段落感兼备游戏办公需求的可选茶轴</p>
<p>还有线性轴，<strong>线性轴特点是直上直下，声音小、没有段落感</strong>。举例如下：</p>
<p>（1） <strong>红轴</strong>：又称入坑轴，是线性轴体的典型代表。如果你是手劲小的女玩家可以尝试，手感上和普通的薄膜键盘比较类似。直上直下的设计带来轻盈的手感也不易累，敲击声小、反应灵敏、按压后的回弹柔和，兼顾日常游戏和打字办公的需求。</p>
<p>（2） <strong>G 黄轴 PRO</strong>：属于<strong>偏重手感</strong>的线性轴，从品名上能看出是 G 黄的升级版，自带厂润手感更顺滑，轴芯更稳定，声音小但有些许的闷，是目前性价比非常高的国产轴体。</p>
<p>（3） <strong>G 银轴 PRO</strong>：顺滑度和 G 黄轴 PRO 相比更胜一筹，提前触底声音小，<strong>触发速度快</strong>，轴芯稳定没有明显的晃动感。雷蛇、罗技这类游戏键盘上都是使用类似定制的轴体，非常适合游戏场景。</p>
<p>（4） <strong>快银轴</strong>：属于轻压力线性轴体，是银轴的升级版。快银轴使用了 TTC 双侧墙防尘壁专利技术结构，极大的增加轴体使用寿命，TTC 快银轴整体手感顺滑，几乎没有杂音；触发速度快、<strong>键程短</strong>、回弹跟手不易误触、轴心稳定性强。人送称号：国货天花板游戏神器。</p>
<p>（5） <strong>金粉轴</strong>： 整体手感轻盈、温柔，按压时更加顺滑也具备稳定有力的回弹，声音脆 ，杂音小且具备出色的跟手感是目前公认的顶级轻压力线性轴，被誉为码字神轴。适合长时间打字用户。</p>
<p>（6） <strong>黑轴</strong>：按压的声音小、没有段落感，键程很短 、敏感度及反弹力强。但需要花大力气去按压，用久手指容易酸累，是 “<strong>大力</strong>金刚指玩家” 的游戏键盘首选轴体。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095534157.png" alt="image-20230420095534157"></p>
<p>选择一款机械轴体基本就是选择段落轴和线性轴区别，之后依据敲击声和舒适感再进行详细划分，就能找到适合自己的轴体，不妨买个<strong>试轴器体验一下</strong>。想要轴体寿命长的颜值党也是推荐定制类的轴体。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095539280.png" alt="image-20230420095539280"></p>
<p>机械键盘还具有一招更换键帽独门秘技。同样的轴体手感依旧有所大不相同，所以在键帽的设计上除去工艺的差距，键帽的材质上也极为讲究。</p>
<p><strong>键帽</strong>有三类<strong>材质</strong>：<strong>ABS、PBT 和 POM</strong>。ABS 是使用频率最高的键帽材料，不管低价位普及型产品还是上千元的高端旗舰机械键盘，都可以看到 ABS 键帽的身影。POM 材质高成本也一同指向高售价的高端产品，所以 POM 材质键帽在键盘市场越来越少见。</p>
<p>ABS 材质本身<strong>便于加工、成本低、强度高、韧性好、透光性</strong>比 PBT<strong> 强</strong>，推荐喜欢光污染 RGB 的用户。键帽触感细腻润滑，饱和度高、色彩鲜艳。尽管<strong>制作工艺成熟</strong>但是不耐高温、耐磨性差，长时间使用后整个键盘表面表现得油光逞亮，被称为 “打油” 现象，影响美观，手感更是大打折扣。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420095543873.png" alt="image-20230420095543873"></p>
<p>“打油” 展示图</p>
<p>不能断定 ABS 材质都是不好的，价格昂贵又好看的键帽有不少是 ABS 材质。ABS 结合其他成分制作的键帽也有很耐磨的，主要看工艺和成本。</p>
<p>PBT 材质耐磨性明显优于 ABS，材质是最坚韧的工程热塑材料之一，耐高热，有非常好的化学稳定性。用 PBT 材质制作的键帽触感干爽硬朗，具有非常独特的磨砂感，耐磨性相当不错。手感上略硬一些，<strong>色彩还原度高</strong>也<strong>不易掉色</strong>，主要适用于浅色键帽。长时间使用不 “打油” 的特性得到资深玩家的热爱，但并不表示 “永不打油”，一些成本便宜成分含量低的光面 PBT 键帽一样会打油。除了以上两款常见材质外还有树脂、金属这种比较少见的材质，通常做成个性键帽，主要特点是装饰键盘突显个性，价格昂贵。</p>
<p>“横看成岭侧成峰，远近高低各不同”。 不同高度的键帽在同一把机械键盘上又会是截然不同的输入体验。<strong>总而言之适合自己才是最好的，不必盲目追求复古与特殊，舒适才是最为轻松自在的。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-13T18:13:27.000Z" title="2021/10/14 02:13:27">2021-10-14</time>发表</span><span class="level-item"><time dateTime="2021-07-09T15:26:08.000Z" title="2021/7/9 23:26:08">2021-07-09</time>更新</span><span class="level-item">1 小时读完 (大约10987个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/14/%E3%80%90Activiti%E3%80%91%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%BC%95%E6%93%8E%20Activiti%20%E6%95%99%E7%A8%8B%EF%BC%88%E9%9D%9E%E5%B8%B8%E8%AF%A6%E7%BB%86%EF%BC%89/">【Activiti】工作流引擎 Activiti 教程(非常详细)</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="扫码_搜索联合传播样式-标准色版"></p>
<h1 id="activiti工作流引擎-activiti-教程非常详细"><a class="markdownIt-Anchor" href="#activiti工作流引擎-activiti-教程非常详细">#</a> 【Activiti】工作流引擎 Activiti 教程 (非常详细)</h1>
<h1 id="更多内容关注微信公众号fullstack888"><a class="markdownIt-Anchor" href="#更多内容关注微信公众号fullstack888">#</a> 更多内容关注微信公众号：fullstack888</h1>
<h3 id="一-工作流介绍"><a class="markdownIt-Anchor" href="#一-工作流介绍">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%B7%A5%E4%BD%9C%E6%B5%81&amp;spm=1001.2101.3001.7020">工作流</a>介绍</h3>
<h4 id="11-概念"><a class="markdownIt-Anchor" href="#11-概念">#</a> 1.1 概念</h4>
<p>工作流 (<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Workflow&amp;spm=1001.2101.3001.7020">Workflow</a>)，就是通过计算机对业务流程自动化执行管理。它主要解决的是 “使在多个参与者之间按照某种预定义的规则自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。</p>
<h4 id="12-工作流系统"><a class="markdownIt-Anchor" href="#12-工作流系统">#</a> 1.2 工作流系统</h4>
<p>一个软件系统中具有工作流的功能，我们把它称为工作流系统，一个系统中工作流的功能是什么？就是对系统的业务流程进行自动化管理，所以工作流是建立在业务流程的基础上，所以一个软件的系统核心根本上还是系统的业务流程，工作流只是协助进行业务流程管理。即使没有工作流业务系统也可以开发运行，只不过有了工作流可以更好的管理业务流程，提高系统的可扩展性。</p>
<h4 id="13-适用行业"><a class="markdownIt-Anchor" href="#13-适用行业">#</a> 1.3 适用行业</h4>
<p>消费品行业，制造业，电信服务业，银证险等金融服务业，物流服务业，物业服务业，物业管理，大中型进出口贸易公司，政府事业机构，研究院所及教育服务业等，特别是大的跨国企业和集团公司。</p>
<h4 id="14-具体应用"><a class="markdownIt-Anchor" href="#14-具体应用">#</a> 1.4 具体应用</h4>
<p><strong>1、关键业务流程：</strong> 订单、报价处理、合同审核、客户电话处理、供应链管理等</p>
<p><strong>2、行政管理类：</strong> 出差申请、加班申请、请假申请、用车申请、各种办公用品申请、购买申请、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%97%A5%E6%8A%A5&amp;spm=1001.2101.3001.7020">日报</a>周报等凡是原来手工流转处理的行政表单。</p>
<p><strong>3、人事管理类：</strong> 员工培训安排、绩效考评、职位变动处理、员工档案信息管理等。</p>
<p><strong>4、财务相关类：</strong> 付款请求、应收款处理、日常报销处理、出差报销、预算和计划申请等。</p>
<p><strong>5、客户服务类：</strong> 客户信息管理、客户投诉、请求处理、售后服务管理等。</p>
<p><strong>6、特殊服务类：</strong> ISO 系列对应流程、质量管理对应流程、产品数据信息管理、贸易公司报关处理、物流公司货物跟踪处理等各种通过表单逐步手工流转完成的任务均可应用工作流软件自动规范地实施。</p>
<h4 id="15-实现方式"><a class="markdownIt-Anchor" href="#15-实现方式">#</a> 1.5 实现方式</h4>
<p>在没有专门的工作流引擎之前，我们之前为了实现流程控制，通常的做法就是采用状态字段的值来跟踪流程的变化情况。这样不同角色的用户，通过状态字段的取值来决定记录是否显示。</p>
<p>针对有权限可以查看的记录，当前用户根据自己的角色来决定审批是否合格的操作。如果合格将状态字段设置一个值，来代表合格；当然如果不合格也需要设置一个值来代表不合格的情况。</p>
<p>这是一种最为原始的方式。通过状态字段虽然做到了流程控制，但是当我们的流程发生变更的时候，这种方式所编写的代码也要进行调整。</p>
<p>那么有没有专业的方式来实现工作流的管理呢？并且可以做到业务流程变化之后，我们的程序可以不用改变，如果可以实现这样的效果，那么我们的业务系统的适应能力就得到了极大提升。</p>
<h3 id="二-activiti7概述"><a class="markdownIt-Anchor" href="#二-activiti7概述">#</a> 二、Activiti7 概述</h3>
<h4 id="21-介绍"><a class="markdownIt-Anchor" href="#21-介绍">#</a> 2.1 介绍</h4>
<p>Alfresco 软件在 2010 年 5 月 17 日宣布 Activiti 业务流程管理（BPM）开源项目的正式启动，其首席架构师由业务流程管理 BPM 的专家 Tom Baeyens 担任，Tom Baeyens 就是原来 jbpm 的架构师，而 jbpm 是一个非常有名的工作流引擎，当然 activiti 也是一个工作流引擎。</p>
<p>Activiti 是一个工作流引擎， activiti 可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言 BPMN2.0 进行定义，业务流程按照预先定义的流程进行执行，实现了系统的流程由 activiti 进行管理，减少业务系统由于流程变更进行系统升级改造的工作量，从而提高系统的健壮性，同时也减少了系统开发维护成本。</p>
<blockquote>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.activiti.org/">https://www.activiti.org/</a></p>
</blockquote>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/84ababdd7eced069a746ad6679f4278c.png" alt="84ababdd7eced069a746ad6679f4278c.png"></p>
<p>经历的版本:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/572691de13964b31846f50cee95ccf8c.png" alt="572691de13964b31846f50cee95ccf8c.png"></p>
<blockquote>
<p>目前最新版本：Activiti7.0.0.Beta</p>
</blockquote>
<h5 id="211-bpm"><a class="markdownIt-Anchor" href="#211-bpm">#</a> 2.1.1 BPM</h5>
<p>BPM（Business Process Management），即业务流程管理，是一种规范化的构造端到端的业务流程，以持续的提高组织业务效率。常见商业管理教育如 EMBA、MBA 等均将 BPM 包含在内。</p>
<h5 id="212-bpm软件"><a class="markdownIt-Anchor" href="#212-bpm软件">#</a> 2.1.2 BPM 软件</h5>
<p>BPM 软件就是根据企业中业务环境的变化，推进人与人之间、人与系统之间以及系统与系统之间的整合及调整的经营方法与解决方案的 IT 工具。</p>
<p>通过 BPM 软件对企业内部及外部的业务流程的整个生命周期进行建模、自动化、管理监控和优化，使企业成本降低，利润得以大幅提升。</p>
<p>BPM 软件在企业中应用领域广泛，凡是有业务流程的地方都可以 BPM 软件进行管理，比如企业人事办公管理、采购流程管理、公文审批流程管理、财务管理等。</p>
<h5 id="213-bpmn"><a class="markdownIt-Anchor" href="#213-bpmn">#</a> 2.1.3 BPMN</h5>
<p>BPMN（Business Process Model AndNotation）- 业务流程模型和符号 是由 BPMI（BusinessProcess Management Initiative）开发的一套标准的业务流程建模符号，使用 BPMN 提供的符号可以创建业务流程。</p>
<p>2004 年 5 月发布了 BPMN1.0 规范.BPMI 于 2005 年 9 月并入 OMG（The Object Management Group 对象管理组织) 组织。OMG 于 2011 年 1 月发布 BPMN2.0 的最终版本。</p>
<p>具体发展历史如下:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c03fea9b2a60a94dd5cc9e9e34d20345.png" alt="c03fea9b2a60a94dd5cc9e9e34d20345.png"></p>
<p>BPMN 是目前被各 BPM 厂商广泛接受的 BPM 标准。Activiti 就是使用 BPMN 2.0 进行流程建模、流程执行管理，它包括很多的建模符号，比如：Event</p>
<p>用一个圆圈表示，它是流程中运行过程中发生的事情。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/04355942bc6488f80cbec0bef5f241ca.png" alt="04355942bc6488f80cbec0bef5f241ca.png"></p>
<p>活动用圆角矩形表示，一个流程由一个活动或多个活动组成</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fab3c23503e4731e4d49e32307818190.png" alt="fab3c23503e4731e4d49e32307818190.png"></p>
<p>Bpmn 图形其实是通过 xml 表示业务流程，上边的.bpmn 文件使用文本编辑器打开：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;definitions xmlns=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:xsd=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> xmlns:activiti=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> xmlns:bpmndi=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> xmlns:omgdc=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> xmlns:omgdi=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> typeLanguage=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> expressionLanguage=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> targetNamespace=<span class="string">&quot;http://www.activiti.org/test&quot;</span>&gt;</span><br><span class="line">  &lt;process id=<span class="string">&quot;myProcess&quot;</span> name=<span class="string">&quot;My process&quot;</span> isExecutable=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;startEvent id=<span class="string">&quot;startevent1&quot;</span> name=<span class="string">&quot;Start&quot;</span>&gt;&lt;/startEvent&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask1&quot;</span> name=<span class="string">&quot;创建请假单&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow1&quot;</span> sourceRef=<span class="string">&quot;startevent1&quot;</span> targetRef=<span class="string">&quot;usertask1&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask2&quot;</span> name=<span class="string">&quot;部门经理审核&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow2&quot;</span> sourceRef=<span class="string">&quot;usertask1&quot;</span> targetRef=<span class="string">&quot;usertask2&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask3&quot;</span> name=<span class="string">&quot;人事复核&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow3&quot;</span> sourceRef=<span class="string">&quot;usertask2&quot;</span> targetRef=<span class="string">&quot;usertask3&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;endEvent id=<span class="string">&quot;endevent1&quot;</span> name=<span class="string">&quot;End&quot;</span>&gt;&lt;/endEvent&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow4&quot;</span> sourceRef=<span class="string">&quot;usertask3&quot;</span> targetRef=<span class="string">&quot;endevent1&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">  &lt;/process&gt;</span><br><span class="line">  &lt;bpmndi:BPMNDiagram id=<span class="string">&quot;BPMNDiagram_myProcess&quot;</span>&gt;</span><br><span class="line">    &lt;bpmndi:BPMNPlane bpmnElement=<span class="string">&quot;myProcess&quot;</span> id=<span class="string">&quot;BPMNPlane_myProcess&quot;</span>&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;startevent1&quot;</span> id=<span class="string">&quot;BPMNShape_startevent1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;35.0&quot;</span> width=<span class="string">&quot;35.0&quot;</span> x=<span class="string">&quot;130.0&quot;</span> y=<span class="string">&quot;160.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask1&quot;</span> id=<span class="string">&quot;BPMNShape_usertask1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;210.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask2&quot;</span> id=<span class="string">&quot;BPMNShape_usertask2&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;360.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask3&quot;</span> id=<span class="string">&quot;BPMNShape_usertask3&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;510.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;endevent1&quot;</span> id=<span class="string">&quot;BPMNShape_endevent1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;35.0&quot;</span> width=<span class="string">&quot;35.0&quot;</span> x=<span class="string">&quot;660.0&quot;</span> y=<span class="string">&quot;160.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow1&quot;</span> id=<span class="string">&quot;BPMNEdge_flow1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;165.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;210.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow2&quot;</span> id=<span class="string">&quot;BPMNEdge_flow2&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;315.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;360.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow3&quot;</span> id=<span class="string">&quot;BPMNEdge_flow3&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;465.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;510.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow4&quot;</span> id=<span class="string">&quot;BPMNEdge_flow4&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;615.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;660.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">    &lt;/bpmndi:BPMNPlane&gt;</span><br><span class="line">  &lt;/bpmndi:BPMNDiagram&gt;</span><br><span class="line">&lt;/definitions&gt;</span><br></pre></td></tr></table></figure>
<h4 id="22-使用步骤"><a class="markdownIt-Anchor" href="#22-使用步骤">#</a> 2.2 使用步骤</h4>
<h6 id="部署activiti"><a class="markdownIt-Anchor" href="#部署activiti">#</a> 部署 activiti</h6>
<p>Activiti 是一个工作流引擎（其实就是一堆 jar 包 API），业务系统访问 (操作) activiti 的接口，就可以方便的操作流程相关数据，这样就可以把工作流环境与业务系统的环境集成在一起。</p>
<h6 id="流程定义"><a class="markdownIt-Anchor" href="#流程定义">#</a> 流程定义</h6>
<p>使用 activiti 流程建模工具 (activity-designer) 定义业务流程 (.bpmn 文件) 。</p>
<p>.bpmn 文件就是业务流程定义文件，通过 xml 定义业务流程。</p>
<h6 id="流程定义部署"><a class="markdownIt-Anchor" href="#流程定义部署">#</a> 流程定义部署</h6>
<p>activiti 部署业务流程定义（.bpmn 文件）。</p>
<p>使用 activiti 提供的 api 把流程定义内容存储起来，在 Activiti 执行过程中可以查询定义的内容</p>
<p>Activiti 执行把流程定义内容存储在数据库中</p>
<h6 id="启动一个流程实例"><a class="markdownIt-Anchor" href="#启动一个流程实例">#</a> 启动一个流程实例</h6>
<p>流程实例也叫：ProcessInstance</p>
<p>启动一个流程实例表示开始一次业务流程的运行。</p>
<p>在员工请假流程定义部署完成后，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响。</p>
<h6 id="用户查询待办任务task"><a class="markdownIt-Anchor" href="#用户查询待办任务task">#</a> 用户查询待办任务 (Task)</h6>
<p>因为现在系统的业务流程已经交给 activiti 管理，通过 activiti 就可以查询当前流程执行到哪了，当前用户需要办理什么任务了，这些 activiti 帮我们管理了，而不需要开发人员自己编写在 sql 语句查询。</p>
<h6 id="用户办理任务"><a class="markdownIt-Anchor" href="#用户办理任务">#</a> 用户办理任务</h6>
<p>用户查询待办任务后，就可以办理某个任务，如果这个任务办理完成还需要其它用户办理，比如采购单创建后由部门经理审核，这个过程也是由 activiti 帮我们完成了。</p>
<h6 id="流程结束"><a class="markdownIt-Anchor" href="#流程结束">#</a> 流程结束</h6>
<p>当任务办理完成没有下一个任务结点了，这个流程实例就完成了。</p>
<h3 id="三-activiti环境"><a class="markdownIt-Anchor" href="#三-activiti环境">#</a> 三、Activiti 环境</h3>
<h4 id="31-开发环境"><a class="markdownIt-Anchor" href="#31-开发环境">#</a> 3.1 开发环境</h4>
<ul>
<li>Jdk1.8 或以上版本</li>
<li>Mysql 5 及以上的版本</li>
<li>Tomcat8.5</li>
<li>IDEA</li>
</ul>
<blockquote>
<p>注意：activiti 的流程定义工具插件可以安装在 IDEA 下，也可以安装在 Eclipse 工具下</p>
</blockquote>
<h4 id="32-activiti环境"><a class="markdownIt-Anchor" href="#32-activiti环境">#</a> 3.2 Activiti 环境</h4>
<p>我们使用： <code>Activiti7.0.0.Beta1</code>  默认支持 spring5</p>
<h4 id="321-下载activiti7"><a class="markdownIt-Anchor" href="#321-下载activiti7">#</a> 3.2.1 下载 activiti7</h4>
<p>Activiti 下载地址： <code>http://activiti.org/download.html</code>  ，Maven 的依赖如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;activiti-dependencies&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">7.0</span><span class="number">.0</span>.Beta1&lt;/version&gt;</span><br><span class="line">           &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">           &lt;<span class="keyword">type</span>&gt;pom&lt;/<span class="keyword">type</span>&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">   &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-database"><a class="markdownIt-Anchor" href="#1-database">#</a> 1) Database：</h6>
<p>activiti 运行需要有数据库的支持，支持的数据库有：h2, mysql, oracle, postgres, mssql, db2。</p>
<h5 id="322-流程设计器idea下安装"><a class="markdownIt-Anchor" href="#322-流程设计器idea下安装">#</a> 3.2.2 流程设计器 IDEA 下安装</h5>
<p>在 IDEA 的 File 菜单中找到子菜单”Settings”, 后面我们再选择左侧的 “plugins” 菜单，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6a554dcde54364bd5956c4315b6efb3f.png" alt="6a554dcde54364bd5956c4315b6efb3f.png"></p>
<p>此时我们就可以搜索到 actiBPM 插件，它就是 <code>Activiti Designer</code>  的 IDEA 版本，我们点击 Install 安装。</p>
<p>安装好后，页面如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3ce77485ef663bc305ef2ab181685dc4.png" alt="3ce77485ef663bc305ef2ab181685dc4.png"></p>
<p>提示需要重启 idea，点击重启。</p>
<p>重启完成后，再次打开 Settings 下的 Plugins（插件列表），点击右侧的 Installed（已安装的插件），在列表中看到 actiBPM，就说明已经安装成功了，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c5fd38ac92d7d87f1e7725d9325b8700.png" alt="c5fd38ac92d7d87f1e7725d9325b8700.png"></p>
<p>后面的课程里，我们会使用这个流程设计器进行 Activiti 的流程设计。</p>
<h4 id="33-activiti的数据库支持"><a class="markdownIt-Anchor" href="#33-activiti的数据库支持">#</a> 3.3 Activiti 的数据库支持</h4>
<p>Activiti 在运行时需要数据库的支持，使用 25 张表，把流程定义节点内容读取到数据库表中，以供后续使用。</p>
<h5 id="331-activiti-支持的数据库"><a class="markdownIt-Anchor" href="#331-activiti-支持的数据库">#</a> 3.3.1 Activiti 支持的数据库</h5>
<p>activiti 支持的数据库和版本如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a41fe8e76718ac216afa1ec8bd79f6b4.png" alt="a41fe8e76718ac216afa1ec8bd79f6b4.png"></p>
<h5 id="332-在mysql生成表"><a class="markdownIt-Anchor" href="#332-在mysql生成表">#</a> 3.3.2 在 MySQL 生成表</h5>
<p><strong>3.3.2.1 创建数据库</strong></p>
<p>创建 mysql 数据库 activiti （名字任意）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;</span><br></pre></td></tr></table></figure>
<p><strong>3.3.2.2 使用 java 代码生成表</strong></p>
<ul>
<li>创建 java 工程</li>
</ul>
<p>使用 idea 创建 java 的 maven 工程，取名：activiti01。</p>
<ul>
<li>加入 maven 依赖的坐标（jar 包）</li>
</ul>
<p>首先需要在 java 工程中加入 ProcessEngine 所需要的 jar 包，包括：</p>
<ol>
<li>activiti-engine-7.0.0.beta1.jar</li>
<li>activiti 依赖的 jar 包：mybatis、 alf4j、 log4j 等</li>
<li>activiti 依赖的 spring 包</li>
<li>mysql 数据库驱动</li>
<li>第三方数据连接池 dbcp</li>
<li>单元测试 Junit-4.12.jar</li>
</ol>
<p>我们使用 maven 来实现项目的构建，所以应当导入这些 jar 所对应的坐标到 pom.xml 文件中。</p>
<p>完整的依赖内容如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;slf4j.version&gt;<span class="number">1.6</span><span class="number">.6</span>&lt;/slf4j.version&gt;</span><br><span class="line">    &lt;log4j.version&gt;<span class="number">1.2</span><span class="number">.12</span>&lt;/log4j.version&gt;</span><br><span class="line">    &lt;activiti.version&gt;<span class="number">7.0</span><span class="number">.0</span>.Beta1&lt;/activiti.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-engine&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-spring&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 模型处理 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-model&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 转换 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-converter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn json数据转换 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-json-converter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 布局 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-layout&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- activiti 云支持 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-cloud-services-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- mysql驱动 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">5.1</span><span class="number">.40</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- mybatis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">3.4</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- 链接池 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.4</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">4.12</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- log start --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 log4j 日志配置</li>
</ul>
<p>我们使用 log4j 日志包，可以对日志进行配置</p>
<p>在 resources 下创建 log4j.properties</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Set root category priority to INFO and its only appender to CONSOLE.</span><br><span class="line">#log4j.rootCategory=INFO, CONSOLE debug info warn <span class="type">error</span> fatal</span><br><span class="line">log4j.rootCategory=debug, CONSOLE, LOGFILE</span><br><span class="line"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span><br><span class="line">log4j.logger.org.apache.axis.enterprise=FATAL, CONSOLE</span><br><span class="line"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span><br><span class="line">log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;ISO8601&#125; %<span class="number">-6</span>r[%<span class="number">15.15</span>t] %<span class="number">-5</span>p %<span class="number">30.30</span>c %x - %m\n</span><br><span class="line"># LOGFILE is set to be a File appender using a PatternLayout.</span><br><span class="line">log4j.appender.LOGFILE=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.LOGFILE.File=f:\act\activiti.log</span><br><span class="line">log4j.appender.LOGFILE.Append=<span class="literal">true</span></span><br><span class="line">log4j.appender.LOGFILE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.LOGFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; %<span class="number">-6</span>r[%<span class="number">15.15</span>t] %<span class="number">-5</span>p %<span class="number">30.30</span>c %x - %m\n</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 activiti 配置文件</li>
</ul>
<p>我们使用 activiti 提供的默认方式来创建 mysql 的表。</p>
<p>默认方式的要求是在 resources 下创建  <code>activiti.cfg.xml</code>  文件，注意：默认方式目录和文件名不能修改，因为 activiti 的源码中已经设置，到固定的目录读取固定文件名的文件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 activiti.cfg.xml 中进行配置</li>
</ul>
<p>默认方式要在在 <code>activiti.cfg.xml</code>  中 bean 的名字叫 <code>processEngineConfiguration</code> ，名字不可修改</p>
<p>在这里有 2 中配置方式：一种是单独配置数据源，一种是不单独配置数据源</p>
<p>1、直接配置 <code>processEngineConfiguration</code></p>
<p><code>processEngineConfiguration</code>  用来创建  <code>ProcessEngine</code> ，在创建  <code>ProcessEngine</code>  时会执行数据库的操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 默认id对应的值 为processEngineConfiguration --&gt;</span><br><span class="line">    &lt;!-- processEngine Activiti的流程引擎 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcDriver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUrl&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUsername&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcPassword&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- activiti数据库表处理策略 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>2、配置数据源后，在 <code>processEngineConfiguration</code>  引用</p>
<p>首先配置数据源</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 这里可以使用 链接池 dbcp--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span> /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 引用数据源 上面已经设置好了--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">        &lt;!-- activiti数据库表处理策略 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>java 类编写程序生成表</li>
</ul>
<p>创建一个测试类，调用 activiti 的工具类，生成 acitivti 需要的数据库表。</p>
<p>直接使用 activiti 提供的工具类 <code>ProcessEngines</code> ，会默认读取 classpath 下的 <code>activiti.cfg.xml</code>  文件，读取其中的数据库配置，创建  <code>ProcessEngine</code> ，在创建 <code>ProcessEngine</code>  时会自动创建表。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.activiti01.test;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"> </span><br><span class="line">public class TestDemo &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 activiti的数据库表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testCreateDbTable() &#123;</span><br><span class="line">        <span class="comment">//使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line">  ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">  System.out.<span class="built_in">println</span>(processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>运行以上程序段即可完成 activiti 表创建，通过改变  <code>activiti.cfg.xml</code>  中 <code>databaseSchemaUpdate</code>  参数的值执行不同的数据表处理策略。</li>
<li>上 边 的 方法  <code>getDefaultProcessEngine</code>  方法在执行时，从 <code>activiti.cfg.xml</code>  中找固定的名称  <code>processEngineConfiguration</code>  。</li>
</ul>
<p>在测试程序执行过程中，idea 的控制台会输出日志，说明程序正在创建数据表，类似如下，注意红线内容：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7fc3cd07647b00c2169abcc747a93f7a.png" alt="7fc3cd07647b00c2169abcc747a93f7a.png"></p>
<p>执行完成后我们查看数据库， 创建了 25 张表，结果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b3dc67533eaebcb9bee794061b94b4d2.png" alt="b3dc67533eaebcb9bee794061b94b4d2.png"></p>
<p>到这，我们就完成 activiti 运行需要的数据库和表的创建。</p>
<h4 id="34-表结构介绍"><a class="markdownIt-Anchor" href="#34-表结构介绍">#</a> 3.4 表结构介绍</h4>
<h5 id="341-表的命名规则和作用"><a class="markdownIt-Anchor" href="#341-表的命名规则和作用">#</a> 3.4.1 表的命名规则和作用</h5>
<p>看到刚才创建的表，我们发现 Activiti 的表都以  <code>ACT_ </code> 开头。</p>
<p>第二部分是表示表的用途的两个字母标识。用途也和服务的 API 对应。</p>
<ul>
<li><code>ACT_RE</code>  ：'RE’表示 repository。这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>
<li><code>ACT_RU</code> ：'RU’表示 runtime。这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。Activiti 只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。这样运行时表可以一直很小速度很快。</li>
<li><code>ACT_HI</code> ：'HI’表示 history。这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>
<li><code>ACT_GE</code>  ：GE 表示 general。通用数据， 用于不同场景下</li>
</ul>
<h5 id="342-activiti数据表介绍"><a class="markdownIt-Anchor" href="#342-activiti数据表介绍">#</a> 3.4.2 Activiti 数据表介绍</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1c6b494498f9165d2b9e72af6d0d193b.png" alt="1c6b494498f9165d2b9e72af6d0d193b.png"></p>
<h3 id="四-activiti类关系图"><a class="markdownIt-Anchor" href="#四-activiti类关系图">#</a> 四、Activiti 类关系图</h3>
<p>上面我们完成了 Activiti 数据库表的生成，java 代码中我们调用 Activiti 的工具类，下面来了解 Activiti 的类关系</p>
<h4 id="41-类关系图"><a class="markdownIt-Anchor" href="#41-类关系图">#</a> 4.1 类关系图</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/512e936b3d7c2e505d1f28991d5bf572.png" alt="512e936b3d7c2e505d1f28991d5bf572.png"></p>
<p>在新版本中，我们通过实验可以发现 <code>IdentityService</code> ， <code>FormService</code>  两个 Serivce 都已经删除了。</p>
<p>所以后面我们对于这两个 Service 也不讲解了，但老版本中还是有这两个 Service，同学们需要了解一下</p>
<h4 id="42-activiticfgxml"><a class="markdownIt-Anchor" href="#42-activiticfgxml">#</a> 4.2 activiti.cfg.xml</h4>
<p>activiti 的引擎配置文件，包括： <code>ProcessEngineConfiguration</code>  的定义、数据源定义、事务管理器等，此文件其实就是一个 spring 配置文件。</p>
<h4 id="43-流程引擎配置类"><a class="markdownIt-Anchor" href="#43-流程引擎配置类">#</a> 4.3 流程引擎配置类</h4>
<p>流程引擎的配置类（ <code>ProcessEngineConfiguration</code> ），通过 <code>ProcessEngineConfiguration</code>  可以创建工作流引擎 <code>ProceccEngine</code> ，常用的两种方法如下：</p>
<h5 id="431-standaloneprocessengineconfiguration"><a class="markdownIt-Anchor" href="#431-standaloneprocessengineconfiguration">#</a> 4.3.1 StandaloneProcessEngineConfiguration</h5>
<p>使用 <code>StandaloneProcessEngineConfigurationActiviti</code>  可以单独运行，来创建 <code>ProcessEngine</code> ， <code>Activiti</code>  会自己处理事务。</p>
<p>配置文件方式：</p>
<p>通常在 <code>activiti.cfg.xml</code>  配置文件中定义一个 id 为  <code>processEngineConfiguration</code>  的 bean。</p>
<p>方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!--配置数据库相关的信息--&gt;</span><br><span class="line">        &lt;!--数据库驱动--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcDriver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库链接--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUrl&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库用户名--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUsername&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库密码--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcPassword&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;!--actviti数据库表在生成时的策略  <span class="literal">true</span> - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>还可以加入连接池:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--在默认方式下 bean的id  固定为 processEngineConfiguration--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!--引入上面配置好的 链接池--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>/&gt;</span><br><span class="line">        &lt;!--actviti数据库表在生成时的策略  <span class="literal">true</span> - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h5 id="432-springprocessengineconfiguration"><a class="markdownIt-Anchor" href="#432-springprocessengineconfiguration">#</a> 4.3.2 SpringProcessEngineConfiguration</h5>
<p>通过 <code>org.activiti.spring.SpringProcessEngineConfiguration</code>  与 Spring 整合。</p>
<p>创建 spring 与 activiti 的整合配置文件：</p>
<p><code>activity-spring.cfg.xml</code> （名称可修改）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">   xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:mvc=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="line">xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">   xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/beans/spring-beans-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/mvc </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/context </span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/aop </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/aop/spring-aop-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/tx </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/tx/spring-tx-3.1.xsd &quot;</span>&gt;</span><br><span class="line">   &lt;!-- 工作流引擎配置bean --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span> class=<span class="string">&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">      &lt;!-- 数据源 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- 使用spring事务管理器 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;transactionManager&quot;</span> ref=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- 数据库策略 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;drop-create&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- activiti的定时任务关闭 --&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;jobExecutorActivate&quot;</span> value=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 流程引擎 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;processEngine&quot;</span> class=<span class="string">&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;processEngineConfiguration&quot;</span> ref=<span class="string">&quot;processEngineConfiguration&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 资源服务service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;repositoryService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getRepositoryService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 流程运行service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;runtimeService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getRuntimeService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 任务管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;taskService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getTaskService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 历史管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;historyService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getHistoryService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 用户管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;identityService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getIdentityService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 引擎管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;managementService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getManagementService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 数据源 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://localhost:3306/activiti&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;mysql&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 事务管理器 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;transactionManager&quot;</span></span><br><span class="line">    class=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 通知 --&gt;</span><br><span class="line">   &lt;tx:advice id=<span class="string">&quot;txAdvice&quot;</span> transaction-manager=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><br><span class="line">      &lt;tx:attributes&gt;&lt;/tx:attributes&gt;</span><br><span class="line">          &lt;!-- 传播行为 --&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;save*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;insert*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;delete*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;update*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;find*&quot;</span> propagation=<span class="string">&quot;SUPPORTS&quot;</span> read-only=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;get*&quot;</span> propagation=<span class="string">&quot;SUPPORTS&quot;</span> read-only=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line">       &lt;/tx:attributes&gt;</span><br><span class="line">   &lt;/tx:advice&gt;</span><br><span class="line">   &lt;!-- 切面，根据具体项目修改切点配置 --&gt;</span><br><span class="line">   &lt;aop:config proxy-target-class=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">      &lt;aop:advisor advice-ref=<span class="string">&quot;txAdvice&quot;</span>  pointcut=<span class="string">&quot;execution(* com.itheima.ihrm.service.impl.*.(..))&quot;</span>* /&gt;</span><br><span class="line">  &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>创建 <code>processEngineConfiguration</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration configuration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>上边的代码要求 <code>activiti.cfg.xml</code>  中必须有一个 <code>processEngineConfiguration</code>  的 bean</p>
<p>也可以使用下边的方法，更改 bean 的名字：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);</span><br></pre></td></tr></table></figure>
<h4 id="44-工作流引擎创建"><a class="markdownIt-Anchor" href="#44-工作流引擎创建">#</a> 4.4 工作流引擎创建</h4>
<p>工作流引擎（ProcessEngine），相当于一个门面接口，通过 <code>ProcessEngineConfiguration</code>  创建 <code>processEngine</code> ，通过 <code>ProcessEngine</code>  创建各个 service 接口。</p>
<h5 id="441-默认创建方式"><a class="markdownIt-Anchor" href="#441-默认创建方式">#</a> 4.4.1 默认创建方式</h5>
<p>将 <code>activiti.cfg.xml</code>  文件名及路径固定，且 <code>activiti.cfg.xml</code>  文件中有  <code>processEngineConfiguration</code>  的配置， 可以使用如下代码创建 <code>processEngine</code> :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接使用工具类 ProcessEngines，使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">System.out.<span class="built_in">println</span>(processEngine);</span><br></pre></td></tr></table></figure>
<h5 id="442-一般创建方式"><a class="markdownIt-Anchor" href="#442-一般创建方式">#</a> 4.4.2 一般创建方式</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先构建ProcessEngineConfiguration</span></span><br><span class="line">ProcessEngineConfiguration configuration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>);</span><br><span class="line"><span class="comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span></span><br><span class="line">ProcessEngine processEngine = configuration.buildProcessEngine();</span><br></pre></td></tr></table></figure>
<h5 id="45-servcie服务接口"><a class="markdownIt-Anchor" href="#45-servcie服务接口">#</a> 4.5 Servcie 服务接口</h5>
<p>Service 是工作流引擎提供用于进行工作流部署、执行、管理的服务接口，我们使用这些接口可以就是操作服务对应的数据表</p>
<p>4.5.1 Service 创建方式</p>
<p>通过 ProcessEngine 创建 Service</p>
<p>方式如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">TaskService taskService = processEngine.getTaskService();</span><br></pre></td></tr></table></figure>
<p>4.5.2 Service 总览</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5697fc50f337d0e67354c93535c14cb2.png" alt="5697fc50f337d0e67354c93535c14cb2.png"></p>
<p>简单介绍：</p>
<ul>
<li><strong>RepositoryService</strong></li>
</ul>
<p>是 activiti 的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此 service 将流程定义文件的内容部署到计算机。</p>
<p>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</p>
<p>暂停或激活发布包，对应全部和特定流程定义。暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</p>
<p>获得流程定义的 pojo 版本， 可以用来通过 java 解析流程，而不必通过 xml。</p>
<ul>
<li><strong>RuntimeService</strong></li>
</ul>
<p>Activiti 的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</p>
<ul>
<li><strong>TaskService</strong></li>
</ul>
<p>Activiti 的任务管理类。可以从这个类中获取任务的信息。</p>
<ul>
<li><strong>HistoryService</strong></li>
</ul>
<p>Activiti 的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。这个服务主要通过查询功能来获得这些数据。</p>
<ul>
<li><strong>ManagementService</strong></li>
</ul>
<p>Activiti 的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</p>
<h3 id="五-activiti入门"><a class="markdownIt-Anchor" href="#五-activiti入门">#</a> 五、Activiti 入门</h3>
<p>在本章内容中，我们来创建一个 Activiti 工作流，并启动这个流程。</p>
<p>创建 Activiti 工作流主要包含以下几步：</p>
<ul>
<li>定义流程，按照 BPMN 的规范，使用流程定义工具，用流程符号把整个流程描述出来</li>
<li>部署流程，把画好的流程定义文件，加载到数据库中，生成表的数据</li>
<li>启动流程，使用 java 代码来操作数据库表中的内容</li>
</ul>
<h4 id="51-流程符号"><a class="markdownIt-Anchor" href="#51-流程符号">#</a> 5.1 流程符号</h4>
<p>BPMN 2.0 是业务流程建模符号 2.0 的缩写。</p>
<p>它由 Business Process Management Initiative 这个非营利协会创建并不断发展。作为一种标识，BPMN 2.0 是使用一些符号来明确业务流程设计流程图的一整套符号规范，它能增进业务建模时的沟通效率。</p>
<p>目前 BPMN2.0 是最新的版本，它用于在 BPM 上下文中进行布局和可视化的沟通。</p>
<p>接下来我们先来了解在流程设计中常见的 符号。</p>
<p>BPMN2.0 的基本符合主要包含：</p>
<h5 id="事件-event"><a class="markdownIt-Anchor" href="#事件-event">#</a> 事件 Event</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/118051bcb888229c8b6a28c96dd70ae4.png" alt="118051bcb888229c8b6a28c96dd70ae4.png"></p>
<h5 id="活动-activity"><a class="markdownIt-Anchor" href="#活动-activity">#</a> 活动 Activity</h5>
<p>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程；其次，你还可以为活动指定不同的类型。常见活动如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ec675c381810e1f8f779d3852e619ad2.png" alt="ec675c381810e1f8f779d3852e619ad2.png"></p>
<h5 id="网关-gateway"><a class="markdownIt-Anchor" href="#网关-gateway">#</a> 网关 GateWay</h5>
<p>网关用来处理决策，有几种常用网关需要了解：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7e81eb95b7c1149abb5b5f4a467bcf5a.png" alt="7e81eb95b7c1149abb5b5f4a467bcf5a.png"></p>
<p><strong>排他网关 (x)</strong></p>
<p>—— 只有一条路径会被选择。流程执行到该网关时，按照输出流的顺序逐个计算，当条件的计算结果为 true 时，继续执行当前网关的输出流；</p>
<ul>
<li>如果多条线路计算结果都是 true，则会执行第一个值为 true 的线路。如果所有网关计算结果没有 true，则引擎会抛出异常。</li>
<li>排他网关需要和条件顺序流结合使用，default 属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。</li>
</ul>
<p><strong>并行网关 (+)</strong></p>
<p>—— 所有路径会被同时选择</p>
<ul>
<li>拆分 —— 并行执行所有输出顺序流，为每一条顺序流创建一个并行执行线路。</li>
<li>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</li>
</ul>
<p><strong>包容网关 (+)</strong></p>
<p>—— 可以同时执行多条线路，也可以在网关上设置条件</p>
<ul>
<li>拆分 —— 计算每条线路上的表达式，当表达式计算结果为 true 时，创建一个并行线路并继续执行</li>
<li>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</li>
</ul>
<p><strong>事件网关 (+)</strong></p>
<p>—— 专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态。</p>
<h5 id="流向-flow"><a class="markdownIt-Anchor" href="#流向-flow">#</a> 流向 Flow</h5>
<p>流是连接两个流程节点的连线。常见的流向包含以下几种：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/82c584939f73517735eb4b8ba0594611.png" alt="82c584939f73517735eb4b8ba0594611.png"></p>
<h4 id="52-流程设计器使用"><a class="markdownIt-Anchor" href="#52-流程设计器使用">#</a> 5.2 流程设计器使用</h4>
<h5 id="activiti-designer使用"><a class="markdownIt-Anchor" href="#activiti-designer使用">#</a> Activiti-Designer 使用</h5>
<h5 id="palette画板"><a class="markdownIt-Anchor" href="#palette画板">#</a> Palette（画板）</h5>
<p>在 idea 中安装插件即可使用，画板中包括以下结点：</p>
<ul>
<li>Connection— 连接</li>
<li>Event— 事件</li>
<li>Task— 任务</li>
<li>Gateway— 网关</li>
<li>Container— 容器</li>
<li>Boundary event— 边界事件</li>
<li>Intermediate event- - 中间事件</li>
</ul>
<p>流程图设计完毕保存生成.bpmn 文件</p>
<h5 id="新建流程idea工具"><a class="markdownIt-Anchor" href="#新建流程idea工具">#</a> 新建流程 (IDEA 工具)</h5>
<p>首先选中存放图形的目录 (选择 resources 下的 bpmn 目录)，点击菜单： <code>New -&gt; BpmnFile</code> ，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/06bc384d8f71d945be74121218df4109.png" alt="06bc384d8f71d945be74121218df4109.png"></p>
<p>弹出如下图所示框，输入 evection 表示 出差审批流程：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/d358a2338ab5a332f74f8f7732225fda.png" alt="d358a2338ab5a332f74f8f7732225fda.png"></p>
<p>起完名字 evection 后（默认扩展名为 bpmn），就可以看到流程设计页面，如图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/26b2c4c13f7b329cb7cdd6d289676167.png" alt="26b2c4c13f7b329cb7cdd6d289676167.png"></p>
<p>左侧区域是绘图区，右侧区域是 palette 画板区域</p>
<p>鼠标先点击画板的元素即可在左侧绘图</p>
<h5 id="绘制流程"><a class="markdownIt-Anchor" href="#绘制流程">#</a> 绘制流程</h5>
<p>使用滑板来绘制流程，通过从右侧把图标拖拽到左侧的画板，最终效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/80e48a5d861bcaaf4e27c0676dfafff6.png" alt="80e48a5d861bcaaf4e27c0676dfafff6.png"></p>
<h5 id="指定流程定义key"><a class="markdownIt-Anchor" href="#指定流程定义key">#</a> 指定流程定义 Key</h5>
<p>流程定义 key 即流程定义的标识，通过 properties 视图查看流程的 key</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/42ebf534f78c3895c98c4ecd5d68b301.png" alt="42ebf534f78c3895c98c4ecd5d68b301.png"></p>
<h5 id="指定任务负责人"><a class="markdownIt-Anchor" href="#指定任务负责人">#</a> 指定任务负责人</h5>
<p>在 properties 视图指定每个任务结点的负责人，如：填写出差申请的负责人为 zhangsan</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/62d692f310cb319cf4c4c964bb2aadcc.png" alt="62d692f310cb319cf4c4c964bb2aadcc.png"></p>
<ul>
<li>经理审批负责人为 jerry</li>
<li>总经理审批负责人为 jack</li>
<li>财务审批负责人为 rose</li>
</ul>
<h3 id="六-流程操作"><a class="markdownIt-Anchor" href="#六-流程操作">#</a> 六、流程操作</h3>
<h4 id="61-流程定义"><a class="markdownIt-Anchor" href="#61-流程定义">#</a> 6.1 流程定义</h4>
<h5 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h5>
<p>流程定义是线下按照 bpmn2.0 标准去描述 业务流程，通常使用 idea 中的插件对业务流程进行建模。IDEA 插件介绍：<a href="">IDEA 值得推荐的十几款优秀插件，狂，拽，屌！</a></p>
<p>使用 idea 下的 designer 设计器绘制流程，并会生成两个文件：.bpmn 和.png</p>
<h5 id="bpmn文件"><a class="markdownIt-Anchor" href="#bpmn文件">#</a> .bpmn 文件</h5>
<p>使用 activiti-desinger 设计业务流程，会生成.bpmn 文件，上面我们已经创建好了 bpmn 文件</p>
<p>BPMN 2.0 根节点是 definitions 节点。这个元素中，可以定义多个流程定义（不过我们建议每个文件只包含一个流程定义， 可以简化开发过程中的维护难度）。</p>
<blockquote>
<p>注意，definitions 元素 最少也要包含 xmlns 和 targetNamespace 的声明。targetNamespace 可以是任意值，它用来对流程实例进行分类。</p>
</blockquote>
<ul>
<li>流程定义部分：定义了流程每个结点的描述及结点之间的流程流转。</li>
<li>流程布局定义：定义流程每个结点在流程图上的位置坐标等信息。</li>
</ul>
<h5 id="生成png图片文件"><a class="markdownIt-Anchor" href="#生成png图片文件">#</a> 生成.png 图片文件</h5>
<p>IDEA 工具中的操作方式</p>
<p><strong>1、修改文件后缀为 xml</strong></p>
<p>首先将 evection.bpmn 文件改名为 evection.xml，如下图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6b8b3168ec2eb053d23dd89e760eb66c.png" alt="6b8b3168ec2eb053d23dd89e760eb66c.png"></p>
<p>evection.xml 修改前的 bpmn 文件，效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/05323c8f1d142e4a50be0998af182de9.png" alt="05323c8f1d142e4a50be0998af182de9.png"></p>
<p><strong>2、使用 designer 设计器打开.xml 文件</strong></p>
<p>在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 <code>Show BPMN2.0 Designer…</code></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fbfd788c624ebe75fbf8dc38dce5d1ec.png" alt="fbfd788c624ebe75fbf8dc38dce5d1ec.png"></p>
<p><strong>3、查看打开的文件</strong></p>
<p>打开后，却出现乱码，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/35b69a94cf23e9e801955824c1763dd9.png" alt="35b69a94cf23e9e801955824c1763dd9.png"></p>
<p><strong>4、解决中文乱码</strong></p>
<p>1、打开 Settings，找到 File Encodings，把 encoding 的选项都选择 UTF-8</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f114de04f6d9a6371ecfc8f3ec7138cf.png" alt="f114de04f6d9a6371ecfc8f3ec7138cf.png"></p>
<p>2、打开 IDEA 安装路径，找到如下的安装目录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/33d300d7dbf3078d72555e22357622e3.png" alt="33d300d7dbf3078d72555e22357622e3.png"></p>
<p>根据自己所安装的版本来决定，我使用的是 64 位的 idea，所以在 <code>idea64.exe.vmoptions</code>  文件的最后一行追加一条命令： <code> -Dfile.encoding=UTF-8</code></p>
<p>如下所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/d848eb7069122f8a2cb5de6e05fe99a8.png" alt="d848eb7069122f8a2cb5de6e05fe99a8.png"></p>
<p>一定注意，不要有空格，否则重启 IDEA 时会打不开，然后 重启 IDEA。</p>
<p>如果以上方法已经做完，还出现乱码，就再修改一个文件，并在文件的末尾添加： <code>-Dfile.encoding=UTF-8</code> ，然后重启 idea，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6f4f2a580c57e5e4a05f3822974b6b50.png" alt="6f4f2a580c57e5e4a05f3822974b6b50.png"></p>
<p>最后重新在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 <code>Show BPMN2.0 Designer…</code> ，看到生成图片，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7c8f334d658e8275844d6c7ac165881a.png" alt="7c8f334d658e8275844d6c7ac165881a.png"></p>
<p>到此，解决乱码问题</p>
<h5 id="5-导出为图片文件"><a class="markdownIt-Anchor" href="#5-导出为图片文件">#</a> 5、导出为图片文件</h5>
<p>点击 <code>Export To File</code>  的小图标，打开如下窗口，注意填写文件名及扩展名，选择好保存图片的位置：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/963675cefb4d34535e003d7d791564ab.png" alt="963675cefb4d34535e003d7d791564ab.png"></p>
<p>然后，我们把 png 文件拷贝到 resources 下的 bpmn 目录，并且把 evection.xml 改名为 evection.bpmn。</p>
<h4 id="62-流程定义部署"><a class="markdownIt-Anchor" href="#62-流程定义部署">#</a> 6.2 流程定义部署</h4>
<h5 id="概述-2"><a class="markdownIt-Anchor" href="#概述-2">#</a> 概述</h5>
<p>将上面在设计器中定义的流程部署到 activiti 数据库中，就是流程定义部署。</p>
<p>通过调用 activiti 的 api 将流程定义的 bpmn 和 png 两个文件一个一个添加部署到 activiti 中，也可以将两个文件打成 zip 包进行部署。</p>
<h5 id="单个文件部署方式"><a class="markdownIt-Anchor" href="#单个文件部署方式">#</a> 单个文件部署方式</h5>
<p>分别将 bpmn 文件和 png 图片文件部署。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class ActivitiDemo &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testDeployment()&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、得到RepositoryService实例</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、使用RepositoryService进行部署</span></span><br><span class="line">        Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源</span></span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.png&quot;</span>)  <span class="comment">// 添加png资源</span></span><br><span class="line">                .name(<span class="string">&quot;出差申请流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line"><span class="comment">//        4、输出部署信息</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h5 id="压缩包部署方式"><a class="markdownIt-Anchor" href="#压缩包部署方式">#</a> 压缩包部署方式</h5>
<p>将 <code>evection.bpmn</code>  和 <code>evection.png</code>  压缩成 zip 包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"> public void deployProcessByZip() &#123;</span><br><span class="line">  <span class="comment">// 定义zip输入流</span></span><br><span class="line">  InputStream inputStream = this</span><br><span class="line">    .getClass()</span><br><span class="line">    .getClassLoader()</span><br><span class="line">    .getResourceAsStream(</span><br><span class="line">      <span class="string">&quot;bpmn/evection.zip&quot;</span>);</span><br><span class="line">  ZipInputStream zipInputStream = <span class="built_in">new</span> ZipInputStream(inputStream);</span><br><span class="line">  <span class="comment">// 获取repositoryService</span></span><br><span class="line">  RepositoryService repositoryService = processEngine</span><br><span class="line">    .getRepositoryService();</span><br><span class="line">  <span class="comment">// 流程部署</span></span><br><span class="line">  Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">    .addZipInputStream(zipInputStream)</span><br><span class="line">    .deploy();</span><br><span class="line">  System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">  System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h5 id="操作数据表"><a class="markdownIt-Anchor" href="#操作数据表">#</a> 操作数据表</h5>
<p>流程定义部署后操作 activiti 的 3 张表如下：</p>
<ul>
<li><code>act_re_deployment</code>  流程定义部署表，每部署一次增加一条记录</li>
<li><code>act_re_procdef</code>  流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</li>
<li><code>act_ge_bytearray</code>  流程资源表</li>
</ul>
<p>接下来我们来看看，写入了什么数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_re_deployment #流程定义部署表，记录流程部署信息</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/492052ea6a018366c6b003caa0f64fad.png" alt="492052ea6a018366c6b003caa0f64fad.png"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_re_procdef #流程定义表，记录流程定义信息</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<blockquote>
<p>注意，KEY 这个字段是用来唯一识别不同流程的关键字</p>
</blockquote>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/71cdab928e7ef851cfc1f0db25478d57.png" alt="71cdab928e7ef851cfc1f0db25478d57.png"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_ge_bytearray #资源表</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/940b8ba4b3f730e7a38ba0ba6d2829a3.png" alt="940b8ba4b3f730e7a38ba0ba6d2829a3.png"></p>
<p>注意：</p>
<p><code>act_re_deployment</code>  和 <code>act_re_procdef</code>  一对多关系，一次部署在流程部署表生成一条记录，但一次部署可以部署多个流程定义，每个流程定义在流程定义表生成一条记录。每一个流程定义在 <code>act_ge_bytearray</code>  会存在两个资源记录，bpmn 和 png。</p>
<p>建议：一次部署一个流程，这样部署表和流程定义表是一对一有关系，方便读取流程部署及流程定义信息。</p>
<h4 id="63-启动流程实例"><a class="markdownIt-Anchor" href="#63-启动流程实例">#</a> 6.3 启动流程实例</h4>
<p>流程定义部署在 activiti 后就可以通过工作流管理业务流程了，也就是说上边部署的出差申请流程可以使用了。</p>
<p>针对该流程，启动一个流程表示发起一个新的出差申请单，这就相当于 java 类与 java 对象的关系，类定义好后需要 new 创建一个对象使用，当然可以 new 多个对象。对于请出差申请流程，张三发起一个出差申请单需要启动一个流程实例，出差申请单发起一个出差单也需要启动一个流程实例。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动流程实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testStartProcess()&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取RunTimeService</span></span><br><span class="line">        RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line"><span class="comment">//        3、根据流程定义Id启动流程</span></span><br><span class="line">        ProcessInstance processInstance = runtimeService</span><br><span class="line">                .startProcessInstanceByKey(<span class="string">&quot;myEvection&quot;</span>);</span><br><span class="line"><span class="comment">//        输出内容</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出内容如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/dcc6ccc278787f998b09291d1e13630d.png" alt="dcc6ccc278787f998b09291d1e13630d.png"></p>
<p>操作数据表</p>
<ul>
<li><code>act_hi_actinst</code>  流程实例执行历史</li>
<li><code>act_hi_identitylink</code>  流程的参与用户历史信息</li>
<li><code>act_hi_procinst</code>  流程实例历史信息</li>
<li><code>act_hi_taskinst</code>  流程任务历史信息</li>
<li><code>act_ru_execution</code>  流程执行信息</li>
<li><code>act_ru_identitylink</code>  流程的参与用户信息</li>
<li><code>act_ru_task</code>  任务信息</li>
</ul>
<h4 id="64-任务查询"><a class="markdownIt-Anchor" href="#64-任务查询">#</a> 6.4 任务查询</h4>
<p>流程启动后，任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询当前个人待执行的任务</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindPersonalTaskList() &#123;</span><br><span class="line"><span class="comment">//        任务负责人</span></span><br><span class="line">        String assignee = <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        创建TaskService</span></span><br><span class="line">        TaskService taskService = processEngine.getTaskService();</span><br><span class="line"><span class="comment">//        根据流程key 和 任务负责人 查询任务</span></span><br><span class="line">        List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(assignee)<span class="comment">//只查询该任务负责人的任务</span></span><br><span class="line">                .list();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line"> </span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程实例id：<span class="number">2501</span></span><br><span class="line">任务id：<span class="number">2505</span></span><br><span class="line">任务负责人：zhangsan</span><br><span class="line">任务名称：创建出差申请</span><br></pre></td></tr></table></figure>
<h4 id="65-流程任务处理"><a class="markdownIt-Anchor" href="#65-流程任务处理">#</a> 6.5 流程任务处理</h4>
<p>任务负责人查询待办任务，选择任务进行处理，完成任务。微信搜索公众号：Java 项目精选，回复：java 领取资料 。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完成任务</span></span><br><span class="line">    @Test</span><br><span class="line">    public void completTask()&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取taskService</span></span><br><span class="line">        TaskService taskService = processEngine.getTaskService();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//        根据流程key 和 任务的负责人 查询任务</span></span><br><span class="line"><span class="comment">//        返回一个任务对象</span></span><br><span class="line">        Task task = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">                .singleResult();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//        完成任务,参数：任务id</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="66-流程定义信息查询"><a class="markdownIt-Anchor" href="#66-流程定义信息查询">#</a> 6.6 流程定义信息查询</h4>
<p>查询流程相关信息，包含流程定义，流程部署，流程定义版本</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void queryProcessDefinition()&#123;</span><br><span class="line">        <span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        得到ProcessDefinitionQuery 对象</span></span><br><span class="line">        ProcessDefinitionQuery processDefinitionQuery = repositoryService.createProcessDefinitionQuery();</span><br><span class="line"><span class="comment">//          查询出当前所有的流程定义</span></span><br><span class="line"><span class="comment">//          条件：processDefinitionKey =evection</span></span><br><span class="line"><span class="comment">//          orderByProcessDefinitionVersion 按照版本排序</span></span><br><span class="line"><span class="comment">//        desc倒叙</span></span><br><span class="line"><span class="comment">//        list 返回集合</span></span><br><span class="line">        List&lt;ProcessDefinition&gt; definitionList = processDefinitionQuery.processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .orderByProcessDefinitionVersion()</span><br><span class="line">                .desc()</span><br><span class="line">                .list();</span><br><span class="line"><span class="comment">//      输出流程定义信息</span></span><br><span class="line">        <span class="keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 id=&quot;</span>+processDefinition.getId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 name=&quot;</span>+processDefinition.getName());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 key=&quot;</span>+processDefinition.getKey());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 Version=&quot;</span>+processDefinition.getVersion());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署ID =&quot;</span>+processDefinition.getDeploymentId());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程定义id：myEvection:<span class="number">1</span>:<span class="number">4</span></span><br><span class="line">流程定义名称：出差申请单</span><br><span class="line">流程定义key：myEvection</span><br><span class="line">流程定义版本：<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="67-流程删除"><a class="markdownIt-Anchor" href="#67-流程删除">#</a> 6.7 流程删除</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void deleteDeployment() &#123;</span><br><span class="line">  <span class="comment">// 流程部署id</span></span><br><span class="line">  String deploymentId = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">  </span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 通过流程引擎获取repositoryService</span></span><br><span class="line">  RepositoryService repositoryService = processEngine</span><br><span class="line">    .getRepositoryService();</span><br><span class="line">  <span class="comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span></span><br><span class="line">  repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">  <span class="comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span></span><br><span class="line">  <span class="comment">//repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>使用 repositoryService 删除流程定义，历史表信息不会被删除</li>
<li>如果该流程定义下没有正在运行的流程，则可以用普通删除。</li>
</ul>
<p>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。</p>
<p>先删除没有完成流程节点，最后就可以完全删除流程定义信息</p>
<p>项目开发中级联删除操作一般只开放给超级管理员使用.</p>
<h4 id="68-流程资源下载"><a class="markdownIt-Anchor" href="#68-流程资源下载">#</a> 6.8 流程资源下载</h4>
<p>现在我们的流程资源文件已经上传到数据库了，如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载到本地。</p>
<p>解决方案有：</p>
<ul>
<li>jdbc 对 blob 类型，clob 类型数据读取出来，保存到文件目录</li>
<li>使用 activiti 的 api 来实现</li>
</ul>
<p>使用 commons-io.jar 解决 IO 的操作</p>
<p>引入 commons-io 依赖包</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>通过流程定义对象获取流程定义资源，获取 bpmn 和 png</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"> </span><br><span class="line">	@Test</span><br><span class="line">    public void deleteDeployment()&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        根据部署id 删除部署信息,如果想要级联删除，可以添加第二个参数，true</span></span><br><span class="line">        repositoryService.deleteDeployment(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void  queryBpmnFile() throws IOException &#123;</span><br><span class="line"><span class="comment">//        1、得到引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、得到查询器：ProcessDefinitionQuery，设置查询条件,得到想要的流程定义</span></span><br><span class="line">        ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line"><span class="comment">//        4、通过流程定义信息，得到部署ID</span></span><br><span class="line">        String deploymentId = processDefinition.getDeploymentId();</span><br><span class="line"><span class="comment">//        5、通过repositoryService的方法，实现读取图片信息和bpmn信息</span></span><br><span class="line"><span class="comment">//        png图片的流</span></span><br><span class="line">        InputStream pngInput = repositoryService.getResourceAsStream(deploymentId, processDefinition.getDiagramResourceName());</span><br><span class="line"><span class="comment">//        bpmn文件的流</span></span><br><span class="line">        InputStream bpmnInput = repositoryService.getResourceAsStream(deploymentId, processDefinition.getResourceName());</span><br><span class="line"><span class="comment">//        6、构造OutputStream流</span></span><br><span class="line">        File file_png = <span class="built_in">new</span> File(<span class="string">&quot;d:/evectionflow01.png&quot;</span>);</span><br><span class="line">        File file_bpmn = <span class="built_in">new</span> File(<span class="string">&quot;d:/evectionflow01.bpmn&quot;</span>);</span><br><span class="line">        FileOutputStream bpmnOut = <span class="built_in">new</span> FileOutputStream(file_bpmn);</span><br><span class="line">        FileOutputStream pngOut = <span class="built_in">new</span> FileOutputStream(file_png);</span><br><span class="line"><span class="comment">//        7、输入流，输出流的转换</span></span><br><span class="line">        IOUtils.<span class="built_in">copy</span>(pngInput,pngOut);</span><br><span class="line">        IOUtils.<span class="built_in">copy</span>(bpmnInput,bpmnOut);</span><br><span class="line"><span class="comment">//        8、关闭流</span></span><br><span class="line">        pngOut.<span class="built_in">close</span>();</span><br><span class="line">        bpmnOut.<span class="built_in">close</span>();</span><br><span class="line">        pngInput.<span class="built_in">close</span>();</span><br><span class="line">        bpmnInput.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><code>deploymentId</code>  为流程部署 ID</li>
<li><code>resource_name</code>  为 <code>act_ge_bytearray</code>  表中 NAME_列的值</li>
<li>使用 <code>repositoryService</code>  的 <code>getDeploymentResourceNames</code>  方法可以获取指定部署下得所有文件的名称</li>
<li>使用 <code>repositoryService</code>  的 <code>getResourceAsStream</code>  方法传入部署 ID 和资源图片名称可以获取部署下指定名称文件的输入流</li>
</ul>
<p>最后的将输入流中的图片资源进行输出。</p>
<h4 id="69-流程历史信息的查看"><a class="markdownIt-Anchor" href="#69-流程历史信息的查看">#</a> 6.9 流程历史信息的查看</h4>
<p>即使流程定义已经删除了，流程执行的历史信息通过前面的分析，依然保存在 activiti 的 <code>act_hi_*</code>  相关的表中。所以我们还是可以查询流程执行的历史信息，可以通过 <code>HistoryService</code>  来查看相关的历史记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看历史信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void findHistoryInfo()&#123;</span><br><span class="line"><span class="comment">//      获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取HistoryService</span></span><br><span class="line">        HistoryService historyService = processEngine.getHistoryService();</span><br><span class="line"><span class="comment">//        获取 actinst表的查询对象</span></span><br><span class="line">        HistoricActivityInstanceQuery instanceQuery = historyService.createHistoricActivityInstanceQuery();</span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 InstanceId 查询</span></span><br><span class="line"><span class="comment">//        instanceQuery.processInstanceId(&quot;2501&quot;);</span></span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 DefinitionId 查询</span></span><br><span class="line">        instanceQuery.processDefinitionId(<span class="string">&quot;myEvection:1:4&quot;</span>);</span><br><span class="line"><span class="comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span></span><br><span class="line">        instanceQuery.orderByHistoricActivityInstanceStartTime().asc();</span><br><span class="line"><span class="comment">//        查询所有内容</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; activityInstanceList = instanceQuery.list();</span><br><span class="line"><span class="comment">//        输出</span></span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance hi : activityInstanceList) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getActivityId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getActivityName());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getProcessDefinitionId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getProcessInstanceId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;&lt;==========================&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 <code>Java</code>  程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="二维码plus"> 非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-12T09:33:07.000Z" title="2021/10/12 17:33:07">2021-10-12</time>发表</span><span class="level-item"><time dateTime="2020-11-23T06:07:51.000Z" title="2020/11/23 14:07:51">2020-11-23</time>更新</span><span class="level-item">5 分钟读完 (大约750个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/12/%E3%80%90Flutter%E3%80%91Flutter%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">【Flutter】Flutter生命周期</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="flutterflutter生命周期"><a class="markdownIt-Anchor" href="#flutterflutter生命周期">#</a> 【Flutter】Flutter 生命周期</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/cf191df81ef144b9bca93e0a385bdd8d.png" alt="img"></p>
<h2 id="一-生命周期阶段"><a class="markdownIt-Anchor" href="#一-生命周期阶段">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F&amp;spm=1001.2101.3001.7020">生命周期</a>阶段</h2>
<p>​    <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=flutter&amp;spm=1001.2101.3001.7020">flutter</a> 生命周期大体上可以分为三个阶段：初始化、状态变化、销毁。</p>
<h3 id="1-初始化阶段"><a class="markdownIt-Anchor" href="#1-初始化阶段">#</a> 1、初始化阶段</h3>
<p>对应执行构造方法和 initState 时候</p>
<h3 id="2-状态变化阶段"><a class="markdownIt-Anchor" href="#2-状态变化阶段">#</a> 2、状态变化阶段</h3>
<p>开新的 widget 或者调用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=setState&amp;spm=1001.2101.3001.7020"> setState</a> 方法的时候</p>
<h3 id="3-销毁阶段"><a class="markdownIt-Anchor" href="#3-销毁阶段">#</a> 3、销毁阶段</h3>
<p>deactivate 和 dispose</p>
<h2 id="二-生命周期阶段执行的函数"><a class="markdownIt-Anchor" href="#二-生命周期阶段执行的函数">#</a> 二、生命周期阶段执行的函数</h2>
<h3 id="1-initstate"><a class="markdownIt-Anchor" href="#1-initstate">#</a> 1、initState</h3>
<p>调用次数：1 次</p>
<p>插入渲染树时调用，只调用一次，widget 创建执行的第一个方法，这里可以做一些初始化工作，比如初始化 State 的变量。</p>
<h3 id="2-didchangedependencies"><a class="markdownIt-Anchor" href="#2-didchangedependencies">#</a> 2、didChangeDependencies</h3>
<p>调用次数：多次</p>
<ul>
<li>初始化时，在 initState () 之后立刻调用</li>
<li>当依赖的 InheritedWidget rebuild, 会触发此接口被调用</li>
<li>实测在组件可见状态变化的时候会调用</li>
</ul>
<h3 id="3-build"><a class="markdownIt-Anchor" href="#3-build">#</a> 3、build</h3>
<p>调用次数：多次</p>
<ul>
<li>初始化之后开始绘制界面</li>
<li>setState 触发的时候会</li>
</ul>
<h3 id="4-didupdatewidget"><a class="markdownIt-Anchor" href="#4-didupdatewidget">#</a> 4、didUpdateWidget</h3>
<p>调用次数：多次</p>
<p>组件状态改变时候调用</p>
<h3 id="5-deactivate"><a class="markdownIt-Anchor" href="#5-deactivate">#</a> 5、deactivate</h3>
<p>当 State 对象从树中被移除时，会调用此回调，会在 dispose 之前调用。</p>
<p>页面销毁的时候会依次执行：deactivate &gt; dispose</p>
<h3 id="6-dispose"><a class="markdownIt-Anchor" href="#6-dispose">#</a> 6、dispose</h3>
<p>调用次数：1 次</p>
<p>当 State 对象从树中被永久移除时调用；通常在此回调中释放资源。</p>
<h3 id="7-reassemble"><a class="markdownIt-Anchor" href="#7-reassemble">#</a> 7、reassemble</h3>
<p>在热重载 (hot reload) 时会被调用，此回调在 Release 模式下永远不会被调用</p>
<h2 id="三-app生命周期"><a class="markdownIt-Anchor" href="#三-app生命周期">#</a> 三、App 生命周期</h2>
<p>​    通过 WidgetsBindingObserver 的 didChangeAppLifecycleState 来获取。通过该接口可以获取是生命周期在 AppLifecycleState 类中。</p>
<h3 id="1-resumed"><a class="markdownIt-Anchor" href="#1-resumed">#</a> 1、resumed</h3>
<p>可见并能响应用户的输入，同安卓的 onResume</p>
<h3 id="2-inactive"><a class="markdownIt-Anchor" href="#2-inactive">#</a> 2、inactive</h3>
<p>处在并不活动状态，无法处理用户响应，同安卓的 onPause</p>
<h3 id="3-paused"><a class="markdownIt-Anchor" href="#3-paused">#</a> 3、paused</h3>
<p>不可见并不能响应用户的输入，但是在后台继续活动中，同安卓的 onStop</p>
<p><strong>下面是生命周期：</strong></p>
<ol>
<li>初次打开 widget 时，不执行 AppLifecycleState 的回调；</li>
<li>按 home 键或 Power 键， AppLifecycleState inactive----&gt;AppLifecycleState pause</li>
<li>从后台到前台：AppLifecycleState inactive—&gt;ApplifecycleState resumed</li>
<li>back 键退出应用： AppLifecycleState inactive—&gt;AppLifecycleState paused</li>
</ol>
<p>参考文章：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/00ff0c2b8336">https://www.jianshu.com/p/00ff0c2b8336</a></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-10-03T01:18:07.000Z" title="2021/10/3 09:18:07">2021-10-03</time>发表</span><span class="level-item"><time dateTime="2023-12-26T21:00:45.000Z" title="2023/12/27 05:00:45">2023-12-27</time>更新</span><span class="level-item">3 分钟读完 (大约428个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/03/%E3%80%90Elasticsearch%E3%80%91Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8Elasticsearch-head/">Linux环境下安装并启动Elasticsearch-head</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="1-elasticsearch-head介绍"><a class="markdownIt-Anchor" href="#1-elasticsearch-head介绍">#</a> 1、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=elasticsearch-head&amp;spm=1001.2101.3001.7020">elasticsearch-head</a> 介绍</h1>
<p>官方地址: <a target="_blank" rel="noopener" href="https://github.com/mobz/elasticsearch-head">https://github.com/mobz/elasticsearch-head</a></p>
<p>elasticsearch-head 是一款用来管理 Elasticsearch 集群的第三方插件工具。 elasticsearch-Head 插件在 5.0 版本之前可以直接以插件的形式直接安装，但是 5.0 以后安装方式发生了改变，需要 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=nodejs&amp;spm=1001.2101.3001.7020">nodejs</a> 环境支持，或者直接使用别人封装好的 docker 镜像，更推荐的是谷歌浏览器的插件。</p>
<h1 id="2-elasticsearch-head安装"><a class="markdownIt-Anchor" href="#2-elasticsearch-head安装">#</a> 2、elasticsearch-head 安装</h1>
<h2 id="npm安装elasticsearch-head"><a class="markdownIt-Anchor" href="#npm安装elasticsearch-head">#</a> npm 安装 elasticsearch-head</h2>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#下载安装nodejs</span><br><span class="line">wget https://nodejs.org/dist/v12.13.0/node-v12.13.0-linux-x64.tar.xz</span><br><span class="line">tar xf node-v12.13.0-linux-x64.tar.xz</span><br><span class="line">mv node-v12.13.0-linux-x64 node</span><br><span class="line">#修改环境变量</span><br><span class="line">echo &#x27;export PATH=$PATH:/opt/node/bin&#x27; &gt;&gt; /etc/profile</span><br><span class="line">#配置生效</span><br><span class="line">source /etc/profile</span><br><span class="line">npm -v</span><br><span class="line">node -v</span><br><span class="line"></span><br><span class="line">#下载elasticsearch-head</span><br><span class="line">git clone git://github.com/mobz/elasticsearch-head.git</span><br><span class="line"></span><br><span class="line">#进入elasticsearch-head安装目录</span><br><span class="line">cd elasticsearch-head</span><br><span class="line">#配置国内镜像</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">#安装</span><br><span class="line">cnpm install</span><br><span class="line">#启动</span><br><span class="line">cnpm run start</span><br></pre></td></tr></table></figure>
</blockquote>
<p>修改 Elasticsearch 配置文件，添加如下参数并重启:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#准许es被跨域访问</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-09-28T06:06:33.000Z" title="2021/9/28 14:06:33">2021-09-28</time>发表</span><span class="level-item"><time dateTime="2022-01-02T09:43:11.000Z" title="2022/1/2 17:43:11">2022-01-02</time>更新</span><span class="level-item">19 分钟读完 (大约2840个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/28/%E3%80%90Docker%E3%80%91Docker%E7%94%A8%E6%B3%95%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/">Docker的基础用法</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="1-docker架构"><a class="markdownIt-Anchor" href="#1-docker架构">#</a> 1 Docker 架构</h1>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/60e8fc2bc92e48d0b96c0eaf079483c6.png" alt="在这里插入图片描述"></p>
<p>镜像 (Image)：Docker 镜像 (Image)，就相当于是 一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包 含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。<br>
容器 (Container)：镜像 (Image) 和容器 (Contain er) 的关系，就像是面向对象程序设计中的类和对象一 样，镜像是静态的定义，容器是镜像运行时的实体。容 器可以被创建、启动、停止、删除、暂停等。<br>
仓库 (Repository)：仓库可看成一个代码控制中心， 用来保存镜像</p>
<h1 id="2-docker镜像与镜像仓库"><a class="markdownIt-Anchor" href="#2-docker镜像与镜像仓库">#</a> 2 Docker 镜像与镜像仓库</h1>
<p>在 docker 中仓库的名字是以应用的名称取名的。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183520743.jpg" alt="在这里插入图片描述"></p>
<p>镜像是静态的，而容器是动态的，容器有其生命周期，镜像与容器的关系类似于程序与进程的关系。镜像类似于文件系统中的程序文件，而容器则类似于将一个程序运行起来的状态，也即进程。所以容器是可以删除的，容器被删除后其镜像是不会被删除的。</p>
<h1 id="3-docker对象"><a class="markdownIt-Anchor" href="#3-docker对象">#</a> 3 Docker 对象</h1>
<p>When you use docker, you are creating and using images, containers, networks, volumes, pluginns, and other objects.(当你使用 docker 时，你正在创建和使用镜像、容器、网络、卷、插件和其他对象)</p>
<p>IMAGES (镜像)</p>
<p>An image is a read-only template with instructions for creating a docker container.(镜像是一个只读模板，它带有创建 docker 容器的指令。)<br>
 Often, an image is based on another image, with some additional customization.(通常，一个镜像基于另一个镜像，并带有一些额外的自定义。)<br>
 You might create your own images or you might only use those created by others and published in a registry.(您可以创建自己的镜像，也可以使用其他人创建并在仓库中发布的镜像。)<br>
 CONTAINERS (容器)</p>
<p>A conntainer is a runnable instance of an image.(容器是镜像的可运行实例。)<br>
 You can create, run, stop, move, or delete a container using the docker API or CLI.(您可以通过 docker API 或 CLI 创建、运行、停止、移动或删除容器。)<br>
 You can connect a container to one or more networks, attach storage to it, or even create a new image based on its current state.(您可以将容器连接到一个或多个网络，为其附加存储，甚至可以根据其当前状态创建新镜像。)</p>
<h1 id="4-docker安装及使用"><a class="markdownIt-Anchor" href="#4-docker安装及使用">#</a> 4 Docker 安装及使用</h1>
<p>4.1 Docker 安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">[root@Docker ~]# sed -i &#x27;s@https://download.docker.com@https://mirrors.tuna.tsinghua.edu.cn/docker-ce@g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">[root@Docker ~]# yum clean all</span><br><span class="line">21 文件已删除</span><br><span class="line">[root@Docker ~]# yum -y install docker-ce</span><br></pre></td></tr></table></figure>
<h1 id="42-docker加速"><a class="markdownIt-Anchor" href="#42-docker加速">#</a> 4.2 Docker 加速</h1>
<p>为什么需要加速器？因为 docker 在拉取镜像时，是去国外拉取的所以会比较慢，使用加速器可以解决这个问题</p>
<p>docker-ce 的配置文件是 /etc/docker/daemon.json，此文件默认不存在，需要我们手动创建并进行配置，而 docker 的加速就是通过配置此文件来实现的</p>
<h4 id="docker的加速有多种方式"><a class="markdownIt-Anchor" href="#docker的加速有多种方式">#</a> docker 的加速有多种方式</h4>
<ul>
<li>docker cn</li>
<li>中国科技大学加速器</li>
<li>阿里云加速器（需要通过阿里云开发者平台注册帐号，免费使用个人私有的加速器）</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# systemctl enable --now docker    //启动docker服务</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/lib/systemd/system/docker.service.</span><br><span class="line">[root@Docker ~]# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">     &quot;registry-mirrors&quot;: [&quot;https://xj3hc284.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">[root@Docker ~]# systemctl daemon-reload</span><br><span class="line">[root@Docker ~]# systemctl restart docker    //重启docker服务</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="43-docker常用操作"><a class="markdownIt-Anchor" href="#43-docker常用操作">#</a> 4.3 Docker 常用操作</h2>
<h3 id="431-docker-version查看版本号"><a class="markdownIt-Anchor" href="#431-docker-version查看版本号">#</a> 4.3.1 docker version (查看版本号)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker version</span><br><span class="line">Client: Docker Engine - Community    //docker客户端版本</span><br><span class="line"> Version:           20.10.11</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.16.9</span><br><span class="line"> Git commit:        dea9396</span><br><span class="line"> Built:             Thu Nov 18 00:36:58 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community    //docker服务端版本</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.11</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.16.9</span><br><span class="line">  Git commit:       847da18</span><br><span class="line">  Built:            Thu Nov 18 00:35:20 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:    //容器版本</span><br><span class="line">  Version:          1.4.12</span><br><span class="line">  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.2</span><br><span class="line">  GitCommit:        v1.0.2-0-g52b36a2</span><br><span class="line"> docker-init:    //docker初始化版本</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>
<h3 id="432-docker-info显示整个系统的信息"><a class="markdownIt-Anchor" href="#432-docker-info显示整个系统的信息">#</a> 4.3.2 docker info (显示整个系统的信息)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker info</span><br><span class="line">Client:        #docker客户端版本信息</span><br><span class="line"> Context:    default        #上下文</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Plugins:        #插件</span><br><span class="line">  app: Docker App (Docker Inc., v0.9.1-beta3)</span><br><span class="line">  buildx: Build with BuildKit (Docker Inc., v0.6.3-docker)</span><br><span class="line">  scan: Docker Scan (Docker Inc., v0.9.0)</span><br><span class="line"></span><br><span class="line">Server:        #docker服务端版本信息</span><br><span class="line"> Containers: 0        #容器个数</span><br><span class="line">  Running: 0        #运行个数</span><br><span class="line">  Paused: 0        #暂停状态个数</span><br><span class="line">  Stopped: 0        #停止状态个数</span><br><span class="line"> Images: 0        #镜像个数</span><br><span class="line"> Server Version: 20.10.11        #服务版本号</span><br><span class="line"> Storage Driver: overlay2        #存储驱动</span><br><span class="line">  Backing Filesystem: xfs        #后端文件系统</span><br><span class="line">  Supports d_type: true</span><br><span class="line">  Native Overlay Diff: true</span><br><span class="line">  userxattr: false</span><br><span class="line"> Logging Driver: json-file        # 日志驱动</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Cgroup Version: 1</span><br><span class="line"> Plugins:        # 插件</span><br><span class="line">  Volume: local</span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class="line"> runc version: v1.0.2-0-g52b36a2</span><br><span class="line"> init version: de40ad0</span><br><span class="line"> Security Options:        # 安全选项</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.18.0-257.el8.x86_64        # 内核版本号</span><br><span class="line"> Operating System: CentOS Stream 8        # 操作系统</span><br><span class="line"> OSType: linux        #操作系统 类型</span><br><span class="line"> Architecture: x86_64        #架构</span><br><span class="line"> CPUs: 4        # CPU核心数</span><br><span class="line"> Total Memory: 7.559GiB        #总内存 </span><br><span class="line"> Name: Docker</span><br><span class="line"> ID: 4MEZ:OEWB:CPHP:3PYE:54J3:46XO:B5CX:JHYB:OW5Q:TWJP:PWHO:JJSM           </span><br><span class="line"> Docker Root Dir: /var/lib/docker        #docker默认目录</span><br><span class="line"> Debug Mode: false</span><br><span class="line"> Registry: https://index.docker.io/v1/        # 仓库地址</span><br><span class="line"> Labels:        #标签</span><br><span class="line"> Experimental: false</span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:        #加速器</span><br><span class="line">  https://xj3hc284.mirror.aliyuncs.com/</span><br><span class="line"> Live Restore Enabled: false</span><br></pre></td></tr></table></figure>
<h3 id="433-docker-search在docker-hub中搜索镜像"><a class="markdownIt-Anchor" href="#433-docker-search在docker-hub中搜索镜像">#</a> 4.3.3 docker search (在 docker hub 中搜索镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker search nginx</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        15893     [OK]       </span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy for docker con…   2098                 [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   819                  [OK]</span><br><span class="line">jc21/nginx-proxy-manager          Docker container for managing Nginx proxy ho…   285                  </span><br><span class="line">linuxserver/nginx                 An Nginx container, brought to you by LinuxS…   160                  </span><br><span class="line">tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp…   146                  [OK]</span><br><span class="line">jlesage/nginx-proxy-manager       Docker container for Nginx Proxy Manager        144                  [OK]</span><br><span class="line">alfg/nginx-rtmp                   NGINX, nginx-rtmp-module and FFmpeg from sou…   110                  [OK]</span><br><span class="line">nginxdemos/hello                  NGINX webserver that serves a simple page co…   79                   [OK]</span><br><span class="line">privatebin/nginx-fpm-alpine       PrivateBin running on an Nginx, php-fpm &amp; Al…   60                   [OK]</span><br><span class="line">nginx/nginx-ingress               NGINX and  NGINX Plus Ingress Controllers fo…   57                   </span><br><span class="line">nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles                  54                   </span><br><span class="line">nginxproxy/nginx-proxy            Automated Nginx reverse proxy for docker con…   28                   </span><br><span class="line">staticfloat/nginx-certbot         Opinionated setup for automatic TLS certs lo…   25                   [OK]</span><br><span class="line">nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter for NGINX and NGIN…   22                   </span><br><span class="line">schmunk42/nginx-redirect          A very simple container to redirect HTTP tra…   19                   [OK]</span><br><span class="line">centos/nginx-112-centos7          Platform for running nginx 1.12 or building …   16                   </span><br><span class="line">centos/nginx-18-centos7           Platform for running nginx 1.8 or building n…   13                   </span><br><span class="line">flashspys/nginx-static            Super Lightweight Nginx Image                   11                   [OK]</span><br><span class="line">bitwarden/nginx                   The Bitwarden nginx web server acting as a r…   11                   </span><br><span class="line">mailu/nginx                       Mailu nginx frontend                            9                    [OK]</span><br><span class="line">sophos/nginx-vts-exporter         Simple server that scrapes Nginx vts stats a…   7                    [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb   An APB to deploy NGINX                          3                    [OK]</span><br><span class="line">arnau/nginx-gate                  Docker image with Nginx with Lua enabled on …   1                    [OK]</span><br><span class="line">wodby/nginx                       Generic nginx                                   1                    [OK]</span><br></pre></td></tr></table></figure>
<h3 id="434-docker-pull拉取镜像"><a class="markdownIt-Anchor" href="#434-docker-pull拉取镜像">#</a> 4.3.4 docker pull (拉取镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">eff15d958d66: Pull complete </span><br><span class="line">1e5351450a59: Pull complete </span><br><span class="line">2df63e6ce2be: Pull complete </span><br><span class="line">9171c7ae368c: Pull complete </span><br><span class="line">020f975acd28: Pull complete </span><br><span class="line">266f639b35ad: Pull complete </span><br><span class="line">Digest: sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>
<h3 id="435-docker-images列出系统当前镜像"><a class="markdownIt-Anchor" href="#435-docker-images列出系统当前镜像">#</a> 4.3.5 docker images (列出系统当前镜像)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>
<h3 id="436-docker-image-history查看指定镜像的历史"><a class="markdownIt-Anchor" href="#436-docker-image-history查看指定镜像的历史">#</a> 4.3.6 docker image history (查看指定镜像的历史)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker image history nginx</span><br><span class="line">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class="line">ea335eea17ab   13 days ago   /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  STOPSIGNAL SIGQUIT           0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;/docker-entr…   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:09a214a3e07c919a…   4.61kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0b866ff3fc1ef5b0…   1.96kB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:65504f71f5855ca0…   1.2kB     </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c set -x     &amp;&amp; addgroup --system -…   61.1MB    </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV PKG_RELEASE=1~bullseye   0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NJS_VERSION=0.7.0        0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NGINX_VERSION=1.21.4     0B        </span><br><span class="line">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        </span><br><span class="line">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop) ADD file:a2405ebb9892d98be…   80.4MB    </span><br></pre></td></tr></table></figure>
<h3 id="437-docker-image-inspect查看指定镜像的详细信息"><a class="markdownIt-Anchor" href="#437-docker-image-inspect查看指定镜像的详细信息">#</a> 4.3.7 docker image inspect (查看指定镜像的详细信息)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker image inspect nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:ea335eea17ab984571cd4a3bcf90a0413773b559c75ef4cda07d0ce952b00291&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;nginx:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;nginx@sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-11-17T10:38:14.652464384Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;8a038ff17987cf87d4b7d7e2c80cb83bd2474d66e2dd0719e2b4f7de2ad6d853&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;8a038ff17987&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;80/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="438-删除镜像"><a class="markdownIt-Anchor" href="#438-删除镜像">#</a> 4.3.8 删除镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   57 minutes ago   Exited (0) 6 minutes ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">httpd        latest    ad17c88403e2   12 days ago   143MB</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rmi ad17c88403e2</span><br><span class="line">Untagged: httpd:latest</span><br><span class="line">Untagged: httpd@sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class="line">Deleted: sha256:ad17c88403e2cedd27963b98be7f04bd3f903dfa7490586de397d0404424936d</span><br><span class="line">Deleted: sha256:a59e7dfeeb485a8a45b1fcce812b10fbd955d304fa2e9ca43b10b16a8ee1afb8</span><br><span class="line">Deleted: sha256:9592080464aa1890ed187c42a13ecc9f175e975a96a3fad28df0559ad0c08b9d</span><br><span class="line">Deleted: sha256:42d2debfa0c419f7f89affa3e9b62d1b7e54dc6654dbd186d4654ee3661c44c8</span><br><span class="line">Deleted: sha256:136822c50a75392f4ce06461fa4894aa7d1e060ec0dd4782e13e2d9829df50a3</span><br><span class="line">[root@Docker ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>
<h3 id="439-docker-create创建容器"><a class="markdownIt-Anchor" href="#439-docker-create创建容器">#</a> 4.3.9 docker create (创建容器)</h3>
<p>此命令只会创建容器，而不会运行容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker create nginx</span><br><span class="line">8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74</span><br></pre></td></tr></table></figure>
<h3 id="4310-docker-ps列出容器"><a class="markdownIt-Anchor" href="#4310-docker-ps列出容器">#</a> 4.3.10 docker ps (列出容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps         //查看正在运行的容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a        //查看所有容器</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   3 minutes ago   Created             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4311-docker-start启动容器"><a class="markdownIt-Anchor" href="#4311-docker-start启动容器">#</a> 4.3.11 docker start (启动容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker start 8442117bc0c7        #启动容器，后面接容器的ID号，ID号可以简写</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   8 minutes ago   Up 14 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4312-docker-attach进入容器"><a class="markdownIt-Anchor" href="#4312-docker-attach进入容器">#</a> 4.3.12 docker attach (进入容器)</h3>
<p>在当前 shell 下 attach 连接指定运行镜像，以这种方式进入容器，此时容器会一直占用前台，如果退出容器，容器就会停止</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   50 minutes ago   Up 30 seconds   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker attach 8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure>
<h3 id="4313-docker-exec进入容器"><a class="markdownIt-Anchor" href="#4313-docker-exec进入容器">#</a> 4.3.13 docker exec (进入容器)</h3>
<p>用这个命令进入容器后台运行就算是退出了容器，容器也不会停止运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   26 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker exec -it 8442117bc0c7 /bin/bash</span><br><span class="line">root@8442117bc0c7:/# ls</span><br><span class="line">bin  boot  dev	docker-entrypoint.d  docker-entrypoint.sh  etc	home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">root@8442117bc0c7:/# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   27 minutes ago   Up 23 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4314-docker-inspect查看容器的信息详细"><a class="markdownIt-Anchor" href="#4314-docker-inspect查看容器的信息详细">#</a> 4.3.14 docker inspect (查看容器的信息详细)</h3>
<p>通过查看详细信息可以查看其容器的 IP 地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker inspect 8442117bc0c7</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-12-01T07:28:48.929261547Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;nginx&quot;,</span><br><span class="line">            &quot;-g&quot;,</span><br><span class="line">            &quot;daemon off;&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 5390,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-12-01T07:36:41.636489391Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<h3 id="4315-docker-logs查看容器日志"><a class="markdownIt-Anchor" href="#4315-docker-logs查看容器日志">#</a> 4.3.15 docker logs (查看容器日志)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker logs 8442117bc0c7</span><br><span class="line">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class="line">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class="line">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class="line">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class="line">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: nginx/1.21.4</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) </span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: OS: Linux 4.18.0-257.el8.x86_64</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker processes</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 31</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 32</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 33</span><br><span class="line">2021/12/01 07:36:41 [notice] 1#1: start worker process 34</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:23 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:44 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:45 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class="line">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>
<h3 id="4316-docker-stop停止容器"><a class="markdownIt-Anchor" href="#4316-docker-stop停止容器">#</a> 4.3.16 docker stop (停止容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Up 8 minutes   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker stop 8442117bc0c7</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Exited (0) 5 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4317-docker-restart重启容器"><a class="markdownIt-Anchor" href="#4317-docker-restart重启容器">#</a> 4.3.17 docker restart (重启容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Exited (0) 46 seconds ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker restart 8442117bc0c7</span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4318-docker-kill杀死正在运行的容器"><a class="markdownIt-Anchor" href="#4318-docker-kill杀死正在运行的容器">#</a> 4.3.18 docker kill (杀死正在运行的容器)</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Up 2 minutes   80/tcp    youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker kill 8442117bc0c7 </span><br><span class="line">8442117bc0c7</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                       PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Exited (137) 4 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h3 id="4319-docker-run创建并启动容器"><a class="markdownIt-Anchor" href="#4319-docker-run创建并启动容器">#</a> 4.3.19 docker run (创建并启动容器)</h3>
<p>此命令会做三件事情，首先先查看本地是否都对应的镜像，如果没有就拉取，然后创建容器，然后运行容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   35 minutes ago   Exited (0) 5 minutes ago             youthful_euclid</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker run -it httpd /bin/bash        #此命令的作用是，拉取一个httpd的镜像，然后创建容器并运行，-it表示以交互的方式进入终端，/bin/bash表示终端的环境</span><br><span class="line">Unable to find image &#x27;httpd:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line">eff15d958d66: Already exists </span><br><span class="line">ba1caf8ba86c: Pull complete </span><br><span class="line">ab86dc02235d: Pull complete </span><br><span class="line">0d58b11d2867: Pull complete </span><br><span class="line">e88da7cb925c: Pull complete </span><br><span class="line">Digest: sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class="line">Status: Downloaded newer image for httpd:latest</span><br><span class="line">root@a01b8d80a160:/usr/local/apache2# ls</span><br><span class="line">bin  build  cgi-bin  conf  error  htdocs  icons  include  logs	modules</span><br></pre></td></tr></table></figure>
<h3 id="4320-docker-rm删除容器"><a class="markdownIt-Anchor" href="#4320-docker-rm删除容器">#</a> 4.3.20 docker rm (删除容器)</h3>
<p>删除一个或者多个容器，只能删除停止状态的容器或者 - f 强制删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS         PORTS     NAMES</span><br><span class="line">a01b8d80a160   httpd     &quot;/bin/bash&quot;   10 minutes ago   Up 3 seconds   80/tcp    hardcore_varahamihira</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rm a01b8d80a160</span><br><span class="line">Error response from daemon: You cannot remove a running container a01b8d80a1609e81d8d8121b3fc3c0f53a676340b3b093b353a7f9bb498fe0e6. Stop the container before attempting removal or force remove</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker rm -f a01b8d80a160</span><br><span class="line">a01b8d80a160</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br><span class="line">[root@Docker ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class="line">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   48 minutes ago   Exited (0) 18 minutes ago             youthful_euclid</span><br></pre></td></tr></table></figure>
<h1 id="5-docker-event-state"><a class="markdownIt-Anchor" href="#5-docker-event-state">#</a> 5 Docker event state</h1>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183609729.jpg" alt="在这里插入图片描述"></p>
<p>本文来自 CSDN</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46727129/article/details/121665668">https://blog.csdn.net/weixin_46727129/article/details/121665668</a></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/9/">上一页</a></div><div class="pagination-next"><a href="/page/11/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/9/">9</a></li><li><a class="pagination-link is-current" href="/page/10/">10</a></li><li><a class="pagination-link" href="/page/11/">11</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-06T09:23:40.000Z">2023-05-06</time></p><p class="title"><a href="/2023/05/06/%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%91%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0Map/">【数据结构】手写实现Hash表，并解决哈希冲突</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-06T07:53:40.000Z">2023-05-06</time></p><p class="title"><a href="/2023/05/06/%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%91%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0ArrayList/">【数据结构】手写实现ArrayList</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-06T05:53:40.000Z">2023-05-06</time></p><p class="title"><a href="/2023/05/06/%E3%80%90%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E3%80%91%E6%89%8B%E5%86%99%E5%AE%9E%E7%8E%B0LinkedList/">【数据结构】手写实现LinkedList</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-05T05:58:11.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/">【算法】算法的时间与空间复杂度</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-05T01:57:09.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/%E3%80%90IDEA%E3%80%91IDEA%E7%9A%84debug%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E8%AF%A6%E8%A7%A3/">【IDEA】IDEA的debug调试技巧详解</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">37</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">139</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">139</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>