<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.529Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-04-21T08:07:03.000Z" title="2020/4/21 16:07:03">2020-04-21</time>更新</span><span class="level-item">9 分钟读完 (大约1312个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Java%E3%80%91SpringBoot%20%E6%95%B4%E5%90%88Redis%E5%AF%B9%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%81%9A%E7%BC%93%E5%AD%98%EF%BC%88%20%E5%88%A9%E7%94%A8Spring%E7%9A%84AOP%E6%8A%80%E6%9C%AF%EF%BC%89/">【Java】SpringBoot 整合Redis对查询数据做缓存（ 利用Spring的AOP技术）</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javaspringboot-整合redis对查询数据做缓存-利用spring的aop技术"><a class="markdownIt-Anchor" href="#javaspringboot-整合redis对查询数据做缓存-利用spring的aop技术">#</a> 【Java】SpringBoot 整合 Redis 对查询数据做缓存（ 利用 Spring 的 AOP 技术）</h1>
<h3 id="本篇主要介绍-springboot-整合redis做数据缓存利用的是-springaop-切面编程技术利用注解标识切面"><a class="markdownIt-Anchor" href="#本篇主要介绍-springboot-整合redis做数据缓存利用的是-springaop-切面编程技术利用注解标识切面">#</a> 本篇主要介绍 SpringBoot 整合 Redis 做数据缓存，利用的是 Spring<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=aop&amp;spm=1001.2101.3001.7020">Aop</a> 切面编程技术，利用注解标识切面。</h3>
<h4 id="这里不再介绍spring-boot操作数据库有兴趣的话我最后会给出源码链接"><a class="markdownIt-Anchor" href="#这里不再介绍spring-boot操作数据库有兴趣的话我最后会给出源码链接">#</a> 这里不再介绍 spring boot 操作数据库，有兴趣的话，我最后会给出源码链接</h4>
<h1 id="一引入依赖"><a class="markdownIt-Anchor" href="#一引入依赖">#</a> 一，引入依赖</h1>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>12345678910</span><br></pre></td></tr></table></figure>
<h1 id="二配置redis连接"><a class="markdownIt-Anchor" href="#二配置redis连接">#</a> 二，配置 redis 连接</h1>
<p>配置文件我里这用的是 yml 格式的，tab 缩进，如果是 properties 格式的，请自己改造<br>
 redis 安装请参考 <a target="_blank" rel="noopener" href="http://blog.csdn.net/mzh1992/article/details/70805823">Redis 安装</a><br>
 windows 管理工具可以用 RedisDesktopManager，测试的时候，可以直接删除缓存。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">## Redis服务器地址</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="number">.128</span></span><br><span class="line">    <span class="comment">## Redis服务器连接端口</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="comment">## Redis服务器连接密码（默认为空）</span></span><br><span class="line">    <span class="attr">password:</span></span><br><span class="line">    <span class="comment">## 连接超时时间（毫秒）</span></span><br><span class="line">    <span class="attr">timeout:</span> <span class="number">0</span></span><br><span class="line">    <span class="comment">## 连接池最大连接数（使用负值表示没有限制）</span></span><br><span class="line">    <span class="attr">pool:</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">8</span></span><br><span class="line">      <span class="comment">## 连接池最大阻塞等待时间（使用负值表示没有限制）</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">-1</span></span><br><span class="line">      <span class="comment">## 连接池中的最大空闲连接</span></span><br><span class="line">      <span class="attr">max-idle:</span> <span class="number">8</span></span><br><span class="line">      <span class="comment">## 连接池中的最小空闲连接</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">01234567891011121314151617181920</span></span><br></pre></td></tr></table></figure>
<h1 id="三注解"><a class="markdownIt-Anchor" href="#三注解">#</a> 三，注解</h1>
<p>注解 QueryCache 用来标识查询数据库的方法，参数 nameSpace 用来区分应用的，后面会用来添加到缓存的 key 中。比如，登陆应用缓存的数据 key 值全部都是 sso 开头。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.common.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.common.CacheNameSpace;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> QueryCache &#123;</span><br><span class="line">    CacheNameSpace <span class="title function_">nameSpace</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解 QueryCacheKey 是方法级别的注解，用来标注要查询数据的主键，会和上面的 nameSpace 组合做缓存的 key 值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.common.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.PARAMETER&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> QueryCacheKey &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>枚举 CacheNameSpace 用来保存 nameSpace 的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">CacheNameSpace</span> &#123;</span><br><span class="line">    SSO_USER</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面就是组合起来的用法，userMapper.findById (id) 是用来查询数据库的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@QueryCache(nameSpace = CacheNameSpace.SSO_USER)</span></span><br><span class="line"><span class="keyword">public</span> UserInfo <span class="title function_">findUserById</span><span class="params">(<span class="meta">@QueryCacheKey</span> Long id)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> userMapper.findById(id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> userInfo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="四aop切面"><a class="markdownIt-Anchor" href="#四aop切面">#</a> 四，Aop 切面</h1>
<p>下面是重点，代码中的注释已经很多了，应该能看的懂，如有问题，可以留言。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.common.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.common.CacheNameSpace;</span><br><span class="line"><span class="keyword">import</span> com.example.common.annotation.QueryCache;</span><br><span class="line"><span class="keyword">import</span> com.example.common.annotation.QueryCacheKey;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.MethodParameter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.SynthesizingMethodParameter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.ValueOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBCacheAspect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">LOGGER</span> <span class="operator">=</span> LoggerFactory.getLogger(DBCacheAspect.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定义拦截规则：拦截所有<span class="doctag">@QueryCache</span>注解的方法。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">/*@Pointcut(&quot;execution(* com.example.service.impl..*(..)) , @annotation(com.example.common.annotation.QueryCache)&quot;)</span></span><br><span class="line"><span class="comment">    public void queryCachePointcut()&#123;&#125;*/</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.common.annotation.QueryCache)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryCachePointcut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截器具体实现</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pjp</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;queryCachePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">Interceptor</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">beginTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        LOGGER.info(<span class="string">&quot;AOP 缓存切面处理 &gt;&gt;&gt;&gt; start &quot;</span>);</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) pjp.getSignature();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod(); <span class="comment">//获取被拦截的方法</span></span><br><span class="line">        <span class="type">CacheNameSpace</span> <span class="variable">cacheType</span> <span class="operator">=</span> method.getAnnotation(QueryCache.class).nameSpace();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 循环所有的参数</span></span><br><span class="line">        <span class="keyword">for</span> (Object value : pjp.getArgs()) &#123;</span><br><span class="line">            <span class="type">MethodParameter</span> <span class="variable">methodParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynthesizingMethodParameter</span>(method, i);</span><br><span class="line">            Annotation[] paramAnns = methodParam.getParameterAnnotations();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 循环参数上所有的注解</span></span><br><span class="line">            <span class="keyword">for</span> (Annotation paramAnn : paramAnns) &#123;</span><br><span class="line">                <span class="keyword">if</span> ( paramAnn <span class="keyword">instanceof</span> QueryCacheKey) &#123; <span class="comment">//</span></span><br><span class="line">                    <span class="type">QueryCacheKey</span> <span class="variable">requestParam</span> <span class="operator">=</span> (QueryCacheKey) paramAnn;</span><br><span class="line">                    key = cacheType.name() + <span class="string">&quot;_&quot;</span> + value;   <span class="comment">// 取到QueryCacheKey的标识参数的值</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取不到key值，抛异常</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(key)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(<span class="string">&quot;缓存key值不存在&quot;</span>);</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">&quot;获取到缓存key值 &gt;&gt;&gt;&gt; &quot;</span> + key);</span><br><span class="line">        ValueOperations&lt;String, Object&gt; operations = redisTemplate.opsForValue();</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasKey</span> <span class="operator">=</span> redisTemplate.hasKey(key);</span><br><span class="line">        <span class="keyword">if</span> (hasKey) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 缓存中获取到数据，直接返回。</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> operations.get(key);</span><br><span class="line">            LOGGER.info(<span class="string">&quot;从缓存中获取到数据 &gt;&gt;&gt;&gt; &quot;</span> + object.toString());</span><br><span class="line">            LOGGER.info(<span class="string">&quot;AOP 缓存切面处理 &gt;&gt;&gt;&gt; end 耗时：&quot;</span> + (System.currentTimeMillis() - beginTime));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> object;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存中没有数据，调用原始方法查询数据库</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        operations.set(key, object, <span class="number">30</span>, TimeUnit.MINUTES); <span class="comment">// 设置超时时间30分钟</span></span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">&quot;DB取到数据并存入缓存 &gt;&gt;&gt;&gt; &quot;</span> + object.toString());</span><br><span class="line">        LOGGER.info(<span class="string">&quot;AOP 缓存切面处理 &gt;&gt;&gt;&gt; end 耗时：&quot;</span> + (System.currentTimeMillis() - beginTime));</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="五测试"><a class="markdownIt-Anchor" href="#五测试">#</a> 五，测试</h1>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">UserInfo</span> <span class="variable">userInfo</span> <span class="operator">=</span> userService.findUserById(<span class="number">210001L</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="六执行结果"><a class="markdownIt-Anchor" href="#六执行结果">#</a> 六，执行结果</h1>
<p><img src="https://img-blog.csdn.net/20170504161114508?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXpoMTk5Mg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p><img src="https://img-blog.csdn.net/20170504161129996?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvbXpoMTk5Mg==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>两张图对比一下很明显，从 redis 缓存中取数据耗时要少的多。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.526Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-04-21T07:45:55.000Z" title="2020/4/21 15:45:55">2020-04-21</time>更新</span><span class="level-item">2 分钟读完 (大约231个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Hbase%E3%80%91Hbase%E4%B8%8Eswagger%E4%B8%8Eguava%E4%BE%9D%E8%B5%96%E9%94%99%E8%AF%AF/">Hbase整合SpringBoot的问题</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>在一个 Demo 中，springboot 整合 Hbase 出了一个难解决的问题：</p>
<p>tried to access method com.google.common.base.Stopwatch.<init>()V from class org.apache.hadoop.hbase.zookeeper.MetaTableLocator</p>
<p>调用 hbase 就会报错，这是因为 swagger 和 guava 依赖冲突导致的，整合 habse 的 1.0 版本，依赖中不能有 swagger，guava 的版本要低于 17.</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.524Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-04-15T09:19:10.000Z" title="2020/4/15 17:19:10">2020-04-15</time>更新</span><span class="level-item">12 分钟读完 (大约1839个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Flutter%E3%80%91flutter%E5%8F%91%E5%B1%95%E5%89%8D%E6%99%AF%E5%A6%82%E4%BD%95%EF%BC%9F/">【Flutter】flutter发展前景如何？</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p><img src="https://pic1.zhimg.com/80/v2-184c74e7aa102e484165122bb5cec4bd_720w.webp?source=1940ef5c" alt="img"></p>
<blockquote>
<p>在 <strong>Flutter</strong> 刚刚从 <strong>Google</strong> 刚刚推向 <strong>Android</strong> 市场的时候，我就开始对 <strong>Flutter</strong> 开始了<strong>学习之路</strong>；但由于当时 <strong>Flutter</strong> 许多东西<strong>尚未完善</strong>而没有推出<strong>稳定的版本</strong>，所以也就没有对其进行<strong>深入</strong>的学习，直到如今 <strong>Flutter</strong> 又<strong>重出江湖</strong>，在<strong>市场</strong>上也得到<strong>了蓬勃发展</strong>及许多业内<strong>大佬</strong>的<strong>力推</strong>，我便又再次<strong>入坑 Flutter</strong></p>
</blockquote>
<p><strong>实现 UI 和交互</strong>是<strong>高级开发者</strong>的<strong>必备技能</strong>，也是<strong>掌握 Flutter 开发</strong>的<strong>重点</strong>；同样 <strong>Flutter</strong> <strong>跨平台</strong>的<strong>特性</strong>是<strong>原生</strong>不能比拟的，更何况还有不弱的<strong>性能</strong>表现；而<strong>性能</strong>往往是由<strong>生命周期</strong>来决定的</p>
<h3 id="何为-flutter-的生命周期"><a class="markdownIt-Anchor" href="#何为-flutter-的生命周期">#</a> <strong>何为 Flutter 的生命周期？</strong></h3>
<p>如果你是一名<strong>开发</strong>人员，那么你一定不会对<strong>生命周期</strong>感到陌生；当你在学习 <strong>Flutter</strong> 的时候，<strong>Flutter 也有自己的生命周期</strong>，只有通过了解 <strong>Flutter</strong> 的<strong>生命周期</strong>，才能知道应该在哪里来写<strong>业务逻辑</strong></p>
<h3 id="flutter-生命周期"><a class="markdownIt-Anchor" href="#flutter-生命周期">#</a> <strong>Flutter 生命周期</strong></h3>
<p><img src="https://picx.zhimg.com/80/v2-6ae547ee1a88db89634eb9c6567146d8_720w.webp?source=1940ef5c" alt="img"></p>
<p>如上图所示，<strong>Flutter 生命周期</strong>大体上可以分为<strong>三个阶段：</strong> <strong>初始化、状态变化、销毁</strong>；下面依次说明各个阶段的工作</p>
<p><strong>初始化阶段</strong>（插入<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%B8%B2%E6%9F%93%E6%A0%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">渲染树</a>）</p>
<ul>
<li>对应执行构造方法和 initState</li>
</ul>
<p><strong>状态变化阶段</strong>（在渲染树中存在）</p>
<ul>
<li>开新的 widget 或者调用 setState 方法</li>
</ul>
<p><strong>销毁阶段</strong>（从渲染树种移除）</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=deactivate&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">deactivate</a> 和 dispose</li>
</ul>
<p>如果之前你对 <strong>Flutter</strong> 有一点点了解的话，你会发现 <strong>Flutter</strong> 中有<strong>两个</strong>主要的 <strong>Widget：</strong> <strong>StatelessWidget（无状态）</strong> 和 <strong>StatefulWidget（有状态）</strong></p>
<h3 id="statelesswidget"><a class="markdownIt-Anchor" href="#statelesswidget">#</a> <strong>StatelessWidget</strong></h3>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%97%A0%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">无状态组件</a>] 是不可变的</strong>，这意味着它们的<strong>属性不能变化</strong>，所有的值都是最终的；可以理解为将<strong>外部传入的数据转化为界面展示的内容，只会渲染一次</strong></li>
<li><strong>对于无状态组件生命周期只有 build 这个过程</strong>；无状态组件的构建方法通常只在三种情况下会被调用：<strong>小组件第一次被插入树中，小组件的父组件改变其配置，以及它所依赖的 InheritedWidget 发生变化时</strong></li>
</ul>
<h3 id="statefulwidget"><a class="markdownIt-Anchor" href="#statefulwidget">#</a> <strong>StatefulWidget</strong></h3>
<ul>
<li>有状态组件持有的状态可能在 Widget 生命周期中发生变化，是定义<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%BA%A4%E4%BA%92%E9%80%BB%E8%BE%91&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">交互逻辑</a>和业务逻辑；可以理解为具有动态可交互的内容界面，会根据数据的变化进行多次渲染</li>
</ul>
<h3 id="实现一个-statefulwidget-至少需要两个类"><a class="markdownIt-Anchor" href="#实现一个-statefulwidget-至少需要两个类">#</a> <strong>实现一个 StatefulWidget 至少需要两个类：</strong></h3>
<p><strong>一个是 StatefulWidget 类</strong> <strong>另一个是 Sate 类</strong></p>
<ul>
<li><strong>StatefulWidget 类本身是不可变的</strong>，但是 <strong>State 类</strong>在 <strong>Widget 生命周期中始终存在</strong></li>
<li><strong>StatefulWidget</strong> 将其<strong>可变</strong>的<strong>状态存储</strong>在由 <strong>createState</strong> 方法创建的 <strong>State</strong> 对象中，或者存储在该 <strong>State 订阅</strong>的对象中</li>
</ul>
<h3 id="fultter-的优势在哪里"><a class="markdownIt-Anchor" href="#fultter-的优势在哪里">#</a> <strong>Fultter 的优势在哪里？</strong></h3>
<h3 id="快速开发和迭代"><a class="markdownIt-Anchor" href="#快速开发和迭代">#</a> <strong>快速开发和迭代</strong></h3>
<p><strong>Flutter 自身具有热修复（<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%83%AD%E9%87%8D%E8%BD%BD&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D">热重载</a>）<strong>的功能，尽管有使用的限制，但是它依然能够为</strong>开发过程</strong>提供<strong>更高的效率</strong>；另外，<strong>Flutter SDK</strong> 还允许我们<strong>修复崩溃</strong>和继续从<strong>应用程序</strong>停止的地方进行<strong>调试</strong></p>
<h3 id="页面流畅-样式美观"><a class="markdownIt-Anchor" href="#页面流畅-样式美观">#</a> <strong>页面流畅、样式美观</strong></h3>
<p><strong>对于不同的平台（Android 和 iOS）</strong>，<strong>Flutter</strong> 提供了<strong>风格不同</strong>的<strong>控件</strong>，以<strong>满足不同平台</strong>的<strong>设计理念</strong></p>
<h3 id="提供原生性能"><a class="markdownIt-Anchor" href="#提供原生性能">#</a> <strong>提供原生性能</strong></h3>
<p><strong>Flutter</strong> 提供了一种 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E5%93%8D%E5%BA%94%E5%BC%8F%E8%A7%86%E5%9B%BE&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 响应式视图</a><strong>，无须 <strong>JavaScript</strong> 做</strong>桥接 **；强大的 <strong>API</strong> 使得<strong>实现复杂的页面效果</strong>成为可能；高性能的 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 渲染机制</a> ** 使得 <strong>120 FPS 的高频率</strong> 可以轻而易举的实现；<strong>当界面上的图片数量越来越多时，与 React Native 相比，Flutter 的优势会越来越明显</strong></p>
<h3 id="灵活的跨平台开发"><a class="markdownIt-Anchor" href="#灵活的跨平台开发">#</a> <strong>灵活的跨平台开发</strong></h3>
<p><strong>Flutter</strong> 可以单独作为<strong>开发框架</strong>完成整个 <strong>App 的开发</strong>，也可以与现有<strong>原生代码</strong>相结合实现 <strong>Hybrid 混合模式的开发</strong></p>
<h3 id="那-flutter-需要学吗"><a class="markdownIt-Anchor" href="#那-flutter-需要学吗">#</a> <strong>那 Flutter 需要学吗？</strong></h3>
<p><strong>Flutter</strong> 抛弃了<strong>原生系统控件</strong>和 <strong>Webview</strong>，使用<strong>自研高性能渲染引擎</strong>来绘制 <strong>Widget</strong>，预先 (AOT) 编译，<strong>运行时直接执行 Native (arm) 代码</strong>，<strong>Dart 代码</strong>执行 (在 UI TaskRunner)，<strong>图片下载</strong> (IO TaskRunner)，<strong>真正的渲染</strong> (GPU TaskRunner) ，<strong>同平台的通信</strong>等 (Platform TaskRunner 即 <strong>Native 概念</strong>下的 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E4%B8%BB%E7%BA%BF%E7%A8%8B&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 主线程</a><strong>) 是</strong>互相隔离 ** 的</p>
<p>针对<strong>布局</strong>等的<strong>优</strong>化；<strong>布局</strong>计算时单次树走动即可完成；<strong>Relayout Boundary</strong> 机制：如果 <strong>Child</strong> 的 <strong>size</strong> 是<strong>固定</strong>的，那么不会因为 <strong>Child</strong> 的 <strong>Relayout</strong> 导致 <strong>Parent ReLayout</strong> 等<strong>布局优化</strong>，都让 <strong>Flutter 脱颖而出</strong></p>
<p>如上所述 <strong>Flutter</strong> 于谷歌而言，这是他们重新整理 <strong>跨平台生态环境</strong> 决心的体现，<strong>Flutter</strong> 所展现的内容，也是谷歌想拓展和维护的方向；对于长期苦恼于 <strong>跨平台</strong> 选择的广大 <strong>Android 开发者</strong> 而言，<strong>Flutter</strong> 可谓是谷歌为我们提供的 <strong>指路明灯</strong></p>
<p>以<strong>目前</strong>的<strong>开发速度</strong>，只要不出<strong>大的纰漏</strong>，<strong>按部就班</strong>的<strong>往前推进</strong>，在<strong>不久的将来</strong>， <strong>Google</strong> 一定可以把 <strong>Flutter</strong> 平台打造得非常完美，届时又会改变 **<a target="_blank" rel="noopener" href="https://www.zhihu.com/search?q=%E7%A7%BB%E5%8A%A8%E5%BC%80%E5%8F%91%E6%8A%80%E6%9C%AF&amp;search_source=Entity&amp;hybrid_search_source=Entity&amp;hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2734680490%7D"> 移动开发技术</a><strong>的</strong>格局 ** 了</p>
<p>也许，<strong>Flutter</strong> 系列的<strong>部分库</strong>还没成熟到成为你<strong>工作的第一选择</strong>，但是，深入学习 <strong>Flutter</strong> 组件会为你日常的开发带来一些想法</p>
<p><strong>总的来说，Flutter</strong> 对广大开发者而言是 <strong>利远远大于弊的</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.521Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-03-26T09:09:02.000Z" title="2020/3/26 17:09:02">2020-03-26</time>更新</span><span class="level-item">14 分钟读完 (大约2029个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Java&amp;%E5%85%AC%E4%BC%97%E5%8F%B7%E3%80%91Java%E5%BC%80%E5%8F%91%E5%85%AC%E4%BC%97%E5%8F%B7%E8%87%AA%E5%8A%A8%E5%9B%9E%E5%A4%8D%E5%8A%9F%E8%83%BD/">Java开发公众号自动回复功能</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h5 id="本文最先发表于我的个人博客-csdn为同步发布如有需要请访问-brath的个人博客-获取更多内容"><a class="markdownIt-Anchor" href="#本文最先发表于我的个人博客-csdn为同步发布如有需要请访问-brath的个人博客-获取更多内容">#</a> 本文最先发表于我的个人博客 ，CSDN 为同步发布，如有需要，请访问 <a target="_blank" rel="noopener" href="https://brath.top/">Brath 的个人博客</a> 获取更多内容</h5>
<h2 id="背景"><a class="markdownIt-Anchor" href="#背景">#</a> 背景</h2>
<p>最近准备搭建自己的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F&amp;spm=1001.2101.3001.7020">博客系统</a>，有些软件或资料的下载链接放在网盘中，为了方便下载，同时可以将用户导流到公众号上，因此准备用 Java 实现微信公众号业务支持公众号自动回复的功能</p>
<h2 id="准备工作"><a class="markdownIt-Anchor" href="#准备工作">#</a> 准备工作</h2>
<ul>
<li>微信公众号业务支持公众号</li>
</ul>
<p>首先当然是需要注册一个<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E4%B8%9A%E5%8A%A1%E6%94%AF%E6%8C%81%E5%85%AC%E4%BC%97%E5%8F%B7&amp;spm=1001.2101.3001.7020">微信公众号业务支持公众号</a>，具体步骤就不在这里赘述了，注册地址：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/">微信公众号业务支持公众平台</a></p>
<p>注册完毕后需要完成认证操作</p>
<h2 id="代码"><a class="markdownIt-Anchor" href="#代码">#</a> 代码</h2>
<p>依赖引入，<strong>主要为 xml 相关依赖</strong>， 因为微信公众号业务支持公众号采用的 xml 消息格式进行交互</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dom4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.thoughtworks.xstream<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xstream<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">12345678910</span><br></pre></td></tr></table></figure>
<p>自动回复内容一共需要两个接口（两个接口路由完全一致，一个为 GET 请求，一个为 POST 请求）</p>
<ul>
<li>微信公众号业务支持公众号认证接口</li>
</ul>
<blockquote>
<p>此接口用于微信公众号业务支持公众号后台服务器认证使用，GET 请求</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微信公众号业务支持校验</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> signature</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> timestamp</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> nonce</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> echostr</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;callback&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(String signature, String timestamp, String nonce, String echostr, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    log.info(<span class="string">&quot;微信公众号业务支持校验消息，signature:&#123;&#125;，timestamp:&#123;&#125;，nonce:&#123;&#125;，echostr:&#123;&#125;&quot;</span>, signature, timestamp, nonce, echostr);</span><br><span class="line">    List&lt;WechatConfigPO&gt; configPOList = wechatConfigDao.selectAll();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        out = response.getWriter();</span><br><span class="line">        out.write(echostr);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;微信公众号业务支持校验失败&quot;</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="literal">null</span>) &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>消息接收接口</li>
</ul>
<blockquote>
<p>此接口用于接收公众号消息回调，POST 请求</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微信公众号业务支持消息回调</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;callback&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">callback</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">respMessage</span> <span class="operator">=</span> wechatService.callback(request);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(respMessage)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;不回复消息&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        out = response.getWriter();</span><br><span class="line">        out.write(respMessage);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;微信公众号业务支持发送消息失败&quot;</span>, e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (out != <span class="literal">null</span>) &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>消息回复 service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/2/23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 微信公众号业务支持</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> TextReplyService textReplyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信公众号业务支持回复</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UnsupportedEncodingException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">callback</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">        request.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Map&lt;String, String&gt; requestMap = WechatMessageUtils.parseXml(request);</span><br><span class="line">            log.info(<span class="string">&quot;微信公众号业务支持接收到消息:&#123;&#125;&quot;</span>, GsonUtils.toJson(requestMap));</span><br><span class="line">            <span class="comment">// 消息类型</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">msgType</span> <span class="operator">=</span> requestMap.get(<span class="string">&quot;MsgType&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理其他消息，暂时不做回复</span></span><br><span class="line">            <span class="keyword">switch</span> (msgType) &#123;</span><br><span class="line">                <span class="keyword">case</span> WechatMsgTypeConstant.MESSAGE_TYPE_TEXT:</span><br><span class="line">                    <span class="comment">// 文本消息处理</span></span><br><span class="line">                    <span class="keyword">return</span> textReplyService.reply(requestMap);</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> textReplyService.reply(requestMap);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;回复消息错误&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 不做回复</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>文本回复 service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/5/18 9:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 文本回复</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextReplyService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FROM_USER_NAME</span> <span class="operator">=</span> <span class="string">&quot;FromUserName&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TO_USER_NAME</span> <span class="operator">=</span> <span class="string">&quot;ToUserName&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONTENT</span> <span class="operator">=</span> <span class="string">&quot;Content&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WechatKeywordDao wechatKeywordDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WechatMsgRecordDao wechatMsgRecordDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自动回复文本内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reply</span><span class="params">(Map&lt;String, String&gt; requestMap)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">wechatId</span> <span class="operator">=</span> requestMap.get(FROM_USER_NAME);</span><br><span class="line">        <span class="type">String</span> <span class="variable">gongzhonghaoId</span> <span class="operator">=</span> requestMap.get(TO_USER_NAME);</span><br><span class="line"></span><br><span class="line">        <span class="type">TextMessage</span> <span class="variable">textMessage</span> <span class="operator">=</span> WechatMessageUtils.getDefaultTextMessage(wechatId, gongzhonghaoId);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> requestMap.get(CONTENT);</span><br><span class="line">        <span class="keyword">if</span> (content == <span class="literal">null</span>) &#123;</span><br><span class="line">            textMessage.setContent(WechatConstants.DEFAULT_MSG);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Example</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Example</span>(WechatKeywordPO.class);</span><br><span class="line">            example.createCriteria().andEqualTo(<span class="string">&quot;wechatId&quot;</span>, gongzhonghaoId).andEqualTo(<span class="string">&quot;keyword&quot;</span>, content);</span><br><span class="line">            List&lt;WechatKeywordPO&gt; keywordPOList = wechatKeywordDao.selectByExample(example);</span><br><span class="line">            <span class="keyword">if</span> (CollectionUtils.isEmpty(keywordPOList)) &#123;</span><br><span class="line">                textMessage.setContent(WechatConstants.DEFAULT_MSG);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                textMessage.setContent(keywordPOList.get(<span class="number">0</span>).getReplyContent());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 记录消息记录</span></span><br><span class="line">        wechatMsgRecordDao.insertSelective(WechatMsgRecordPO.builder()</span><br><span class="line">                .fromUser(wechatId)</span><br><span class="line">                .wechatId(gongzhonghaoId)</span><br><span class="line">                .content(content)</span><br><span class="line">                .replyContent(textMessage.getContent())</span><br><span class="line">                .build()</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> WechatMessageUtils.textMessageToXml(textMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>文本消息 model</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/11/26 22:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文本消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextMessage</span> <span class="keyword">extends</span> <span class="title class_">BaseMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回复的消息内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String Content;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1234567891011121314</span></span><br></pre></td></tr></table></figure>
<p><strong>基础消息 model</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/11/26 22:20</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 基础消息响应</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收方帐号（收到的OpenID）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String ToUserName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 开发者微信公众号业务支持号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String FromUserName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消息创建时间 （整型）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> CreateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消息类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String MsgType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 位0x0001被标志时，星标刚收到的消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> FuncFlag;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>消息工具</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/5/18 7:55</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 微信公众号业务支持消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解析微信公众号业务支持发来的请求（XML）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">parseXml</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 将解析结果存储在HashMap中</span></span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从request中取得输入流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> request.getInputStream();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 读取输入流</span></span><br><span class="line">            <span class="type">SAXReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SAXReader</span>();</span><br><span class="line">            <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> reader.read(inputStream);</span><br><span class="line">            <span class="comment">// 得到xml根元素</span></span><br><span class="line">            <span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> document.getRootElement();</span><br><span class="line">            <span class="comment">// 得到根元素的所有子节点</span></span><br><span class="line"></span><br><span class="line">            List&lt;Element&gt; elementList = root.elements();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 遍历所有子节点</span></span><br><span class="line">            <span class="keyword">for</span> (Element e : elementList) &#123;</span><br><span class="line">                map.put(e.getName(), e.getText());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 释放资源</span></span><br><span class="line">            <span class="keyword">if</span> (inputStream != <span class="literal">null</span>) &#123;</span><br><span class="line">                inputStream.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本消息对象转换成xml</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> textMessage 文本消息对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> xml</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">textMessageToXml</span><span class="params">(TextMessage textMessage)</span> &#123;</span><br><span class="line">        XSTREAM.alias(<span class="string">&quot;xml&quot;</span>, textMessage.getClass());</span><br><span class="line">        <span class="keyword">return</span> XSTREAM.toXML(textMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 音乐消息对象转换成xml</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> musicMessage 音乐消息对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> xml</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">musicMessageToXml</span><span class="params">(MusicMessage musicMessage)</span> &#123;</span><br><span class="line">        XSTREAM.alias(<span class="string">&quot;xml&quot;</span>, musicMessage.getClass());</span><br><span class="line">        <span class="keyword">return</span> XSTREAM.toXML(musicMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图文消息对象转换成xml</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newsMessage 图文消息对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> xml</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">newsMessageToXml</span><span class="params">(NewsMessage newsMessage)</span> &#123;</span><br><span class="line">        XSTREAM.alias(<span class="string">&quot;xml&quot;</span>, newsMessage.getClass());</span><br><span class="line">        XSTREAM.alias(<span class="string">&quot;item&quot;</span>, Article.class);</span><br><span class="line">        <span class="keyword">return</span> XSTREAM.toXML(newsMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扩展xstream，使其支持CDATA块</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">XStream</span> <span class="variable">XSTREAM</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XStream</span>(<span class="keyword">new</span> <span class="title class_">XppDriver</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> HierarchicalStreamWriter <span class="title function_">createWriter</span><span class="params">(Writer out)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PrettyPrintWriter</span>(out) &#123;</span><br><span class="line">                <span class="comment">// 对所有xml节点的转换都增加CDATA标记</span></span><br><span class="line">                <span class="keyword">final</span> <span class="type">boolean</span> <span class="variable">cdata</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">writeText</span><span class="params">(QuickWriter writer, String text)</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cdata) &#123;</span><br><span class="line">                        writer.write(<span class="string">&quot;&lt;![CDATA[&quot;</span>);</span><br><span class="line">                        writer.write(text);</span><br><span class="line">                        writer.write(<span class="string">&quot;]]&gt;&quot;</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        writer.write(text);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取默认文本消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> receiver     接收人</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> officialWxid 官方微信公众号业务支持id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> TextMessage <span class="title function_">getDefaultTextMessage</span><span class="params">(String receiver, String officialWxid)</span> &#123;</span><br><span class="line">        <span class="type">TextMessage</span> <span class="variable">textMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextMessage</span>();</span><br><span class="line">        textMessage.setToUserName(receiver);</span><br><span class="line">        textMessage.setFromUserName(officialWxid);</span><br><span class="line">        textMessage.setCreateTime(System.currentTimeMillis());</span><br><span class="line">        textMessage.setMsgType(WechatMsgTypeConstant.MESSAGE_TYPE_TEXT);</span><br><span class="line">        textMessage.setFuncFlag(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> textMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>消息类型枚举</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2022/5/18 8:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 微信公众号业务支持消息类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMsgTypeConstant</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MESSAGE_TYPE_TEXT</span> <span class="operator">=</span> <span class="string">&quot;text&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其他内容为一些数据库相关操作，此处不再列出，仅为：<strong>查询关键词及其回复内容</strong>，<strong>存储消息记录</strong></p>
</blockquote>
<h2 id="公众号配置"><a class="markdownIt-Anchor" href="#公众号配置">#</a> 公众号配置</h2>
<ul>
<li>服务器配置</li>
</ul>
<p>公众号后台 -&gt; 设置与开发 -&gt; 基本配置 -&gt; 服务器配置</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223130939844.png" alt="image-20230223130939844"></p>
<ul>
<li>填写服务器地址</li>
</ul>
<p>填写你的服务器回调接口地址 (<strong>需要为公网地址，否则微信公众号业务支持无法调通</strong>)</p>
<ul>
<li>生成或者自定义你的令牌 Token，后台需要配置这个 Token，一定要记住</li>
</ul>
<blockquote>
<p>Token 需要记住，<strong>一般在微信公众号业务支持验证接口处会校验相关信息是否是自己的公众号</strong></p>
</blockquote>
<p><strong>验证方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/11/26 21:59</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 微信公众号业务支持工具</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[] HEX_DIGITS = &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">checkSignature</span><span class="params">(String signature, String timestamp, String nonce, String token)</span> &#123;</span><br><span class="line">        String[] str = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;token, timestamp, nonce&#125;;</span><br><span class="line">        <span class="comment">//排序</span></span><br><span class="line">        Arrays.sort(str);</span><br><span class="line">        <span class="comment">//拼接字符串</span></span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length; i++) &#123;</span><br><span class="line">            buffer.append(str[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//进</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">temp</span> <span class="operator">=</span> encode(buffer.toString());</span><br><span class="line">        <span class="comment">//与微信公众号业务支持提供的signature进行匹对</span></span><br><span class="line">        <span class="keyword">return</span> signature.equals(temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getFormattedText</span><span class="params">(<span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> bytes.length;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">buf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(len * <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; len; j++) &#123;</span><br><span class="line">            buf.append(HEX_DIGITS[(bytes[j] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0f</span>]);</span><br><span class="line">            buf.append(HEX_DIGITS[bytes[j] &amp; <span class="number">0x0f</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buf.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (str == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;SHA1&quot;</span>);</span><br><span class="line">            messageDigest.update(str.getBytes());</span><br><span class="line">            <span class="keyword">return</span> getFormattedText(messageDigest.digest());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950</span></span><br></pre></td></tr></table></figure>
<ul>
<li>验证公众号自动回复是否正确</li>
</ul>
<blockquote>
<p>可以搜索公众号 InterviewCoder) 或扫码关注公众号回复关键词《chatGPT》查看效果</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/%E4%BA%8C%E7%BB%B4%E7%A0%81mini.png" alt="二维码mini"></p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.518Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-03-12T08:15:30.000Z" title="2020/3/12 16:15:30">2020-03-12</time>更新</span><span class="level-item">2 分钟读完 (大约269个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%91%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/">云服务器部署宝塔面板</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>购买好服务器后，进入 Xshell：</p>
<p>1. 安装宝塔面板</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh</span><br></pre></td></tr></table></figure>
<p>获得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">==================================================================</span><br><span class="line">Congratulations! Installed successfully!</span><br><span class="line">==================================================================</span><br><span class="line">外网面板地址: http://42.193.125.92:8888/ef1f509f</span><br><span class="line">内网面板地址: http://172.21.0.3:8888/ef1f509f</span><br><span class="line">username: upqknxq4</span><br><span class="line">password: f3701931</span><br><span class="line">If you cannot access the panel,</span><br><span class="line">release the following panel port [8888] in the security group</span><br><span class="line">若无法访问面板，请检查防火墙/安全组是否有放行面板[8888]端口</span><br><span class="line">==================================================================</span><br><span class="line">Time consumed: 1 Minute!</span><br></pre></td></tr></table></figure>
<p>访问 <a target="_blank" rel="noopener" href="http://ip:8888/ef1f509f">http://ip:8888/ef1f509f</a> 打开宝塔</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.514Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-03-05T05:27:26.000Z" title="2020/3/5 13:27:26">2020-03-05</time>更新</span><span class="level-item">19 分钟读完 (大约2775个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Flutter%E3%80%91Flutter_GetX%E6%96%87%E6%A1%A3/">Flutter GETX框架</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>​		GetX 是 Flutter 上的一个轻量且强大的解决方案：高性能的状态管理、智能的依赖注入和便捷的路由管理。</p>
<p>​		与其说是一个状态管理库，倒不如是是一个简化 Flutter 开发的百宝箱。它提供了很多工具来简化我们的开发，本篇我们先对 GetX 有一个大概的认识，然后接下来的篇章再将 GetX 的具体应用。</p>
<h2 id="getx-工具介绍"><a class="markdownIt-Anchor" href="#getx-工具介绍">#</a> <strong>GetX 工具介绍</strong></h2>
<p>官方文档给出关于 GetX 的介绍如下：</p>
<blockquote>
<p>GetX is an extra-light and powerful solution for Flutter. It combines high-performance state management, intelligent dependency injection, and route management quickly and practically. GetX 是一个超轻量且强大的 Flutter 应用解决方案。它组合了高性能的状态管理、智能的依赖注入以及快速可用的路由管理。</p>
</blockquote>
<p>而实际上，GetX 还有更多的小工具，示例如下：</p>
<h4 id="状态管理"><a class="markdownIt-Anchor" href="#状态管理">#</a> 状态管理</h4>
<ul>
<li>Obx 是配合 Rx 响应式变量使用、GetBuilder 是配合 update 使用：请注意，这完全是俩套定点刷新控件的方案。<br>
区别：前者响应式变量变化，Obx 自动刷新；后者需要使用 update 手动调用刷新</li>
<li>每一个响应式变量，都需要生成对应的 GetStream，占用资源大于基本数据类型，会对内存造成一定压力</li>
<li>GetBuilder 内部实际上是对 StatefulWidget 的封装，所以占用资源极小（推荐使用）</li>
</ul>
<h4 id="控制器的注入"><a class="markdownIt-Anchor" href="#控制器的注入">#</a> 控制器的注入</h4>
<ul>
<li>静态路由绑定</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AsWorkStatisticsBinding</span> <span class="keyword">implements</span> <span class="title class_">Bindings</span> &#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">void</span> <span class="title function_">dependencies</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Get</span>.<span class="property">lazyPut</span>&lt;<span class="title class_">AsWorkStatisticsController</span>&gt;(<span class="function">() =&gt;</span> <span class="title class_">AsWorkStatisticsController</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> final <span class="title class_">List</span>&lt;<span class="title class_">GetPage</span>&gt; routes = [</span><br><span class="line">    <span class="title class_">GetPage</span>(</span><br><span class="line">      <span class="attr">name</span>: workStatisticsPage,</span><br><span class="line">      <span class="attr">page</span>: <span class="function">() =&gt;</span> <span class="keyword">const</span> <span class="title class_">AsWorkStatisticsPage</span>(),</span><br><span class="line">      <span class="attr">binding</span>: <span class="title class_">AsWorkStatisticsBinding</span>(),</span><br><span class="line">    ),</span><br><span class="line">];</span><br><span class="line"><span class="title class_">Get</span>.<span class="title function_">toNamed</span>(<span class="title class_">ASRouteConfig</span>.<span class="property">workPlanDetailPage</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>动态路由绑定</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get<span class="selector-class">.to</span>(AsWorkStatisticsPage(),binding: <span class="built_in">AsWorkStatisticsBinding</span>());</span><br></pre></td></tr></table></figure>
<ul>
<li>页面注入</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Get</span>.<span class="property">lazyPut</span>&lt;<span class="title class_">AsWorkStatisticsController</span>&gt;(<span class="function">() =&gt;</span> <span class="title class_">AsWorkStatisticsController</span>());</span><br></pre></td></tr></table></figure>
<h4 id="动态简单路由和静态命名路由"><a class="markdownIt-Anchor" href="#动态简单路由和静态命名路由">#</a> 动态 / 简单路由和静态 / 命名路由</h4>
<p>请注意命名路由，只需要在 api 结尾加上 Named 即可，举例：</p>
<ul>
<li>默认：<a target="_blank" rel="noopener" href="http://Get.to">Get.to</a>(SomePage());</li>
<li>命名路由：Get.toNamed (“/somePage”);</li>
<li>导航到新的页面</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get.to(NextScreen());</span><br><span class="line">Get.toNamed(<span class="string">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>关闭 SnackBars、Dialogs、BottomSheets 或任何你通常会用 Navigator.pop (context) 关闭的东西</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get<span class="selector-class">.back</span>();</span><br></pre></td></tr></table></figure>
<ul>
<li>进入下一个页面，但没有返回上一个页面的选项（用于 SplashScreens，登录页面等）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get.off(NextScreen());</span><br><span class="line">Get.offNamed(<span class="string">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>进入下一个界面并取消之前的所有路由（在购物车、投票和测试中很有用）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get.offAll(NextScreen());</span><br><span class="line">Get.offAllNamed(<span class="string">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>发送数据到其它页面</li>
</ul>
<p>只要发送你想要的参数即可。Get 在这里接受任何东西，无论是一个字符串，一个 Map，一个 List，甚至一个类的实例。</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Get</span>.<span class="title function_">to</span>(<span class="title class_">NextScreen</span>(), <span class="attr">arguments</span>: <span class="string">&#x27;Get is the best&#x27;</span>);</span><br><span class="line"><span class="title class_">Get</span>.<span class="title function_">toNamed</span>(<span class="string">&quot;/NextScreen&quot;</span>, <span class="attr">arguments</span>: <span class="string">&#x27;Get is the best&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>在你的类或控制器上。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(Get.arguments);</span><br><span class="line"><span class="comment">//print out: Get is the best</span></span><br></pre></td></tr></table></figure>
<ul>
<li>要导航到下一条路由，并在返回后立即接收或更新数据</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">await</span> Get.to(Payment());</span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">await</span> Get.toNamed(<span class="string">&quot;/payment&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>在另一个页面上，发送前一个路由的数据</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get.back(result: <span class="string">&#x27;success&#x27;</span>);</span><br><span class="line"><span class="comment">// 并使用它，例：</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">data</span> == <span class="string">&#x27;success&#x27;</span>) madeAnything();</span><br></pre></td></tr></table></figure>
<ul>
<li>跳转重复页面，可以这样写</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get.to(XxxxPage(), preventDuplicates: <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">Get.toNamed(<span class="string">&#x27;xxx&#x27;</span>,  preventDuplicates: <span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>如果你不想使用 GetX 语法，只要把 Navigator（大写）改成 navigator（小写），你就可以拥有标准导航的所有功能，而不需要使用 context，例如：</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认的Flutter导航</span></span><br><span class="line">Navigator.of(context).push(</span><br><span class="line">  context,</span><br><span class="line">  MaterialPageRoute(</span><br><span class="line">    builder: (BuildContext context) &#123;</span><br><span class="line">      <span class="keyword">return</span> HomePage();</span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用Flutter语法获得，而不需要context。</span></span><br><span class="line">navigator.push(</span><br><span class="line">  MaterialPageRoute(</span><br><span class="line">    builder: (_) &#123;</span><br><span class="line">      <span class="keyword">return</span> HomePage();</span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get语法</span></span><br><span class="line">Get.to(HomePage());</span><br></pre></td></tr></table></figure>
<h4 id="getview的使用"><a class="markdownIt-Anchor" href="#getview的使用">#</a> GetView 的使用</h4>
<p>GetView 只是对已注册的 Controller 有一个名为 controller 的 getter 的 const Stateless 的 Widget，如果我们只有单个控制器作为依赖项，那我们就可以使用 GetView，而不是使用 StatelessWidget，并且避免了写 Get.Find ()。</p>
<p>GetView 的使用方法非常简单，只是要将你的视图层继承自 GetView 并传入需要注册的控制器并 Get.put () 即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GetViewAndGetWidgetExample</span> <span class="keyword">extends</span> <span class="title class_">GetView</span>&lt;GetViewCountController&gt; &#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget <span class="title function_">build</span><span class="params">(BuildContext context)</span> &#123;</span><br><span class="line"></span><br><span class="line">    Get.put(GetViewCountController());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Container();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="路由"><a class="markdownIt-Anchor" href="#路由">#</a> <strong>路由</strong></h3>
<p>路由支持命名路由和匿名路由：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Get.to(() =&gt; Home());</span><br><span class="line">Get.toNamed(&#x27;/home&#x27;);</span><br><span class="line">// 返回上一个页面</span><br><span class="line">Get.back();</span><br><span class="line">// 使用下一个页面替换</span><br><span class="line">Get.off(NextScreen());</span><br><span class="line">// 清空导航堆栈全部页面</span><br><span class="line">Get.offAll(NextScreen());</span><br><span class="line">// 获取命名路由参数</span><br><span class="line">print(Get.parameters[&#x27;id&#x27;]);</span><br><span class="line">print(Get.parameters[&#x27;name&#x27;]);</span><br></pre></td></tr></table></figure>
<p>GetX 的路由好处是不依赖于  <code>context</code> ，十分简洁，更多路由介绍可以参考：<strong><a href="https://link.zhihu.com/?target=https%3A//github.com/jonataslaw/getx/blob/master/documentation/en_US/route_management.md">GetX 路由介绍官方文档</a></strong>。</p>
<h2 id="snackbar"><a class="markdownIt-Anchor" href="#snackbar">#</a> <strong>SnackBar</strong></h2>
<p>Flutter 自身携带的 SnackBar 有很多限制，而 GetX 的非常简单，当然也有更多的样式配置和位置配置参数。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get.snackbar(&#x27;SnackBar&#x27;, &#x27;这是GetX的SnackBar&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="对话框"><a class="markdownIt-Anchor" href="#对话框">#</a> <strong>对话框</strong></h2>
<p>对话框也一样，默认的对话框开箱即用。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Get.defaultDialog(</span><br><span class="line">  title: &#x27;对话框&#x27;,</span><br><span class="line">  content: Text(&#x27;对话框内容&#x27;),</span><br><span class="line">  onConfirm: () &#123;</span><br><span class="line">    print(&#x27;Confirm&#x27;);</span><br><span class="line">    Get.back();</span><br><span class="line">  &#125;,</span><br><span class="line">  onCancel: () &#123;</span><br><span class="line">    print(&#x27;Cancel&#x27;);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="内存缓存"><a class="markdownIt-Anchor" href="#内存缓存">#</a> <strong>内存缓存</strong></h2>
<p>GetX 可以缓存内容对象，以便在不同页面共享数据。使用的时候需要注意，需要先  <code>put</code>  操作再  <code>find</code>  操作，否则会抛异常。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Get.put(CacheData(name: &#x27;这是缓存数据&#x27;));</span><br><span class="line">CacheData cache = Get.find();</span><br></pre></td></tr></table></figure>
<h2 id="离线存储"><a class="markdownIt-Anchor" href="#离线存储">#</a> <strong>离线存储</strong></h2>
<p>GetX 提供了一个 <strong><a href="https://link.zhihu.com/?target=https%3A//pub.flutter-io.cn/packages/get_storage">get_storage</a></strong> 插件用于离线存储，与  <code>shared_preferences</code>  相比，其优点是纯 Dart 编写，不依赖于原生，因此可以在安卓、iOS、Web、Linux、Mac 等多个平台使用。 <code>GetStorage</code>  是基于内存和文件存储的，当内存容器中有数据时优先从内存读取。同时在构建 GetStorage 对象到时候指定存储的文件名以及存储数据的容器。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GetStorage storage = GetStorage();</span><br><span class="line">storage.write(&#x27;name&#x27;, &#x27;岛上码农&#x27;);</span><br><span class="line">storage.read(&#x27;name&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="更改主题"><a class="markdownIt-Anchor" href="#更改主题">#</a> <strong>更改主题</strong></h2>
<p>可以说是一行代码搞定深色和浅色模式，也可以更改为自定义主题 —— <strong>老板让你根据手机壳改主体颜色的需求</strong>已经搞定了一大半了！</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Get.changeTheme(</span><br><span class="line">  Get.isDarkMode ? ThemeData.light() : ThemeData.dark());</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.cloud/blogImg/v2-196c01dbae06a8e68132fcd94e3983a6_b.jpg" alt="img"></p>
<h2 id="多语言支持"><a class="markdownIt-Anchor" href="#多语言支持">#</a> <strong>多语言支持</strong></h2>
<p>多语言支持使用数据字典完成，在  <code>GetMaterialApp</code>  指定字典对象（继承自  <code>Translations</code> ），使用字符串的时候假设 <code>.tr</code>  后缀，就可以在切换语言的时候自动切换字符串对应语言的翻译了。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">class GetXDemo extends StatelessWidget &#123;</span><br><span class="line">  // 省略其他代码</span><br><span class="line">  TextButton(</span><br><span class="line">    onPressed: () &#123;</span><br><span class="line">      var locale = Locale(&#x27;en&#x27;, &#x27;US&#x27;);</span><br><span class="line">      Get.updateLocale(locale);</span><br><span class="line">    &#125;,</span><br><span class="line">    child: Text(&#x27;name&#x27;.tr),</span><br><span class="line">  ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Messages extends Translations &#123;</span><br><span class="line">  @override</span><br><span class="line">  Map&lt;String, Map&lt;String, String&gt;&gt; get keys =&gt; &#123;</span><br><span class="line">        &#x27;en_US&#x27;: &#123;</span><br><span class="line">          &#x27;name&#x27;: &#x27;Island Coder&#x27;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x27;zh_CN&#x27;: &#123;</span><br><span class="line">          &#x27;name&#x27;: &#x27;岛上码农&#x27;,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  // This widget is the root of your application.</span><br><span class="line">  @override</span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    return GetMaterialApp(</span><br><span class="line">      translations: Messages(),</span><br><span class="line">      locale: Locale(&#x27;zh&#x27;, &#x27;CN&#x27;),</span><br><span class="line">      color: Colors.white,</span><br><span class="line">      navigatorKey: Get.key,</span><br><span class="line">      title: &#x27;Flutter Demo&#x27;,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">        brightness: Brightness.light,</span><br><span class="line">      ),</span><br><span class="line">      home: GetXDemo(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="getx-的理念"><a class="markdownIt-Anchor" href="#getx-的理念">#</a> <strong>GetX 的理念</strong></h2>
<p>GetX 有三个基本的理念，分别是性能、生产力和组织性（Organization）。</p>
<ul>
<li>性能（Performance）：GetX 关注性能并最小化资源消耗。GetX 不使用  <code>Stream</code>  或  <code>ChangeNotifier</code> 。</li>
<li>生产力（Productivity）：GetX 使用简洁愉悦的语法。不管你要做什么，使用 GetX 都会觉得简便。这使得开发的时间大大节省，并且保证应用性能的最大化。通常来说，开发者需要关注从内存中移除控制器。而使用 GetX 的时候，则无需这么做。当控制器不被使用的时候，资源会自动从内存中释放。如果确实需要常住内存，那就需要在依赖中声明  <code>permanent:true</code> 。通过这种方式，可以降低内存中有过多不必要依赖对象的风险。同时，依赖默认也是懒加载。</li>
<li>组织性（Organization）：GetX 可以将视图、展示逻辑、业务逻辑、依赖注入和导航完全解耦。路由之间跳转无需  <code>context</code> ，因此我们的导航不会依赖组件树。也不需要使用通过  <code>InheritedWidget</code>  的  <code>context</code>  访问控制器或 BLOC 对象，因此可以将展示逻辑和业务逻辑从虚拟的组件层分离。我们也不需要像 MultiProvider 那样往组件树中注入 Controller/Model/Bloc 等类对象。因此可以将依赖注入和视图分离。</li>
</ul>
<h2 id="getx-生态"><a class="markdownIt-Anchor" href="#getx-生态">#</a> <strong>GetX 生态</strong></h2>
<p>GetX 有很多特性，使得编码变得容易。每个特性之间是相互独立的，并且只会在使用的时候才启动。例如，如果仅仅是使用状态管理，那么只有状态管理会被编译。而如果只使用路由，那么状态管理的部分就不会编译。</p>
<p>GetX 有一个很大的生态，包括了大型的社区维护，大量的协作者（GitHub 上看有 132 位），并且承诺只要 Flutter 存在就会继续维护下去。而且 GetX 兼容 Android, iOS, Web, Mac, Linux, Windows 多个平台。GetX 甚至还有服务端版本 <strong><a href="https://link.zhihu.com/?target=https%3A//github.com/jonataslaw/get_server">Get_Server</a></strong>（感觉 Flutter 要一统程序员界啊，啥时候支持鸿蒙？）。</p>
<p>为了简化开发，GetX 还提供了脚手架工具 **<a href="https://link.zhihu.com/?target=https%3A//pub.flutter-io.cn/packages/get_cli">GET_CLI</a>** 和 VSCode 插件 <code>GetX Snippets</code> （也有 Android Studio 和 Intellij 插件）。提供了如下快速代码模板：</p>
<ul>
<li>
<p>getmain：GetX 的 main.dart 代码；</p>
</li>
<li>
<p>getmodel：Model 类代码，包括了 fromJson 和 toJson 方法</p>
</li>
<li>
<p>其他，输入 getxxxx 根据提示生成即可，具体参考：<strong><a href="https://link.zhihu.com/?target=https%3A//marketplace.visualstudio.com/items%3FitemName%3Dget-snippets.get-snippets">GetX Snippets 介绍</a></strong>。</p>
</li>
</ul>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> <strong>总结</strong></h2>
<p>本篇对 GetX 插件做了简单的介绍，可以看到 GetX 的生态确实很丰富，感觉是一个集大成者，GetX 基本上涵盖了 Flutter 应用开发的很大一部分，如路由、主题、多语言、弹层、状态管理、依赖注入、网络请求封装等等。GetX 看着像一个框架， 但实际上它的各个模块是独立的，其实是一个工具箱。对于开发的时候，可以用它的全家桶，也可以从中任取所需的模块到我们的应用中使用。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.512Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-02-27T04:19:01.000Z" title="2020/2/27 12:19:01">2020-02-27</time>更新</span><span class="level-item">9 分钟读完 (大约1416个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Docker%E3%80%91docker%E4%B8%AD%E8%AE%BE%E7%BD%AEelasticsearch%E3%80%81kibana%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E3%80%81%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/">docker中设置elasticsearch、kibana用户名密码、修改密码</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker中设置elasticsearch-kibana用户名密码-修改密码"><a class="markdownIt-Anchor" href="#docker中设置elasticsearch-kibana用户名密码-修改密码">#</a> docker 中设置 elasticsearch、kibana 用户名密码、修改密码</h1>
<h3 id=""><a class="markdownIt-Anchor" href="#">#</a> </h3>
<ul>
<li><a href="#_1">前言</a></li>
<li><a href="#elasticsearch_3">一、elasticsearch 设置密码</a></li>
<li>
<ul>
<li><a href="#_XPack_8">首先开启 X-Pack</a></li>
<li><a href="#_62">测试是否设置成功</a></li>
<li><a href="#_77">修改密码</a></li>
<li>
<ul>
<li><a href="#_78">已知密码修改</a></li>
<li><a href="#_107">忘记密码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kibanaelasticsearch_131">二、kibana 配置 elasticsearch 密码</a></li>
</ul>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p>之前在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020"> docker</a> 中安装过 elasticsearch 和 elasticsearchhead 以及 kibana 都没有配置密码，在此记录下设置过程。</p>
<h1 id="一-elasticsearch设置密码"><a class="markdownIt-Anchor" href="#一-elasticsearch设置密码">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=elasticsearch&amp;spm=1001.2101.3001.7020">elasticsearch</a> 设置密码</h1>
<p>参考 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-settings.html#token-service-settings">官方文档</a><br>
 xpack.security.enabled: true<br>
<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-api-change-password.html"> 设置引导性密码</a></p>
<blockquote>
<p>The setup-passwords tool is the simplest method to set the built-in users’ passwords for the first time. It uses the elastic user’s bootstrap password to run user management API requests. For example, you can run the command in an “interactive” mode, which prompts you to enter new passwords for the elastic, kibana, and logstash_system users:</p>
</blockquote>
<h2 id="首先开启-x-pack"><a class="markdownIt-Anchor" href="#首先开启-x-pack">#</a> 首先开启 X-Pack</h2>
<p>修改容器内或者修改挂载出来的 elasticsearch.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/elasticsearch/config/elasticsearch.yml		<span class="comment"># 挂载目录</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>elasticsearch.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;docker-cluster-01&quot;</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment"># 此处开启xpack</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<p>进入 docker 中的 elasticsearch 中，设置密码，执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/elasticsearch/bin/x-pack/setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>依次设置用户：elastic、apm_system、kibana_system、logstash_system、beats_system、remote_monitoring_user 共 6 个用户。<br>
内部用户<br>
 X-Pack 安全有三个内部用户（_system、_xpack 和_xpack_security），负责在 Elasticsearch 集群中进行的操作。</p>
<p>这些用户仅由源自集群内的请求使用。出于这个原因，它们不能用于对 API 进行身份验证，并且没有密码可以管理或重置。</p>
<p>有时，您可能会在日志中找到对这些用户之一的引用，包括审计日志。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved <span class="built_in">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line">Enter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Enter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Changed password <span class="keyword">for</span> user [apm_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana]</span><br><span class="line">Changed password <span class="keyword">for</span> user [logstash_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [beats_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [remote_monitoring_user]</span><br><span class="line">Changed password <span class="keyword">for</span> user [elastic]</span><br><span class="line">12345678910111213141516171819202122</span><br></pre></td></tr></table></figure>
<h2 id="测试是否设置成功"><a class="markdownIt-Anchor" href="#测试是否设置成功">#</a> 测试是否设置成功</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200</span><br></pre></td></tr></table></figure>
<p>结果显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-15-centos config]<span class="comment"># curl localhost:9200</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missi</span></span><br></pre></td></tr></table></figure>
<p>显示这个则设置成功。<br>
使用密码访问 elasticsearch 测试是否可以访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<p>就可以看到 elasticsearch 信息。</p>
<h2 id="修改密码"><a class="markdownIt-Anchor" href="#修改密码">#</a> 修改密码</h2>
<h3 id="已知密码修改"><a class="markdownIt-Anchor" href="#已知密码修改">#</a> 已知密码修改</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST _xpack/security/user/_password</span><br><span class="line">POST _xpack/security/user/&lt;username&gt;/_password</span><br><span class="line"><span class="comment"># 将用户elastic  密码改为elastic</span></span><br><span class="line">curl -u elastic -H <span class="string">&quot;Content-Type: application/json&quot;</span> -X POST <span class="string">&quot;localhost:9200/_xpack/security/user/elastic/_password&quot;</span> --data <span class="string">&#x27;&#123;&quot;password&quot;:&quot;elastic&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 测试是否修改成功</span></span><br><span class="line">curl localhost:9200 -u elastic</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>
<p>登录成功的结果展示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;384cda4775e5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster-01&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;SOH21TLnQdSZnJq0ZW2iDw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;6bc13727ce758c0e943c3c21653b3da82f627f75&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-09-15T10:18:09.722761972Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="忘记密码"><a class="markdownIt-Anchor" href="#忘记密码">#</a> 忘记密码</h3>
<p>创建本地超级账户，然后使用 api 接口本地超级账户重置 elastic 账户的密码</p>
<ol>
<li>停止 elasticsearch 服务</li>
<li>确保你的配置文件中支持本地账户认证支持，如果你使用的是 xpack 的默认配置则无需做特殊修改；如果你配置了其他认证方式则需要确保配置本地认证方式在 ES_HOME/config/elasticsearch.yml 中。</li>
<li>使用命令 ES_HOME/bin/x-pack/users 创建一个基于本地问价认证的超级管理员。</li>
<li>进入 docker 容器中 elasticsearch 中，执行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash</span><br><span class="line">bin/x-pack/users useradd test_admin -p test_password -r superuser</span><br></pre></td></tr></table></figure>
<ol>
<li>启动 elasticsearch 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<ol>
<li>通过 api 重置 elastic 超级管理员的密码</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u test_admin -XPUT  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> <span class="string">&#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27;</span> -d <span class="string">&#x27;&#123;&quot;password&quot; : &quot;新密码&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>校验下密码是否重置成功</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<h1 id="二-kibana配置elasticsearch密码"><a class="markdownIt-Anchor" href="#二-kibana配置elasticsearch密码">#</a> 二、kibana 配置 elasticsearch 密码</h1>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.16/settings.html">文档</a><br>
修改容器内或者修改挂载出来的 kibana.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it kibana /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/kibana/config/kibana.yml		<span class="comment"># 挂载目录</span></span><br></pre></td></tr></table></figure>
<p>kibana.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">server.shutdownTimeout:</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://172.17.0.3:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="comment"># 此处设置elastic的用户名和密码</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">elastic</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart kibana</span><br></pre></td></tr></table></figure>
<p>访问网址：<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f9ba8bb8f117485b8b8246d9d62599f8.png" alt="在这里插入图片描述"><br>
搞定！</p>
<blockquote>
<p>新手最近开始写文章，手敲不易，请多多支持！在此感谢每位读者 0.0</p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.510Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-01-27T00:47:58.000Z" title="2020/1/27 08:47:58">2020-01-27</time>更新</span><span class="level-item">8 分钟读完 (大约1236个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Java%E3%80%91CAS-ABA%E9%97%AE%E9%A2%98/">CAS-ABA问题</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="cas-aba问题"><a class="markdownIt-Anchor" href="#cas-aba问题">#</a> CAS-ABA 问题</h1>
<h2 id="一概述"><a class="markdownIt-Anchor" href="#一概述">#</a> 一。概述：</h2>
<p>​		ABA 问题是在多线程并发的情况下，发生的一种现象。上一次记录了有关 CAS 操作的一些知识，CAS 通过比较内存中的一个数据是否是预期值，如果是就将它修改成新值，如果不是则进行自旋，重复比较的操作，直到某一刻内存值等于预期值再进行修改。而 ABA 问题则是在 CAS 操作中存在的一个经典问题，这个问题某些时候不会带来任何影响，某些时候却是影响很大的。</p>
<h2 id="二什么是aba问题"><a class="markdownIt-Anchor" href="#二什么是aba问题">#</a> 二。什么是 ABA 问题？</h2>
<h4 id="理解一"><a class="markdownIt-Anchor" href="#理解一">#</a> 理解一：</h4>
<p>​		当执行 campare and swap 会出现失败的情况。例如，一个线程先读取共享内存数据值 A，随后因某种原因，线程暂时挂起，同时另一个线程临时将共享内存数据值先改为 B，随后又改回为 A。随后挂起线程恢复，并通过 CAS 比较，最终比较结果将会无变化。这样会通过检查，这就是 ABA 问题。 在 CAS 比较前会读取原始数据，随后进行原子 CAS 操作。这个间隙之间由于并发操作，最终可能会带来问题。</p>
<h4 id="理解二"><a class="markdownIt-Anchor" href="#理解二">#</a> <strong>理解二:</strong></h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20181231131658183.png" alt=""></p>
<p>“ABA” 问题：假设 t1 线程工作时间为 10 秒，t2 线程工作时间为 2 秒，那么可能在 A 的工作期间，主内存中的共享变量 A 已经被 t2 线程修改了多次，只是恰好最后一次修改的值是该变量的初始值，虽然用 CAS 判定出来的结果是期望值，但是却不是原来那个了 =======》“狸猫换太子”<br>
 相当于是只关心共享变量的起始值和结束值，而不关心过程中共享变量是否被其他线程动过。<br>
有些业务可能不需要关心中间过程，只要前后值一样就行，但是有些业务需求要求变量在中间过程不能被修改。</p>
<p>只靠 CAS 无法保证 ABA 问题，需要使用 “原子引用” 才能解决！！！！</p>
<h1 id="三aba问题的解决"><a class="markdownIt-Anchor" href="#三aba问题的解决">#</a> 三.ABA 问题的解决：</h1>
<h2 id="原子引用存在aba问题"><a class="markdownIt-Anchor" href="#原子引用存在aba问题">#</a> 原子引用：（存在 ABA 问题）</h2>
<p>案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">package</span> InterviewTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">	 String name;</span><br><span class="line">	 <span class="type">int</span> age;</span><br><span class="line">	 </span><br><span class="line">	 <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name,<span class="type">int</span> age)</span> &#123;</span><br><span class="line">		 <span class="built_in">this</span>.name=name;</span><br><span class="line">		 <span class="built_in">this</span>.age=age;</span><br><span class="line">	 &#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;User [name=&quot;</span> + name + <span class="string">&quot;, age=&quot;</span> + age + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicReferenceDemo</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		<span class="type">User</span> <span class="variable">z3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;z3&quot;</span>,<span class="number">25</span>);</span><br><span class="line">		<span class="type">User</span> <span class="variable">li4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;li4&quot;</span>,<span class="number">25</span>);</span><br><span class="line">		AtomicReference&lt;User&gt; atomicReference  = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">		atomicReference.set(z3);</span><br><span class="line">		System.out.println(atomicReference);</span><br><span class="line">		System.out.println(atomicReference.compareAndSet(z3, li4)+</span><br><span class="line">							<span class="string">&quot;       &quot;</span>+atomicReference.get().toString());</span><br><span class="line">		System.out.println(atomicReference.compareAndSet(li4, z3)+</span><br><span class="line">				<span class="string">&quot;       &quot;</span>+atomicReference.get().toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="带版本号的原子引用解决aba问题"><a class="markdownIt-Anchor" href="#带版本号的原子引用解决aba问题">#</a> 带版本号的原子引用（解决 ABA 问题）</h2>
<p><strong>AtomicStampedReference 版本号原子引用：</strong><br>
<strong>案例：两种原子引用的对比</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> InterviewTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ABADemo</span> &#123;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> AtomicReference&lt;Integer&gt; atomicReference </span><br><span class="line">									= <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;(<span class="number">100</span>);</span><br><span class="line">	<span class="keyword">static</span> AtomicStampedReference&lt;Integer&gt;  atomicStampedReference </span><br><span class="line">									= <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;************以下是ABA问题的产生**************&quot;</span>);</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">101</span>);</span><br><span class="line">			atomicReference.compareAndSet(<span class="number">101</span>, <span class="number">100</span>);</span><br><span class="line">		&#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			System.out.println(atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">2019</span>)</span><br><span class="line">					+<span class="string">&quot;   &quot;</span>+atomicReference.get());</span><br><span class="line">		&#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">&quot;************以下是ABA问题的解决**************&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">					+<span class="string">&quot;  &quot;</span>+<span class="string">&quot;   第一次版本号：&quot;</span>+stamp);</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			atomicStampedReference.compareAndSet(<span class="number">100</span>, </span><br><span class="line">										<span class="number">101</span>, </span><br><span class="line">										atomicStampedReference.getStamp(),</span><br><span class="line">										atomicStampedReference.getStamp()+<span class="number">1</span>);</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">					+<span class="string">&quot;  &quot;</span>+<span class="string">&quot;   第2次版本号：&quot;</span>+atomicStampedReference.getStamp());</span><br><span class="line">			atomicStampedReference.compareAndSet(<span class="number">101</span>, </span><br><span class="line">					<span class="number">100</span>, </span><br><span class="line">					atomicStampedReference.getStamp(),</span><br><span class="line">					atomicStampedReference.getStamp()+<span class="number">1</span>);</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">					+<span class="string">&quot;  &quot;</span>+<span class="string">&quot;   第3次版本号：&quot;</span>+atomicStampedReference.getStamp());</span><br><span class="line">			</span><br><span class="line">		&#125;,<span class="string">&quot;t3&quot;</span>).start();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">			<span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicStampedReference.getStamp();</span><br><span class="line">			System.out.println(Thread.currentThread().getName()</span><br><span class="line">					+<span class="string">&quot;  &quot;</span>+<span class="string">&quot;   第一次版本号：&quot;</span>+stamp);</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span>  atomicStampedReference.compareAndSet(</span><br><span class="line">					<span class="number">100</span>, </span><br><span class="line">					<span class="number">2019</span>, </span><br><span class="line">					stamp, </span><br><span class="line">					stamp+<span class="number">1</span>);</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+</span><br><span class="line">					<span class="string">&quot;  修改成功否：&quot;</span>+result+<span class="string">&quot;  当前最新实际版本号：&quot;</span></span><br><span class="line">					+atomicStampedReference.getStamp());</span><br><span class="line">			System.out.println(Thread.currentThread().getName()+</span><br><span class="line">					<span class="string">&quot;  当前实际最新值：&quot;</span></span><br><span class="line">					+atomicStampedReference.getReference());</span><br><span class="line">			</span><br><span class="line">		&#125;,<span class="string">&quot;t4&quot;</span>).start();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出:</span><br><span class="line">************以下是ABA问题的产生**************</span><br><span class="line"><span class="literal">true</span>   <span class="number">2019</span></span><br><span class="line">************以下是ABA问题的解决**************</span><br><span class="line">t3     第一次版本号：<span class="number">1</span></span><br><span class="line">t4     第一次版本号：<span class="number">1</span></span><br><span class="line">t3     第<span class="number">2</span>次版本号：<span class="number">2</span></span><br><span class="line">t3     第<span class="number">3</span>次版本号：<span class="number">3</span></span><br><span class="line">t4  修改成功否：<span class="literal">false</span>  当前最新实际版本号：<span class="number">3</span></span><br><span class="line">t4  当前实际最新值：<span class="number">100</span></span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.507Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-01-24T15:10:51.000Z" title="2020/1/24 23:10:51">2020-01-24</time>更新</span><span class="level-item">10 分钟读完 (大约1470个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Docker%E3%80%91Docker%E5%AE%89%E8%A3%85Jenkins/">Docker安装Jenkins</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker安装jenkins"><a class="markdownIt-Anchor" href="#docker安装jenkins">#</a> Docker 安装 Jenkins</h1>
<h1 id="一-前言"><a class="markdownIt-Anchor" href="#一-前言">#</a> 一、前言</h1>
<h2 id="1-领头羊"><a class="markdownIt-Anchor" href="#1-领头羊">#</a> 1、领头羊</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">作为领先的开源自动化服务器，Jenkins 提供了数百个插件来支持构建、部署和自动化任何项目。</span><br></pre></td></tr></table></figure>
<h2 id="2-特点"><a class="markdownIt-Anchor" href="#2-特点">#</a> 2、特点</h2>
<ul>
<li>持续集成和持续交付：作为可扩展的自动化服务器，Jenkins 可以用作简单的 CI 服务器或变成任何项目的持续交付中心。</li>
<li>简易安装：Jenkins 是一个独立的基于 Java 的程序，可以开箱即用，包含适用于 Windows、Linux、macOS 和其他类 Unix 操作系统的软件包。</li>
<li>易于配置：Jenkins 可以通过其 Web 界面轻松设置和配置，其中包括即时错误检查和内置帮助。</li>
<li>插件：凭借更新中心的数百个插件，Jenkins 与持续集成和持续交付工具链中的几乎所有工具集成。</li>
<li>可扩展：Jenkins 可以通过其插件架构进行扩展，为 Jenkins 可以做的事情提供几乎无限的可能性。</li>
<li>分散式：Jenkins 可以轻松地在多台机器上分配工作，帮助更快地跨多个平台推动构建、测试和部署。</li>
</ul>
<h1 id="二-docker安装jenkins"><a class="markdownIt-Anchor" href="#二-docker安装jenkins">#</a> 二、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Docker%E5%AE%89%E8%A3%85Jenkins&amp;spm=1001.2101.3001.7020">Docker 安装 Jenkins</a></h1>
<h2 id="1-docker-search-jenkins查询镜像"><a class="markdownIt-Anchor" href="#1-docker-search-jenkins查询镜像">#</a> 1、docker search jenkins 查询镜像</h2>
<h3 id="11-正常查询结果"><a class="markdownIt-Anchor" href="#11-正常查询结果">#</a> 1.1、正常查询结果</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search jenkins</span><br><span class="line">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">jenkins                            DEPRECATED; use &quot;jenkins/jenkins:lts&quot; instead   5504                [OK]                </span><br><span class="line">jenkins/jenkins                    The leading open source automation server       3087                                    </span><br><span class="line">jenkins/jnlp-slave                 a Jenkins agent which can connect to Jenkins…   150                                     [OK]</span><br><span class="line">jenkins/inbound-agent                                                              65                                      </span><br><span class="line">bitnami/jenkins                    Bitnami Docker Image for Jenkins                53                                      [OK]</span><br><span class="line">jenkins/slave                      base image for a Jenkins Agent, which includ…   48                                      [OK]</span><br><span class="line">jenkins/agent                                                                      39                                      </span><br><span class="line">jenkins/ssh-slave                  A Jenkins slave using SSH to establish conne…   38                                      [OK]</span><br><span class="line">jenkins/ssh-agent                  Docker image for Jenkins agents connected ov…   24                                      </span><br><span class="line">jenkins/jnlp-agent-docker                                                          8                                       </span><br><span class="line">jenkins/jnlp-agent-maven           A JNLP-based agent with Maven 3 built in        7                                       </span><br><span class="line">jenkins/pct                        Plugin Compat Tester                            5                                       [OK]</span><br><span class="line">jenkins/jenkins-experimental       Experimental images of Jenkins. These images…   3                                       [OK]</span><br><span class="line">jenkins/jnlp-agent-python          A JNLP-based agent with Python built in         3                                       </span><br><span class="line">jenkins/jnlp-agent-alpine                                                          2                                       </span><br><span class="line">jenkins/jnlp-agent-node                                                            1                                       </span><br><span class="line">rancher/jenkins-jenkins                                                            1                                       </span><br><span class="line">jenkins/ath                        Jenkins Acceptance Test Harness                 1                                       [OK]</span><br><span class="line">jenkins/core-changelog-generator   Tool for generating Jenkins core changelogs     1                                       </span><br><span class="line">jenkins/jenkinsfile-runner         Jenkinsfile Runner packages                     1                                       </span><br><span class="line">jenkins/core-pr-tester             Docker image for testing pull-requests sent …   1                                       </span><br><span class="line">jenkins/jnlp-agent-ruby                                                            1                                       </span><br><span class="line">jenkins/remoting-kafka-agent       Remoting Kafka Agent                            1                                       [OK]</span><br><span class="line">rancher/jenkins-jnlp-slave                                                         0                                       </span><br><span class="line">rancher/jenkins-slave              Jenkins Build Slave                             0                                       [OK]</span><br><span class="line">[root@localhost ~]# ^C</span><br><span class="line">[root@localhost ~]# </span><br></pre></td></tr></table></figure>
<h3 id="12-可能异常情况这个异常解决方法为下面第2点"><a class="markdownIt-Anchor" href="#12-可能异常情况这个异常解决方法为下面第2点">#</a> 1.2、可能异常情况，这个异常解决方法为下面第 2 点</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/07f347955491462592d6f37cc2394fc6.png" alt="img"></p>
<h2 id="2-上面报这个error解决方法"><a class="markdownIt-Anchor" href="#2-上面报这个error解决方法">#</a> 2、上面报这个 ERROR 解决方法</h2>
<h3 id="21-更新时间同步即可ntpdate-cnpoolntporg"><a class="markdownIt-Anchor" href="#21-更新时间同步即可ntpdate-cnpoolntporg">#</a> 2.1、更新<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&amp;spm=1001.2101.3001.7020">时间同步</a>即可：ntpdate <a target="_blank" rel="noopener" href="http://cn.pool.ntp.org">cn.pool.ntp.org</a></h3>
<h3 id="22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate"><a class="markdownIt-Anchor" href="#22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate">#</a> 2.2、如果提示不存在 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ntpdate&amp;spm=1001.2101.3001.7020">ntpdate</a> 命令需要先安装该命令：yum install ntpdate</h3>
<h3 id="23-date中国时间"><a class="markdownIt-Anchor" href="#23-date中国时间">#</a> 2.3、date 中国时间</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/315167c9692b4ebbad480fdffdf439c0.png" alt="img"></p>
<h2 id="3-docker-pull-jenkinsciblueocean拉取jenkins镜像"><a class="markdownIt-Anchor" href="#3-docker-pull-jenkinsciblueocean拉取jenkins镜像">#</a> 3、****docker pull jenkinsci/blueocean**** 拉取 Jenkins 镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1ef511da220c4ca4bca8143aa55c9e52.png" alt="img"></p>
<h2 id="4-docker-images-查看本地镜像"><a class="markdownIt-Anchor" href="#4-docker-images-查看本地镜像">#</a> 4、docker images 查看本地镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d9690427ee344603ac96cfa1a6a5510c.png" alt="img"></p>
<h2 id="5-centos7安装jdk安装-已有jdk可以跳过"><a class="markdownIt-Anchor" href="#5-centos7安装jdk安装-已有jdk可以跳过">#</a> 5、CentOS7 安装 JDK 安装 已有 JDK 可以跳过</h2>
<h3 id="51-可以下载linux版本targz压缩包到本地不用解压"><a class="markdownIt-Anchor" href="#51-可以下载linux版本targz压缩包到本地不用解压">#</a> 5.1、可以下载 linux 版本 tar.gz 压缩包到本地不用解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b413890d2adc4b8ea27f016d215c14e7.png" alt="img"></p>
<h3 id="52-cd-usr-mkdir-java进入usr创建java文件夹"><a class="markdownIt-Anchor" href="#52-cd-usr-mkdir-java进入usr创建java文件夹">#</a> 5.2、****cd /usr, mkdir java**** 进入 usr 创建 java 文件夹</h3>
<h3 id="53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里"><a class="markdownIt-Anchor" href="#53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里">#</a> 5.3、****cd java*<em><strong> 进入 java 文件夹，用</strong></em> * rz**** 将 linux 版的 jdk 压缩包上传到这里</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/32e9bd440462402a80f0aa6a0ef32a18.png" alt="img"></p>
<h3 id="54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令"><a class="markdownIt-Anchor" href="#54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令">#</a> 5.4、(将 JDK 移到 java，mv jdk-8u301-linux-x64.tar.gz/usr/java) 移动文件命令</h3>
<h3 id="55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现"><a class="markdownIt-Anchor" href="#55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现">#</a> 5.5、<em><strong>*tar*</strong></em> <em><strong>*-*</strong></em><em><strong>*zxvf*</strong></em> jdk-8u301-linux-x64.tar.gz，解压会有 jdk1.8.0_301 出现</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/100d06f1ce4e4ee7b4b209cbf37491db.png" alt="img"></p>
<h3 id="56-vi-etcprofile配置linux系统jdk环境变量"><a class="markdownIt-Anchor" href="#56-vi-etcprofile配置linux系统jdk环境变量">#</a> 5.6、****vi /etc/profile**** 配置 linux 系统 JDK 环境变量</h3>
<p><strong>1) 配置内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_301</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br></pre></td></tr></table></figure>
<h3 id="57-source-etcprofile使配置生效"><a class="markdownIt-Anchor" href="#57-source-etcprofile使配置生效">#</a> 5.7、****source /etc/profile**** 使配置生效</h3>
<h3 id="58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到"><a class="markdownIt-Anchor" href="#58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到">#</a> 5.8、<em><strong>*sudo yum install glibc.i686*</strong></em>，可能报错解决方案、否则会会报找不到</h3>
<h3 id="59-java-version测试出现如下即为成功"><a class="markdownIt-Anchor" href="#59-java-version测试出现如下即为成功">#</a> 5.9、****java -version**** 测试，出现如下即为成功</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f3cca3db43c84bf79be1bfa8282c4ba9.png" alt="img"></p>
<h2 id="6-centos7安装maven"><a class="markdownIt-Anchor" href="#6-centos7安装maven">#</a> 6、CentOS7 安装 Maven</h2>
<h3 id="61-cd-usrlocal"><a class="markdownIt-Anchor" href="#61-cd-usrlocal">#</a> 6.1、<em><strong>*cd /usr/local*</strong></em></h3>
<h3 id="62-rz上传tar-zxvf-apache-maven-361-bintargz解压"><a class="markdownIt-Anchor" href="#62-rz上传tar-zxvf-apache-maven-361-bintargz解压">#</a> 6.2、****rz*<em><strong> 上传，</strong></em>*tar -zxvf apache-maven-3.6.1-bin.tar.gz**** 解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1055aa0df0184f6bb28bde13fed60bc5.png" alt="img"></p>
<h3 id="63-vi-etcprofile"><a class="markdownIt-Anchor" href="#63-vi-etcprofile">#</a> 6.3、<em><strong>*vi /etc/profile*</strong></em></h3>
<h3 id="64-source-etcprofile刷新环境变量"><a class="markdownIt-Anchor" href="#64-source-etcprofile刷新环境变量">#</a> 6.4、****source /etc/profile**** 刷新环境变量</h3>
<h3 id="65-mvn-v查看版本"><a class="markdownIt-Anchor" href="#65-mvn-v查看版本">#</a> 6.5、****mvn -v**** 查看版本</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost local]# mvn -v</span><br><span class="line">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">Maven home: /usr/local/apache-maven-3.6.3</span><br><span class="line">Java version: 1.8.0_301, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_301/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-1127.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line">[root@localhost local]# </span><br></pre></td></tr></table></figure>
<p>到此 JDK、Maven 环境准备完成</p>
<h2 id="7-启动容器并挂载上面配置的环境"><a class="markdownIt-Anchor" href="#7-启动容器并挂载上面配置的环境">#</a> 7、<em><strong>* 启动容器，并 *</strong></em><em><strong>* 挂载上面配置的环境 *</strong></em></h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-u root \</span><br><span class="line">-d \</span><br><span class="line">--restart=always \</span><br><span class="line">-p 8001:8080 \</span><br><span class="line">-p 50000:50000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/172131aa0a9f47b3a15e5bd5d4555986.png" alt="img"></p>
<h2 id="9-访问jenkins提示输入密码"><a class="markdownIt-Anchor" href="#9-访问jenkins提示输入密码">#</a> 9、访问 Jenkins，提示输入密码</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2b6d909e4c4e46efaa98216f1c33fdf7.png" alt="img"></p>
<h2 id="10-初次可以选择推荐的"><a class="markdownIt-Anchor" href="#10-初次可以选择推荐的">#</a> 10、初次可以选择推荐的</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5e9a6ebdd6954093bf6a23f4f876221a.png" alt="img"></p>
<h2 id="11-等待安装"><a class="markdownIt-Anchor" href="#11-等待安装">#</a> 11、 <strong>等待安装</strong></h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/25caae9dae8b49878adca5e32647e915.png" alt="img"></p>
<h2 id="12-如下访问jenkins成功啦"><a class="markdownIt-Anchor" href="#12-如下访问jenkins成功啦">#</a> 12、如下访问 Jenkins 成功啦</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4beeeb654aec4e608a22ce6b49afa1ae.png" alt="img"></p>
<p>到此就结束 Docker 安装 Jenkins 啦，后面的章节将介绍如何配置 jenkins，敬请期待！</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-26T01:40:26.504Z" title="2023/4/26 09:40:26">2023-04-26</time>发表</span><span class="level-item"><time dateTime="2020-01-20T09:09:51.000Z" title="2020/1/20 17:09:51">2020-01-20</time>更新</span><span class="level-item">13 分钟读完 (大约1894个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/26/%E3%80%90Flutter%E3%80%91Flutter%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E6%A1%86%E6%9E%B6%EF%BC%9ABloc%E7%9A%84%E8%AE%A1%E6%95%B0%E5%99%A8%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B/">【Flutter】Flutter状态管理框架：Bloc的计数器应用示例</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="flutterflutter状态管理框架bloc的计数器应用示例"><a class="markdownIt-Anchor" href="#flutterflutter状态管理框架bloc的计数器应用示例">#</a> 【Flutter】Flutter 状态管理框架：Bloc 的计数器应用示例</h1>
<h1 id="flutter-计数器教程"><a class="markdownIt-Anchor" href="#flutter-计数器教程">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=flutter-%E8%AE%A1%E6%95%B0%E5%99%A8%E6%95%99%E7%A8%8B">Flutter 计数器教程</a></h1>
<p><img src="https://img.shields.io/badge/level-beginner-green.svg" alt="beginner"></p>
<blockquote>
<p>在下面的教程中，我们会使用 Flutter 和 Bloc 库来开发一个计数器应用。</p>
</blockquote>
<p><img src="https://bloclibrary.dev/assets/gifs/flutter_counter.gif" alt="demo"></p>
<h2 id="核心要点"><a class="markdownIt-Anchor" href="#核心要点">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9">核心要点</a></h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/coreconcepts?id=blocobserver">BlocObserver</a>：用于观察 Bloc 内状态变化的 Widget。</li>
<li><a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/flutterbloccoreconcepts?id=blocprovider">BlocProvider</a>：为它的 children 提供 Bloc 的 Widget。</li>
<li><a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/flutterbloccoreconcepts?id=blocbuilder">BlocBuilder</a>：根据新的 state 来绘制对应 Widget 的 Widget。</li>
<li>用 Cubit 替代 Bloc。<a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/coreconcepts?id=cubit-vs-bloc">两者有何不同？</a></li>
<li>通过 <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/migration?id=%E2%9D%97contextbloc-and-contextrepository-are-deprecated-in-favor-of-contextread-and-contextwatch">context.read</a> 来触发 Event⚡。</li>
</ul>
<h2 id="新建项目和配置文件yaml"><a class="markdownIt-Anchor" href="#新建项目和配置文件yaml">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6yaml">新建项目和配置文件 yaml</a></h2>
<p>我们先新建一个全新的 flutter 应用</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter create flutter_counter</span><br></pre></td></tr></table></figure>
<p>将下面代码复制粘贴到  <code>pubspec.yaml</code>  文件中</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">flutter_counter</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">A</span> <span class="string">new</span> <span class="string">Flutter</span> <span class="string">project.</span></span><br><span class="line"><span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span><span class="string">+1</span></span><br><span class="line"><span class="attr">publish_to:</span> <span class="string">none</span></span><br><span class="line"></span><br><span class="line"><span class="attr">environment:</span></span><br><span class="line">  <span class="attr">sdk:</span> <span class="string">&quot;&gt;=2.19.0 &lt;3.0.0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dependencies:</span></span><br><span class="line">  <span class="attr">bloc:</span> <span class="string">^8.1.0</span></span><br><span class="line">  <span class="attr">flutter:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">  <span class="attr">flutter_bloc:</span> <span class="string">^8.1.1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dev_dependencies:</span></span><br><span class="line">  <span class="attr">bloc_test:</span> <span class="string">^9.1.0</span></span><br><span class="line">  <span class="attr">flutter_test:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">  <span class="attr">integration_test:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">  <span class="attr">mocktail:</span> <span class="string">^0.3.0</span></span><br><span class="line">  <span class="attr">very_good_analysis:</span> <span class="string">^3.1.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">flutter:</span></span><br><span class="line">  <span class="attr">uses-material-design:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安装依赖包 package</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter packages get</span><br></pre></td></tr></table></figure>
<h2 id="项目架构"><a class="markdownIt-Anchor" href="#项目架构">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84">项目架构</a></h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── lib</span><br><span class="line">│   ├── app.dart</span><br><span class="line">│   ├── counter</span><br><span class="line">│   │   ├── counter.dart</span><br><span class="line">│   │   ├── cubit</span><br><span class="line">│   │   │   └── counter_cubit.dart</span><br><span class="line">│   │   └── view</span><br><span class="line">│   │       ├── counter_page.dart</span><br><span class="line">│   │       └── counter_view.dart</span><br><span class="line">│   ├── counter_observer.dart</span><br><span class="line">│   └── main.dart</span><br><span class="line">├── pubspec.lock</span><br><span class="line">├── pubspec.yaml</span><br></pre></td></tr></table></figure>
<p>这个应用中我们使用的是功能驱动（feature-driven）的项目结构。这种项目结构可以让我们通过一个个独立的功能来扩展项目。在当前项目中，我们只需要做一个功能（也就是计数器），但是在将来我们可以通过加入更多功能来实现一个复杂的应用。</p>
<h2 id="blocobserver"><a class="markdownIt-Anchor" href="#blocobserver">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=blocobserver">BlocObserver</a></h2>
<p>首先，我们需要了解如何创建一个 <code>BlocObserver</code>  ， 它将帮助我们观察应用中所有的状态变化.</p>
<p>创建文件  <code>lib/counter_observer.dart</code> :</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:bloc/bloc.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">&#123;@template counter<span class="emphasis">_observer&#125;</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">[BlocObserver] for the counter application which</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">observes all state changes.</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@endtemplate&#125;</span></span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterObserver</span> <span class="keyword">extends</span> <span class="title">BlocObserver</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@macro counter_</span>observer&#125;</span></span></span><br><span class="line">  <span class="keyword">const</span> CounterObserver();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onChange(BlocBase&lt;<span class="built_in">dynamic</span>&gt; bloc, Change&lt;<span class="built_in">dynamic</span>&gt; change) &#123;</span><br><span class="line">    <span class="keyword">super</span>.onChange(bloc, change);</span><br><span class="line">    <span class="comment">// ignore: avoid_print</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;<span class="subst">$&#123;bloc.runtimeType&#125;</span> <span class="subst">$change</span>&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在这个文件中，我们只重写了  <code>onChange</code> ，用来查看所有产生的状态（state）变化</p>
<p><strong>注意</strong>:  <code>onChange</code>  在  <code>Bloc</code>  和  <code>Cubit</code>  中发挥的作用是相同的。</p>
<h2 id="maindart"><a class="markdownIt-Anchor" href="#maindart">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=maindart">main.dart</a></h2>
<p>接下来，用下面的代码替换 <code>main.dart</code>  里面的内容:</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:bloc/bloc.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/widgets.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_counter/app.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_counter/counter_observer.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  Bloc.observer = <span class="keyword">const</span> CounterObserver();</span><br><span class="line">  runApp(<span class="keyword">const</span> CounterApp());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们初始化了之前创建的  <code>CounterObserver</code>  并且通过  <code>runApp</code>  调用我们即将创建的 <code>CounterApp</code> 。</p>
<h2 id="counter-app"><a class="markdownIt-Anchor" href="#counter-app">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=counter-app">Counter App</a></h2>
<p>创建  <code>lib/app.dart</code> :</p>
<p><code>CounterApp</code>  是一个 <code>home</code>  是 <code>CounterPage</code>  的 <code>MaterialApp</code> 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_counter/counter/counter.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">&#123;@template counter<span class="emphasis">_app&#125;</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">A [MaterialApp] which sets the `home` to [CounterPage].</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@endtemplate&#125;</span></span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterApp</span> <span class="keyword">extends</span> <span class="title">MaterialApp</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@macro counter_</span>app&#125;</span></span></span><br><span class="line">  <span class="keyword">const</span> CounterApp(&#123;<span class="keyword">super</span>.key&#125;) : <span class="keyword">super</span>(home: <span class="keyword">const</span> CounterPage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>:  <code>CounterApp</code>  扩展（extends) 自 <code>MaterialApp</code> ，所以在这里它是一个 <code>MaterialApp</code> 。 在大多数的情况下，我们会创建一个 <code>StatelessWidget</code>  或者  <code>StatefulWidget</code>  实例，并且通过 <code>build</code>  来绘制 Widget。但是现在我们并不需要绘制任何 Widget，所以我们直接从 <code>MaterialApp</code>  进行扩展（extends)，这样更简单。</p>
<p>接下来，让我们来看下  <code>CounterPage</code> !</p>
<h2 id="counter-page"><a class="markdownIt-Anchor" href="#counter-page">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=counter-page">Counter Page</a></h2>
<p>创建  <code>lib/counter/view/counter_page.dart</code> :</p>
<p><code>CounterPage</code>  是用来创建一个  <code>CounterCubit</code>  实例 (也就是接下来我们要创建的类的实例) 并把它提供给  <code>CounterView</code>  使用。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_bloc/flutter_bloc.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_counter/counter/counter.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">&#123;@template counter<span class="emphasis">_page&#125;</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">A [StatelessWidget] which is responsible for providing a</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">[CounterCubit] instance to the [CounterView].</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@endtemplate&#125;</span></span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@macro counter_</span>page&#125;</span></span></span><br><span class="line">  <span class="keyword">const</span> CounterPage(&#123;<span class="keyword">super</span>.key&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> BlocProvider(</span><br><span class="line">      create: (_) =&gt; CounterCubit(),</span><br><span class="line">      child: <span class="keyword">const</span> CounterView(),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：分离（或者解耦） <code>Cubit</code>  创建部分的代码和  <code>Cubit</code>  使用部分的代码是非常重要的。这样使得代码更容易被测试或者被重复使用。</p>
<h2 id="counter-cubit"><a class="markdownIt-Anchor" href="#counter-cubit">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=counter-cubit">Counter Cubit</a></h2>
<p>创建  <code>lib/counter/cubit/counter_cubit.dart</code> :</p>
<p><code>CounterCubit</code>  类将提供两种方法:</p>
<ul>
<li><code>increment</code> : 给当前状态（state）加 1</li>
<li><code>decrement</code> : 给当前状态（state）减 1</li>
</ul>
<p>设置  <code>CounterCubit</code>  状态的数据类型为  <code>int</code> ， 初始值是  <code>0</code> 。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:bloc/bloc.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">&#123;@template counter<span class="emphasis">_cubit&#125;</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">A [Cubit] which manages an [int] as its state.</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@endtemplate&#125;</span></span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterCubit</span> <span class="keyword">extends</span> <span class="title">Cubit</span>&lt;<span class="title">int</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@macro counter_</span>cubit&#125;</span></span></span><br><span class="line">  CounterCubit() : <span class="keyword">super</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">Add 1 to the current state.</span></span></span><br><span class="line">  <span class="keyword">void</span> increment() =&gt; emit(state + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">Subtract 1 from the current state.</span></span></span><br><span class="line">  <span class="keyword">void</span> decrement() =&gt; emit(state - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>小贴士</strong>：可以使用 <a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=FelixAngelov.bloc">VSCode Extension</a> 或者 <a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/12129-bloc">IntelliJ Plugin</a> 自动创建新的 Cubit。</p>
<p>接下来我们来写 <code>CounterView</code> ，它将使用 state 并且和 <code>CounterCubit</code>  交互。</p>
<h2 id="counter-view"><a class="markdownIt-Anchor" href="#counter-view">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=counter-view">Counter View</a></h2>
<p>创建  <code>lib/counter/view/counter_view.dart</code> :</p>
<p><code>CounterView</code>  是用来绘制计数器上的数字以及两个用于增加和减少数字的 FloatingActionButtons。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_bloc/flutter_bloc.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_counter/counter/counter.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">&#123;@template counter<span class="emphasis">_view&#125;</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">A [StatelessWidget] which reacts to the provided</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">[CounterCubit] state and notifies it in response to user input.</span></span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@endtemplate&#125;</span></span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CounterView</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown"><span class="emphasis">&#123;@macro counter_</span>view&#125;</span></span></span><br><span class="line">  <span class="keyword">const</span> CounterView(&#123;<span class="keyword">super</span>.key&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">final</span> textTheme = Theme.of(context).textTheme;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(title: <span class="keyword">const</span> Text(<span class="string">&#x27;Counter&#x27;</span>)),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: BlocBuilder&lt;CounterCubit, <span class="built_in">int</span>&gt;(</span><br><span class="line">          builder: (context, state) &#123;</span><br><span class="line">            <span class="keyword">return</span> Text(<span class="string">&#x27;<span class="subst">$state</span>&#x27;</span>, style: textTheme.displayMedium);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      floatingActionButton: Column(</span><br><span class="line">        mainAxisAlignment: MainAxisAlignment.end,</span><br><span class="line">        crossAxisAlignment: CrossAxisAlignment.end,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            key: <span class="keyword">const</span> Key(<span class="string">&#x27;counterView_increment_floatingActionButton&#x27;</span>),</span><br><span class="line">            child: <span class="keyword">const</span> Icon(Icons.add),</span><br><span class="line">            onPressed: () =&gt; context.read&lt;CounterCubit&gt;().increment(),</span><br><span class="line">          ),</span><br><span class="line">          <span class="keyword">const</span> SizedBox(height: <span class="number">8</span>),</span><br><span class="line">          FloatingActionButton(</span><br><span class="line">            key: <span class="keyword">const</span> Key(<span class="string">&#x27;counterView_decrement_floatingActionButton&#x27;</span>),</span><br><span class="line">            child: <span class="keyword">const</span> Icon(Icons.remove),</span><br><span class="line">            onPressed: () =&gt; context.read&lt;CounterCubit&gt;().decrement(),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>用 <code>BlocBuilder</code>  把  <code>Text</code>  包起来，这样每一次 <code>CounterCubit</code>  状态变化的时候里面的文字就会更新。 另外，使用 <code>context.read&lt;CounterCubit&gt;()</code>  来接入 <code>CounterCubit</code>  实例。</p>
<p><strong>注意</strong>：只有  <code>Text</code>  需要被  <code>BlocBuilder</code>  包起来，因为这是唯一一个会随着  <code>CounterCubit</code>  状态（state) 变化而变化的组件。请不要包裹任何不随状态（state) 改变而改变的 Widget， 从而避免绘制不必要的组件。</p>
<h2 id="barrel"><a class="markdownIt-Anchor" href="#barrel">#</a> <a target="_blank" rel="noopener" href="https://bloclibrary.dev/#/zh-cn/fluttercountertutorial?id=barrel">Barrel</a></h2>
<p>创建  <code>lib/counter/counter.dart</code> :</p>
<p>加入  <code>counter.dart</code>  用来导出所有有关计数器的公共接口。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="string">&#x27;cubit/counter_cubit.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="string">&#x27;view/view.dart&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>大功告成！我们已经将表现层（presentation layer）从数据逻辑层（business logic layer）中分离出来。 <code>CounterView</code>  不会知道用户点击按钮的时候发生了什么，它只是通知了  <code>CounterCubit</code> 。 而且，  <code>CounterCubit</code>  不会知道状态（也就是计数器的值）是什么， 它只是根据被调用的方法来发出新的状态。</p>
<p>最后，通过执行  <code>flutter run</code>  让我们在真实设备或者模拟器上运行它。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/9/">上一页</a></div><div class="pagination-next"><a href="/page/11/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/9/">9</a></li><li><a class="pagination-link is-current" href="/page/10/">10</a></li><li><a class="pagination-link" href="/page/11/">11</a></li><li><a class="pagination-link" href="/page/12/">12</a></li><li><a class="pagination-link" href="/page/13/">13</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.773Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Flutter%E3%80%91Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/">Flutter开发中使用WIFI真机调试</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.770Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90GOSN%E3%80%91Gosn%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/">【GOSN】Gosn是什么？怎么使用？</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.767Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Typora%E3%80%91typora%E9%85%8D%E7%BD%AEAliCloudOss%E5%9B%BE%E5%BA%93%E4%BD%BF%E7%94%A8picgo%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/">Typora使用gitee作为图库用picgo上传图片的教程~</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.765Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Docker%E3%80%91%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%B0%E5%BD%95/">使用docker搭建开发环境记录</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T01:40:26.762Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Go%E3%80%91Go%E8%AF%AD%E8%A8%80%E4%B8%8EJava%E8%AF%AD%E8%A8%80%E5%AF%B9%E6%AF%94/">【Go】Go语言与Java语言对比</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">121</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>