<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-03-08T09:37:18.000Z" title="2022/3/8 17:37:18">2022-03-08</time>发表</span><span class="level-item"><time dateTime="2019-01-01T20:59:12.000Z" title="2019/1/2 04:59:12">2019-01-02</time>更新</span><span class="level-item">7 分钟读完 (大约1031个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/08/%E3%80%90RocketMQ%E3%80%91RocketMQ/">RocketMQ</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="rocketmq"><a class="markdownIt-Anchor" href="#rocketmq">#</a> RocketMQ</h1>
<h2 id="应用场景"><a class="markdownIt-Anchor" href="#应用场景">#</a> 应用场景</h2>
<ul>
<li>异步解藕</li>
<li>削峰填谷</li>
<li>消息分发</li>
</ul>
<h2 id="环境搭建"><a class="markdownIt-Anchor" href="#环境搭建">#</a> 环境搭建</h2>
<ol>
<li>
<p>上传 rocketmq-all-4.4.0-bin-release.zip 到家目录</p>
</li>
<li>
<p>使用解压命令进行解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip /usr/local/rocketmq-all-4.4.0-bin-release.zip</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>软件重命名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/local/rocketmq-all-4.4.0-bin-release/ /usr/local/rocketmq-4.4/</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改启动参数配置</p>
<blockquote>
<p>JAVA_OPT=”${JAVA_OPT} -server <strong>-Xms1g -Xmx1g -Xmn1g</strong>“</p>
</blockquote>
<p>两个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/rocketmq-4.4/bin/runbroker.sh</span><br><span class="line"></span><br><span class="line">vi /usr/local/rocketmq-4.4/bin/runserver.sh</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>启动名字服务和代理服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nohup sh /usr/local/rocketmq-4.4/bin/mqnamesrv &amp;</span><br><span class="line"></span><br><span class="line"># -n localhost:9876 指定名称服务的地址, 类似于zk的地址</span><br><span class="line"></span><br><span class="line">nohup sh /usr/local/rocketmq-4.4/bin/mqbroker -n localhost:9876 -c /usr/local/rocketmq-4.4/conf/broker.conf &amp;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>检验是否启动正常</p>
<p>使用 java 的内置命令: <strong>jps 可以看到 BrokerStartup 和 NamesrvStartup 进程</strong></p>
<p>使用 Linux 命令 **: netstat-ntlp 可以看到 9876 的端口和 10911 的端口 **</p>
<p>使用 ps-ef |grep java</p>
<p>查看启动日志:</p>
<p>tail -100f ~/logs/rocketmqlogs/namesrv.log</p>
<p>tail -100f ~/logs/rocketmqlogs/broker.log</p>
</li>
<li>
<p>关闭 RocketMQ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 1.关闭NameServer</span><br><span class="line"></span><br><span class="line">sh /usr/local/rocketmq-4.4/bin/mqshutdown namesrv</span><br><span class="line"></span><br><span class="line"># 2.关闭Broker</span><br><span class="line"></span><br><span class="line">sh /usr/local/rocketmq-4.4/bin/mqshutdown broker</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="编写sh脚本文件"><a class="markdownIt-Anchor" href="#编写sh脚本文件">#</a> 编写 sh 脚本文件</h3>
<ul>
<li>
<p>启动 (<a target="_blank" rel="noopener" href="http://startRocketMQ.sh">startRocketMQ.sh</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/bash</span><br><span class="line"></span><br><span class="line">echo &#x27;------------------rocketmq-nameServer-starter-------------------------&#x27; </span><br><span class="line">nohup sh /usr/local/rocketmq-4.4/bin/mqnamesrv &amp;</span><br><span class="line">echo &#x27;------------------rocketmq-nameServer-started-------------------------&#x27;</span><br><span class="line"></span><br><span class="line">echo &#x27;------------------rocketmq-brokerServer-starter-----------------------&#x27; </span><br><span class="line">nohup sh /usr/local/rocketmq-4.4/bin/mqbroker -n localhost:9876 -c /usr/local/rocketmq-4.4/conf/broker.conf &amp;</span><br><span class="line">echo &#x27;------------------rocketmq-brokerServer-started-----------------------&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>关闭 (<a target="_blank" rel="noopener" href="http://stutdownRocketMQ.sh">stutdownRocketMQ.sh</a>)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># !/bin/bash</span><br><span class="line"></span><br><span class="line">echo &#x27;------------------rocketmq-nameServer-shutdown-------------------------&#x27; </span><br><span class="line">sh /usr/local/rocketmq-4.4/bin/mqshutdown namesrv</span><br><span class="line">echo &#x27;------------------rocketmq-nameServer-shutdowned-------------------------&#x27;</span><br><span class="line"></span><br><span class="line">echo &#x27;------------------rocketmq-brokerServer-shutdown-----------------------&#x27; </span><br><span class="line">sh /usr/local/rocketmq-4.4/bin/mqshutdown broker</span><br><span class="line">echo &#x27;------------------rocketmq-brokerServer-shutdowned-----------------------&#x27;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="监控平台"><a class="markdownIt-Anchor" href="#监控平台">#</a> 监控平台</h2>
<p>使用 jar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup  java -jar  rocketmq-console-ng-1.0.1.jar  &amp;</span><br></pre></td></tr></table></figure>
<h2 id="springboot集成"><a class="markdownIt-Anchor" href="#springboot集成">#</a> SpringBoot 集成</h2>
<h3 id="依赖"><a class="markdownIt-Anchor" href="#依赖">#</a> 依赖</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a class="markdownIt-Anchor" href="#配置">#</a> 配置</h3>
<ul>
<li>
<p>生产者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rocketmq.name-server=127.0.0.1:9876</span><br><span class="line">rocketmq.producer.group=my-group</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>消费者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketmq.name-server=127.0.0.1:9876</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="编码"><a class="markdownIt-Anchor" href="#编码">#</a> 编码</h3>
<ul>
<li>
<p>生产者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RocketMQTemplate rocketMQTemplate;</span><br><span class="line">    @RequestMapping(&quot;01-hello&quot;)</span><br><span class="line">    public String sendMsg(String message,String age) throws Exception&#123;</span><br><span class="line">      //发送消息</span><br><span class="line">   		  SendResult sendResult = rocketMQTemplate.syncSend(&quot;01-boot:&quot;, message);</span><br><span class="line">      </span><br><span class="line">        System.out.println(sendResult.getMsgId());</span><br><span class="line">        System.out.println(sendResult.getSendStatus());</span><br><span class="line">        return &quot;success&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>消费者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">        topic = &quot;01-boot&quot;,</span><br><span class="line">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class="line">)</span><br><span class="line">public class HelloConsumer implements RocketMQListener&lt;MessageExt&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(MessageExt messageExt) &#123;</span><br><span class="line">         System.out.println(&quot;消费消息&quot;+messageExt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="发送消息方式生产者"><a class="markdownIt-Anchor" href="#发送消息方式生产者">#</a> 发送消息方式 (生产者)</h4>
<h5 id="发送类型"><a class="markdownIt-Anchor" href="#发送类型">#</a> 发送类型</h5>
<ul>
<li>
<p>同步消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SendResult sendResult = rocketMQTemplate.syncSend(&quot;020-boot&quot;, msg);</span><br><span class="line">System.out.println(sendResult.getMsgId());</span><br><span class="line">System.out.println(sendResult.getSendStatus());</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>异步消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.asyncSend(&quot;020-boot&quot;, msg, new SendCallback() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onSuccess(SendResult sendResult) &#123;</span><br><span class="line">                System.out.println(sendResult.getMsgId());</span><br><span class="line">                System.out.println(sendResult.getSendStatus());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onException(Throwable throwable) &#123;</span><br><span class="line">                System.out.println(throwable);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>一次性消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rocketMQTemplate.sendOneWay(&quot;020-boot&quot;, msg);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="发送时间"><a class="markdownIt-Anchor" href="#发送时间">#</a> 发送时间</h5>
<blockquote>
<p>默认立即发送</p>
</blockquote>
<ul>
<li>
<p>延时发送</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 参数1:主题 2:消息 3:rocket发送最大允许时间 4:延时级别(18级)</span><br><span class="line">SendResult sendResult = rocketMQTemplate.syncSend(&quot;020-boot&quot;, MessageBuilder.withPayload(msg).build(),100000,3);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="消费模式消费者"><a class="markdownIt-Anchor" href="#消费模式消费者">#</a> 消费模式 (消费者)</h4>
<blockquote>
<p>以组为单位 默认为集群模式</p>
</blockquote>
<ul>
<li>
<p>集群模式 (每组只有一个可以收到)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">        topic = &quot;020-boot&quot;,</span><br><span class="line">        messageModel = MessageModel.CLUSTERING,</span><br><span class="line">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class="line">)</span><br><span class="line">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String s) &#123;</span><br><span class="line">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>广播模式 (每组的所有消费者都可以收到)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">        topic = &quot;020-boot&quot;,</span><br><span class="line">        messageModel = MessageModel.BROADCASTING,</span><br><span class="line">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class="line">)</span><br><span class="line">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String s) &#123;</span><br><span class="line">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="消息过滤"><a class="markdownIt-Anchor" href="#消息过滤">#</a> 消息过滤</h4>
<h5 id="tag标签模式"><a class="markdownIt-Anchor" href="#tag标签模式">#</a> Tag 标签模式</h5>
<blockquote>
<p>在发送的消息 Topic:Tag 中间使用冒号隔开</p>
</blockquote>
<ul>
<li>
<p>生产者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/sendTagMsg&quot;)</span><br><span class="line">public String sendTagMsg(String msg) &#123;</span><br><span class="line">    rocketMQTemplate.convertAndSend(&quot;020-boot:TagB&quot;,msg);</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>消费者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">        topic = &quot;020-boot&quot;,</span><br><span class="line">        selectorType = SelectorType.TAG,</span><br><span class="line">  //接收TagB或TagA</span><br><span class="line">        secretKey = &quot;TagB || TagA&quot;,</span><br><span class="line">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class="line">)</span><br><span class="line">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String s) &#123;</span><br><span class="line">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="sql92过滤"><a class="markdownIt-Anchor" href="#sql92过滤">#</a> SQL92 过滤</h5>
<blockquote>
<p>注意：在使用 SQL 过滤的时候，需要配置参数 enablePropertyFilter=true</p>
</blockquote>
<ul>
<li>
<p>生产者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//Sql92过滤</span><br><span class="line">@RequestMapping(&quot;/sendSQLMsg&quot;)</span><br><span class="line">public String sendSQLMsg(int age,String msg) &#123;</span><br><span class="line">    Map&lt;String,Object&gt; map=new HashMap&lt;&gt;();</span><br><span class="line">    //用户自定义属性</span><br><span class="line">    map.put(&quot;age&quot;, age);</span><br><span class="line">    map.put(&quot;name&quot;, &quot;hesj&quot;);</span><br><span class="line">    //也可以设置系统属性</span><br><span class="line">    map.put(MessageConst.PROPERTY_KEYS,age);</span><br><span class="line">    template.convertAndSend(&quot;02-RocketMQ-Top7&quot;,msg,map);</span><br><span class="line">    return &quot;success&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>消费者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@RocketMQMessageListener(</span><br><span class="line">        topic = &quot;02-RocketMQ-Top7&quot;,</span><br><span class="line">        messageModel = MessageModel.CLUSTERING,</span><br><span class="line">        selectorType = SelectorType.SQL92,</span><br><span class="line">        selectorExpression = &quot;age &gt; 16&quot;,</span><br><span class="line">        consumerGroup= &quot;wolfcode-consumer7&quot;</span><br><span class="line">)</span><br><span class="line">public class MqListiner7 implements RocketMQListener&lt;String&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onMessage(String msg) &#123;</span><br><span class="line">        System.out.println(&quot;消费消息SQl92&quot;+msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-03-07T19:47:17.000Z" title="2022/3/8 03:47:17">2022-03-08</time>发表</span><span class="level-item"><time dateTime="2023-05-11T11:37:57.000Z" title="2023/5/11 19:37:57">2023-05-11</time>更新</span><span class="level-item">6 分钟读完 (大约855个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/08/%E3%80%90SpringCloud%E3%80%91%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E7%BB%86%E5%88%99/">微服务拆分细则</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>​	在微服务的设计过程中，微服务设计有多大，微服务粒度的把控，一直是设计人员需要考虑和设计的难点。</p>
<p>因为服务粒度设计过大，不能得到微服务架构带来的便利，例如：更加敏态的开发，更频繁的版本发布，由于服务功能划分的小，可以根据实际的业务场景，选择更加合适的技术进行代码重构等等。</p>
<p>​		但同时我们也要注意，不是服务越” 微 “越好，因为服务的过度拆分会使架构的设计复杂度大大提升，同时也会大大提升运维和测试的复杂度等。</p>
<p>​		所以对服务拆分粒度的把控，对设计人员来讲就至关重要了，甚至对项目的成败有非常重要的影响。</p>
<p>这篇文档提供了一些主要的微服务拆分原则，供您参考，来帮助您进行更加合理粒度的微服务设计。</p>
<h3 id="微服务的拆分原则-通用"><a class="markdownIt-Anchor" href="#微服务的拆分原则-通用">#</a> 微服务的拆分原则 - 通用</h3>
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>原则</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>原则 1</td>
<td>基于业务分析拆分</td>
<td>基于 TOGAF， ADA 等</td>
</tr>
<tr>
<td>原则 2</td>
<td>基于 DDD 领域驱动设计中的子域设计拆分</td>
<td>基于领域驱动设计</td>
</tr>
<tr>
<td>原则 3</td>
<td>根据动作和用例拆分</td>
<td>比如支付</td>
</tr>
<tr>
<td>原则 4</td>
<td>根据名词或者资源拆</td>
<td>比如账号</td>
</tr>
<tr>
<td>原则 5</td>
<td>架构稳定</td>
<td>拆分的结构稳定，不会经常修改</td>
</tr>
<tr>
<td>原则 6</td>
<td>服务是可测试的</td>
<td>集成测试要可定义，测试可回溯</td>
</tr>
<tr>
<td>原则 7</td>
<td>单一原则</td>
<td>一个服务做一个业务， 自己治理自己的数据库</td>
</tr>
<tr>
<td>原则 8</td>
<td>开闭原则</td>
<td>面向对象理论， 对扩展开放， 对修改关闭</td>
</tr>
<tr>
<td>原则 9</td>
<td>高内聚</td>
<td>强一致，强依赖关系的放在一起， 减少分布式事务</td>
</tr>
<tr>
<td>原则 10</td>
<td>低耦合</td>
<td>服务间互相独立</td>
</tr>
<tr>
<td>原则 11</td>
<td>足够小的团队可维护，最大两个 pizza team</td>
<td>6-10 人一个 pizza team</td>
</tr>
<tr>
<td>原则 12</td>
<td>团队自治，自己的服务的开发和发布要跟别的团队尽可能小的协调</td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="微服务的拆分原则-技术侧重点"><a class="markdownIt-Anchor" href="#微服务的拆分原则-技术侧重点">#</a> 微服务的拆分原则 - 技术侧重点</h2>
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>原则</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>原则 1</td>
<td>潜在风险</td>
<td>服务的风险性</td>
</tr>
<tr>
<td>原则 2</td>
<td>资源性能计算性能硬盘性能内存容量网络带宽</td>
<td>机器的性能决定了方案的部分选择</td>
</tr>
<tr>
<td>原则 3</td>
<td>安全</td>
<td>安全要求是否很高，安全的策略</td>
</tr>
<tr>
<td>原则 4</td>
<td>高并发瞬时并发持续并发</td>
<td>并发的种类， 持续的时间</td>
</tr>
<tr>
<td>原则 5</td>
<td>数据库数据量大小读操作写操作数据类型</td>
<td>数据的类型， 读写的多少，数据量</td>
</tr>
</tbody>
</table>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-24T00:35:45.000Z" title="2022/2/24 08:35:45">2022-02-24</time>发表</span><span class="level-item"><time dateTime="2019-11-17T19:58:09.000Z" title="2019/11/18 03:58:09">2019-11-18</time>更新</span><span class="level-item">9 分钟读完 (大约1304个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/24/%E3%80%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%91%E9%98%BF%E9%87%8C%E4%BA%91OSS%E7%9A%84CDN%E5%8A%A0%E9%80%9F%E5%92%8COSS%E4%BC%A0%E8%BE%93%E5%8A%A0%E9%80%9F%E7%9A%84%E5%8C%BA%E5%88%AB/">阿里云OSS的CDN加速和OSS传输加速的区别</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h2>
<p>本文主要介绍阿里云对象存储 OSS 的传输加速功能和 CDN 加速 OSS 资源的区别，以便您根据实际业务进行选择。</p>
<h2 id="详细信息"><a class="markdownIt-Anchor" href="#详细信息">#</a> 详细信息</h2>
<p>阿里云对象存储 OSS 以海量、安全、低成本、高可靠等特点已经成为用户存储静态资源和文件的首要选择，实际使用中面向全球各地用户访问 OSS 资源时，访问速度会受到客户端网络、OSS 的下行带宽、Bucket 地域、访问链路长等限制出现访问慢的情况。以下主要介绍 CDN 加速 OSS 和 OSS 传输加速的加速方式：</p>
<h3 id="实现原理"><a class="markdownIt-Anchor" href="#实现原理">#</a> 实现原理</h3>
<p>具体实现加速的原理如下：</p>
<ul>
<li>CDN 加速 OSS：是建立并覆盖在承载网之上，由遍布全球的边缘节点服务器群组成的分布式网络。阿里云 CDN 能分担源站压力，避免网络拥塞，确保在不同区域、不同场景下加速网站内容的分发，提高资源访问速度。由 CDN 全球广泛分布的边缘节点缓存 OSS 存储的静态数据，从而实现客户端从边缘节点直接获取数据的方式来实现访问的加速。</li>
<li>OSS 传输加速：利用全球分布的云机房，将全球各地用户对您存储空间（Bucket）的访问，经过智能路由解析至就近的接入点，使用优化后的网络及协议，为云存储互联网的上传、下载提供端到端的加速方案。</li>
</ul>
<h3 id="资源加速场景介绍"><a class="markdownIt-Anchor" href="#资源加速场景介绍">#</a> 资源加速场景介绍</h3>
<p>OSS 传输加速是针对 OSS 的链路加速，使用 OSS 传输加速后支持 OSS 提供的任意特性。CDN 通过全球边缘节点缓存 OSS 资源，加速同时可降低带宽成本。OSS 传输加速和 CDN 加速完全是两个不同的产品，且应对的场景不同，详情请参见<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/109895.htm"> CDN 应用场景</a>和<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/131312.htm">传输加速场景</a>。</p>
<ul>
<li>如果您的业务是第三方数据源加速，推荐您使用 CDN 加速。</li>
<li>如果您的 OSS 资源需要进行多次下载的操作，并且不要求数据强一致性，推荐您使用 CDN 加速。</li>
<li>如果您的 OSS 资源需要加速下载，并且访问量少，推荐您使用 OSS 传输加速。</li>
<li>如果您的 OSS 资源需要进行多次下载的操作，并且要求数据强一致性，推荐您使用 OSS 传输加速。</li>
<li>如果您的业务存储的是动态资源，且数据更新频繁，推荐您使用 OSS 传输加速。</li>
<li>如果您的业务存储的是静态资源，且更新少，推荐您使用 CDN 加速。</li>
</ul>
<h3 id="cdn加速和oss传输加速的对比"><a class="markdownIt-Anchor" href="#cdn加速和oss传输加速的对比">#</a> CDN 加速和 OSS 传输加速的对比</h3>
<p>CDN 加速和 OSS 传输加速的使用场景不同，其优缺点对比如下：</p>
<table>
<thead>
<tr>
<th><strong>加速方式</strong></th>
<th><strong>实现方法</strong></th>
<th><strong>应用场景</strong></th>
<th><strong>优点</strong></th>
<th><strong>缺点</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>CDN 加速 OSS</td>
<td>通过全球分布的边缘节点缓存数据来实现加速。</td>
<td>网站或应用中小文件大文件的下载视音频点播</td>
<td>CDN 边缘节点全球分布，数量多。CDN 节点提供的服务带宽量大。</td>
<td>对于访问量大的资源，命中率高，访问量小的资源命中率低，节点未缓存的情况下，还是需要回源访问，回源依赖实时的公网回源链路。CDN 静态资源的访问，对于上传、删除等动态请求加速效果不明显。</td>
</tr>
<tr>
<td>OSS 传输加速</td>
<td>实现的是客户端到 OSS 服务端之间链路优化来实现的加速功能，实际每次资源的请求还是从 OSS 来进行获取。</td>
<td>远距离数据传输加速 GB、TB 级大文件上传和下载非静态、非热点数据下载加速</td>
<td>OSS 存储节点全球主要区域分布。远距离以及大文件的上传和下载加速。</td>
<td>所有的访问都是回源到 OSS 访问，占用 OSS 的服务带宽。同一区域大量用户集中访问资源的情况下，效果没有 CDN 加速效果好。只能使用 HTTPS 方式访问。</td>
</tr>
</tbody>
</table>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-21T16:11:02.000Z" title="2022/2/22 00:11:02">2022-02-22</time>发表</span><span class="level-item"><time dateTime="2023-04-21T01:26:42.000Z" title="2023/4/21 09:26:42">2023-04-21</time>更新</span><span class="level-item">3 分钟读完 (大约470个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/22/%E3%80%90Java%E3%80%91Alibaba%E5%88%86%E5%B1%82%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B%E8%A7%84%E7%BA%A6/">阿里巴巴Java开发手册中的DO、DTO、BO、AO、VO、POJO定义</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>分层领域模型规约：</p>
<p>DO（ Data Object）：与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。<br>
DTO（ Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。<br>
BO（ Business Object）：业务对象。 由 Service 层输出的封装业务逻辑的对象。<br>
AO（ Application Object）：应用对象。 在 Web 层与 Service 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。<br>
VO（ View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。<br>
POJO（ Plain Ordinary Java Object）：在本手册中， POJO 专指只有 setter/getter/toString 的简单类，包括 DO/DTO/BO/VO 等。<br>
Query：数据查询对象，各层接收上层的查询请求。 注意超过 2 个参数的查询封装，禁止使用 Map 类来传输。<br>
领域模型命名规约：</p>
<p>数据对象：xxxDO，xxx 即为数据表名。<br>
数据传输对象：xxxDTO，xxx 为业务领域相关的名称。<br>
展示对象：xxxVO，xxx 一般为网页名称。<br>
POJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-17T19:42:58.000Z" title="2022/2/18 03:42:58">2022-02-18</time>发表</span><span class="level-item"><time dateTime="2019-04-20T02:43:21.000Z" title="2019/4/20 10:43:21">2019-04-20</time>更新</span><span class="level-item">2 分钟读完 (大约340个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/18/%E3%80%90Jenkins%E3%80%91Linux%E4%B8%8B%E4%BD%BF%E7%94%A8war%E5%8C%85%E9%83%A8%E7%BD%B2Jenkins/">Linux下使用war包部署Jenkins</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="linux下使用war包部署jenkins"><a class="markdownIt-Anchor" href="#linux下使用war包部署jenkins">#</a> Linux 下使用 war 包部署 Jenkins</h1>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>jenkins 可以多种方式安装，可以 docker，也可以直接下载 war 包，然后 java -jar 方式启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1.创建安装目录</span><br><span class="line">	mkdir -p /jenkins</span><br><span class="line">2.切换目录</span><br><span class="line">	cd  /jenkins</span><br><span class="line">3.下载war包</span><br><span class="line">	wget -O /jenkins/jenkins.war http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br><span class="line">4.启动</span><br><span class="line">	BUILD_ID=dontKillMe nohup java -DJENKINS_HOME=/jenkins (如果有历史home可以指定其他home：/root/.jenkins) -Xms1046m -Xmx2000m -jar jenkins.war --httpPort=9444  &gt;&gt;jenkinsLog.log 2&gt;&amp;1 &amp;</span><br><span class="line">5.访问</span><br><span class="line">	http://&#123;your ip&#125;:9444</span><br></pre></td></tr></table></figure>
<h3 id="备注"><a class="markdownIt-Anchor" href="#备注">#</a> <strong>备注:</strong></h3>
<ol>
<li>–httpPort 自定义端口</li>
<li>jenkins 默认工作目录：/root/.jenkins</li>
<li>nohup 后台启动</li>
<li>‘&gt;&gt;log’ 以追加的方式记录日志</li>
<li>2&gt;&amp;1 2: 标准异常输出 1: 标准输出 ，2&gt;&amp;1 两种输出都记录到 log 文件中</li>
<li>&amp; 后台启动方式</li>
<li>BUILD_ID=dontKillMe 防止误杀包</li>
</ol>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-14T18:58:23.000Z" title="2022/2/15 02:58:23">2022-02-15</time>发表</span><span class="level-item"><time dateTime="2021-06-23T21:43:37.000Z" title="2021/6/24 05:43:37">2021-06-24</time>更新</span><span class="level-item">2 分钟读完 (大约319个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/15/%E3%80%90Flutter%E3%80%91Flutter%E9%87%8D%E5%A4%8D%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2GIF%E4%B8%8D%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/">Flutter下加载本地资源GIF，怎么做到每次进入页面都会出现动画效果？</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>1. 问题：Flutter 加载 GIF 之后，只有第一次进入页面才会执行动画，接下来都不会执行了<br>
 2. 原因：因为 Flutter 的图片缓存机制，在第一次加载图片后，会将图片缓存下来，所以再次访问，你看见的还是上次的已经执行完毕的动画<br>
 3. 解决：在 dispose 中把 imageCache 用 clear 方法清理掉</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span> asset = <span class="string">&quot;images/401.gif&quot;</span>;</span><br><span class="line">Widget img = Image.asset(<span class="string">&quot;images/401.gif&quot;</span>,key: UniqueKey(),);</span><br><span class="line"></span><br><span class="line"> <span class="meta">@override</span></span><br><span class="line"> <span class="keyword">void</span> initState() &#123;</span><br><span class="line">   <span class="keyword">super</span>.initState();</span><br><span class="line">     <span class="comment">//初始化</span></span><br><span class="line">   toast();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@override</span></span><br><span class="line"> <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">   <span class="keyword">super</span>.dispose();</span><br><span class="line">     <span class="comment">//清理缓存</span></span><br><span class="line">	imageCache!.clear();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">void</span> toast() &#123;</span><br><span class="line">   DialogUtils.showErrorMessage(<span class="string">&quot;401&quot;</span>,</span><br><span class="line">       gravity: ToastGravity.CENTER, toastLength: Toast.LENGTH_SHORT);</span><br><span class="line"></span><br><span class="line">   Future.delayed(<span class="built_in">Duration</span>(seconds: <span class="number">3</span>), () &#123;</span><br><span class="line">     DialogUtils.showMessage(<span class="string">&quot;您没有权限访问......&quot;</span>,</span><br><span class="line">         gravity: ToastGravity.CENTER, toastLength: Toast.LENGTH_LONG);</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-12T15:53:00.000Z" title="2022/2/12 23:53:00">2022-02-12</time>发表</span><span class="level-item"><time dateTime="2023-08-26T10:12:19.000Z" title="2023/8/26 18:12:19">2023-08-26</time>更新</span><span class="level-item">4 分钟读完 (大约566个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/12/%E3%80%90VsCode%E3%80%91VsCode%E4%B8%AD%E7%9A%84HTML%E5%B5%8C%E5%A5%97%E6%B3%A8%E9%87%8A%E3%80%81%E5%A4%9A%E8%A1%8C%E6%B3%A8%E9%87%8A%E3%80%81%E5%A4%9A%E7%BA%A7%E6%B3%A8%E9%87%8A%EF%BC%8C%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E5%8A%9B/">【VsCode】VsCode中的HTML嵌套注释、多行注释、多级注释，提高生产力</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="vscodevscode中的html嵌套注释-多行注释-多级注释提高生产力"><a class="markdownIt-Anchor" href="#vscodevscode中的html嵌套注释-多行注释-多级注释提高生产力">#</a> 【VsCode】VsCode 中的 HTML 嵌套注释、多行注释、多级注释，提高生产力</h1>
<h1 id="html嵌套注释插件html-comment"><a class="markdownIt-Anchor" href="#html嵌套注释插件html-comment">#</a> HTML 嵌套注释插件：HTML-Comment</h1>
<h2 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h2>
<p>相信我，这是市面上最好用的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=HTML%E6%B3%A8%E9%87%8A&amp;spm=1001.2101.3001.7020"> HTML 注释</a>插件，因为这是我体验过很多主流插件后才开发出的工具。</p>
<p>很多人在使用 html 的注释嵌套使用时都会发现并不能达到我们想到的效果，正常情况以下注释会报错：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/cfcc3e34459840afaec821a1de76db99.gif" alt="正常注释效果"></p>
<p>原生的方法是不支持这种嵌套注释的，只能使用变种方法进行多级注释，方便起见做了个注释插件，使用注释插件注释效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f817fcb5820db2e0281b821f61000b9b.gif" alt="插件效果注释"></p>
<h2 id="使用方法放开注释同下"><a class="markdownIt-Anchor" href="#使用方法放开注释同下">#</a> 使用方法（放开注释同下）</h2>
<blockquote>
<p>Ctrl+Shift+/</p>
</blockquote>
<p>目前改插件只支持 vscode，后续会开发 WebStorm 版本</p>
<h2 id="修改按键快捷方式"><a class="markdownIt-Anchor" href="#修改按键快捷方式">#</a> 修改按键快捷方式</h2>
<p>打开 vscode，找到左上角文件 -&gt; 首选项 -&gt; 键盘快捷方式，输入 HTML-Comment，可以查看并修改按键。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2650c06ec95a43f5b33c54eea1c48e5d.png" alt="在这里插入图片描述"></p>
<h2 id="支持列表"><a class="markdownIt-Anchor" href="#支持列表">#</a> 支持列表</h2>
<p>适用于 htm、html、asp、cfm、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=jsx&amp;spm=1001.2101.3001.7020">jsx</a>、md、njk、php、svelte、svg、tsx、twig、vue、xml、xsl 等格式文件中任意 <code>&lt;!-- &lt;tag&gt;&lt;/tag&gt; --&gt;</code>  风格的代码块。</p>
<p><strong>目前该插件只支持 vscode，后续会开发 WebStorm 版本</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-08T13:28:46.000Z" title="2022/2/8 21:28:46">2022-02-08</time>发表</span><span class="level-item"><time dateTime="2023-05-15T09:59:33.000Z" title="2023/5/15 17:59:33">2023-05-15</time>更新</span><span class="level-item">4 分钟读完 (大约672个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/08/%E3%80%90Redis%E3%80%91Redis%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/">redis主从集群-哨兵模式搭建文档</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>准备工作</p>
<ul>
<li>
<h3 id="三台服务器"><a class="markdownIt-Anchor" href="#三台服务器">#</a> 三台服务器</h3>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">服务器 ip</th>
<th>角色</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">192.168.20.1</td>
<td>主</td>
</tr>
<tr>
<td style="text-align:left">192.168.20.2</td>
<td>从</td>
</tr>
<tr>
<td style="text-align:left">192.168.20.3</td>
<td>从</td>
</tr>
</tbody>
</table>
<ol start="2">
<li>
<h4 id="docker安装redis"><a class="markdownIt-Anchor" href="#docker安装redis">#</a> docker 安装 redis</h4>
</li>
</ol>
<p>docker pull redis</p>
<ol start="3">
<li>
<h4 id="运行"><a class="markdownIt-Anchor" href="#运行">#</a> 运行</h4>
</li>
</ol>
<p>分别从三台服务器运行 redis 镜像，注意映射不同外端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 6380:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes --daemonize no --masterauth #如果主节点设置了密码，请输入主服务密码</span><br></pre></td></tr></table></figure>
<p>docker exec -it redis_master /bin/bash</p>
<ol start="4">
<li>
<h4 id="查看角色"><a class="markdownIt-Anchor" href="#查看角色">#</a> 查看角色</h4>
</li>
</ol>
<h4 id="主"><a class="markdownIt-Anchor" href="#主">#</a> 主：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; auth #你的密码</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:f28e9097e4c8cd3f67292181be12955909afd88e</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<h4 id="从01"><a class="markdownIt-Anchor" href="#从01">#</a> 从 01:</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:48a7e3866afc4b6784ef49353b57fbc979ee2935</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<h4 id="从02"><a class="markdownIt-Anchor" href="#从02">#</a> 从 02：</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:de30809041f22f2dd6abc9cb34536f26df97e647</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<ol start="4">
<li>
<h4 id="在两台从服务器上执行命令-replicaof-192168201-6379"><a class="markdownIt-Anchor" href="#在两台从服务器上执行命令-replicaof-192168201-6379">#</a> 在两台从服务器上执行命令 replicaof 192.168.20.1 6379</h4>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; replicaof 192.168.20.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<ol start="5">
<li>
<h4 id="查看主服务信息"><a class="markdownIt-Anchor" href="#查看主服务信息">#</a> 查看主服务信息</h4>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##从服务器信息</span></span></span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=172.17.0.3,port=6379,state=online,offset=1456,lag=1</span><br><span class="line">slave1:ip=172.17.0.4,port=6379,state=online,offset=1456,lag=0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##从服务器信息</span></span></span><br><span class="line"> </span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:9b8c2ef4539809505fa5bc1dd779c4500298011d</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:1456</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:1</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:1</span><br><span class="line">repl_backlog_histlen:1456</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:0</span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:f28e9097e4c8cd3f67292181be12955909afd88e</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br><span class="line">127.0.0.1:6379&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>
<h4 id="测试"><a class="markdownIt-Anchor" href="#测试">#</a> 测试：</h4>
</li>
</ol>
<p>主服务器上：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; set name zs</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<h3 id="从服务器也可以查看到信息"><a class="markdownIt-Anchor" href="#从服务器也可以查看到信息">#</a> 从服务器也可以查看到信息</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; replicaof 192.168.20.1 6379</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get name</span><br><span class="line">&quot;zs&quot;</span><br><span class="line">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>
<h3 id="异常统计"><a class="markdownIt-Anchor" href="#异常统计">#</a> 异常统计：</h3>
<p>可能遇到的 BUG：MASTER aborted replication with an error: NOAUTH Authentication required.</p>
<p>场景：在配置主从后发现两个从节点的 info replication 中出现：master_link_status:down</p>
<p>原因：大部分原因是因为主节点配置了密码</p>
<p>解决：在从节点的配置文件中加入 masterauth 你的主节点密码 即可</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-04T18:43:19.000Z" title="2022/2/5 02:43:19">2022-02-05</time>发表</span><span class="level-item"><time dateTime="2022-07-05T02:15:48.000Z" title="2022/7/5 10:15:48">2022-07-05</time>更新</span><span class="level-item">10 分钟读完 (大约1470个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/05/%E3%80%90Docker%E3%80%91Docker%E5%AE%89%E8%A3%85Jenkins/">Docker安装Jenkins</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker安装jenkins"><a class="markdownIt-Anchor" href="#docker安装jenkins">#</a> Docker 安装 Jenkins</h1>
<h1 id="一-前言"><a class="markdownIt-Anchor" href="#一-前言">#</a> 一、前言</h1>
<h2 id="1-领头羊"><a class="markdownIt-Anchor" href="#1-领头羊">#</a> 1、领头羊</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">作为领先的开源自动化服务器，Jenkins 提供了数百个插件来支持构建、部署和自动化任何项目。</span><br></pre></td></tr></table></figure>
<h2 id="2-特点"><a class="markdownIt-Anchor" href="#2-特点">#</a> 2、特点</h2>
<ul>
<li>持续集成和持续交付：作为可扩展的自动化服务器，Jenkins 可以用作简单的 CI 服务器或变成任何项目的持续交付中心。</li>
<li>简易安装：Jenkins 是一个独立的基于 Java 的程序，可以开箱即用，包含适用于 Windows、Linux、macOS 和其他类 Unix 操作系统的软件包。</li>
<li>易于配置：Jenkins 可以通过其 Web 界面轻松设置和配置，其中包括即时错误检查和内置帮助。</li>
<li>插件：凭借更新中心的数百个插件，Jenkins 与持续集成和持续交付工具链中的几乎所有工具集成。</li>
<li>可扩展：Jenkins 可以通过其插件架构进行扩展，为 Jenkins 可以做的事情提供几乎无限的可能性。</li>
<li>分散式：Jenkins 可以轻松地在多台机器上分配工作，帮助更快地跨多个平台推动构建、测试和部署。</li>
</ul>
<h1 id="二-docker安装jenkins"><a class="markdownIt-Anchor" href="#二-docker安装jenkins">#</a> 二、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Docker%E5%AE%89%E8%A3%85Jenkins&amp;spm=1001.2101.3001.7020">Docker 安装 Jenkins</a></h1>
<h2 id="1-docker-search-jenkins查询镜像"><a class="markdownIt-Anchor" href="#1-docker-search-jenkins查询镜像">#</a> 1、docker search jenkins 查询镜像</h2>
<h3 id="11-正常查询结果"><a class="markdownIt-Anchor" href="#11-正常查询结果">#</a> 1.1、正常查询结果</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search jenkins</span><br><span class="line">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">jenkins                            DEPRECATED; use &quot;jenkins/jenkins:lts&quot; instead   5504                [OK]                </span><br><span class="line">jenkins/jenkins                    The leading open source automation server       3087                                    </span><br><span class="line">jenkins/jnlp-slave                 a Jenkins agent which can connect to Jenkins…   150                                     [OK]</span><br><span class="line">jenkins/inbound-agent                                                              65                                      </span><br><span class="line">bitnami/jenkins                    Bitnami Docker Image for Jenkins                53                                      [OK]</span><br><span class="line">jenkins/slave                      base image for a Jenkins Agent, which includ…   48                                      [OK]</span><br><span class="line">jenkins/agent                                                                      39                                      </span><br><span class="line">jenkins/ssh-slave                  A Jenkins slave using SSH to establish conne…   38                                      [OK]</span><br><span class="line">jenkins/ssh-agent                  Docker image for Jenkins agents connected ov…   24                                      </span><br><span class="line">jenkins/jnlp-agent-docker                                                          8                                       </span><br><span class="line">jenkins/jnlp-agent-maven           A JNLP-based agent with Maven 3 built in        7                                       </span><br><span class="line">jenkins/pct                        Plugin Compat Tester                            5                                       [OK]</span><br><span class="line">jenkins/jenkins-experimental       Experimental images of Jenkins. These images…   3                                       [OK]</span><br><span class="line">jenkins/jnlp-agent-python          A JNLP-based agent with Python built in         3                                       </span><br><span class="line">jenkins/jnlp-agent-alpine                                                          2                                       </span><br><span class="line">jenkins/jnlp-agent-node                                                            1                                       </span><br><span class="line">rancher/jenkins-jenkins                                                            1                                       </span><br><span class="line">jenkins/ath                        Jenkins Acceptance Test Harness                 1                                       [OK]</span><br><span class="line">jenkins/core-changelog-generator   Tool for generating Jenkins core changelogs     1                                       </span><br><span class="line">jenkins/jenkinsfile-runner         Jenkinsfile Runner packages                     1                                       </span><br><span class="line">jenkins/core-pr-tester             Docker image for testing pull-requests sent …   1                                       </span><br><span class="line">jenkins/jnlp-agent-ruby                                                            1                                       </span><br><span class="line">jenkins/remoting-kafka-agent       Remoting Kafka Agent                            1                                       [OK]</span><br><span class="line">rancher/jenkins-jnlp-slave                                                         0                                       </span><br><span class="line">rancher/jenkins-slave              Jenkins Build Slave                             0                                       [OK]</span><br><span class="line">[root@localhost ~]# ^C</span><br><span class="line">[root@localhost ~]# </span><br></pre></td></tr></table></figure>
<h3 id="12-可能异常情况这个异常解决方法为下面第2点"><a class="markdownIt-Anchor" href="#12-可能异常情况这个异常解决方法为下面第2点">#</a> 1.2、可能异常情况，这个异常解决方法为下面第 2 点</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/07f347955491462592d6f37cc2394fc6.png" alt="img"></p>
<h2 id="2-上面报这个error解决方法"><a class="markdownIt-Anchor" href="#2-上面报这个error解决方法">#</a> 2、上面报这个 ERROR 解决方法</h2>
<h3 id="21-更新时间同步即可ntpdate-cnpoolntporg"><a class="markdownIt-Anchor" href="#21-更新时间同步即可ntpdate-cnpoolntporg">#</a> 2.1、更新<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&amp;spm=1001.2101.3001.7020">时间同步</a>即可：ntpdate <a target="_blank" rel="noopener" href="http://cn.pool.ntp.org">cn.pool.ntp.org</a></h3>
<h3 id="22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate"><a class="markdownIt-Anchor" href="#22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate">#</a> 2.2、如果提示不存在 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ntpdate&amp;spm=1001.2101.3001.7020">ntpdate</a> 命令需要先安装该命令：yum install ntpdate</h3>
<h3 id="23-date中国时间"><a class="markdownIt-Anchor" href="#23-date中国时间">#</a> 2.3、date 中国时间</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/315167c9692b4ebbad480fdffdf439c0.png" alt="img"></p>
<h2 id="3-docker-pull-jenkinsciblueocean拉取jenkins镜像"><a class="markdownIt-Anchor" href="#3-docker-pull-jenkinsciblueocean拉取jenkins镜像">#</a> 3、****docker pull jenkinsci/blueocean**** 拉取 Jenkins 镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1ef511da220c4ca4bca8143aa55c9e52.png" alt="img"></p>
<h2 id="4-docker-images-查看本地镜像"><a class="markdownIt-Anchor" href="#4-docker-images-查看本地镜像">#</a> 4、docker images 查看本地镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d9690427ee344603ac96cfa1a6a5510c.png" alt="img"></p>
<h2 id="5-centos7安装jdk安装-已有jdk可以跳过"><a class="markdownIt-Anchor" href="#5-centos7安装jdk安装-已有jdk可以跳过">#</a> 5、CentOS7 安装 JDK 安装 已有 JDK 可以跳过</h2>
<h3 id="51-可以下载linux版本targz压缩包到本地不用解压"><a class="markdownIt-Anchor" href="#51-可以下载linux版本targz压缩包到本地不用解压">#</a> 5.1、可以下载 linux 版本 tar.gz 压缩包到本地不用解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b413890d2adc4b8ea27f016d215c14e7.png" alt="img"></p>
<h3 id="52-cd-usr-mkdir-java进入usr创建java文件夹"><a class="markdownIt-Anchor" href="#52-cd-usr-mkdir-java进入usr创建java文件夹">#</a> 5.2、****cd /usr, mkdir java**** 进入 usr 创建 java 文件夹</h3>
<h3 id="53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里"><a class="markdownIt-Anchor" href="#53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里">#</a> 5.3、****cd java*<em><strong> 进入 java 文件夹，用</strong></em> * rz**** 将 linux 版的 jdk 压缩包上传到这里</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/32e9bd440462402a80f0aa6a0ef32a18.png" alt="img"></p>
<h3 id="54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令"><a class="markdownIt-Anchor" href="#54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令">#</a> 5.4、(将 JDK 移到 java，mv jdk-8u301-linux-x64.tar.gz/usr/java) 移动文件命令</h3>
<h3 id="55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现"><a class="markdownIt-Anchor" href="#55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现">#</a> 5.5、<em><strong>*tar*</strong></em> <em><strong>*-*</strong></em><em><strong>*zxvf*</strong></em> jdk-8u301-linux-x64.tar.gz，解压会有 jdk1.8.0_301 出现</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/100d06f1ce4e4ee7b4b209cbf37491db.png" alt="img"></p>
<h3 id="56-vi-etcprofile配置linux系统jdk环境变量"><a class="markdownIt-Anchor" href="#56-vi-etcprofile配置linux系统jdk环境变量">#</a> 5.6、****vi /etc/profile**** 配置 linux 系统 JDK 环境变量</h3>
<p><strong>1) 配置内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_301</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br></pre></td></tr></table></figure>
<h3 id="57-source-etcprofile使配置生效"><a class="markdownIt-Anchor" href="#57-source-etcprofile使配置生效">#</a> 5.7、****source /etc/profile**** 使配置生效</h3>
<h3 id="58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到"><a class="markdownIt-Anchor" href="#58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到">#</a> 5.8、<em><strong>*sudo yum install glibc.i686*</strong></em>，可能报错解决方案、否则会会报找不到</h3>
<h3 id="59-java-version测试出现如下即为成功"><a class="markdownIt-Anchor" href="#59-java-version测试出现如下即为成功">#</a> 5.9、****java -version**** 测试，出现如下即为成功</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f3cca3db43c84bf79be1bfa8282c4ba9.png" alt="img"></p>
<h2 id="6-centos7安装maven"><a class="markdownIt-Anchor" href="#6-centos7安装maven">#</a> 6、CentOS7 安装 Maven</h2>
<h3 id="61-cd-usrlocal"><a class="markdownIt-Anchor" href="#61-cd-usrlocal">#</a> 6.1、<em><strong>*cd /usr/local*</strong></em></h3>
<h3 id="62-rz上传tar-zxvf-apache-maven-361-bintargz解压"><a class="markdownIt-Anchor" href="#62-rz上传tar-zxvf-apache-maven-361-bintargz解压">#</a> 6.2、****rz*<em><strong> 上传，</strong></em>*tar -zxvf apache-maven-3.6.1-bin.tar.gz**** 解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1055aa0df0184f6bb28bde13fed60bc5.png" alt="img"></p>
<h3 id="63-vi-etcprofile"><a class="markdownIt-Anchor" href="#63-vi-etcprofile">#</a> 6.3、<em><strong>*vi /etc/profile*</strong></em></h3>
<h3 id="64-source-etcprofile刷新环境变量"><a class="markdownIt-Anchor" href="#64-source-etcprofile刷新环境变量">#</a> 6.4、****source /etc/profile**** 刷新环境变量</h3>
<h3 id="65-mvn-v查看版本"><a class="markdownIt-Anchor" href="#65-mvn-v查看版本">#</a> 6.5、****mvn -v**** 查看版本</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost local]# mvn -v</span><br><span class="line">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">Maven home: /usr/local/apache-maven-3.6.3</span><br><span class="line">Java version: 1.8.0_301, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_301/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-1127.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line">[root@localhost local]# </span><br></pre></td></tr></table></figure>
<p>到此 JDK、Maven 环境准备完成</p>
<h2 id="7-启动容器并挂载上面配置的环境"><a class="markdownIt-Anchor" href="#7-启动容器并挂载上面配置的环境">#</a> 7、<em><strong>* 启动容器，并 *</strong></em><em><strong>* 挂载上面配置的环境 *</strong></em></h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-u root \</span><br><span class="line">-d \</span><br><span class="line">--restart=always \</span><br><span class="line">-p 8001:8080 \</span><br><span class="line">-p 50000:50000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/172131aa0a9f47b3a15e5bd5d4555986.png" alt="img"></p>
<h2 id="9-访问jenkins提示输入密码"><a class="markdownIt-Anchor" href="#9-访问jenkins提示输入密码">#</a> 9、访问 Jenkins，提示输入密码</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2b6d909e4c4e46efaa98216f1c33fdf7.png" alt="img"></p>
<h2 id="10-初次可以选择推荐的"><a class="markdownIt-Anchor" href="#10-初次可以选择推荐的">#</a> 10、初次可以选择推荐的</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5e9a6ebdd6954093bf6a23f4f876221a.png" alt="img"></p>
<h2 id="11-等待安装"><a class="markdownIt-Anchor" href="#11-等待安装">#</a> 11、 <strong>等待安装</strong></h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/25caae9dae8b49878adca5e32647e915.png" alt="img"></p>
<h2 id="12-如下访问jenkins成功啦"><a class="markdownIt-Anchor" href="#12-如下访问jenkins成功啦">#</a> 12、如下访问 Jenkins 成功啦</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4beeeb654aec4e608a22ce6b49afa1ae.png" alt="img"></p>
<p>到此就结束 Docker 安装 Jenkins 啦，后面的章节将介绍如何配置 jenkins，敬请期待！</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-03T06:20:27.000Z" title="2022/2/3 14:20:27">2022-02-03</time>发表</span><span class="level-item"><time dateTime="2021-11-12T10:50:53.000Z" title="2021/11/12 18:50:53">2021-11-12</time>更新</span><span class="level-item">5 分钟读完 (大约791个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/03/%E3%80%90Docker%E3%80%91Docker%E4%B8%8B%E5%AE%89%E8%A3%85Canal%E5%B9%B6%E6%95%B4%E5%90%88SpringBoot/">【Docker】Docker下安装Canal并整合SpringBoot</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="canal"><a class="markdownIt-Anchor" href="#canal">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Canal&amp;spm=1001.2101.3001.7020">Canal</a> 是一个同步增量数据的一个工具</h1>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#_2">概念</a></li>
<li><a href="#Mysqlbinlog_5">Mysql 开启 binlog</a></li>
<li>
<ul>
<li><a href="#binlog_9">是否开启 binlog</a></li>
<li><a href="#binlog_16">开启 binlog 日志</a></li>
<li><a href="#_30">创建授权用户</a></li>
</ul>
</li>
<li><a href="#Canal_41">部署 Canal</a></li>
<li>
<ul>
<li><a href="#_43">拉取镜像</a></li>
<li><a href="#properties_47">挂载 properties 配置文件</a></li>
<li><a href="#_68">创建容器</a></li>
</ul>
</li>
</ul>
<h1 id="概念"><a class="markdownIt-Anchor" href="#概念">#</a> 概念</h1>
<p>canal 是阿里巴巴旗下的一款<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020">开源项目</a>，纯 Java 开发。基于数据库增量日志解析，提供增量数据订阅 &amp; 消费，目前主要支持了 MySQL（也支持 mariaDB）</p>
<h1 id="mysql开启binlog"><a class="markdownIt-Anchor" href="#mysql开启binlog">#</a> Mysql 开启 binlog</h1>
<p>在部署 Canal 之前，需要先安装 Mysql。</p>
<blockquote>
<p>我用的是 5.7.27 的 mysql</p>
</blockquote>
<h2 id="是否开启binlog"><a class="markdownIt-Anchor" href="#是否开启binlog">#</a> 是否开启 binlog</h2>
<p>输入以下命令，查看是否开启 binlog<br>
 为<strong> OFF</strong> 则表示<strong>未开启</strong> binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/cd4194a978a544b59e40d7c342d8683d.png" alt="在这里插入图片描述"></p>
<h2 id="开启binlog日志"><a class="markdownIt-Anchor" href="#开启binlog日志">#</a> 开启 binlog 日志</h2>
<p>修改 mysql 的配置文件，在 [mysqld] 下添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># server_id不重复即可，不要和canal的slaveId重复</span><br><span class="line">server_id=1</span><br><span class="line"># 开启binlog</span><br><span class="line">log_bin = mysql-bin</span><br><span class="line"># 选择row模式</span><br><span class="line">binlog_format = ROW</span><br></pre></td></tr></table></figure>
<hr>
<p>修改完毕，重启 mysql<br>
 查看是否开启<br>
<img src="https://img-blog.csdnimg.cn/df9f1104c79c42b3bd3cc2461f593f40.png" alt="在这里插入图片描述"></p>
<h2 id="创建授权用户"><a class="markdownIt-Anchor" href="#创建授权用户">#</a> 创建授权用户</h2>
<p>创建授权用户 canal 用于 cannal 服务监听 mysql 的 binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 新建用户 用户名：canal  密码：canal </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> canal IDENTIFIED <span class="keyword">by</span> <span class="string">&#x27;canal&#x27;</span>;</span><br><span class="line"># 授权</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"># 刷新MySQL的系统权限相关表</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h1 id="部署canal"><a class="markdownIt-Anchor" href="#部署canal">#</a> 部署 Canal</h1>
<p>如果没有部署过 docker，看我之前写的<a target="_blank" rel="noopener" href="https://brath.top/2023/03/16/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/"> Linux 部署 Docker</a></p>
<h2 id="拉取镜像"><a class="markdownIt-Anchor" href="#拉取镜像">#</a> 拉取镜像</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<h2 id="挂载properties配置文件"><a class="markdownIt-Anchor" href="#挂载properties配置文件">#</a> 挂载 properties 配置文件</h2>
<p>先进行第一次运行，拷贝 properties 配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>拷贝运行后的容器中配置文件，用来文件挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建canal宿主机挂载目录</span></span><br><span class="line">mkdir -p /opt/canal/conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看docker运行情况，复制容器<span class="built_in">id</span></span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝配置文件</span></span><br><span class="line">docker cp 容器id:/home/admin/canal-server/conf/example/instance.properties  /opt/canal/conf/</span><br></pre></td></tr></table></figure>
<p>移除当前容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop canal</span><br><span class="line">docker rm canal</span><br></pre></td></tr></table></figure>
<p>修改配置文件<br>
<img src="https://img-blog.csdnimg.cn/c51d4265e36e4e3d862f103eb0367a42.png" alt="在这里插入图片描述"></p>
<h2 id="创建容器"><a class="markdownIt-Anchor" href="#创建容器">#</a> 创建容器</h2>
<p>运行新的容器，同时挂载修改后的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -v /opt/canal/conf/instance.properties:/home/admin/canal-server/conf/example/instance.properties -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>开放端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=11111/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/6/">上一页</a></div><div class="pagination-next"><a href="/page/8/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><a class="pagination-link is-current" href="/page/7/">7</a></li><li><a class="pagination-link" href="/page/8/">8</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/13/">13</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T08:51:33.000Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Java%E3%80%91%E5%85%B3%E4%BA%8EPO%E3%80%81BO%E3%80%81VO%E3%80%81DTO%E3%80%81DAO%E3%80%81POJO%E7%AD%89%E6%A6%82%E5%BF%B5%E7%9A%84%E7%90%86%E8%A7%A3/">【Java】关于PO、BO、VO、DTO、DAO、POJO等概念的理解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T04:58:33.000Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90Dubbo%E3%80%91%E4%BD%BF%E7%94%A8Dubbo%E6%95%B4%E5%90%88SpringBoot%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1/">【Dubbo】使用Dubbo整合SpringBoot搭建一个服务</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T04:23:33.000Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E4%BD%BF%E7%94%A8Java%E5%AE%9E%E7%8E%B0%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%8C%E5%A4%AA%E9%85%B7%E5%95%A6/">【算法】使用Java实现斐波那契数列的三种方法，太酷啦</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T04:23:33.000Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97%E7%9A%84%E6%A6%82%E5%BF%B5/">【算法】斐波那契数列的概念</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-24T01:45:16.000Z">2023-04-24</time></p><p class="title"><a href="/2023/04/24/%E3%80%90Vue%E3%80%91%E4%BF%AE%E5%A4%8Delement%E5%8F%AF%E6%90%9C%E7%B4%A2%E4%B8%8B%E6%8B%89%E6%A1%86%E9%80%89%E4%B8%AD%E9%80%89%E9%A1%B9%EF%BC%8C%E5%88%87%E5%B1%8F%E5%90%8E%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%8E%B7%E5%8F%96%E7%84%A6%E7%82%B9%EF%BC%8C%E8%8F%9C%E5%8D%95%E8%87%AA%E5%8A%A8%E5%BC%B9%E5%87%BA/">【Vue】修复element可搜索下拉框选中选项，切屏后，会自动获取焦点，菜单自动弹出</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">125</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">125</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>