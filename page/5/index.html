<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.337Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.941Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">19 分钟读完 (大约2868个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MYSQL%E3%80%91%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%85%AC%E5%85%B1%E8%A1%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%92%8C%E8%AE%B2%E8%A7%A3/">【MYSQL】水平分表、分库和垂直分表、分库和公共表的代码实现和讲解</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li><a href="#_1">一、教学讲解视频</a></li>
<li><a href="#_3">二、环境准备</a></li>
<li><a href="#_99">三、水平分表</a></li>
<li>
<ul>
<li><a href="#1_100">1. 概念</a></li>
<li><a href="#2_114">2. 代码</a></li>
</ul>
</li>
<li><a href="#_221">四、水平分库</a></li>
<li>
<ul>
<li><a href="#1_223">1. 概念</a></li>
<li><a href="#2_229">2. 代码</a></li>
</ul>
</li>
<li><a href="#_351">五、垂直分表</a></li>
<li>
<ul>
<li><a href="#1_352">1. 概念</a></li>
<li><a href="#2_356">2. 代码</a></li>
</ul>
</li>
<li><a href="#_358">六、垂直分库</a></li>
<li>
<ul>
<li><a href="#1_359">1. 概念</a></li>
<li><a href="#2_362">2. 代码</a></li>
</ul>
</li>
<li><a href="#_364">七、公共表</a></li>
<li>
<ul>
<li><a href="#1_365">1. 概念</a></li>
<li><a href="#2_367">2. 代码</a></li>
</ul>
</li>
</ul>
<h1 id="一-教学讲解视频"><a class="markdownIt-Anchor" href="#一-教学讲解视频">#</a> 一、教学讲解视频</h1>
<p>教学讲解视频地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tx4y1371w">视频地址</a></p>
<h1 id="二-环境准备"><a class="markdownIt-Anchor" href="#二-环境准备">#</a> 二、环境准备</h1>
<ul>
<li>
<p>操作系统：Win10</p>
</li>
<li>
<p>数据库：MySQL5.7</p>
</li>
<li>
<p>JDK：64 位 jdk1.8.0_202</p>
</li>
<li>
<p>应用框架：spring-boot-2.1.3.RELEASE</p>
</li>
<li>
<p>Sharding-JDBC：sharding-jdbc-spring-boot-starter-4.0.0-RC1</p>
</li>
</ul>
<p>对应的 pom.xml 依赖代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yjq.programmer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入mysql连接依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入sharding-jdbc连接依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0-RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入阿里巴巴druid连接池--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入测试依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 集成mybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 集成junit测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="三-水平分表"><a class="markdownIt-Anchor" href="#三-水平分表">#</a> 三、水平分表</h1>
<h2 id="1概念"><a class="markdownIt-Anchor" href="#1概念">#</a> 1. 概念</h2>
<p>水平分表是在 <code>同一个</code> 数据库内，把同一个表的数据 <code>按一定规则</code> 拆分到多个 <code>表</code> 中。<br>
因此，目前我在一个数据库中准备了两个表， <code>t_user_1</code>  和 <code>t_user_2</code> ，如下图。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b9b8ccb2a36e4028bb013590fc3e84ea.png" alt="在这里插入图片描述"><br>
表结构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_user_1` (</span><br><span class="line">  `<span class="built_in">id</span>` bigint(20) NOT NULL,</span><br><span class="line">  `name` varchar(100) DEFAULT NULL,</span><br><span class="line">  `sex` int(2) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="2代码"><a class="markdownIt-Anchor" href="#2代码">#</a> 2. 代码</h2>
<p>①我们先来看下我们的 SpringBoot 的 <code>配置文件</code> 代码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义数据源</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driver‐class‐name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的数据分布情况，配置数据节点</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actual‐data‐nodes=m1.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的主键生成策略为SNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.key‐generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.key‐generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的分表策略，分表策略包括分片键和分片算法</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.table‐strategy.inline.sharding‐column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.table‐strategy.inline.algorithm‐expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制台日志配置</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开sql输出日志</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapper文件扫描路径</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>首先定义数据源 m1，并对 m1 进行实际的参数配置。</li>
<li>指定 t_user 表的数据分布情况，他分布在 m1.t_user_1，m1.t_user_2。</li>
<li>指定 t_user 表的主键生成策略为 SNOWFLAKE，SNOWFLAKE 是一种分布式自增算法，保证 id 全局唯一。</li>
<li>定义 t_user 分表策略，id 为偶数的数据落在 t_user_1，为奇数的落在 t_user_2，所以分表策略的表达式为 t_user_$-&gt;{id% 2 + 1}。</li>
</ul>
<p><strong>踩坑注意！</strong> 如果启动项目有如下报错，可能是配置文件中的 <code>-&gt;</code>  没有用英文类型的。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1b3e0aca06df43c4bb2671eabc7a2e9d.png" alt="在这里插入图片描述"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9a9e406ab2bd4e3db3c55aac18a9b178.png" alt="在这里插入图片描述"></p>
<p>②然后接下来就写我们的 <code>dao</code>  层、 <code>mapper</code>  层和 <code>单元测试</code> 的代码，去测试我们的水平分表情况下 <code>插入</code> 和 <code>查询</code> 的结果。</p>
<p><code>dao</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name) values (<span class="comment">#&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">单元测试</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;小明&quot;</span> + i);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;插入成功！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;插入失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser();</span><br><span class="line">    logger.info(<span class="string">&quot;查询结果：&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>③结果说明<br>
 <code>插入</code> <br>
 id 为奇数的被插入到 t_user_2 表，为偶数的被插入到 t_user_1 表，达到预期目标。<br>
 <code>查询</code> <br>
<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=sharding-jdbc&amp;spm=1001.2101.3001.7020"> sharding-jdbc</a> 分别去不同的表检索数据，达到预期目标；<strong>如果有传入 id 进行查询，sharding-jdbc 也会根据 t_user 的分表策略去不同的表检索数据</strong>。</p>
<h1 id="四-水平分库"><a class="markdownIt-Anchor" href="#四-水平分库">#</a> 四、水平分库</h1>
<h2 id="1概念-2"><a class="markdownIt-Anchor" href="#1概念-2">#</a> 1. 概念</h2>
<p>水平分库是把同一个表的数据按 <code>一定规则</code> 拆分到不同的 <code>数据库</code> 中，每个库可以放在不同的服务器上。<br>
现在，我在 <code>水平分表</code> 的基础上多加了一个 db_user2 的数据库。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/80d1a3af2700414b9a0850ae9172034a.png" alt="在这里插入图片描述"><br>
然后两个数据库中的表结构是一致的，表结构和上面水平分表用的保持一样。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9354ea1b1af043238412581e0769b3dd.png" alt="在这里插入图片描述"></p>
<h2 id="2代码-2"><a class="markdownIt-Anchor" href="#2代码-2">#</a> 2. 代码</h2>
<p>①我们先来看下我们的 SpringBoot 的 <code>配置文件</code> 代码。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义数据源</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1,m2</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driver‐class‐name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m2.url=jdbc:mysql://127.0.0.1:3306/db_user2?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m2.username=root</span><br><span class="line">spring.shardingsphere.datasource.m2.password=</span><br><span class="line">spring.shardingsphere.datasource.m2.driver‐class‐name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m2.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分库策略</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.database‐strategy.inline.sharding‐column=sex</span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.database‐strategy.inline.algorithm‐expression=m$-&gt;&#123;sex % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的数据分布情况，配置数据节点</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actual‐data‐nodes=m$-&gt;&#123;1..2&#125;.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的主键生成策略为SNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.key‐generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.key‐generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定t_user表的分表策略，分表策略包括分片键和分片算法</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.table‐strategy.inline.sharding‐column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.table‐strategy.inline.algorithm‐expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 控制台日志配置</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开sql输出日志</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapper文件扫描路径</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>配置了两个数据源，分配指向两个不同的数据库 db_user1 和 db_user2。</li>
<li>配置分库策略，sex 字段为偶数的数据落在 m1 数据源，为奇数的落在 m2 数据源，所以分库策略的表达式为 m$-&gt;{sex % 2 + 1}。</li>
<li>配置分表策略，分表策略和上面水平分表保持一致。</li>
<li>也就是当有数据来时，先根据 sex 字段判断落入哪个数据源，然后再根据 id 字段来判断落入哪个表中。</li>
</ul>
<p>②然后接下来就写我们的 <code>dao</code>  层、 <code>mapper</code>  层和 <code>单元测试</code> 的代码，去测试我们的水平分表情况下 <code>插入</code> 和 <code>查询</code> 的结果。</p>
<p><code>dao</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name, sex) values (<span class="comment">#&#123;name&#125;, #&#123;sex&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user t <span class="built_in">where</span> t.sex = <span class="comment">#&#123;sex&#125; and t.id = #&#123;id&#125;</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">单元测试</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;小明&quot;</span> + i);</span><br><span class="line">        user.setSex(1);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;插入成功！&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;插入失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setSex(1);</span><br><span class="line">    user.setId(821357967667363840L);</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser(user);</span><br><span class="line">    logger.info(<span class="string">&quot;查询结果：&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>③结果说明<br>
 <code>插入</code> <br>
 sex 字段为奇数的数据落入 m2 数据源，为偶数的落入 m1 数据源。同时 id 字段值为奇数的，插入 t_user_2 表中，为偶数的插入 t_user_1 表中，达到预期目标。<br>
 <code>查询</code> <br>
 sharding-jdbc 分别去不同的表检索数据，达到预期目标；<strong>如果有传入 sex 进行查询，sharding-jdbc 会根据 t_user 的分库策略去锁定查哪个库，如果有传入 id 进行查询，sharding-jdbc 会根据 t_user 的分表策略去锁定查哪个表</strong>。</p>
<h1 id="五-垂直分表"><a class="markdownIt-Anchor" href="#五-垂直分表">#</a> 五、垂直分表</h1>
<h2 id="1概念-3"><a class="markdownIt-Anchor" href="#1概念-3">#</a> 1. 概念</h2>
<p>垂直分表一般就是把表的结构进行改造，关于如何改造，可以浏览我的另一篇博客：<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">分库分表：垂直分库、垂直分表、水平分库、水平分表四个概念</a><br>
<strong>大致的思路就是：将一个表按照字段分成多表，每个表存储其中一部分字段。</strong></p>
<h2 id="2代码-3"><a class="markdownIt-Anchor" href="#2代码-3">#</a> 2. 代码</h2>
<p>无代码，垂直分表属于表结构设计层面。</p>
<h1 id="六-垂直分库"><a class="markdownIt-Anchor" href="#六-垂直分库">#</a> 六、垂直分库</h1>
<h2 id="1概念-4"><a class="markdownIt-Anchor" href="#1概念-4">#</a> 1. 概念</h2>
<p>垂直分库就是在 <code>垂直分表</code> 把表进行分类后，放到 <code>不同的数据库</code> 中。每个库可以放在不同的服务器上，它的核心理念是 <code>专库专用</code> 。关于如何改造，同样可以浏览我的另一篇博客：<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">分库分表：垂直分库、垂直分表、水平分库、水平分表四个概念</a></p>
<h2 id="2代码-4"><a class="markdownIt-Anchor" href="#2代码-4">#</a> 2. 代码</h2>
<p>无代码，垂直分库属于数据库设计层面。</p>
<h1 id="七-公共表"><a class="markdownIt-Anchor" href="#七-公共表">#</a> 七、公共表</h1>
<h2 id="1概念-5"><a class="markdownIt-Anchor" href="#1概念-5">#</a> 1. 概念</h2>
<p>公共表属于系统中数据量较小，变动少，而且属于高频联合查询的依赖表。参数表、数据字典表等属于此类型。 <code>可以将这类表在每个数据库都保存一份</code> ，所有更新操作都同时发送到所有分库执行。</p>
<h2 id="2代码-5"><a class="markdownIt-Anchor" href="#2代码-5">#</a> 2. 代码</h2>
<p>①只需要在 SpringBoot 的 <code>配置文件</code> 中加入下面这行来指明公共表就行。<br>
 <code>如果有多个公共表，用逗号拼接就行</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#公共表设置</span></span><br><span class="line">spring.shardingsphere.sharding.broadcast‐tables=t_dict</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>②然后接下来就写我们的 <code>dao</code>  层、 <code>mapper</code>  层和 <code>单元测试</code> 的代码，去测试我们的公共表的 <code>插入</code> 的结果。<br>
 <code>dao</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface DictDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertDict(Dict dict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  层</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.DictDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertDict&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.Dict&quot;</span>&gt;</span><br><span class="line">        insert into t_dict(<span class="built_in">id</span>, name) values (<span class="comment">#&#123;id&#125;, #&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910</span><br><span class="line">单元测试</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsertDict</span></span>() &#123;</span><br><span class="line">    Dict dict = new Dict();</span><br><span class="line">    dict.setId(1);</span><br><span class="line">    dict.setName(<span class="string">&quot;字典名称&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(dictDao.insertDict(dict) == 1) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;插入成功！&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;插入失败！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>③结果说明<br>
 <code>插入</code> <br>
插入的数据在 <code>每个库中的对应的公共表</code> 中都能看到，达到预期目标。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.333Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.935Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">4 分钟读完 (大约544个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91%E5%AE%9D%E5%A1%94%E9%83%A8%E7%BD%B2Docker%E2%80%94Mysql%E9%95%9C%E5%83%8F/">宝塔部署Docker—Mysql镜像</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>转自 <a target="_blank" rel="noopener" href="https://blog.csdn.net/u011630259/article/details/124497343">https://blog.csdn.net/u011630259/article/details/124497343</a></p>
<h2 id="宝塔部署dockermysql镜像"><a class="markdownIt-Anchor" href="#宝塔部署dockermysql镜像">#</a> 宝塔部署 Docker—Mysql 镜像</h2>
<p>如何在面板上使用 Docker 项目管理器快速创建多个版本的 MySQL？手把手的教你如何创建多个版本的 MySQL 服务<br>
环境介绍：<br>
宿主机：CentOS7.9<br>
 配置：2 核 4G（测试机器，生产环境建议配置高点）<br>
面板版本：7.9.26（测试版）<br>
Docker 项目管理器：3.9</p>
<p><img src="https://brath.cloud/blogImg/90825147a852493a8feea8efc0220deb.png" alt="img"></p>
<p>Docker 版本：Docker version 20.10.14, build a224086<br>
 测试 MySQL 版本：<br>
MySQL5.7.37<br>
MySQL8.0.28<br>
1、获取 MySQL 版本</p>
<p><img src="https://brath.cloud/blogImg/0241ca9c68d545819f8f100b33b2d8b9.png" alt="img"></p>
<p><img src="https://brath.cloud/blogImg/90825147a852493a8feea8efc0220deb.png" alt=""></p>
<p>默认情况下，直接输入 mysql 名，会拉取 mysql:latest 镜像，就是最新版本的镜像，指定版本后拉取的是指定版本的 MySQL 镜像，如 mysql:5.7.37</p>
<p><img src="https://brath.cloud/blogImg/2418dbfa7fac47bbac12fd3abe9e7229.png" alt="img"></p>
<p>2、创建容器：</p>
<p>指定容器中数据库的密码：</p>
<p><img src="https://brath.cloud/blogImg/5d2c09a1667744fd9538381efd7b67b0.png" alt="img"></p>
<p>MYSQL_ROOT_PASSWORD=dapaotest1</p>
<p><img src="https://brath.cloud/blogImg/241882e051fd4940bd09e98f61369215.png" alt="img"></p>
<p>3、容器创建成功后，进入终端命令行查看数据库</p>
<p><img src="https://brath.cloud/blogImg/f6245e7abacc4d768dd616d4067c3a4a.png" alt="img"></p>
<p>4、创建数据库表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">查看数据库的命令</span><br><span class="line">show databases;</span><br><span class="line">创建数据库的命令</span><br><span class="line">create database dapaodocker;</span><br><span class="line">创建用户的命令</span><br><span class="line">create user &#x27;dapaodocker&#x27;@&#x27;%&#x27; identified by &#x27;dapao666!&#x27;;</span><br><span class="line">授权</span><br><span class="line">grant all on dapaodocker.* to dapaodocker@&#x27;%&#x27;;</span><br><span class="line"></span><br><span class="line">查看用户权限</span><br><span class="line">select host,user from user;</span><br><span class="line">测试数据库是否可以连接</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.cloud/blogImg/ee582242679c4da1b2fc04db16bad384.png" alt="img"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.331Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.874Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">3 分钟读完 (大约394个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91MySQL%E4%B8%BB%E4%BB%8E%E5%BC%80%E5%85%B3%E6%9C%BA%E9%A1%BA%E5%BA%8F/">【MySQL】MySQL主从开关机顺序</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>MySQL 主从开关机顺序<br>
停应用 -&gt; 停数据库（先备后主） -&gt; 改配置 -&gt; 启数据库（先主后备）-&gt; 启应用</p>
<p>关闭 MySQL 从库<br>
 a. 先查看当前的主从同步状态 show slave statusG; 看是否双 yes<br>
b. 执行 stop slave<br>
c. 停止从库服务 mysqladmin shutdown -u 用户名 -p 密码<br>
 d. 查看是否还有 mysql 的进程 ps -ef | grep mysql<br>
d. 如果部署了多个实例，那每个实例都要按照以上步骤来操作</p>
<p>关闭 MySQL 主库<br>
 a. 停止主库服务 mysqladmin shutdown -u 用户名 -p 密码<br>
 b. 查看是否还有 mysql 的进程 ps -ef | grep mysql</p>
<p>启动 MySQL 主库<br>
 a. 启动主库服务 mysqladmin start -u 用户名 -p 密码<br>
 b. 查看 mysql 的进程 ps -ef | grep mysql</p>
<p>启动 MySQL 从库<br>
 a. 启动从库服务 mysqladmin start -u 用户名 -p 密码<br>
 b. 启动复制 start slave;<br>
c. 检查同步状态 show slave statusG; 是否双 yes<br>
d. 查看 mysql 的进程 ps -ef | grep mysql</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.328Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.882Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">15 分钟读完 (大约2268个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91Mysql%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4/">Mysql主从集群搭建文档，实现读写分离</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="mysql主从集群搭建文档实现读写分离"><a class="markdownIt-Anchor" href="#mysql主从集群搭建文档实现读写分离">#</a> Mysql 主从集群搭建文档，实现读写分离</h2>
<p>​		最近在自己写的项目中需要应对大量的用户查询读写操作，一台服务器当然是不够的，所以在边学边敲的背景下，记录这篇笔记，从 0 开始搭建主从集群。</p>
<h4 id="下面开始操作"><a class="markdownIt-Anchor" href="#下面开始操作">#</a> 下面👇开始操作：</h4>
<p>1. 分别在两台服务器搭建 mysql 服务</p>
<p>​		两台服务器的 IP 地址分别为主服务器（192.168.20.1）和从服务器（192.168.20.2）。<br>
2. 配置文件 my.cnf 的修改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据上一篇文章，编辑my.cnf文件</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在[mysqld]中添加：</span></span><br><span class="line">server-id=1</span><br><span class="line">log_bin=master-bin</span><br><span class="line">log_bin_index=master-bin.index</span><br><span class="line">binlog_do_db=test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id 服务器唯一标识。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_bin 启动MySQL二进制日志，即数据同步语句，从数据库会一条一条的执行这些语句。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_do_db 指定记录二进制日志的数据库，即需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_ignore_db 指定不记录二进制日志的数据库，即不需要复制的数据库名，如果有多个数据库，重复设置这个选项即可。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其中需要注意的是，binlog_do_db和binlog_ignore_db为互斥选项，一般只需要一个即可。</span></span><br></pre></td></tr></table></figure>
<p>3. 创建从服务器的用户和权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入mysql数据库</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建从数据库的root用户和权限</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave on *.* to root@<span class="string">&#x27;192.168.20.%&#x27;</span> identified by <span class="string">&#x27;Lgq081538&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">grant replication slave on *.* to &#x27;123456&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">192.168.20.%通配符，表示0-255的IP都可访问主服务器，正式环境请配置指定从服务器IP</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">若将 192.168.20.% 改为 %，则任何ip均可作为其从数据库来访问主服务器</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出mysql</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span>;</span></span><br></pre></td></tr></table></figure>
<p>4. 重启 mysql 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>5. 查看主服务器状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入mysql数据库</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看主服务器状态</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| master-bin.000001 |      154 | test         |                  |                   |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>6.slave 从服务器的配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">配置文件my.cnf的修改</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">根据上一篇文章，编辑my.cnf文件</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在[mysqld]中添加：</span></span><br><span class="line">server-id=2</span><br><span class="line">relay-log=slave-relay-bin</span><br><span class="line">relay-log-index=slave-relay-bin.index</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db=<span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id 服务器唯一标识，如果有多个从服务器，每个服务器的server-id不能重复，跟IP一样是唯一标识，如果你没设置server-id或者设置为0，则从服务器不会连接到主服务器。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">relay-log 启动MySQL二进制日志，可以用来做数据备份和崩溃恢复，或主服务器挂掉了，将此从服务器作为其他从服务器的主服务器。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db 指定同步的数据库，如果复制多个数据库，重复设置这个选项即可。若在master端不指定binlog-do-db，则在slave端可用replication-do-db来过滤。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-ignore-db 不需要同步的数据库，如果有多个数据库，重复设置这个选项即可。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其中需要注意的是，replicate-do-db和replicate-ignore-db为互斥选项，一般只需要一个即可。</span></span><br></pre></td></tr></table></figure>
<p>7. 重启 mysql 服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>8. 连接 master 主服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入mysql数据库</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">连接master主服务器</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to master_host=<span class="string">&#x27;192.168.20.1&#x27;</span>,master_port=3306,master_user=<span class="string">&#x27;root&#x27;</span>,master_password=<span class="string">&#x27;123456&#x27;</span>,master_log_file=<span class="string">&#x27;master-bin.000009&#x27;</span>,master_log_pos=473127;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备注：</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_host对应主服务器的IP地址。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_port对应主服务器的端口。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_file对应show master status显示的File列：master-bin.000001。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_pos对应show master status显示的Position列：154。</span></span><br></pre></td></tr></table></figure>
<p>9. 启动 slave 数据同步</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动slave数据同步</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止slave数据同步（若有需要）</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">stop slave;</span></span><br><span class="line">3.5 查看slave信息</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status\G;</span></span><br><span class="line">Slave_IO_Running和Slave_SQL_Running都为yes，则表示同步成功。</span><br></pre></td></tr></table></figure>
<p>10. 测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">（1）在主服务器上登陆mysql，且进入test数据库，创建test表，且插入一条数据</span><br><span class="line">提示：这里最好用数据库管理工具（如nacicat）来操作。</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建tb_test表</span></span><br><span class="line">create table tb_test(ID varchar(36) primary key comment &#x27;主键ID&#x27;,MEMO varchar(500) not null comment &#x27;信息&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">插入一条数据</span></span><br><span class="line">insert into tb_test(ID,MEMO) values(&#x27;1&#x27;,&#x27;one test&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">提交</span></span><br><span class="line">commit;</span><br><span class="line">（2）在从服务器上登陆mysql，且进入test数据库</span><br><span class="line">你会发现从数据库中，也出现了tb_test表，且表中还有one test数据存在，证明同步数据成功。</span><br></pre></td></tr></table></figure>
<h3 id="至此mysql主从读写分离搭建完成"><a class="markdownIt-Anchor" href="#至此mysql主从读写分离搭建完成">#</a> 至此 Mysql 主从读写分离搭建完成</h3>
<p>下面开始搭建 Spring Boot 项目中的相关配置以及实现👇</p>
<p>​		读写分离要做的事情就是对于一条 SQL 该选择哪个数据库去执行，至于谁来做选择数据库这件事，主要有两种实现方式，分别为：<br>
1. 使用中间件，比如 Atlas，cobar，TDDL，mycat，heisenberg，Oceanus，vitess，OneProxy 等<br>
 2. 使用程序自己实现，利用 Spring Boot 提供的路由数据源以及 AOP，实现起来简单快捷<br>
​</p>
<p>​		我们使用第二种方式 Spring Boot 数据源路由 + AOP ，这样能更好的控制流程，也便于后期提升性能；</p>
<p>代码实现<br>
 1. 首先配置下 pom.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=xml&amp;spm=1001.2101.3001.7020">xml</a> 因为我们使用 aop 实现，所以需要 aop 依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2. 数据源路由类功能 RoutingDataSource.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 数据源路由类功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DBContext.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3. 数据源上下文类 DBContext.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 数据源上下文类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;DBTypeEnum&gt; dbContext = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(DBTypeEnum dbType)</span> &#123;</span><br><span class="line">        dbContext.set(dbType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DBTypeEnum <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dbContext.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">master</span><span class="params">()</span> &#123;</span><br><span class="line">        set(DBTypeEnum.MASTER);</span><br><span class="line">        log.info(<span class="string">&quot;切换到master库&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">slave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//  读库负载均衡(轮询方式)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> counter.getAndIncrement() % <span class="number">2</span>;</span><br><span class="line">        log.info(<span class="string">&quot;slave库访问线程数==&gt;&#123;&#125;&quot;</span>, counter.get());</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE1);</span><br><span class="line">            log.info(<span class="string">&quot;切换到slave1库&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE2);</span><br><span class="line">            log.info(<span class="string">&quot;切换到slave2库&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4. 数据库枚举类 DBTypeEnum.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 数据库枚举类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DBTypeEnum</span> &#123;</span><br><span class="line">    MASTER, <span class="comment">//主库</span></span><br><span class="line">    SLAVE1, <span class="comment">//从库1</span></span><br><span class="line">    SLAVE2  <span class="comment">//从库2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里我们配置三个库，分别是一个写库 Master，2 个读库 slave1,slave2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 数据库配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfigs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.master&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">masterDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave1DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave2DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">myRoutingDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;masterDataSource&quot;)</span> DataSource masterDataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave1DataSource&quot;)</span> DataSource slave1DataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave2DataSource&quot;)</span> DataSource slave2DataSource)</span> &#123;</span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DBTypeEnum.MASTER, masterDataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE1, slave1DataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE2, slave2DataSource);</span><br><span class="line">        <span class="type">RoutingDataSource</span> <span class="variable">routingDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoutingDataSource</span>();</span><br><span class="line">        routingDataSource.setDefaultTargetDataSource(masterDataSource);</span><br><span class="line">        routingDataSource.setTargetDataSources(targetDataSources);</span><br><span class="line">        <span class="keyword">return</span> routingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6. 切面类 DataSourceAop.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 切面类DataSourceAop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAop</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.insert*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.create*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.save*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.add*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.update*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.edit*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.delete*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.remove*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writePointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;!@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;&amp;&amp; (execution(* com.example.demo.*.service..*.select*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.list*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.count*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.get*(..)))&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readPointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;writePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.master();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;readPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.slave();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>7. 注解类 Master.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * 注解类Master 主库，可读写</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Master &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.324Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.914Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">24 分钟读完 (大约3586个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91MySql%E7%9B%B8%E5%85%B3%E4%BC%98%E5%8C%96%E5%88%86%E4%BA%AB/">【MySQL】MySql相关优化分享</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="mysqlmysql相关优化分享"><a class="markdownIt-Anchor" href="#mysqlmysql相关优化分享">#</a> 【MySQL】MySql 相关优化分享</h1>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li><a href="#_5">前言</a></li>
<li><a href="#_12">一、数据库优化</a></li>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#1_13">1. 选择合适存储引擎</a></li>
<li><a href="#2_22">2. 选择合适的连接池</a></li>
<li><a href="#3_31">3. 分库分表</a></li>
<li><a href="#4_39">4. 主从同步</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_47">二、表优化</a></li>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#1_49">1. 表中的字段选择合适的数据类型</a></li>
<li><a href="#2_59">2. 适当添加索引</a></li>
<li><a href="#3_66">3. 表中适当保留冗余数据</a></li>
<li><a href="#4_75">4. 增加中间表</a></li>
<li><a href="#5_78">5. 字段很多的表分解成多个表</a></li>
<li><a href="#6_82">6. 添加适当存储过程</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#SQL_95">三、SQL 语句优化</a></li>
<li>
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#1_96">1. 尽量使用表的别名，减少解析</a></li>
<li><a href="#2select_100">2.select 子句中避免使用 * 号</a></li>
<li><a href="#3where_109">3. 将 where 中用的比较频繁的字段建立索引，避免全表扫描</a></li>
<li><a href="#4_123">4. 避免索引失效情况</a></li>
<li><a href="#5limit_1_136">5. 当只需要一条数据的时候可以使用 limit 1</a></li>
<li><a href="#6Where_140">6. 调整 Where 字句中的连接顺序</a></li>
<li><a href="#7_144">7. 小表驱动大表</a></li>
<li><a href="#8_EXPLAIN_SQL_160">8. 善用 EXPLAIN 查看 SQL 执行计划</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p><strong>现在在网上搜索，有很多类似文章，mysql 优化大全，mysql 最强总结等等，部分文章存在一些错误。在这里个人总结整理的一些点，希望对大家有所帮助。</strong></p>
<p>本篇从数据库、表、sql 语句几个维度来说优化，如果文章有误之处欢迎指正～</p>
<hr>
<h1 id="一-数据库优化"><a class="markdownIt-Anchor" href="#一-数据库优化">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96&amp;spm=1001.2101.3001.7020">数据库优化</a></h1>
<h4 id="1选择合适存储引擎"><a class="markdownIt-Anchor" href="#1选择合适存储引擎">#</a> 1. 选择合适<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E&amp;spm=1001.2101.3001.7020">存储引擎</a></h4>
<blockquote>
<p>MySQL5.5 版本开始，InnoDB 已经成为 Mysql 的默认引擎 (之前是 MyISAM)，说明其优势是有目共睹的。如果你不知道用什么存储引擎，那就用 InnoDB，至少不会差。</p>
</blockquote>
<p>如何选择呢：</p>
<ol>
<li>是否要支持事务，如果要请选择 InnoDB，如果不需要可以考虑 MyISAM；</li>
<li>如果表中绝大多数都只是读查询，可以考虑 MyISAM，如果既有读，写也挺频繁，请使用 InnoDB。</li>
<li>系统奔溃后，MyISAM 恢复起来更困难，能否接受，不能接受就选 InnoDB；</li>
</ol>
<h4 id="2选择合适的连接池"><a class="markdownIt-Anchor" href="#2选择合适的连接池">#</a> 2. 选择合适的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E8%BF%9E%E6%8E%A5%E6%B1%A0&amp;spm=1001.2101.3001.7020">连接池</a></h4>
<blockquote>
<p>1：性能方面 hikariCP&gt;druid&gt;tomcat-jdbc&gt;dbcp&gt;c3p0 。hikariCP 的高性能得益于最大限度的避免锁竞争。<br>
2：druid 功能最为全面，sql 拦截等功能，统计数据较为全面，具有良好的扩展性。<br>
3：HikariCP 因为细节方面优化力度较大，性能方面强于 Druid<br>
4：综合性能，扩展性等方面，可考虑使用 druid 或者 hikariCP 连接池。</p>
</blockquote>
<p>注：SpringBoot 2.0 以后默认连接池是 hikariCP。</p>
<h4 id="3分库分表"><a class="markdownIt-Anchor" href="#3分库分表">#</a> 3. 分库分表</h4>
<blockquote>
<p>在数据量增长和增长速度越来越高的情况下，单库可能在容量、IO、并发性能上都无法支撑，这个时候就要对业务进行切分或数据库进行扩展，数据库的扩展也就是分库分表。</p>
</blockquote>
<p>分库分表的方式有垂直拆分和水平拆分。<br>
垂直拆分是根据业务进行拆分，这种拆分不能解决单业务点数据量大的问题。<br>
水平拆分是根据某一列进行拆分（如 id，userId），拆分后的每个库结构一致。</p>
<h4 id="4主从同步"><a class="markdownIt-Anchor" href="#4主从同步">#</a> 4. 主从同步</h4>
<blockquote>
<p>一般部署架构为一台 Master 和 n 台 Slave，Master 的主责为写，并将数据同步至 Slave，Slave 主要提供查询功能。</p>
</blockquote>
<p>可以使用数据库中间件，例如 MyCat 来实现。MyCat 的读写分离是建立在 MySQL 主从复制基础之上实现的，Mycat 读写分离和自动切换机制，需要 mysql 的主从复制机制配合。</p>
<hr>
<h1 id="二-表优化"><a class="markdownIt-Anchor" href="#二-表优化">#</a> 二、表优化</h1>
<h4 id="1表中的字段选择合适的数据类型"><a class="markdownIt-Anchor" href="#1表中的字段选择合适的数据类型">#</a> 1. 表中的字段选择合适的数据类型</h4>
<blockquote>
<ul>
<li>能用数字类型，就不用字符串，因为字符的处理往往比数字要慢。</li>
<li>尽可能使用小的类型，比如：用 bit 存布尔值，用 tinyint 存枚举值等。</li>
<li>长度固定的字符串字段，用 char 类型，该类型的字段存储空间的固定的。</li>
<li>长度可变的字符串字段，用 varchar 类型，该类型的字段存储空间会根据实际数据的长度调整，不会浪费存储空间。</li>
<li>金额字段用 decimal，避免精度丢失问题。</li>
</ul>
</blockquote>
<p>1、当一个列可以选择多种数据类型时，应该优先考虑数字类型，其次是日期和二进制类型，最后是字符类型。<br>
2、对于相同级别的数据类型，应该优先选择占用空间小的数据类型。</p>
<h4 id="2适当添加索引"><a class="markdownIt-Anchor" href="#2适当添加索引">#</a> 2. 适当添加索引</h4>
<blockquote>
<ul>
<li>MySQL 里同一个数据表里的索引总数限制为 16 个。</li>
<li>索引尽量的扩展索引，不要新建索引。</li>
<li>在表中建立索引，优先考虑 where、order by 使用到的字段。</li>
<li>阿里巴巴的开发者手册中规定，单表的索引数量应该尽量控制在 5 个以内，并且单个索引中的字段数不超过 5 个。</li>
</ul>
</blockquote>
<h4 id="3表中适当保留冗余数据"><a class="markdownIt-Anchor" href="#3表中适当保留冗余数据">#</a> 3. 表中适当保留冗余数据</h4>
<blockquote>
<ul>
<li>没有冗余的数据库未必是最好的数据库，有时为了提高运行效率，提高读性能，就必须降低范式标准，适当保留冗余数据。</li>
<li>虽然三大范式是为了解决数据库冗余的问题，但是阿里开发手册中提到可以适当的违反范式，允许少量的冗余，以便提高查询效率，也就是使用空间换时间。</li>
</ul>
</blockquote>
<p>具体做法是： 在概念数据模型设计时遵守第三范式，降低范式标准的工作放到物理数据模型设计时考虑。降低范式就是增加字段，减少了查询时的关联，提高查询效率。</p>
<h4 id="4增加中间表"><a class="markdownIt-Anchor" href="#4增加中间表">#</a> 4. 增加中间表</h4>
<blockquote>
<p>对于需要经常联合查询的表，可以建立中间表以提高查询效率。通过建立中间表，把需要经常联合查询的数据插入到中间表中，然后将原来的联合查询改为对中间表的查询，以此来提高查询效率。</p>
</blockquote>
<h4 id="5字段很多的表分解成多个表"><a class="markdownIt-Anchor" href="#5字段很多的表分解成多个表">#</a> 5. 字段很多的表分解成多个表</h4>
<blockquote>
<p>对于字段比较多的表，如果有些字段的使用频率很低，可以将这些字段分离出来形成新表。因为当一个表的数据量很大时，会由于使用频率低的字段的存在而变慢。</p>
</blockquote>
<h4 id="6添加适当存储过程"><a class="markdownIt-Anchor" href="#6添加适当存储过程">#</a> 6. 添加适当存储过程</h4>
<blockquote>
<p>一个存储过程是一个可编程的函数，它在数据库中创建并保存，一般由 SQL 语句和一些特殊的控制结构组成。当希望在不同的应用程序或平台上执行相同的特定功能时，存储过程尤为合适。</p>
</blockquote>
<p><strong>存储过程与 SQL 语句如何抉择：</strong></p>
<p>架构设计没有绝对，只有在当前的场景下最合适的。<br>
普通的项目开发中，不建议大量使用存储过程，对比 SQL 语句，存储过程适用于业务逻辑复杂，比较耗时，同时请求量较少的操作，例如后台大批量查询、定期更新等。<br>
（1）当一个事务涉及到多个 SQL 语句时或者涉及到对多个表的操作时可以考虑应用存储过程<br>
（2）在一个事务的完成需要很复杂的商业逻辑时可以考虑应用存储过程<br>
（3）比较复杂的统计和汇总可以考虑应用后台存储过程</p>
<hr>
<h1 id="三-sql语句优化"><a class="markdownIt-Anchor" href="#三-sql语句优化">#</a> 三、SQL 语句优化</h1>
<h4 id="1尽量使用表的别名减少解析"><a class="markdownIt-Anchor" href="#1尽量使用表的别名减少解析">#</a> 1. 尽量使用表的别名，减少解析</h4>
<blockquote>
<p>当在 SQL 语句中连接多个表时，使用表的别名并把别名前缀于每个 Column 上，这样一来，就可以减少解析的时间并减少那些由 Column 歧义引起的语法错误。</p>
</blockquote>
<h4 id="2select子句中避免使用号"><a class="markdownIt-Anchor" href="#2select子句中避免使用号">#</a> 2.select 子句中避免使用 * 号</h4>
<blockquote>
<ul>
<li>使用具体的列名，可以有效增加查询速度。</li>
<li>避免回表查询。<br>
比如你创建了 name， age 索引 name_age_index，查询数据时使用了：<br>
select * from table where name =‘陈哈哈’ and age = 26;<br>
 由于附加索引中只有 name 和 age，因此命中索引后，数据库还必须回去聚集索引中查找其他数据，这就是回表。</li>
<li>失去 MySQL 优化器 “覆盖索引” 策略优化的可能性。</li>
</ul>
</blockquote>
<h4 id="3将where中用的比较频繁的字段建立索引避免全表扫描"><a class="markdownIt-Anchor" href="#3将where中用的比较频繁的字段建立索引避免全表扫描">#</a> 3. 将 where 中用的比较频繁的字段建立索引，避免全表扫描</h4>
<blockquote>
<p>1. 普通索引：这是最基本的索引类型，而且它没有唯一性之类的限制。<br>
2. 唯一索引：和普通索引基本相同，只是索引列的所有值都只能出现一次，即必须唯一。<br>
3. 主键索引：就是 唯一 且 不能为空。主键索引是一种特殊的唯一索引。必须指定为 “PRIMARY KEY”。<br>
4. 联合索引：多列值组成一个索引，专门用于组合搜索。<br>
5. 全文索引：用于在一篇文章中，检索文本信息的，适合在进行模糊查询的时候使用。</p>
</blockquote>
<p>提示点：</p>
<ul>
<li>唯一索引和普通索引使用的结构都是 B+Tree, 执行时间复杂度都是 O。</li>
<li>如果在一个列上同时建唯一索引和普通索引的话，mysql 会自动选择唯一索引。</li>
<li>MySQL 建立联合索引时会遵守最左前缀匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。同时遇到范围查询 (&gt;、&lt;、between、like) 就会停止匹配。</li>
<li>索引区分度低的字段不要加索引，比如性别，如果添加了索引每次查询会先走索引树，再回表查询，增加了额外的 io 消耗。</li>
</ul>
<h4 id="4避免索引失效情况"><a class="markdownIt-Anchor" href="#4避免索引失效情况">#</a> 4. 避免索引失效情况</h4>
<p>索引失效情况</p>
<blockquote>
<p>1、like 查询以 “%” 开头；(这个范围非常大，所以没有使用索引的必要了)<br>
 2、or 查询左右都没有使用索引；(or 可以使用 unint)<br>
 3、联合索引中没有使用第一列索引；(为遵循最左匹配原则)<br>
 4、在 where 中索引列上使用 “not”，“&lt;&gt;”，“!=”；(不等于操作符可能不会用到索引的，产生全表扫描)<br>
 5、在 where 中索引列上使用函数或进行计算操作，索引失效。(更改字段导致失效)<br>
 6、如果 mysql 觉得全表扫描更快时（数据少时）<br>
7、在索引列上使用 “IS NULL” 或 “IS NOT NULL” 操作，索引可能失效（如果列上全部数据不为空，索引会失效，但是如果有空值，索引不会失效）<br>
…</p>
</blockquote>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3e82ac92263241049d3cfdd7aedc9d24.png" alt="在这里插入图片描述"></p>
<h4 id="5当只需要一条数据的时候可以使用limit-1"><a class="markdownIt-Anchor" href="#5当只需要一条数据的时候可以使用limit-1">#</a> 5. 当只需要一条数据的时候可以使用 limit 1</h4>
<blockquote>
<p>这是为了使 EXPLAIN 中 type 列达到 const 类型</p>
</blockquote>
<h4 id="6调整where字句中的连接顺序"><a class="markdownIt-Anchor" href="#6调整where字句中的连接顺序">#</a> 6. 调整 Where 字句中的连接顺序</h4>
<blockquote>
<p>采用自下而上的顺序解析 where 字句，根据这个原理表连接最好写在其他 where 条件之前，那些可以过滤掉最大数量记录。</p>
</blockquote>
<h4 id="7小表驱动大表"><a class="markdownIt-Anchor" href="#7小表驱动大表">#</a> 7. 小表驱动大表</h4>
<blockquote>
<p>SQL 中使用 in：<br>
如果 sql 语句中包含了 in 关键字，则它会优先执行 in 里面的子查询语句，然后再执行 in 外面的语句。所以假如 in 里面的数据量很少，作为条件查询速度更快。</p>
</blockquote>
<blockquote>
<p>SQL 中使用 exists：<br>
如果 sql 语句中包含了 exists 关键字，它会优先执行 exists 左边的语句（即主查询语句）。然后把它作为条件，去跟右边的语句匹配。<br>
如果匹配上，则可以查询出数据。如果匹配不上，数据就被过滤掉了。</p>
</blockquote>
<p>这个需求中，如果 order 表有 10000 条数据，而 user 表有 100 条数据。order 表是大表，user 表是小表。如果 order 表在左边，则用 in 关键字性能更好。</p>
<p>总结一下：</p>
<blockquote>
<p>in 适用于左边大表，右边小表。<br>
exists 适用于左边小表，右边大表。</p>
</blockquote>
<h4 id="8善用-explain-查看sql执行计划"><a class="markdownIt-Anchor" href="#8善用-explain-查看sql执行计划">#</a> 8. 善用 EXPLAIN 查看 SQL 执行计划</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">select</span>  column_name <span class="keyword">from</span> table_name;</span><br></pre></td></tr></table></figure>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4ab2afe500d946c888ae0fd45882041a.png" alt="在这里插入图片描述"></p>
<blockquote>
<ol>
<li>type 列，访问类型。一个好的 sql 语句至少要达到 range (范围) 级别。杜绝出现 all 级别。<br>
ALL、index、range、 ref、eq_ref、const、system、NULL（从左到右，性能从差到好）</li>
<li>key 列，使用到的索引名。如果没有选择索引，值是 NULL。可以采取强制索引方式。</li>
<li>key_len 列，索引长度。</li>
<li>rows 列，扫描行数。该值是个预估值 。</li>
<li>extra 列，详细说明。注意常见的不太友好的值有：Using filesort, Using temporary。</li>
</ol>
</blockquote>
<p><strong>具体的优化步骤：</strong><br>
1、首先要避免全表扫描，检查是否有索引。<br>
2、查看索引是否生效。<br>
3、sql 结构的优化。<br>
4、数据库表设计的优化。</p>
<hr>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.320Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.891Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">8 分钟读完 (大约1260个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Mysql%E3%80%91Mysql%E5%88%A0%E9%99%A4%E9%87%8D%E5%A4%8D%E6%95%B0%E6%8D%AE%E5%8F%AA%E4%BF%9D%E7%95%99%E4%B8%80%E6%9D%A1/">【Mysql】Mysql删除重复数据只保留一条</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="mysqlmysql删除重复数据只保留一条"><a class="markdownIt-Anchor" href="#mysqlmysql删除重复数据只保留一条">#</a> 【Mysql】Mysql 删除重复数据只保留一条</h1>
<p><strong>（1）以这张表为例：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`  (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;注解id&#x27;</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;名字&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> Compact;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test (id,`name`) <span class="keyword">VALUES</span> (replace(uuid(),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;张三&#x27;</span>),(replace(uuid(),<span class="string">&#x27;-&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;张三&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>表里有两条数据，然后名字是相同的，但是 id 是不同的，现在要求是只留一条数据：</p>
<p><img src="https://img-blog.csdnimg.cn/888323c3cc9c4871ac5eeaf2aa7b55a1.png" alt="在这里插入图片描述"></p>
<p><strong>（2）查询 name 值重复的数据：</strong></p>
<blockquote>
<p>现实开发当中可能一个字段无法锁定重复值，可以采取 group by 多个值！利用多个值来锁定重复的行数据！</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>（3）查询重复数据里面每个最小的 id：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  <span class="built_in">min</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>（4）查询去掉重复数据最小 id 的其他数据：也就是要删除的数据！</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span> ) </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="built_in">min</span>( id ) <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( NAME ) <span class="operator">&gt;</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><strong>（5）删除去掉重复数据最小 id 的其他数据：</strong></p>
<blockquote>
<p>可能这时候有人该说了，有了查询，直接改成 delete 不就可以了，真的是这样吗？其实不是的，如下运行报错：</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/917867c90bfc49fdacf3a1f5e45de26d.png" alt="在这里插入图片描述"></p>
<p>首先明确一点这个错误只会发生在 <code>delete</code>  语句或者 <code>update</code>  语句，拿 update 来举例 :  <code>update A表 set A列 = (select B列 from A表)；</code>  这种写法就会报这个错误，原因：你又要修改 A 表，然后又要从 A 表查数据，而且还是同层级。Mysql 就会认为是语法错误！</p>
<p>嵌套一层就可以解决， <code>update A表 set A列 = (select a.B列 from (select * from A表) a);</code>  当然这个只是个示例，这个示例也存在一定的问题，比如 <code>(select a.B列 from (select * from A表) a)</code>  他会查出来多条，然后赋值的时候会报  <code>1242 - Subquery returns more than 1 row</code> 。</p>
<p>嵌套一层他就可以和 update 撇清关系，会优先查括号里面的内容，查询结果出来过后会给存起来，类似临时表，可能有的人该好奇了， <code>update A表 set A列 = (select B列 from A表)；</code>  我明明加括号了呀，难道不算嵌套吗，当然不算，那个括号根本没有解决他们之间的层次关系！</p>
<p>详解看这篇文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43888891/article/details/127000534">https://blog.csdn.net/weixin_43888891/article/details/127000534</a></p>
<p><strong>（6）正确的写法：</strong></p>
<p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span> name <span class="keyword">IN</span> ( <span class="keyword">select</span> a.name <span class="keyword">from</span> (<span class="keyword">SELECT</span> name <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span>) a) </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">select</span> a.id <span class="keyword">from</span> (<span class="keyword">SELECT</span>  <span class="built_in">min</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> `name` <span class="keyword">HAVING</span> <span class="built_in">count</span>( name ) <span class="operator">&gt;</span> <span class="number">1</span>) a)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong> <code>注意：删除之前一定要先查询，然后再删除，否则一旦语法有问题导致删了不想删除的数据，想要恢复很麻烦！或者删除前备份好数据，不要嫌麻烦，一旦出问题，才是真正的大麻烦！</code> </strong></p>
</blockquote>
<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">	<span class="keyword">SELECT</span></span><br><span class="line">		t.id </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	( <span class="keyword">SELECT</span> <span class="built_in">MIN</span>(id) <span class="keyword">as</span> id <span class="keyword">FROM</span> test <span class="keyword">GROUP</span> <span class="keyword">BY</span> NAME ) t)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>（7）错误的写法：</strong> 这块我吃过一次亏，所以专门写出来，避免踩坑！</p>
<blockquote>
<p>千万千万不能这么搞，下面这个语法相当于是先按 name 分组，然后查出来大于 1 的，这时候假如大于 1 的有很多，然后外面嵌套的那一层，只取了最小的一条数据，然后再加上使用的是 <code>NOT IN</code> ，最终会导致数据全部被删除！！！</p>
</blockquote>
<p><img src="https://img-blog.csdnimg.cn/6c67f02195ef4b69b3f896f39f9d8b84.png" alt="在这里插入图片描述"></p>
<p>执行前有四条数据，实际上我们要的是张三留下来一条，然后李四留下来一条</p>
<p><img src="https://img-blog.csdnimg.cn/9f86345b6b9c4e009a0b596ddbb1c83e.png" alt="在这里插入图片描述"></p>
<p>执行结果：只留下了一条！</p>
<p><img src="https://img-blog.csdnimg.cn/be5a73336f5e4a26b93314e10231d998.png" alt="在这里插入图片描述"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.318Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.907Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">3 分钟读完 (大约464个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91Mysql%E6%9F%A5%E8%AF%A2%E6%8A%80%E5%B7%A7/">mysql查询技巧</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="mysql-查询当天-昨天-本周-上周-本月-上月-今年-去年数据"><a class="markdownIt-Anchor" href="#mysql-查询当天-昨天-本周-上周-本月-上月-今年-去年数据">#</a> mysql 查询当天、昨天、本周、上周、本月、上月、今年、去年数据</h1>
<h2 id="mysql查询今天-昨天-7天-近30天-本月-上一月-数据"><a class="markdownIt-Anchor" href="#mysql查询今天-昨天-7天-近30天-本月-上一月-数据">#</a> mysql 查询今天、昨天、7 天、近 30 天、本月、上一月 数据</h2>
<p>今天	select * from 表名 where to_days (时间字段名) = to_days (now ());</p>
<p>昨天	SELECT * FROM 表名 WHERE TO_DAYS (NOW () ) - TO_DAYS ( 时间字段名) = 1</p>
<p>近 7 天	SELECT * FROM 表名 where DATE_SUB (CURDATE (), INTERVAL 7 DAY) &lt;= date (时间字段名)</p>
<p>查询当前这周的数据<br>
 SELECT name,submittime FROM enterprise WHERE YEARWEEK (date_format (submittime,’% Y-% m-% d’)) = YEARWEEK (now ());</p>
<p>查询上周的数据<br>
 SELECT name,submittime FROM enterprise WHERE YEARWEEK (date_format (submittime,’% Y-% m-% d’)) = YEARWEEK (now ())-1;</p>
<p>近 30 天	SELECT * FROM 表名 where DATE_SUB (CURDATE (), INTERVAL 30 DAY) &lt;= date (时间字段名) 本月 SELECT * FROM 表名 WHERE DATE_FORMAT ( 时间字段名，‘% Y% m’ ) = DATE_FORMAT ( CURDATE ( ) , ‘% Y% m’ )</p>
<p>上一月	SELECT * FROM 表名 WHERE PERIOD_DIFF (date_format ( now () , ‘% Y% m’ ) , date_format ( 时间字段名，‘% Y% m’ ) ) =1</p>
<p>查询距离当前现在 6 个月的数据<br>
 select name,submittime from enterprise where submittime between date_sub (now (),interval 6 month) and now (); #查询本季度数据	select * from  <code>ht_invoice_information</code>  where QUARTER(create_date)=QUARTER(now());</p>
<p>查询上季度数据	select * from  <code>ht_invoice_information</code>  where QUARTER(create_date)=QUARTER(DATE_SUB(now(),interval 1 QUARTER));</p>
<p>查询本年数据	select * from  <code>ht_invoice_information</code>  where YEAR(create_date)=YEAR(NOW());</p>
<p>查询上年数据	select * from  <code>ht_invoice_information</code>  where year(create_date)=year(date_sub(now(),interval 1 year));</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.314Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.899Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">5 分钟读完 (大约684个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91MySQL%E5%AE%89%E8%A3%85%20starting%20the%20server%E5%A4%B1%E8%B4%A5%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">MySQL安装 starting the server失败的解决办法</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="mysql安装-starting-the-server失败的解决办法"><a class="markdownIt-Anchor" href="#mysql安装-starting-the-server失败的解决办法">#</a> MySQL 安装 starting the server 失败的解决办法</h3>
<p>​		如果电脑是第一次安装 MySQL，一般不会出现这样的报错。如下图所示。starting the server 失败，通常是因为上次安装的该软件未清除干净。</p>
<p><img src="https://img-blog.csdnimg.cn/20190807043159195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><strong>完全卸载该软件的办法</strong>：</p>
<p>第一步，进入… 控制面板 \ 程序 \ 程序和功能，卸载下图中的 MySQL 两个软件。</p>
<p><img src="https://img-blog.csdnimg.cn/20190807043419726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
第二步，删除上次安装目录的 MySQL 残留文件，更不要忘了删除 ProgramData 下的 MySQL 文件夹，如下图所示。注意：这里的文件夹与上次安装目录里的残留文件不同，C:\ProgramData 一般默认是隐藏的。<br>
<img src="https://img-blog.csdnimg.cn/20190807043522439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
第三步，Win+R 输入 regedit 运行，进入注册表编辑器，按下图路径，找到 MySQL，进而删除 MySQL 注册表信息。<br>
<img src="https://img-blog.csdnimg.cn/20190807043623577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>
第四步，做完前三步，打开服务，会发现 MySQL57 服务依然存在，如下图所示。这就是导致安装失败的重要原因，所以需要删除 MySQL57 服务。方法：以管理员的权限运行 dos 命令，然后输入 sc delete MySQL57 。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">C</span>:\<span class="title class_">Windows</span>\system32&gt;sc <span class="keyword">delete</span> <span class="title class_">MySQL57</span></span><br><span class="line">[<span class="variable constant_">SC</span>] <span class="title class_">DeleteService</span> 成功</span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20190807043734156.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>现在就可以轻松的安装上 MySQL 软件了！</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.310Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.866Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">6 分钟读完 (大约866个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91Mysql8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/">MySQL8下载与安装教程</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="mysql下载与安装8020版教程"><a class="markdownIt-Anchor" href="#mysql下载与安装8020版教程">#</a> MySQL 下载与安装（8.0.20 版）教程</h1>
<p>MySQL 官网：<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">链接</a></p>
<p>直接点击链接也可以下载：<a target="_blank" rel="noopener" href="https://www.jb51.net/softs/609101.html">mysql 8.0.20</a></p>
<p>登录官网后如下图下载 MySQL 软件：</p>
<p><img src="https://xysaobi.oss-cn-beijing.aliyuncs.com/img/2036459-20200521220018274-67173082.png" alt="MySQL下载与安装"></p>
<p>点击 1 和 2 后进入下图页面：</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220029745-1322700384.png" alt="MySQL下载与安装"></p>
<p>再点击 MySQL Community Server 进入下图下载页面：</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220041569-1305043095.png" alt="MySQL下载与安装"></p>
<p>根据上图选择好 1 处后点击 2 处进入 Windows 安装包的下载页面 (如下图):</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220158844-1266620614.png" alt="mysql80.20安装教程"></p>
<p>上图中有两个下载包，一个是安装引导包，一个是压缩安装包，我们选择第二个。点击 Download 进入下图页面。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220326093-1181789318.png" alt="mysql80.20安装教程"></p>
<p>我们不登陆下载，所以直接点击红框按钮进行下载。这样我们就把软件下载下来了。</p>
<p><strong>安装：</strong></p>
<p>双击上面下载的软件，打开下图页面。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220337052-1815726332.png" alt="mysql80.20安装教程"></p>
<p>点击 Next, 转到下图页面。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220348558-1991987874.png" alt="mysql80.20安装教程"></p>
<p>如果大红框上面有些没有安装的软件会出现这里，可以点击 Next 左边的 Excute 按钮安装，安装完成之后点击 Next 按钮，会出现个弹框，如下图。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220400913-2029518725.png" alt="mysql80.20安装教程"></p>
<p>点击 Yes。弹出下图页面。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220415332-220059202.png" alt="mysql80.20安装教程"></p>
<p>点击 Execute 进行安装。等待所有安装完成。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220425391-1135522490.png" alt="mysql80.20安装教程"></p>
<p>至少保证红杠处的 3 项安装成功，假若有安装失败的可以卸载重新安装。安装成功后我们点击 Next。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220438215-1446733656.png" alt="mysql80.20安装教程"></p>
<p>点击 Next。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220449513-157912578.png" alt="mysql80.20安装教程"></p>
<p>点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360113.png" alt="mysql80.20安装教程"></p>
<p>点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360114.png" alt="img"></p>
<p>在红框里输入账号和密码，账号密码必须大于或等于 4 个字符，点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360115.png" alt="img"></p>
<p>点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360116.png" alt="img"></p>
<p>点击 Excute。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360117.png" alt="img"></p>
<p>点击 Finish。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360118.png" alt="img"></p>
<p>点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360119.png" alt="img"></p>
<p>点击 Finish。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360120.png" alt="img"></p>
<p>点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360121.png" alt="img"></p>
<p>输入密码后点击 Check, 再点击 Next。</p>
<p><img src="https://img.jbzj.com/file_images/article/202005/2020051108360122.png" alt="img"></p>
<p>点击 Execute。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220545404-521370663.png" alt="img"></p>
<p>点击 Finish。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220534248-896731311.png" alt="mysql80.20安装教程"></p>
<p>点击 Next。</p>
<p><img src="https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220522143-393956818.png" alt="mysql80.20安装教程"></p>
<p>点击 Finish。</p>
<p>到此位置 MySQL 就安装完成了。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.308Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.859Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">4 分钟读完 (大约546个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90MySQL%E3%80%91Linux%E4%B8%8Bdocer%E9%83%A8%E7%BD%B2mysql/">Linux下docer部署mysql</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="linux下docer部署mysql"><a class="markdownIt-Anchor" href="#linux下docer部署mysql">#</a> Linux 下 docer 部署 mysql</h2>
<p>部署方法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">1.首先在Linux系统中启动已经安装好的docker</span><br><span class="line">service docker start</span><br><span class="line"></span><br><span class="line">2.查看docker进程，确认docker启动成功</span><br><span class="line">ps -ef|grep docker</span><br><span class="line"></span><br><span class="line">3.在docker容器中查询MySQL</span><br><span class="line">docker search mysql</span><br><span class="line"></span><br><span class="line">4.在docker中安装MySQL</span><br><span class="line">docker pull mysql</span><br><span class="line"></span><br><span class="line">5.查看MySQL镜像</span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">6.创建MySQL用户并且将root账户密码设置为你需要的密码</span><br><span class="line">docker run --name mysqlserver -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=『你的账户密码』 -d -i -p 外网端口:3306 mysql:latest</span><br><span class="line"></span><br><span class="line">docker run -p 33001:3306 --name mysqlSlave2 -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=Lgq081538 -d mysql:5.7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定配置文件容器</span></span><br><span class="line">docker run -p 33001:3306 --name mysqlSlave2 \</span><br><span class="line">-v /usr/local/docker/mysql/logs:/var/log/mysql \</span><br><span class="line">-v /usr/local/docker/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /usr/local/docker/mysql/conf/my.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=Lgq081538 \</span><br><span class="line">-d mysql:5.7</span><br><span class="line"></span><br><span class="line">7.在docker中启动MySQL</span><br><span class="line">docker exec -it mysqlSlave2 bash</span><br><span class="line"></span><br><span class="line">8.输入用户名和密码</span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">9.开启MySQL远程访问权限</span><br><span class="line">use mysql;</span><br><span class="line">select host,user from user;</span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Lgq081538&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">一些在docker的常用命令：</span><br><span class="line">1、列出正在运行的容器</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line">2、列出包括未运行的所有的容器</span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line">3、查看某进程最近10条运行日志</span><br><span class="line">docker logs -f --tail 10 &quot;所查询的进程ID&quot;</span><br><span class="line"></span><br><span class="line">4、关闭docker中运行的进程，以MySQL为例</span><br><span class="line">docker stop mysql</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">docker stop &quot;要停止的进程ID&quot;</span><br><span class="line"></span><br><span class="line">5、重启docker中运行的进程</span><br><span class="line">docker restart &quot;要重启的进程ID&quot;</span><br><span class="line"></span><br><span class="line">6、重启docker</span><br><span class="line">systemctl restart docker</span><br><span class="line"></span><br><span class="line">7、停止docker</span><br><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">上一页</a></div><div class="pagination-next"><a href="/page/6/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/13/">13</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-26T00:59:24.590Z">2023-04-26</time></p><p class="title"><a href="/2023/04/26/%E3%80%90DDD%E3%80%91DDD%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%BC%A0%E7%BB%9F%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8C%BA%E5%88%AB/">【DDD】DDD分层架构与传统三层架构的区别</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-21T01:04:21.063Z">2023-04-21</time></p><p class="title"><a href="/2023/04/21/%E3%80%90NodeJS%E3%80%91Windows%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%A6%82%E4%BD%95%E5%81%9ANode%E5%A4%9A%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%EF%BC%9F/">【NodeJS】Windows环境下如何做Node多版本管理？</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:52:53.490Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90HEXO%E3%80%91%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/">【HEXO】使用Hexo搭建属于自己的博客</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.463Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E3%80%91%E8%85%BE%E8%AE%AF%E4%BA%91%E7%94%B3%E8%AF%B7%E7%9A%84%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91CDN%E5%92%8C%E4%BA%91%E7%9B%BE%E8%AF%81%E4%B9%A6%E4%B8%AD%E5%BF%83/">腾讯云申请的免费证书部署到阿里云CDN和云盾证书中心</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.459Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%A4%96%E8%AE%BE%E3%80%91%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98%E8%BD%B4%E4%BD%93%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F%E4%B8%89%E6%A8%A1%E7%83%AD%E6%8F%92%E6%8B%94%E5%8E%9F%E6%9D%A5%E6%98%AF%E8%BF%99%E4%B9%88%E5%9B%9E%E4%BA%8B/">【外设】机械键盘轴体怎么选？三模热插拔原来是这么回事</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">121</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">121</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>