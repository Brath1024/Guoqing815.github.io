<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-01-05T22:54:23.000Z" title="2023/1/6 06:54:23">2023-01-06</time>发表</span><span class="level-item"><time dateTime="2019-12-31T16:50:49.000Z" title="2020/1/1 00:50:49">2020-01-01</time>更新</span><span class="level-item">29 分钟读完 (大约4379个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/06/%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91DDD%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E4%B8%8E%E4%BC%A0%E7%BB%9F%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84%E7%9A%84%E5%8C%BA%E5%88%AB/">【DDD】DDD分层架构与传统三层架构的区别</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dddddd分层架构与传统三层架构的区别"><a class="markdownIt-Anchor" href="#dddddd分层架构与传统三层架构的区别">#</a> 【DDD】DDD 分层架构与传统三层架构的区别</h1>
<h3 id="文章目录"><a class="markdownIt-Anchor" href="#文章目录">#</a> 文章目录</h3>
<ul>
<li>
<ul>
<li><a href="#DDD_1">DDD 分层与传统三层区别</a></li>
<li><a href="#DDD_16">DDD 分层详解</a></li>
<li>
<ul>
<li><a href="#_17">四层架构图</a></li>
<li><a href="#_24">分层作用</a></li>
<li><a href="#_31">领域对象</a></li>
</ul>
</li>
<li><a href="#DDD_44">DDD 编码实践（改进分层）</a></li>
<li>
<ul>
<li><a href="#_53">代码结构描述</a></li>
<li><a href="#_115">扩展定义注解和接口声明</a></li>
<li><a href="#_135">领域模型注入仓储类的问题</a></li>
</ul>
</li>
<li><a href="#_235">一些个人思考…</a></li>
<li>
<ul>
<li><a href="#DDD_242">项目按上述经典四层架构进行搭建，可以说是 DDD 架构实践么？</a></li>
<li><a href="#SpringDDD_251">题外话：Spring 与 DDD</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ddd分层与传统三层区别"><a class="markdownIt-Anchor" href="#ddd分层与传统三层区别">#</a> DDD 分层与传统三层区别</h2>
<p>根据 DDD 领域驱动设计原则，对应的软件架构也需要做出相应的调整。<br>
我们常用的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84&amp;spm=1001.2101.3001.7020">三层架构</a>模型划分为表现层，业务逻辑层，数据访问层等，在 <code>DDD</code>  分层结构中既有联系又有区别，<br>
个人认为主要有如下异同：</p>
<ul>
<li>在架构设计上，在 <code>DDD</code>  分层结构中将传统三层架构的业务逻辑层拆解为应用层和领域层<br>
其中 Application 划分为很薄的一层服务，非核心的逻辑放到此层去实现，核心的业务逻辑表现下沉到领域层去实现，凝练为更为精确的业务规则集合，通过领域对象去阐述说明。<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20200110163924602.png" alt="与传统三层区别"></li>
<li>在建模方式上， <code>DDD</code>  分层的建模思维方式有别于传统三层<br>
传统三层通常是以数据库为起点进行数据库分析设计，而 <code>DDD</code>  则需要以业务<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B&amp;spm=1001.2101.3001.7020">领域模型</a>为核心建模（即面向对象建模方式），更能体现对现实世界的抽象。<br>
故<strong>在 DDD 分层凸显领域层的重要作用，领域层为系统的核心，包括所有的业务领域模型的抽象表达</strong>。</li>
<li>在职责划分上，基础设施层涵盖了 2 方面内容
<ul>
<li>持久化功能，其中原三层架构的数据访问层下沉到基础设施层的持久化机制实现</li>
<li>通用技术支持，一些公共通用技术支持也放到基础设施层去实现。</li>
</ul>
</li>
</ul>
<h2 id="ddd分层详解"><a class="markdownIt-Anchor" href="#ddd分层详解">#</a> DDD 分层详解</h2>
<h3 id="四层架构图"><a class="markdownIt-Anchor" href="#四层架构图">#</a> 四层架构图</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20200110164305632.png" alt="在这里插入图片描述"></p>
<p>在该架构中，上层模块可以调用下层模块，反之不行。即</p>
<ul>
<li><code>Interface</code>  ——&gt;  <code>application</code>  |  <code>domain</code>  |  <code>infrastructure</code></li>
<li><code>application </code> ——&gt; <code> domain</code>  |  <code>infrastructure</code></li>
<li><code>domain</code>  ——&gt; <code> infrastructure</code></li>
</ul>
<h3 id="分层作用"><a class="markdownIt-Anchor" href="#分层作用">#</a> 分层作用</h3>
<table>
<thead>
<tr>
<th>分层</th>
<th>英文</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>表现层</td>
<td><code>User Interface</code></td>
<td>用户界面层，或者表现层，负责向用户显示解释用户命令</td>
</tr>
<tr>
<td>应用层</td>
<td><code>Application Layer</code></td>
<td>定义软件要完成的任务，并且指挥协调领域对象进行不同的操作。该层不包含业务领域知识。</td>
</tr>
<tr>
<td>领域层</td>
<td><code>Domain Layer</code></td>
<td>或称为模型层，系统的核心，负责表达业务概念，业务状态信息以及业务规则。即包含了该领域（问题域）所有复杂的业务知识抽象和规则定义。该层主要精力要放在领域对象分析上，可以从实体，值对象，聚合（聚合根），领域服务，领域事件，仓储，工厂等方面入手</td>
</tr>
<tr>
<td>基础设施层</td>
<td><code>Infrastructure Layer</code></td>
<td>主要有 2 方面内容，一是为领域模型提供持久化机制，当软件需要持久化能力时候才需要进行规划；一是对其他层提供通用的技术支持能力，如消息通信，通用工具，配置等的实现；</td>
</tr>
</tbody>
</table>
<h3 id="领域对象"><a class="markdownIt-Anchor" href="#领域对象">#</a> 领域对象</h3>
<p>根据战术设计，关注的领域对象主要包括有</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>英文</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>值对象</td>
<td><code>value object</code></td>
<td>无唯一标识的简单对象</td>
</tr>
<tr>
<td>实体</td>
<td><code>entity</code></td>
<td>充血的领域模型，有唯一标识</td>
</tr>
<tr>
<td>聚合（聚合根）</td>
<td><code>aggregate</code></td>
<td>实体的聚合，拥有聚合根，可为某一个实体</td>
</tr>
<tr>
<td>领域服务</td>
<td><code>service</code></td>
<td>无法归类到某个具体领域模型的行为</td>
</tr>
<tr>
<td>领域事件</td>
<td><code>event</code></td>
<td>不常用</td>
</tr>
<tr>
<td>仓储</td>
<td><code>repository</code></td>
<td>持久化相关，与基础设施层关联</td>
</tr>
<tr>
<td>工厂</td>
<td><code>factory</code></td>
<td>负责复杂对象创建</td>
</tr>
<tr>
<td>模块</td>
<td><code>module</code></td>
<td>子模块引入，可以理解为子域划分</td>
</tr>
</tbody>
</table>
<h2 id="ddd编码实践改进分层"><a class="markdownIt-Anchor" href="#ddd编码实践改进分层">#</a> DDD 编码实践（改进分层）</h2>
<p>本文在对上述的传统四层的实践中，（1）根据 <code>依赖倒置原则</code> 对分层结构进行了改进，通过改变不同层的依赖关系（即将基础设施层倒置）来改进具体实现与抽象之间关系；（2）在基础设施层中增加 <code>引用适配层</code> （防腐层）来增强防御策略，用来统一封装外部系统接口的引用。改进的分层结构如下：<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/74de60360d744758993b3ba54ac20370.png" alt="在这里插入图片描述"></p>
<blockquote>
<p>依赖倒置原则（DIP）：</p>
<ul>
<li>高层模块不依赖于低层模块，两者都依赖于抽象；</li>
<li>抽象不应该依赖于细节，细节应依赖抽象</li>
</ul>
</blockquote>
<h3 id="代码结构描述"><a class="markdownIt-Anchor" href="#代码结构描述">#</a> 代码结构描述</h3>
<p><code>eg.</code>  后端 Java 代码工程为例，<br>
 <code>表现层</code> 在此代码结构中表现为 <code>api层</code> ，对外暴露接口的最上层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">├─com.company.microservice</span><br><span class="line">├─com.company.microservice</span><br><span class="line">│    │ </span><br><span class="line">│    ├─apis   API接口层 </span><br><span class="line">│    │    └─controller       控制器，对外提供（Restful）接口</span><br><span class="line">│    │ </span><br><span class="line">│    ├─application           应用层</span><br><span class="line">│    │    ├─model            数据传输对象模型及其装配器（含校验）</span><br><span class="line">│    │    │    ├─assembler   装配器,，实现模型转换eg. apiModel&lt;=&gt; domainModel</span><br><span class="line">│    │    │    └─dto         模型定义（含校验规则）      </span><br><span class="line">│    │    ├─service          应用服务，非核心服务，跨领域的协作、复杂分页查询等</span><br><span class="line">│    │    ├─task             任务定义，协调领域模型</span><br><span class="line">│    │    ├─listener         事件监听定义</span><br><span class="line">│    │    └─***              others</span><br><span class="line">│    │ </span><br><span class="line">│    ├─domain   领域层</span><br><span class="line">│    │    ├─common           模块<span class="number">0</span>-公共代码抽取，限于领域层有效  </span><br><span class="line">│    │    ├─<span class="keyword">module</span>-xxx       模块<span class="number">1</span>-xxx，领域划分的模块，可理解为子域划分     </span><br><span class="line">│    │    ├─<span class="keyword">module</span>-user      模块<span class="number">2</span>-用户子域（领域划分的模块，可理解为子域划分）</span><br><span class="line">│    │    │    ├─action      行为定义</span><br><span class="line">│    │    │    │    ├─UserDomainService.java        领域服务,用户领域服务</span><br><span class="line">│    │    │    │    ├─UserPermissionChecker.java    其他行为，用户权限检查器</span><br><span class="line">│    │    │    │    ├─WhenUserCreatedEventPublisher.java     领域事件，当用户创建完成时的事件 </span><br><span class="line">│    │    │    ├─model       领域聚合内模型 </span><br><span class="line">│    │    │    │    ├─UserEntity.java                领域实体，有唯一标识的充血模型，如本身的CRUD操作在此处</span><br><span class="line">│    │    │    │    ├─UserDictVObj.java              领域值对象，用户字典kv定义       </span><br><span class="line">│    │    │    |    ├─UserDPO.java                   领域负载对象    </span><br><span class="line">│    │    │    ├─repostiory  领域仓储接口</span><br><span class="line">│    │    │    │    ├─UserRepository.java</span><br><span class="line">│    │    │    ├─reference   领域适配接口</span><br><span class="line">│    │    │    │    ├─UserEmailSenderFacade.java</span><br><span class="line">│    │    │    └─factory     领域工厂  </span><br><span class="line">│    │ </span><br><span class="line">│    ├─infrastructure  基础设施层</span><br><span class="line">│    │    ├─persistence      持久化机制</span><br><span class="line">│    │    │    ├─converter   持久化模型转换器</span><br><span class="line">│    │    │    ├─po          持久化对象定义 </span><br><span class="line">│    │    │    └─repository.impl  仓储类，持久化接口&amp;实现，可与ORM映射框架结合</span><br><span class="line">│    │    ├─general          通用技术支持，向其他层输出通用服务</span><br><span class="line">│    │    │    ├─config      配置类</span><br><span class="line">│    │    │    ├─toolkit     工具类  </span><br><span class="line">│    │    │    ├─extension   扩展定义  </span><br><span class="line">│    │    │    └─common      基础公共模块等 </span><br><span class="line">│    │    ├─reference        引用层，包装外部接口用，防止穿插到Domain层腐化领域模型等</span><br><span class="line">│    │    │    ├─dto         传输模型定义</span><br><span class="line">│    │    │    ├─converter   传输模型转换器       </span><br><span class="line">│    │    │    └─facade.impl 适配器具体实现，此处的RPC、Http等调用</span><br><span class="line">│    │ </span><br><span class="line">│    └─resources  </span><br><span class="line">│        ├─statics  静态资源</span><br><span class="line">│        ├─template 系统页面 </span><br><span class="line">│        └─application.yml   全局配置文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中在上述目录结构中，Domain 层中为对 <code>module</code>  进行划分，实际上默认该层只有一个模块，根据微服务划分可以进行增加模块来规范代码结构。<br>
示例代码工程：</p>
<p>GITHUB 地址：<a target="_blank" rel="noopener" href="https://github.com/smingjie/bbq-ddd.git">https://github.com/smingjie/bbq-ddd.git</a></p>
<h3 id="扩展定义注解和接口声明"><a class="markdownIt-Anchor" href="#扩展定义注解和接口声明">#</a> 扩展定义注解和接口声明</h3>
<p>（1） <code>自定义注解</code> ：在使用 DDD 中自定义了标记的注解 (@DDDAnnotation) 和其衍生子注解，分别是</p>
<ul>
<li><code>@DomainAggregate</code></li>
<li><code>@DomainAggregateRoot</code></li>
<li><code>@DomainEntity</code></li>
<li><code>@DomainValueObject</code></li>
<li><code>@DomainService</code></li>
<li><code>@DomainRepository</code></li>
<li><code>@DomainEvent</code></li>
<li><code>@ApplicationService</code></li>
<li><code>@DomainAssembler</code></li>
<li><code>@DomainConverter</code></li>
</ul>
<p>等注解，详见代码的 infrastructure.general.extension.ddd.annotation.**；其中有些注解继承了 spring 的  <code>@Component</code> , 将会自动注册为 spring bean，有些注解为了标记用于后续扩展；</p>
<p>引入了 Assembler 装配器 / Converter 转换器，通过组合模式解耦继承关系，在 api 层和持久化层都有相应的实现。</p>
<p>（2） <code>自定义接口</code> ：在 domain.common 定义了部分通用的 <code>契约</code> 接口，如领域对象元数据获取接口  <code>IDomainMetaData</code> ，通过接口解耦继承关系。其他还有：  <code>IDomainSaveOrUpdate</code>   <code>IDomainDelete</code>   <code>...</code>  等 Command</p>
<h3 id="领域模型注入仓储类的问题"><a class="markdownIt-Anchor" href="#领域模型注入仓储类的问题">#</a> 领域模型注入仓储类的问题</h3>
<p>区别于传统的分层后，在 domain 中更多关注业务逻辑，考虑到要与 spring 框架集成，需要注意一个领域模型中注入仓储类的问题</p>
<blockquote>
<p>在传统分层中，controller，service，repo 均注册为 spring 管理的 bean，<br>
但是在 domain 层中，service 一部分的业务逻辑划分到了具体的领域对象中去实现了，显然这些对象却不能注册为单例 bean，<br>
因此在此处不能沿用与原来分层结构中 service 层中通过 <code>@Autowired</code>  or  <code>@Resource</code>  等注入仓储接口，</p>
</blockquote>
<p><strong>关于这个问题，此处建议使用 <code>ApplicationContext</code>  实现</strong></p>
<blockquote>
<p>即通过一个工具类  <code>ApplicationContextUtils</code>  实现  <code>ApplicationContextAware</code>  获取 bean 的方法，即  <code>getBean()</code>  方法，<br>
然后我们就可以在我们的领域模型中直接应用该工具类来获取 Spring 托管的 singleton 对象，即<br>
 xxxRepo=ApplicationContextUtils.getBean (“xxxRepository”)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextUtils</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext appctx;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        ApplicationContextUtil.appctx=applicationContext;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ApplicationContext</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ApplicationContext <span class="title function_">getApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> appctx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name spring配置文件中配置的bean名或注解的名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 一个以所给名字注册的bean的实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException 抛出spring异常</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) appctx.getBean(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取类型为requiredType的对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz 需要获取的bean的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 该类型的一个在ioc容器中的bean</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BeansException 抛出spring异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span><span class="params">(Class&lt;T&gt; clazz)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="keyword">return</span> appctx.getBean(clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果ioc容器中包含一个与所给名称匹配的bean定义，则返回true否则返回false</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name ioc容器中注册的bean名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 存在返回true否则返回false</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">containsBean</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> appctx.containsBean(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>考虑到代码结构简洁性，还可以封装一层仓储工厂，只用来获取相应的仓储 <code>Bean</code>  。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简化版的仓储工厂--用来统一获取仓储的实现Bean</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jockeys</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/9/12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RepoFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据仓储接口类型获取对应实现且默认取值第一个</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> tClass 具体目标类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> &lt;T&gt;    仓储接口类型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 如果不是指定实现，默认获得第一个实现Bean</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">get</span><span class="params">(Class&lt;? extends T&gt; tClass)</span> &#123;</span><br><span class="line"></span><br><span class="line">		Map&lt;String, ? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; map = ApplicationUtils.getApplicationContext().getBeansOfType(tClass);</span><br><span class="line">		Collection&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>&gt; collection = map.values();</span><br><span class="line">		<span class="keyword">if</span> (collection.isEmpty()) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PersistException</span>(<span class="string">&quot;未找到仓储接口或其指定的实现:&quot;</span> + tClass.getSimpleName() );</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> collection.stream().findFirst().get();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在领域模型中就可以直接调用该工厂方法来获取仓储接口的实现，<br>
比如 <code>DictRepo</code>  为定义的仓储接口， <code>DictDao</code>  为该接口的准实现类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接指定实现</span></span><br><span class="line">DictRepo repo= RepoFactory.get(DictDao.class);</span><br><span class="line"><span class="comment">//不指定实现取Spring容器中默认注册第1位的Bean</span></span><br><span class="line">DictRepo repo= RepoFactory.get(DictRepo.class);</span><br></pre></td></tr></table></figure>
<h2 id="一些个人思考"><a class="markdownIt-Anchor" href="#一些个人思考">#</a> 一些个人思考…</h2>
<p>上述经典四层架构，笔者更愿意理解为 DDD 在编码实现阶段的一个体现或应用。</p>
<blockquote>
<p>补充一点：DDD 除了在编码实践阶段，还体现在需求分析、设计阶段等过程，DDD 推荐不割裂系统的需求和设计，我们这里可以合并称作系统建模过程，可参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/whos2016/article/details/103430565">DDD - 建模过程分析</a>一文，不再赘述。</p>
</blockquote>
<p>当然除了这个经典四层架构模型，DDD 还有五层架构、六边形架构等，所以这里抛出一个问题，</p>
<h3 id="项目按上述经典四层架构进行搭建可以说是ddd架构实践么"><a class="markdownIt-Anchor" href="#项目按上述经典四层架构进行搭建可以说是ddd架构实践么">#</a> 项目按上述经典四层架构进行搭建，可以说是 DDD 架构实践么？</h3>
<p>关于这个问题，笔者想引入一对哲学概念，哲学有言形式与内容，现象与本质等辩证关系（当然与本文可能也没啥太大关系啦）；从这两个角度来阐述本人的观点：</p>
<ul>
<li>
<p>形式与内容：经典四层架构是一个 DDD 实现的形式，相当于给我们提供了一个框框来让我们自己去实现；在这个框框里面我们怎么实现是自由发挥的，但也是有约束的，这个约束体现在 DDD 对每一层的作用的约定，如每个层约定做了什么功能，充当什么角色等。<strong>尤其是对 Domain 层的约定，才是最重要的</strong>。那么我们按照哲学辩证的套话来说，<em><strong>形式上满足了 DDD 架构，但这应该是片面的，具体还要看内容，即具体实现是怎样的。</strong></em></p>
</li>
<li>
<p>现象与本质：接着上述观点，如果要看实现，就要具体分析一下现象与本质嘞。上面笔者也有提到，DDD 除了四层经典架构，还有五层架构（包括其演化的多层架构）、六边形架构等也都是 DDD 提供的架构模型（形式），那这些都可以理解 DDD 架构模式的外显形式，那么又有哪些共性呢？可自行查询，本文直接给结论，即</p>
<p>它们都有 Domain 层，Domain 层，Domain 层</p>
<p>（重要的事情说三遍～～，该结论 DDD 作者译著有写到…），所以不管架构模式怎么演化，Domain 是核心不能变。</p>
<p>那么如上分析，我们在回到这个问题，我们是不是可以给出一个这样的答案：</p>
<blockquote>
<p>形式上符合 DDD 架构，具体是不是 DDD 的架构实践，本质上还要看</p>
<ul>
<li>（1）项目是否包括有 Domain 层；</li>
<li>（2）Domain 层是否满足 DDD 战术篇的要求（或者可暂时简单理解为充血模型吧）</li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="题外话spring与ddd"><a class="markdownIt-Anchor" href="#题外话spring与ddd">#</a> 题外话：Spring 与 DDD</h3>
<ul>
<li>Spring 框架中，Spring 为我们提供了 <code>@Service</code>   <code>@Repository</code>  等注解，为我们分离行为和行为（注册为 Bean）和属性（数据模型），同时通过 <code>@Autowired</code>  在合适地方进行注入行为，因为行为被注册为 Spring 容器中的 Bean 后，减少了频繁创建行为的开销，只有属性的数据模型作为数据的载体来传递数据。提供很大的便捷性。但也阻碍了我们应用 DDD 编码实践， Spring 框架主张分离，DDD 思想主张合并，我们在 Spring 框架中使用 DDD 则需要在其基础上进行一些权衡取舍，即 <em><strong>如何将注册为 Bean 的行为穿插到原有的贫血模型中来构建充血模型是我们要解决的问题</strong></em></li>
<li>关于这个问题，笔者使用了 Spring 框架提供的<strong>获取容器内已经注册的 Bean 接口</strong>，直接调用接口，在有属性的领域模型中来获取行为；主要还是体现融入领域模型中的部分 Service 获取仓储接口来实现持久化过程。</li>
</ul>
<p>当然，上述的说明都是从一个软件开发人员的角度来阐述说明 DDD 在编码实践阶段的应用 。<br>
除此之外在业务领域的建模分析过程中也可引入该概念。<br>
比如我们现在所倡导的微服务化，如何划分或拆分微服务；如何有效地区分限界上下文，划分子域；如何构建一个有效的聚合，识别聚合根等。。。</p>
<ul>
<li>附在最后的，关于笔者对于 DDD 在需求设计阶段应用的学习总结</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/whos2016/article/details/103430565">DDD - 建模分析过程</a></li>
</ul>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt=""></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-12-24T21:40:25.000Z" title="2022/12/25 05:40:25">2022-12-25</time>发表</span><span class="level-item"><time dateTime="2023-01-10T22:49:34.000Z" title="2023/1/11 06:49:34">2023-01-11</time>更新</span><span class="level-item">13 分钟读完 (大约1945个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/12/25/%E3%80%90Java%E3%80%91Volatile%E5%85%B3%E9%94%AE%E5%AD%97/">Volatile关键字</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="volatile关键字"><a class="markdownIt-Anchor" href="#volatile关键字">#</a> Volatile 关键字</h1>
<p>Volatile 关键字的作用主要有如下两个：</p>
<p>线程的可见性：当一个线程修改一个共享变量时，另外一个线程能读到这个修改的值。</p>
<p>顺序一致性：禁止指令重排序。</p>
<h1 id="一-线程可见性"><a class="markdownIt-Anchor" href="#一-线程可见性">#</a> 一、线程可见性</h1>
<p>我们先通过一个例子来看看线程的可见性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileTest</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.flag = <span class="literal">false</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;修改flag值为：&quot;</span> + <span class="built_in">this</span>.flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VolatileTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VolatileTest</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (test.flag) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;结束&quot;</span>);</span><br><span class="line">        &#125;, <span class="string">&quot;Thread1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                test.updateFlag();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread2&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印结果如下，我们可以看到虽然线程 Thread2 已经把 flag 修改为 false 了，但是线程 Thread1 没有读取到 flag 修改后的值，线程一直在运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改flag值为：false</span><br></pre></td></tr></table></figure>
<p>我们把 flag 变量加上 volatile：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatile  boolean flag = true;</span><br></pre></td></tr></table></figure>
<p>重新运行程序，打印结果如下。Thread1 结束，说明 Thread1 读取到了 flage 修改后的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改flag值为：false</span><br><span class="line">Thread1结束</span><br></pre></td></tr></table></figure>
<p>说到可见性，我们需要先了解一下 Java 内存模型，Java 内存模型如下所示：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d90e39f9caa340b0bb589ef1dbb2f667.png" alt="在这里插入图片描述"></p>
<p>线程之间的共享变量存储在主内存中（Main Memory）中，每个线程都一个都有一个私有的本地内存（Local Memory），本地内存中存储了该线程以读 / 写共享变量的副本。</p>
<p>所以当一个线程把主内存中的共享变量读取到自己的本地内存中，然后做了更新。在还没有把共享变量刷新的主内存的时候，另外一个线程是看不到的。</p>
<p>如何把修改后的值刷新到主内存中的？<br>
现代的处理器使用写缓冲区临时保存向内存写入的数据。写缓冲区可以保证指令流水线持续运行，它可以避免由于处理器停顿下来等向内存写入数据而产生的延迟。同时，通过以批处理的方式刷新写缓冲区，以及合并写缓冲区中对同一内存地址的多次写，较少对内存总线的占用。但是什么时候写入到内存是不知道的。<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f96ceb17a5644f7db67d3a64f8b888fa.png" alt="在这里插入图片描述"></p>
<p>所以就引入了 volatile，volatile 是如何保证可见性的呢？<br>
在 X86 处理器下通过工具获取 JIT 编译器生成的汇编指令来查看对 volatile 进行写操作时，会多出 lock addl。Lock 前缀的指令在多核处理器下会引发两件事情：</p>
<p>1. 将当前处理器缓存行的数据写回到系统内存。<br>
2. 这个写回内存的操作会使其他 cpu 里缓存了该内存地址的数据无效。<br>
如果声明了 volatile 的变量进行写操作，JVM 就会向处理器发送一条 Lock 前缀的指令，将这个变量所在缓存行的数据写回到系统内存。但是，就算写回到内存，如果其他处理器缓存的还是旧的，在执行操作就会有问题。所以，在多处理器下，为了保证各个处理器的缓存是一致的，就会实现缓存一致性协议，每个处理器通过嗅探在总线传播的数据来检查自己缓存的值是不是过期了，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存里。</p>
<h1 id="二-顺序一致性"><a class="markdownIt-Anchor" href="#二-顺序一致性">#</a> 二、顺序一致性</h1>
<p>在执行程序时，为了提高性能，编译器和处理器常常会对指令做重排序。重排序分为如下三种：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/39a6b41a1a1a4d0191f418b0519aa532.png" alt="在这里插入图片描述"></p>
<p>1 属于编译器重排序，2 和 3 属于处理器重排序。这些重排序可能会导致多线程程序出现内存可见性问题。<br>
当变量声明为 volatile 时，Java 编译器在生成指令序列时，会插入内存屏障指令。通过内存屏障指令来禁止重排序。<br>
JMM 内存屏障插入策略如下：<br>
在每个 volatile 写操作的前面插入一个 StoreStore 屏障，后面插入一个 StoreLoad 屏障。<br>
在每个 volatile 读操作后面插入一个 LoadLoad，LoadStore 屏障。</p>
<p>Volatile 写插入内存屏障后生成指令序列示意图：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f44d26762f704a28905e2f65b2a75d53.png" alt="在这里插入图片描述"></p>
<p>Volatile 读插入内存屏障后生成指令序列示意图：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/97e184ee75ed4e18b3066e1c8ab585e1.png" alt="在这里插入图片描述"></p>
<p>通过上面这些我们可以得出如下结论：编译器不会对 volatile 读与 volatile 读后面的任意内存操作重排序；编译器不会对 volatile 写与 volatile 写前面的任意内存操作重排序。</p>
<p>防止重排序使用案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeDoubleCheckedLocking</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Instance instane;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span> Instance <span class="title function_">getInstane</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instane==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SafeDoubleCheckedLocking.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instane==<span class="literal">null</span>)&#123;</span><br><span class="line">                    instane=<span class="keyword">new</span> <span class="title class_">Instance</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instane;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>创建一个对象主要分为如下三步：</p>
<p>分配对象的内存空间。<br>
初始化对象。<br>
设置 instance 指向内存空间。<br>
如果 instane 不加 volatile，上面的 2，3 可能会发生重排序。假设 A，B 两个线程同时获取，A 线程获取到了锁，发生了指令重排序，先设置了 instance 指向内存空间。这个时候 B 线程也来获取，instance 不为空，这样 B 拿到了没有初始化完成的单例对象（如下图）</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/70457cf0d7904aa5a8b3edb1bffd4561.png" alt="在这里插入图片描述"></p>
<p>二、Volatile 与 Synchronized 比较<br>
 1.Volatile 是轻量级的 synchronized，因为它不会引起上下文的切换和调度，所以 Volatile 性能更好。<br>
2.Volatile 只能修饰变量，synchronized 可以修饰方法，静态方法，代码块。<br>
3.Volatile 对任意单个变量的读 / 写具有原子性，但是类似于 i++ 这种复合操作不具有原子性。而锁的互斥执行的特性可以确保对整个临界区代码执行具有原子性。<br>
4. 多线程访问 volatile 不会发生阻塞，而 synchronized 会发生阻塞。<br>
5.volatile 是变量在多线程之间的可见性，synchronize 是多线程之间访问资源的同步性。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-12-12T18:36:28.000Z" title="2022/12/13 02:36:28">2022-12-13</time>发表</span><span class="level-item"><time dateTime="2023-04-04T23:53:27.000Z" title="2023/4/5 07:53:27">2023-04-05</time>更新</span><span class="level-item">2 分钟读完 (大约231个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/12/13/%E3%80%90Hbase%E3%80%91Hbase%E4%B8%8Eswagger%E4%B8%8Eguava%E4%BE%9D%E8%B5%96%E9%94%99%E8%AF%AF/">Hbase整合SpringBoot的问题</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>在一个 Demo 中，springboot 整合 Hbase 出了一个难解决的问题：</p>
<p>tried to access method com.google.common.base.Stopwatch.<init>()V from class org.apache.hadoop.hbase.zookeeper.MetaTableLocator</p>
<p>调用 hbase 就会报错，这是因为 swagger 和 guava 依赖冲突导致的，整合 habse 的 1.0 版本，依赖中不能有 swagger，guava 的版本要低于 17.</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-30T00:17:34.000Z" title="2022/11/30 08:17:34">2022-11-30</time>发表</span><span class="level-item"><time dateTime="2019-06-13T21:42:43.000Z" title="2019/6/14 05:42:43">2019-06-14</time>更新</span><span class="level-item">2 分钟读完 (大约271个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/30/%E3%80%90GOSN%E3%80%91Gosn%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%EF%BC%9F/">【GOSN】Gosn是什么？怎么使用？</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id=""><a class="markdownIt-Anchor" href="#">#</a> </h1>
<p>Gson 是 google 开发的一个开源 Json 解析库，使用十分的方便，在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=maven&amp;spm=1001.2101.3001.7020"> maven</a> 当中导入的方式为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.code.gson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br></pre></td></tr></table></figure>
<p>其中 2.8.2 为版本号，最新版本以及源码可以在官方的 github 上查看：<a target="_blank" rel="noopener" href="https://github.com/google/gson">https://github.com/google/gson</a></p>
<p>这里给出最简单的 Gson 的使用方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//Object转Json字符串</span></span><br><span class="line"> </span><br><span class="line"><span class="type">String</span> <span class="variable">obstr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().toJson(object);</span><br><span class="line"> </span><br><span class="line"><span class="comment">//Json字符串转Object</span></span><br><span class="line"> </span><br><span class="line"><span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Gson</span>().fromJson(obstr);</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-22T13:27:21.000Z" title="2022/11/22 21:27:21">2022-11-22</time>发表</span><span class="level-item"><time dateTime="2023-09-17T07:45:59.000Z" title="2023/9/17 15:45:59">2023-09-17</time>更新</span><span class="level-item">42 分钟读完 (大约6330个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/22/%E3%80%90Flutter&amp;SpringBoot%E3%80%91%E5%A6%82%E4%BD%95%E7%94%A8Flutter%E5%92%8CJava%E6%9D%A5%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%8A%BD%E5%A5%96APP/">如何使用Flutter+SpringBoot+Mysql开发一个简易的抽奖APP（Android教学</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="微信公众号搜索interviewcoder回复关键词吃啥获取源码以及开发教程~"><a class="markdownIt-Anchor" href="#微信公众号搜索interviewcoder回复关键词吃啥获取源码以及开发教程~">#</a> 微信公众号搜索 InterviewCoder 回复关键词《吃啥》获取源码以及开发教程～</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/%E4%BA%8C%E7%BB%B4%E7%A0%81mini.png" alt="二维码mini"></p>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言：</h1>
<h3 id="weat-中文译为吃啥"><a class="markdownIt-Anchor" href="#weat-中文译为吃啥">#</a> Weat 中文译为：吃啥</h3>
<h5 id="吃啥来自于女朋友的一个问题问我可不可以做个抽奖的app奖品都是菜抽中那个今天就做那个菜吃我灵机一动使用interviewcoder公众号里面的chatgpt小程序编辑了下面的文案"><a class="markdownIt-Anchor" href="#吃啥来自于女朋友的一个问题问我可不可以做个抽奖的app奖品都是菜抽中那个今天就做那个菜吃我灵机一动使用interviewcoder公众号里面的chatgpt小程序编辑了下面的文案">#</a> 吃啥来自于女朋友的一个问题，问我可不可以做个抽奖的 APP，奖品都是菜，抽中那个今天就做那个菜吃，我灵机一动，使用 InterviewCoder 公众号里面的 chatGPT 小程序编辑了下面的文案：</h5>
<h5 id="吃啥是一款新奇有趣的应用旨在帮助你找到今天吃什么菜-它通过精心的菜谱抽奖模式为你提供多样而有色彩的食物让你的用餐经历变得更加美好-不仅如此它还可以添加朋友和家人的偏好为大家带来更多惊喜-加入吃啥让你的用餐经历变得更加完美"><a class="markdownIt-Anchor" href="#吃啥是一款新奇有趣的应用旨在帮助你找到今天吃什么菜-它通过精心的菜谱抽奖模式为你提供多样而有色彩的食物让你的用餐经历变得更加美好-不仅如此它还可以添加朋友和家人的偏好为大家带来更多惊喜-加入吃啥让你的用餐经历变得更加完美">#</a> 吃啥是一款新奇有趣的应用，旨在帮助你找到今天吃什么菜。它通过精心的菜谱抽奖模式，为你提供多样而有色彩的食物，让你的用餐经历变得更加美好。不仅如此，它还可以添加朋友和家人的偏好，为大家带来更多惊喜。加入吃啥，让你的用餐经历变得更加完美！</h5>
<h3 id="架构方面"><a class="markdownIt-Anchor" href="#架构方面">#</a> 架构方面：</h3>
<p>移动端：Flutter</p>
<p>后台服务：SpringBoot、Mysql</p>
<h3 id="没有安装dart-flutter-android-studio-vscode的同学可以看看以前的教程这里就不-一-一-介绍了"><a class="markdownIt-Anchor" href="#没有安装dart-flutter-android-studio-vscode的同学可以看看以前的教程这里就不-一-一-介绍了">#</a> 没有安装 dart、flutter、Android Studio、vscode 的同学可以看看以前的教程，这里就不 一 一 介绍了</h3>
<p>本文将详细介绍 weatapp 的开发流程，前后端代码编写阶段，以及后台代码部署。</p>
<h2 id="一-app创建"><a class="markdownIt-Anchor" href="#一-app创建">#</a> 一、APP 创建：</h2>
<ol>
<li>
<p>打开项目路径，输入 cmd 进入到命令行，输入 flutter create weat 进行 flutter 项目创建。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223201656540.png" alt="image-20230223201656540"></p>
</li>
<li>
<p>打开 Android Studio 整理项目，修改仓库配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/google&#x27;</span> &#125;</span><br><span class="line">maven &#123; url <span class="string">&#x27;https://maven.aliyun.com/repository/jcenter&#x27;</span> &#125;</span><br><span class="line">maven &#123; url <span class="string">&#x27;http://maven.aliyun.com/nexus/content/groups/public&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223201935306.png" alt="image-20230223201935306"></p>
<p>3. 点击 Open for Editing in Android Studio 进入安卓视图，拉取 gradle 库</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223202038338.png" alt="image-20230223202038338"></p>
<p>4. 当 Android 主文件不暴红，说明配置完毕了，gradle 库已经拉下来了</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223202433131.png" alt="image-20230223202433131"></p>
<h2 id="二-app启动"><a class="markdownIt-Anchor" href="#二-app启动">#</a> 二、APP 启动：</h2>
<p>​	1. 打开一个安卓模拟器，有条件的同学可以直接使用真机，老师这里为了方便就直接用模拟器了</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223202625528.png" alt="image-20230223202625528"></p>
<p>​	2. 使用 vscode 打开项目并启动 flutter 项目</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223203129146.png" alt="image-20230223203129146"></p>
<p>至此，一个 flutter 项目，创建完成，并启动了！</p>
<h2 id="三-app图标配置"><a class="markdownIt-Anchor" href="#三-app图标配置">#</a> 三、APP 图标配置</h2>
<p>需要打开两个网址：</p>
<p><a target="_blank" rel="noopener" href="https://logo.aliyun.com/logo#/name">https://logo.aliyun.com/logo#/name</a>  阿里云 LOGO 服务</p>
<p><a target="_blank" rel="noopener" href="https://icon.wuruihong.com/">https://icon.wuruihong.com/</a> 图标工厂</p>
<p>1. 打开阿里云 LOGO 输入 APP 名字，吃啥</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223203651967.png" alt="image-20230223203651967"></p>
<p>2. 生成图标：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223203733745.png" alt="image-20230223203733745"></p>
<p>购买一个你喜欢的图标，如果不购买的话，自己在网上找一个也行，但是一定要有商业授权！</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223204102921.png" alt="image-20230223204102921"></p>
<p>得到图标后，进入图标工厂，生成一套 ios 和一套 Android 的图标文件：</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230223205448783.png" alt="image-20230223205448783"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223205507890.png" alt="image-20230223205507890"></p>
<p>进入安卓文件夹，将该目录的文件复制到你的项目下面 \android\app\src\main\res</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223205604112.png" alt="image-20230223205604112"></p>
<h4 id="成效"><a class="markdownIt-Anchor" href="#成效">#</a> 成效：</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223210003933.png" alt="image-20230223210003933"></p>
<p>至此，APP 图标设置完成！</p>
<h2 id="四-app后台开发springbootmysql"><a class="markdownIt-Anchor" href="#四-app后台开发springbootmysql">#</a> 四、APP 后台开发（SpringBoot+Mysql）</h2>
<h4 id="为什么先开发app部分这个纯属个人习惯我比较喜欢先有数据和接口直接开发app的感觉会更轻松"><a class="markdownIt-Anchor" href="#为什么先开发app部分这个纯属个人习惯我比较喜欢先有数据和接口直接开发app的感觉会更轻松">#</a> 为什么先开发 APP 部分？，这个纯属个人习惯，我比较喜欢先有数据和接口，直接开发 APP 的感觉会更轻松！</h4>
<h4 id="整理需求"><a class="markdownIt-Anchor" href="#整理需求">#</a> 整理需求：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">每次进入app随机获取食物列表</span><br><span class="line">点击开始抽奖 随机跳转 点击停止 按钮回显食物名称 点击查看菜谱 弹窗提示做法</span><br></pre></td></tr></table></figure>
<p>根据如上需求，我明确了客户到底想要什么</p>
<p>1. 这是一个服务类型的 APP，服务于不知道吃什么的客户</p>
<p>2. 每次进入抽奖页面需要获取不同的菜谱奖品列表</p>
<p>3. 这个页面需要有个按钮，可以来重置奖品，并且要限制次数</p>
<p>4. 点击抽奖按钮，开始抽奖，再次点击，或者超过限制时间，停止选择，并将按钮置为：查看食谱</p>
<p>5. 点击查看食谱，进入食谱详情，展示过程</p>
<p>根据我的聪明思考，画出了如下 UI：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230223210734630.png" alt="image-20230223210734630"></p>
<h3 id="开玩笑画的很烂但是就是这个意思"><a class="markdownIt-Anchor" href="#开玩笑画的很烂但是就是这个意思">#</a> 开玩笑，画的很烂，但是就是这个意思！。</h3>
<p>那么，开始开发后台数据，为我们的 APP 提供一个接口～！</p>
<p>经过一系列操作，得到以下数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for iv_dishes</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `iv_dishes`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `iv_dishes`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;唯一ID&#x27;</span>,</span><br><span class="line">  `dishes_name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品名字&#x27;</span>,</span><br><span class="line">  `dishes_step` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品做法&#x27;</span>,</span><br><span class="line">  `dishes_url` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;菜品图片地址&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">9</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci COMMENT <span class="operator">=</span> <span class="string">&#x27;菜品表&#x27;</span> ROW_FORMAT <span class="operator">=</span> Compact;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of iv_dishes</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;凉拌黄瓜虾仁&#x27;</span>, <span class="string">&#x27;1.小米辣 白芝麻蒜未辣椒面 淋上少许热油\r\n2.生抽2勺 油 醋各1代糖半勺搅匀备用\r\n3.虾煮熟去壳 木耳焯水捞出 黄瓜拍块\r\n4.淋上酱汁拌匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224081935481.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;低卡酱油鸡蛋&#x27;</span>, <span class="string">&#x27;1.生抽4勺 醋2香油1勺一把葱花\r\n2.鸡蛋冷水下锅煮8分钟盖盖焖1分钟后泡冷水\r\n3.温开水4勺搅匀\r\n4.鸡蛋剥壳切对半淋上酱汁拌匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082035768.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;低卡葱香鸡腿&#x27;</span>, <span class="string">&#x27;1.蒜末 葱花 白艺麻小米辣淋上少许热油\r\n2.生抽1勺 许盐搅匀\r\n3.鸡腿熟捞出微凉后撕成小块\r\n4.淋上酱汁拌匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082101091.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;低卡平菇炒蛋&#x27;</span>, <span class="string">&#x27;1.鸡蛋炒熟盛出\r\n2.油热下从蒜炒香\r\n3.下平菇炒出汁，倒入炒好的鸡蛋\r\n4.生抽 油 辣椒粉各1勺 少许盐炒匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082137439.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">&#x27;凉拌虾仁西兰花&#x27;</span>, <span class="string">&#x27;1.蒜未 葱花 辣椒面白芝麻淋上少许热油\r\n2.生抽2勺 醋各1勺搅拌均匀\r\n3.西兰花焯水捞出，虾焯水去壳鸡蛋白切块\r\n4.淋上酱汁拌匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082204322.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">&#x27;凉拌黄瓜木耳鸡蛋&#x27;</span>, <span class="string">&#x27;1.木耳鸡蛋各煮熟捞出 黄瓜拍块\r\n2.生抽2勺醋香油各11勺温开水拌匀即可开吃&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082230282.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="string">&#x27;凉拌黄瓜豆腐&#x27;</span>, <span class="string">&#x27;1.白芝麻辣椒面小米辣,蒜未 葱花 淋少许热油\r\n2.生抽2勺 醋油各1勺 少许盐代糖拌匀\r\n3.黄瓜拍块去籽豆腐煮熟捞出\r\n4.撒上香葱淋上酱汁拌匀即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082404878.png&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `iv_dishes` <span class="keyword">VALUES</span> (<span class="number">8</span>, <span class="string">&#x27;木耳炒鸡蛋&#x27;</span>, <span class="string">&#x27;1.鸡蛋炒熟盛出\r\n2.蒜未和胡萝人炒软倒木耳炒熟再倒鸡蛋\r\n3.耗油生抽各1勺少许盐-小半碗淀粉水\r\n4.炒匀下葱段即可&#x27;</span>, <span class="string">&#x27;https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224082512562.png&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接下来创建一个 SpringBoot 项目，并写出 entity、 controller、service、impl、mapper、xml 等需要的代码</p>
<p>entity：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * 菜品表</span><br><span class="line"> * &lt;/p&gt;</span><br><span class="line"> *</span><br><span class="line"> * @author Brath</span><br><span class="line"> * @since 2023-02-23</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@EqualsAndHashCode(callSuper = false)</span><br><span class="line">@TableName(&quot;iv_dishes&quot;)</span><br><span class="line">@ApiModel(value=&quot;IvDishes对象&quot;, description=&quot;菜品表&quot;)</span><br><span class="line">public class IvDishes implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;唯一ID&quot;)</span><br><span class="line">    @TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br><span class="line">    private Integer id;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;菜品名字&quot;)</span><br><span class="line">    private String dishesName;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;菜品做法&quot;)</span><br><span class="line">    private String dishesStep;</span><br><span class="line"></span><br><span class="line">    @ApiModelProperty(value = &quot;菜品图片地址&quot;)</span><br><span class="line">    private String dishesUrl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜品表 前端控制器</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-02-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dishes&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IvDishesController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * SLF4J日志</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(IvDishesController.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 菜品服务接口</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IvDishesService dishesService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***</span></span><br><span class="line"><span class="comment">     * 获取菜品列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getDishes&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getDishes</span><span class="params">(<span class="meta">@RequestParam(value = &quot;page&quot;, defaultValue = &quot;1&quot;)</span> Integer page, <span class="meta">@RequestParam(value = &quot;size&quot;, defaultValue = &quot;8&quot;)</span> Integer size)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;【用户服务】获取菜品列表,开始&quot;</span>);</span><br><span class="line">        Map&lt;Object, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        IPage&lt;IvDishes&gt; prizeRecords = dishesService.getDishes(page, size);</span><br><span class="line">        <span class="keyword">if</span> (CollectionUtils.isEmpty(prizeRecords.getRecords())) &#123;</span><br><span class="line">            result.put(<span class="string">&quot;fail&quot;</span>, ResponseCode.DATA_DOES_NOT_EXIST);</span><br><span class="line">            logger.error(<span class="string">&quot;【用户服务】获取菜品列表,服务错误:&#123;&#125;&quot;</span>, ResponseCode.DATA_DOES_NOT_EXIST);</span><br><span class="line">        &#125;</span><br><span class="line">        result.put(<span class="string">&quot;prizeRecords&quot;</span>, prizeRecords.getRecords());</span><br><span class="line">        logger.info(<span class="string">&quot;【用户服务】获取菜品列表,完毕&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseUtil.ok(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜品表 服务类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-02-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IvDishesService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;IvDishes&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取菜品列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IPage&lt;IvDishes&gt; <span class="title function_">getDishes</span><span class="params">(Integer page, Integer size)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>impl：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜品表 服务实现类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-02-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IvDishesServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;IvDishesMapper, IvDishes&gt; <span class="keyword">implements</span> <span class="title class_">IvDishesService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取菜品列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;IvDishes&gt; <span class="title function_">getDishes</span><span class="params">(Integer page, Integer size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.getDishes(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(page, size), <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 菜品表 Mapper 接口</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2023-02-23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IvDishesMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;IvDishes&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取菜品列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectPage</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectQueryWrapper</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IPage&lt;IvDishes&gt; <span class="title function_">getDishes</span><span class="params">(Page&lt;Object&gt; objectPage, QueryWrapper&lt;Object&gt; objectQueryWrapper)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.brath.mapper.IvDishesMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询映射结果 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;DishesMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cn.brath.entity.IvDishes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dishes_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dishesName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dishes_step&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dishesStep&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dishes_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dishesUrl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDishes&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;cn.brath.entity.IvDishes&quot;</span>&gt;</span></span><br><span class="line">        select d.*</span><br><span class="line">        from iv_dishes d</span><br><span class="line">        ORDER BY RAND()</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>application.yaml 配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">9999</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://127.0.0.1:3306/iv-user-services?createDatabaseIfNotExist=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai&amp;nullCatalogMeansCurrent=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">100</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">6000</span></span><br><span class="line">      <span class="attr">pool-prepared-statements:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">max-pool-prepared-statement-per-connection-size:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line">      <span class="comment">#Oracle需要打开注释</span></span><br><span class="line">      <span class="comment">#      validation-query: SELECT 1 FROM DUAL</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span> <span class="string">/druid/*</span></span><br><span class="line">        <span class="comment">#login-username: admin</span></span><br><span class="line">        <span class="comment">#login-password: admin</span></span><br><span class="line">        <span class="comment">#达梦数据库，需要注释掉，其他数据库可以打开</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span></span><br><span class="line">          <span class="attr">log-slow-sql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">merge-sql:</span> <span class="literal">false</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">multi-statement-allow:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>经过如上一系列配置，我们项目启动成功并可以访问到接口：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224124319493.png" alt="image-20230224124319493"></p>
<p>接下来只要把程序部署上线就搞定了！</p>
<p>部署后台程序：</p>
<p>将我们的 Dockerfile、运行脚本、jar 包传入服务器</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224124656682.png" alt="image-20230224124656682"></p>
<p>Dockerfile:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#java8环境</span></span><br><span class="line"><span class="keyword">FROM</span> openkbs/jdk11-mvn-py3</span><br><span class="line"></span><br><span class="line"><span class="comment">#root用户</span></span><br><span class="line"><span class="keyword">USER</span> root</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置时区</span></span><br><span class="line"><span class="keyword">ENV</span> TZ=Asia/Shanghai</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">ln</span> -snf /usr/share/zoneinfo/<span class="variable">$TZ</span> /etc/localtime &amp;&amp; <span class="built_in">echo</span> <span class="variable">$TZ</span> &gt; /etc/timezone</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Auth</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Brath</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置工作目录集</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /root/weatWork</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#复制jars和命令</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> *.jar /root/weatWork/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> run.sh /root/weatWork/run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#脚本权限设置</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /root/weatWork/run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#暴露端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">9999</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="1dockerfile打包镜像"><a class="markdownIt-Anchor" href="#1dockerfile打包镜像">#</a> 1.Dockerfile 打包镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.进入工作目录</span><br><span class="line">2.docker build -t weat .</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224124821870.png" alt="image-20230224124821870"></p>
<h3 id="2运行容器"><a class="markdownIt-Anchor" href="#2运行容器">#</a> 2. 运行容器</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dit -p 9999:9999 --privileged=true -P  --name  weat weat /bin/bash -c &quot;tail -f /dev/null&quot; -g &quot;daemon off;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224124959281.png" alt="image-20230224124959281"></p>
<h3 id="3启动jar包"><a class="markdownIt-Anchor" href="#3启动jar包">#</a> 3. 启动 Jar 包</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器</span></span><br><span class="line">docker exec -it weat bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行脚本</span></span><br><span class="line">sh run.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看日志</span></span><br><span class="line">tail -100f weatlog.log</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224125037992.png" alt="image-20230224125037992"></p>
<h3 id="4联调接口"><a class="markdownIt-Anchor" href="#4联调接口">#</a> 4. 联调接口</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224125210437.png" alt="image-20230224125210437"></p>
<h2 id="五-app移动端开发flutter"><a class="markdownIt-Anchor" href="#五-app移动端开发flutter">#</a> 五、APP 移动端开发（Flutter）</h2>
<h4 id="weatapp架构设计大概如下"><a class="markdownIt-Anchor" href="#weatapp架构设计大概如下">#</a> weatApp 架构设计大概如下：</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">lib:</span><br><span class="line"></span><br><span class="line">​	common 通用层</span><br><span class="line"></span><br><span class="line">​	core 核心层</span><br><span class="line"></span><br><span class="line">​	routers 路由曾</span><br><span class="line"></span><br><span class="line">​	utils 工具层</span><br><span class="line"></span><br><span class="line">​	viewmodel 视图模型层</span><br><span class="line"></span><br><span class="line">​	views 视图层</span><br></pre></td></tr></table></figure>
<p>需要安装的依赖：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#网络请求</span></span><br><span class="line"><span class="attr">dio:</span> <span class="string">^4.0.6</span></span><br><span class="line"><span class="comment">#getx </span></span><br><span class="line"><span class="attr">get:</span> <span class="string">^4.6.5</span></span><br><span class="line"><span class="comment">#透明弹出框</span></span><br><span class="line"><span class="attr">fluttertoast:</span> <span class="string">^8.0.8</span></span><br><span class="line"><span class="comment">#屏幕适配</span></span><br><span class="line"><span class="attr">flutter_screenutil:</span> <span class="string">^5.5.3+2</span></span><br><span class="line"><span class="comment">#全局状态管理</span></span><br><span class="line"><span class="attr">provider:</span> <span class="string">^6.0.1</span></span><br><span class="line"><span class="comment">#轮播图</span></span><br><span class="line"><span class="attr">flutter_swiper_plus:</span> <span class="string">^2.0.4</span></span><br><span class="line"><span class="comment"># GET WIDGET UI库</span></span><br><span class="line"><span class="attr">getwidget:</span> <span class="string">^2.0.5</span></span><br><span class="line"><span class="comment">#图片缓存</span></span><br><span class="line"><span class="attr">cached_network_image:</span> <span class="string">^3.2.0</span></span><br><span class="line"><span class="comment">#图片放大缩小</span></span><br><span class="line"><span class="attr">photo_view:</span> <span class="string">^0.13.0</span></span><br><span class="line"><span class="comment">#权限申请</span></span><br><span class="line"><span class="attr">permission_handler:</span> <span class="string">^9.2.0</span></span><br><span class="line"><span class="comment">#贝壳组件库</span></span><br><span class="line"><span class="attr">bruno:</span> <span class="string">^2.2.0</span></span><br><span class="line"><span class="comment">#easyloading</span></span><br><span class="line"><span class="attr">flutter_easyloading:</span> <span class="string">^3.0.3</span></span><br></pre></td></tr></table></figure>
<h3 id="代码如下"><a class="markdownIt-Anchor" href="#代码如下">#</a> 代码如下：</h3>
<h4 id="commondart"><a class="markdownIt-Anchor" href="#commondart">#</a> common.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:bruno/bruno.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:get/get.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:getwidget/getwidget.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/main.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Common组件库</span></span><br><span class="line"><span class="comment"> * @Auth: Brath</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取title的AppBar</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">AppBar getAppBar(<span class="built_in">String</span> title, &#123;<span class="keyword">required</span> context&#125;) &#123;</span><br><span class="line">  <span class="keyword">return</span> AppBar(</span><br><span class="line">      toolbarHeight: <span class="number">40.0</span>.h,</span><br><span class="line">      centerTitle: <span class="keyword">true</span>,</span><br><span class="line">      shadowColor: Color.fromARGB(<span class="number">255</span>, <span class="number">59</span>, <span class="number">82</span>, <span class="number">76</span>),</span><br><span class="line">      backgroundColor: Colors.transparent,</span><br><span class="line">      leading: <span class="keyword">null</span>,</span><br><span class="line">      leadingWidth: <span class="number">30.</span>w,</span><br><span class="line">      elevation: <span class="number">0.0</span>,</span><br><span class="line">      actions: [],</span><br><span class="line">      title: (Text(</span><br><span class="line">        title,</span><br><span class="line">        style: TextStyle(</span><br><span class="line">            fontSize: <span class="number">16.</span>sp,</span><br><span class="line">            color: Colors.black,</span><br><span class="line">            fontFamily: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">            fontWeight: FontWeight.bold),</span><br><span class="line">      )));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 获取卡片圆形背景容器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">getCardContainer</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  getCardContainer(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">this</span>.isBorder,</span><br><span class="line">    <span class="keyword">this</span>.BorderCircular,</span><br><span class="line">    <span class="keyword">this</span>.width,</span><br><span class="line">    <span class="keyword">this</span>.height,</span><br><span class="line">    <span class="keyword">this</span>.widget,</span><br><span class="line">    <span class="keyword">this</span>.margin,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool?</span> isBorder;</span><br><span class="line">  <span class="built_in">double?</span> BorderCircular;</span><br><span class="line">  <span class="built_in">double?</span> height;</span><br><span class="line">  <span class="built_in">double?</span> width;</span><br><span class="line">  Widget? widget;</span><br><span class="line">  EdgeInsetsGeometry? margin;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      margin: margin,</span><br><span class="line">      decoration: isBorder == <span class="keyword">true</span></span><br><span class="line">          ? BoxDecoration(</span><br><span class="line">              color: Colors.white,</span><br><span class="line">              shape: BoxShape.rectangle,</span><br><span class="line">              boxShadow: [</span><br><span class="line">                BoxShadow(</span><br><span class="line">                  color: Colors.grey[<span class="number">200</span>]!,</span><br><span class="line">                  offset: Offset(<span class="number">1.</span>w, <span class="number">1.</span>h),</span><br><span class="line">                  blurRadius: <span class="number">1.</span>r,</span><br><span class="line">                  spreadRadius: <span class="number">1.</span>r,</span><br><span class="line">                ),</span><br><span class="line">              ],</span><br><span class="line">              border: Border.all(color: Colors.white, width: <span class="number">1.</span>w), <span class="comment">// border</span></span><br><span class="line">              borderRadius:</span><br><span class="line">                  BorderRadius.circular((BorderCircular ?? <span class="number">15.</span>r)), <span class="comment">// 圆角</span></span><br><span class="line">            )</span><br><span class="line">          : <span class="keyword">null</span>,</span><br><span class="line">      width: width,</span><br><span class="line">      height: height,</span><br><span class="line">      child: widget,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="zoomimagedart"><a class="markdownIt-Anchor" href="#zoomimagedart">#</a> ZoomImage.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:ui&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZoomImage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  ZoomImage(&#123;Key? key, <span class="keyword">this</span>.url&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="built_in">String?</span> url;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;StatefulWidget&gt; createState() &#123;</span><br><span class="line">    <span class="keyword">return</span> _ZoomImage();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ZoomImage</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">ZoomImage</span>&gt; <span class="title">with</span> <span class="title">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  AnimationController? _controller;</span><br><span class="line">  Animation&lt;Offset&gt;? _animation;</span><br><span class="line">  Offset _offset = Offset.zero;</span><br><span class="line">  <span class="built_in">double</span> _scale = <span class="number">1.0</span>;</span><br><span class="line">  Offset? _normalizedOffset;</span><br><span class="line">  <span class="built_in">double?</span> _previousScale;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">double</span> _kMinFlingVelocity = <span class="number">600.0</span>;</span><br><span class="line">  <span class="built_in">bool</span> _isEnlarge = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">bool</span> _isHideTitleBar = <span class="keyword">false</span>;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _controller = AnimationController(vsync: <span class="keyword">this</span>);</span><br><span class="line">    _controller?.addListener(() &#123;</span><br><span class="line">      setState(() &#123;</span><br><span class="line">        _offset = _animation!.value;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">    _controller!.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Offset _clampOffset(Offset offset) &#123;</span><br><span class="line">    <span class="keyword">final</span> Size size = context.size!;</span><br><span class="line">    <span class="comment">// widget的屏幕宽度</span></span><br><span class="line">    <span class="keyword">final</span> Offset minOffset = Offset(size.width, size.height) * (<span class="number">1.0</span> - _scale);</span><br><span class="line">    <span class="comment">// 限制他的最小尺寸</span></span><br><span class="line">    <span class="keyword">return</span> Offset(</span><br><span class="line">        offset.dx.clamp(minOffset.dx, <span class="number">0.0</span>), offset.dy.clamp(minOffset.dy, <span class="number">0.0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _handleOnScaleStart(ScaleStartDetails details) &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isHideTitleBar = <span class="keyword">true</span>;</span><br><span class="line">      _previousScale = _scale;</span><br><span class="line">      _normalizedOffset = (details.focalPoint - _offset) / _scale;</span><br><span class="line">      <span class="comment">// 计算图片放大后的位置</span></span><br><span class="line">      _controller!.stop();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _handleOnScaleUpdate(ScaleUpdateDetails details) &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _scale = (_previousScale! * details.scale).clamp(<span class="number">1.0</span>, <span class="number">3.0</span>);</span><br><span class="line">      <span class="comment">// 限制放大倍数 1~3倍</span></span><br><span class="line">      _offset = _clampOffset(details.focalPoint - _normalizedOffset! * _scale);</span><br><span class="line">      <span class="comment">// 更新当前位置</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _handleOnScaleEnd(ScaleEndDetails details) &#123;</span><br><span class="line">    _setSystemUi();</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> magnitude = details.velocity.pixelsPerSecond.distanceSquared;</span><br><span class="line">    <span class="keyword">if</span> (magnitude &lt; _kMinFlingVelocity) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">final</span> Offset direction = details.velocity.pixelsPerSecond / magnitude;</span><br><span class="line">    <span class="comment">// 计算当前的方向</span></span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">double</span> distance = (Offset.zero &amp; context.size!).shortestSide;</span><br><span class="line">    <span class="comment">// 计算放大倍速，并相应的放大宽和高，比如原来是600*480的图片，放大后倍数为1.25倍时，宽和高是同时变化的</span></span><br><span class="line">    _animation = _controller!.drive(Tween&lt;Offset&gt;(</span><br><span class="line">        begin: _offset, end: _clampOffset(_offset + direction * distance)));</span><br><span class="line">    _controller!</span><br><span class="line">      ..value = <span class="number">0.0</span></span><br><span class="line">      ..fling(velocity: magnitude / <span class="number">1000.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _onDoubleTap() &#123;</span><br><span class="line">    _isHideTitleBar = <span class="keyword">true</span>;</span><br><span class="line">    _setSystemUi();</span><br><span class="line">    Size size = context.size!;</span><br><span class="line">    _isEnlarge = !_isEnlarge;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      <span class="keyword">if</span> (!_isEnlarge) &#123;</span><br><span class="line">        _scale = <span class="number">2.0</span>;</span><br><span class="line">        _offset = Offset(-(size.width / <span class="number">2</span>), -(size.height / <span class="number">2</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _scale = <span class="number">1.0</span>;</span><br><span class="line">        _offset = Offset.zero;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _onTap() &#123;</span><br><span class="line">    setState(() &#123;</span><br><span class="line">      _isHideTitleBar = !_isHideTitleBar;</span><br><span class="line">    &#125;);</span><br><span class="line">    _setSystemUi();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Stack(</span><br><span class="line">      children: [_bodyView(), _titleBar()],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _bodyView() &#123;</span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      onScaleStart: _handleOnScaleStart,</span><br><span class="line">      onScaleUpdate: _handleOnScaleUpdate,</span><br><span class="line">      onScaleEnd: _handleOnScaleEnd,</span><br><span class="line">      onDoubleTap: _onDoubleTap,</span><br><span class="line">      onTap: _onTap,</span><br><span class="line">      child: Container(</span><br><span class="line">        color: _isHideTitleBar ? Colors.black : Colors.white,</span><br><span class="line">        child: SizedBox.expand(</span><br><span class="line">          child: ClipRect(</span><br><span class="line">            child: Transform(</span><br><span class="line">              transform: Matrix4.identity()</span><br><span class="line">                ..translate(_offset.dx, _offset.dy)</span><br><span class="line">                ..scale(_scale),</span><br><span class="line">              child: Column(</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                children: [</span><br><span class="line">                  SizedBox(</span><br><span class="line">                      width: <span class="number">700.0</span>.w,</span><br><span class="line">                      height: <span class="number">600.0</span>.h,</span><br><span class="line">                      child: Image.network(widget.url!)),</span><br><span class="line">                  Container()</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _titleBar() &#123;</span><br><span class="line">    <span class="keyword">return</span> Offstage(</span><br><span class="line">      child: Container(</span><br><span class="line">        alignment: Alignment.centerLeft,</span><br><span class="line">        padding: EdgeInsets.only(</span><br><span class="line">            top: MediaQueryData.fromWindow(<span class="built_in">window</span>).padding.top,</span><br><span class="line">            left: ScreenUtil().setWidth(<span class="number">24</span>)),</span><br><span class="line">        color: <span class="keyword">const</span> Color.fromARGB(<span class="number">255</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">32</span>),</span><br><span class="line">        height: MediaQuery.of(context).size.height * <span class="number">0.1</span>,</span><br><span class="line">        width: MediaQuery.of(context).size.width,</span><br><span class="line">        child: GestureDetector(</span><br><span class="line">          child: Icon(</span><br><span class="line">            Icons.arrow_back,</span><br><span class="line">            size: <span class="number">30.0</span>.w,</span><br><span class="line">            color: Colors.white,</span><br><span class="line">          ),</span><br><span class="line">          onTap: () &#123;</span><br><span class="line">            Navigator.pop(context);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">      offstage: _isHideTitleBar,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _setSystemUi() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_isHideTitleBar) &#123;</span><br><span class="line">      SystemChrome.setEnabledSystemUIMode(SystemUiMode.edgeToEdge);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      SystemChrome.setEnabledSystemUIMode(SystemUiMode.manual);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="globaldart"><a class="markdownIt-Anchor" href="#globaldart">#</a> Global.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Global</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">String</span> BaseUrl = <span class="string">&#x27;http://127.0.0.1:9999/&#x27;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*请求dio对象 */</span></span><br><span class="line">  <span class="keyword">late</span> Dio dio;</span><br><span class="line">  <span class="comment">/*通用超时 */</span></span><br><span class="line">  <span class="built_in">int</span> timeOut = <span class="number">50000</span>;</span><br><span class="line">  <span class="comment">/*请求单例 */</span></span><br><span class="line">  <span class="keyword">static</span> Global? _instance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/*获取实例 */</span></span><br><span class="line">  <span class="keyword">static</span> Global? getInstance() &#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">null</span>) _instance = Global();</span><br><span class="line">    <span class="keyword">return</span> _instance;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Global() &#123;</span><br><span class="line">    dio = Dio();</span><br><span class="line">    dio.options = BaseOptions(</span><br><span class="line">        baseUrl: BaseUrl,</span><br><span class="line">        connectTimeout: timeOut,</span><br><span class="line">        sendTimeout: timeOut,</span><br><span class="line">        receiveTimeout: timeOut,</span><br><span class="line">        contentType: Headers.jsonContentType,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">// 请求拦截器 and 响应拦截机 and 错误处理</span></span><br><span class="line">    dio.interceptors.add(InterceptorsWrapper(onRequest: (options, handler) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 请求数据 ==========================&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;url = <span class="subst">$&#123;options.uri.toString()&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;headers = <span class="subst">$&#123;options.headers&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;params = <span class="subst">$&#123;options.data&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 请求数据 ==========================&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> handler.next(options);</span><br><span class="line">    &#125;, onResponse: (response, handler) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 响应数据 ==========================&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;code = <span class="subst">$&#123;response.statusCode&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;data = <span class="subst">$&#123;response.data&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 响应数据 ==========================&quot;</span>);</span><br><span class="line">      handler.next(response);</span><br><span class="line">    &#125;, onError: (DioError e, handler) &#123;</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 错误响应数据 ======================&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;type = <span class="subst">$&#123;e.type&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;message = <span class="subst">$&#123;e.message&#125;</span>&quot;</span>);</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;\n================== 错误响应数据 ======================&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> handler.next(e);</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="routesdart"><a class="markdownIt-Anchor" href="#routesdart">#</a> routes.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignore_for_file: prefer_const_constructors</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/cupertino.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/views/index/IndexView.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, WidgetBuilder&gt; routes = &#123;</span><br><span class="line">  <span class="string">&quot;/&quot;</span>: (context) =&gt; IndexView(),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 渐隐跳转路由</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> opcityPush(BuildContext context, Widget view, &#123;<span class="built_in">int?</span> milliseconds&#125;) &#123;</span><br><span class="line">  Navigator.push(</span><br><span class="line">    context,</span><br><span class="line">    PageRouteBuilder(</span><br><span class="line">      transitionDuration:</span><br><span class="line">          <span class="built_in">Duration</span>(milliseconds: milliseconds ?? <span class="number">300</span>), <span class="comment">//动画时间为300毫秒</span></span><br><span class="line">      pageBuilder: (BuildContext context, Animation&lt;<span class="built_in">double</span>&gt; animation,</span><br><span class="line">          Animation secondaryAnimation) &#123;</span><br><span class="line">        <span class="keyword">return</span> FadeTransition(</span><br><span class="line">          <span class="comment">//使用渐隐渐入过渡,</span></span><br><span class="line">          opacity: animation,</span><br><span class="line">          child: view, <span class="comment">//路由B</span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 带路由树跳转</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> Push(BuildContext context, Widget view) &#123;</span><br><span class="line">  Navigator.push(</span><br><span class="line">      context,</span><br><span class="line">      CupertinoPageRoute(</span><br><span class="line">        builder: (context) =&gt; view,</span><br><span class="line">      ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> NavigatorPop(BuildContext context) &#123;</span><br><span class="line">  Navigator.of(context).pop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 返回上一级路由树，没有上级会黑屏</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> Pop(BuildContext context, Widget view) &#123;</span><br><span class="line">  Navigator.pop(</span><br><span class="line">      context,</span><br><span class="line">      CupertinoPageRoute(</span><br><span class="line">        builder: (context) =&gt; view,</span><br><span class="line">      ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="showmessage_utildart"><a class="markdownIt-Anchor" href="#showmessage_utildart">#</a> showmessage_util.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ignore_for_file: prefer_equal_for_default_values, sized_box_for_whitespace</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:fluttertoast/fluttertoast.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">@author brath</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">@创建时间：2022/5/10</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">封装自定义弹框</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DialogUtils</span> </span>&#123;</span><br><span class="line">  <span class="comment">/// <span class="language-markdown">显示普通消息</span></span></span><br><span class="line">  <span class="keyword">static</span> showMessage(<span class="built_in">String</span> msg,</span><br><span class="line">      &#123;toastLength: Toast.LENGTH_LONG,</span><br><span class="line">      gravity: ToastGravity.CENTER,</span><br><span class="line">      timeInSecForIosWeb: <span class="number">2</span>,</span><br><span class="line">      textColor: Colors.black,</span><br><span class="line">      backgroundColor: Colors.grey,</span><br><span class="line">      fontSize: <span class="number">16.0</span>&#125;) &#123;</span><br><span class="line">    <span class="comment">// 先关闭弹框再显示对应弹框</span></span><br><span class="line">    Fluttertoast.cancel();</span><br><span class="line">    Fluttertoast.showToast(</span><br><span class="line">      msg: msg,</span><br><span class="line">      toastLength: toastLength,</span><br><span class="line">      webShowClose: <span class="keyword">true</span>,</span><br><span class="line">      gravity: gravity,</span><br><span class="line">      textColor: textColor,</span><br><span class="line">      timeInSecForIosWeb: timeInSecForIosWeb,</span><br><span class="line">      backgroundColor: Colors.grey[<span class="number">50</span>],</span><br><span class="line">      fontSize: <span class="number">13.0</span>.sp,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="index_viewmodeldart"><a class="markdownIt-Anchor" href="#index_viewmodeldart">#</a> index_viewmodel.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexViewModel</span> <span class="keyword">extends</span> <span class="title">ChangeNotifier</span> </span>&#123;</span><br><span class="line">  <span class="built_in">bool?</span> isLotte = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">Map?</span> currentDishes = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool?</span> <span class="keyword">get</span> getIsLotte &#123;</span><br><span class="line">    <span class="keyword">return</span> isLotte;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> setIsLotte(<span class="built_in">bool</span> isLotte) &#123;</span><br><span class="line">    <span class="keyword">this</span>.isLotte = isLotte;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map?</span> <span class="keyword">get</span> getCurrentDishes &#123;</span><br><span class="line">    <span class="keyword">return</span> currentDishes;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> setCurrentDishes(<span class="built_in">Map</span> currentDishes) &#123;</span><br><span class="line">    <span class="keyword">this</span>.currentDishes = currentDishes;</span><br><span class="line">    notifyListeners();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="indexviewdart"><a class="markdownIt-Anchor" href="#indexviewdart">#</a> IndexView.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:getwidget/getwidget.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/common/ZoomImage.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/core/Global.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/routers/routes.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/utils/showmessage_util.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/viewmodel/index_viewmodel.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/views/index/DishesDetail.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 首页视图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> IndexView(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;IndexView&gt; createState() =&gt; _IndexViewState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_IndexViewState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">IndexView</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">const</span> LotterView();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 轮播抽奖页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LotterView</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> LotterView(&#123;Key? key&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;LotterView&gt; createState() =&gt; _LotterViewState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_LotterViewState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">LotterView</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//抽奖控制器</span></span><br><span class="line">  <span class="keyword">final</span> SimpleLotteryController _simpleLotteryController =</span><br><span class="line">      SimpleLotteryController();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">int</span> page = <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">int</span> size = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//奖品列表</span></span><br><span class="line">  <span class="built_in">List</span> dishesList = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">//奖品loding</span></span><br><span class="line">  <span class="built_in">bool</span> load = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化奖品列表</span></span><br><span class="line">  _initPrizeList() <span class="keyword">async</span> &#123;</span><br><span class="line">    Global.getInstance()!.dio.<span class="keyword">get</span>(<span class="string">&quot;dishes/getDishes&quot;</span>, queryParameters: &#123;</span><br><span class="line">      <span class="string">&#x27;page&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;size&#x27;</span>: <span class="number">8</span>,</span><br><span class="line">    &#125;).then((value) =&gt; &#123;</span><br><span class="line">          dishesList = value.data[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;prizeRecords&#x27;</span>],</span><br><span class="line">          load = <span class="keyword">true</span>,</span><br><span class="line">          setState(() &#123;&#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _initPrizeList();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _simpleLotteryController.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      body: MediaQuery.removePadding(</span><br><span class="line">        removeTop: <span class="keyword">true</span>,</span><br><span class="line">        context: context,</span><br><span class="line">        child: ListView(</span><br><span class="line">          children: [</span><br><span class="line">            Container(</span><br><span class="line">              width: MediaQuery.of(context).size.width,</span><br><span class="line">              height: MediaQuery.of(context).size.height,</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">                gradient: LinearGradient(</span><br><span class="line">                    begin: Alignment.topLeft, <span class="comment">//左中</span></span><br><span class="line">                    end: Alignment.bottomRight, <span class="comment">//右中</span></span><br><span class="line">                    colors: [</span><br><span class="line">                      Theme.of(context).primaryColor,</span><br><span class="line">                      <span class="keyword">const</span> Color.fromRGBO(<span class="number">180</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>),</span><br><span class="line">                      <span class="keyword">const</span> Color.fromRGBO(<span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>),</span><br><span class="line">                      Theme.of(context).primaryColor</span><br><span class="line">                    ]),</span><br><span class="line">              ),</span><br><span class="line">              child: Column(</span><br><span class="line">                children: [</span><br><span class="line">                  Container(</span><br><span class="line">                    padding: EdgeInsets.only(top: <span class="number">50.</span>h),</span><br><span class="line">                    child: Wrap(</span><br><span class="line">                      children: [</span><br><span class="line">                        Text(<span class="string">&#x27;今日菜品&#x27;</span>,</span><br><span class="line">                            style: TextStyle(</span><br><span class="line">                              fontSize: <span class="number">32.</span>sp,</span><br><span class="line">                              fontWeight: FontWeight.w600,</span><br><span class="line">                              fontFamily: <span class="string">&#x27;jinbu&#x27;</span>,</span><br><span class="line">                              color: Colors.white,</span><br><span class="line">                            )),</span><br><span class="line">                        Text(</span><br><span class="line">                          <span class="string">&#x27;大放送&#x27;</span>,</span><br><span class="line">                          style: TextStyle(</span><br><span class="line">                              fontSize: <span class="number">32.</span>sp,</span><br><span class="line">                              fontWeight: FontWeight.w600,</span><br><span class="line">                              fontFamily: <span class="string">&#x27;jinbu&#x27;</span>,</span><br><span class="line">                              color: <span class="keyword">const</span> Color.fromARGB(<span class="number">255</span>, <span class="number">252</span>, <span class="number">217</span>, <span class="number">61</span>)),</span><br><span class="line">                        )</span><br><span class="line">                      ],</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                  Container(</span><br><span class="line">                    margin: EdgeInsets.only(top: <span class="number">10.</span>h),</span><br><span class="line">                    alignment: Alignment.center,</span><br><span class="line">                    child: Text(</span><br><span class="line">                      <span class="string">&#x27;猜猜今天是什么菜系？&#x27;</span>,</span><br><span class="line">                      style: TextStyle(</span><br><span class="line">                        fontSize: <span class="number">12.</span>sp,</span><br><span class="line">                        color: Colors.white,</span><br><span class="line">                        fontFamily: <span class="string">&#x27;jinbu&#x27;</span>,</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    height: <span class="number">10.</span>h,</span><br><span class="line">                  ),</span><br><span class="line">                  Padding(</span><br><span class="line">                    padding: EdgeInsets.all(<span class="number">12.0</span>.sp),</span><br><span class="line">                    child: Container(</span><br><span class="line">                      height: <span class="number">400.</span>h,</span><br><span class="line">                      padding: EdgeInsets.all(<span class="number">14.</span>sp),</span><br><span class="line">                      decoration: BoxDecoration(</span><br><span class="line">                          gradient: LinearGradient(</span><br><span class="line">                              begin: Alignment.topLeft, <span class="comment">//左中</span></span><br><span class="line">                              end: Alignment.bottomRight, <span class="comment">//右中</span></span><br><span class="line">                              colors: [</span><br><span class="line">                                Theme.of(context).primaryColor,</span><br><span class="line">                                <span class="keyword">const</span> Color.fromRGBO(<span class="number">180</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>),</span><br><span class="line">                                <span class="keyword">const</span> Color.fromRGBO(<span class="number">187</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.1</span>),</span><br><span class="line">                                Theme.of(context).primaryColor</span><br><span class="line">                              ]),</span><br><span class="line">                          <span class="comment">// color: const Color.fromARGB(255, 205, 221, 235),</span></span><br><span class="line">                          border: Border.all(</span><br><span class="line">                              color: Colors.transparent, width: <span class="number">14.</span>w),</span><br><span class="line">                          borderRadius:</span><br><span class="line">                              BorderRadius.all(Radius.elliptical(<span class="number">20.</span>r, <span class="number">20.</span>r))),</span><br><span class="line">                      child: Column(</span><br><span class="line">                        mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                        children: [</span><br><span class="line">                          load</span><br><span class="line">                              ? SimpleLotteryWidget(</span><br><span class="line">                                  dishesList: dishesList,</span><br><span class="line">                                  simpleLotteryController:</span><br><span class="line">                                      _simpleLotteryController)</span><br><span class="line">                              : SizedBox(</span><br><span class="line">                                  width: <span class="built_in">double</span>.infinity,</span><br><span class="line">                                  height: <span class="number">260.</span>h,</span><br><span class="line">                                  child: <span class="keyword">const</span> GFLoader(</span><br><span class="line">                                      type: GFLoaderType.ios,</span><br><span class="line">                                      loaderColorOne: Colors.blue,</span><br><span class="line">                                      loaderColorTwo: Colors.blue,</span><br><span class="line">                                      loaderColorThree: Colors.blue,</span><br><span class="line">                                      duration: <span class="built_in">Duration</span>(milliseconds: <span class="number">300</span>)),</span><br><span class="line">                                ),</span><br><span class="line">                          <span class="comment">//抽奖按钮</span></span><br><span class="line">                          AnimatedSwitcher(</span><br><span class="line">                            duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">400</span>),</span><br><span class="line">                            child: Provider.of&lt;IndexViewModel&gt;(context,</span><br><span class="line">                                        listen: <span class="keyword">true</span>)</span><br><span class="line">                                    .getIsLotte!</span><br><span class="line">                                ? SizedBox(</span><br><span class="line">                                    height: <span class="number">34.</span>h,</span><br><span class="line">                                    width: MediaQuery.of(context).size.width -</span><br><span class="line">                                        <span class="number">120.</span>w,</span><br><span class="line">                                    child: ElevatedButton(</span><br><span class="line">                                      style: ElevatedButton.styleFrom(</span><br><span class="line">                                        primary: Colors.red[<span class="number">200</span>], <span class="comment">//chan</span></span><br><span class="line">                                        onPrimary: Colors</span><br><span class="line">                                            .white, <span class="comment">//change text color of button</span></span><br><span class="line">                                        shape: RoundedRectangleBorder(</span><br><span class="line">                                          borderRadius:</span><br><span class="line">                                              BorderRadius.circular(<span class="number">30.</span>r),</span><br><span class="line">                                        ),</span><br><span class="line">                                        elevation: <span class="number">3.0</span>.h,</span><br><span class="line">                                      ),</span><br><span class="line">                                      onPressed: () &#123;</span><br><span class="line">                                        <span class="comment">//跳转详情页面</span></span><br><span class="line">                                        Push(</span><br><span class="line">                                            context,</span><br><span class="line">                                            DishesDetailView(</span><br><span class="line">                                                dishes:</span><br><span class="line">                                                    Provider.of&lt;IndexViewModel&gt;(</span><br><span class="line">                                                            context,</span><br><span class="line">                                                            listen: <span class="keyword">false</span>)</span><br><span class="line">                                                        .getCurrentDishes));</span><br><span class="line">                                        <span class="comment">//设置状态</span></span><br><span class="line">                                        Provider.of&lt;IndexViewModel&gt;(context,</span><br><span class="line">                                                listen: <span class="keyword">false</span>)</span><br><span class="line">                                            .setIsLotte(<span class="keyword">false</span>);</span><br><span class="line">                                      &#125;,</span><br><span class="line">                                      child: Row(</span><br><span class="line">                                        mainAxisAlignment:</span><br><span class="line">                                            MainAxisAlignment.center,</span><br><span class="line">                                        children: [</span><br><span class="line">                                          SizedBox(</span><br><span class="line">                                            width: <span class="number">4.</span>w,</span><br><span class="line">                                          ),</span><br><span class="line">                                          Text(</span><br><span class="line">                                            <span class="string">&#x27;点击查看：<span class="subst">$&#123;Provider.of&lt;IndexViewModel&gt;(context, listen: <span class="keyword">false</span>).getCurrentDishes![<span class="string">&#x27;dishesName&#x27;</span>]&#125;</span>&#x27;</span>,</span><br><span class="line">                                            style: TextStyle(</span><br><span class="line">                                                fontWeight: FontWeight.w500,</span><br><span class="line">                                                fontFamily: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                                                color: Colors.white,</span><br><span class="line">                                                fontSize: <span class="number">14.0</span>.sp),</span><br><span class="line">                                          ),</span><br><span class="line">                                        ],</span><br><span class="line">                                      ),</span><br><span class="line">                                    ))</span><br><span class="line">                                : SizedBox(</span><br><span class="line">                                    height: <span class="number">34.</span>h,</span><br><span class="line">                                    width: MediaQuery.of(context).size.width -</span><br><span class="line">                                        <span class="number">220.</span>w,</span><br><span class="line">                                    child: ElevatedButton(</span><br><span class="line">                                      style: ElevatedButton.styleFrom(</span><br><span class="line">                                        primary: Colors.red[<span class="number">200</span>], <span class="comment">//chan</span></span><br><span class="line">                                        onPrimary: Colors</span><br><span class="line">                                            .white, <span class="comment">//change text color of button</span></span><br><span class="line">                                        shape: RoundedRectangleBorder(</span><br><span class="line">                                          borderRadius:</span><br><span class="line">                                              BorderRadius.circular(<span class="number">30.</span>r),</span><br><span class="line">                                        ),</span><br><span class="line">                                        elevation: <span class="number">3.0</span>.h,</span><br><span class="line">                                      ),</span><br><span class="line">                                      onPressed: () &#123;</span><br><span class="line">                                        <span class="comment">//开始抽奖</span></span><br><span class="line">                                        _simpleLotteryController.start(</span><br><span class="line">                                            Random.secure().nextInt(<span class="number">2</span>)); <span class="comment">//开启</span></span><br><span class="line">                                        setState(() &#123;&#125;);</span><br><span class="line">                                      &#125;,</span><br><span class="line">                                      child: Row(</span><br><span class="line">                                        mainAxisAlignment:</span><br><span class="line">                                            MainAxisAlignment.center,</span><br><span class="line">                                        children: [</span><br><span class="line">                                          SizedBox(</span><br><span class="line">                                            width: <span class="number">4.</span>w,</span><br><span class="line">                                          ),</span><br><span class="line">                                          Text(</span><br><span class="line">                                            <span class="string">&#x27;吃啥&#x27;</span>,</span><br><span class="line">                                            style: TextStyle(</span><br><span class="line">                                                fontWeight: FontWeight.w500,</span><br><span class="line">                                                fontFamily: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                                                color: Colors.white,</span><br><span class="line">                                                fontSize: <span class="number">14.0</span>.sp),</span><br><span class="line">                                          ),</span><br><span class="line">                                        ],</span><br><span class="line">                                      ),</span><br><span class="line">                                    )),</span><br><span class="line">                          )</span><br><span class="line">                        ],</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//奖品参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLotteryValue</span> </span>&#123;</span><br><span class="line">  SimpleLotteryValue(</span><br><span class="line">      &#123;<span class="keyword">this</span>.target = <span class="number">0</span>, <span class="keyword">this</span>.isFinish = <span class="keyword">false</span>, <span class="keyword">this</span>.isPlaying = <span class="keyword">false</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">中奖目标</span></span></span><br><span class="line">  <span class="built_in">int</span> target = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">bool</span> isPlaying = <span class="keyword">false</span>;</span><br><span class="line">  <span class="built_in">bool</span> isFinish = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  SimpleLotteryValue copyWith(&#123;</span><br><span class="line">    <span class="built_in">int</span> target = <span class="number">0</span>,</span><br><span class="line">    <span class="built_in">bool</span> isPlaying = <span class="keyword">false</span>,</span><br><span class="line">    <span class="built_in">bool</span> isFinish = <span class="keyword">false</span>,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> SimpleLotteryValue(</span><br><span class="line">        target: target, isFinish: isFinish, isPlaying: isPlaying);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="built_in">String</span> toString() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;target : <span class="subst">$target</span> , isPlaying : <span class="subst">$isPlaying</span> , isFinish : <span class="subst">$isFinish</span>&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽奖控制器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLotteryController</span> <span class="keyword">extends</span> <span class="title">ValueNotifier</span> </span>&#123;</span><br><span class="line">  SimpleLotteryController() : <span class="keyword">super</span>(SimpleLotteryValue());</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">开启抽奖</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">[target] 中奖目标</span></span></span><br><span class="line">  <span class="keyword">void</span> start(<span class="built_in">int</span> target) &#123;</span><br><span class="line">    <span class="comment">// 九宫格抽奖里范围为0~8</span></span><br><span class="line">    <span class="keyword">assert</span>(target &gt;= <span class="number">0</span> &amp;&amp; target &lt;= <span class="number">8</span>);</span><br><span class="line">    <span class="keyword">if</span> (value.isPlaying) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    value = value.copyWith(target: target, isPlaying: <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">void</span> finish() &#123;</span><br><span class="line">    value = value.copyWith(isFinish: <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 奖品列表容器 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleLotteryWidget</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> SimpleLotteryController simpleLotteryController;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">List</span> dishesList;</span><br><span class="line">  <span class="keyword">const</span> SimpleLotteryWidget(</span><br><span class="line">      &#123;Key? key,</span><br><span class="line">      <span class="keyword">required</span> <span class="keyword">this</span>.dishesList,</span><br><span class="line">      <span class="keyword">required</span> <span class="keyword">this</span>.simpleLotteryController&#125;)</span><br><span class="line">      : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;SimpleLotteryWidget&gt; createState() =&gt; _SimpleLotteryWidgetState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_SimpleLotteryWidgetState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">SimpleLotteryWidget</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="title">with</span> <span class="title">TickerProviderStateMixin</span> </span>&#123;</span><br><span class="line">  Future&lt;<span class="built_in">int</span>&gt;? future; <span class="comment">// 标识</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> FutureBuilder(</span><br><span class="line">      future: future,</span><br><span class="line">      builder: (context, snapshot) &#123;</span><br><span class="line">        <span class="keyword">return</span> Container(</span><br><span class="line">            margin: EdgeInsets.all(<span class="number">5.</span>h),</span><br><span class="line">            width: <span class="built_in">double</span>.infinity,</span><br><span class="line">            height: <span class="number">280.</span>h,</span><br><span class="line">            child: GridView.builder(</span><br><span class="line">                physics: <span class="keyword">const</span> NeverScrollableScrollPhysics(),</span><br><span class="line">                itemCount: <span class="number">9</span>,</span><br><span class="line">                gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(</span><br><span class="line">                    crossAxisCount: <span class="number">3</span>,</span><br><span class="line">                    crossAxisSpacing: <span class="number">8.</span>w,</span><br><span class="line">                    mainAxisSpacing: <span class="number">8.</span>h),</span><br><span class="line">                itemBuilder: (context, index) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (index != <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> commodity(index);</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">return</span> Image.network(</span><br><span class="line">                    <span class="string">&#x27;https://brath.cloud/app_log.png&#x27;</span>,</span><br><span class="line">                    fit: BoxFit.cover,</span><br><span class="line">                  );</span><br><span class="line">                &#125;));</span><br><span class="line">      &#125;,</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 奖品列表</span></span><br><span class="line">  Widget commodity(<span class="built_in">int</span> index) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">int</span> toIndex;</span><br><span class="line">    toIndex = _deserializeMap[index];</span><br><span class="line">    <span class="keyword">return</span> GestureDetector(</span><br><span class="line">      onTap: () &#123;</span><br><span class="line">        opcityPush(context,</span><br><span class="line">            ZoomImage(url: <span class="string">&#x27;<span class="subst">$&#123;widget.dishesList[toIndex][<span class="string">&#x27;dishesUrl&#x27;</span>]&#125;</span>&#x27;</span>));</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Stack(</span><br><span class="line">        children: [</span><br><span class="line">          Container(</span><br><span class="line">            decoration: BoxDecoration(</span><br><span class="line">              borderRadius: BorderRadius.all(Radius.circular(<span class="number">10.</span>r)),</span><br><span class="line">              color: widget.dishesList[toIndex][<span class="string">&#x27;id&#x27;</span>]! &gt; <span class="number">5</span></span><br><span class="line">                  ? Colors.red[<span class="number">300</span>]!.withAlpha(<span class="number">32</span>)</span><br><span class="line">                  : widget.dishesList[toIndex][<span class="string">&#x27;id&#x27;</span>]! &gt;= <span class="number">4</span> &amp;&amp;</span><br><span class="line">                          widget.dishesList[toIndex][<span class="string">&#x27;id&#x27;</span>] &lt;= <span class="number">5</span></span><br><span class="line">                      ? Colors.amber[<span class="number">300</span>]!.withAlpha(<span class="number">32</span>)</span><br><span class="line">                      : Colors.blue[<span class="number">300</span>]!.withAlpha(<span class="number">32</span>),</span><br><span class="line">            ),</span><br><span class="line">            child: SizedBox(</span><br><span class="line">              width: <span class="built_in">double</span>.infinity,</span><br><span class="line">              height: <span class="built_in">double</span>.infinity,</span><br><span class="line">              child: Column(</span><br><span class="line">                mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">                children: [</span><br><span class="line">                  Image.network(</span><br><span class="line">                    <span class="string">&#x27;<span class="subst">$&#123;widget.dishesList[toIndex][<span class="string">&#x27;dishesUrl&#x27;</span>]&#125;</span>&#x27;</span>,</span><br><span class="line">                    fit: BoxFit.cover,</span><br><span class="line">                    width: <span class="number">60.</span>w,</span><br><span class="line">                    height: <span class="number">60.</span>w,</span><br><span class="line">                  ),</span><br><span class="line">                  SizedBox(</span><br><span class="line">                    height: <span class="number">5.</span>h,</span><br><span class="line">                  ),</span><br><span class="line">                  Text(</span><br><span class="line">                    <span class="string">&#x27;<span class="subst">$&#123;widget.dishesList[toIndex][<span class="string">&#x27;dishesName&#x27;</span>]&#125;</span>&#x27;</span>,</span><br><span class="line">                    maxLines: <span class="number">1</span>,</span><br><span class="line">                    overflow: TextOverflow.ellipsis,</span><br><span class="line">                    style: TextStyle(</span><br><span class="line">                      fontFamily: <span class="string">&#x27;jinbu&#x27;</span>,</span><br><span class="line">                      fontSize: <span class="number">9.</span>sp,</span><br><span class="line">                      color: Theme.of(context).primaryColor,</span><br><span class="line">                    ),</span><br><span class="line">                  ),</span><br><span class="line">                ],</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Container(</span><br><span class="line">              decoration: BoxDecoration(</span><br><span class="line">            color: index == _currentSelect</span><br><span class="line">                ? Colors.yellow.withOpacity(<span class="number">0.5</span>)</span><br><span class="line">                : Colors.transparent,</span><br><span class="line">            borderRadius: BorderRadius.all(Radius.circular(<span class="number">10.</span>r)),</span><br><span class="line">          )),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Animation? _selectedIndexTween;</span><br><span class="line">  AnimationController? _startAnimateController;</span><br><span class="line">  <span class="built_in">int</span> _currentSelect = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">int</span> _target = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">旋转的圈数</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">int</span> repeatRound = <span class="number">4</span>;</span><br><span class="line">  VoidCallback? _listener;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">选中下标的映射</span></span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span> _selectMap = &#123;<span class="number">0</span>: <span class="number">0</span>, <span class="number">1</span>: <span class="number">3</span>, <span class="number">2</span>: <span class="number">6</span>, <span class="number">3</span>: <span class="number">7</span>, <span class="number">4</span>: <span class="number">8</span>, <span class="number">5</span>: <span class="number">5</span>, <span class="number">6</span>: <span class="number">2</span>, <span class="number">7</span>: <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//反下标的映射</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span> _deserializeMap = &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="number">3</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="number">4</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="number">6</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="number">7</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="number">8</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="number">2</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="number">1</span>: <span class="number">7</span></span><br><span class="line">  &#125;;</span><br><span class="line">  simpleLotteryWidgetState() &#123;</span><br><span class="line">    _listener = () &#123;</span><br><span class="line">      <span class="comment">// 开启抽奖动画</span></span><br><span class="line">      <span class="keyword">if</span> (widget.simpleLotteryController.value.isPlaying) &#123;</span><br><span class="line">        _startAnimateController?.reset();</span><br><span class="line">        _target = widget.simpleLotteryController.value.target;</span><br><span class="line">        _selectedIndexTween = _initSelectIndexTween(_target);</span><br><span class="line"></span><br><span class="line">        _startAnimateController?.forward();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">初始化tween</span></span></span><br><span class="line">  <span class="comment">///</span></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">[target] 中奖的目标</span></span></span><br><span class="line">  Animation _initSelectIndexTween(<span class="built_in">int</span> target) =&gt;</span><br><span class="line">      StepTween(begin: <span class="number">0</span>, end: repeatRound * <span class="number">8</span> + target).animate(</span><br><span class="line">          CurvedAnimation(</span><br><span class="line">              parent: _startAnimateController!, curve: Curves.easeOutQuart));</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line"></span><br><span class="line">    future = Future.value(<span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">    _startAnimateController =</span><br><span class="line">        AnimationController(vsync: <span class="keyword">this</span>, duration: <span class="keyword">const</span> <span class="built_in">Duration</span>(seconds: <span class="number">5</span>));</span><br><span class="line">    _selectedIndexTween = _initSelectIndexTween(_target);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启动画</span></span><br><span class="line">    simpleLotteryWidgetState();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 控制监听</span></span><br><span class="line">    widget.simpleLotteryController.addListener(_listener!);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动画监听</span></span><br><span class="line">    _startAnimateController?.addListener(() &#123;</span><br><span class="line">      <span class="comment">// 更新选中的下标</span></span><br><span class="line">      _currentSelect = _selectMap[_selectedIndexTween?.value % <span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (_startAnimateController!.isCompleted) &#123;</span><br><span class="line">        widget.simpleLotteryController.finish();</span><br><span class="line">        _currentSelect = <span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">dynamic</span> dishes = widget.dishesList[_target];</span><br><span class="line"></span><br><span class="line">        Provider.of&lt;IndexViewModel&gt;(context, listen: <span class="keyword">false</span>).setIsLotte(<span class="keyword">true</span>);</span><br><span class="line">        Provider.of&lt;IndexViewModel&gt;(context, listen: <span class="keyword">false</span>)</span><br><span class="line">            .setCurrentDishes(dishes);</span><br><span class="line">        DialogUtils.showMessage(<span class="string">&#x27;恭喜你，今天做：<span class="subst">$&#123;dishes[<span class="string">&#x27;dishesName&#x27;</span>]&#125;</span>，点击按钮查看菜品做法！&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      setState(() &#123;&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> deactivate() &#123;</span><br><span class="line">    widget.simpleLotteryController.removeListener(_listener!);</span><br><span class="line">    <span class="keyword">super</span>.deactivate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> dispose() &#123;</span><br><span class="line">    _startAnimateController?.dispose();</span><br><span class="line">    <span class="keyword">super</span>.dispose();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取当前奖品出现的次数</span></span><br><span class="line">getNumberTimesCurrentPrizeAppears(<span class="built_in">String?</span> id, <span class="built_in">List</span>&lt;<span class="built_in">dynamic</span>&gt; arr) &#123;</span><br><span class="line">  <span class="comment">//定义集合</span></span><br><span class="line">  <span class="built_in">Map</span> obj = &#123;&#125;;</span><br><span class="line">  <span class="built_in">List</span> idList = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">    idList.add(arr[i][<span class="string">&#x27;id&#x27;</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; idList.length; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (obj.containsValue([idList[i]])) &#123;</span><br><span class="line">      obj[idList[i]]++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      obj[idList[i]] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> obj[<span class="built_in">int</span>.parse(id!)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> next(<span class="built_in">int</span> min, <span class="built_in">int</span> max) &#123;</span><br><span class="line">  <span class="built_in">int</span> res = min + Random().nextInt(max - min + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="dishesdetaildart"><a class="markdownIt-Anchor" href="#dishesdetaildart">#</a> DishesDetail.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:bruno/bruno.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_swiper_plus/flutter_swiper_plus.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/common/common.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DishesDetailView</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  DishesDetailView(&#123;Key? key,<span class="keyword">required</span> <span class="keyword">this</span>.dishes&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line">  <span class="keyword">var</span> dishes;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;DishesDetailView&gt; createState() =&gt; _DishesDetailViewState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_DishesDetailViewState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">DishesDetailView</span>&gt; </span>&#123;</span><br><span class="line">  <span class="built_in">List</span> steplist = [];</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    <span class="comment">//分割步骤</span></span><br><span class="line">    steplist = widget.dishes[<span class="string">&#x27;dishesStep&#x27;</span>].toString().split(<span class="string">&#x27;\r\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> WillPopScope(</span><br><span class="line">      onWillPop: () &#123;</span><br><span class="line">        BrnDialogManager.showConfirmDialog(context,</span><br><span class="line">            showIcon: <span class="keyword">false</span>,</span><br><span class="line">            barrierDismissible: <span class="keyword">false</span>,</span><br><span class="line">            title: <span class="string">&quot;你正在做菜，要退出吗~&quot;</span>,</span><br><span class="line">            confirm: <span class="string">&quot;退出&quot;</span>,</span><br><span class="line">            cancel: <span class="string">&quot;不&quot;</span>, onConfirm: () &#123;</span><br><span class="line">          Navigator.of(context).pop();</span><br><span class="line">          Navigator.of(context).pop();</span><br><span class="line">        &#125;, onCancel: () &#123;</span><br><span class="line">          Navigator.of(context).pop();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> Future.value(<span class="keyword">false</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      child: Scaffold(</span><br><span class="line">          appBar: getAppBar(widget.dishes[<span class="string">&#x27;dishesName&#x27;</span>], context: context),</span><br><span class="line">          body: ListView(</span><br><span class="line">            children: [</span><br><span class="line">              Padding(</span><br><span class="line">                padding: <span class="keyword">const</span> EdgeInsets.all(<span class="number">8.0</span>),</span><br><span class="line">                child: ImageFulWidget(imageList: [widget.dishes[<span class="string">&#x27;dishesUrl&#x27;</span>]]),</span><br><span class="line">              ),</span><br><span class="line">              getCardContainer(</span><br><span class="line">                margin: EdgeInsets.only(</span><br><span class="line">                    top: <span class="number">10.</span>h, bottom: <span class="number">10.</span>h, left: <span class="number">10.</span>w, right: <span class="number">10.</span>w),</span><br><span class="line">                height: <span class="number">220.0</span>.h,</span><br><span class="line">                isBorder: <span class="keyword">true</span>,</span><br><span class="line">                BorderCircular: <span class="number">5.</span>r,</span><br><span class="line">                width: <span class="built_in">double</span>.infinity,</span><br><span class="line">                widget: Column(</span><br><span class="line">                  crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                  children: [</span><br><span class="line">                    Padding(</span><br><span class="line">                      padding: EdgeInsets.only(left: <span class="number">10.</span>w, top: <span class="number">10.</span>h),</span><br><span class="line">                      child: BrnCSS2Text.toTextView(</span><br><span class="line">                        <span class="string">&#x27;步骤：&#x27;</span>,</span><br><span class="line">                        maxLines: <span class="number">1</span>,</span><br><span class="line">                        textOverflow: TextOverflow.ellipsis,</span><br><span class="line">                        defaultStyle:</span><br><span class="line">                            TextStyle(fontSize: <span class="number">20.</span>sp, fontFamily: <span class="string">&#x27;jinbu&#x27;</span>),</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                    Padding(</span><br><span class="line">                      padding: EdgeInsets.only(left: <span class="number">10.</span>w, top: <span class="number">10.</span>h),</span><br><span class="line">                      child: Column(</span><br><span class="line">                        crossAxisAlignment: CrossAxisAlignment.start,</span><br><span class="line">                        children: steplist.map((e) &#123;</span><br><span class="line">                          <span class="keyword">return</span> Container(</span><br><span class="line">                            margin: EdgeInsets.only(top: <span class="number">5.</span>h),</span><br><span class="line">                            child: BrnCSS2Text.toTextView(</span><br><span class="line">                              <span class="string">&#x27;<span class="subst">$e</span>&#x27;</span>,</span><br><span class="line">                              maxLines: <span class="number">1</span>,</span><br><span class="line">                              textOverflow: TextOverflow.ellipsis,</span><br><span class="line">                              defaultStyle: TextStyle(</span><br><span class="line">                                  fontSize: <span class="number">13.</span>sp, fontFamily: <span class="string">&#x27;jinbu&#x27;</span>),</span><br><span class="line">                            ),</span><br><span class="line">                          );</span><br><span class="line">                        &#125;).toList(),</span><br><span class="line">                      ),</span><br><span class="line">                    ),</span><br><span class="line">                  ],</span><br><span class="line">                ),</span><br><span class="line">              )</span><br><span class="line">            ],</span><br><span class="line">          )),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 顶部轮播图Widget</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageFulWidget</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  ImageFulWidget(&#123;</span><br><span class="line">    Key? key,</span><br><span class="line">    <span class="keyword">required</span> <span class="keyword">this</span>.imageList,</span><br><span class="line">  &#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;? imageList;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ClipRRect(</span><br><span class="line">      borderRadius: BorderRadius.vertical(</span><br><span class="line">          top: Radius.circular(<span class="number">20.</span>h), bottom: Radius.circular(<span class="number">20.</span>h)),</span><br><span class="line">      child: SizedBox(</span><br><span class="line">        height: MediaQuery.of(context).size.height * <span class="number">0.25</span>,</span><br><span class="line">        width: MediaQuery.of(context).size.width - <span class="number">60.0</span>.w,</span><br><span class="line">        child: Swiper(</span><br><span class="line">          autoplay: <span class="keyword">false</span>,</span><br><span class="line">          duration: <span class="number">2000</span>,</span><br><span class="line">          curve: Curves.linearToEaseOut,</span><br><span class="line">          itemBuilder: (BuildContext context, <span class="built_in">int</span> index) &#123;</span><br><span class="line">            <span class="keyword">return</span> Image.network(</span><br><span class="line">              imageList![index],</span><br><span class="line">              height: MediaQuery.of(context).size.height * <span class="number">0.25</span>,</span><br><span class="line">              width: MediaQuery.of(context).size.width - <span class="number">60.0</span>.w,</span><br><span class="line">              fit: BoxFit.cover,</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">          itemCount: imageList!.length,</span><br><span class="line">          pagination: SwiperPagination(</span><br><span class="line">            builder: DotSwiperPaginationBuilder(</span><br><span class="line">              size: <span class="number">8.</span>sp, <span class="comment">// 设置未选中的小点大小</span></span><br><span class="line">              activeSize: <span class="number">10.</span>sp, <span class="comment">// 设置选中的小点大小</span></span><br><span class="line">              color: <span class="keyword">const</span> Color.fromARGB(<span class="number">255</span>, <span class="number">219</span>, <span class="number">219</span>, <span class="number">219</span>), <span class="comment">// 设置为未选中的小点颜色</span></span><br><span class="line">              activeColor: Colors.blue, <span class="comment">// 设置选中的小点颜色</span></span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          control: <span class="keyword">const</span> SwiperControl(color: Colors.transparent),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="maindart"><a class="markdownIt-Anchor" href="#maindart">#</a> main.dart</h4>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:async&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:math&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/physics.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_easyloading/flutter_easyloading.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter_screenutil/flutter_screenutil.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:get/get_navigation/src/root/get_material_app.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:intl/date_symbol_data_local.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:provider/provider.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/routers/routes.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:weat/viewmodel/index_viewmodel.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局路由key</span></span><br><span class="line"><span class="keyword">final</span> GlobalKey&lt;NavigatorState&gt; navigatorKey = GlobalKey&lt;NavigatorState&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 主函数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> main() <span class="keyword">async</span> &#123;</span><br><span class="line">  initializeDateFormatting().then((_) =&gt; runApp(MultiProvider(</span><br><span class="line">        providers: [</span><br><span class="line">          ChangeNotifierProvider(create: (context) =&gt; IndexViewModel()),</span><br><span class="line">        ],</span><br><span class="line">        child: MyApp(),</span><br><span class="line">      )));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//安卓屏蔽顶部阴影</span></span><br><span class="line">  <span class="keyword">if</span> (Platform.isAndroid) &#123;</span><br><span class="line">    SystemUiOverlayStyle systemUiOverlayStyle =</span><br><span class="line">        SystemUiOverlayStyle(statusBarColor: Colors.transparent);</span><br><span class="line">    SystemChrome.setSystemUIOverlayStyle(systemUiOverlayStyle);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根节点</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  State&lt;MyApp&gt; createState() =&gt; _MyAppState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyAppState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyApp</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">    _init();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局路由key</span></span><br><span class="line">  <span class="keyword">final</span> GlobalKey&lt;NavigatorState&gt; navigatorKey = GlobalKey&lt;NavigatorState&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/// <span class="language-markdown">程序初始化</span></span></span><br><span class="line">  _init() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> EasyLoading.init();</span><br><span class="line">    EasyLoading.instance</span><br><span class="line">      ..displayDuration = <span class="keyword">const</span> <span class="built_in">Duration</span>(milliseconds: <span class="number">2000</span>)</span><br><span class="line">      ..indicatorType = EasyLoadingIndicatorType.fadingCircle</span><br><span class="line">      ..loadingStyle = EasyLoadingStyle.dark</span><br><span class="line">      ..indicatorSize = <span class="number">45.0</span></span><br><span class="line">      ..radius = <span class="number">10.0</span></span><br><span class="line">      ..progressColor = Colors.yellow</span><br><span class="line">      ..backgroundColor = Colors.green</span><br><span class="line">      ..indicatorColor = Colors.yellow</span><br><span class="line">      ..textColor = Colors.yellow</span><br><span class="line">      ..maskColor = Colors.blue.withOpacity(<span class="number">0.5</span>)</span><br><span class="line">      ..userInteractions = <span class="keyword">true</span></span><br><span class="line">      ..dismissOnTap = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> WidgetsFlutterBinding.ensureInitialized();</span><br><span class="line">    <span class="keyword">await</span> SystemChrome.setPreferredOrientations(</span><br><span class="line">      [</span><br><span class="line">        <span class="comment">// 竖屏 Portrait 模式</span></span><br><span class="line">        DeviceOrientation.portraitUp,</span><br><span class="line">        DeviceOrientation.portraitDown,</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> ScreenUtilInit(</span><br><span class="line">        designSize: Size(<span class="number">375</span>, <span class="number">667</span>),</span><br><span class="line">        minTextAdapt: <span class="keyword">true</span>,</span><br><span class="line">        splitScreenMode: <span class="keyword">true</span>,</span><br><span class="line">        builder: (context, child) &#123;</span><br><span class="line">          <span class="keyword">return</span> GetMaterialApp(</span><br><span class="line">            theme: ThemeData(</span><br><span class="line">              primarySwatch: Colors.blueGrey, <span class="comment">//全局主题颜色</span></span><br><span class="line">              splashColor: Colors.transparent, <span class="comment">// 点击时的高亮效果设置为透明</span></span><br><span class="line">              <span class="comment">// backgroundColor: Color.fromARGB(255, 255, 255, 255), //系统背景主题颜色</span></span><br><span class="line">              backgroundColor: Color(<span class="number">0xFFF3F4F6</span>), <span class="comment">//系统背景主题颜色</span></span><br><span class="line">              highlightColor: Colors.transparent, <span class="comment">// 长按时的扩散效果设置为透明</span></span><br><span class="line">              primaryColor: Color.fromARGB(<span class="number">188</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">97</span>), <span class="comment">//系统原色</span></span><br><span class="line">              focusColor: Color.fromARGB(<span class="number">235</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">116</span>), <span class="comment">//焦点主题颜色</span></span><br><span class="line">              hoverColor: Color.fromARGB(<span class="number">235</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">172</span>), <span class="comment">//悬停主题颜色</span></span><br><span class="line">              disabledColor: Color.fromARGB(<span class="number">235</span>, <span class="number">105</span>, <span class="number">106</span>, <span class="number">133</span>), <span class="comment">//禁用主题颜色</span></span><br><span class="line">              primaryColorLight: Colors.white, <span class="comment">// 白色主题颜色</span></span><br><span class="line">              primaryColorDark: Color.fromARGB(<span class="number">235</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">116</span>), <span class="comment">//黑色主题颜色</span></span><br><span class="line">              selectedRowColor: Color.fromARGB(<span class="number">255</span>, <span class="number">104</span>, <span class="number">80</span>, <span class="number">145</span>), <span class="comment">//选中效果颜色</span></span><br><span class="line">              appBarTheme: AppBarTheme(backgroundColor: Colors.white),</span><br><span class="line">              buttonTheme: ButtonThemeData(</span><br><span class="line">                focusColor: Color.fromARGB(<span class="number">235</span>, <span class="number">73</span>, <span class="number">74</span>, <span class="number">116</span>),</span><br><span class="line">                hoverColor: Color.fromARGB(<span class="number">235</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">172</span>),</span><br><span class="line">              ),</span><br><span class="line">              tabBarTheme: TabBarTheme(</span><br><span class="line">                labelColor: Color.fromARGB(<span class="number">235</span>, <span class="number">103</span>, <span class="number">104</span>, <span class="number">172</span>),</span><br><span class="line">              ),</span><br><span class="line">              progressIndicatorTheme: ProgressIndicatorThemeData(</span><br><span class="line">                color: Color.fromARGB(<span class="number">235</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">158</span>),</span><br><span class="line">              ),</span><br><span class="line">            ),</span><br><span class="line">            navigatorKey: navigatorKey,</span><br><span class="line">            routes: routes,</span><br><span class="line">            debugShowCheckedModeBanner: <span class="keyword">false</span>,</span><br><span class="line">            initialRoute: <span class="string">&quot;/&quot;</span>, <span class="comment">//初始化进入加载页面</span></span><br><span class="line">            builder: (context, widget) &#123;</span><br><span class="line">              <span class="keyword">return</span> MediaQuery(</span><br><span class="line">                data: MediaQuery.of(context).copyWith(textScaleFactor: <span class="number">1.0</span>),</span><br><span class="line">                child: widget!,</span><br><span class="line">              );</span><br><span class="line">            &#125;,</span><br><span class="line">          );</span><br><span class="line">        &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="代码编写完毕后-flutter-build-apk-打包到真机运行"><a class="markdownIt-Anchor" href="#代码编写完毕后-flutter-build-apk-打包到真机运行">#</a> 代码编写完毕后 flutter build apk 打包到真机运行</h3>
<h1 id="最终呈现出我们想要的效果"><a class="markdownIt-Anchor" href="#最终呈现出我们想要的效果">#</a> 最终呈现出我们想要的效果：</h1>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224132323576.png" alt="image-20230224132323576"></p>
<p>抽奖中：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224132344126.png" alt="image-20230224132344126"></p>
<p>中奖：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224132344126.png" alt=""></p>
<p>详情：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230224132350748.png" alt="image-20230224132350748"></p>
<h3 id="本期教程到此结束欢迎你的观看~"><a class="markdownIt-Anchor" href="#本期教程到此结束欢迎你的观看~">#</a> 本期教程到此结束，欢迎你的观看～</h3>
<h2 id="微信公众号搜索interviewcoder回复关键词吃啥获取源码以及开发教程~-2"><a class="markdownIt-Anchor" href="#微信公众号搜索interviewcoder回复关键词吃啥获取源码以及开发教程~-2">#</a> 微信公众号搜索 InterviewCoder 回复关键词《吃啥》获取源码以及开发教程～</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/%E4%BA%8C%E7%BB%B4%E7%A0%81mini.png" alt="二维码mini"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-15T08:19:18.000Z" title="2022/11/15 16:19:18">2022-11-15</time>发表</span><span class="level-item"><time dateTime="2022-04-16T01:44:25.000Z" title="2022/4/16 09:44:25">2022-04-16</time>更新</span><span class="level-item">10 分钟读完 (大约1531个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/15/%E3%80%90Gmail%E3%80%91%E5%9B%BD%E5%86%85%E6%80%8E%E4%B9%88%E6%B3%A8%E5%86%8CGmail%E9%82%AE%E7%AE%B1%EF%BC%9F/">【Gmail】国内怎么注册Gmail邮箱？</a></p><div class="content"><h1 id="gmail国内怎么注册gmail邮箱"><a class="markdownIt-Anchor" href="#gmail国内怎么注册gmail邮箱">#</a> 【Gmail】国内怎么注册 Gmail 邮箱？</h1>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>​		谷歌邮箱（Gmail）是在国际上使用最为频繁的邮箱，不管我们是用来收发邮件，还是用来注册国外的网站，大多数情况下都离不开谷歌邮箱。甚至，不少网站都直接支持谷歌邮箱登录，这就是为什么，国内很多网友想要注册 Gmail 谷歌邮箱的原因。</p>
<p>​		但是，大部分网友都无法自己完整注册，今天来做一篇完整的谷歌邮箱注册教程，非常详细，一步一步照做即可！</p>
<p>​	<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4817a9d47027589.jpg" alt="img"></p>
<h2 id="谷歌邮箱怎么注册"><a class="markdownIt-Anchor" href="#谷歌邮箱怎么注册">#</a> 谷歌邮箱怎么注册？</h2>
<h4 id="注册前准备"><a class="markdownIt-Anchor" href="#注册前准备">#</a> 注册前准备</h4>
<p>1、手机号码一个（没有注册过谷歌邮箱的手机号码）</p>
<p>2、加速器（魔法）（国内使用谷歌，必须要加速器才行哦，加速器需自备，不然你会连谷歌邮箱官网都无法进入）</p>
<h4 id="谷歌gmail邮箱注册教程"><a class="markdownIt-Anchor" href="#谷歌gmail邮箱注册教程">#</a> 谷歌 Gmail 邮箱注册教程</h4>
<p>1、我们使用浏览器打开谷歌邮箱官网（<a target="_blank" rel="noopener" href="http://gmail.google.com">gmail.google.com</a>），进入谷歌邮箱的登录主页，我们点击左下方的创建账号按钮，选择个人用途。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420135757242.png" alt="image-20230420135757242"></p>
<p>2、在进入的界面我们不要着急填写资料，我们先修改语言，点击左下方的简体中文。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c81e728d9d4c2f6-30.jpg" alt="img"></p>
<p>3、这个时候，会弹出国家语言列表，我们选择 “English（United States）”。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/eccbc87e4b5ce2f-25.jpg" alt="img"></p>
<p>4、这个时候，界面会变成英语。我们在填写个人信息，如下图填写。填好过后，我们要记住账号和密码信息哦，后面登录要用的。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/a87ff679a2f3e71-20.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a87ff679a2f3e71-20.jpg" alt="img"></a></p>
<p>5、这个时候，会跳转到手机号码验证页面，我们选择中国 + 86，填写自己的手机号，点击 Next。如果顺利，你会进入下一步，填写验证码。如果你的加速器美国 IP 质量不行，这里就会提示你 “此电话号码无法用于验证”。遇到这个提示，建议，切换一个优质美国 IP，在操作。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/e4da3b7fbbce234-21.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/e4da3b7fbbce234-21.jpg" alt="img"></a></p>
<p>6、输入手机收到的验证码，点击 “verify”。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/1679091c5a880fa-18.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1679091c5a880fa-18.jpg" alt="img"></a></p>
<p>7、这个界面，我们只需要填写出生日期即可，别的可不填。出生日期，大家一定要选择成年的年龄哦，别乱填，填好点 next。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/8f14e45fceea167-16.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/8f14e45fceea167-16.jpg" alt="img"></a></p>
<p>8、来到这个界面，我们不用管，直接点击 skip。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/c9f0f895fb98ab9-11.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c9f0f895fb98ab9-11.jpg" alt="img"></a></p>
<p>9、隐私条款确认，我们点击 I agree。</p>
<p><a target="_blank" rel="noopener" href="https://blog.aftss.cn/wp-content/uploads/2022/09/45c48cce2e2d7fb-7.jpg"><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/45c48cce2e2d7fb-7.jpg" alt="img"></a></p>
<p>这个时候，你会发现，账号注册成功了，并且，页面会直接跳转到谷歌邮箱的界面。</p>
<h2 id="注册失败原因汇总"><a class="markdownIt-Anchor" href="#注册失败原因汇总">#</a> 注册失败原因汇总</h2>
<p>其实注册流程并不复杂，很简单，也就只需要几步。可是，国内的网友注册，总是无法注册成功。这里，把最容易导致注册失败的原因，给大家汇总一下，自己操作的时候就要注意了！</p>
<h3 id="1-手机号码注册过"><a class="markdownIt-Anchor" href="#1-手机号码注册过">#</a> 1、手机号码注册过</h3>
<p>你用来注册谷歌邮箱的手机号码，你自己之前注册过谷歌邮箱，再次注册有可能会出现无法注册的情况。虽然，谷歌没有说明一个手机能够不能注册多个账号，但是，我们最好还是不要用注册过的手机号。</p>
<h3 id="2-加速器ip质量不行"><a class="markdownIt-Anchor" href="#2-加速器ip质量不行">#</a> 2、加速器 IP 质量不行</h3>
<p>很多网友使用的加速器，IP 地址已经被人多次用来注册过谷歌邮箱了，到你注册的时候，早就被谷歌锁定了，识别你为恶意注册。这种情况，自然无法成功注册。那么，怎么才算高质量的 IP 地址呢？我们尽量使用那些没怎么被人用过的 IP，冷僻的线路即可。</p>
<h3 id="3-语言没设置"><a class="markdownIt-Anchor" href="#3-语言没设置">#</a> 3、语言没设置</h3>
<p>大家看教程，应该知道，我注册的时候是设置了英语的。再加上使用的 IP 为美国，这样自然，谷歌会认为我是一个美国人在注册，审核机制自然就成了美区的审核机制，没那么严格，成功率会高一些。</p>
<h3 id="4-如果以上都不行那么建议使用-iphone-手机注册一下试试很大几率可以成功"><a class="markdownIt-Anchor" href="#4-如果以上都不行那么建议使用-iphone-手机注册一下试试很大几率可以成功">#</a> 4、如果以上都不行，那么建议使用 IPHONE 手机注册一下试试，很大几率可以成功！</h3>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 <code>Java</code>  程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"> 非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-14T15:49:50.000Z" title="2022/11/14 23:49:50">2022-11-14</time>发表</span><span class="level-item"><time dateTime="2023-04-07T07:55:22.000Z" title="2023/4/7 15:55:22">2023-04-07</time>更新</span><span class="level-item">3 分钟读完 (大约399个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/14/%E3%80%90Docker%E3%80%91%E5%85%B3%E4%BA%8Edocker%E6%9C%8D%E5%8A%A1%E6%8A%A5%E9%94%99WARNING%20IPv4%20forwarding%20is%20disabled.%20Networking%20will%20not%20work/">【Docker】关于docker服务报错WARNING IPv4 forwarding is disabled. Networking will not work</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work"><a class="markdownIt-Anchor" href="#docker关于docker服务报错warning-ipv4-forwarding-is-disabled-networking-will-not-work">#</a> 【Docker】关于 docker 服务报错 WARNING IPv4 forwarding is disabled. Networking will not work</h3>
<p><strong>注意：在这里强调，强制进入或者进入镜像，进入后会引起 yum install 和 wget 等不能使用</strong></p>
<h2 id="一docker-运行直接报错"><a class="markdownIt-Anchor" href="#一docker-运行直接报错">#</a> <strong>一，docker 运行直接报错</strong></h2>
<p><strong>报错：</strong></p>
<p>[root@localhost /]# docker run -it ubuntu /bin/bash</p>
<p><em>WARNING: IPv4 forwarding is disabled. Networking will not work.</em></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/05472c924858164c6df96734a709fd3b.png" alt="img"></p>
<p>1. 解决方式：</p>
<p>第一步：在宿主机上执行 echo “net.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ipv4&amp;spm=1001.2101.3001.7020">ipv4</a>.ip_forward=1” &gt;&gt;/usr/lib/sysctl.d/00-system.conf</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/56fe262e97ffdd8fb3992692af566dd2.png" alt="img"></p>
<p>2. 第二步：重启 network 和 docker 服务</p>
<p>[root@localhost /]# systemctl restart network &amp;&amp; systemctl restart docker</p>
<p>3. 第三步：验证是否成功</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/fe9d3a924773707b13542350b4f77b2e.png" alt="img"></p>
<p>可见完美解决问题。</p>
<h2 id="二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了"><a class="markdownIt-Anchor" href="#二如果你是docker容器运行镜像的时候也是报这种错误相对应得也是重启一下docker就可以完美解决了了">#</a> 二，如果你是 docker 容器运行镜像的时候也是报这种错误，相对应得也是重启一下 docker 就可以完美解决了了。</h2>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-13T15:44:29.000Z" title="2022/11/13 23:44:29">2022-11-13</time>发表</span><span class="level-item"><time dateTime="2023-02-07T22:50:45.000Z" title="2023/2/8 06:50:45">2023-02-08</time>更新</span><span class="level-item">11 分钟读完 (大约1657个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/13/%E3%80%90Elasticsearch%E3%80%91Elasticsearch7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6/">ELASTICSEARCH7.X安全性之访问密码设置</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="elasticsearch7x安全性之访问密码设置"><a class="markdownIt-Anchor" href="#elasticsearch7x安全性之访问密码设置">#</a> ELASTICSEARCH7.X 安全性之访问密码设置</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">当我们安装完ElasticSearch的时候发现，访问过程中我们没有任何安全认证就可以直接访问并操作。如果是生产环境，端口向外暴露的话，那么对数据的安全性是无法得到保障的。</span><br></pre></td></tr></table></figure>
<p>一般解决方案有</p>
<ul>
<li>开启 ElasticSearch 认证插件，访问的时候添加账密</li>
<li>当然也可以通过 nginx 作代理防护</li>
</ul>
<p>本文主要讲解通过启用 X-Pack 来设置 ElasticSearch 的访问密码。</p>
<p>集群与单据环境都适合次方法</p>
<ul>
<li>集群与单据环境配置的区别就是，集群需要在某一台生成证书然后拷贝到其它节点目录下。</li>
<li>集群环境重设置密码的时候需要整个集群节点都已启动，可在任一台处修改。</li>
</ul>
<h2 id="2x-pack简介"><a class="markdownIt-Anchor" href="#2x-pack简介">#</a> 2.X-PACK 简介</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Pack是Elastic Stack扩展功能，提供安全性，警报，监视，报告，机器学习和许多其他功能。 ES7.0+之后，默认情况下，当安装Elasticsearch时，会自动安装X-Pack，无需单独再安装。自6.8以及7.1+版本之后，基础级安全永久免费了。</span><br><span class="line">在使用的时候主要需要配置一下证书，以及修改配置文件（config/elasticsearch.yml ）</span><br></pre></td></tr></table></figure>
<h2 id="3证书配置"><a class="markdownIt-Anchor" href="#3证书配置">#</a> 3. 证书配置</h2>
<h3 id="31生成节点证书"><a class="markdownIt-Anchor" href="#31生成节点证书">#</a> 3.1 生成节点证书</h3>
<p>切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin<br>
 借助 elasticsearch-certutil 命令生成证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./elasticsearch-certutil ca -out config/certs/elastic-certificates.p12 -pass</span><br></pre></td></tr></table></figure>
<p>这里单独设置了一个 证书文件目录 config/certs<br>
<img src="https://www.freesion.com/images/951/a3d0c1934c0ed0f8440f830d63e96dbf.png" alt="在这里插入图片描述"></p>
<p>生成后的证书<br>
<img src="https://www.freesion.com/images/953/de92ac2cf73d1ed0da994f9d1066e8f1.png" alt="在这里插入图片描述"></p>
<h3 id="32修改配置"><a class="markdownIt-Anchor" href="#32修改配置">#</a> 3.2 修改配置</h3>
<p>配置通信证书 &gt; 需要在 config 目前下 elasticsearch.yml 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启xpack</span><br><span class="line">xpack.security.enabled: true</span><br><span class="line">xpack.license.self_generated.type: basic</span><br><span class="line">xpack.security.transport.ssl.enabled: true</span><br><span class="line"># 证书配置</span><br><span class="line">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class="line">xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12</span><br><span class="line">xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其它配置（可选）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#跨域配置</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>注：若是集群环境则需要将证书文件目录，以及配置文件，在所有集群环境下都修改一下。</p>
<h3 id="33重启生效"><a class="markdownIt-Anchor" href="#33重启生效">#</a> 3.3. 重启生效</h3>
<p>需要重启 elasticsearch</p>
<p>注：若是集群环境下则需要启动所有集群节点，再统一设置密码</p>
<p>注：重启异常情况，若出现报错，类似 failed to load plugin class [org.elasticsearch.xpack.core.XPackPlugin]<br>
 请检查是否是使用 root 用户生成的证书，启动用户无权限导致。</p>
<h2 id="4设置用户密码"><a class="markdownIt-Anchor" href="#4设置用户密码">#</a> 4. 设置用户密码</h2>
<p>执行设置用户名和密码的命令，内置了部分用户<br>
切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin/</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 手动配置每个用户密码模式（需要一个一个的输入）</span><br><span class="line">./elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>也可以先自动配置密码后续再修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#自动配置每个用户密码（随机生成并返回字符串密码,需要保存好）</span><br><span class="line">./elasticsearch-setup-passwords auto  </span><br></pre></td></tr></table></figure>
<p>下图 1 是自动生成密码情况（一定拷贝下来要牢记密码）<br>
<img src="https://www.freesion.com/images/198/f383d0d38bab2a11f3293d44ffccf0ae.png" alt="在这里插入图片描述"></p>
<p>下图 2 是自定义密码情况<br>
分别为多个用户设置密码例如：elastic, kibana, logstash_system,beats_system,<br>
 设置密码的时候需要连续输入 2 遍。<br>
<img src="https://www.freesion.com/images/458/363890f3fdffcc0b1bcfaae3c8295952.png" alt="在这里插入图片描述"></p>
<p>部分内置账号的角色权限解释如下：</p>
<ul>
<li>elastic 账号：拥有 superuser 角色，是内置的超级用户。</li>
<li>kibana 账号：拥有 kibana_system 角色，用户 kibana 用来连接 elasticsearch 并与之通信。Kibana 服务器以该用户身份提交请求以访问集群监视 API 和 .kibana 索引。不能访问 index。</li>
<li>logstash_system 账号：拥有 logstash_system 角色。用户 Logstash 在 Elasticsearch 中存储监控信息时使用。</li>
</ul>
<p>至此单节点安全配置完毕，重启 es 后访问 9200 会出现用户名和密码的提示窗口，我们就可以通过用户生成的密码过行访问了</p>
<h2 id="5测试访问"><a class="markdownIt-Anchor" href="#5测试访问">#</a> 5. 测试访问</h2>
<p>通过查看证书方式，顺便测试一下密码是否生效了<br>
浏览器输入 <a target="_blank" rel="noopener" href="http://ip:9200/_license">http://IP:9200/_license</a> 可以看到，弹窗出来，需要输入密码了<br>
<img src="https://www.freesion.com/images/561/b7034fa6ab245e277567b01d40929119.png" alt="在这里插入图片描述"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9b1a95e8a4b361dd4f7e3012300d1115.png" alt="在这里插入图片描述"></p>
<h2 id="附录常见问题"><a class="markdownIt-Anchor" href="#附录常见问题">#</a> 附录：常见问题</h2>
<h3 id="1如何修改账号密码"><a class="markdownIt-Anchor" href="#1如何修改账号密码">#</a> 1. 如何修改账号密码</h3>
<p>以 elastic 账号为例，注意需要在 elasticsearch 服务已启动的情况下进行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &#x27;Content-Type: application/json&#x27; -u elastic:123456 -XPUT &#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27; -d &#x27;&#123; &quot;password&quot; : &quot;1234567&quot; &#125;&#x27;</span><br></pre></td></tr></table></figure>
<h3 id="2客户端es-head连接问题"><a class="markdownIt-Anchor" href="#2客户端es-head连接问题">#</a> 2. 客户端 ES-HEAD 连接问题</h3>
<p>连接失败情况下先检查是否是跨域问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>
<p>例如下图连接的时候报错未授权<br>
<img src="https://www.freesion.com/images/96/57fa25b106cf1cdee9f44a2f8577e620.png" alt="在这里插入图片描述"></p>
<p>解决方案：在访问的 URL 中拼接授权账号信息<br>
示例：?auth_user=elastic&amp;auth_password=1234567</p>
<p>示例：指定服务端地址以及账户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://IP:9100/?base_uri=http://IP:9200&amp;auth_user=elastic&amp;auth_password=1234567</span><br></pre></td></tr></table></figure>
<h3 id="3启动报xpack相关错"><a class="markdownIt-Anchor" href="#3启动报xpack相关错">#</a> 3. 启动报 XPACK 相关错</h3>
<p><img src="https://www.freesion.com/images/947/90ff281ef660a79e49875391f87e474b.png" alt="在这里插入图片描述"></p>
<p>DecoderException: javax.net.ssl.SSLHandshakeException: No available authentication scheme<br>
<img src="https://www.freesion.com/images/485/efd6d897ad8655121334fd050eecd445.png" alt="在这里插入图片描述"></p>
<p>解决方案：请通过上文配置步骤，排查，检查证书是否已经配置好，以及配置是否填写正确</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-11-04T04:04:48.000Z" title="2022/11/4 12:04:48">2022-11-04</time>发表</span><span class="level-item"><time dateTime="2022-09-02T20:06:35.000Z" title="2022/9/3 04:06:35">2022-09-03</time>更新</span><span class="level-item">2 分钟读完 (大约302个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/11/04/%E3%80%90SpringBoot%E3%80%91%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8liux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87springBoot%E5%86%85%E7%BD%AEmail%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">腾讯云服务器liux系统下无法通过springBoot内置mail发送邮件的解决方案</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="腾讯云服务器liux系统下无法通过springboot内置mail发送邮件的解决方案"><a class="markdownIt-Anchor" href="#腾讯云服务器liux系统下无法通过springboot内置mail发送邮件的解决方案">#</a> 腾讯云服务器 liux 系统下无法通过 springBoot 内置 mail 发送邮件的解决方案</h3>
<p>原因</p>
<p>原来是腾讯云基于安全考虑，禁用了端口 25。改成 465 或者解封 25 就可以发邮件了。</p>
<p>原始配置  本地可发送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  mail:</span><br><span class="line">    username: ***********</span><br><span class="line">    password: ***********</span><br><span class="line">    host: smtp<span class="number">.163</span>.com</span><br><span class="line">    port: <span class="number">25</span></span><br><span class="line">    <span class="keyword">default</span>-encoding: UTF-<span class="number">8</span></span><br><span class="line">    properties:</span><br><span class="line">      mail:</span><br><span class="line">        smtp:</span><br><span class="line">          timeout: <span class="number">10000</span></span><br><span class="line">          auth: <span class="literal">true</span></span><br><span class="line">          starttls:</span><br><span class="line">            enable: <span class="literal">true</span></span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">          socketFactory:</span><br><span class="line">            port: <span class="number">25</span></span><br><span class="line">            class: javax.net.ssl.SSLSocketFactory</span><br><span class="line">            fallback: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>修改的配置 测试 部署到服务器上是可以发送的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  mail:</span><br><span class="line">    username: ***********</span><br><span class="line">    password: ***********</span><br><span class="line">    host: smtp<span class="number">.163</span>.com</span><br><span class="line">    port: <span class="number">465</span></span><br><span class="line">    <span class="keyword">default</span>-encoding: UTF-<span class="number">8</span></span><br><span class="line">    properties:</span><br><span class="line">      mail:</span><br><span class="line">        smtp:</span><br><span class="line">          timeout: <span class="number">10000</span></span><br><span class="line">          auth: <span class="literal">true</span></span><br><span class="line">          starttls:</span><br><span class="line">            enable: <span class="literal">true</span></span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">          socketFactory:</span><br><span class="line">            port: <span class="number">465</span></span><br><span class="line">            class: javax.net.ssl.SSLSocketFactory</span><br><span class="line">            fallback: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-10-23T15:01:14.000Z" title="2022/10/23 23:01:14">2022-10-23</time>发表</span><span class="level-item"><time dateTime="2021-06-17T01:59:35.000Z" title="2021/6/17 09:59:35">2021-06-17</time>更新</span><span class="level-item">9 分钟读完 (大约1416个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/10/23/%E3%80%90Docker%E3%80%91docker%E4%B8%AD%E8%AE%BE%E7%BD%AEelasticsearch%E3%80%81kibana%E7%94%A8%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%E3%80%81%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81/">docker中设置elasticsearch、kibana用户名密码、修改密码</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker中设置elasticsearch-kibana用户名密码-修改密码"><a class="markdownIt-Anchor" href="#docker中设置elasticsearch-kibana用户名密码-修改密码">#</a> docker 中设置 elasticsearch、kibana 用户名密码、修改密码</h1>
<h3 id=""><a class="markdownIt-Anchor" href="#">#</a> </h3>
<ul>
<li><a href="#_1">前言</a></li>
<li><a href="#elasticsearch_3">一、elasticsearch 设置密码</a></li>
<li>
<ul>
<li><a href="#_XPack_8">首先开启 X-Pack</a></li>
<li><a href="#_62">测试是否设置成功</a></li>
<li><a href="#_77">修改密码</a></li>
<li>
<ul>
<li><a href="#_78">已知密码修改</a></li>
<li><a href="#_107">忘记密码</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#kibanaelasticsearch_131">二、kibana 配置 elasticsearch 密码</a></li>
</ul>
<h1 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h1>
<p>之前在<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020"> docker</a> 中安装过 elasticsearch 和 elasticsearchhead 以及 kibana 都没有配置密码，在此记录下设置过程。</p>
<h1 id="一-elasticsearch设置密码"><a class="markdownIt-Anchor" href="#一-elasticsearch设置密码">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=elasticsearch&amp;spm=1001.2101.3001.7020">elasticsearch</a> 设置密码</h1>
<p>参考 <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-settings.html#token-service-settings">官方文档</a><br>
 xpack.security.enabled: true<br>
<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.16/security-api-change-password.html"> 设置引导性密码</a></p>
<blockquote>
<p>The setup-passwords tool is the simplest method to set the built-in users’ passwords for the first time. It uses the elastic user’s bootstrap password to run user management API requests. For example, you can run the command in an “interactive” mode, which prompts you to enter new passwords for the elastic, kibana, and logstash_system users:</p>
</blockquote>
<h2 id="首先开启-x-pack"><a class="markdownIt-Anchor" href="#首先开启-x-pack">#</a> 首先开启 X-Pack</h2>
<p>修改容器内或者修改挂载出来的 elasticsearch.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/elasticsearch/config/elasticsearch.yml		<span class="comment"># 挂载目录</span></span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>elasticsearch.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cluster.name:</span> <span class="string">&quot;docker-cluster-01&quot;</span></span><br><span class="line"><span class="attr">network.host:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">http.cors.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">http.cors.allow-origin:</span> <span class="string">&quot;*&quot;</span></span><br><span class="line"><span class="comment"># 此处开启xpack</span></span><br><span class="line"><span class="attr">xpack.security.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<p>进入 docker 中的 elasticsearch 中，设置密码，执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/elasticsearch/bin/x-pack/setup-passwords interactive</span><br></pre></td></tr></table></figure>
<p>依次设置用户：elastic、apm_system、kibana_system、logstash_system、beats_system、remote_monitoring_user 共 6 个用户。<br>
内部用户<br>
 X-Pack 安全有三个内部用户（_system、_xpack 和_xpack_security），负责在 Elasticsearch 集群中进行的操作。</p>
<p>这些用户仅由源自集群内的请求使用。出于这个原因，它们不能用于对 API 进行身份验证，并且没有密码可以管理或重置。</p>
<p>有时，您可能会在日志中找到对这些用户之一的引用，包括审计日志。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Initiating the setup of passwords <span class="keyword">for</span> reserved <span class="built_in">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.</span><br><span class="line">You will be prompted to enter passwords as the process progresses.</span><br><span class="line">Please confirm that you would like to <span class="built_in">continue</span> [y/N]y</span><br><span class="line">Enter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [elastic]: </span><br><span class="line">Enter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [apm_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [kibana_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [logstash_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [beats_system]: </span><br><span class="line">Enter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Reenter password <span class="keyword">for</span> [remote_monitoring_user]: </span><br><span class="line">Changed password <span class="keyword">for</span> user [apm_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [kibana]</span><br><span class="line">Changed password <span class="keyword">for</span> user [logstash_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [beats_system]</span><br><span class="line">Changed password <span class="keyword">for</span> user [remote_monitoring_user]</span><br><span class="line">Changed password <span class="keyword">for</span> user [elastic]</span><br><span class="line">12345678910111213141516171819202122</span><br></pre></td></tr></table></figure>
<h2 id="测试是否设置成功"><a class="markdownIt-Anchor" href="#测试是否设置成功">#</a> 测试是否设置成功</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200</span><br></pre></td></tr></table></figure>
<p>结果显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-24-15-centos config]<span class="comment"># curl localhost:9200</span></span><br><span class="line">&#123;<span class="string">&quot;error&quot;</span>:&#123;<span class="string">&quot;root_cause&quot;</span>:[&#123;<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missing authentication credentials for REST request [/]&quot;</span>,<span class="string">&quot;header&quot;</span>:&#123;<span class="string">&quot;WWW-Authenticate&quot;</span>:<span class="string">&quot;Basic realm=\&quot;security\&quot; charset=\&quot;UTF-8\&quot;&quot;</span>&#125;&#125;],<span class="string">&quot;type&quot;</span>:<span class="string">&quot;security_exception&quot;</span>,<span class="string">&quot;reason&quot;</span>:<span class="string">&quot;missi</span></span><br></pre></td></tr></table></figure>
<p>显示这个则设置成功。<br>
使用密码访问 elasticsearch 测试是否可以访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<p>就可以看到 elasticsearch 信息。</p>
<h2 id="修改密码"><a class="markdownIt-Anchor" href="#修改密码">#</a> 修改密码</h2>
<h3 id="已知密码修改"><a class="markdownIt-Anchor" href="#已知密码修改">#</a> 已知密码修改</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST _xpack/security/user/_password</span><br><span class="line">POST _xpack/security/user/&lt;username&gt;/_password</span><br><span class="line"><span class="comment"># 将用户elastic  密码改为elastic</span></span><br><span class="line">curl -u elastic -H <span class="string">&quot;Content-Type: application/json&quot;</span> -X POST <span class="string">&quot;localhost:9200/_xpack/security/user/elastic/_password&quot;</span> --data <span class="string">&#x27;&#123;&quot;password&quot;:&quot;elastic&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 测试是否修改成功</span></span><br><span class="line">curl localhost:9200 -u elastic</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>
<p>登录成功的结果展示:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> &#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;384cda4775e5&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;docker-cluster-01&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;SOH21TLnQdSZnJq0ZW2iDw&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;7.14.2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_flavor&quot;</span> : <span class="string">&quot;default&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_type&quot;</span> : <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;6bc13727ce758c0e943c3c21653b3da82f627f75&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2021-09-15T10:18:09.722761972Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;8.9.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_wire_compatibility_version&quot;</span> : <span class="string">&quot;6.8.0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;minimum_index_compatibility_version&quot;</span> : <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="忘记密码"><a class="markdownIt-Anchor" href="#忘记密码">#</a> 忘记密码</h3>
<p>创建本地超级账户，然后使用 api 接口本地超级账户重置 elastic 账户的密码</p>
<ol>
<li>停止 elasticsearch 服务</li>
<li>确保你的配置文件中支持本地账户认证支持，如果你使用的是 xpack 的默认配置则无需做特殊修改；如果你配置了其他认证方式则需要确保配置本地认证方式在 ES_HOME/config/elasticsearch.yml 中。</li>
<li>使用命令 ES_HOME/bin/x-pack/users 创建一个基于本地问价认证的超级管理员。</li>
<li>进入 docker 容器中 elasticsearch 中，执行</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it elasticsearch /bin/bash</span><br><span class="line">bin/x-pack/users useradd test_admin -p test_password -r superuser</span><br></pre></td></tr></table></figure>
<ol>
<li>启动 elasticsearch 服务</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart elasticsearch</span><br></pre></td></tr></table></figure>
<ol>
<li>通过 api 重置 elastic 超级管理员的密码</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -u test_admin -XPUT  -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> <span class="string">&#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27;</span> -d <span class="string">&#x27;&#123;&quot;password&quot; : &quot;新密码&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>校验下密码是否重置成功</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9200 -u elastic</span><br></pre></td></tr></table></figure>
<h1 id="二-kibana配置elasticsearch密码"><a class="markdownIt-Anchor" href="#二-kibana配置elasticsearch密码">#</a> 二、kibana 配置 elasticsearch 密码</h1>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.16/settings.html">文档</a><br>
修改容器内或者修改挂载出来的 kibana.yml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it kibana /bin/bash		<span class="comment"># 进入容器内部</span></span><br><span class="line">vi /data/kibana/config/kibana.yml		<span class="comment"># 挂载目录</span></span><br></pre></td></tr></table></figure>
<p>kibana.yml 文件添加</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Default Kibana configuration for docker target</span></span><br><span class="line"><span class="attr">server.host:</span> <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="attr">server.shutdownTimeout:</span> <span class="string">&quot;5s&quot;</span></span><br><span class="line"><span class="attr">elasticsearch.hosts:</span> [ <span class="string">&quot;http://172.17.0.3:9200&quot;</span> ]</span><br><span class="line"><span class="attr">monitoring.ui.container.elasticsearch.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br><span class="line"><span class="comment"># 此处设置elastic的用户名和密码</span></span><br><span class="line"><span class="attr">elasticsearch.username:</span> <span class="string">elastic</span></span><br><span class="line"><span class="attr">elasticsearch.password:</span> <span class="string">elastic</span></span><br></pre></td></tr></table></figure>
<p>重新启动 elasticsearch。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart kibana</span><br></pre></td></tr></table></figure>
<p>访问网址：<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f9ba8bb8f117485b8b8246d9d62599f8.png" alt="在这里插入图片描述"><br>
搞定！</p>
<blockquote>
<p>新手最近开始写文章，手敲不易，请多多支持！在此感谢每位读者 0.0</p>
</blockquote>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/3/">上一页</a></div><div class="pagination-next"><a href="/page/5/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link is-current" href="/page/4/">4</a></li><li><a class="pagination-link" href="/page/5/">5</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-29T11:42:37.000Z">2023-04-29</time></p><p class="title"><a href="/2023/04/29/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%9123%20%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%EF%BC%88%E5%85%A823%E7%A7%8D%EF%BC%89/">【设计模式】23 种设计模式详解（全23种）</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-27T09:20:49.000Z">2023-04-27</time></p><p class="title"><a href="/2023/04/27/%E3%80%90Dubbo%E3%80%91Dubbo%E8%AF%A6%E8%A7%A3%EF%BC%8C%E7%94%A8%E5%BF%83%E7%9C%8B%E8%BF%99%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86%E3%80%90%E9%87%8D%E7%82%B9%E3%80%91/">【Dubbo】Dubbo详解，用心看这一篇文章就够了【重点】</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-27T09:20:49.000Z">2023-04-27</time></p><p class="title"><a href="/2023/04/27/%E3%80%90MySql%E3%80%9121%E4%B8%AAMySQL%E8%A1%A8%E8%AE%BE%E8%AE%A1%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%87%86%E5%88%99/">【MySql】21个MySQL表设计的经验准则</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-27T09:20:49.000Z">2023-04-27</time></p><p class="title"><a href="/2023/04/27/%E3%80%90Zookeeper%E3%80%91Zookeeper%E5%85%A5%E9%97%A8%E7%9C%8B%E8%BF%99%E7%AF%87%E5%B0%B1%E5%A4%9F%E4%BA%86/">【Zookeeper】Zookeeper入门看这篇就够了</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-27T09:20:48.000Z">2023-04-27</time></p><p class="title"><a href="/2023/04/27/%E3%80%90Log4J%E3%80%91JAVA%E5%AE%89%E5%85%A8--log4j%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6%E5%88%86%E6%9E%90/">【Log4J】JAVA安全--log4j漏洞研究分析</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">31</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">52</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">134</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">134</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>