<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/avatar.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">ä¸»é¡µ</a><a class="navbar-item" href="/archives">æ–‡ç« åˆ—è¡¨</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">æ›´å¤š</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-10T22:26:17.000Z" title="2021-1-11 6:26:17">2021-01-11</time>å‘è¡¨</span><span class="level-item"><time dateTime="2021-08-24T22:52:35.000Z" title="2021-8-25 6:52:35">2021-08-25</time>æ›´æ–°</span><span class="level-item">6 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦966ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/11/%E3%80%90Elasticsearch%E3%80%91Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85%E5%B9%B6%E5%90%AF%E5%8A%A8Elasticsearch7/">Linuxç¯å¢ƒä¸‹å®‰è£…å¹¶å¯åŠ¨Elasticsearch7</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h3>
<p>â€‹        Elasticsearch (ES) æ˜¯ä¸€ä¸ªåŸºäº Lucene æ„å»ºçš„å¼€æºã€åˆ†å¸ƒå¼ã€RESTful æ¥å£å…¨æ–‡æœç´¢å¼•æ“ã€‚Elasticsearch è¿˜æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡æ¡£æ•°æ®åº“ï¼Œå…¶ä¸­æ¯ä¸ªå­—æ®µå‡æ˜¯è¢«ç´¢å¼•çš„æ•°æ®ä¸”å¯è¢«æœç´¢ï¼Œå®ƒèƒ½å¤Ÿæ‰©å±•è‡³æ•°ä»¥ç™¾è®¡çš„æœåŠ¡å™¨å­˜å‚¨ä»¥åŠå¤„ç† PB çº§çš„æ•°æ®ã€‚å®ƒå¯ä»¥åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…åœ¨å­˜å‚¨ã€æœç´¢å’Œåˆ†æå¤§é‡çš„æ•°æ®ã€‚å®ƒé€šå¸¸ä½œä¸ºå…·æœ‰å¤æ‚æœç´¢åœºæ™¯æƒ…å†µä¸‹çš„æ ¸å¿ƒå‘åŠ¨æœºã€‚es æ˜¯ç”± java è¯­è¨€ç¼–å†™çš„ã€‚</p>
<pre><code>Elasticsearchå°±æ˜¯ä¸ºé«˜å¯ç”¨å’Œå¯æ‰©å±•è€Œç”Ÿçš„ã€‚å¯ä»¥é€šè¿‡è´­ç½®æ€§èƒ½æ›´å¼ºçš„æœåŠ¡å™¨æ¥å®Œæˆã€‚
</code></pre>
<p><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/elasticsearch/">Elasticsearchï¼šå®˜æ–¹åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/icon-default.png" alt="img">https://www.elastic.co/cn/elasticsearch/</a></p>
<h2 id=""><a class="markdownIt-Anchor" href="#">#</a> </h2>
<h2 id="linuxé‡Œéƒ¨ç½²es"><a class="markdownIt-Anchor" href="#linuxé‡Œéƒ¨ç½²es">#</a> Linux é‡Œéƒ¨ç½² ES</h2>
<h3 id="ä¸‹è½½åœ°å€"><a class="markdownIt-Anchor" href="#ä¸‹è½½åœ°å€">#</a> ä¸‹è½½åœ°å€</h3>
<p>â€‹        æˆ‘ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ ES7.15.1</p>
<p>Elasticsearch 7.15.1 | Elastic<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/apple-icon-57x57.png" alt="img"><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1">https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-15-1</a></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/74a3f6fc611945ebb8e492204fe4b51f.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4490382f8fd54a48bbd8e2ffaf2ce6ea.png" alt="img"></p>
<h3 id="ä¸Šä¼ åˆ°linux"><a class="markdownIt-Anchor" href="#ä¸Šä¼ åˆ°linux">#</a> ä¸Šä¼ åˆ° Linux</h3>
<p>â€‹    å‹ç¼©åŒ…ä¸‹è½½å®Œæˆåä¸Šä¼ åˆ°æœåŠ¡å™¨</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3732b77fcd15428e8397739b50f6b3b1.png" alt="img"></p>
<h3 id="è§£å‹è½¯ä»¶"><a class="markdownIt-Anchor" href="#è§£å‹è½¯ä»¶">#</a> è§£å‹è½¯ä»¶</h3>
<p>â€‹     è§£å‹åˆ°ä¸Šçº§ç›®å½•ï¼Œç„¶åè¿›è¡Œæ”¹å</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">è§£å‹ç¼©</span></span><br><span class="line">tar -zxvf elasticsearch-7.15.1-linux-x86_64.tar.gz -C ../</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ”¹å</span></span><br><span class="line">mv elasticsearch-7.15.1 es-7.15.1</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e6ff579f0e6b4aa6994e17629bbaa96a.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/7678de3df173498e92409dc8300f09b5.png" alt="img"></p>
<p>åœ¨ /opt ç›®å½•ä¸‹æ–°å»º module/es ç›®å½•ï¼ŒåŒæ—¶æŠŠ es-7.15.1 ç§»åˆ°è¯¥ç›®å½•</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv es-7.15.1 /opt/module/es</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºç”¨æˆ·"><a class="markdownIt-Anchor" href="#åˆ›å»ºç”¨æˆ·">#</a> åˆ›å»ºç”¨æˆ·</h3>
<p>â€‹    å› ä¸ºå®‰å…¨é—®é¢˜ï¼Œ Elasticsearch ä¸å…è®¸ root ç”¨æˆ·ç›´æ¥è¿è¡Œï¼Œæ‰€ä»¥è¦åˆ›å»ºæ–°ç”¨æˆ·ï¼Œåœ¨ root ç”¨æˆ·ä¸­åˆ›å»ºæ–°ç”¨æˆ·ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useradd es #æ–°å¢ es ç”¨æˆ·</span><br><span class="line">passwd es #ä¸º es ç”¨æˆ·è®¾ç½®å¯†ç </span><br><span class="line">userdel -r es #å¦‚æœé”™äº†ï¼Œå¯ä»¥åˆ é™¤å†åŠ </span><br><span class="line">chown -R es:es /opt/module/es/es-7.15.1 #æ–‡ä»¶å¤¹æ‰€æœ‰è€…</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/cf9ac437254f47bfa9e26f4770fa9667.png" alt="img"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3b5a89b6cdbb4a3bb6220423400e25d2.png" alt="img"></p>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#ä¿®æ”¹é…ç½®æ–‡ä»¶">#</a> ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<p>ä¿®æ”¹ /root/es-7.15.1/config/elasticsearch.yml æ–‡ä»¶ã€‚</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d40fbb16c317400495682be93a2e07d7.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># åŠ å…¥å¦‚ä¸‹é…ç½®</span><br><span class="line">cluster.name: elasticsearch</span><br><span class="line">node.name: node-1</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/00e7d21c15c640ba949d3dda5e9ee885.png" alt="img"></p>
<h3 id="ä¿®æ”¹etcsecuritylimitsconf"><a class="markdownIt-Anchor" href="#ä¿®æ”¹etcsecuritylimitsconf">#</a> ä¿®æ”¹ /etc/security/limits.conf</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åœ¨æ–‡ä»¶æœ«å°¾ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span><br><span class="line"># æ¯ä¸ªè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æ–‡ä»¶æ•°çš„é™åˆ¶</span><br><span class="line">es soft nofile 65536</span><br><span class="line">es hard nofile 65536</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4d4441f8e29346a0bc5a0ac8959477d9.png" alt="img"></p>
<h3 id="ä¿®æ”¹etcsysctlconf"><a class="markdownIt-Anchor" href="#ä¿®æ”¹etcsysctlconf">#</a> ä¿®æ”¹ /etc/sysctl.conf</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åœ¨æ–‡ä»¶ä¸­å¢åŠ ä¸‹é¢å†…å®¹</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰çš„ VMA(è™šæ‹Ÿå†…å­˜åŒºåŸŸ)çš„æ•°é‡,é»˜è®¤å€¼ä¸º 65536</span></span><br><span class="line">vm.max_map_count=655360</span><br></pre></td></tr></table></figure>
<h3 id="é‡æ–°åŠ è½½"><a class="markdownIt-Anchor" href="#é‡æ–°åŠ è½½">#</a> é‡æ–°åŠ è½½</h3>
<p>sysctl -p</p>
<h3 id="æ³¨æ„"><a class="markdownIt-Anchor" href="#æ³¨æ„">#</a> æ³¨æ„ï¼š</h3>
<p>â€‹    å¯åŠ¨å‰éœ€è¦å…ˆåˆ‡æ¢åˆ° es ç”¨æˆ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su es</span><br></pre></td></tr></table></figure>
<h3 id="å¯åŠ¨es"><a class="markdownIt-Anchor" href="#å¯åŠ¨es">#</a> å¯åŠ¨ es</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨ è¿›å…¥binç›®å½•ï¼š</span></span><br><span class="line">./elasticsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åå°å¯åŠ¨</span></span><br><span class="line">./elasticsearch -d  </span><br></pre></td></tr></table></figure>
<h3 id="æµ‹è¯•è¿æ¥"><a class="markdownIt-Anchor" href="#æµ‹è¯•è¿æ¥">#</a> æµ‹è¯•è¿æ¥</h3>
<p>â€‹    æµè§ˆå™¨ä¸­æ‰“å¼€ <a target="_blank" rel="noopener" href="http://xn--ip-fr5c86lx7z:9200/">http:// æœåŠ¡å™¨ IP:9200/</a>, å‡ºç°å¦‚ä¸‹åˆ™è¯´æ˜å®‰è£…æˆåŠŸ</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0197dcff901f47279750939332674547.png" alt="img"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-08T06:37:17.000Z" title="2021-1-8 14:37:17">2021-01-08</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-10-08T18:01:59.000Z" title="2023-10-9 2:01:59">2023-10-09</time>æ›´æ–°</span><span class="level-item">2 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦306ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/08/%E3%80%90Flutter%E3%80%91Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/">Flutterå¼€å‘ä¸­ä½¿ç”¨WIFIçœŸæœºè°ƒè¯•</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="flutterå¼€å‘ä¸­ä½¿ç”¨wifiçœŸæœºè°ƒè¯•"><a class="markdownIt-Anchor" href="#flutterå¼€å‘ä¸­ä½¿ç”¨wifiçœŸæœºè°ƒè¯•">#</a> Flutter å¼€å‘ä¸­ä½¿ç”¨ WIFI çœŸæœºè°ƒè¯•</h1>
<h4 id="ä½¿ç”¨vscodeå¼€å‘flutterç”¨wifi-æˆ–è€…-æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ-æ— çº¿è°ƒè¯•è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#ä½¿ç”¨vscodeå¼€å‘flutterç”¨wifi-æˆ–è€…-æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ-æ— çº¿è°ƒè¯•è¿‡ç¨‹">#</a> ä½¿ç”¨ vscode å¼€å‘ flutterï¼Œç”¨ wifi æˆ–è€… æ‰‹æœºçƒ­ç‚¹è¿›è¡Œ æ— çº¿è°ƒè¯•è¿‡ç¨‹</h4>
<h4 id="1æ‰‹æœºè¿æ¥wifiååœ¨è®¾ç½®ä¸­æ‰¾åˆ°ipå’Œç«¯å£"><a class="markdownIt-Anchor" href="#1æ‰‹æœºè¿æ¥wifiååœ¨è®¾ç½®ä¸­æ‰¾åˆ°ipå’Œç«¯å£">#</a> 1. æ‰‹æœºè¿æ¥ wifi ååœ¨è®¾ç½®ä¸­æ‰¾åˆ° ip å’Œç«¯å£</h4>
<h4 id="2åœ¨vscodeç»ˆç«¯è¾“å…¥-adb-connect-æ‰‹æœºipæ‰‹æœºç«¯å£"><a class="markdownIt-Anchor" href="#2åœ¨vscodeç»ˆç«¯è¾“å…¥-adb-connect-æ‰‹æœºipæ‰‹æœºç«¯å£">#</a> 2. åœ¨ vscode ç»ˆç«¯è¾“å…¥ adb connect æ‰‹æœº IP: æ‰‹æœºç«¯å£</h4>
<h4 id="3ä½œè€…åœ¨csdnè¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯å…¨æ˜¯ç²˜è´´çš„æ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ç²˜è´´å¯ä»¥æŠ„è¢­å¯è€»"><a class="markdownIt-Anchor" href="#3ä½œè€…åœ¨csdnè¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯å…¨æ˜¯ç²˜è´´çš„æ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ç²˜è´´å¯ä»¥æŠ„è¢­å¯è€»">#</a> 3. ä½œè€…åœ¨ CSDN è¿™ä¸ªçƒ‚ç¯å¢ƒä¸­æ²¡æ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå…¨æ˜¯ç²˜è´´çš„ï¼Œæ‰€ä»¥å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©åˆ°ä½ ï¼Œä½ å¯ä»¥æŠŠæˆ‘çš„åœ°å€åˆ—å‡ºæ¥ï¼Œç²˜è´´å¯ä»¥ï¼ŒæŠ„è¢­å¯è€»ï¼</h4>
<h4 id="4å®Œæˆä»¥ä¸Šæ­¥éª¤æ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼"><a class="markdownIt-Anchor" href="#4å®Œæˆä»¥ä¸Šæ­¥éª¤æ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼">#</a> 4. å®Œæˆä»¥ä¸Šæ­¥éª¤ï¼Œæ‰‹æœºç«¯åº”æœ‰å¼€å¯æ— çº¿è°ƒè¯•çš„æç¤ºï¼Œè®°å¾—æå‰æ‰“å¼€å¼€å‘è€…æ¨¡å¼ã€‚</h4>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-01-01T18:18:05.000Z" title="2021-1-2 2:18:05">2021-01-02</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-09-17T05:27:20.000Z" title="2023-9-17 13:27:20">2023-09-17</time>æ›´æ–°</span><span class="level-item">8 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1170ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/01/02/%E3%80%90Vue%E3%80%91JSON%E7%BC%96%E8%BE%91%E5%99%A8Bin-Coder/">ã€Vueã€‘JSONç¼–è¾‘å™¨Bin-Coder</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="vuejsonç¼–è¾‘å™¨bin-coder"><a class="markdownIt-Anchor" href="#vuejsonç¼–è¾‘å™¨bin-coder">#</a> ã€Vueã€‘JSON ç¼–è¾‘å™¨ Bin-Coder</h1>
<p><a target="_blank" rel="noopener" href="https://wangbin3162.gitee.io/bin-code-editor/#/guide">Bin Code Editor</a></p>
<h1 id="1-å®‰è£…"><a class="markdownIt-Anchor" href="#1-å®‰è£…">#</a> 1 å®‰è£…</h1>
<h2 id="11-cdn-å®‰è£…"><a class="markdownIt-Anchor" href="#11-cdn-å®‰è£…">#</a> 1.1 CDN å®‰è£…</h2>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="keyword">import</span> <span class="title class_">Vue</span>.<span class="property">js</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;!-- <span class="keyword">import</span> stylesheet --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://unpkg.com/bin-code-editor@0.1.0/lib/styles/index.css&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="comment">&lt;!-- import bin-code-editor --&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/bin-code-editor@0.1.0/lib/bin-code-editor.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>@0.1.0 è¡¨ç¤ºç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å»ºè®®é”å®šç‰ˆæœ¬å·æ¥ä¿è¯ä»£ç çš„ç¨³å®šæ€§</p>
<h2 id="12-npm-å®‰è£…"><a class="markdownIt-Anchor" href="#12-npm-å®‰è£…">#</a> 1.2 npm å®‰è£…</h2>
<p>æ¨èä½¿ç”¨ npm å®‰è£…ï¼Œå®ƒèƒ½æ›´å¥½åœ°å’Œ<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=webpack%E6%89%93%E5%8C%85&amp;spm=1001.2101.3001.7020"> webpack æ‰“åŒ…</a>å·¥å…·é…åˆä½¿ç”¨ã€‚è€Œä¸”å¯ä»¥æ›´å¥½çš„å’Œ es6 é…åˆä½¿ç”¨ã€‚å¹¶ä¸”æ”¯æŒæŒ‰éœ€å¼•å…¥</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i bin-code-editor -S</span><br><span class="line"># or </span><br><span class="line">yarn add bin-code-editor</span><br></pre></td></tr></table></figure>
<h1 id="2-å¼•å…¥"><a class="markdownIt-Anchor" href="#2-å¼•å…¥">#</a> 2 å¼•å…¥</h1>
<p>åœ¨ main.js ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">CodeEditor</span> <span class="keyword">from</span> <span class="string">&#x27;bin-code-editor&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;bin-code-editor/lib/style/index.css&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">CodeEditor</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  <span class="attr">render</span>: <span class="function"><span class="params">h</span> =&gt;</span> <span class="title function_">h</span>(<span class="title class_">App</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="3-ç”¨æ³•"><a class="markdownIt-Anchor" href="#3-ç”¨æ³•">#</a> 3 ç”¨æ³•</h1>
<p>æ³¨æ„ï¼Œåˆå§‹åŒ–å¦‚æœæœ‰æ•°æ®ï¼Œåˆ™ä¼šé»˜è®¤æ ¼å¼åŒ–ä¸€æ¬¡ï¼Œæ ¼å¼åŒ–å¿«æ·é”®é»˜è®¤ä¸º F7, ä½¿ç”¨æ—¶å¯ä»¥è¿›è¡Œæ ¼å¼åŒ–ç»“æ„ï¼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSON.stringify(JSON.parse(jsonData),null,2)`å¯ä»¥å°†é»˜è®¤jsonè¿›è¡Œé¢„æ ¼å¼åŒ–,ä¹Ÿå¯ä»¥æ‰‹åŠ¨è§¦å‘formatCode()æ¥æ ¼å¼åŒ–</span><br><span class="line">`JSON.stringify(value[, replacer[, space]])</span><br></pre></td></tr></table></figure>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>value: å¿…éœ€ï¼Œ è¦è½¬æ¢çš„ JavaScript å€¼ï¼ˆé€šå¸¸ä¸ºå¯¹è±¡æˆ–æ•°ç»„ï¼‰ã€‚</li>
<li>replacer: å¯é€‰ã€‚ç”¨äºè½¬æ¢ç»“æœçš„å‡½æ•°æˆ–æ•°ç»„ã€‚å¦‚æœ replacer ä¸ºå‡½æ•°ï¼Œåˆ™ JSON.stringify å°†è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¹¶ä¼ å…¥æ¯ä¸ªæˆå‘˜çš„é”®å’Œå€¼ã€‚ä½¿ç”¨è¿”å›å€¼è€Œä¸æ˜¯åŸå§‹å€¼ã€‚å¦‚æœæ­¤å‡½æ•°è¿”å› undefinedï¼Œåˆ™æ’é™¤æˆå‘˜ã€‚æ ¹å¯¹è±¡çš„é”®æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼šâ€œâ€ã€‚å¦‚æœ replacer æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™ä»…è½¬æ¢è¯¥æ•°ç»„ä¸­å…·æœ‰é”®å€¼çš„æˆå‘˜ã€‚æˆå‘˜çš„è½¬æ¢é¡ºåºä¸é”®åœ¨æ•°ç»„ä¸­çš„é¡ºåºä¸€æ ·ã€‚</li>
<li>space: å¯é€‰ï¼Œæ–‡æœ¬æ·»åŠ ç¼©è¿›ã€ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œå¦‚æœ space æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œåˆ™è¿”å›å€¼æ–‡æœ¬åœ¨æ¯ä¸ªçº§åˆ«ç¼©è¿›æŒ‡å®šæ•°ç›®çš„ç©ºæ ¼ï¼Œå¦‚æœ space å¤§äº 10ï¼Œåˆ™æ–‡æœ¬ç¼©è¿› 10 ä¸ªç©ºæ ¼ã€‚space ä¹Ÿå¯ä»¥ä½¿ç”¨éæ•°å­—ï¼Œå¦‚ï¼š\tã€‚</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/ba155f2c67e14cc0b063a92a683220ff.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">b-code-editor</span> <span class="attr">v-model</span>=<span class="string">&quot;jsonStr&quot;</span> <span class="attr">:indent-unit</span>=<span class="string">&quot;4&quot;</span> <span class="attr">height</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> jsonData = <span class="string">`&#123;&quot;title&quot;:&quot;æµ‹è¯•jsonæ•°æ®&quot;,&quot;children&quot;:[&#123;&quot;name&quot;:&quot;å­é¡¹åç§°&quot;, &quot;desc&quot;:&quot;å­é¡¹è¯´æ˜&quot; &#125;,&#123;&quot;name&quot;:&quot;å­é¡¹åç§°1&quot;, &quot;desc&quot;:&quot;å­é¡¹è¯´æ˜1&quot; &#125;]&#125;`</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">return</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">jsonStr</span>: jsonData</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="4-å…¶ä»–é…ç½®é¡¹"><a class="markdownIt-Anchor" href="#4-å…¶ä»–é…ç½®é¡¹">#</a> 4 å…¶ä»–é…ç½®é¡¹</h1>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>è¯´æ˜</th>
<th>ç±»å‹</th>
<th>å¯é€‰å€¼</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>ç»‘å®šæ•°æ®ï¼Œå¯ç”¨ v-model</td>
<td>String</td>
<td>â€”</td>
<td>0</td>
</tr>
<tr>
<td>show-number</td>
<td>æ˜¾ç¤ºè¡Œå·</td>
<td>Boolean</td>
<td>â€”</td>
<td>true</td>
</tr>
<tr>
<td>mode</td>
<td>æ¨¡å¼</td>
<td>String</td>
<td>â€˜application/jsonâ€™,â€˜text/javascriptâ€™</td>
<td>â€˜application/jsonâ€™</td>
</tr>
<tr>
<td>theme</td>
<td>æä¾›è‹¥å¹²ä¸ªé»˜è®¤æ¯”è¾ƒå¥½çœ‹çš„çš®è‚¤</td>
<td>String</td>
<td>å¯é€‰å€¼å‚è€ƒå…¶ä»–é…ç½®é¡¹ä¸­åˆ—å‡º</td>
<td>idea</td>
</tr>
<tr>
<td>lint</td>
<td>æ˜¯å¦è¿›è¡Œ lint æ£€æŸ¥</td>
<td>Boolean</td>
<td>æš‚æ—¶åªæ”¯æŒ json</td>
<td>true</td>
</tr>
<tr>
<td>readonly</td>
<td>åªè¯»æ¨¡å¼</td>
<td>Boolean</td>
<td>-</td>
<td>false</td>
</tr>
<tr>
<td>auto-format</td>
<td>æ˜¯å¦è‡ªåŠ¨æ ¼å¼åŒ–</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>indent-unit</td>
<td>ç¼©è¿›å­—ç¬¦</td>
<td>Number</td>
<td>-</td>
<td>2</td>
</tr>
<tr>
<td>smart-indent</td>
<td>æ˜¯å¦è‡ªåŠ¨ç¼©è¿›</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>line-wrap</td>
<td>ä»£ç æ¢è¡Œ</td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>gutter</td>
<td>ä»£ç æŠ˜å </td>
<td>Boolean</td>
<td>-</td>
<td>true</td>
</tr>
<tr>
<td>height</td>
<td>é»˜è®¤ç¼–è¾‘å™¨é«˜åº¦</td>
<td>String</td>
<td>â€”</td>
<td>300px</td>
</tr>
</tbody>
</table>
<h1 id="5-events-äº‹ä»¶"><a class="markdownIt-Anchor" href="#5-events-äº‹ä»¶">#</a> 5 Events äº‹ä»¶</h1>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	  <span class="tag">&lt;<span class="name">b-code-editor</span> <span class="attr">v-model</span>=<span class="string">&quot;jsonStr&quot;</span> <span class="attr">:indent-unit</span>=<span class="string">&quot;4&quot;</span> <span class="attr">height</span>=<span class="string">&quot;auto&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">	  <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b-button</span> @<span class="attr">click</span>=<span class="string">&quot;$refs[&#x27;editor&#x27;].formatCode()&quot;</span>&gt;</span>æ‰‹åŠ¨è§¦å‘æ ¼å¼åŒ–<span class="tag">&lt;/<span class="name">b-button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>äº‹ä»¶å</th>
<th>è¯´æ˜</th>
<th>è¿”å›å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>on-change</td>
<td>è¾“å…¥é¡¹æ”¹å˜äº‹ä»¶</td>
<td>value</td>
</tr>
<tr>
<td>formatCode</td>
<td>æ‰‹åŠ¨è§¦å‘æ ¼å¼åŒ–æ–¹æ³•</td>
<td>-</td>
</tr>
<tr>
<td>refresh</td>
<td>æ‰‹åŠ¨åˆ·æ–°æ–¹æ³•</td>
<td>-</td>
</tr>
<tr>
<td>getValue</td>
<td>è‡ªè¡Œè·å–å€¼</td>
<td>-</td>
</tr>
</tbody>
</table>
<h1 id="6-theme-çš®è‚¤å±æ€§"><a class="markdownIt-Anchor" href="#6-theme-çš®è‚¤å±æ€§">#</a> 6 theme çš®è‚¤å±æ€§</h1>
<p><code>theme</code>  å±æ€§å¯é€‰å€¼</p>
<ul>
<li>idea<br>
<img src="https://img-blog.csdnimg.cn/774c7c41e1fd4dad81c4a8c4d56fb608.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>eclipse<br>
<img src="https://img-blog.csdnimg.cn/97d00490aa2c452e96cc64717798c9d5.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>duotone-light<br>
<img src="https://img-blog.csdnimg.cn/a9a97cd2eff84e60b687ddf8368c6e50.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>mdn-like<br>
<img src="https://img-blog.csdnimg.cn/68288d52b01d41fab7653d9c3dcfb10a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>xq-light<br>
<img src="https://img-blog.csdnimg.cn/988f7ebe12ff42ef80f6b1a527bed1c7.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>dracula<br>
<img src="https://img-blog.csdnimg.cn/2aa62e024dbd41158a8bc66db799ef82.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>rubyblue<br>
<img src="https://img-blog.csdnimg.cn/04b909ae46234a0c871daa0545215526.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>monokai<br>
<img src="https://img-blog.csdnimg.cn/7baa723e068747a885ae2fa3b80048d2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>material<br>
<img src="https://img-blog.csdnimg.cn/f949cc3c5f7344dc98c38751bd8db085.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
<li>material-darker<br>
<img src="https://img-blog.csdnimg.cn/48f9a957450641e4b0ebb269f09aba7d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li>
</ul>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-20T00:42:43.000Z" title="2020-12-20 8:42:43">2020-12-20</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-11-26T06:52:52.000Z" title="2023-11-26 14:52:52">2023-11-26</time>æ›´æ–°</span><span class="level-item">15 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2268ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/20/%E3%80%90MySQL%E3%80%91Mysql%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4/">Mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£ï¼Œå®ç°è¯»å†™åˆ†ç¦»</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£å®ç°è¯»å†™åˆ†ç¦»"><a class="markdownIt-Anchor" href="#mysqlä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£å®ç°è¯»å†™åˆ†ç¦»">#</a> Mysql ä¸»ä»é›†ç¾¤æ­å»ºæ–‡æ¡£ï¼Œå®ç°è¯»å†™åˆ†ç¦»</h2>
<p>â€‹		æœ€è¿‘åœ¨è‡ªå·±å†™çš„é¡¹ç›®ä¸­éœ€è¦åº”å¯¹å¤§é‡çš„ç”¨æˆ·æŸ¥è¯¢è¯»å†™æ“ä½œï¼Œä¸€å°æœåŠ¡å™¨å½“ç„¶æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥åœ¨è¾¹å­¦è¾¹æ•²çš„èƒŒæ™¯ä¸‹ï¼Œè®°å½•è¿™ç¯‡ç¬”è®°ï¼Œä» 0 å¼€å§‹æ­å»ºä¸»ä»é›†ç¾¤ã€‚</p>
<h4 id="ä¸‹é¢å¼€å§‹æ“ä½œ"><a class="markdownIt-Anchor" href="#ä¸‹é¢å¼€å§‹æ“ä½œ">#</a> ä¸‹é¢ğŸ‘‡å¼€å§‹æ“ä½œï¼š</h4>
<p>1. åˆ†åˆ«åœ¨ä¸¤å°æœåŠ¡å™¨æ­å»º mysql æœåŠ¡</p>
<p>â€‹		ä¸¤å°æœåŠ¡å™¨çš„ IP åœ°å€åˆ†åˆ«ä¸ºä¸»æœåŠ¡å™¨ï¼ˆ192.168.20.1ï¼‰å’Œä»æœåŠ¡å™¨ï¼ˆ192.168.20.2ï¼‰ã€‚<br>
2. é…ç½®æ–‡ä»¶ my.cnf çš„ä¿®æ”¹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œç¼–è¾‘my.cnfæ–‡ä»¶</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨[mysqld]ä¸­æ·»åŠ ï¼š</span></span><br><span class="line">server-id=1</span><br><span class="line">log_bin=master-bin</span><br><span class="line">log_bin_index=master-bin.index</span><br><span class="line">binlog_do_db=test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">log_bin å¯åŠ¨MySQLäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå³æ•°æ®åŒæ­¥è¯­å¥ï¼Œä»æ•°æ®åº“ä¼šä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œè¿™äº›è¯­å¥ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_do_db æŒ‡å®šè®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ï¼Œå³éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œå¦‚æœå¤åˆ¶å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">binlog_ignore_db æŒ‡å®šä¸è®°å½•äºŒè¿›åˆ¶æ—¥å¿—çš„æ•°æ®åº“ï¼Œå³ä¸éœ€è¦å¤åˆ¶çš„æ•°æ®åº“åï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œbinlog_do_dbå’Œbinlog_ignore_dbä¸ºäº’æ–¥é€‰é¡¹ï¼Œä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªå³å¯ã€‚</span></span><br></pre></td></tr></table></figure>
<p>3. åˆ›å»ºä»æœåŠ¡å™¨çš„ç”¨æˆ·å’Œæƒé™</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºä»æ•°æ®åº“çš„rootç”¨æˆ·å’Œæƒé™</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">grant replication slave on *.* to root@<span class="string">&#x27;192.168.20.%&#x27;</span> identified by <span class="string">&#x27;Lgq081538&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line">grant replication slave on *.* to &#x27;123456&#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">192.168.20.%é€šé…ç¬¦ï¼Œè¡¨ç¤º0-255çš„IPéƒ½å¯è®¿é—®ä¸»æœåŠ¡å™¨ï¼Œæ­£å¼ç¯å¢ƒè¯·é…ç½®æŒ‡å®šä»æœåŠ¡å™¨IP</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è‹¥å°† 192.168.20.% æ”¹ä¸º %ï¼Œåˆ™ä»»ä½•ipå‡å¯ä½œä¸ºå…¶ä»æ•°æ®åº“æ¥è®¿é—®ä¸»æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">é€€å‡ºmysql</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash"><span class="built_in">exit</span>;</span></span><br></pre></td></tr></table></figure>
<p>4. é‡å¯ mysql æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>5. æŸ¥çœ‹ä¸»æœåŠ¡å™¨çŠ¶æ€</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ä¸»æœåŠ¡å™¨çŠ¶æ€</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show master status;</span></span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| master-bin.000001 |      154 | test         |                  |                   |</span><br><span class="line">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>6.slave ä»æœåŠ¡å™¨çš„é…ç½®</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">é…ç½®æ–‡ä»¶my.cnfçš„ä¿®æ”¹</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œç¼–è¾‘my.cnfæ–‡ä»¶</span></span><br><span class="line">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœ¨[mysqld]ä¸­æ·»åŠ ï¼š</span></span><br><span class="line">server-id=2</span><br><span class="line">relay-log=slave-relay-bin</span><br><span class="line">relay-log-index=slave-relay-bin.index</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db=<span class="built_in">test</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">server-id æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœæœ‰å¤šä¸ªä»æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„server-idä¸èƒ½é‡å¤ï¼Œè·ŸIPä¸€æ ·æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œå¦‚æœä½ æ²¡è®¾ç½®server-idæˆ–è€…è®¾ç½®ä¸º0ï¼Œåˆ™ä»æœåŠ¡å™¨ä¸ä¼šè¿æ¥åˆ°ä¸»æœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">relay-log å¯åŠ¨MySQLäºŒè¿›åˆ¶æ—¥å¿—ï¼Œå¯ä»¥ç”¨æ¥åšæ•°æ®å¤‡ä»½å’Œå´©æºƒæ¢å¤ï¼Œæˆ–ä¸»æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œå°†æ­¤ä»æœåŠ¡å™¨ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»æœåŠ¡å™¨ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-do-db æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœå¤åˆ¶å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚è‹¥åœ¨masterç«¯ä¸æŒ‡å®šbinlog-do-dbï¼Œåˆ™åœ¨slaveç«¯å¯ç”¨replication-do-dbæ¥è¿‡æ»¤ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">replicate-ignore-db ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“ï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‡å¤è®¾ç½®è¿™ä¸ªé€‰é¡¹å³å¯ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å…¶ä¸­éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œreplicate-do-dbå’Œreplicate-ignore-dbä¸ºäº’æ–¥é€‰é¡¹ï¼Œä¸€èˆ¬åªéœ€è¦ä¸€ä¸ªå³å¯ã€‚</span></span><br></pre></td></tr></table></figure>
<p>7. é‡å¯ mysql æœåŠ¡</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost mysql]# service mysql restart</span><br><span class="line">Shutting down MySQL.... SUCCESS! </span><br><span class="line">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>
<p>8. è¿æ¥ master ä¸»æœåŠ¡å™¨</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥mysqlæ•°æ®åº“</span></span><br><span class="line">[root@localhost mysql]# mysql -uroot -p</span><br><span class="line">Enter password:</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿æ¥masterä¸»æœåŠ¡å™¨</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">change master to master_host=<span class="string">&#x27;192.168.20.1&#x27;</span>,master_port=3306,master_user=<span class="string">&#x27;root&#x27;</span>,master_password=<span class="string">&#x27;123456&#x27;</span>,master_log_file=<span class="string">&#x27;master-bin.000009&#x27;</span>,master_log_pos=473127;</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¤‡æ³¨ï¼š</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_hostå¯¹åº”ä¸»æœåŠ¡å™¨çš„IPåœ°å€ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_portå¯¹åº”ä¸»æœåŠ¡å™¨çš„ç«¯å£ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_fileå¯¹åº”show master statusæ˜¾ç¤ºçš„Fileåˆ—ï¼šmaster-bin.000001ã€‚</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">master_log_poså¯¹åº”show master statusæ˜¾ç¤ºçš„Positionåˆ—ï¼š154ã€‚</span></span><br></pre></td></tr></table></figure>
<p>9. å¯åŠ¨ slave æ•°æ®åŒæ­¥</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨slaveæ•°æ®åŒæ­¥</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">start slave;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åœæ­¢slaveæ•°æ®åŒæ­¥ï¼ˆè‹¥æœ‰éœ€è¦ï¼‰</span></span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">stop slave;</span></span><br><span class="line">3.5 æŸ¥çœ‹slaveä¿¡æ¯</span><br><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show slave status\G;</span></span><br><span class="line">Slave_IO_Runningå’ŒSlave_SQL_Runningéƒ½ä¸ºyesï¼Œåˆ™è¡¨ç¤ºåŒæ­¥æˆåŠŸã€‚</span><br></pre></td></tr></table></figure>
<p>10. æµ‹è¯•</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ï¼ˆ1ï¼‰åœ¨ä¸»æœåŠ¡å™¨ä¸Šç™»é™†mysqlï¼Œä¸”è¿›å…¥testæ•°æ®åº“ï¼Œåˆ›å»ºtestè¡¨ï¼Œä¸”æ’å…¥ä¸€æ¡æ•°æ®</span><br><span class="line">æç¤ºï¼šè¿™é‡Œæœ€å¥½ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¦‚nacicatï¼‰æ¥æ“ä½œã€‚</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºtb_testè¡¨</span></span><br><span class="line">create table tb_test(ID varchar(36) primary key comment &#x27;ä¸»é”®ID&#x27;,MEMO varchar(500) not null comment &#x27;ä¿¡æ¯&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ’å…¥ä¸€æ¡æ•°æ®</span></span><br><span class="line">insert into tb_test(ID,MEMO) values(&#x27;1&#x27;,&#x27;one test&#x27;);</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æäº¤</span></span><br><span class="line">commit;</span><br><span class="line">ï¼ˆ2ï¼‰åœ¨ä»æœåŠ¡å™¨ä¸Šç™»é™†mysqlï¼Œä¸”è¿›å…¥testæ•°æ®åº“</span><br><span class="line">ä½ ä¼šå‘ç°ä»æ•°æ®åº“ä¸­ï¼Œä¹Ÿå‡ºç°äº†tb_testè¡¨ï¼Œä¸”è¡¨ä¸­è¿˜æœ‰one testæ•°æ®å­˜åœ¨ï¼Œè¯æ˜åŒæ­¥æ•°æ®æˆåŠŸã€‚</span><br></pre></td></tr></table></figure>
<h3 id="è‡³æ­¤mysqlä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ"><a class="markdownIt-Anchor" href="#è‡³æ­¤mysqlä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ">#</a> è‡³æ­¤ Mysql ä¸»ä»è¯»å†™åˆ†ç¦»æ­å»ºå®Œæˆ</h3>
<p>ä¸‹é¢å¼€å§‹æ­å»º Spring Boot é¡¹ç›®ä¸­çš„ç›¸å…³é…ç½®ä»¥åŠå®ç°ğŸ‘‡</p>
<p>â€‹		è¯»å†™åˆ†ç¦»è¦åšçš„äº‹æƒ…å°±æ˜¯å¯¹äºä¸€æ¡ SQL è¯¥é€‰æ‹©å“ªä¸ªæ•°æ®åº“å»æ‰§è¡Œï¼Œè‡³äºè°æ¥åšé€‰æ‹©æ•°æ®åº“è¿™ä»¶äº‹ï¼Œä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œåˆ†åˆ«ä¸ºï¼š<br>
1. ä½¿ç”¨ä¸­é—´ä»¶ï¼Œæ¯”å¦‚ Atlasï¼Œcobarï¼ŒTDDLï¼Œmycatï¼Œheisenbergï¼ŒOceanusï¼Œvitessï¼ŒOneProxy ç­‰<br>
 2. ä½¿ç”¨ç¨‹åºè‡ªå·±å®ç°ï¼Œåˆ©ç”¨ Spring Boot æä¾›çš„è·¯ç”±æ•°æ®æºä»¥åŠ AOPï¼Œå®ç°èµ·æ¥ç®€å•å¿«æ·<br>
â€‹</p>
<p>â€‹		æˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ Spring Boot æ•°æ®æºè·¯ç”± + AOP ï¼Œè¿™æ ·èƒ½æ›´å¥½çš„æ§åˆ¶æµç¨‹ï¼Œä¹Ÿä¾¿äºåæœŸæå‡æ€§èƒ½ï¼›</p>
<p>ä»£ç å®ç°<br>
 1. é¦–å…ˆé…ç½®ä¸‹ pom.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=xml&amp;spm=1001.2101.3001.7020">xml</a> å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ aop å®ç°ï¼Œæ‰€ä»¥éœ€è¦ aop ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2. æ•°æ®æºè·¯ç”±ç±»åŠŸèƒ½ RoutingDataSource.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®æºè·¯ç”±ç±»åŠŸèƒ½</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RoutingDataSource</span> <span class="keyword">extends</span> <span class="title class_">AbstractRoutingDataSource</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">determineCurrentLookupKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DBContext.get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3. æ•°æ®æºä¸Šä¸‹æ–‡ç±» DBContext.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®æºä¸Šä¸‹æ–‡ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DBContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;DBTypeEnum&gt; dbContext = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(DBTypeEnum dbType)</span> &#123;</span><br><span class="line">        dbContext.set(dbType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DBTypeEnum <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dbContext.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">master</span><span class="params">()</span> &#123;</span><br><span class="line">        set(DBTypeEnum.MASTER);</span><br><span class="line">        log.info(<span class="string">&quot;åˆ‡æ¢åˆ°masteråº“&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">slave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//  è¯»åº“è´Ÿè½½å‡è¡¡(è½®è¯¢æ–¹å¼)</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> counter.getAndIncrement() % <span class="number">2</span>;</span><br><span class="line">        log.info(<span class="string">&quot;slaveåº“è®¿é—®çº¿ç¨‹æ•°==&gt;&#123;&#125;&quot;</span>, counter.get());</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE1);</span><br><span class="line">            log.info(<span class="string">&quot;åˆ‡æ¢åˆ°slave1åº“&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            set(DBTypeEnum.SLAVE2);</span><br><span class="line">            log.info(<span class="string">&quot;åˆ‡æ¢åˆ°slave2åº“&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4. æ•°æ®åº“æšä¸¾ç±» DBTypeEnum.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“æšä¸¾ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">DBTypeEnum</span> &#123;</span><br><span class="line">    MASTER, <span class="comment">//ä¸»åº“</span></span><br><span class="line">    SLAVE1, <span class="comment">//ä»åº“1</span></span><br><span class="line">    SLAVE2  <span class="comment">//ä»åº“2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬é…ç½®ä¸‰ä¸ªåº“ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªå†™åº“ Masterï¼Œ2 ä¸ªè¯»åº“ slave1,slave2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ•°æ®åº“é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfigs</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.master&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">masterDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave1DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource.slave2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">slave2DataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">myRoutingDataSource</span><span class="params">(<span class="meta">@Qualifier(&quot;masterDataSource&quot;)</span> DataSource masterDataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave1DataSource&quot;)</span> DataSource slave1DataSource,</span></span><br><span class="line"><span class="params">                                          <span class="meta">@Qualifier(&quot;slave2DataSource&quot;)</span> DataSource slave2DataSource)</span> &#123;</span><br><span class="line">        Map&lt;Object, Object&gt; targetDataSources = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        targetDataSources.put(DBTypeEnum.MASTER, masterDataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE1, slave1DataSource);</span><br><span class="line">        targetDataSources.put(DBTypeEnum.SLAVE2, slave2DataSource);</span><br><span class="line">        <span class="type">RoutingDataSource</span> <span class="variable">routingDataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoutingDataSource</span>();</span><br><span class="line">        routingDataSource.setDefaultTargetDataSource(masterDataSource);</span><br><span class="line">        routingDataSource.setTargetDataSources(targetDataSources);</span><br><span class="line">        <span class="keyword">return</span> routingDataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6. åˆ‡é¢ç±» DataSourceAop.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * åˆ‡é¢ç±»DataSourceAop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAop</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.insert*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.create*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.save*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.add*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.update*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.edit*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.delete*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.remove*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writePointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;!@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;&amp;&amp; (execution(* com.example.demo.*.service..*.select*(..)) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.list*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.count*(..))&quot; +</span></span><br><span class="line"><span class="meta">            &quot;|| execution(* com.example.demo.*.service..*.get*(..)))&quot;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readPointcut</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;writePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.master();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;readPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        DBContext.slave();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>7. æ³¨è§£ç±» Master.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Auther</span>: Brath</span></span><br><span class="line"><span class="comment"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class="line"><span class="comment"> * Strive to create higher performance code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> wechat: 17604868415</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> QQ: 2634490675</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class="line"><span class="comment"> * æ³¨è§£ç±»Master ä¸»åº“ï¼Œå¯è¯»å†™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Master &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-18T23:25:31.000Z" title="2020-12-19 7:25:31">2020-12-19</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-03-06T00:33:09.000Z" title="2023-3-6 8:33:09">2023-03-06</time>æ›´æ–°</span><span class="level-item">12 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1779ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/19/%E3%80%90Nginx%E3%80%91Nginx%E4%BB%A5%E5%8F%8Akeepalived%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/">Nginxä»¥åŠKeepalivedå®‰è£…ä»¥åŠéƒ¨ç½²</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>â€‹		åå‘ä»£ç†ï¼šæŒ‡çš„æ˜¯ç”¨æˆ·è¦è®¿é—® youtube, ä½†æ˜¯ youtube æ‚„æ‚„åœ°æŠŠè¿™ä¸ªè¯·æ±‚äº¤ç»™åå° N å°æœåŠ¡å™¨ä¸­çš„å…¶ä¸­ä¸€å°æ¥åšï¼Œè¿™ç§æ–¹å¼å°±æ˜¯åå‘ä»£ç†äº†ã€‚</p>
<p>â€‹		è´Ÿè½½å‡è¡¡ï¼š</p>
<p>1) ä½¿ç”¨ç¡¬ä»¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå¦‚ä½¿ç”¨ F5,Array ç­‰è´Ÿè½½å‡è¡¡å™¨.</p>
<p>2) ä½¿ç”¨è½¯ä»¶è¿›è¡Œè´Ÿè½½å‡è¡¡<br>
 3) å¦‚ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨å‡è¡¡ SLB<br>
4) ä½¿ç”¨æˆ‘ä»¬ä»Šå¤©æ‰€å­¦ä¹ çš„ Nginx+Keepalived<br>
5) å…¶ä»–è½¯ä»¶è´Ÿè½½å‡è¡¡å¦‚ LVS (Linux Virtual Server),haproxy ç­‰æŠ€æœ¯</p>
<h3 id="ç¯å¢ƒæ­å»º"><a class="markdownIt-Anchor" href="#ç¯å¢ƒæ­å»º">#</a> ç¯å¢ƒæ­å»ºï¼š</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">æ­¥éª¤:</span><br><span class="line"><span class="number">1.</span>è¿›è¡Œå®‰è£…:tar -zxvf /root/software/nginx-<span class="number">1.6</span><span class="number">.2</span>.tar.gz -C /usr/local/</span><br><span class="line"><span class="number">2.</span>ä¸‹è½½æ‰€éœ€è¦çš„ä¾èµ–åº“æ–‡ä»¶:</span><br><span class="line">   yum install pcre -y</span><br><span class="line">   yum install pcre-devel -y</span><br><span class="line">   yum install zlib -y</span><br><span class="line">   yum install zlib-devel -y</span><br><span class="line"><span class="number">3.</span>è¿›è¡Œconfigureé…ç½®,æŸ¥çœ‹æ˜¯å¦æŠ¥é”™</span><br><span class="line">   cd nginx-<span class="number">1.6</span><span class="number">.2</span></span><br><span class="line">   ./configure --prefix=/usr/local/nginx</span><br><span class="line"><span class="number">4.</span>ç¼–è¯‘å®‰è£…:make &amp;&amp; make install</span><br><span class="line"><span class="number">5.</span>åœ¨ /usr/local/nginxç›®å½•ä¸‹,å¯ä»¥çœ‹åˆ°å¦‚ä¸‹<span class="number">4</span>ä¸ªç›®å½•</span><br><span class="line">   confé…ç½®æ–‡ä»¶,htmlç½‘é¡µæ–‡ä»¶,logsæ—¥å¿—æ–‡ä»¶,sbinä¸»è¦äºŒè¿›åˆ¶ç¨‹åº</span><br><span class="line"><span class="number">6.</span>å¯åŠ¨å‘½ä»¤:/usr/local/nginx/sbin/nginx</span><br><span class="line">  å…³é—­å‘½ä»¤:/usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">  é‡å¯å‘½ä»¤:/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line"><span class="number">7.</span>è®¿é—®æµè§ˆå™¨:http:<span class="comment">//192.168.122.133(çœ‹åˆ°æ¬¢è¿é¡µé¢è¯´æ˜æ²¡é—®é¢˜)</span></span><br><span class="line"></span><br><span class="line">æ³¨æ„:å¦‚æœå‡ºç°è¿™ä¸ªé”™è¯¯:./configure: error: C compiler cc is not found</span><br><span class="line">æ‰§è¡Œè¿™ä¸ªå‘½ä»¤:yum -y install gcc gcc-c++ autoconf automake make</span><br></pre></td></tr></table></figure>
<p>Keepalivedï¼š</p>
<p>é¦–å…ˆä»‹ç»ä¸€ä¸‹ Keepalived, å®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„æœåŠ¡å™¨é«˜å¯ç”¨æˆ–çƒ­å¤‡è§£å†³æ–¹æ¡ˆï¼ŒKeepalived ä¸»è¦é˜²æ­¢æœåŠ¡å™¨å•ç‚¹æ•…éšœçš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å…¶ä¸ Nginx çš„é…åˆå®ç° web æœåŠ¡å™¨ç«¯çš„é«˜å¯ç”¨.<br>
Keepalived ä»¥ VRRP åè®®ä¸ºå®ç°åŸºç¡€ï¼Œä½¿ç”¨ VRRP åè®®æ¥å®ç°é«˜å¯ç”¨æ€§ (HA).VRRP (Virtual Router Redundacy Protocol) åè®®ç”¨äºå®ç°è·¯ç”±å™¨å†—ä½™çš„åè®®ï¼ŒVRRP åè®®å°†ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨è®¾å¤‡è™šæ‹Ÿæˆä¸€ä¸ªè®¾å¤‡ï¼Œå‘å¤–æä¾›è™šæ‹Ÿè·¯ç”± IP (ä¸€ä¸ªæˆ–å¤šä¸ª)ã€‚</p>
<p>å®‰è£…ä»¥åŠéƒ¨ç½²ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬ä¸€æ­¥ï¼šå®‰è£…keepalivedä¾èµ–çš„åŒ…</span><br><span class="line">	yum install -y gcc</span><br><span class="line">    yum install -y openssl-devel</span><br><span class="line">	yum install -y libnl3-devel</span><br><span class="line">	yum install -y popt-devel</span><br><span class="line">	yum install -y iptables-devel</span><br><span class="line">	yum install -y libnfnetlink-devel</span><br><span class="line">	yum install -y psmisc</span><br><span class="line">ç¬¬äºŒæ­¥ï¼šç¼–è¯‘å®‰è£…keepalived</span><br><span class="line">	å°†keepalivedçš„å®‰è£…åŒ… ä¸Šä¼ åˆ°/usr/local/software ç›®å½•ä¸‹  </span><br><span class="line">	cd /usr/local/software</span><br><span class="line">	tar -zxvf keepalived-<span class="number">1.2</span><span class="number">.19</span>.tar.gz -C /usr/local  </span><br><span class="line">	cd /usr/local/keepalived-<span class="number">1.2</span><span class="number">.19</span>  </span><br><span class="line">	./configure --prefix=/usr/local/keepalived  </span><br><span class="line">	make &amp;&amp; make install </span><br><span class="line">ç¬¬ä¸‰æ­¥ï¼šå°† keepalived å®‰è£…æˆ Linux ç³»ç»ŸæœåŠ¡</span><br><span class="line">	å®‰è£…å®Œæˆä¹‹åï¼Œ éœ€è¦åšä¸€äº›å·¥ä½œå¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶åˆ° é»˜è®¤è·¯å¾„  </span><br><span class="line">	mkdir /etc/keepalived  </span><br><span class="line">	cp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/  </span><br><span class="line">	cp /usr/local/keepalived/sbin/keepalived /usr/sbin/  </span><br><span class="line">	cp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/  </span><br><span class="line">	cd /usr/local/keepalived-<span class="number">1.2</span><span class="number">.19</span>  </span><br><span class="line">	cp ./keepalived/etc/init.d/keepalived.init /etc/init.d/</span><br><span class="line">	chmod <span class="number">755</span> /etc/init.d/keepalived.init </span><br><span class="line">ç¬¬å››æ­¥ï¼šç¼–å†™nginxæ£€æµ‹è„šæœ¬:</span><br><span class="line">vi /etc/keepalived/nginx_check.sh</span><br><span class="line">å†…å®¹å¦‚ä¸‹ï¼š  </span><br><span class="line">#!/bin/bash  </span><br><span class="line">A=`ps -C nginx â€“no-header |wc -l`  </span><br><span class="line"><span class="keyword">if</span> [ $A -eq <span class="number">0</span> ];then  </span><br><span class="line">    /usr/local/nginx/sbin/nginx  </span><br><span class="line">    sleep <span class="number">2</span>  </span><br><span class="line">    <span class="keyword">if</span> [ `ps -C nginx --no-header |wc -l` -eq <span class="number">0</span> ];then  </span><br><span class="line">        killall keepalived  </span><br><span class="line">    fi  </span><br><span class="line">fi  </span><br><span class="line">èµ‹äºˆæ‰§è¡Œæƒé™  </span><br><span class="line">chmod +x /etc/keepalived/nginx_check.sh </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯åŠ¨å‘½ä»¤:</span><br><span class="line">  keepalived</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ Master é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹keepalivedçš„Masteré…ç½®æ–‡ä»¶:vi /etc/keepalived/keepalived.conf </span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived       </span><br><span class="line">global_defs &#123;      </span><br><span class="line">   router_id wolfcode                           ##è·¯ç”±å™¨æ ‡å¿—    </span><br><span class="line">&#125;    </span><br><span class="line"># é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆtrack_scriptè¿›è¡Œ    </span><br><span class="line">vrrp_script check_haproxy &#123;    </span><br><span class="line">	script <span class="string">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„  </span><br><span class="line">	interval <span class="number">2</span>  #æ£€æµ‹æ—¶é—´é—´éš”  </span><br><span class="line">	weight -<span class="number">20</span>  #æ¡ä»¶æˆç«‹ æƒé‡å‡<span class="number">20</span>  </span><br><span class="line">&#125;    </span><br><span class="line">vrrp_instance PROXY &#123;    </span><br><span class="line">	# è®¾ç½®å½“å‰ä¸»æœºä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¤‡ç”¨èŠ‚ç‚¹ï¼Œåˆ™è®¾ç½®ä¸ºBACKUP   </span><br><span class="line">	state MASTER</span><br><span class="line">	# æŒ‡å®šHAç›‘æµ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥ç”¨ifconfigæŸ¥çœ‹æ¥å†³å®šè®¾ç½®å“ªä¸€ä¸ª    </span><br><span class="line">	<span class="keyword">interface</span> <span class="title class_">ens32</span></span><br><span class="line">	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹è¦ä½¿ç”¨åŒä¸€ä¸ªæ ‡è¯†ï¼Œä¸»å¤‡æœº    </span><br><span class="line">	virtual_router_id <span class="number">80</span>    </span><br><span class="line">	# å› ä¸ºå½“å‰ç¯å¢ƒä¸­VRRPç»„æ’­æœ‰é—®é¢˜ï¼Œæ”¹ä¸ºä½¿ç”¨å•æ’­å‘é€VRRPæŠ¥æ–‡  å¦‚æœVRRPç»„æ’­æ²¡é—®é¢˜ï¼Œä»¥ä¸‹è¿™å—çš„å†…å®¹å¯ä»¥æ³¨é‡Šæ‰ã€‚  </span><br><span class="line">	# è¿™ä¸ªåœ°æ–¹éœ€è¦å…³æ³¨ï¼Œä¹‹å‰æœªåšæ­¤è®¾ç½®ï¼Œç»“æœä¸»å¤‡èŠ‚ç‚¹äº’ç›¸ä¸èƒ½å‘ç°ï¼Œå› æ­¤ä¸»å¤‡èŠ‚ç‚¹éƒ½å‡çº§æˆäº†MASTERï¼Œå¹¶ä¸”ç»‘å®šäº†VIP    </span><br><span class="line">	# ä¸»èŠ‚ç‚¹æ—¶ï¼Œå†…å®¹ä¸ºï¼š    </span><br><span class="line">	unicast_src_ip <span class="number">192.168</span><span class="number">.122</span><span class="number">.133</span></span><br><span class="line">	# è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿ä¸»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§é«˜è¿‡å¤‡ç”¨èŠ‚ç‚¹  </span><br><span class="line">	priority <span class="number">100</span>    </span><br><span class="line">	# ç”¨äºè®¾å®šä¸»å¤‡èŠ‚ç‚¹é—´åŒæ­¥æ£€æŸ¥æ—¶é—´é—´éš”    </span><br><span class="line">	advert_int <span class="number">2</span>    </span><br><span class="line">	# è®¾ç½®ä¸»å¤‡èŠ‚ç‚¹é—´çš„é€šä¿¡éªŒè¯ç±»å‹åŠå¯†ç ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹ä¸­éœ€ä¸€è‡´    </span><br><span class="line">	authentication &#123;    </span><br><span class="line">		auth_type PASS    </span><br><span class="line">		auth_pass wolfcode</span><br><span class="line">	&#125;    </span><br><span class="line">	# é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆvrrp_scriptè¿›è¡Œ    </span><br><span class="line">	track_script &#123;    </span><br><span class="line">		check_haproxy    </span><br><span class="line">	&#125;    </span><br><span class="line">	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå½“keepalivedçŠ¶æ€åˆ‡æ¢ä¸ºMASTERæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿä¸­    </span><br><span class="line">	# å½“çŠ¶æ€åˆ‡æ¢åˆ°BACKUPæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨ä»ç³»ç»Ÿä¸­åˆ é™¤    </span><br><span class="line">	# å¯ä»¥é€šè¿‡å‘½ä»¤ip addæŸ¥çœ‹åˆ‡æ¢åçš„çŠ¶æ€    </span><br><span class="line">	virtual_ipaddress &#123;    </span><br><span class="line">		<span class="number">192.168</span><span class="number">.122</span><span class="number">.110</span>  #è™šæ‹Ÿipé…ç½®å®Œä¹‹åå°±ç”¨å®ƒè®¿é—®    </span><br><span class="line">	&#125;    </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ Slave é…ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">ä¿®æ”¹keepalivedçš„Slaveé…ç½®æ–‡ä»¶:vi /etc/keepalived/keepalived.conf </span><br><span class="line">! Configuration File <span class="keyword">for</span> keepalived       </span><br><span class="line">global_defs &#123;      </span><br><span class="line">   router_id wolfcode                           ##è·¯ç”±å™¨æ ‡å¿—    </span><br><span class="line">&#125;    </span><br><span class="line"># é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆtrack_scriptè¿›è¡Œ    </span><br><span class="line">vrrp_script check_haproxy &#123;    </span><br><span class="line">	script <span class="string">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #æ£€æµ‹ nginx çŠ¶æ€çš„è„šæœ¬è·¯å¾„  </span><br><span class="line">	interval <span class="number">2</span>  #æ£€æµ‹æ—¶é—´é—´éš”  </span><br><span class="line">	weight -<span class="number">20</span>  #æ¡ä»¶æˆç«‹ æƒé‡å‡<span class="number">20</span>  </span><br><span class="line">&#125;    </span><br><span class="line">vrrp_instance PROXY &#123;    </span><br><span class="line">	# è®¾ç½®å½“å‰ä¸»æœºä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯å¤‡ç”¨èŠ‚ç‚¹ï¼Œåˆ™è®¾ç½®ä¸ºBACKUP   </span><br><span class="line">	state BACKUP</span><br><span class="line">	# æŒ‡å®šHAç›‘æµ‹ç½‘ç»œæ¥å£ï¼Œå¯ä»¥ç”¨ifconfigæŸ¥çœ‹æ¥å†³å®šè®¾ç½®å“ªä¸€ä¸ª    </span><br><span class="line">	<span class="keyword">interface</span> <span class="title class_">ens32</span></span><br><span class="line">	# è™šæ‹Ÿè·¯ç”±æ ‡è¯†ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹è¦ä½¿ç”¨åŒä¸€ä¸ªæ ‡è¯†ï¼Œä¸»å¤‡æœº    </span><br><span class="line">	virtual_router_id <span class="number">80</span>    </span><br><span class="line">	# å› ä¸ºå½“å‰ç¯å¢ƒä¸­VRRPç»„æ’­æœ‰é—®é¢˜ï¼Œæ”¹ä¸ºä½¿ç”¨å•æ’­å‘é€VRRPæŠ¥æ–‡  å¦‚æœVRRPç»„æ’­æ²¡é—®é¢˜ï¼Œä»¥ä¸‹è¿™å—çš„å†…å®¹å¯ä»¥æ³¨é‡Šæ‰ã€‚  </span><br><span class="line">	# è¿™ä¸ªåœ°æ–¹éœ€è¦å…³æ³¨ï¼Œä¹‹å‰æœªåšæ­¤è®¾ç½®ï¼Œç»“æœä¸»å¤‡èŠ‚ç‚¹äº’ç›¸ä¸èƒ½å‘ç°ï¼Œå› æ­¤ä¸»å¤‡èŠ‚ç‚¹éƒ½å‡çº§æˆäº†MASTERï¼Œå¹¶ä¸”ç»‘å®šäº†VIP    </span><br><span class="line">	# ä¸»èŠ‚ç‚¹æ—¶ï¼Œå†…å®¹ä¸ºï¼š    </span><br><span class="line">	unicast_src_ip <span class="number">192.168</span><span class="number">.122</span><span class="number">.134</span>  </span><br><span class="line">	# è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿ä¸»èŠ‚ç‚¹çš„ä¼˜å…ˆçº§é«˜è¿‡å¤‡ç”¨èŠ‚ç‚¹  </span><br><span class="line">	priority <span class="number">90</span>    </span><br><span class="line">	# ç”¨äºè®¾å®šä¸»å¤‡èŠ‚ç‚¹é—´åŒæ­¥æ£€æŸ¥æ—¶é—´é—´éš”    </span><br><span class="line">	advert_int <span class="number">2</span>    </span><br><span class="line">	# è®¾ç½®ä¸»å¤‡èŠ‚ç‚¹é—´çš„é€šä¿¡éªŒè¯ç±»å‹åŠå¯†ç ï¼ŒåŒä¸€ä¸ªVRRPå®ä¾‹ä¸­éœ€ä¸€è‡´    </span><br><span class="line">	authentication &#123;    </span><br><span class="line">		auth_type PASS    </span><br><span class="line">		auth_pass wolfcode</span><br><span class="line">	&#125;    </span><br><span class="line">	# é›†ç¾¤èµ„æºç›‘æ§ï¼Œç»„åˆvrrp_scriptè¿›è¡Œ    </span><br><span class="line">	track_script &#123;    </span><br><span class="line">		check_haproxy    </span><br><span class="line">	&#125;    </span><br><span class="line">	# è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œå½“keepalivedçŠ¶æ€åˆ‡æ¢ä¸ºMASTERæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç³»ç»Ÿä¸­    </span><br><span class="line">	# å½“çŠ¶æ€åˆ‡æ¢åˆ°BACKUPæ—¶ï¼Œæ­¤IPä¼šè‡ªåŠ¨ä»ç³»ç»Ÿä¸­åˆ é™¤    </span><br><span class="line">	# å¯ä»¥é€šè¿‡å‘½ä»¤ip addæŸ¥çœ‹åˆ‡æ¢åçš„çŠ¶æ€    </span><br><span class="line">	virtual_ipaddress &#123;    </span><br><span class="line">		<span class="number">192.168</span><span class="number">.122</span><span class="number">.110</span>  #è™šæ‹Ÿipé…ç½®å®Œä¹‹åå°±ç”¨å®ƒè®¿é—®    </span><br><span class="line">	&#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-16T11:20:47.000Z" title="2020-12-16 19:20:47">2020-12-16</time>å‘è¡¨</span><span class="level-item"><time dateTime="2019-10-28T12:16:44.000Z" title="2019-10-28 20:16:44">2019-10-28</time>æ›´æ–°</span><span class="level-item">3 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦493ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/16/%E3%80%90RocketMQ%E3%80%91Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%83%A8%E7%BD%B2RocketMQ%E4%BB%A5%E5%8F%8AConsole/">Dockerç¯å¢ƒä¸‹éƒ¨ç½²RocketMQä»¥åŠConsole</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dockerç¯å¢ƒä¸‹éƒ¨ç½²rocketmqä»¥åŠconsole"><a class="markdownIt-Anchor" href="#dockerç¯å¢ƒä¸‹éƒ¨ç½²rocketmqä»¥åŠconsole">#</a> Docker ç¯å¢ƒä¸‹éƒ¨ç½² RocketMQ ä»¥åŠ Console</h1>
<h2 id="1docker-å®‰è£…rocketmqé•œåƒ"><a class="markdownIt-Anchor" href="#1docker-å®‰è£…rocketmqé•œåƒ">#</a> 1.docker å®‰è£… rocketmq é•œåƒ</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#æ‹‰å–é•œåƒ </span><br><span class="line">docker pull foxiswho/rocketmq:server-4.7.0</span><br><span class="line">docker pull foxiswho/rocketmq:broker-4.7.0</span><br></pre></td></tr></table></figure>
<h2 id="2åˆ›å»ºserverå’Œbrokerç›®å½•å¹¶åœ¨ç›®å½•optä¸‹åˆ›å»ºbrokerconf"><a class="markdownIt-Anchor" href="#2åˆ›å»ºserverå’Œbrokerç›®å½•å¹¶åœ¨ç›®å½•optä¸‹åˆ›å»ºbrokerconf">#</a> 2. åˆ›å»º server å’Œ broker ç›®å½•ï¼Œå¹¶åœ¨ç›®å½• /opt ä¸‹åˆ›å»º broker.conf</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºç›®å½•</span></span><br><span class="line">mkdir /opt/rocketmq-server</span><br><span class="line">mkdir /opt/rocketmq-broker/conf -p</span><br><span class="line">[root@localhost opt]# cat /opt/rocketmq-broker/conf/broker.conf </span><br><span class="line">namesrvAddr=ã€ä½ çš„IPåœ°å€ã€‘:9876</span><br><span class="line">brokerClusterName = DefaultCluster</span><br><span class="line">brokerName = broker-a</span><br><span class="line">brokerId = 0</span><br><span class="line">deleteWhen = 04</span><br><span class="line">fileReservedTime = 48</span><br><span class="line">brokerRole = ASYNC_MASTER</span><br><span class="line">flushDiskType = ASYNC_FLUSH</span><br><span class="line">brokerIP1 = ã€ä½ çš„IPåœ°å€ã€‘</span><br><span class="line">listenPort=10911</span><br></pre></td></tr></table></figure>
<h2 id="3å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£-9876-10911-11011"><a class="markdownIt-Anchor" href="#3å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£-9876-10911-11011">#</a> 3. å¯åŠ¨å®¹å™¨å¹¶åœ¨é˜²ç«å¢™æ”¾è¡Œç«¯å£ 9876 ã€10911 ã€11011</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">RocketMQé»˜è®¤ä½¿ç”¨3ä¸ªç«¯å£ï¼š9876 ã€10911 ã€11011</span><br><span class="line">å¦‚æœé˜²ç«å¢™æ²¡æœ‰å…³é—­çš„è¯ï¼Œé‚£ä¹ˆé˜²ç«å¢™å°±å¿…é¡»å¼€æ”¾è¿™äº›ç«¯å£ï¼š</span><br><span class="line">nameserver é»˜è®¤ä½¿ç”¨ 9876 ç«¯å£</span><br><span class="line">master é»˜è®¤ä½¿ç”¨ 10911 ç«¯å£</span><br><span class="line">slave é»˜è®¤ä½¿ç”¨11011 ç«¯å£</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨rocketmq-server</span></span><br><span class="line">docker run -d \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqnamesrv \</span><br><span class="line">-p 9876:9876 \</span><br><span class="line">-v /opt/rocketmq-server/logs:/root/logs \</span><br><span class="line">-v /opt/rocketmq-server/store:/root/store \</span><br><span class="line">-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \</span><br><span class="line">foxiswho/rocketmq:4.7.0 \</span><br><span class="line">sh mqnamesrv</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨rocketmq-broker</span></span><br><span class="line">docker run -d  \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqbroker \</span><br><span class="line">--link rmqnamesrv:namesrv \</span><br><span class="line">-p 10911:10911 \</span><br><span class="line">-p 10909:10909 \</span><br><span class="line">-v  /opt/rocketmq-broker/logs:/root/logs \</span><br><span class="line">-v  /opt/rocketmq-broker/store:/root/store \</span><br><span class="line">-v /opt/rocketmq-broker/conf/broker.conf:/opt/rocketmq-broker/conf/broker.conf \</span><br><span class="line">-e &quot;NAMESRV_ADDR=ã€ä½ çš„IPåœ°å€ã€‘:9876&quot; \</span><br><span class="line">-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \</span><br><span class="line">-e &quot;autoCreateTopicEnable=true&quot; \</span><br><span class="line">foxiswho/rocketmq:4.7.0 \</span><br><span class="line">sh mqbroker -c /opt/rocketmq-broker/conf/broker.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">å¯åŠ¨RocketMQçš„ç®¡ç†å·¥å…·rocketmq-console</span></span><br><span class="line">docker run -itd -e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=ã€ä½ çš„IPåœ°å€ã€‘:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; -p 9877:8080 -t styletang/rocketmq-console-ng:latest</span><br></pre></td></tr></table></figure>
<h2 id="4æµ‹è¯•è®¿é—®consoleæ§åˆ¶å°"><a class="markdownIt-Anchor" href="#4æµ‹è¯•è®¿é—®consoleæ§åˆ¶å°">#</a> 4. æµ‹è¯•è®¿é—® console æ§åˆ¶å°</h2>
<p>æµè§ˆå™¨è¾“å…¥ï¼š192.168.1.200:9877</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230104082814121.png" alt="image-20230104082814121"></p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-10T19:36:11.000Z" title="2020-12-11 3:36:11">2020-12-11</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-10-27T19:44:36.000Z" title="2022-10-28 3:44:36">2022-10-28</time>æ›´æ–°</span><span class="level-item">35 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦5295ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/11/%E3%80%90Java%E3%80%91Elastic%20canal%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E5%88%B0ES%E9%85%8D%E7%BD%AE%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99/">ã€Javaã€‘Elastic canalæ•°æ®åŒæ­¥åˆ°ESé…ç½®å¸¸è§æŠ¥é”™</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javaelastic-canalæ•°æ®åŒæ­¥åˆ°esé…ç½®å¸¸è§æŠ¥é”™"><a class="markdownIt-Anchor" href="#javaelastic-canalæ•°æ®åŒæ­¥åˆ°esé…ç½®å¸¸è§æŠ¥é”™">#</a> ã€Javaã€‘Elastic canal æ•°æ®åŒæ­¥åˆ° ES é…ç½®å¸¸è§æŠ¥é”™</h1>
<h1 id="0-å¼•è¨€"><a class="markdownIt-Anchor" href="#0-å¼•è¨€">#</a> 0. å¼•è¨€</h1>
<p>æ‰€æœ‰æŠ¥é”™å‡ä¸ºåšä¸»åœ¨å®æ“è¿‡ç¨‹ä¸­é‡åˆ°çš„é”™è¯¯å’Œè§£å†³åŠæ³•ï¼Œå¦‚æœæœ‰å…¶ä»–æŠ¥é”™æˆ–è€…ä¸åŒçš„è§£å†³åŠæ³•ï¼Œè¯·ç•™è¨€å‘Šè¯‰æˆ‘</p>
<p>å®‰è£…<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=canal&amp;spm=1001.2101.3001.7020"> canal</a> è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå…ˆåœ¨æœ¬æ–‡ä¸­æŸ¥è¯¢æ˜¯å¦æœ‰ç›¸åŒæŠ¥é”™ï¼Œå°†ä¼šä¸ºä½ èŠ‚çº¦å¤§é‡æ’é”™æ—¶é—´</p>
<h2 id="ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#ç¯å¢ƒ">#</a> ç¯å¢ƒ</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdk1.8</span><br><span class="line">canal 1.1.5</span><br><span class="line">mysql8.0</span><br><span class="line">es7.13.0</span><br></pre></td></tr></table></figure>
<h1 id="1-unknown-system-variable-query_cache_size"><a class="markdownIt-Anchor" href="#1-unknown-system-variable-query_cache_size">#</a> 1. Unknown system variable â€˜query_cache_sizeâ€™</h1>
<p>è¿™æ˜¯å› ä¸º<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql%E9%A9%B1%E5%8A%A8&amp;spm=1001.2101.3001.7020"> mysql é©±åŠ¨</a>åŒ…çš„ç‰ˆæœ¬è¿‡ä½å¯¼è‡´çš„ï¼Œquery cache åœ¨ MySQL5.7.20 å°±å·²ç»è¿‡æ—¶äº†ï¼Œè€Œåœ¨ MySQL8.0 ä¹‹åå°±å·²ç»è¢«ç§»é™¤äº†</p>
<p>1ã€åªéœ€è¦å°† lib ä¸­çš„é©±åŠ¨å™¨æ›¿æ¢æˆ mysql-connector-java-8.0.22.jar</p>
<p>2ã€ä¿®æ”¹é©±åŠ¨å™¨æƒé™</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 lib/mysql-connector-java-8.0.22.jar</span><br><span class="line">chmod +st lib/mysql-connector-java-8.0.22.jar</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹æƒé™å¦‚å›¾æ‰€ç¤º</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll lib</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/fb4993202deb4227a295dc8ffcfffafb.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring"><a class="markdownIt-Anchor" href="#2-reason-no-converter-found-capable-of-converting-from-type-javalangstring-to-type-javautilmapjavalangstring-javalangstring">#</a> 2. Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</h1>
<p>å¯åŠ¨ canal-adapter æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf.canal-adapters[0].groups[0].outer-adapters[1].properties&#x27; to java.util.Map&lt;java.lang.String, java.lang.String&gt;:</span><br><span class="line"></span><br><span class="line">    Reason: No converter found capable of converting from type [java.lang.String] to type [java.util.Map&lt;java.lang.String, java.lang.String&gt;]</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
è§‚å¯ŸæŠ¥é”™ä¿¡æ¯å¯ä»¥å¾—çŸ¥æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ outer2ï¼ˆ0 åŸºï¼Œæ‰€ä»¥ outer-adapter [1] å®é™…æŒ‡çš„æ˜¯ 2ï¼‰çš„ properties é…ç½®æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬è§‚å¯Ÿé…ç½®æ–‡ä»¶ï¼Œå‘ç°æ˜¯ properties ä¸‹çš„ mode,cluster.name ç­‰å±æ€§ä¸ properties åŒçº§äº†ï¼Œå°†å…¶å¦‚ä¸‹å›¾æ‰€ç¤ºåé€€ä¸¤å­—ç¬¦å³å¯ã€‚<br>
<img src="https://img-blog.csdnimg.cn/f5384eaf97234881bba9b3c8bcd663da.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="é…ç½®"></p>
<h1 id="3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx"><a class="markdownIt-Anchor" href="#3-runtimeexception-javalangruntimeexception-no-data-source-found-xxxx">#</a> 3. RuntimeException: java.lang.RuntimeException: No data source found: xxxx</h1>
<p>è¿™ä¸ªå› ä¸ºåœ¨ conf/es/xxx.yml ä¸­é…ç½®çš„ dataSourceKey å¹¶æ²¡æœ‰åœ¨ conf/application.yml ä¸­çš„ srcDataSources ä¸­ç»´æŠ¤</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œes ä¸­çš„ dataSourceKey éœ€è¦åœ¨ applicaiton.yml ä¸­è®¾ç½®ï¼Œé»˜è®¤æ˜¯ defaultDS<br>
<img src="https://img-blog.csdnimg.cn/14dacccf628d44e7b6f67c52bccdb93e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://img-blog.csdnimg.cn/5e57dd86bcb8417e9e7eda2a6d014956.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="4-reason-unable-to-set-value-for-property-src-data-sources"><a class="markdownIt-Anchor" href="#4-reason-unable-to-set-value-for-property-src-data-sources">#</a> 4. Reason: Unable to set value for property src-data-sources</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to bind properties under &#x27;canal.conf&#x27; to com.alibaba.otter.canal.adapter.launcher.config.AdapterCanalConfig:</span><br><span class="line"></span><br><span class="line">    Reason: Unable to set value for property src-data-sources</span><br></pre></td></tr></table></figure>
<p>åŸå› ä¸€ï¼š<br>
mysql é©±åŠ¨å™¨å¯¼è‡´çš„é—®é¢˜ï¼Œä½¿ç”¨çš„æ•°æ®åº“æ˜¯ 8.xã€‚é©±åŠ¨å™¨æ˜¯ 5.x çš„ï¼Œå°† mysql é©±åŠ¨æ›¿æ¢ä¸º 8.0.x ç‰ˆæœ¬çš„ã€‚å¦‚ä¸Šæ‰€ç¤ºæŠ¥é”™ 1</p>
<p>åŸå› äºŒï¼š<br>
æ£€æŸ¥è¯¥æŠ¥é”™å‰çš„æ—¥å¿—ï¼Œæ˜¯å¦æœ‰å…¶ä»–ç›¸å…³æŠ¥é”™ä¿¡æ¯ï¼Œæ¯”å¦‚æ— ç›¸å…³æ•°æ®åº“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ ¹æ®å…¶æŠ¥é”™å†…å®¹æ¥æ£€æŸ¥é…ç½®é¡¹å¹¶ä¸”è°ƒæ•´å³å¯<br>
<img src="https://img-blog.csdnimg.cn/fbf719ab834648f9adfa37c65e402d71.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h1 id="5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts"><a class="markdownIt-Anchor" href="#5-javasqlsqlexception-null-message-from-server-host-172161882-is-blocked-because-of-many-connection-errors-unblock-with-mysqladmin-flush-hosts">#</a> 5. java.sql.SQLException: null, message from server: â€œHost â€˜172.16.188.2â€™ is blocked because of many connection errors; unblock with â€˜mysqladmin flush-hostsâ€™â€</h1>
<p>åŒä¸€ä¸ª ip åœ¨çŸ­æ—¶é—´å†…äº§ç”Ÿå¤ªå¤šä¸­æ–­çš„æ•°æ®åº“è¿æ¥è€Œå¯¼è‡´çš„é˜»å¡</p>
<p>ç™»å½•å¯¹åº”çš„ mysqlï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush hosts;</span><br></pre></td></tr></table></figure>
<h1 id="6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found"><a class="markdownIt-Anchor" href="#6-illegalstateexception-extension-instancename-es7-class-interface-comalibabaottercanalclientadapterouteradapter-could-not-be-instantiated-class-could-not-be-found">#</a> 6. IllegalStateException: Extension instance(name: es7, class: interface com.alibaba.otter.canal.client.adapter.OuterAdapter) could not be instantiated: class could not be found</h1>
<p>ä¸€èˆ¬ <code> could not be instantiated: class could not be found</code>  è¿™æ ·çš„æŠ¥é”™æ˜¯é…ç½®æ–‡ä»¶çš„é—®é¢˜ï¼Œå¦‚ä¸Šçš„æŠ¥é”™å¯ä»¥çœ‹åˆ°æ˜¯ name: es7 ä¸­çš„é”™è¯¯ï¼Œåœ¨å®˜æ–¹çš„ç¤ºä¾‹æ–‡æ¡£ä¸­ä½¿ç”¨çš„æ˜¯ <code>name: es6 # or es7</code> ã€‚</p>
<p>åœ¨ canal1.1.5 + ç‰ˆæœ¬ä¸­è®¾ç½®çš„æ˜¯ name: es6 # æˆ–è€… es7</p>
<p>ä½†åœ¨ 1.1.4 ç‰ˆæœ¬ä¸­ç›´æ¥ä½¿ç”¨ <code>name: es</code>  å³å¯</p>
<h1 id="7-illegalargumentexception-not-found-the-mapping-info-of-index-user"><a class="markdownIt-Anchor" href="#7-illegalargumentexception-not-found-the-mapping-info-of-index-user">#</a> 7. IllegalArgumentException: Not found the mapping info of index: user</h1>
<p>1ã€è¿™ä¸ªæŠ¥é”™æ˜¯ ES çš„ mapping è®¾ç½®çš„é—®é¢˜ï¼Œç¡®ä¿ es ä¸­æœ‰è¯¥ç´¢å¼•ï¼Œå¹¶ä¸”ç¡®è®¤æ˜¯å¦æœ‰éƒ¨åˆ†å­—æ®µæ²¡æœ‰åœ¨ es ä¸­è®¾ç½® mapping, è¿™ä¸ªè¦å¯¹åº”ä¹‹å‰è®¾ç½®çš„ sqlï¼Œä»¥åŠ es ä¸­çš„ mappings æ¥è§£å†³</p>
<p>2ã€ä½¿ç”¨äº† elasticsearch 7.xï¼Œä½† adapter1.1.4 é»˜è®¤æ”¯æŒ es6.x<br>
 è§£å†³æ–¹æ¡ˆï¼š<br>
ï¼ˆ1ï¼‰ä¿®æ”¹ adapter æºç ï¼Œå°† es ä¾èµ–è°ƒæ•´ä¸º 7.xï¼›å‚è€ƒåšå®¢<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/355162399"> adapter1.1.4 ä¿®æ”¹æºç æ”¯æŒ es7.x</a><br>
ï¼ˆ2ï¼‰æ¢æˆ adapter1.1.5</p>
<h1 id="8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200"><a class="markdownIt-Anchor" href="#8-illegalargumentexception-illegal-character-in-scheme-name-at-index-0-1721618879200">#</a> 8. IllegalArgumentException: Illegal character in scheme name at index 0: 172.16.188.7:9200</h1>
<p>å¦‚æœè¿æ¥ es ä½¿ç”¨çš„æ˜¯ rest æ–¹å¼ï¼Œé‚£ä¹ˆ hosts ä¸­çš„ ip å‰è¦æ·»åŠ  <code>http://</code> ï¼Œå¦‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hosts: http://172.16.188.7:9200</span><br></pre></td></tr></table></figure>
<h1 id="9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource"><a class="markdownIt-Anchor" href="#9-comalibabadruidpooldruiddatasource-cannot-be-cast-to-comalibabadruidpooldruiddatasource">#</a> 9. com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: java.lang.RuntimeException: java.lang.ClassCastException: com.alibaba.druid.pool.DruidDataSource cannot be cast to com.alibaba.druid.pool.DruidDataSource</span><br><span class="line">	at com.alibaba.otter.canal.client.adapter.es7x.ES7xAdapter.init(ES7xAdapter.java:54) ~[client-adapter.es7x-1.1.5-jar-with-dependencies.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.loadAdapter(CanalAdapterLoader.java:225) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterLoader.init(CanalAdapterLoader.java:56) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at com.alibaba.otter.canal.adapter.launcher.loader.CanalAdapterService.init(CanalAdapterService.java:60) [client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:1.8.0_271]</span><br><span class="line">	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_271]</span><br><span class="line">	at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_271]</span><br></pre></td></tr></table></figure>
<p>åŸå› ï¼š<br>
druid åŒ…å†²çª<br>
è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ client-adapter/escore/pom.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">            &lt;!--add by whx 20220112--&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>2ã€é‡æ–°æ‰“åŒ…<br>
<img src="https://img-blog.csdnimg.cn/dfe52cef447444469af1020bf5328ef5.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
 3ã€å°† client-adapter/es7x/target/client-adapter.es7x-1.1.5-jar-with-dependencies.jar ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ›¿æ¢ adataper/plugin ä¸‹çš„åŒå jar æ–‡ä»¶<br>
<img src="https://img-blog.csdnimg.cn/eb3b4b46f8ab47d391244904ecb6e89e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp client-adapter.es7x-1.1.5-jar-with-dependencies.jar root@172.16.188.2:/var/local</span><br></pre></td></tr></table></figure>
<p>4ã€ç»™è¯¥æ–‡ä»¶èµ‹æƒ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/local/client-adapter.es7x-1.1.5-jar-with-dependencies.jar </span><br></pre></td></tr></table></figure>
<p>5ã€é‡å¯æœåŠ¡</p>
<h4 id="10-canalparseexception-javaioioexception-eof-encountered"><a class="markdownIt-Anchor" href="#10-canalparseexception-javaioioexception-eof-encountered">#</a> 10 CanalParseException: java.io.IOException: EOF encountered</h4>
<p>å°† lib ç›®å½•ä¸‹çš„ mysql é©±åŠ¨å™¨æ›¿æ¢ä¸º<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=mysql8&amp;spm=1001.2101.3001.7020"> mysql8</a>.0ï¼Œå¹¶é™„æƒã€‚å‚è€ƒä¸Šè¿°</p>
<h1 id="11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack"><a class="markdownIt-Anchor" href="#11-canalclientexception-javaioioexception-broken-pipe-error-sync-but-ack">#</a> 11. CanalClientException: java.io.IOException: Broken pipe Error sync but ACK</h1>
<p>æœåŠ¡è¿æ¥æ–­å¼€äº†ï¼Œå°† deployer å’Œ adapter éƒ½å…³é—­ï¼Œå…ˆå¯åŠ¨ deployer å†å¯åŠ¨ adapter</p>
<h1 id="12-documentmissingexception_doc1413298413755211778-document-missing"><a class="markdownIt-Anchor" href="#12-documentmissingexception_doc1413298413755211778-document-missing">#</a> 12. DocumentMissingException[[_doc][1413298413755211778]: document missing]</h1>
<p>1ã€es é›†ç¾¤å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´ doc æ— æ³•åˆ†é…ã€‚å¸¸è§çš„æ˜¯åˆ†ç‰‡æ•°çš„é—®é¢˜ï¼Œå¯èƒ½æ˜¯å‰¯æœ¬åˆ†ç‰‡è¿‡å¤šï¼Œå¯¼è‡´é›†ç¾¤æŠ¥é»„<br>
è§£å†³ï¼š<br>
å› ä¸ºæˆ‘çš„æ˜¯ es å•èŠ‚ç‚¹ï¼Œæ‰€ä»¥å°†ä¸»åˆ†ç‰‡æ•°è®¾ç½®ä¸º 1ï¼Œå‰¯æœ¬åˆ†ç‰‡è®¾ç½®ä¸º 0ã€‚ä¸ç”³æ˜çš„è¯é»˜è®¤åˆ›å»ºå‰¯æœ¬åˆ†ç‰‡æ•°ä¸º 1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">PUT user</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;code&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;email&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;realName&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;roleId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;postId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;deptId&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;fields&quot;: &#123;</span><br><span class="line">          &quot;keyword&quot;: &#123;</span><br><span class="line">            &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_replicas&quot;: 0,</span><br><span class="line">    &quot;number_of_shards&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2ã€ä¿®æ”¹çš„ mysql æ•°æ®åº“æ•°æ®ï¼Œåœ¨ es ä¸­ä¸å­˜åœ¨ã€‚å…ˆè¿›è¡Œå…¨é‡åŒæ­¥ï¼Œå†è¿›è¡Œå¢é‡åŒæ­¥</p>
<p>åœ¨ conf/example/instance.properties ä¸­ä¿®æ”¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># å…¨é‡åŒæ­¥</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 ä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception"><a class="markdownIt-Anchor" href="#13-error-caottercanalservernettyhandlersessionhandler-something-goes-wrong-with-channelid-0x23d9cad9-12700146472-12700111111-exceptionjavaniochannelsclosedchannelexception">#</a> 13. ERROR c.a.otter.canal.server.netty.handler.SessionHandler - something goes wrong with channel:[id: 0x23d9cad9, /127.0.0.1:46472 :&gt; /127.0.0.1:11111], exception=java.nio.channels.ClosedChannelException</h1>
<p>è¿™æ˜¯ç”±äº deployer ä¸­çš„ conf/example/meta.dat ä¸ instance.properties æ–‡ä»¶ä¸­çš„ journalName,position,timestamp ä¸ä¸€è‡´å¯¼è‡´çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢bin logä½ç½®</span><br><span class="line">show master status;</span><br><span class="line"># å¦‚æœæ˜¾ç¤ºçš„binlogä¸ä¸º000001å¯ä»¥æ‰§è¡Œä»¥ä¸‹è¯­å¥é‡ç½®binlogï¼ˆè½»æ˜“åˆ«æ“ä½œï¼Œæœ€å¥½è®©ä¸“ä¸šçš„è¿ç»´äººå‘˜æ“ä½œï¼‰</span><br><span class="line"># è¯¥æ“ä½œä¼šé‡æ–°ç”Ÿæˆbinlogï¼Œä¹‹å‰çš„binlogå°±ä¼šæ¸…ç©ºï¼Œä¹‹å‰çš„æ•°æ®å°±ä¸ä¼šå†åŒæ­¥</span><br><span class="line">reset master;</span><br><span class="line"># åˆ·æ–°logæ—¥å¿—ï¼Œè‡ªæ­¤åˆ»å¼€å§‹äº§ç”Ÿä¸€ä¸ªæ–°ç¼–å·çš„binlogæ—¥å¿—æ–‡ä»¶</span><br><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/849d7b41b8c348dead0670db96717068.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAd3VfNTU1NTU=,size_20,color_FFFFFF,t_70,g_se,x_16" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
å°† meta.dat åˆ é™¤æˆ–è€…ä¿®æ”¹ä¸€è‡´å³å¯ã€‚åˆ é™¤åå°†ä¼šæŒ‰ç…§ instance.properties ä¸­è®¾ç½®çš„èµ·ç‚¹åŒæ­¥ï¼Œç”Ÿäº§ç¯å¢ƒè€ƒè™‘å¥½éœ€è¦åå†åˆ é™¤ã€‚</p>
<p>å¦‚æœæƒ³è¦å°†ä¹‹å‰çš„æ•°æ®ä¹ŸåŒæ­¥çš„è¯ï¼Œå¯ä»¥å°†æ•°æ®åº“å…ˆå¯¼å‡ºï¼Œå†é‡æ–°å¯¼å…¥ä¸€éï¼Œå³å¯é‡æ–°ç”Ÿæˆ binlogï¼Œå®ç°æ•°æ®çš„å…¨é‡åŒæ­¥</p>
<h1 id="14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#14-received-error-packet-errno-1236-sqlstate-hy000-errmsg-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 14. Received error packet: errno = 1236, sqlstate = HY000 errmsg = Could not find first log file name in binary log index file</h1>
<p>mysql bin log æ•°æ®ä¸åŒæ­¥ï¼Œåˆ·æ–°ä¸€ä¸‹å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<h1 id="15-binlogä¹Ÿè®¾ç½®ä¸º000001äº†timestampä¹Ÿè®¾ç½®äº†ä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥"><a class="markdownIt-Anchor" href="#15-binlogä¹Ÿè®¾ç½®ä¸º000001äº†timestampä¹Ÿè®¾ç½®äº†ä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥">#</a> 15. binlog ä¹Ÿè®¾ç½®ä¸º 000001 äº†ï¼Œtimestamp ä¹Ÿè®¾ç½®äº†ï¼Œä½†å°±æ˜¯æ— æ³•å®ç°å…¨é‡åŒæ­¥</h1>
<p>1ã€åˆ é™¤ conf/example/meta.dat<br>
2ã€è°ƒæ•´ conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">#2019-01-01 00:00:00 ä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´</span><br><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<p>3ã€é‡å¯ deployer</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ bin log æ˜¯åªä¼šè®°å½•å¢é‡æ“ä½œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å¯ bin log ä¹‹å‰çš„å†å²æ•°æ®æ˜¯ä¸ä¼šè®°å½•çš„ï¼Œå¦‚æœéœ€è¦åŒæ­¥è€…ä¹‹å‰çš„æ•°æ®ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æœ‰ä¸‰ä¸ªåŠæ³•ï¼š<br>
ï¼ˆ1ï¼‰<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_24950043/article/details/122483061">é€šè¿‡ logstash-input-jdbc æ¥å®ç°</a><br>
ï¼ˆ2ï¼‰é€šè¿‡ä¸šåŠ¡ä»£ç æ¥å®ç°ï¼ˆåç»­ä¼šè¯¦ç»†è®²è§£è¿™ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥å…³æ³¨æˆ‘åç»­çš„åšå®¢ï¼‰<br>
ï¼ˆ3ï¼‰å¤åˆ¶åŸæ•°æ®åº“æ•°æ®åˆ°å¼€å¯äº† binlog çš„ä»æ•°æ®åº“ï¼Œç„¶åä»ä»æ•°æ®åº“åŒæ­¥</p>
<h1 id="16-adapterå¯åŠ¨æŠ¥é”™something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null"><a class="markdownIt-Anchor" href="#16-adapterå¯åŠ¨æŠ¥é”™something-goes-wrong-when-starting-up-the-canal-client-adapters-javalangnullpointerexception-null">#</a> 16. adapter å¯åŠ¨æŠ¥é”™ï¼šsomething goes wrong when starting up the canal client adapters: java.lang.NullPointerException: null</h1>
<p>è¿™ä¸ªæŠ¥é”™æ˜¯ç©ºæŒ‡é’ˆæŠ¥é”™ï¼Œå¾ˆæ˜æ˜¾æ˜¯å“ªé‡Œè·å–ä¸ºç©ºçš„ï¼Œè¿™ç§é”™è¯¯æ²¡æœ‰å›ºå®šçš„åŸå› ï¼Œä½†å¤§æ¦‚ç‡ä¸Šå¯ä»¥é”å®šé…ç½®æ–‡ä»¶çš„é—®é¢˜</p>
<p>1ã€adapter çš„é…ç½®æ–‡ä»¶ä¸­æ˜¯æœ‰åŒ…å«äº† mysqlã€esã€mqã€zk ç­‰é…ç½®ï¼Œå¦‚æœä¸éœ€è¦çš„é…ç½®é¡¹ï¼Œå°±å°†å…¶æ³¨é‡Šæ‰ï¼Œä¸è¦æ‰“å¼€</p>
<p>æ¯”å¦‚æˆ‘è¿™é‡Œçš„æŠ¥é”™åŸå› å°±æ˜¯å› ä¸ºæ‰“å¼€äº† zookeeperHostsï¼Œä½†æ˜¯æ²¡æœ‰é…ç½®å…·ä½“å€¼ï¼Œæ‰€ä»¥å¯¼è‡´äº†ç©ºæŒ‡é’ˆï¼Œå› ä¸ºæˆ‘ä¸éœ€è¦ zkï¼Œå°†å…¶æ³¨é‡Šæ‰å³å¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># flatMessage: true</span><br><span class="line"># zookeeperHosts:</span><br></pre></td></tr></table></figure>
<p>2ã€æŸäº›å¿…è¦çš„é…ç½®æ²¡æœ‰è®¾ç½®ï¼Œå¿«é€Ÿæ’æŸ¥çš„æ–¹å¼å°±æ˜¯æ ¹æ®å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„é…ç½®æ–‡ä»¶å¯¹æ¯”æ’é”™<br>
å¯ä»¥å‚è€ƒå¦‚ä¸‹é…ç½®æ–‡ä»¶</p>
<p>3ã€é…ç½®æ–‡ä»¶ä¸­é…ç½®é¡¹æ’ç‰ˆé”™ä½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  jackson:</span><br><span class="line">    date-format: yyyy-MM-dd HH:mm:ss</span><br><span class="line">    time-zone: GMT+8</span><br><span class="line">    default-property-inclusion: non_null</span><br><span class="line"></span><br><span class="line">canal.conf:</span><br><span class="line">  mode: tcp #tcp kafka rocketMQ rabbitMQ</span><br><span class="line">  flatMessage: true</span><br><span class="line">  zookeeperHosts:</span><br><span class="line">  syncBatchSize: 1000</span><br><span class="line">  retries: 0</span><br><span class="line">  timeout:</span><br><span class="line">  accessKey:</span><br><span class="line">  secretKey:</span><br><span class="line">  consumerProperties:</span><br><span class="line">    # canal tcp consumer</span><br><span class="line">    canal.tcp.server.host: 127.0.0.1:11111</span><br><span class="line">    canal.tcp.zookeeper.hosts:</span><br><span class="line">    canal.tcp.batch.size: 500</span><br><span class="line">    canal.tcp.username:</span><br><span class="line">    canal.tcp.password:</span><br><span class="line">    # kafka consumer</span><br><span class="line">    kafka.bootstrap.servers: 127.0.0.1:9092</span><br><span class="line">    kafka.enable.auto.commit: false</span><br><span class="line">    kafka.auto.commit.interval.ms: 1000</span><br><span class="line">    kafka.auto.offset.reset: latest</span><br><span class="line">    kafka.request.timeout.ms: 40000</span><br><span class="line">    kafka.session.timeout.ms: 30000</span><br><span class="line">    kafka.isolation.level: read_committed</span><br><span class="line">    kafka.max.poll.records: 1000</span><br><span class="line">    # rocketMQ consumer</span><br><span class="line">    rocketmq.namespace:</span><br><span class="line">    rocketmq.namesrv.addr: 127.0.0.1:9876</span><br><span class="line">    rocketmq.batch.size: 1000</span><br><span class="line">    rocketmq.enable.message.trace: false</span><br><span class="line">    rocketmq.customized.trace.topic:</span><br><span class="line">    rocketmq.access.channel:</span><br><span class="line">    rocketmq.subscribe.filter:</span><br><span class="line">    # rabbitMQ consumer</span><br><span class="line">    rabbitmq.host:</span><br><span class="line">    rabbitmq.virtual.host:</span><br><span class="line">    rabbitmq.username:</span><br><span class="line">    rabbitmq.password:</span><br><span class="line">    rabbitmq.resource.ownerId:</span><br><span class="line">  srcDataSources:</span><br><span class="line">    defaultDS:</span><br><span class="line">      url: jdbc:mysql://172.16.188.1:3306/bladex?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">  canalAdapters:</span><br><span class="line">  - instance: example # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g1</span><br><span class="line">      outerAdapters:</span><br><span class="line">      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        hosts: http://172.16.188.7:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          # security.auth: test:123456 #  only used for rest mode</span><br><span class="line">          cluster.name: cluster1</span><br></pre></td></tr></table></figure>
<h1 id="17-field-error-in-object-target-on-field-esmapping-rejected-value"><a class="markdownIt-Anchor" href="#17-field-error-in-object-target-on-field-esmapping-rejected-value">#</a> 17 Field error in object â€˜targetâ€™ on field â€˜esMappingâ€™: rejected value [];</h1>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Field error in object &#x27;target&#x27; on field &#x27;esMapping&#x27;: rejected value []; codes </span><br><span class="line">[typeMismatch.target.esMapping,typeMismatch.esMapping,typeMismatch.com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping,typeMismatch]; </span><br><span class="line">arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [target.esMapping,esMapping]; arguments []; default message [esMapping]]; default message [Failed to convert property value of type &#x27;java.lang.String&#x27; to required type </span><br><span class="line">&#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;; nested </span><br><span class="line">exception is java.lang.IllegalStateException: Cannot convert value of type &#x27;java.lang.String&#x27; to required type</span><br><span class="line"> &#x27;com.alibaba.otter.canal.client.adapter.es.core.config.ESSyncConfig$ESMapping&#x27; for property &#x27;esMapping&#x27;: no </span><br><span class="line"> matching editors or conversion strategy found]</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯é…ç½®æ–‡ä»¶é—®é¢˜ï¼Œæ£€æŸ¥ es ä¸‹çš„é…ç½® yml æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯ sql è¯­å¥çš„è¯­æ³•æ˜¯å¦æœ‰é—®é¢˜</p>
<h1 id="18-javautilnosuchelementexception"><a class="markdownIt-Anchor" href="#18-javautilnosuchelementexception">#</a> 18 java.util.NoSuchElementException</h1>
<p>æ²¡æœ‰æ‰¾åˆ°å¯¹åº”å­—æ®µå¯¼è‡´</p>
<p>æ£€æŸ¥ä¸‹ canal é…ç½®æ–‡ä»¶ä¸­çš„å­—æ®µæ˜¯å¦åœ¨ es mapping ä¸­æœ‰å¯¹åº”çš„ï¼Œå¤§å°å†™æ˜¯å¦ä¸€è‡´ï¼Œæ˜¯å¦æœ‰é—æ¼</p>
<p>å› ä¸ºæˆ‘çš„æ“ä½œæ˜¯ mysql åŒæ­¥è‡³ esï¼Œæ‰€ä»¥è¿™é‡Œè¯´æ˜å‡ é¡¹å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ï¼š<br>
1ã€canal é…ç½®æ–‡ä»¶ä¸­çš„ sql ä¸­æ˜¯å¦å¤§å°å†™ä¸€è‡´ï¼Œcanal æ˜¯åŒºåˆ†å¤§å°å†™çš„<br>
 2ã€sql ä¸­è®¾ç½®çš„åˆ«åæ˜¯å¦ä¸ es mappings ä¸­çš„åç§°ä¸€è‡´ï¼Œå…è®¸ es ä¸­çš„éƒ¨åˆ†å­—æ®µä¸ºç©ºï¼Œä½†æ˜¯ä¸å…è®¸ sql ä¸­æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µåœ¨ es mappings ä¸­æ‰¾ä¸åˆ°å¯¹åº”çš„å­—æ®µ<br>
 3ã€canal é…ç½®æ–‡ä»¶ä¸­çš„ dataSourceKey æ˜¯å¦æ­£ç¡®ï¼Œå…¶å¯¹åº”åˆ° canal application.yml é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“æ˜¯å¦æ­£ç¡®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa</span><br></pre></td></tr></table></figure>
<p>application.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">srcDataSources:</span><br><span class="line">    aaa: # ä¸ä¹‹å¯¹åº”</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/aaa?useUnicode=true</span><br><span class="line">      #driverClassName: com.mysql.cj.jdbc.Driver</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    xxx:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/xxx?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br><span class="line">    yyy:</span><br><span class="line">      url: jdbc:mysql://192.168.244.1:3306/yyy?useUnicode=true</span><br><span class="line">      username: root</span><br><span class="line">      password: 123456</span><br></pre></td></tr></table></figure>
<p>4ã€canal é…ç½®æ–‡ä»¶ä¸­çš„æ’ç‰ˆæ˜¯å¦æ­£ç¡®ï¼Œç‰¹åˆ«æ³¨æ„_index,_type ç­‰å±æ€§è¦æ”¾åœ¨ esMappings ä¸‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: dept </span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id,</span><br><span class="line">        t.id as _id,</span><br><span class="line">        t.dept_name as deptName,</span><br><span class="line">        t.dept_category as deptCategory,</span><br><span class="line">        t.parent_id as parentId,</span><br><span class="line">        t.ancestors as ancestors,</span><br><span class="line">        t.third_party_id as thirdPartyId,</span><br><span class="line">        t.phone as phone,</span><br><span class="line">        t.address as address,</span><br><span class="line">        t.is_deleted as isDeleted</span><br><span class="line">      from</span><br><span class="line">         dept t&quot;</span><br><span class="line">  #etlCondition: &quot;where t.update_time&gt;=&#x27;&#123;0&#125;&#x27;&quot;</span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>5ã€sql æŸ¥è¯¢å‡ºæ¥çš„å­—æ®µç±»å‹ä¸ es mappings ä¸­çš„å­—æ®µæ•°æ®ç±»å‹æ˜¯å¦ä¸€è‡´</p>
<p>6ã€å¤šè¡¨åŒæ­¥åˆ°åŒä¸€ä¸ªç´¢å¼•æ—¶ï¼Œå¦‚æœéƒ½æœ‰åŒä¸€ä¸ªå¸¸é‡åˆ—ä¸”å€¼ä¸åŒæ—¶ä¼šæŠ¥é”™ã€‚<br>
å¦‚ä¸‹æ‰€ç¤ºçš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½æœ‰ userSource å¸¸é‡åˆ—ç”¨äºåŒºåˆ†ä¸åŒçš„æ•°æ®æ¥æºï¼Œä½†æ˜¯å¦‚ä¸‹çš„é…ç½®ä¼šæŠ¥é”™ã€‚<br>
xxx.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        0 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<p>yyy.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">dataSourceKey: aaa # è¿™é‡Œçš„keyä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„æ•°æ®æºä¿æŒä¸€è‡´</span><br><span class="line">outerAdapterKey: esKey # ä¸ä¸Šè¿°application.ymlä¸­é…ç½®çš„outerAdapters.keyä¸€ç›´</span><br><span class="line">destination: example # é»˜è®¤ä¸ºexample,ä¸application.ymlä¸­é…ç½®çš„instanceä¿æŒä¸€è‡´</span><br><span class="line">groupId:</span><br><span class="line">esMapping:</span><br><span class="line">  _index: user</span><br><span class="line">  _type: _doc</span><br><span class="line">  _id: _id</span><br><span class="line">  sql: &quot;select</span><br><span class="line">        t.id, </span><br><span class="line">        1 as userSource, </span><br><span class="line">      from</span><br><span class="line">         user_wx t&quot; </span><br><span class="line">  commitBatch: 3000</span><br></pre></td></tr></table></figure>
<h1 id="19-adapteræ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æ²¡æœ‰è¯»å–binlog-could-not-find-first-log-file-name-in-binary-log-index-file"><a class="markdownIt-Anchor" href="#19-adapteræ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä½†æ˜¯æ²¡æœ‰è¯»å–binlog-could-not-find-first-log-file-name-in-binary-log-index-file">#</a> 19. adapter æ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯æ²¡æœ‰è¯»å– binlog ï½œ Could not find first log file name in binary log index file</h1>
<p>adapter æ—¥å¿—ä¸­æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œäºæ˜¯å»æŸ¥çœ‹ deployer æ—¥å¿—ï¼Œè¿™é‡Œçš„ example æ˜¯ä½ é…ç½®çš„å®ä¾‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat logs/example/example.log</span><br></pre></td></tr></table></figure>
<p>ä¼šå‘ç°æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not find first log file name in binary log index file</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€æ—¢ç„¶é—®é¢˜æ˜¯æ²¡æœ‰æ‰¾åˆ°æ•°æ®åº“çš„ binglog æ–‡ä»¶ä½ç½®ï¼Œé‚£ä¹ˆå°±æŸ¥çœ‹ä¸€ä¸‹ç°åœ¨çš„ binlog æ–‡ä»¶ä½ç½®ï¼Œç™»é™† mysql æ‰§è¡Œ</p>
<p>2.1 å¦‚æœä½ æ˜¯åšå¢é‡åŒæ­¥ï¼Œé‚£ä¹ˆæŸ¥è¯¢å½“å‰ binlog ä½ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ä¿®æ”¹ conf/example/instance.properties æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># è¿™é‡Œçš„æ–‡ä»¶åè¦ä¸ä¸Šé¢çš„ä¿æŒä¸€è‡´ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯æ–‡ä»¶åä¸ä¸€è‡´ï¼Œå†™æˆäº†mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000003 </span><br><span class="line">canal.instance.master.position=5921</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>2.2 å¦‚æœä½ è¦åšå…¨é‡åŒæ­¥ï¼ŒæŸ¥è¯¢ binlog æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show binary logs;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/b4736c68b0f64b80bb509d395a627fb1.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=192.168.244.17:3306</span><br><span class="line"># è¿™é‡Œçš„æ–‡ä»¶åè¦ä¸ä¸Šé¢çš„ä¿æŒä¸€è‡´ï¼Œæˆ‘è¿™é‡Œå°±æ˜¯æ–‡ä»¶åä¸ä¸€è‡´ï¼Œå†™æˆäº†mysql-bin.000001</span><br><span class="line">canal.instance.master.journal.name=binlog.000001</span><br><span class="line"># ä½ç½®ä»0å¼€å§‹</span><br><span class="line">canal.instance.master.position=0</span><br><span class="line">canal.instance.master.timestamp=</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>3ã€é‡å¯ deployer å’Œ adapter</p>
<h1 id="20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception"><a class="markdownIt-Anchor" href="#20-error-caottercanaladapterlauncherloaderadapterprocessor-javalangnullpointerexception">#</a> 20. ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</h1>
<p>å¯åŠ¨ adapter æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 06:28:44.444 [pool-2-thread-1] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - java.lang.NullPointerException</span><br><span class="line">java.lang.RuntimeException: java.lang.NullPointerException</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:116) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:64) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:115) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.ESAdapter.sync(ESAdapter.java:94) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.batchSync(AdapterProcessor.java:139) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$1(AdapterProcessor.java:97) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.CopyOnWriteArrayList.forEach(CopyOnWriteArrayList.java:895) ~[na:1.8.0_312]</span><br><span class="line">        at com.alibaba.otter.canal.adapter.launcher.loader.AdapterProcessor.lambda$null$2(AdapterProcessor.java:94) ~[client-adapter.launcher-1.1.5.jar:na]</span><br><span class="line">        at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[na:1.8.0_312]</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[na:1.8.0_312]</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748) ~[na:1.8.0_312]</span><br><span class="line">Caused by: java.lang.NullPointerException: null</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es7x.support.ES7xTemplate.insert(ES7xTemplate.java:79) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.singleTableSimpleFiledInsert(ESSyncService.java:448) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.insert(ESSyncService.java:139) ~[na:na]</span><br><span class="line">        at com.alibaba.otter.canal.client.adapter.es.core.service.ESSyncService.sync(ESSyncService.java:99) ~[na:na]</span><br><span class="line">        ... 11 common frames omitted</span><br><span class="line">2022-05-21 06:28:44.449 [Thread-4] ERROR c.a.otter.canal.adapter.launcher.loader.AdapterProcessor - Outer adapter sync failed!  Error sync but ACK!</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ adapter/application.ymlï¼Œç»™ outerAdapters é…ç½®ä¸€ä¸ª keyï¼Œæ³¨æ„è¿™é‡Œå¦‚æœæœ‰å¤šä¸ª adapter å®ä¾‹ï¼Œé‚£ä¹ˆå°±é…ç½®ä¸åŒçš„ key</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">canalAdapters:</span><br><span class="line">  - instance: test # canal instance Name or mq topic name</span><br><span class="line">    groups:</span><br><span class="line">    - groupId: g2</span><br><span class="line">      outerAdapters:</span><br><span class="line">#      - name: logger</span><br><span class="line">      - </span><br><span class="line">        key: esKey3 # é…ç½®key</span><br><span class="line">        name: es7 # es6 or es7</span><br><span class="line">        #hosts: http://192.168.101.11:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        hosts: http://192.168.244.11:9200 # é›†ç¾¤åœ°å€ï¼Œé€—å·éš”å¼€. 127.0.0.1:9200 for rest mode or 127.0.0.1:9300 for transport mode</span><br><span class="line">        properties:</span><br><span class="line">          mode: rest #  rest or transport </span><br><span class="line">          security.auth: elastic:elastic #  only used for rest mode</span><br><span class="line">          cluster.name: blade-cluster</span><br></pre></td></tr></table></figure>
<h1 id="21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table"><a class="markdownIt-Anchor" href="#21-canalparseexception-parse-row-data-failed-column-size-is-not-match-for-table">#</a> 21. CanalParseException: parse row data failed. | column size is not match for table</h1>
<p>deployser æ—¥å¿—æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2022-05-21 07:45:15.651 [MultiStageCoprocessor-Parser-fleet-0] ERROR com.alibaba.otter.canal.common.utils.NamedThreadFactory - from MultiStageCoprocessor-Parser-fleet-0</span><br><span class="line">com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: parse row data failed.</span><br><span class="line">Caused by: com.alibaba.otter.canal.parse.exception.CanalParseException: column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
1ã€å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¸­å·²ç»ç»™å‡ºæ˜ç¡®æç¤ºäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">column size is not match for table:fleet.source_project_cargo,9 vs 8</span><br></pre></td></tr></table></figure>
<p>2ã€è¯¥é”™è¯¯å®˜æ–¹ä¸­æœ‰è§£é‡Š<br>
<a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/TableMetaTSDB">å®˜æ–¹æ–‡æ¡£ TableMetaTSDB</a><br>
 åœ¨ instance.properties ä¸­è®¾ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.tsdb.spring.xml=classpath:spring/tsdb/h2-tsdb.xml</span><br><span class="line"># table meta tsdb info</span><br><span class="line">canal.instance.tsdb.enable=true</span><br><span class="line"># ä»¥ä¸‹é…ç½®ä¸ç”¨å¼€å¯ï¼Œå› ä¸ºåœ¨canal.propertiesä¸­å·²ç»è®¾ç½®è¿‡äº†ï¼Œåªè¦æ²¡æœ‰æ‰‹åŠ¨å…³é—­è¿‡å°±ä¸ç”¨å†é…ç½®äº†</span><br><span class="line">#canal.instance.tsdb.dir=$&#123;canal.file.data.dir:../conf&#125;/$&#123;canal.instance.destination:&#125;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:h2:$&#123;canal.instance.tsdb.dir&#125;/h2;CACHE_SIZE=1000;MODE=MYSQL;</span><br><span class="line">#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb</span><br><span class="line">#canal.instance.tsdb.dbUsername=canal</span><br><span class="line">#canal.instance.tsdb.dbPassword=canal</span><br></pre></td></tr></table></figure>
<p>3ã€ä¸€èˆ¬å°†è¿™ä¸ªå¼€å¯å°±è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå³æ—¶å°†å…¶å¼€å¯è¿˜æ˜¯æŠ¥é”™ï¼ŒæŸ¥é˜…ç›¸å…³èµ„æ–™æœ‰è¯´å°† <code>canal.instance.tsdb.enable</code>  è®¾ç½®ä¸º false åé‡å¯è§£å†³çš„ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œå°†å…¶è®¾ç½®ä¸º false åä¾æ—§æ²¡æœ‰è§£å†³</p>
<p>å®åœ¨æ²¡æœ‰å…¶ä»–åŠæ³•äº†ï¼ŒæŸ¥é˜…å®˜æ–¹ githubï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› æ˜¯å› ä¸ºè¡¨ç»“æ„å‘ç”Ÿè¿‡å˜åŒ–ï¼Œä½†æ˜¯ binlog ä¸­è¯»å–åˆ°çš„ä¸ç°åœ¨çš„è¡¨ç»“æ„ä¸ä¸€è‡´å¯¼è‡´ã€‚</p>
<p>äºæ˜¯ç›´æ¥è·³è¿‡è¯¥ binlog checkpointï¼Œä¹Ÿå°±æ˜¯å°† binlog çš„è¯»å–ä½ç½®è®¾ç½®ä¸ºå½“å‰çš„æœ€æ–° binlog ä½ç½®</p>
<p>ï¼ˆ1ï¼‰æŸ¥é˜…å½“å‰ binlog æœ€æ–°ä½ç½®ï¼Œmysql ä¸­æ‰§è¡Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/5a1f009e008d4b4281589f580bef9192.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ï¼ˆ2ï¼‰å°†è¯»å–ä½ç½®è¯¥ä¸ºæœ€æ–°ï¼Œä¿®æ”¹ deployer conf/example/instance.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.address=162.14.99.4:3306</span><br><span class="line">canal.instance.master.journal.name=mysql-bin.000002</span><br><span class="line">canal.instance.master.position=226586328</span><br><span class="line"># å½“å‰æ—¶é—´çš„æ—¶é—´æˆ³å½¢å¼</span><br><span class="line">canal.instance.master.timestamp=1653140932</span><br><span class="line">canal.instance.master.gtid=</span><br></pre></td></tr></table></figure>
<p>ï¼ˆ3ï¼‰é‡å¯ deployer , adapter<br>
ï¼ˆ4ï¼‰å› ä¸ºè¯»å–çš„æ˜¯æœ€æ–°çš„ binlogã€‚ä¸ºäº†æŠŠå½“å‰çš„æ•°æ®åŒæ­¥è¿›æ¥ï¼Œå°†éœ€è¦åŒæ­¥çš„è¡¨æˆ–åº“å¯¼å‡ºï¼Œç„¶åå†å¯¼å…¥ä¸€éã€‚é—®é¢˜è§£å†³ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„è§£å†³æ–¹æ¡ˆè¦è°¨æ…ï¼Œç”Ÿäº§ç¯å¢ƒå› ä¸ºæ—¶æ—¶åˆ»åˆ»åœ¨äº§ç”Ÿæ•°æ®ï¼Œå¯è¡Œæ€§å¾ˆä½ï¼Œæ‰€ä»¥çœ‹è¦ä¹ˆè®¾ç½®ä¸€ä¸ªåœæœºç»´æŠ¤æ¥è¿›è¡Œå®æ“ï¼‰</p>
<h1 id="22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0"><a class="markdownIt-Anchor" href="#22-use-gtid-and-tablemeta-tsdb-should-be-config-timestamp-0">#</a> 22. use gtid and TableMeta TSDB should be config timestamp &gt; 0</h1>
<p>åœ¨ instance.properties ä¸­è®¾ç½®æ—¶é—´æˆ³</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">canal.instance.master.timestamp=1546272000000</span><br></pre></td></tr></table></figure>
<h1 id="23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string"><a class="markdownIt-Anchor" href="#23-runtimeexception-comalibabafastjsonjsonexception-unclosed-string">#</a> 23. RuntimeException: com.alibaba.fastjson.JSONException: unclosed string</h1>
<p>è¯¥é”™è¯¯æ˜¯å› ä¸º sql ä¸­ä½¿ç”¨äº† <code>group_concat</code>  å‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°é»˜è®¤é•¿åº¦æ˜¯ 1024ï¼Œè¶…è¿‡çš„ä¼šè¢«æˆªå–ï¼Œå¯¼è‡´å‡ºç°äº† json æ ¼å¼çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæ²¡æœ‰æ­£ç¡®çš„å…³é—­ json</p>
<p>è§£å†³ï¼š<br>
1ã€ä¿®æ”¹ my.cnfï¼Œæ‰©å¤§ group_concat_max_len</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group_concat_max_len = 102400</span><br></pre></td></tr></table></figure>
<p>2ã€é‡å¯ mysql</p>
<h1 id="24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause"><a class="markdownIt-Anchor" href="#24-mysqlsyntaxerrorexception-unknown-column-_v_id-in-where-clause">#</a> 24. MySQLSyntaxErrorException: Unknown column â€˜_v._idâ€™ in â€˜where clauseâ€™</h1>
<p>sql ä¸­æ²¡æœ‰ <code>_id</code>  å­—æ®µå¯¼è‡´ï¼Œä½¿ç”¨ as å°† id å‘½ååˆ«åï¼š <code>select id as _id</code></p>
<h1 id="25-adapterä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ä½†esä¸­æ•°æ®æœªåŒæ­¥"><a class="markdownIt-Anchor" href="#25-adapterä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ä½†esä¸­æ•°æ®æœªåŒæ­¥">#</a> 25. adapter ä¸­æœ‰åŒæ­¥æ—¥å¿—æ‰“å°ï¼Œä½† es ä¸­æ•°æ®æœªåŒæ­¥</h1>
<p>æˆ‘è¿™é‡Œå‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯åœ¨ canal1.1.6 ç‰ˆæœ¬ä¸­ï¼ŒåŸå› æ˜¯ es7 æ–‡ä»¶å¤¹ä¸­çš„ <code>.yml</code>  æ–‡ä»¶ä¸­ä¹¦å†™çš„ sql é‡Œä½¿ç”¨äº† `` å°†è¡¨åæ‹¬èµ·æ¥ï¼Œå¯¼è‡´æœªè¯†åˆ«ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,name,age <span class="keyword">from</span> `<span class="keyword">user</span>`</span><br></pre></td></tr></table></figure>
<p>è§£å†³ï¼š<br>
å°† `` å»æ‰å³å¯</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-12-06T10:46:26.000Z" title="2020-12-6 18:46:26">2020-12-06</time>å‘è¡¨</span><span class="level-item"><time dateTime="2023-05-10T05:17:15.806Z" title="2023-5-10 13:17:15">2023-05-10</time>æ›´æ–°</span><span class="level-item">19 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦2868ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/12/06/%E3%80%90MYSQL%E3%80%91%E6%B0%B4%E5%B9%B3%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%9E%82%E7%9B%B4%E5%88%86%E8%A1%A8%E3%80%81%E5%88%86%E5%BA%93%E5%92%8C%E5%85%AC%E5%85%B1%E8%A1%A8%E7%9A%84%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E5%92%8C%E8%AE%B2%E8%A7%A3/">ã€MYSQLã€‘æ°´å¹³åˆ†è¡¨ã€åˆ†åº“å’Œå‚ç›´åˆ†è¡¨ã€åˆ†åº“å’Œå…¬å…±è¡¨çš„ä»£ç å®ç°å’Œè®²è§£</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h3 id="æ–‡ç« ç›®å½•"><a class="markdownIt-Anchor" href="#æ–‡ç« ç›®å½•">#</a> æ–‡ç« ç›®å½•</h3>
<ul>
<li><a href="#_1">ä¸€ã€æ•™å­¦è®²è§£è§†é¢‘</a></li>
<li><a href="#_3">äºŒã€ç¯å¢ƒå‡†å¤‡</a></li>
<li><a href="#_99">ä¸‰ã€æ°´å¹³åˆ†è¡¨</a></li>
<li>
<ul>
<li><a href="#1_100">1. æ¦‚å¿µ</a></li>
<li><a href="#2_114">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_221">å››ã€æ°´å¹³åˆ†åº“</a></li>
<li>
<ul>
<li><a href="#1_223">1. æ¦‚å¿µ</a></li>
<li><a href="#2_229">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_351">äº”ã€å‚ç›´åˆ†è¡¨</a></li>
<li>
<ul>
<li><a href="#1_352">1. æ¦‚å¿µ</a></li>
<li><a href="#2_356">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_358">å…­ã€å‚ç›´åˆ†åº“</a></li>
<li>
<ul>
<li><a href="#1_359">1. æ¦‚å¿µ</a></li>
<li><a href="#2_362">2. ä»£ç </a></li>
</ul>
</li>
<li><a href="#_364">ä¸ƒã€å…¬å…±è¡¨</a></li>
<li>
<ul>
<li><a href="#1_365">1. æ¦‚å¿µ</a></li>
<li><a href="#2_367">2. ä»£ç </a></li>
</ul>
</li>
</ul>
<h1 id="ä¸€-æ•™å­¦è®²è§£è§†é¢‘"><a class="markdownIt-Anchor" href="#ä¸€-æ•™å­¦è®²è§£è§†é¢‘">#</a> ä¸€ã€æ•™å­¦è®²è§£è§†é¢‘</h1>
<p>æ•™å­¦è®²è§£è§†é¢‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tx4y1371w">è§†é¢‘åœ°å€</a></p>
<h1 id="äºŒ-ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#äºŒ-ç¯å¢ƒå‡†å¤‡">#</a> äºŒã€ç¯å¢ƒå‡†å¤‡</h1>
<ul>
<li>
<p>æ“ä½œç³»ç»Ÿï¼šWin10</p>
</li>
<li>
<p>æ•°æ®åº“ï¼šMySQL5.7</p>
</li>
<li>
<p>JDKï¼š64 ä½ jdk1.8.0_202</p>
</li>
<li>
<p>åº”ç”¨æ¡†æ¶ï¼šspring-boot-2.1.3.RELEASE</p>
</li>
<li>
<p>Sharding-JDBCï¼šsharding-jdbc-spring-boot-starter-4.0.0-RC1</p>
</li>
</ul>
<p>å¯¹åº”çš„ pom.xml ä¾èµ–ä»£ç </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yjq.programmer<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>ShardingJDBC<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥mysqlè¿æ¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥sharding-jdbcè¿æ¥ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0-RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥é˜¿é‡Œå·´å·´druidè¿æ¥æ± --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼•å…¥æµ‹è¯•ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é›†æˆmybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- é›†æˆjunitæµ‹è¯• --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span><span class="comment">&lt;!-- lock down plugins versions to avoid using Maven defaults (may be moved to parent pom) --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="ä¸‰-æ°´å¹³åˆ†è¡¨"><a class="markdownIt-Anchor" href="#ä¸‰-æ°´å¹³åˆ†è¡¨">#</a> ä¸‰ã€æ°´å¹³åˆ†è¡¨</h1>
<h2 id="1æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ">#</a> 1. æ¦‚å¿µ</h2>
<p>æ°´å¹³åˆ†è¡¨æ˜¯åœ¨ <code>åŒä¸€ä¸ª</code> æ•°æ®åº“å†…ï¼ŒæŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ® <code>æŒ‰ä¸€å®šè§„åˆ™</code> æ‹†åˆ†åˆ°å¤šä¸ª <code>è¡¨</code> ä¸­ã€‚<br>
å› æ­¤ï¼Œç›®å‰æˆ‘åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­å‡†å¤‡äº†ä¸¤ä¸ªè¡¨ï¼Œ <code>t_user_1</code>  å’Œ <code>t_user_2</code> ï¼Œå¦‚ä¸‹å›¾ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b9b8ccb2a36e4028bb013590fc3e84ea.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
è¡¨ç»“æ„ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_user_1` (</span><br><span class="line">  `<span class="built_in">id</span>` bigint(20) NOT NULL,</span><br><span class="line">  `name` varchar(100) DEFAULT NULL,</span><br><span class="line">  `sex` int(2) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`<span class="built_in">id</span>`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="2ä»£ç "><a class="markdownIt-Anchor" href="#2ä»£ç ">#</a> 2. ä»£ç </h2>
<p>â‘ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬çš„ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰æ•°æ®æº</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actualâ€dataâ€nodes=m1.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºSNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥åŒ…æ‹¬åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.shardingâ€column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.algorithmâ€expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ—¥å¿—é…ç½®</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€sqlè¾“å‡ºæ—¥å¿—</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapperæ–‡ä»¶æ‰«æè·¯å¾„</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>é¦–å…ˆå®šä¹‰æ•°æ®æº m1ï¼Œå¹¶å¯¹ m1 è¿›è¡Œå®é™…çš„å‚æ•°é…ç½®ã€‚</li>
<li>æŒ‡å®š t_user è¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œä»–åˆ†å¸ƒåœ¨ m1.t_user_1ï¼Œm1.t_user_2ã€‚</li>
<li>æŒ‡å®š t_user è¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸º SNOWFLAKEï¼ŒSNOWFLAKE æ˜¯ä¸€ç§åˆ†å¸ƒå¼è‡ªå¢ç®—æ³•ï¼Œä¿è¯ id å…¨å±€å”¯ä¸€ã€‚</li>
<li>å®šä¹‰ t_user åˆ†è¡¨ç­–ç•¥ï¼Œid ä¸ºå¶æ•°çš„æ•°æ®è½åœ¨ t_user_1ï¼Œä¸ºå¥‡æ•°çš„è½åœ¨ t_user_2ï¼Œæ‰€ä»¥åˆ†è¡¨ç­–ç•¥çš„è¡¨è¾¾å¼ä¸º t_user_$-&gt;{id% 2 + 1}ã€‚</li>
</ul>
<p><strong>è¸©å‘æ³¨æ„ï¼</strong> å¦‚æœå¯åŠ¨é¡¹ç›®æœ‰å¦‚ä¸‹æŠ¥é”™ï¼Œå¯èƒ½æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„ <code>-&gt;</code>  æ²¡æœ‰ç”¨è‹±æ–‡ç±»å‹çš„ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1b3e0aca06df43c4bb2671eabc7a2e9d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9a9e406ab2bd4e3db3c55aac18a9b178.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„æ°´å¹³åˆ†è¡¨æƒ…å†µä¸‹ <code>æ’å…¥</code> å’Œ <code>æŸ¥è¯¢</code> çš„ç»“æœã€‚</p>
<p><code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name) values (<span class="comment">#&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;å°æ˜&quot;</span> + i);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser();</span><br><span class="line">    logger.info(<span class="string">&quot;æŸ¥è¯¢ç»“æœï¼š&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
 id ä¸ºå¥‡æ•°çš„è¢«æ’å…¥åˆ° t_user_2 è¡¨ï¼Œä¸ºå¶æ•°çš„è¢«æ’å…¥åˆ° t_user_1 è¡¨ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚<br>
 <code>æŸ¥è¯¢</code> <br>
<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=sharding-jdbc&amp;spm=1001.2101.3001.7020"> sharding-jdbc</a> åˆ†åˆ«å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ï¼›<strong>å¦‚æœæœ‰ä¼ å…¥ id è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¹Ÿä¼šæ ¹æ® t_user çš„åˆ†è¡¨ç­–ç•¥å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®</strong>ã€‚</p>
<h1 id="å››-æ°´å¹³åˆ†åº“"><a class="markdownIt-Anchor" href="#å››-æ°´å¹³åˆ†åº“">#</a> å››ã€æ°´å¹³åˆ†åº“</h1>
<h2 id="1æ¦‚å¿µ-2"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-2">#</a> 1. æ¦‚å¿µ</h2>
<p>æ°´å¹³åˆ†åº“æ˜¯æŠŠåŒä¸€ä¸ªè¡¨çš„æ•°æ®æŒ‰ <code>ä¸€å®šè§„åˆ™</code> æ‹†åˆ†åˆ°ä¸åŒçš„ <code>æ•°æ®åº“</code> ä¸­ï¼Œæ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚<br>
ç°åœ¨ï¼Œæˆ‘åœ¨ <code>æ°´å¹³åˆ†è¡¨</code> çš„åŸºç¡€ä¸Šå¤šåŠ äº†ä¸€ä¸ª db_user2 çš„æ•°æ®åº“ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/80d1a3af2700414b9a0850ae9172034a.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>
ç„¶åä¸¤ä¸ªæ•°æ®åº“ä¸­çš„è¡¨ç»“æ„æ˜¯ä¸€è‡´çš„ï¼Œè¡¨ç»“æ„å’Œä¸Šé¢æ°´å¹³åˆ†è¡¨ç”¨çš„ä¿æŒä¸€æ ·ã€‚<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9354ea1b1af043238412581e0769b3dd.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h2 id="2ä»£ç -2"><a class="markdownIt-Anchor" href="#2ä»£ç -2">#</a> 2. ä»£ç </h2>
<p>â‘ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬çš„ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä»£ç ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">server.port=8081</span><br><span class="line"><span class="comment">#1800s</span></span><br><span class="line">server.servlet.session.timeout=1800</span><br><span class="line">spring.jackson.time-zone=GMT+8</span><br><span class="line">spring.jackson.date-format=yyyy-MM-<span class="built_in">dd</span> HH:mm:ss</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®šä¹‰æ•°æ®æº</span></span><br><span class="line">spring.shardingsphere.datasource.names=m1,m2</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m1.url=jdbc:mysql://127.0.0.1:3306/db_user1?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m1.username=root</span><br><span class="line">spring.shardingsphere.datasource.m1.password=</span><br><span class="line">spring.shardingsphere.datasource.m1.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m1.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line">spring.shardingsphere.datasource.m2.url=jdbc:mysql://127.0.0.1:3306/db_user2?serverTimezone=GMT%2b8&amp;useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8</span><br><span class="line">spring.shardingsphere.datasource.m2.username=root</span><br><span class="line">spring.shardingsphere.datasource.m2.password=</span><br><span class="line">spring.shardingsphere.datasource.m2.driverâ€classâ€name=com.mysql.jdbc.Driver</span><br><span class="line">spring.shardingsphere.datasource.m2.type=com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†åº“ç­–ç•¥</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.databaseâ€strategy.inline.shardingâ€column=sex</span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.databaseâ€strategy.inline.algorithmâ€expression=m$-&gt;&#123;sex % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„æ•°æ®åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.actualâ€dataâ€nodes=m$-&gt;&#123;1..2&#125;.t_user_$-&gt;&#123;1..2&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„ä¸»é”®ç”Ÿæˆç­–ç•¥ä¸ºSNOWFLAKE</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.keyâ€generator.type=SNOWFLAKE</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®št_userè¡¨çš„åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥åŒ…æ‹¬åˆ†ç‰‡é”®å’Œåˆ†ç‰‡ç®—æ³•</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.shardingâ€column=<span class="built_in">id</span></span><br><span class="line">spring.shardingsphere.sharding.tables.t_user.tableâ€strategy.inline.algorithmâ€expression=t_user_$-&gt;&#123;<span class="built_in">id</span> % 2 + 1&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ§åˆ¶å°æ—¥å¿—é…ç½®</span></span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.com.yjq.programmer.dao=debug</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰“å¼€sqlè¾“å‡ºæ—¥å¿—</span></span><br><span class="line">spring.shardingsphere.props.sql.show=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#mapperæ–‡ä»¶æ‰«æè·¯å¾„</span></span><br><span class="line">mybatis.mapper-locations=classpath*:mappers/**/*.xml</span><br></pre></td></tr></table></figure>
<ul>
<li>é…ç½®äº†ä¸¤ä¸ªæ•°æ®æºï¼Œåˆ†é…æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„æ•°æ®åº“ db_user1 å’Œ db_user2ã€‚</li>
<li>é…ç½®åˆ†åº“ç­–ç•¥ï¼Œsex å­—æ®µä¸ºå¶æ•°çš„æ•°æ®è½åœ¨ m1 æ•°æ®æºï¼Œä¸ºå¥‡æ•°çš„è½åœ¨ m2 æ•°æ®æºï¼Œæ‰€ä»¥åˆ†åº“ç­–ç•¥çš„è¡¨è¾¾å¼ä¸º m$-&gt;{sex % 2 + 1}ã€‚</li>
<li>é…ç½®åˆ†è¡¨ç­–ç•¥ï¼Œåˆ†è¡¨ç­–ç•¥å’Œä¸Šé¢æ°´å¹³åˆ†è¡¨ä¿æŒä¸€è‡´ã€‚</li>
<li>ä¹Ÿå°±æ˜¯å½“æœ‰æ•°æ®æ¥æ—¶ï¼Œå…ˆæ ¹æ® sex å­—æ®µåˆ¤æ–­è½å…¥å“ªä¸ªæ•°æ®æºï¼Œç„¶åå†æ ¹æ® id å­—æ®µæ¥åˆ¤æ–­è½å…¥å“ªä¸ªè¡¨ä¸­ã€‚</li>
</ul>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„æ°´å¹³åˆ†è¡¨æƒ…å†µä¸‹ <code>æ’å…¥</code> å’Œ <code>æŸ¥è¯¢</code> çš„ç»“æœã€‚</p>
<p><code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public interface UserDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; selectUser(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.UserDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        insert into t_user(name, sex) values (<span class="comment">#&#123;name&#125;, #&#123;sex&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;select <span class="built_in">id</span>=<span class="string">&quot;selectUser&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span> resultType=<span class="string">&quot;com.yjq.programmer.entity.User&quot;</span>&gt;</span><br><span class="line">        select * from t_user t <span class="built_in">where</span> t.sex = <span class="comment">#&#123;sex&#125; and t.id = #&#123;id&#125;</span></span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line">12345678910111213</span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsert</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    <span class="keyword">for</span>(int i=0; i&lt;10; i++) &#123;</span><br><span class="line">        user.setName(<span class="string">&quot;å°æ˜&quot;</span> + i);</span><br><span class="line">        user.setSex(1);</span><br><span class="line">        <span class="keyword">if</span>(userDao.insertUser(user) == 1) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCSelect</span></span>() &#123;</span><br><span class="line">    User user = new User();</span><br><span class="line">    user.setSex(1);</span><br><span class="line">    user.setId(821357967667363840L);</span><br><span class="line">    List&lt;User&gt; userList = userDao.selectUser(user);</span><br><span class="line">    logger.info(<span class="string">&quot;æŸ¥è¯¢ç»“æœï¼š&#123;&#125;&quot;</span>, JSONObject.toJSONString(userList));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
 sex å­—æ®µä¸ºå¥‡æ•°çš„æ•°æ®è½å…¥ m2 æ•°æ®æºï¼Œä¸ºå¶æ•°çš„è½å…¥ m1 æ•°æ®æºã€‚åŒæ—¶ id å­—æ®µå€¼ä¸ºå¥‡æ•°çš„ï¼Œæ’å…¥ t_user_2 è¡¨ä¸­ï¼Œä¸ºå¶æ•°çš„æ’å…¥ t_user_1 è¡¨ä¸­ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚<br>
 <code>æŸ¥è¯¢</code> <br>
 sharding-jdbc åˆ†åˆ«å»ä¸åŒçš„è¡¨æ£€ç´¢æ•°æ®ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ï¼›<strong>å¦‚æœæœ‰ä¼ å…¥ sex è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¼šæ ¹æ® t_user çš„åˆ†åº“ç­–ç•¥å»é”å®šæŸ¥å“ªä¸ªåº“ï¼Œå¦‚æœæœ‰ä¼ å…¥ id è¿›è¡ŒæŸ¥è¯¢ï¼Œsharding-jdbc ä¼šæ ¹æ® t_user çš„åˆ†è¡¨ç­–ç•¥å»é”å®šæŸ¥å“ªä¸ªè¡¨</strong>ã€‚</p>
<h1 id="äº”-å‚ç›´åˆ†è¡¨"><a class="markdownIt-Anchor" href="#äº”-å‚ç›´åˆ†è¡¨">#</a> äº”ã€å‚ç›´åˆ†è¡¨</h1>
<h2 id="1æ¦‚å¿µ-3"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-3">#</a> 1. æ¦‚å¿µ</h2>
<p>å‚ç›´åˆ†è¡¨ä¸€èˆ¬å°±æ˜¯æŠŠè¡¨çš„ç»“æ„è¿›è¡Œæ”¹é€ ï¼Œå…³äºå¦‚ä½•æ”¹é€ ï¼Œå¯ä»¥æµè§ˆæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">åˆ†åº“åˆ†è¡¨ï¼šå‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ã€æ°´å¹³åˆ†è¡¨å››ä¸ªæ¦‚å¿µ</a><br>
<strong>å¤§è‡´çš„æ€è·¯å°±æ˜¯ï¼šå°†ä¸€ä¸ªè¡¨æŒ‰ç…§å­—æ®µåˆ†æˆå¤šè¡¨ï¼Œæ¯ä¸ªè¡¨å­˜å‚¨å…¶ä¸­ä¸€éƒ¨åˆ†å­—æ®µã€‚</strong></p>
<h2 id="2ä»£ç -3"><a class="markdownIt-Anchor" href="#2ä»£ç -3">#</a> 2. ä»£ç </h2>
<p>æ— ä»£ç ï¼Œå‚ç›´åˆ†è¡¨å±äºè¡¨ç»“æ„è®¾è®¡å±‚é¢ã€‚</p>
<h1 id="å…­-å‚ç›´åˆ†åº“"><a class="markdownIt-Anchor" href="#å…­-å‚ç›´åˆ†åº“">#</a> å…­ã€å‚ç›´åˆ†åº“</h1>
<h2 id="1æ¦‚å¿µ-4"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-4">#</a> 1. æ¦‚å¿µ</h2>
<p>å‚ç›´åˆ†åº“å°±æ˜¯åœ¨ <code>å‚ç›´åˆ†è¡¨</code> æŠŠè¡¨è¿›è¡Œåˆ†ç±»åï¼Œæ”¾åˆ° <code>ä¸åŒçš„æ•°æ®åº“</code> ä¸­ã€‚æ¯ä¸ªåº“å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå®ƒçš„æ ¸å¿ƒç†å¿µæ˜¯ <code>ä¸“åº“ä¸“ç”¨</code> ã€‚å…³äºå¦‚ä½•æ”¹é€ ï¼ŒåŒæ ·å¯ä»¥æµè§ˆæˆ‘çš„å¦ä¸€ç¯‡åšå®¢ï¼š<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/dgfdhgghd/article/details/128426013">åˆ†åº“åˆ†è¡¨ï¼šå‚ç›´åˆ†åº“ã€å‚ç›´åˆ†è¡¨ã€æ°´å¹³åˆ†åº“ã€æ°´å¹³åˆ†è¡¨å››ä¸ªæ¦‚å¿µ</a></p>
<h2 id="2ä»£ç -4"><a class="markdownIt-Anchor" href="#2ä»£ç -4">#</a> 2. ä»£ç </h2>
<p>æ— ä»£ç ï¼Œå‚ç›´åˆ†åº“å±äºæ•°æ®åº“è®¾è®¡å±‚é¢ã€‚</p>
<h1 id="ä¸ƒ-å…¬å…±è¡¨"><a class="markdownIt-Anchor" href="#ä¸ƒ-å…¬å…±è¡¨">#</a> ä¸ƒã€å…¬å…±è¡¨</h1>
<h2 id="1æ¦‚å¿µ-5"><a class="markdownIt-Anchor" href="#1æ¦‚å¿µ-5">#</a> 1. æ¦‚å¿µ</h2>
<p>å…¬å…±è¡¨å±äºç³»ç»Ÿä¸­æ•°æ®é‡è¾ƒå°ï¼Œå˜åŠ¨å°‘ï¼Œè€Œä¸”å±äºé«˜é¢‘è”åˆæŸ¥è¯¢çš„ä¾èµ–è¡¨ã€‚å‚æ•°è¡¨ã€æ•°æ®å­—å…¸è¡¨ç­‰å±äºæ­¤ç±»å‹ã€‚ <code>å¯ä»¥å°†è¿™ç±»è¡¨åœ¨æ¯ä¸ªæ•°æ®åº“éƒ½ä¿å­˜ä¸€ä»½</code> ï¼Œæ‰€æœ‰æ›´æ–°æ“ä½œéƒ½åŒæ—¶å‘é€åˆ°æ‰€æœ‰åˆ†åº“æ‰§è¡Œã€‚</p>
<h2 id="2ä»£ç -5"><a class="markdownIt-Anchor" href="#2ä»£ç -5">#</a> 2. ä»£ç </h2>
<p>â‘ åªéœ€è¦åœ¨ SpringBoot çš„ <code>é…ç½®æ–‡ä»¶</code> ä¸­åŠ å…¥ä¸‹é¢è¿™è¡Œæ¥æŒ‡æ˜å…¬å…±è¡¨å°±è¡Œã€‚<br>
 <code>å¦‚æœæœ‰å¤šä¸ªå…¬å…±è¡¨ï¼Œç”¨é€—å·æ‹¼æ¥å°±è¡Œ</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¬å…±è¡¨è®¾ç½®</span></span><br><span class="line">spring.shardingsphere.sharding.broadcastâ€tables=t_dict</span><br><span class="line">12</span><br></pre></td></tr></table></figure>
<p>â‘¡ç„¶åæ¥ä¸‹æ¥å°±å†™æˆ‘ä»¬çš„ <code>dao</code>  å±‚ã€ <code>mapper</code>  å±‚å’Œ <code>å•å…ƒæµ‹è¯•</code> çš„ä»£ç ï¼Œå»æµ‹è¯•æˆ‘ä»¬çš„å…¬å…±è¡¨çš„ <code>æ’å…¥</code> çš„ç»“æœã€‚<br>
 <code>dao</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public interface DictDao &#123;</span><br><span class="line"></span><br><span class="line">    int insertDict(Dict dict);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mapper</code>  å±‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yjq.programmer.dao.DictDao&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;insert <span class="built_in">id</span>=<span class="string">&quot;insertDict&quot;</span> parameterType=<span class="string">&quot;com.yjq.programmer.entity.Dict&quot;</span>&gt;</span><br><span class="line">        insert into t_dict(<span class="built_in">id</span>, name) values (<span class="comment">#&#123;id&#125;, #&#123;name&#125;)</span></span><br><span class="line">    &lt;/insert&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br><span class="line"></span><br><span class="line">å•å…ƒæµ‹è¯•</span><br><span class="line">@Test</span><br><span class="line">public void <span class="function"><span class="title">testShardingJDBCInsertDict</span></span>() &#123;</span><br><span class="line">    Dict dict = new Dict();</span><br><span class="line">    dict.setId(1);</span><br><span class="line">    dict.setName(<span class="string">&quot;å­—å…¸åç§°&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(dictDao.insertDict(dict) == 1) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ’å…¥æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>â‘¢ç»“æœè¯´æ˜<br>
 <code>æ’å…¥</code> <br>
æ’å…¥çš„æ•°æ®åœ¨ <code>æ¯ä¸ªåº“ä¸­çš„å¯¹åº”çš„å…¬å…±è¡¨</code> ä¸­éƒ½èƒ½çœ‹åˆ°ï¼Œè¾¾åˆ°é¢„æœŸç›®æ ‡ã€‚</p>
<h2 id="å…³äºæˆ‘"><a class="markdownIt-Anchor" href="#å…³äºæˆ‘">#</a> å…³äºæˆ‘</h2>
<p>Brath æ˜¯ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯çš„ Java ç¨‹åºçŒ¿ï¼Œå…¬ä¼—å·ã€ŒInterviewCoderã€å®šæœŸåˆ†äº«æœ‰è¶£æœ‰æ–™çš„ç²¾å“åŸåˆ›æ–‡ç« ï¼</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>éå¸¸æ„Ÿè°¢å„ä½äººæ‰èƒ½çœ‹åˆ°è¿™é‡Œï¼ŒåŸåˆ›ä¸æ˜“ï¼Œæ–‡ç« å¦‚æœæœ‰å¸®åŠ©å¯ä»¥å…³æ³¨ã€ç‚¹èµã€åˆ†äº«æˆ–è¯„è®ºï¼Œè¿™éƒ½æ˜¯å¯¹æˆ‘çš„è«å¤§æ”¯æŒï¼</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/14/">ä¸Šä¸€é¡µ</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/page/16/">ä¸‹ä¸€é¡µ</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/14/">14</a></li><li><a class="pagination-link is-current" href="/page/15/">15</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">ã€å…¬ä¼—å·å¼€å‘ã€‘å…¬ä¼—å·æŠ€æœ¯åˆ†äº«ç¬¬ä¸€æœŸ-å¦‚ä½•æ³¨å†Œå¾®ä¿¡å…¬ä¼—å¹³å°å¹¶ä½¿ç”¨å…¬ä¼—å·æ¨¡æ¿æ¶ˆæ¯</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T17:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">ã€Sentinelã€‘Dockeræ­å»ºSentinel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T07:25:21.000Z">2023-06-05</time></p><p class="title"><a href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">ã€Gitã€‘Githubæäº¤ä»£ç é‡åˆ°é”™è¯¯ï¼šERROR Youâ€˜re using an RSA key with SHA-1, which is no longer allowed</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T02:04:23.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/%E3%80%90Linux%E3%80%91%E9%98%BF%E9%87%8C%E4%BA%91linux%20%E6%8C%82%E8%BD%BD%E6%95%B0%E6%8D%AE%E7%9B%98%E5%B9%B6docker%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E8%BF%81%E7%A7%BB%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98/">ã€Linuxã€‘é˜¿é‡Œäº‘linux æŒ‚è½½æ•°æ®ç›˜å¹¶dockerå·¥ä½œç›®å½•è¿ç§»åˆ°æ•°æ®ç›˜</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-23T02:04:23.000Z">2023-05-23</time></p><p class="title"><a href="/2023/05/23/%E3%80%90Seata%E3%80%91%E6%9D%A5%E8%87%AA%E9%98%BF%E9%87%8C%E5%BC%80%E6%BA%90%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%A1%86%E6%9E%B6-Seata%E7%9A%84%E5%8E%9F%E7%90%86/">ã€Seataã€‘æ¥è‡ªé˜¿é‡Œå¼€æºåˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶-Seataçš„åŸç†</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">61</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">43</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">é¢è¯•è®°å®˜æ–¹å…¬ä¼—å·</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">148</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">æŠ€èƒ½æ”¹å˜äººç”Ÿï¼ŒçŸ¥è¯†æ”¹å˜å‘½è¿ã€‚</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ä¸­å›½Â·æ±Ÿè‹Â·æ— é”¡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">148</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ³ çµ(ç‰¹åˆ«å‘œè°¢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(ç äº‘)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">æ˜é‡‘</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(é˜¿é‡Œäº‘)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(è…¾è®¯äº‘)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(Bç«™)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">å…±<span id="busuanzi_value_site_uv">0</span>ä¸ªè®¿å®¢</span></p><p class="is-size-7">Â© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>