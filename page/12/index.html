<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.085Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.442Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">5 分钟读完 (大约791个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E4%B8%8B%E5%AE%89%E8%A3%85Canal%E5%B9%B6%E6%95%B4%E5%90%88SpringBoot/">【Docker】Docker下安装Canal并整合SpringBoot</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="canal"><a class="markdownIt-Anchor" href="#canal">#</a> <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Canal&amp;spm=1001.2101.3001.7020">Canal</a> 是一个同步增量数据的一个工具</h1>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#_2">概念</a></li>
<li><a href="#Mysqlbinlog_5">Mysql 开启 binlog</a></li>
<li>
<ul>
<li><a href="#binlog_9">是否开启 binlog</a></li>
<li><a href="#binlog_16">开启 binlog 日志</a></li>
<li><a href="#_30">创建授权用户</a></li>
</ul>
</li>
<li><a href="#Canal_41">部署 Canal</a></li>
<li>
<ul>
<li><a href="#_43">拉取镜像</a></li>
<li><a href="#properties_47">挂载 properties 配置文件</a></li>
<li><a href="#_68">创建容器</a></li>
</ul>
</li>
</ul>
<h1 id="概念"><a class="markdownIt-Anchor" href="#概念">#</a> 概念</h1>
<p>canal 是阿里巴巴旗下的一款<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&amp;spm=1001.2101.3001.7020">开源项目</a>，纯 Java 开发。基于数据库增量日志解析，提供增量数据订阅 &amp; 消费，目前主要支持了 MySQL（也支持 mariaDB）</p>
<h1 id="mysql开启binlog"><a class="markdownIt-Anchor" href="#mysql开启binlog">#</a> Mysql 开启 binlog</h1>
<p>在部署 Canal 之前，需要先安装 Mysql。</p>
<blockquote>
<p>我用的是 5.7.27 的 mysql</p>
</blockquote>
<h2 id="是否开启binlog"><a class="markdownIt-Anchor" href="#是否开启binlog">#</a> 是否开启 binlog</h2>
<p>输入以下命令，查看是否开启 binlog<br>
 为<strong> OFF</strong> 则表示<strong>未开启</strong> binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;log_bin&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/cd4194a978a544b59e40d7c342d8683d.png" alt="在这里插入图片描述"></p>
<h2 id="开启binlog日志"><a class="markdownIt-Anchor" href="#开启binlog日志">#</a> 开启 binlog 日志</h2>
<p>修改 mysql 的配置文件，在 [mysqld] 下添加以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># server_id不重复即可，不要和canal的slaveId重复</span><br><span class="line">server_id=1</span><br><span class="line"># 开启binlog</span><br><span class="line">log_bin = mysql-bin</span><br><span class="line"># 选择row模式</span><br><span class="line">binlog_format = ROW</span><br></pre></td></tr></table></figure>
<hr>
<p>修改完毕，重启 mysql<br>
 查看是否开启<br>
<img src="https://img-blog.csdnimg.cn/df9f1104c79c42b3bd3cc2461f593f40.png" alt="在这里插入图片描述"></p>
<h2 id="创建授权用户"><a class="markdownIt-Anchor" href="#创建授权用户">#</a> 创建授权用户</h2>
<p>创建授权用户 canal 用于 cannal 服务监听 mysql 的 binlog</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 新建用户 用户名：canal  密码：canal </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> canal IDENTIFIED <span class="keyword">by</span> <span class="string">&#x27;canal&#x27;</span>;</span><br><span class="line"># 授权</span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;canal&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"># 刷新MySQL的系统权限相关表</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<h1 id="部署canal"><a class="markdownIt-Anchor" href="#部署canal">#</a> 部署 Canal</h1>
<p>如果没有部署过 docker，看我之前写的<a target="_blank" rel="noopener" href="https://brath.top/2023/03/16/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/"> Linux 部署 Docker</a></p>
<h2 id="拉取镜像"><a class="markdownIt-Anchor" href="#拉取镜像">#</a> 拉取镜像</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<h2 id="挂载properties配置文件"><a class="markdownIt-Anchor" href="#挂载properties配置文件">#</a> 挂载 properties 配置文件</h2>
<p>先进行第一次运行，拷贝 properties 配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>拷贝运行后的容器中配置文件，用来文件挂载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建canal宿主机挂载目录</span></span><br><span class="line">mkdir -p /opt/canal/conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看docker运行情况，复制容器<span class="built_in">id</span></span></span><br><span class="line">docker ps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拷贝配置文件</span></span><br><span class="line">docker cp 容器id:/home/admin/canal-server/conf/example/instance.properties  /opt/canal/conf/</span><br></pre></td></tr></table></figure>
<p>移除当前容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker stop canal</span><br><span class="line">docker rm canal</span><br></pre></td></tr></table></figure>
<p>修改配置文件<br>
<img src="https://img-blog.csdnimg.cn/c51d4265e36e4e3d862f103eb0367a42.png" alt="在这里插入图片描述"></p>
<h2 id="创建容器"><a class="markdownIt-Anchor" href="#创建容器">#</a> 创建容器</h2>
<p>运行新的容器，同时挂载修改后的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 11111:11111 --name canal -v /opt/canal/conf/instance.properties:/home/admin/canal-server/conf/example/instance.properties -d canal/canal-server:latest</span><br></pre></td></tr></table></figure>
<p>开放端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=11111/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.081Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.458Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">2 分钟读完 (大约246个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85vim/">Docker环境下安装vim</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="docker环境下安装vim"><a class="markdownIt-Anchor" href="#docker环境下安装vim">#</a> Docker 环境下安装 vim</h2>
<p>在使用 docker 容器时，容器一般没有安装 vim，就需要安装 vim<br>
apt-get install vim 命令用于安装 vim，但是下载过慢。<br>
第一步 配置国内镜像源<br>
进入某个容器</p>
<p>例如进入 mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysql /bin/bash</span><br></pre></td></tr></table></figure>
<p>第二步：更新源</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure>
<p>第三步安装 vim</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.077Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.464Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">2 分钟读完 (大约304个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2Reids%E9%95%9C%E5%83%8F%E4%BD%9C%E4%B8%BA%E4%BB%8E%E8%8A%82%E7%82%B9/">Docker环境部署Reids镜像作为从节点</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="docker环境部署reids镜像作为从节点"><a class="markdownIt-Anchor" href="#docker环境部署reids镜像作为从节点">#</a> Docker 环境部署 Reids 镜像作为从节点</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 拉取镜像</span><br><span class="line">docker pull redis</span><br><span class="line"></span><br><span class="line"># 配置文件</span><br><span class="line">本地：/mydata/redis/data/redis.conf 提前准备好</span><br><span class="line">主要配置</span><br><span class="line">bind 127.0.0.1 #注释掉这部分，使redis可以外部访问</span><br><span class="line">daemonize no#用守护线程的方式启动</span><br><span class="line">requirepass 你的密码#给redis设置密码</span><br><span class="line">appendonly yes#redis持久化　　默认是no</span><br><span class="line">tcp-keepalive 300 #防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</span><br><span class="line"></span><br><span class="line"># 创建实例并启动</span><br><span class="line">docker run -p 6380:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.074Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.453Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">10 分钟读完 (大约1533个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Docker%E3%80%91Docker%E5%AE%89%E8%A3%85Jenkins/">Docker安装Jenkins</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="docker安装jenkins"><a class="markdownIt-Anchor" href="#docker安装jenkins">#</a> Docker 安装 Jenkins</h1>
<h1 id="一-前言"><a class="markdownIt-Anchor" href="#一-前言">#</a> 一、前言</h1>
<h2 id="1-领头羊"><a class="markdownIt-Anchor" href="#1-领头羊">#</a> 1、领头羊</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">作为领先的开源自动化服务器，Jenkins 提供了数百个插件来支持构建、部署和自动化任何项目。</span><br></pre></td></tr></table></figure>
<h2 id="2-特点"><a class="markdownIt-Anchor" href="#2-特点">#</a> 2、特点</h2>
<ul>
<li>持续集成和持续交付：作为可扩展的自动化服务器，Jenkins 可以用作简单的 CI 服务器或变成任何项目的持续交付中心。</li>
<li>简易安装：Jenkins 是一个独立的基于 Java 的程序，可以开箱即用，包含适用于 Windows、Linux、macOS 和其他类 Unix 操作系统的软件包。</li>
<li>易于配置：Jenkins 可以通过其 Web 界面轻松设置和配置，其中包括即时错误检查和内置帮助。</li>
<li>插件：凭借更新中心的数百个插件，Jenkins 与持续集成和持续交付工具链中的几乎所有工具集成。</li>
<li>可扩展：Jenkins 可以通过其插件架构进行扩展，为 Jenkins 可以做的事情提供几乎无限的可能性。</li>
<li>分散式：Jenkins 可以轻松地在多台机器上分配工作，帮助更快地跨多个平台推动构建、测试和部署。</li>
</ul>
<h1 id="二-docker安装jenkins"><a class="markdownIt-Anchor" href="#二-docker安装jenkins">#</a> 二、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Docker%E5%AE%89%E8%A3%85Jenkins&amp;spm=1001.2101.3001.7020">Docker 安装 Jenkins</a></h1>
<h2 id="1-docker-search-jenkins查询镜像"><a class="markdownIt-Anchor" href="#1-docker-search-jenkins查询镜像">#</a> 1、docker search jenkins 查询镜像</h2>
<h3 id="11-正常查询结果"><a class="markdownIt-Anchor" href="#11-正常查询结果">#</a> 1.1、正常查询结果</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# docker search jenkins</span><br><span class="line">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">jenkins                            DEPRECATED; use &quot;jenkins/jenkins:lts&quot; instead   5504                [OK]                </span><br><span class="line">jenkins/jenkins                    The leading open source automation server       3087                                    </span><br><span class="line">jenkins/jnlp-slave                 a Jenkins agent which can connect to Jenkins…   150                                     [OK]</span><br><span class="line">jenkins/inbound-agent                                                              65                                      </span><br><span class="line">bitnami/jenkins                    Bitnami Docker Image for Jenkins                53                                      [OK]</span><br><span class="line">jenkins/slave                      base image for a Jenkins Agent, which includ…   48                                      [OK]</span><br><span class="line">jenkins/agent                                                                      39                                      </span><br><span class="line">jenkins/ssh-slave                  A Jenkins slave using SSH to establish conne…   38                                      [OK]</span><br><span class="line">jenkins/ssh-agent                  Docker image for Jenkins agents connected ov…   24                                      </span><br><span class="line">jenkins/jnlp-agent-docker                                                          8                                       </span><br><span class="line">jenkins/jnlp-agent-maven           A JNLP-based agent with Maven 3 built in        7                                       </span><br><span class="line">jenkins/pct                        Plugin Compat Tester                            5                                       [OK]</span><br><span class="line">jenkins/jenkins-experimental       Experimental images of Jenkins. These images…   3                                       [OK]</span><br><span class="line">jenkins/jnlp-agent-python          A JNLP-based agent with Python built in         3                                       </span><br><span class="line">jenkins/jnlp-agent-alpine                                                          2                                       </span><br><span class="line">jenkins/jnlp-agent-node                                                            1                                       </span><br><span class="line">rancher/jenkins-jenkins                                                            1                                       </span><br><span class="line">jenkins/ath                        Jenkins Acceptance Test Harness                 1                                       [OK]</span><br><span class="line">jenkins/core-changelog-generator   Tool for generating Jenkins core changelogs     1                                       </span><br><span class="line">jenkins/jenkinsfile-runner         Jenkinsfile Runner packages                     1                                       </span><br><span class="line">jenkins/core-pr-tester             Docker image for testing pull-requests sent …   1                                       </span><br><span class="line">jenkins/jnlp-agent-ruby                                                            1                                       </span><br><span class="line">jenkins/remoting-kafka-agent       Remoting Kafka Agent                            1                                       [OK]</span><br><span class="line">rancher/jenkins-jnlp-slave                                                         0                                       </span><br><span class="line">rancher/jenkins-slave              Jenkins Build Slave                             0                                       [OK]</span><br><span class="line">[root@localhost ~]# ^C</span><br><span class="line">[root@localhost ~]# </span><br></pre></td></tr></table></figure>
<h3 id="12-可能异常情况这个异常解决方法为下面第2点"><a class="markdownIt-Anchor" href="#12-可能异常情况这个异常解决方法为下面第2点">#</a> 1.2、可能异常情况，这个异常解决方法为下面第 2 点</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/07f347955491462592d6f37cc2394fc6.png" alt="img"></p>
<h2 id="2-上面报这个error解决方法"><a class="markdownIt-Anchor" href="#2-上面报这个error解决方法">#</a> 2、上面报这个 ERROR 解决方法</h2>
<h3 id="21-更新时间同步即可ntpdate-cnpoolntporg"><a class="markdownIt-Anchor" href="#21-更新时间同步即可ntpdate-cnpoolntporg">#</a> 2.1、更新<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&amp;spm=1001.2101.3001.7020">时间同步</a>即可：ntpdate <a target="_blank" rel="noopener" href="http://cn.pool.ntp.org">cn.pool.ntp.org</a></h3>
<h3 id="22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate"><a class="markdownIt-Anchor" href="#22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate">#</a> 2.2、如果提示不存在 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ntpdate&amp;spm=1001.2101.3001.7020">ntpdate</a> 命令需要先安装该命令：yum install ntpdate</h3>
<h3 id="23-date中国时间"><a class="markdownIt-Anchor" href="#23-date中国时间">#</a> 2.3、date 中国时间</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/315167c9692b4ebbad480fdffdf439c0.png" alt="img"></p>
<h2 id="3-docker-pull-jenkinsciblueocean拉取jenkins镜像"><a class="markdownIt-Anchor" href="#3-docker-pull-jenkinsciblueocean拉取jenkins镜像">#</a> 3、****docker pull jenkinsci/blueocean**** 拉取 Jenkins 镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1ef511da220c4ca4bca8143aa55c9e52.png" alt="img"></p>
<h2 id="4-docker-images-查看本地镜像"><a class="markdownIt-Anchor" href="#4-docker-images-查看本地镜像">#</a> 4、docker images 查看本地镜像</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d9690427ee344603ac96cfa1a6a5510c.png" alt="img"></p>
<h2 id="5-centos7安装jdk安装-已有jdk可以跳过"><a class="markdownIt-Anchor" href="#5-centos7安装jdk安装-已有jdk可以跳过">#</a> 5、CentOS7 安装 JDK 安装 已有 JDK 可以跳过</h2>
<h3 id="51-可以下载linux版本targz压缩包到本地不用解压"><a class="markdownIt-Anchor" href="#51-可以下载linux版本targz压缩包到本地不用解压">#</a> 5.1、可以下载 linux 版本 tar.gz 压缩包到本地不用解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b413890d2adc4b8ea27f016d215c14e7.png" alt="img"></p>
<h3 id="52-cd-usr-mkdir-java进入usr创建java文件夹"><a class="markdownIt-Anchor" href="#52-cd-usr-mkdir-java进入usr创建java文件夹">#</a> 5.2、****cd /usr, mkdir java**** 进入 usr 创建 java 文件夹</h3>
<h3 id="53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里"><a class="markdownIt-Anchor" href="#53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里">#</a> 5.3、****cd java*<em><strong> 进入 java 文件夹，用</strong></em> * rz**** 将 linux 版的 jdk 压缩包上传到这里</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/32e9bd440462402a80f0aa6a0ef32a18.png" alt="img"></p>
<h3 id="54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令"><a class="markdownIt-Anchor" href="#54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令">#</a> 5.4、(将 JDK 移到 java，mv jdk-8u301-linux-x64.tar.gz/usr/java) 移动文件命令</h3>
<h3 id="55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现"><a class="markdownIt-Anchor" href="#55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现">#</a> 5.5、<em><strong>*tar*</strong></em> <em><strong>*-*</strong></em><em><strong>*zxvf*</strong></em> jdk-8u301-linux-x64.tar.gz，解压会有 jdk1.8.0_301 出现</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/100d06f1ce4e4ee7b4b209cbf37491db.png" alt="img"></p>
<h3 id="56-vi-etcprofile配置linux系统jdk环境变量"><a class="markdownIt-Anchor" href="#56-vi-etcprofile配置linux系统jdk环境变量">#</a> 5.6、****vi /etc/profile**** 配置 linux 系统 JDK 环境变量</h3>
<p><strong>1) 配置内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_301</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br></pre></td></tr></table></figure>
<h3 id="57-source-etcprofile使配置生效"><a class="markdownIt-Anchor" href="#57-source-etcprofile使配置生效">#</a> 5.7、****source /etc/profile**** 使配置生效</h3>
<h3 id="58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到"><a class="markdownIt-Anchor" href="#58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到">#</a> 5.8、<em><strong>*sudo yum install glibc.i686*</strong></em>，可能报错解决方案、否则会会报找不到</h3>
<h3 id="59-java-version测试出现如下即为成功"><a class="markdownIt-Anchor" href="#59-java-version测试出现如下即为成功">#</a> 5.9、****java -version**** 测试，出现如下即为成功</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f3cca3db43c84bf79be1bfa8282c4ba9.png" alt="img"></p>
<h2 id="6-centos7安装maven"><a class="markdownIt-Anchor" href="#6-centos7安装maven">#</a> 6、CentOS7 安装 Maven</h2>
<h3 id="61-cd-usrlocal"><a class="markdownIt-Anchor" href="#61-cd-usrlocal">#</a> 6.1、<em><strong>*cd /usr/local*</strong></em></h3>
<h3 id="62-rz上传tar-zxvf-apache-maven-361-bintargz解压"><a class="markdownIt-Anchor" href="#62-rz上传tar-zxvf-apache-maven-361-bintargz解压">#</a> 6.2、****rz*<em><strong> 上传，</strong></em>*tar -zxvf apache-maven-3.6.1-bin.tar.gz**** 解压</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1055aa0df0184f6bb28bde13fed60bc5.png" alt="img"></p>
<h3 id="63-vi-etcprofile"><a class="markdownIt-Anchor" href="#63-vi-etcprofile">#</a> 6.3、<em><strong>*vi /etc/profile*</strong></em></h3>
<h3 id="64-source-etcprofile刷新环境变量"><a class="markdownIt-Anchor" href="#64-source-etcprofile刷新环境变量">#</a> 6.4、****source /etc/profile**** 刷新环境变量</h3>
<h3 id="65-mvn-v查看版本"><a class="markdownIt-Anchor" href="#65-mvn-v查看版本">#</a> 6.5、****mvn -v**** 查看版本</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost local]# mvn -v</span><br><span class="line">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class="line">Maven home: /usr/local/apache-maven-3.6.3</span><br><span class="line">Java version: 1.8.0_301, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_301/jre</span><br><span class="line">Default locale: en_US, platform encoding: UTF-8</span><br><span class="line">OS name: &quot;linux&quot;, version: &quot;3.10.0-1127.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class="line">[root@localhost local]# </span><br></pre></td></tr></table></figure>
<p>到此 JDK、Maven 环境准备完成</p>
<h2 id="7-启动容器并挂载上面配置的环境"><a class="markdownIt-Anchor" href="#7-启动容器并挂载上面配置的环境">#</a> 7、<em><strong>* 启动容器，并 *</strong></em><em><strong>* 挂载上面配置的环境 *</strong></em></h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">-u root \</span><br><span class="line">-d \</span><br><span class="line">--restart=always \</span><br><span class="line">-p 8001:8080 \</span><br><span class="line">-p 50000:50000 \</span><br><span class="line">-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">-v /var/jenkins_home:/var/jenkins_home \</span><br><span class="line">jenkinsci/blueocean</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/172131aa0a9f47b3a15e5bd5d4555986.png" alt="img"></p>
<h2 id="9-访问jenkins提示输入密码"><a class="markdownIt-Anchor" href="#9-访问jenkins提示输入密码">#</a> 9、访问 Jenkins，提示输入密码</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2b6d909e4c4e46efaa98216f1c33fdf7.png" alt="img"></p>
<h2 id="10-初次可以选择推荐的"><a class="markdownIt-Anchor" href="#10-初次可以选择推荐的">#</a> 10、初次可以选择推荐的</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5e9a6ebdd6954093bf6a23f4f876221a.png" alt="img"></p>
<h2 id="11-等待安装"><a class="markdownIt-Anchor" href="#11-等待安装">#</a> 11、 <strong>等待安装</strong></h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/25caae9dae8b49878adca5e32647e915.png" alt="img"></p>
<h2 id="12-如下访问jenkins成功啦"><a class="markdownIt-Anchor" href="#12-如下访问jenkins成功啦">#</a> 12、如下访问 Jenkins 成功啦</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4beeeb654aec4e608a22ce6b49afa1ae.png" alt="img"></p>
<p>到此就结束 Docker 安装 Jenkins 啦，后面的章节将介绍如何配置 jenkins，敬请期待！</p>
<h6 id="版权声明本文为csdn博主卡布奇诺-海晨的原创文章遵循cc-40-by-sa版权协议转载请附上原文出处链接及本声明"><a class="markdownIt-Anchor" href="#版权声明本文为csdn博主卡布奇诺-海晨的原创文章遵循cc-40-by-sa版权协议转载请附上原文出处链接及本声明">#</a> 版权声明：本文为 CSDN 博主「卡布奇诺 - 海晨」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</h6>
<h6 id="原文链接httpsblogcsdnnetqq_57756904articledetails125697440"><a class="markdownIt-Anchor" href="#原文链接httpsblogcsdnnetqq_57756904articledetails125697440">#</a> 原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_57756904/article/details/125697440">https://blog.csdn.net/qq_57756904/article/details/125697440</a></h6>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.070Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.430Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">4 分钟读完 (大约581个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90chatGPT%E3%80%91%E5%88%A9%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E5%87%BD%E6%95%B0%E5%85%8D%E8%B4%B9%E9%83%A8%E7%BD%B2%E5%9B%BD%E5%86%85%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8ChatGPT%E4%BB%A3%E7%90%86%EF%BC%8C%E8%A7%A3%E5%86%B3%E7%BD%91%E7%BB%9C%E4%B8%8D%E5%8F%AF%E7%94%A8%E5%8F%8A1020%E7%AD%89%E9%97%AE%E9%A2%98/">【chatGPT】利用腾讯云函数免费部署国内直接使用ChatGPT代理，解决网络不可用及1020等问题</a></p><div class="content"><h1 id="chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题"><a class="markdownIt-Anchor" href="#chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题">#</a> 【chatGPT】利用腾讯云函数免费部署国内直接使用 ChatGPT 代理，解决网络不可用及 1020 等问题</h1>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>在 Github 上发现一个项目，可以利用腾讯云提供的云函数，一分钟就能搭建好一台可以直接访问 ChatGPT 的代理，关键还是免费的。今天就来一起折腾它。</p>
<h2 id="项目"><a class="markdownIt-Anchor" href="#项目">#</a> 项目</h2>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/geekr-dev/openai-proxy">https://github.com/geekr-dev/openai-proxy</a></p>
<h2 id="教程"><a class="markdownIt-Anchor" href="#教程">#</a> 教程</h2>
<p>可以直接看官方文字教程，如果是新手，可以按我图文教程</p>
<h5 id="第一步"><a class="markdownIt-Anchor" href="#第一步">#</a> 第一步：</h5>
<p>​	登录腾讯控制台：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/scf/list">https://console.cloud.tencent.com/scf/list</a></p>
<p>​	如果之前没使用腾讯云函数，会提示授权</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085936706.png" alt="image-20230420085936706"></p>
<h5 id="第二步前往访问管理"><a class="markdownIt-Anchor" href="#第二步前往访问管理">#</a> 第二步：前往访问管理</h5>
<p>​	<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085957003.png" alt="image-20230420085957003"></p>
<h5 id="第三步新建函数记得选择非大陆地区哟"><a class="markdownIt-Anchor" href="#第三步新建函数记得选择非大陆地区哟">#</a> 第三步：新建函数，记得选择<strong>非大陆</strong>地区哟</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090015818.png" alt="image-20230420090015818"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090031428.png" alt="image-20230420090031428"></p>
<h5 id="上传github项目中的zip文件"><a class="markdownIt-Anchor" href="#上传github项目中的zip文件">#</a> 上传 Github 项目中的 ZIP 文件</h5>
<h5 id="第四步高级配置"><a class="markdownIt-Anchor" href="#第四步高级配置">#</a> 第四步：高级配置</h5>
<p>上传完 ZIP 文件，接着下拉，找到高级配置，点进去编辑<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090114681.png" alt="image-20230420090114681"></p>
<p>点高级配置的最右边的编辑按钮</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090132944.png" alt="image-20230420090132944"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090140465.png" alt="image-20230420090140465"></p>
<h5 id="第五步获取代理地址"><a class="markdownIt-Anchor" href="#第五步获取代理地址">#</a> 第五步：获取代理地址</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090255336.png" alt="image-20230420090255336"></p>
<p>不要 &quot;/release&quot; 路径，只要取子域名部分就可以了</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090309398.png" alt="image-20230420090309398"></p>
<p>这时候访问路径内容和 api.open.com 的结果是一至的了。</p>
<p><strong>至此：已经有了海外域名的代理地址了。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.067Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.436Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">9 分钟读完 (大约1359个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90chatGPT%E3%80%91%E5%9F%BA%E4%BA%8EDocker%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84ChatGPT/">【chatGPT】基于Docker如何快速部署自己的ChatGPT</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="基于docker如何快速部署自己的chatgpt"><a class="markdownIt-Anchor" href="#基于docker如何快速部署自己的chatgpt">#</a> 基于 Docker 如何快速部署自己的 ChatGPT</h1>
<h2 id="背景"><a class="markdownIt-Anchor" href="#背景">#</a> 背景</h2>
<p>随着<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=OpenAI&amp;spm=1001.2101.3001.7020"> OpenAI</a> 在 2022 年底发布的 LLM 模型 - ChatGPT 展现出的强大效果，ChatGPT 无疑成为了当下炙手可热的明星模型。</p>
<p>现有的基于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=GPT&amp;spm=1001.2101.3001.7020"> GPT</a> 的开源项目已经非常多，本文以现有的高热度 github 开源项目<a target="_blank" rel="noopener" href="https://github.com/Chanzhaoyu/chatgpt-web"> chatgpt-web</a> 为例，教大家简单快速地搭建属于自己的 ChatGPT。</p>
<h2 id="chatgpt-web"><a class="markdownIt-Anchor" href="#chatgpt-web">#</a> ChatGPT-Web</h2>
<p>chatgpt-web 项目中的部署教程已经非常完整，本文不再过多解释。</p>
<p>仅以 Docker 部署为例</p>
<p>前置条件</p>
<ul>
<li>本地或者服务器应该具有 Docker 环境</li>
<li>具有 ChatGPT 帐号</li>
</ul>
<p>以 token 模式为例，请求 chatgpt web 版本，免费但稍微具有延迟</p>
<p><strong>Step1. 找到你帐号的 token</strong></p>
<p>点击 https://chat.openai.com/api/auth/session，获取你帐号的 token，并记录他</p>
<p><strong>Step2. 运行 docker</strong></p>
<p>按需配置访问 Web 页面的密码，Token、超时等信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p><strong>Step3. 访问 localhost:3002 查看效果</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b6ea40d61cb741129cc1d98af9633d18.png" alt="在这里插入图片描述"><br>
在上述步骤中我们无需进行任何代理，就可以直接与 GPT 交流，使用 API 方式同理。当然了，根据项目作者的介绍，<strong>使用 API 时需要进行代理自建</strong>。</p>
<p>如果你只是在本地部署给自己使用，那么以上 3 步就满足了需求，如果想要在公网访问，或者像 App 一样访问你的 ChatGPT，那么请接着往下看。</p>
<h2 id="nginx反向代理"><a class="markdownIt-Anchor" href="#nginx反向代理">#</a> Nginx 反向代理</h2>
<p>以宝塔面板为例，我们在服务器上拉起 docker 镜像后，可以通过 <code>ip:port</code>  进行访问</p>
<p>但通常来说我们的网站带有域名，以笔者所使用的腾讯云服务器为例</p>
<p>前置条件</p>
<ul>
<li>拥有一个域名</li>
<li>拥有一台云服务器</li>
</ul>
<p><strong>Step1. SSL 证书</strong></p>
<p>首先在云产品中找到 SSL 证书，点击我的证书 - 免费证书 - 申请免费证书</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/34d88a1248ea4158ba5e2e6a07ab0a67.png" alt="在这里插入图片描述"></p>
<p>填写申请的域名，申请成功之后，点击下载，下载 nginx 格式的即可</p>
<p><strong>Step2. 配置域名 SSL</strong></p>
<p>在宝塔面板中选择 - 网站 - 添加站点</p>
<p>填写刚刚申请 SSL 证书的域名，选择纯静态，其余默认，点击确定即可</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9ece432796a34885adc258df4bc25555.png" alt="在这里插入图片描述"></p>
<p><strong>Step3. 配置证书</strong></p>
<p>点击添加好的网站，然后点击 SSL，填入刚刚下载的文件中的 <code>key</code>  和 <code>pem</code> <br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/852f85f818444491bc4b8e04248b9a4b.png" alt="在这里插入图片描述"></p>
<p>配置完成后点击保存</p>
<p><strong>Step4. 配置 DNS 解析</strong></p>
<p>在云产品中搜索 - 云解析 - 选择 DNS 解析 DNSPod</p>
<p>点击我的域名 - 添加记录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/383f44e9fe714847ab5c5f2079d81982.png" alt="在这里插入图片描述"></p>
<p>填入刚刚申请的域名，如果带有前缀，则第一个红框填入你的域名前缀，<a target="_blank" rel="noopener" href="http://xn--www-eo8er22f.baidu.com">比如 www.baidu.com</a>，则这里填 www</p>
<p>第二个红框填写你的服务器 ip，或者你的 CDN 域名</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2882e7602c324fc4a9a5520262c23a0a.png" alt="在这里插入图片描述"></p>
<p><strong>Step5. 配置反向代理</strong></p>
<p>在宝塔面板中，点击刚刚添加的网站，点击反向代理，填入刚刚 docker 启动时的宿主机端口<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/abbf944aab284d368e63d28b61024d7f.png" alt="在这里插入图片描述"></p>
<p>如上文中的 3888</p>
<p>以上配置完成之后，访问 https:// 你的域名就可以了～</p>
<h2 id="pwa支持"><a class="markdownIt-Anchor" href="#pwa支持">#</a> PWA 支持</h2>
<p>PWA 技术可以让我们访问网站能够拥有访问 App 一般的体验，在 chatgpt-web 中已经内嵌，但默认是关闭的</p>
<p>我们可以通过设置启动时的参数 <code>-env VITE_GLOB_APP_PWA=true</code>  将他打开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key --<span class="built_in">env</span> VITE_GLOB_APP_PWA=<span class="literal">true</span> chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>部署成功之后，我们再到手机上访问该网站时便可以保存他在桌面了。</p>
<p>默认的 PWA 图标和全局用户信息配置在项目中，即使在网页可以修改当前登陆者的用户信息，在清除 Cookie 之后便会还原，如果你想定制这两种信息，请拉下 chatgpt-web 项目进行镜像自定义</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.064Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.423Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">13 分钟读完 (大约1916个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90chatGPT%E3%80%91%E5%85%85%E6%BB%A1%E5%8F%AF%E8%83%BD%E7%9A%84%E6%96%B0%E4%B8%80%E4%BB%A3%E8%BE%85%E5%8A%A9%E7%BC%96%E7%A8%8B%E7%A5%9E%E5%99%A8%EF%BC%9ACursor/">充满可能的新一代辅助编程神器：Cursor</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="chatgpt充满可能的新一代辅助编程神器cursor"><a class="markdownIt-Anchor" href="#chatgpt充满可能的新一代辅助编程神器cursor">#</a> 【ChatGPT】充满可能的新一代辅助编程神器：Cursor</h1>
<h3 id="随着技术的不断进步人工智能已经逐渐成为了编程领域中不可或缺的一部分-而今天我们要为大家介绍的就是一款基于-gpt4-智能引擎由-openai-开发出来的全新辅助编程神器-cursor"><a class="markdownIt-Anchor" href="#随着技术的不断进步人工智能已经逐渐成为了编程领域中不可或缺的一部分-而今天我们要为大家介绍的就是一款基于-gpt4-智能引擎由-openai-开发出来的全新辅助编程神器-cursor">#</a> 随着技术的不断进步，人工智能已经逐渐成为了编程领域中不可或缺的一部分。而今天我们要为大家介绍的，就是一款基于 GPT4 智能引擎，由 OpenAI 开发出来的全新辅助编程神器 — <strong>Cursor</strong>。</h3>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dca5b19a0af44e72aa859b914d729ec0~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<h3 id="1-cursor-编辑器"><a class="markdownIt-Anchor" href="#1-cursor-编辑器">#</a> <strong>1、Cursor 编辑器</strong></h3>
<p>Cursor 作为一款智能代码编辑器，为程序员们提供了惊人的编程体验。它支持多种常见编程语言，可以轻松的处理各种程序代码，同时还支持多种文件类型和格式化文本，让编辑代码变得更加轻松和舒适。除此之外，Cursor 还拥有许多强大的辅助功能，例如多种主题、多语言语法高亮，在编辑代码时可以根据不同的语言给出不同的颜色提示，让代码阅读变得更加清晰明了。同时，Cursor 还支持快捷键设置、代码折叠、括号匹配、自动缩进等功能，这让程序员们不仅可以在编写代码时更快捷地完成任务，同时也让整个编写过程变得更加高效，透彻地展现出 “智能、便捷、高效” 等的特性。总之，如果你正在寻找一款能够让你的编程体验更加高效、便捷、舒适的工具，那么 Cursor 绝对是一个不错的选择。无论是初学者还是已经经验丰富的程序员们，都可以从中得到惊人的帮助，成为更加专业和出色的编程专家。</p>
<h3 id="2-cursor-下载"><a class="markdownIt-Anchor" href="#2-cursor-下载">#</a> <strong>2、Cursor 下载</strong></h3>
<p>可以直接官方网站下载：<a target="_blank" rel="noopener" href="http://www.cursor.so/">www.cursor.so/</a></p>
<p>我这里也整理了最新 Mac 和 Windows 版本，提供网盘下载：</p>
<p>公众号发送 “Cursor”</p>
<h2 id="3-ide功能介绍"><a class="markdownIt-Anchor" href="#3-ide功能介绍">#</a> <strong>3、IDE 功能介绍</strong></h2>
<p>首先，Cursor 目前是一款独立的应用，你可以理解为是一个更精简版的 sublime 或 vim, 仅仅是一个编辑器，IDE 的功能上也明显弱于 VS Code。不过能够它能够借助 chatgpt 的能力，极大的加速我们的编程效率。</p>
<p><strong>核心功能其实只用到了两个快捷键，一个是 Ctrl+K（⌘+K），一个是 Ctrl+L（⌘+L）</strong></p>
<p>界面上就三个菜单栏：File、Edit、View，然后就是右上角的 4 个图标了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b05dcf4354842f99cc9e8f6b082b2de~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>点击 setting 按钮，出现一个设置的配置，需要注意的就是 Cursor 编辑器支持 vim、emacs；支持绑定 Copilot；支持安装不同语言的 server。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1260ea24788942caa155604618eb11fb~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<h3 id="generatek"><a class="markdownIt-Anchor" href="#generatek">#</a> Generate(⌘+K)</h3>
<p>在输入框里面输入你需要让它帮助你写什么代码，回车后它就开始自动帮助你写代码了。举个例子，接到个需求要写一个 H5 的登录页面，可以通以快捷键输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请用hooks编写一个H5登录界面</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>
<p>一个简单的页面架构就大致生成了：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/334408cbdc6641e19e4e24596f3ab43c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<h3 id="edit-selectionk"><a class="markdownIt-Anchor" href="#edit-selectionk">#</a> Edit Selection(⌘+K)</h3>
<p>可以选择一段代码，然后针对这段代码提出一些修改要求，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">登录界面添加手机号校验和密码规则校验：</span><br></pre></td></tr></table></figure>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e88a1664fc454606a7822a5d5f039857~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p><code>根据上下文，模拟接口调用：</code></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1a9e5234d8f5474d8cc27949fd5c4ee6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<h3 id="chatl"><a class="markdownIt-Anchor" href="#chatl">#</a> Chat(⌘+L)</h3>
<p>类似于集成了 chatGPT，你可以在 Cursor 里面使用 chatGPT 去问任何问题，相当于不需要专门去 官网 了或者搜索引擎就可以找到答案。</p>
<p>上面的例子里，在生成代码后，用户还可以按下 Ctrl+L 针对生成的代码进行提问：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a41908066ebb43ebb361b62aed815959~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<h3 id="chat-selectionl"><a class="markdownIt-Anchor" href="#chat-selectionl">#</a> Chat Selection(⌘+L)</h3>
<p>可以选择一段代码，然后针对这段代码提出一些问题。例如你最近想了解下 react 中的 diff 算法是怎么实现的，你可以借助 Cursor 找到具体的位置并得到解释：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/898a00e82c174f479c1d1ae0afe1f751~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<h2 id="对比github-copilot"><a class="markdownIt-Anchor" href="#对比github-copilot">#</a> 对比 GitHub Copilot</h2>
<ul>
<li>用 Copilot 也可以实现上述功能，但是 Copilot 更侧重于代码的补全，想要实现以上登录页例子，需要一行一行的补全，体验上差了点。</li>
<li>目前而言相比 Copilot，最大的优势当然是免费，目前任处于体验期间，后续正式版应该也会收费。</li>
<li>一个字，快！能处理很长的代码，选中了让给你分析还能定位到关键代码行。</li>
</ul>
<h2 id="缺陷"><a class="markdownIt-Anchor" href="#缺陷">#</a> 缺陷</h2>
<p>可以从 issues 很直观的看到，每天都会新增大量的反馈意见（当然从侧面也反映了 Cursor 当前的火热程度）</p>
<ul>
<li>体验了两天，感觉工作流比较割裂，在 vsCode 和 cursor 之间疯狂切换</li>
<li>比较遗憾的是，Cursor 作者没有添加 vsCode 插件的计划</li>
<li>chatgpt 通病，有字数限制，但可以通过提示继续（这个也能理解，毕竟免费）</li>
<li>官网上说是和 openai 有官方合作，模型用的是 GPT4，但不少用户反馈还是基于 3.5，大家可以自己去测试一下</li>
<li>没有找到修改快捷键的入口，导致一按⌘+Q（代码格式化）就退出系统，很难受</li>
</ul>
<h2 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h2>
<p>客观评价，目前这个 IDE 是一个非常初级的产品，功能非常少，现阶段肯定无法取代 vscode，看它后续的发展了，大家更关注的可能还是 GPT4 的功能。过阵子等多模态开放了，比较期待图片视频识别等功能。不过我认为 Cursor 亦或是 ChatGPT，现在依然还是个大黑盒，你不去开箱永远不知道能带给你什么惊喜，就像是你以前只能读懂你认知以内的代码，但是 AIGC 的出现的确能加快影响你的认知。</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 <code>Java</code>  程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"> 非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.060Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:11:37.042Z" title="2023-4-20 14:11:37">2023-04-20</time>更新</span><span class="level-item">1 小时读完 (大约10987个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Activiti%E3%80%91%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%BC%95%E6%93%8E%20Activiti%20%E6%95%99%E7%A8%8B%EF%BC%88%E9%9D%9E%E5%B8%B8%E8%AF%A6%E7%BB%86%EF%BC%89/">【Activiti】工作流引擎 Activiti 教程(非常详细)</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="扫码_搜索联合传播样式-标准色版"></p>
<h1 id="activiti工作流引擎-activiti-教程非常详细"><a class="markdownIt-Anchor" href="#activiti工作流引擎-activiti-教程非常详细">#</a> 【Activiti】工作流引擎 Activiti 教程 (非常详细)</h1>
<h1 id="更多内容关注微信公众号fullstack888"><a class="markdownIt-Anchor" href="#更多内容关注微信公众号fullstack888">#</a> 更多内容关注微信公众号：fullstack888</h1>
<h3 id="一-工作流介绍"><a class="markdownIt-Anchor" href="#一-工作流介绍">#</a> 一、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%B7%A5%E4%BD%9C%E6%B5%81&amp;spm=1001.2101.3001.7020">工作流</a>介绍</h3>
<h4 id="11-概念"><a class="markdownIt-Anchor" href="#11-概念">#</a> 1.1 概念</h4>
<p>工作流 (<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Workflow&amp;spm=1001.2101.3001.7020">Workflow</a>)，就是通过计算机对业务流程自动化执行管理。它主要解决的是 “使在多个参与者之间按照某种预定义的规则自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。</p>
<h4 id="12-工作流系统"><a class="markdownIt-Anchor" href="#12-工作流系统">#</a> 1.2 工作流系统</h4>
<p>一个软件系统中具有工作流的功能，我们把它称为工作流系统，一个系统中工作流的功能是什么？就是对系统的业务流程进行自动化管理，所以工作流是建立在业务流程的基础上，所以一个软件的系统核心根本上还是系统的业务流程，工作流只是协助进行业务流程管理。即使没有工作流业务系统也可以开发运行，只不过有了工作流可以更好的管理业务流程，提高系统的可扩展性。</p>
<h4 id="13-适用行业"><a class="markdownIt-Anchor" href="#13-适用行业">#</a> 1.3 适用行业</h4>
<p>消费品行业，制造业，电信服务业，银证险等金融服务业，物流服务业，物业服务业，物业管理，大中型进出口贸易公司，政府事业机构，研究院所及教育服务业等，特别是大的跨国企业和集团公司。</p>
<h4 id="14-具体应用"><a class="markdownIt-Anchor" href="#14-具体应用">#</a> 1.4 具体应用</h4>
<p><strong>1、关键业务流程：</strong> 订单、报价处理、合同审核、客户电话处理、供应链管理等</p>
<p><strong>2、行政管理类：</strong> 出差申请、加班申请、请假申请、用车申请、各种办公用品申请、购买申请、<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%97%A5%E6%8A%A5&amp;spm=1001.2101.3001.7020">日报</a>周报等凡是原来手工流转处理的行政表单。</p>
<p><strong>3、人事管理类：</strong> 员工培训安排、绩效考评、职位变动处理、员工档案信息管理等。</p>
<p><strong>4、财务相关类：</strong> 付款请求、应收款处理、日常报销处理、出差报销、预算和计划申请等。</p>
<p><strong>5、客户服务类：</strong> 客户信息管理、客户投诉、请求处理、售后服务管理等。</p>
<p><strong>6、特殊服务类：</strong> ISO 系列对应流程、质量管理对应流程、产品数据信息管理、贸易公司报关处理、物流公司货物跟踪处理等各种通过表单逐步手工流转完成的任务均可应用工作流软件自动规范地实施。</p>
<h4 id="15-实现方式"><a class="markdownIt-Anchor" href="#15-实现方式">#</a> 1.5 实现方式</h4>
<p>在没有专门的工作流引擎之前，我们之前为了实现流程控制，通常的做法就是采用状态字段的值来跟踪流程的变化情况。这样不同角色的用户，通过状态字段的取值来决定记录是否显示。</p>
<p>针对有权限可以查看的记录，当前用户根据自己的角色来决定审批是否合格的操作。如果合格将状态字段设置一个值，来代表合格；当然如果不合格也需要设置一个值来代表不合格的情况。</p>
<p>这是一种最为原始的方式。通过状态字段虽然做到了流程控制，但是当我们的流程发生变更的时候，这种方式所编写的代码也要进行调整。</p>
<p>那么有没有专业的方式来实现工作流的管理呢？并且可以做到业务流程变化之后，我们的程序可以不用改变，如果可以实现这样的效果，那么我们的业务系统的适应能力就得到了极大提升。</p>
<h3 id="二-activiti7概述"><a class="markdownIt-Anchor" href="#二-activiti7概述">#</a> 二、Activiti7 概述</h3>
<h4 id="21-介绍"><a class="markdownIt-Anchor" href="#21-介绍">#</a> 2.1 介绍</h4>
<p>Alfresco 软件在 2010 年 5 月 17 日宣布 Activiti 业务流程管理（BPM）开源项目的正式启动，其首席架构师由业务流程管理 BPM 的专家 Tom Baeyens 担任，Tom Baeyens 就是原来 jbpm 的架构师，而 jbpm 是一个非常有名的工作流引擎，当然 activiti 也是一个工作流引擎。</p>
<p>Activiti 是一个工作流引擎， activiti 可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言 BPMN2.0 进行定义，业务流程按照预先定义的流程进行执行，实现了系统的流程由 activiti 进行管理，减少业务系统由于流程变更进行系统升级改造的工作量，从而提高系统的健壮性，同时也减少了系统开发维护成本。</p>
<blockquote>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.activiti.org/">https://www.activiti.org/</a></p>
</blockquote>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/84ababdd7eced069a746ad6679f4278c.png" alt="84ababdd7eced069a746ad6679f4278c.png"></p>
<p>经历的版本:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/572691de13964b31846f50cee95ccf8c.png" alt="572691de13964b31846f50cee95ccf8c.png"></p>
<blockquote>
<p>目前最新版本：Activiti7.0.0.Beta</p>
</blockquote>
<h5 id="211-bpm"><a class="markdownIt-Anchor" href="#211-bpm">#</a> 2.1.1 BPM</h5>
<p>BPM（Business Process Management），即业务流程管理，是一种规范化的构造端到端的业务流程，以持续的提高组织业务效率。常见商业管理教育如 EMBA、MBA 等均将 BPM 包含在内。</p>
<h5 id="212-bpm软件"><a class="markdownIt-Anchor" href="#212-bpm软件">#</a> 2.1.2 BPM 软件</h5>
<p>BPM 软件就是根据企业中业务环境的变化，推进人与人之间、人与系统之间以及系统与系统之间的整合及调整的经营方法与解决方案的 IT 工具。</p>
<p>通过 BPM 软件对企业内部及外部的业务流程的整个生命周期进行建模、自动化、管理监控和优化，使企业成本降低，利润得以大幅提升。</p>
<p>BPM 软件在企业中应用领域广泛，凡是有业务流程的地方都可以 BPM 软件进行管理，比如企业人事办公管理、采购流程管理、公文审批流程管理、财务管理等。</p>
<h5 id="213-bpmn"><a class="markdownIt-Anchor" href="#213-bpmn">#</a> 2.1.3 BPMN</h5>
<p>BPMN（Business Process Model AndNotation）- 业务流程模型和符号 是由 BPMI（BusinessProcess Management Initiative）开发的一套标准的业务流程建模符号，使用 BPMN 提供的符号可以创建业务流程。</p>
<p>2004 年 5 月发布了 BPMN1.0 规范.BPMI 于 2005 年 9 月并入 OMG（The Object Management Group 对象管理组织) 组织。OMG 于 2011 年 1 月发布 BPMN2.0 的最终版本。</p>
<p>具体发展历史如下:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c03fea9b2a60a94dd5cc9e9e34d20345.png" alt="c03fea9b2a60a94dd5cc9e9e34d20345.png"></p>
<p>BPMN 是目前被各 BPM 厂商广泛接受的 BPM 标准。Activiti 就是使用 BPMN 2.0 进行流程建模、流程执行管理，它包括很多的建模符号，比如：Event</p>
<p>用一个圆圈表示，它是流程中运行过程中发生的事情。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/04355942bc6488f80cbec0bef5f241ca.png" alt="04355942bc6488f80cbec0bef5f241ca.png"></p>
<p>活动用圆角矩形表示，一个流程由一个活动或多个活动组成</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fab3c23503e4731e4d49e32307818190.png" alt="fab3c23503e4731e4d49e32307818190.png"></p>
<p>Bpmn 图形其实是通过 xml 表示业务流程，上边的.bpmn 文件使用文本编辑器打开：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;definitions xmlns=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:xsd=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> xmlns:activiti=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> xmlns:bpmndi=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> xmlns:omgdc=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> xmlns:omgdi=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> typeLanguage=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> expressionLanguage=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> targetNamespace=<span class="string">&quot;http://www.activiti.org/test&quot;</span>&gt;</span><br><span class="line">  &lt;process id=<span class="string">&quot;myProcess&quot;</span> name=<span class="string">&quot;My process&quot;</span> isExecutable=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">    &lt;startEvent id=<span class="string">&quot;startevent1&quot;</span> name=<span class="string">&quot;Start&quot;</span>&gt;&lt;/startEvent&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask1&quot;</span> name=<span class="string">&quot;创建请假单&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow1&quot;</span> sourceRef=<span class="string">&quot;startevent1&quot;</span> targetRef=<span class="string">&quot;usertask1&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask2&quot;</span> name=<span class="string">&quot;部门经理审核&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow2&quot;</span> sourceRef=<span class="string">&quot;usertask1&quot;</span> targetRef=<span class="string">&quot;usertask2&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;userTask id=<span class="string">&quot;usertask3&quot;</span> name=<span class="string">&quot;人事复核&quot;</span>&gt;&lt;/userTask&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow3&quot;</span> sourceRef=<span class="string">&quot;usertask2&quot;</span> targetRef=<span class="string">&quot;usertask3&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">    &lt;endEvent id=<span class="string">&quot;endevent1&quot;</span> name=<span class="string">&quot;End&quot;</span>&gt;&lt;/endEvent&gt;</span><br><span class="line">    &lt;sequenceFlow id=<span class="string">&quot;flow4&quot;</span> sourceRef=<span class="string">&quot;usertask3&quot;</span> targetRef=<span class="string">&quot;endevent1&quot;</span>&gt;&lt;/sequenceFlow&gt;</span><br><span class="line">  &lt;/process&gt;</span><br><span class="line">  &lt;bpmndi:BPMNDiagram id=<span class="string">&quot;BPMNDiagram_myProcess&quot;</span>&gt;</span><br><span class="line">    &lt;bpmndi:BPMNPlane bpmnElement=<span class="string">&quot;myProcess&quot;</span> id=<span class="string">&quot;BPMNPlane_myProcess&quot;</span>&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;startevent1&quot;</span> id=<span class="string">&quot;BPMNShape_startevent1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;35.0&quot;</span> width=<span class="string">&quot;35.0&quot;</span> x=<span class="string">&quot;130.0&quot;</span> y=<span class="string">&quot;160.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask1&quot;</span> id=<span class="string">&quot;BPMNShape_usertask1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;210.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask2&quot;</span> id=<span class="string">&quot;BPMNShape_usertask2&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;360.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;usertask3&quot;</span> id=<span class="string">&quot;BPMNShape_usertask3&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;55.0&quot;</span> width=<span class="string">&quot;105.0&quot;</span> x=<span class="string">&quot;510.0&quot;</span> y=<span class="string">&quot;150.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNShape bpmnElement=<span class="string">&quot;endevent1&quot;</span> id=<span class="string">&quot;BPMNShape_endevent1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdc:Bounds height=<span class="string">&quot;35.0&quot;</span> width=<span class="string">&quot;35.0&quot;</span> x=<span class="string">&quot;660.0&quot;</span> y=<span class="string">&quot;160.0&quot;</span>&gt;&lt;/omgdc:Bounds&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNShape&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow1&quot;</span> id=<span class="string">&quot;BPMNEdge_flow1&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;165.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;210.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow2&quot;</span> id=<span class="string">&quot;BPMNEdge_flow2&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;315.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;360.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow3&quot;</span> id=<span class="string">&quot;BPMNEdge_flow3&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;465.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;510.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">      &lt;bpmndi:BPMNEdge bpmnElement=<span class="string">&quot;flow4&quot;</span> id=<span class="string">&quot;BPMNEdge_flow4&quot;</span>&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;615.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">        &lt;omgdi:waypoint x=<span class="string">&quot;660.0&quot;</span> y=<span class="string">&quot;177.0&quot;</span>&gt;&lt;/omgdi:waypoint&gt;</span><br><span class="line">      &lt;/bpmndi:BPMNEdge&gt;</span><br><span class="line">    &lt;/bpmndi:BPMNPlane&gt;</span><br><span class="line">  &lt;/bpmndi:BPMNDiagram&gt;</span><br><span class="line">&lt;/definitions&gt;</span><br></pre></td></tr></table></figure>
<h4 id="22-使用步骤"><a class="markdownIt-Anchor" href="#22-使用步骤">#</a> 2.2 使用步骤</h4>
<h6 id="部署activiti"><a class="markdownIt-Anchor" href="#部署activiti">#</a> 部署 activiti</h6>
<p>Activiti 是一个工作流引擎（其实就是一堆 jar 包 API），业务系统访问 (操作) activiti 的接口，就可以方便的操作流程相关数据，这样就可以把工作流环境与业务系统的环境集成在一起。</p>
<h6 id="流程定义"><a class="markdownIt-Anchor" href="#流程定义">#</a> 流程定义</h6>
<p>使用 activiti 流程建模工具 (activity-designer) 定义业务流程 (.bpmn 文件) 。</p>
<p>.bpmn 文件就是业务流程定义文件，通过 xml 定义业务流程。</p>
<h6 id="流程定义部署"><a class="markdownIt-Anchor" href="#流程定义部署">#</a> 流程定义部署</h6>
<p>activiti 部署业务流程定义（.bpmn 文件）。</p>
<p>使用 activiti 提供的 api 把流程定义内容存储起来，在 Activiti 执行过程中可以查询定义的内容</p>
<p>Activiti 执行把流程定义内容存储在数据库中</p>
<h6 id="启动一个流程实例"><a class="markdownIt-Anchor" href="#启动一个流程实例">#</a> 启动一个流程实例</h6>
<p>流程实例也叫：ProcessInstance</p>
<p>启动一个流程实例表示开始一次业务流程的运行。</p>
<p>在员工请假流程定义部署完成后，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响。</p>
<h6 id="用户查询待办任务task"><a class="markdownIt-Anchor" href="#用户查询待办任务task">#</a> 用户查询待办任务 (Task)</h6>
<p>因为现在系统的业务流程已经交给 activiti 管理，通过 activiti 就可以查询当前流程执行到哪了，当前用户需要办理什么任务了，这些 activiti 帮我们管理了，而不需要开发人员自己编写在 sql 语句查询。</p>
<h6 id="用户办理任务"><a class="markdownIt-Anchor" href="#用户办理任务">#</a> 用户办理任务</h6>
<p>用户查询待办任务后，就可以办理某个任务，如果这个任务办理完成还需要其它用户办理，比如采购单创建后由部门经理审核，这个过程也是由 activiti 帮我们完成了。</p>
<h6 id="流程结束"><a class="markdownIt-Anchor" href="#流程结束">#</a> 流程结束</h6>
<p>当任务办理完成没有下一个任务结点了，这个流程实例就完成了。</p>
<h3 id="三-activiti环境"><a class="markdownIt-Anchor" href="#三-activiti环境">#</a> 三、Activiti 环境</h3>
<h4 id="31-开发环境"><a class="markdownIt-Anchor" href="#31-开发环境">#</a> 3.1 开发环境</h4>
<ul>
<li>Jdk1.8 或以上版本</li>
<li>Mysql 5 及以上的版本</li>
<li>Tomcat8.5</li>
<li>IDEA</li>
</ul>
<blockquote>
<p>注意：activiti 的流程定义工具插件可以安装在 IDEA 下，也可以安装在 Eclipse 工具下</p>
</blockquote>
<h4 id="32-activiti环境"><a class="markdownIt-Anchor" href="#32-activiti环境">#</a> 3.2 Activiti 环境</h4>
<p>我们使用： <code>Activiti7.0.0.Beta1</code>  默认支持 spring5</p>
<h4 id="321-下载activiti7"><a class="markdownIt-Anchor" href="#321-下载activiti7">#</a> 3.2.1 下载 activiti7</h4>
<p>Activiti 下载地址： <code>http://activiti.org/download.html</code>  ，Maven 的依赖如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencyManagement&gt;</span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;activiti-dependencies&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;<span class="number">7.0</span><span class="number">.0</span>.Beta1&lt;/version&gt;</span><br><span class="line">           &lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">           &lt;<span class="keyword">type</span>&gt;pom&lt;/<span class="keyword">type</span>&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">   &lt;/dependencies&gt;</span><br><span class="line">&lt;/dependencyManagement&gt;</span><br></pre></td></tr></table></figure>
<h6 id="1-database"><a class="markdownIt-Anchor" href="#1-database">#</a> 1) Database：</h6>
<p>activiti 运行需要有数据库的支持，支持的数据库有：h2, mysql, oracle, postgres, mssql, db2。</p>
<h5 id="322-流程设计器idea下安装"><a class="markdownIt-Anchor" href="#322-流程设计器idea下安装">#</a> 3.2.2 流程设计器 IDEA 下安装</h5>
<p>在 IDEA 的 File 菜单中找到子菜单”Settings”, 后面我们再选择左侧的 “plugins” 菜单，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6a554dcde54364bd5956c4315b6efb3f.png" alt="6a554dcde54364bd5956c4315b6efb3f.png"></p>
<p>此时我们就可以搜索到 actiBPM 插件，它就是 <code>Activiti Designer</code>  的 IDEA 版本，我们点击 Install 安装。</p>
<p>安装好后，页面如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3ce77485ef663bc305ef2ab181685dc4.png" alt="3ce77485ef663bc305ef2ab181685dc4.png"></p>
<p>提示需要重启 idea，点击重启。</p>
<p>重启完成后，再次打开 Settings 下的 Plugins（插件列表），点击右侧的 Installed（已安装的插件），在列表中看到 actiBPM，就说明已经安装成功了，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c5fd38ac92d7d87f1e7725d9325b8700.png" alt="c5fd38ac92d7d87f1e7725d9325b8700.png"></p>
<p>后面的课程里，我们会使用这个流程设计器进行 Activiti 的流程设计。</p>
<h4 id="33-activiti的数据库支持"><a class="markdownIt-Anchor" href="#33-activiti的数据库支持">#</a> 3.3 Activiti 的数据库支持</h4>
<p>Activiti 在运行时需要数据库的支持，使用 25 张表，把流程定义节点内容读取到数据库表中，以供后续使用。</p>
<h5 id="331-activiti-支持的数据库"><a class="markdownIt-Anchor" href="#331-activiti-支持的数据库">#</a> 3.3.1 Activiti 支持的数据库</h5>
<p>activiti 支持的数据库和版本如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a41fe8e76718ac216afa1ec8bd79f6b4.png" alt="a41fe8e76718ac216afa1ec8bd79f6b4.png"></p>
<h5 id="332-在mysql生成表"><a class="markdownIt-Anchor" href="#332-在mysql生成表">#</a> 3.3.2 在 MySQL 生成表</h5>
<p><strong>3.3.2.1 创建数据库</strong></p>
<p>创建 mysql 数据库 activiti （名字任意）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;</span><br></pre></td></tr></table></figure>
<p><strong>3.3.2.2 使用 java 代码生成表</strong></p>
<ul>
<li>创建 java 工程</li>
</ul>
<p>使用 idea 创建 java 的 maven 工程，取名：activiti01。</p>
<ul>
<li>加入 maven 依赖的坐标（jar 包）</li>
</ul>
<p>首先需要在 java 工程中加入 ProcessEngine 所需要的 jar 包，包括：</p>
<ol>
<li>activiti-engine-7.0.0.beta1.jar</li>
<li>activiti 依赖的 jar 包：mybatis、 alf4j、 log4j 等</li>
<li>activiti 依赖的 spring 包</li>
<li>mysql 数据库驱动</li>
<li>第三方数据连接池 dbcp</li>
<li>单元测试 Junit-4.12.jar</li>
</ol>
<p>我们使用 maven 来实现项目的构建，所以应当导入这些 jar 所对应的坐标到 pom.xml 文件中。</p>
<p>完整的依赖内容如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;slf4j.version&gt;<span class="number">1.6</span><span class="number">.6</span>&lt;/slf4j.version&gt;</span><br><span class="line">    &lt;log4j.version&gt;<span class="number">1.2</span><span class="number">.12</span>&lt;/log4j.version&gt;</span><br><span class="line">    &lt;activiti.version&gt;<span class="number">7.0</span><span class="number">.0</span>.Beta1&lt;/activiti.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-engine&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-spring&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 模型处理 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-model&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 转换 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-converter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn json数据转换 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-json-converter&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- bpmn 布局 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-bpmn-layout&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- activiti 云支持 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.activiti.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;activiti-cloud-services-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;activiti.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- mysql驱动 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">5.1</span><span class="number">.40</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- mybatis --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">3.4</span><span class="number">.5</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- 链接池 --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-dbcp&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-dbcp&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">1.4</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;<span class="number">4.12</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- log start --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;log4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;$&#123;slf4j.version&#125;&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 log4j 日志配置</li>
</ul>
<p>我们使用 log4j 日志包，可以对日志进行配置</p>
<p>在 resources 下创建 log4j.properties</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># Set root category priority to INFO and its only appender to CONSOLE.</span><br><span class="line">#log4j.rootCategory=INFO, CONSOLE debug info warn <span class="type">error</span> fatal</span><br><span class="line">log4j.rootCategory=debug, CONSOLE, LOGFILE</span><br><span class="line"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span><br><span class="line">log4j.logger.org.apache.axis.enterprise=FATAL, CONSOLE</span><br><span class="line"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span><br><span class="line">log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;ISO8601&#125; %<span class="number">-6</span>r[%<span class="number">15.15</span>t] %<span class="number">-5</span>p %<span class="number">30.30</span>c %x - %m\n</span><br><span class="line"># LOGFILE is set to be a File appender using a PatternLayout.</span><br><span class="line">log4j.appender.LOGFILE=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.LOGFILE.File=f:\act\activiti.log</span><br><span class="line">log4j.appender.LOGFILE.Append=<span class="literal">true</span></span><br><span class="line">log4j.appender.LOGFILE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.LOGFILE.layout.ConversionPattern=%d&#123;ISO8601&#125; %<span class="number">-6</span>r[%<span class="number">15.15</span>t] %<span class="number">-5</span>p %<span class="number">30.30</span>c %x - %m\n</span><br></pre></td></tr></table></figure>
<ul>
<li>添加 activiti 配置文件</li>
</ul>
<p>我们使用 activiti 提供的默认方式来创建 mysql 的表。</p>
<p>默认方式的要求是在 resources 下创建  <code>activiti.cfg.xml</code>  文件，注意：默认方式目录和文件名不能修改，因为 activiti 的源码中已经设置，到固定的目录读取固定文件名的文件。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>在 activiti.cfg.xml 中进行配置</li>
</ul>
<p>默认方式要在在 <code>activiti.cfg.xml</code>  中 bean 的名字叫 <code>processEngineConfiguration</code> ，名字不可修改</p>
<p>在这里有 2 中配置方式：一种是单独配置数据源，一种是不单独配置数据源</p>
<p>1、直接配置 <code>processEngineConfiguration</code></p>
<p><code>processEngineConfiguration</code>  用来创建  <code>ProcessEngine</code> ，在创建  <code>ProcessEngine</code>  时会执行数据库的操作。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- 默认id对应的值 为processEngineConfiguration --&gt;</span><br><span class="line">    &lt;!-- processEngine Activiti的流程引擎 --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcDriver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUrl&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUsername&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcPassword&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- activiti数据库表处理策略 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>2、配置数据源后，在 <code>processEngineConfiguration</code>  引用</p>
<p>首先配置数据源</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 这里可以使用 链接池 dbcp--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span> /&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span> /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 引用数据源 上面已经设置好了--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">        &lt;!-- activiti数据库表处理策略 --&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>java 类编写程序生成表</li>
</ul>
<p>创建一个测试类，调用 activiti 的工具类，生成 acitivti 需要的数据库表。</p>
<p>直接使用 activiti 提供的工具类 <code>ProcessEngines</code> ，会默认读取 classpath 下的 <code>activiti.cfg.xml</code>  文件，读取其中的数据库配置，创建  <code>ProcessEngine</code> ，在创建 <code>ProcessEngine</code>  时会自动创建表。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.activiti01.test;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"> </span><br><span class="line">public class TestDemo &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 activiti的数据库表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testCreateDbTable() &#123;</span><br><span class="line">        <span class="comment">//使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line">  ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">  System.out.<span class="built_in">println</span>(processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>运行以上程序段即可完成 activiti 表创建，通过改变  <code>activiti.cfg.xml</code>  中 <code>databaseSchemaUpdate</code>  参数的值执行不同的数据表处理策略。</li>
<li>上 边 的 方法  <code>getDefaultProcessEngine</code>  方法在执行时，从 <code>activiti.cfg.xml</code>  中找固定的名称  <code>processEngineConfiguration</code>  。</li>
</ul>
<p>在测试程序执行过程中，idea 的控制台会输出日志，说明程序正在创建数据表，类似如下，注意红线内容：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7fc3cd07647b00c2169abcc747a93f7a.png" alt="7fc3cd07647b00c2169abcc747a93f7a.png"></p>
<p>执行完成后我们查看数据库， 创建了 25 张表，结果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b3dc67533eaebcb9bee794061b94b4d2.png" alt="b3dc67533eaebcb9bee794061b94b4d2.png"></p>
<p>到这，我们就完成 activiti 运行需要的数据库和表的创建。</p>
<h4 id="34-表结构介绍"><a class="markdownIt-Anchor" href="#34-表结构介绍">#</a> 3.4 表结构介绍</h4>
<h5 id="341-表的命名规则和作用"><a class="markdownIt-Anchor" href="#341-表的命名规则和作用">#</a> 3.4.1 表的命名规则和作用</h5>
<p>看到刚才创建的表，我们发现 Activiti 的表都以  <code>ACT_ </code> 开头。</p>
<p>第二部分是表示表的用途的两个字母标识。用途也和服务的 API 对应。</p>
<ul>
<li><code>ACT_RE</code>  ：'RE’表示 repository。这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。</li>
<li><code>ACT_RU</code> ：'RU’表示 runtime。这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。Activiti 只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。这样运行时表可以一直很小速度很快。</li>
<li><code>ACT_HI</code> ：'HI’表示 history。这些表包含历史数据，比如历史流程实例， 变量，任务等等。</li>
<li><code>ACT_GE</code>  ：GE 表示 general。通用数据， 用于不同场景下</li>
</ul>
<h5 id="342-activiti数据表介绍"><a class="markdownIt-Anchor" href="#342-activiti数据表介绍">#</a> 3.4.2 Activiti 数据表介绍</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1c6b494498f9165d2b9e72af6d0d193b.png" alt="1c6b494498f9165d2b9e72af6d0d193b.png"></p>
<h3 id="四-activiti类关系图"><a class="markdownIt-Anchor" href="#四-activiti类关系图">#</a> 四、Activiti 类关系图</h3>
<p>上面我们完成了 Activiti 数据库表的生成，java 代码中我们调用 Activiti 的工具类，下面来了解 Activiti 的类关系</p>
<h4 id="41-类关系图"><a class="markdownIt-Anchor" href="#41-类关系图">#</a> 4.1 类关系图</h4>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/512e936b3d7c2e505d1f28991d5bf572.png" alt="512e936b3d7c2e505d1f28991d5bf572.png"></p>
<p>在新版本中，我们通过实验可以发现 <code>IdentityService</code> ， <code>FormService</code>  两个 Serivce 都已经删除了。</p>
<p>所以后面我们对于这两个 Service 也不讲解了，但老版本中还是有这两个 Service，同学们需要了解一下</p>
<h4 id="42-activiticfgxml"><a class="markdownIt-Anchor" href="#42-activiticfgxml">#</a> 4.2 activiti.cfg.xml</h4>
<p>activiti 的引擎配置文件，包括： <code>ProcessEngineConfiguration</code>  的定义、数据源定义、事务管理器等，此文件其实就是一个 spring 配置文件。</p>
<h4 id="43-流程引擎配置类"><a class="markdownIt-Anchor" href="#43-流程引擎配置类">#</a> 4.3 流程引擎配置类</h4>
<p>流程引擎的配置类（ <code>ProcessEngineConfiguration</code> ），通过 <code>ProcessEngineConfiguration</code>  可以创建工作流引擎 <code>ProceccEngine</code> ，常用的两种方法如下：</p>
<h5 id="431-standaloneprocessengineconfiguration"><a class="markdownIt-Anchor" href="#431-standaloneprocessengineconfiguration">#</a> 4.3.1 StandaloneProcessEngineConfiguration</h5>
<p>使用 <code>StandaloneProcessEngineConfigurationActiviti</code>  可以单独运行，来创建 <code>ProcessEngine</code> ， <code>Activiti</code>  会自己处理事务。</p>
<p>配置文件方式：</p>
<p>通常在 <code>activiti.cfg.xml</code>  配置文件中定义一个 id 为  <code>processEngineConfiguration</code>  的 bean。</p>
<p>方法如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!--配置数据库相关的信息--&gt;</span><br><span class="line">        &lt;!--数据库驱动--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcDriver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库链接--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUrl&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库用户名--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcUsername&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;!--数据库密码--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;jdbcPassword&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;!--actviti数据库表在生成时的策略  <span class="literal">true</span> - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>还可以加入连接池:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/contex</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span>/&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--在默认方式下 bean的id  固定为 processEngineConfiguration--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span></span><br><span class="line">          class=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">        &lt;!--引入上面配置好的 链接池--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span>/&gt;</span><br><span class="line">        &lt;!--actviti数据库表在生成时的策略  <span class="literal">true</span> - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h5 id="432-springprocessengineconfiguration"><a class="markdownIt-Anchor" href="#432-springprocessengineconfiguration">#</a> 4.3.2 SpringProcessEngineConfiguration</h5>
<p>通过 <code>org.activiti.spring.SpringProcessEngineConfiguration</code>  与 Spring 整合。</p>
<p>创建 spring 与 activiti 的整合配置文件：</p>
<p><code>activity-spring.cfg.xml</code> （名称可修改）</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">   xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns:mvc=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="line">xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">   xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> xmlns:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/beans/spring-beans-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/mvc </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/context </span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/aop </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/aop/spring-aop-3.1.xsd </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/tx </span></span><br><span class="line"><span class="string">      http://www.springframework.org/schema/tx/spring-tx-3.1.xsd &quot;</span>&gt;</span><br><span class="line">   &lt;!-- 工作流引擎配置bean --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;processEngineConfiguration&quot;</span> class=<span class="string">&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;</span>&gt;</span><br><span class="line">      &lt;!-- 数据源 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- 使用spring事务管理器 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;transactionManager&quot;</span> ref=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- 数据库策略 --&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;databaseSchemaUpdate&quot;</span> value=<span class="string">&quot;drop-create&quot;</span> /&gt;</span><br><span class="line">      &lt;!-- activiti的定时任务关闭 --&gt;</span><br><span class="line">     &lt;property name=<span class="string">&quot;jobExecutorActivate&quot;</span> value=<span class="string">&quot;false&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 流程引擎 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;processEngine&quot;</span> class=<span class="string">&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;processEngineConfiguration&quot;</span> ref=<span class="string">&quot;processEngineConfiguration&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 资源服务service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;repositoryService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getRepositoryService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 流程运行service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;runtimeService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getRuntimeService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 任务管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;taskService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span></span><br><span class="line">      factory-method=<span class="string">&quot;getTaskService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 历史管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;historyService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getHistoryService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 用户管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;identityService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getIdentityService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 引擎管理service --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;managementService&quot;</span> factory-bean=<span class="string">&quot;processEngine&quot;</span> factory-method=<span class="string">&quot;getManagementService&quot;</span> /&gt;</span><br><span class="line">   &lt;!-- 数据源 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;dataSource&quot;</span> class=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;driverClassName&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://localhost:3306/activiti&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;mysql&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;maxActive&quot;</span> value=<span class="string">&quot;3&quot;</span> /&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;maxIdle&quot;</span> value=<span class="string">&quot;1&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 事务管理器 --&gt;</span><br><span class="line">   &lt;bean id=<span class="string">&quot;transactionManager&quot;</span></span><br><span class="line">    class=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br><span class="line">      &lt;property name=<span class="string">&quot;dataSource&quot;</span> ref=<span class="string">&quot;dataSource&quot;</span> /&gt;</span><br><span class="line">   &lt;/bean&gt;</span><br><span class="line">   &lt;!-- 通知 --&gt;</span><br><span class="line">   &lt;tx:advice id=<span class="string">&quot;txAdvice&quot;</span> transaction-manager=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><br><span class="line">      &lt;tx:attributes&gt;&lt;/tx:attributes&gt;</span><br><span class="line">          &lt;!-- 传播行为 --&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;save*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;insert*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;delete*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;update*&quot;</span> propagation=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;find*&quot;</span> propagation=<span class="string">&quot;SUPPORTS&quot;</span> read-only=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line">          &lt;tx:method name=<span class="string">&quot;get*&quot;</span> propagation=<span class="string">&quot;SUPPORTS&quot;</span> read-only=<span class="string">&quot;true&quot;</span> /&gt;</span><br><span class="line">       &lt;/tx:attributes&gt;</span><br><span class="line">   &lt;/tx:advice&gt;</span><br><span class="line">   &lt;!-- 切面，根据具体项目修改切点配置 --&gt;</span><br><span class="line">   &lt;aop:config proxy-target-class=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">      &lt;aop:advisor advice-ref=<span class="string">&quot;txAdvice&quot;</span>  pointcut=<span class="string">&quot;execution(* com.itheima.ihrm.service.impl.*.(..))&quot;</span>* /&gt;</span><br><span class="line">  &lt;/aop:config&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<p>创建 <code>processEngineConfiguration</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration configuration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>上边的代码要求 <code>activiti.cfg.xml</code>  中必须有一个 <code>processEngineConfiguration</code>  的 bean</p>
<p>也可以使用下边的方法，更改 bean 的名字：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);</span><br></pre></td></tr></table></figure>
<h4 id="44-工作流引擎创建"><a class="markdownIt-Anchor" href="#44-工作流引擎创建">#</a> 4.4 工作流引擎创建</h4>
<p>工作流引擎（ProcessEngine），相当于一个门面接口，通过 <code>ProcessEngineConfiguration</code>  创建 <code>processEngine</code> ，通过 <code>ProcessEngine</code>  创建各个 service 接口。</p>
<h5 id="441-默认创建方式"><a class="markdownIt-Anchor" href="#441-默认创建方式">#</a> 4.4.1 默认创建方式</h5>
<p>将 <code>activiti.cfg.xml</code>  文件名及路径固定，且 <code>activiti.cfg.xml</code>  文件中有  <code>processEngineConfiguration</code>  的配置， 可以使用如下代码创建 <code>processEngine</code> :</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接使用工具类 ProcessEngines，使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line">ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">System.out.<span class="built_in">println</span>(processEngine);</span><br></pre></td></tr></table></figure>
<h5 id="442-一般创建方式"><a class="markdownIt-Anchor" href="#442-一般创建方式">#</a> 4.4.2 一般创建方式</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先构建ProcessEngineConfiguration</span></span><br><span class="line">ProcessEngineConfiguration configuration = ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>);</span><br><span class="line"><span class="comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span></span><br><span class="line">ProcessEngine processEngine = configuration.buildProcessEngine();</span><br></pre></td></tr></table></figure>
<h5 id="45-servcie服务接口"><a class="markdownIt-Anchor" href="#45-servcie服务接口">#</a> 4.5 Servcie 服务接口</h5>
<p>Service 是工作流引擎提供用于进行工作流部署、执行、管理的服务接口，我们使用这些接口可以就是操作服务对应的数据表</p>
<p>4.5.1 Service 创建方式</p>
<p>通过 ProcessEngine 创建 Service</p>
<p>方式如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line">RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line">TaskService taskService = processEngine.getTaskService();</span><br></pre></td></tr></table></figure>
<p>4.5.2 Service 总览</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5697fc50f337d0e67354c93535c14cb2.png" alt="5697fc50f337d0e67354c93535c14cb2.png"></p>
<p>简单介绍：</p>
<ul>
<li><strong>RepositoryService</strong></li>
</ul>
<p>是 activiti 的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此 service 将流程定义文件的内容部署到计算机。</p>
<p>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</p>
<p>暂停或激活发布包，对应全部和特定流程定义。暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</p>
<p>获得流程定义的 pojo 版本， 可以用来通过 java 解析流程，而不必通过 xml。</p>
<ul>
<li><strong>RuntimeService</strong></li>
</ul>
<p>Activiti 的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</p>
<ul>
<li><strong>TaskService</strong></li>
</ul>
<p>Activiti 的任务管理类。可以从这个类中获取任务的信息。</p>
<ul>
<li><strong>HistoryService</strong></li>
</ul>
<p>Activiti 的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。这个服务主要通过查询功能来获得这些数据。</p>
<ul>
<li><strong>ManagementService</strong></li>
</ul>
<p>Activiti 的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</p>
<h3 id="五-activiti入门"><a class="markdownIt-Anchor" href="#五-activiti入门">#</a> 五、Activiti 入门</h3>
<p>在本章内容中，我们来创建一个 Activiti 工作流，并启动这个流程。</p>
<p>创建 Activiti 工作流主要包含以下几步：</p>
<ul>
<li>定义流程，按照 BPMN 的规范，使用流程定义工具，用流程符号把整个流程描述出来</li>
<li>部署流程，把画好的流程定义文件，加载到数据库中，生成表的数据</li>
<li>启动流程，使用 java 代码来操作数据库表中的内容</li>
</ul>
<h4 id="51-流程符号"><a class="markdownIt-Anchor" href="#51-流程符号">#</a> 5.1 流程符号</h4>
<p>BPMN 2.0 是业务流程建模符号 2.0 的缩写。</p>
<p>它由 Business Process Management Initiative 这个非营利协会创建并不断发展。作为一种标识，BPMN 2.0 是使用一些符号来明确业务流程设计流程图的一整套符号规范，它能增进业务建模时的沟通效率。</p>
<p>目前 BPMN2.0 是最新的版本，它用于在 BPM 上下文中进行布局和可视化的沟通。</p>
<p>接下来我们先来了解在流程设计中常见的 符号。</p>
<p>BPMN2.0 的基本符合主要包含：</p>
<h5 id="事件-event"><a class="markdownIt-Anchor" href="#事件-event">#</a> 事件 Event</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/118051bcb888229c8b6a28c96dd70ae4.png" alt="118051bcb888229c8b6a28c96dd70ae4.png"></p>
<h5 id="活动-activity"><a class="markdownIt-Anchor" href="#活动-activity">#</a> 活动 Activity</h5>
<p>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程；其次，你还可以为活动指定不同的类型。常见活动如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ec675c381810e1f8f779d3852e619ad2.png" alt="ec675c381810e1f8f779d3852e619ad2.png"></p>
<h5 id="网关-gateway"><a class="markdownIt-Anchor" href="#网关-gateway">#</a> 网关 GateWay</h5>
<p>网关用来处理决策，有几种常用网关需要了解：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7e81eb95b7c1149abb5b5f4a467bcf5a.png" alt="7e81eb95b7c1149abb5b5f4a467bcf5a.png"></p>
<p><strong>排他网关 (x)</strong></p>
<p>—— 只有一条路径会被选择。流程执行到该网关时，按照输出流的顺序逐个计算，当条件的计算结果为 true 时，继续执行当前网关的输出流；</p>
<ul>
<li>如果多条线路计算结果都是 true，则会执行第一个值为 true 的线路。如果所有网关计算结果没有 true，则引擎会抛出异常。</li>
<li>排他网关需要和条件顺序流结合使用，default 属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。</li>
</ul>
<p><strong>并行网关 (+)</strong></p>
<p>—— 所有路径会被同时选择</p>
<ul>
<li>拆分 —— 并行执行所有输出顺序流，为每一条顺序流创建一个并行执行线路。</li>
<li>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</li>
</ul>
<p><strong>包容网关 (+)</strong></p>
<p>—— 可以同时执行多条线路，也可以在网关上设置条件</p>
<ul>
<li>拆分 —— 计算每条线路上的表达式，当表达式计算结果为 true 时，创建一个并行线路并继续执行</li>
<li>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</li>
</ul>
<p><strong>事件网关 (+)</strong></p>
<p>—— 专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态。</p>
<h5 id="流向-flow"><a class="markdownIt-Anchor" href="#流向-flow">#</a> 流向 Flow</h5>
<p>流是连接两个流程节点的连线。常见的流向包含以下几种：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/82c584939f73517735eb4b8ba0594611.png" alt="82c584939f73517735eb4b8ba0594611.png"></p>
<h4 id="52-流程设计器使用"><a class="markdownIt-Anchor" href="#52-流程设计器使用">#</a> 5.2 流程设计器使用</h4>
<h5 id="activiti-designer使用"><a class="markdownIt-Anchor" href="#activiti-designer使用">#</a> Activiti-Designer 使用</h5>
<h5 id="palette画板"><a class="markdownIt-Anchor" href="#palette画板">#</a> Palette（画板）</h5>
<p>在 idea 中安装插件即可使用，画板中包括以下结点：</p>
<ul>
<li>Connection— 连接</li>
<li>Event— 事件</li>
<li>Task— 任务</li>
<li>Gateway— 网关</li>
<li>Container— 容器</li>
<li>Boundary event— 边界事件</li>
<li>Intermediate event- - 中间事件</li>
</ul>
<p>流程图设计完毕保存生成.bpmn 文件</p>
<h5 id="新建流程idea工具"><a class="markdownIt-Anchor" href="#新建流程idea工具">#</a> 新建流程 (IDEA 工具)</h5>
<p>首先选中存放图形的目录 (选择 resources 下的 bpmn 目录)，点击菜单： <code>New -&gt; BpmnFile</code> ，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/06bc384d8f71d945be74121218df4109.png" alt="06bc384d8f71d945be74121218df4109.png"></p>
<p>弹出如下图所示框，输入 evection 表示 出差审批流程：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/d358a2338ab5a332f74f8f7732225fda.png" alt="d358a2338ab5a332f74f8f7732225fda.png"></p>
<p>起完名字 evection 后（默认扩展名为 bpmn），就可以看到流程设计页面，如图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/26b2c4c13f7b329cb7cdd6d289676167.png" alt="26b2c4c13f7b329cb7cdd6d289676167.png"></p>
<p>左侧区域是绘图区，右侧区域是 palette 画板区域</p>
<p>鼠标先点击画板的元素即可在左侧绘图</p>
<h5 id="绘制流程"><a class="markdownIt-Anchor" href="#绘制流程">#</a> 绘制流程</h5>
<p>使用滑板来绘制流程，通过从右侧把图标拖拽到左侧的画板，最终效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/80e48a5d861bcaaf4e27c0676dfafff6.png" alt="80e48a5d861bcaaf4e27c0676dfafff6.png"></p>
<h5 id="指定流程定义key"><a class="markdownIt-Anchor" href="#指定流程定义key">#</a> 指定流程定义 Key</h5>
<p>流程定义 key 即流程定义的标识，通过 properties 视图查看流程的 key</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/42ebf534f78c3895c98c4ecd5d68b301.png" alt="42ebf534f78c3895c98c4ecd5d68b301.png"></p>
<h5 id="指定任务负责人"><a class="markdownIt-Anchor" href="#指定任务负责人">#</a> 指定任务负责人</h5>
<p>在 properties 视图指定每个任务结点的负责人，如：填写出差申请的负责人为 zhangsan</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/62d692f310cb319cf4c4c964bb2aadcc.png" alt="62d692f310cb319cf4c4c964bb2aadcc.png"></p>
<ul>
<li>经理审批负责人为 jerry</li>
<li>总经理审批负责人为 jack</li>
<li>财务审批负责人为 rose</li>
</ul>
<h3 id="六-流程操作"><a class="markdownIt-Anchor" href="#六-流程操作">#</a> 六、流程操作</h3>
<h4 id="61-流程定义"><a class="markdownIt-Anchor" href="#61-流程定义">#</a> 6.1 流程定义</h4>
<h5 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h5>
<p>流程定义是线下按照 bpmn2.0 标准去描述 业务流程，通常使用 idea 中的插件对业务流程进行建模。IDEA 插件介绍：<a href="">IDEA 值得推荐的十几款优秀插件，狂，拽，屌！</a></p>
<p>使用 idea 下的 designer 设计器绘制流程，并会生成两个文件：.bpmn 和.png</p>
<h5 id="bpmn文件"><a class="markdownIt-Anchor" href="#bpmn文件">#</a> .bpmn 文件</h5>
<p>使用 activiti-desinger 设计业务流程，会生成.bpmn 文件，上面我们已经创建好了 bpmn 文件</p>
<p>BPMN 2.0 根节点是 definitions 节点。这个元素中，可以定义多个流程定义（不过我们建议每个文件只包含一个流程定义， 可以简化开发过程中的维护难度）。</p>
<blockquote>
<p>注意，definitions 元素 最少也要包含 xmlns 和 targetNamespace 的声明。targetNamespace 可以是任意值，它用来对流程实例进行分类。</p>
</blockquote>
<ul>
<li>流程定义部分：定义了流程每个结点的描述及结点之间的流程流转。</li>
<li>流程布局定义：定义流程每个结点在流程图上的位置坐标等信息。</li>
</ul>
<h5 id="生成png图片文件"><a class="markdownIt-Anchor" href="#生成png图片文件">#</a> 生成.png 图片文件</h5>
<p>IDEA 工具中的操作方式</p>
<p><strong>1、修改文件后缀为 xml</strong></p>
<p>首先将 evection.bpmn 文件改名为 evection.xml，如下图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6b8b3168ec2eb053d23dd89e760eb66c.png" alt="6b8b3168ec2eb053d23dd89e760eb66c.png"></p>
<p>evection.xml 修改前的 bpmn 文件，效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/05323c8f1d142e4a50be0998af182de9.png" alt="05323c8f1d142e4a50be0998af182de9.png"></p>
<p><strong>2、使用 designer 设计器打开.xml 文件</strong></p>
<p>在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 <code>Show BPMN2.0 Designer…</code></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fbfd788c624ebe75fbf8dc38dce5d1ec.png" alt="fbfd788c624ebe75fbf8dc38dce5d1ec.png"></p>
<p><strong>3、查看打开的文件</strong></p>
<p>打开后，却出现乱码，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/35b69a94cf23e9e801955824c1763dd9.png" alt="35b69a94cf23e9e801955824c1763dd9.png"></p>
<p><strong>4、解决中文乱码</strong></p>
<p>1、打开 Settings，找到 File Encodings，把 encoding 的选项都选择 UTF-8</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f114de04f6d9a6371ecfc8f3ec7138cf.png" alt="f114de04f6d9a6371ecfc8f3ec7138cf.png"></p>
<p>2、打开 IDEA 安装路径，找到如下的安装目录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/33d300d7dbf3078d72555e22357622e3.png" alt="33d300d7dbf3078d72555e22357622e3.png"></p>
<p>根据自己所安装的版本来决定，我使用的是 64 位的 idea，所以在 <code>idea64.exe.vmoptions</code>  文件的最后一行追加一条命令： <code> -Dfile.encoding=UTF-8</code></p>
<p>如下所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/d848eb7069122f8a2cb5de6e05fe99a8.png" alt="d848eb7069122f8a2cb5de6e05fe99a8.png"></p>
<p>一定注意，不要有空格，否则重启 IDEA 时会打不开，然后 重启 IDEA。</p>
<p>如果以上方法已经做完，还出现乱码，就再修改一个文件，并在文件的末尾添加： <code>-Dfile.encoding=UTF-8</code> ，然后重启 idea，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6f4f2a580c57e5e4a05f3822974b6b50.png" alt="6f4f2a580c57e5e4a05f3822974b6b50.png"></p>
<p>最后重新在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 <code>Show BPMN2.0 Designer…</code> ，看到生成图片，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7c8f334d658e8275844d6c7ac165881a.png" alt="7c8f334d658e8275844d6c7ac165881a.png"></p>
<p>到此，解决乱码问题</p>
<h5 id="5-导出为图片文件"><a class="markdownIt-Anchor" href="#5-导出为图片文件">#</a> 5、导出为图片文件</h5>
<p>点击 <code>Export To File</code>  的小图标，打开如下窗口，注意填写文件名及扩展名，选择好保存图片的位置：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/963675cefb4d34535e003d7d791564ab.png" alt="963675cefb4d34535e003d7d791564ab.png"></p>
<p>然后，我们把 png 文件拷贝到 resources 下的 bpmn 目录，并且把 evection.xml 改名为 evection.bpmn。</p>
<h4 id="62-流程定义部署"><a class="markdownIt-Anchor" href="#62-流程定义部署">#</a> 6.2 流程定义部署</h4>
<h5 id="概述-2"><a class="markdownIt-Anchor" href="#概述-2">#</a> 概述</h5>
<p>将上面在设计器中定义的流程部署到 activiti 数据库中，就是流程定义部署。</p>
<p>通过调用 activiti 的 api 将流程定义的 bpmn 和 png 两个文件一个一个添加部署到 activiti 中，也可以将两个文件打成 zip 包进行部署。</p>
<h5 id="单个文件部署方式"><a class="markdownIt-Anchor" href="#单个文件部署方式">#</a> 单个文件部署方式</h5>
<p>分别将 bpmn 文件和 png 图片文件部署。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class ActivitiDemo &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testDeployment()&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、得到RepositoryService实例</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、使用RepositoryService进行部署</span></span><br><span class="line">        Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源</span></span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.png&quot;</span>)  <span class="comment">// 添加png资源</span></span><br><span class="line">                .name(<span class="string">&quot;出差申请流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line"><span class="comment">//        4、输出部署信息</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h5 id="压缩包部署方式"><a class="markdownIt-Anchor" href="#压缩包部署方式">#</a> 压缩包部署方式</h5>
<p>将 <code>evection.bpmn</code>  和 <code>evection.png</code>  压缩成 zip 包。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line"> public void deployProcessByZip() &#123;</span><br><span class="line">  <span class="comment">// 定义zip输入流</span></span><br><span class="line">  InputStream inputStream = this</span><br><span class="line">    .getClass()</span><br><span class="line">    .getClassLoader()</span><br><span class="line">    .getResourceAsStream(</span><br><span class="line">      <span class="string">&quot;bpmn/evection.zip&quot;</span>);</span><br><span class="line">  ZipInputStream zipInputStream = <span class="built_in">new</span> ZipInputStream(inputStream);</span><br><span class="line">  <span class="comment">// 获取repositoryService</span></span><br><span class="line">  RepositoryService repositoryService = processEngine</span><br><span class="line">    .getRepositoryService();</span><br><span class="line">  <span class="comment">// 流程部署</span></span><br><span class="line">  Deployment deployment = repositoryService.createDeployment()</span><br><span class="line">    .addZipInputStream(zipInputStream)</span><br><span class="line">    .deploy();</span><br><span class="line">  System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">  System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h5 id="操作数据表"><a class="markdownIt-Anchor" href="#操作数据表">#</a> 操作数据表</h5>
<p>流程定义部署后操作 activiti 的 3 张表如下：</p>
<ul>
<li><code>act_re_deployment</code>  流程定义部署表，每部署一次增加一条记录</li>
<li><code>act_re_procdef</code>  流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</li>
<li><code>act_ge_bytearray</code>  流程资源表</li>
</ul>
<p>接下来我们来看看，写入了什么数据：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_re_deployment #流程定义部署表，记录流程部署信息</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/492052ea6a018366c6b003caa0f64fad.png" alt="492052ea6a018366c6b003caa0f64fad.png"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_re_procdef #流程定义表，记录流程定义信息</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<blockquote>
<p>注意，KEY 这个字段是用来唯一识别不同流程的关键字</p>
</blockquote>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/71cdab928e7ef851cfc1f0db25478d57.png" alt="71cdab928e7ef851cfc1f0db25478d57.png"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM act_ge_bytearray #资源表</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/940b8ba4b3f730e7a38ba0ba6d2829a3.png" alt="940b8ba4b3f730e7a38ba0ba6d2829a3.png"></p>
<p>注意：</p>
<p><code>act_re_deployment</code>  和 <code>act_re_procdef</code>  一对多关系，一次部署在流程部署表生成一条记录，但一次部署可以部署多个流程定义，每个流程定义在流程定义表生成一条记录。每一个流程定义在 <code>act_ge_bytearray</code>  会存在两个资源记录，bpmn 和 png。</p>
<p>建议：一次部署一个流程，这样部署表和流程定义表是一对一有关系，方便读取流程部署及流程定义信息。</p>
<h4 id="63-启动流程实例"><a class="markdownIt-Anchor" href="#63-启动流程实例">#</a> 6.3 启动流程实例</h4>
<p>流程定义部署在 activiti 后就可以通过工作流管理业务流程了，也就是说上边部署的出差申请流程可以使用了。</p>
<p>针对该流程，启动一个流程表示发起一个新的出差申请单，这就相当于 java 类与 java 对象的关系，类定义好后需要 new 创建一个对象使用，当然可以 new 多个对象。对于请出差申请流程，张三发起一个出差申请单需要启动一个流程实例，出差申请单发起一个出差单也需要启动一个流程实例。</p>
<p>代码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动流程实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testStartProcess()&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取RunTimeService</span></span><br><span class="line">        RuntimeService runtimeService = processEngine.getRuntimeService();</span><br><span class="line"><span class="comment">//        3、根据流程定义Id启动流程</span></span><br><span class="line">        ProcessInstance processInstance = runtimeService</span><br><span class="line">                .startProcessInstanceByKey(<span class="string">&quot;myEvection&quot;</span>);</span><br><span class="line"><span class="comment">//        输出内容</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出内容如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/dcc6ccc278787f998b09291d1e13630d.png" alt="dcc6ccc278787f998b09291d1e13630d.png"></p>
<p>操作数据表</p>
<ul>
<li><code>act_hi_actinst</code>  流程实例执行历史</li>
<li><code>act_hi_identitylink</code>  流程的参与用户历史信息</li>
<li><code>act_hi_procinst</code>  流程实例历史信息</li>
<li><code>act_hi_taskinst</code>  流程任务历史信息</li>
<li><code>act_ru_execution</code>  流程执行信息</li>
<li><code>act_ru_identitylink</code>  流程的参与用户信息</li>
<li><code>act_ru_task</code>  任务信息</li>
</ul>
<h4 id="64-任务查询"><a class="markdownIt-Anchor" href="#64-任务查询">#</a> 6.4 任务查询</h4>
<p>流程启动后，任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询当前个人待执行的任务</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void testFindPersonalTaskList() &#123;</span><br><span class="line"><span class="comment">//        任务负责人</span></span><br><span class="line">        String assignee = <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        创建TaskService</span></span><br><span class="line">        TaskService taskService = processEngine.getTaskService();</span><br><span class="line"><span class="comment">//        根据流程key 和 任务负责人 查询任务</span></span><br><span class="line">        List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(assignee)<span class="comment">//只查询该任务负责人的任务</span></span><br><span class="line">                .list();</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line"> </span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程实例id：<span class="number">2501</span></span><br><span class="line">任务id：<span class="number">2505</span></span><br><span class="line">任务负责人：zhangsan</span><br><span class="line">任务名称：创建出差申请</span><br></pre></td></tr></table></figure>
<h4 id="65-流程任务处理"><a class="markdownIt-Anchor" href="#65-流程任务处理">#</a> 6.5 流程任务处理</h4>
<p>任务负责人查询待办任务，选择任务进行处理，完成任务。微信搜索公众号：Java 项目精选，回复：java 领取资料 。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完成任务</span></span><br><span class="line">    @Test</span><br><span class="line">    public void completTask()&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取taskService</span></span><br><span class="line">        TaskService taskService = processEngine.getTaskService();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//        根据流程key 和 任务的负责人 查询任务</span></span><br><span class="line"><span class="comment">//        返回一个任务对象</span></span><br><span class="line">        Task task = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">                .singleResult();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//        完成任务,参数：任务id</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="66-流程定义信息查询"><a class="markdownIt-Anchor" href="#66-流程定义信息查询">#</a> 6.6 流程定义信息查询</h4>
<p>查询流程相关信息，包含流程定义，流程部署，流程定义版本</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void queryProcessDefinition()&#123;</span><br><span class="line">        <span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        得到ProcessDefinitionQuery 对象</span></span><br><span class="line">        ProcessDefinitionQuery processDefinitionQuery = repositoryService.createProcessDefinitionQuery();</span><br><span class="line"><span class="comment">//          查询出当前所有的流程定义</span></span><br><span class="line"><span class="comment">//          条件：processDefinitionKey =evection</span></span><br><span class="line"><span class="comment">//          orderByProcessDefinitionVersion 按照版本排序</span></span><br><span class="line"><span class="comment">//        desc倒叙</span></span><br><span class="line"><span class="comment">//        list 返回集合</span></span><br><span class="line">        List&lt;ProcessDefinition&gt; definitionList = processDefinitionQuery.processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .orderByProcessDefinitionVersion()</span><br><span class="line">                .desc()</span><br><span class="line">                .list();</span><br><span class="line"><span class="comment">//      输出流程定义信息</span></span><br><span class="line">        <span class="keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 id=&quot;</span>+processDefinition.getId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 name=&quot;</span>+processDefinition.getName());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 key=&quot;</span>+processDefinition.getKey());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程定义 Version=&quot;</span>+processDefinition.getVersion());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;流程部署ID =&quot;</span>+processDefinition.getDeploymentId());</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程定义id：myEvection:<span class="number">1</span>:<span class="number">4</span></span><br><span class="line">流程定义名称：出差申请单</span><br><span class="line">流程定义key：myEvection</span><br><span class="line">流程定义版本：<span class="number">1</span></span><br></pre></td></tr></table></figure>
<h4 id="67-流程删除"><a class="markdownIt-Anchor" href="#67-流程删除">#</a> 6.7 流程删除</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public void deleteDeployment() &#123;</span><br><span class="line">  <span class="comment">// 流程部署id</span></span><br><span class="line">  String deploymentId = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">  </span><br><span class="line">    ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 通过流程引擎获取repositoryService</span></span><br><span class="line">  RepositoryService repositoryService = processEngine</span><br><span class="line">    .getRepositoryService();</span><br><span class="line">  <span class="comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span></span><br><span class="line">  repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">  <span class="comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span></span><br><span class="line">  <span class="comment">//repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>使用 repositoryService 删除流程定义，历史表信息不会被删除</li>
<li>如果该流程定义下没有正在运行的流程，则可以用普通删除。</li>
</ul>
<p>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。</p>
<p>先删除没有完成流程节点，最后就可以完全删除流程定义信息</p>
<p>项目开发中级联删除操作一般只开放给超级管理员使用.</p>
<h4 id="68-流程资源下载"><a class="markdownIt-Anchor" href="#68-流程资源下载">#</a> 6.8 流程资源下载</h4>
<p>现在我们的流程资源文件已经上传到数据库了，如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载到本地。</p>
<p>解决方案有：</p>
<ul>
<li>jdbc 对 blob 类型，clob 类型数据读取出来，保存到文件目录</li>
<li>使用 activiti 的 api 来实现</li>
</ul>
<p>使用 commons-io.jar 解决 IO 的操作</p>
<p>引入 commons-io 依赖包</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.6</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>通过流程定义对象获取流程定义资源，获取 bpmn 和 png</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"> </span><br><span class="line">	@Test</span><br><span class="line">    public void deleteDeployment()&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        根据部署id 删除部署信息,如果想要级联删除，可以添加第二个参数，true</span></span><br><span class="line">        repositoryService.deleteDeployment(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public void  queryBpmnFile() throws IOException &#123;</span><br><span class="line"><span class="comment">//        1、得到引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取repositoryService</span></span><br><span class="line">        RepositoryService repositoryService = processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、得到查询器：ProcessDefinitionQuery，设置查询条件,得到想要的流程定义</span></span><br><span class="line">        ProcessDefinition processDefinition = repositoryService.createProcessDefinitionQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line"><span class="comment">//        4、通过流程定义信息，得到部署ID</span></span><br><span class="line">        String deploymentId = processDefinition.getDeploymentId();</span><br><span class="line"><span class="comment">//        5、通过repositoryService的方法，实现读取图片信息和bpmn信息</span></span><br><span class="line"><span class="comment">//        png图片的流</span></span><br><span class="line">        InputStream pngInput = repositoryService.getResourceAsStream(deploymentId, processDefinition.getDiagramResourceName());</span><br><span class="line"><span class="comment">//        bpmn文件的流</span></span><br><span class="line">        InputStream bpmnInput = repositoryService.getResourceAsStream(deploymentId, processDefinition.getResourceName());</span><br><span class="line"><span class="comment">//        6、构造OutputStream流</span></span><br><span class="line">        File file_png = <span class="built_in">new</span> File(<span class="string">&quot;d:/evectionflow01.png&quot;</span>);</span><br><span class="line">        File file_bpmn = <span class="built_in">new</span> File(<span class="string">&quot;d:/evectionflow01.bpmn&quot;</span>);</span><br><span class="line">        FileOutputStream bpmnOut = <span class="built_in">new</span> FileOutputStream(file_bpmn);</span><br><span class="line">        FileOutputStream pngOut = <span class="built_in">new</span> FileOutputStream(file_png);</span><br><span class="line"><span class="comment">//        7、输入流，输出流的转换</span></span><br><span class="line">        IOUtils.<span class="built_in">copy</span>(pngInput,pngOut);</span><br><span class="line">        IOUtils.<span class="built_in">copy</span>(bpmnInput,bpmnOut);</span><br><span class="line"><span class="comment">//        8、关闭流</span></span><br><span class="line">        pngOut.<span class="built_in">close</span>();</span><br><span class="line">        bpmnOut.<span class="built_in">close</span>();</span><br><span class="line">        pngInput.<span class="built_in">close</span>();</span><br><span class="line">        bpmnInput.<span class="built_in">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li><code>deploymentId</code>  为流程部署 ID</li>
<li><code>resource_name</code>  为 <code>act_ge_bytearray</code>  表中 NAME_列的值</li>
<li>使用 <code>repositoryService</code>  的 <code>getDeploymentResourceNames</code>  方法可以获取指定部署下得所有文件的名称</li>
<li>使用 <code>repositoryService</code>  的 <code>getResourceAsStream</code>  方法传入部署 ID 和资源图片名称可以获取部署下指定名称文件的输入流</li>
</ul>
<p>最后的将输入流中的图片资源进行输出。</p>
<h4 id="69-流程历史信息的查看"><a class="markdownIt-Anchor" href="#69-流程历史信息的查看">#</a> 6.9 流程历史信息的查看</h4>
<p>即使流程定义已经删除了，流程执行的历史信息通过前面的分析，依然保存在 activiti 的 <code>act_hi_*</code>  相关的表中。所以我们还是可以查询流程执行的历史信息，可以通过 <code>HistoryService</code>  来查看相关的历史记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看历史信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Test</span><br><span class="line">    public void findHistoryInfo()&#123;</span><br><span class="line"><span class="comment">//      获取引擎</span></span><br><span class="line">        ProcessEngine processEngine = ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取HistoryService</span></span><br><span class="line">        HistoryService historyService = processEngine.getHistoryService();</span><br><span class="line"><span class="comment">//        获取 actinst表的查询对象</span></span><br><span class="line">        HistoricActivityInstanceQuery instanceQuery = historyService.createHistoricActivityInstanceQuery();</span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 InstanceId 查询</span></span><br><span class="line"><span class="comment">//        instanceQuery.processInstanceId(&quot;2501&quot;);</span></span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 DefinitionId 查询</span></span><br><span class="line">        instanceQuery.processDefinitionId(<span class="string">&quot;myEvection:1:4&quot;</span>);</span><br><span class="line"><span class="comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span></span><br><span class="line">        instanceQuery.orderByHistoricActivityInstanceStartTime().asc();</span><br><span class="line"><span class="comment">//        查询所有内容</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; activityInstanceList = instanceQuery.list();</span><br><span class="line"><span class="comment">//        输出</span></span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance hi : activityInstanceList) &#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getActivityId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getActivityName());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getProcessDefinitionId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(hi.getProcessInstanceId());</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;&lt;==========================&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 <code>Java</code>  程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="二维码plus"> 非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-04-20T06:02:20.057Z" title="2023-4-20 14:02:20">2023-04-20</time>发表</span><span class="level-item"><time dateTime="2023-04-20T06:01:26.401Z" title="2023-4-20 14:01:26">2023-04-20</time>更新</span><span class="level-item">1 小时读完 (大约11024个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/04/20/%E3%80%90Activiti%E3%80%91Java%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%BC%95%E6%93%8E%20Activiti%20%E4%B8%87%E5%AD%97%E8%AF%A6%E7%BB%86%E5%85%A5%E9%97%A8/">【Activiti】Java工作流引擎 Activiti 万字详细入门</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="activitijava工作流引擎-activiti-万字详细入门"><a class="markdownIt-Anchor" href="#activitijava工作流引擎-activiti-万字详细入门">#</a> 【Activiti】Java 工作流引擎 Activiti 万字详细入门</h1>
<h1 id="activiti7"><a class="markdownIt-Anchor" href="#activiti7">#</a> Activiti7</h1>
<h1 id="一-工作流介绍"><a class="markdownIt-Anchor" href="#一-工作流介绍">#</a> 一、工作流介绍</h1>
<h2 id="11-概念"><a class="markdownIt-Anchor" href="#11-概念">#</a> 1.1 概念</h2>
<p>工作流 (Workflow)，就是通过计算机对业务流程自动化执行管理。它主要解决的是 “使在多个参与者之间按照某种预定义的规则自动进行传递文档、信息或任务的过程，从而实现某个预期的业务目标，或者促使此目标的实现”。</p>
<h2 id="12-工作流系统"><a class="markdownIt-Anchor" href="#12-工作流系统">#</a> 1.2 工作流系统</h2>
<p>一个软件系统中具有工作流的功能，我们把它称为工作流系统，一个系统中工作流的功能是什么？就是对系统的业务流程进行自动化管理，所以工作流是建立在业务流程的基础上，所以一个软件的系统核心根本上还是系统的业务流程，工作流只是协助进行业务流程管理。即使没有工作流业务系统也可以开发运行，只不过有了工作流可以更好的管理业务流程，提高系统的可扩展性。</p>
<h2 id="13-适用行业"><a class="markdownIt-Anchor" href="#13-适用行业">#</a> 1.3 适用行业</h2>
<p>消费品行业，制造业，电信服务业，银证险等金融服务业，物流服务业，物业服务业，物业管理，大中型进出口贸易公司，政府事业机构，研究院所及教育服务业等，特别是大的跨国企业和集团公司。</p>
<h2 id="14-具体应用"><a class="markdownIt-Anchor" href="#14-具体应用">#</a> 1.4 具体应用</h2>
<p>1、关键业务流程：订单、报价处理、合同审核、客户电话处理、供应链管理等</p>
<p>2、行政管理类：出差申请、加班申请、请假申请、用车申请、各种办公用品申请、购买申请、日报周报等凡是原来手工流转处理的行政表单。</p>
<p>3、人事管理类：员工培训安排、绩效考评、职位变动处理、员工档案信息管理等。</p>
<p>4、财务相关类：付款请求、应收款处理、日常报销处理、出差报销、预算和计划申请等。</p>
<p>5、客户服务类：客户信息管理、客户投诉、请求处理、售后服务管理等。</p>
<p>6、特殊服务类：ISO 系列对应流程、质量管理对应流程、产品数据信息管理、贸易公司报关处理、物流公司货物跟踪处理等各种通过表单逐步手工流转完成的任务均可应用工作流软件自动规范地实施。</p>
<h2 id="15-实现方式"><a class="markdownIt-Anchor" href="#15-实现方式">#</a> 1.5 实现方式</h2>
<p>在没有专门的工作流引擎之前，我们之前为了实现流程控制，通常的做法就是采用状态字段的值来跟踪流程的变化情况。这样不同角色的用户，通过状态字段的取值来决定记录是否显示。</p>
<p>针对有权限可以查看的记录，当前用户根据自己的角色来决定审批是否合格的操作。如果合格将状态字段设置一个值，来代表合格；当然如果不合格也需要设置一个值来代表不合格的情况。</p>
<p>这是一种最为原始的方式。通过状态字段虽然做到了流程控制，但是当我们的流程发生变更的时候，这种方式所编写的代码也要进行调整。</p>
<p>那么有没有专业的方式来实现工作流的管理呢？并且可以做到业务流程变化之后，我们的程序可以不用改变，如果可以实现这样的效果，那么我们的业务系统的适应能力就得到了极大提升。</p>
<h1 id="二-activiti7概述"><a class="markdownIt-Anchor" href="#二-activiti7概述">#</a> 二、Activiti7 概述</h1>
<h2 id="21-介绍"><a class="markdownIt-Anchor" href="#21-介绍">#</a> 2.1 介绍</h2>
<p>Alfresco 软件在 2010 年 5 月 17 日宣布 Activiti 业务流程管理（BPM）开源项目的正式启动，其首席架构师由业务流程管理 BPM 的专家 Tom Baeyens 担任，Tom Baeyens 就是原来 jbpm 的架构师，而 jbpm 是一个非常有名的工作流引擎，当然 activiti 也是一个工作流引擎。</p>
<p>Activiti 是一个工作流引擎， activiti 可以将业务系统中复杂的业务流程抽取出来，使用专门的建模语言 BPMN2.0 进行定义，业务流程按照预先定义的流程进行执行，实现了系统的流程由 activiti 进行管理，减少业务系统由于流程变更进行系统升级改造的工作量，从而提高系统的健壮性，同时也减少了系统开发维护成本。</p>
<p>官方网站：<a target="_blank" rel="noopener" href="https://www.activiti.org/">https://www.activiti.org/</a></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/6d5fa212cb5c4186af366a6af2359a80.png" alt="img"></p>
<p>经历的版本:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b2b6a0483819682db174c2d0bcaacd31.png" alt="img"></p>
<p>目前最新版本：Activiti7.0.0.Beta</p>
<h3 id="211-bpm"><a class="markdownIt-Anchor" href="#211-bpm">#</a> 2.1.1 BPM</h3>
<p>BPM（Business Process Management），即业务流程管理，是一种规范化的构造端到端的业务流程，以持续的提高组织业务效率。常见商业管理教育如 EMBA、MBA 等均将 BPM 包含在内。</p>
<h3 id="212-bpm软件"><a class="markdownIt-Anchor" href="#212-bpm软件">#</a> 2.1.2 BPM 软件</h3>
<p>BPM 软件就是根据企业中业务环境的变化，推进人与人之间、人与系统之间以及系统与系统之间的整合及调整的经营方法与解决方案的 IT 工具。</p>
<p>通过 BPM 软件对企业内部及外部的业务流程的整个生命周期进行建模、自动化、管理监控和优化，使企业成本降低，利润得以大幅提升。</p>
<p>BPM 软件在企业中应用领域广泛，凡是有业务流程的地方都可以 BPM 软件进行管理，比如企业人事办公管理、采购流程管理、公文审批流程管理、财务管理等。</p>
<h3 id="213-bpmn"><a class="markdownIt-Anchor" href="#213-bpmn">#</a> 2.1.3 BPMN</h3>
<p>BPMN（Business Process Model AndNotation）- 业务流程模型和符号 是由 BPMI（BusinessProcess Management Initiative）开发的一套标准的业务流程建模符号，使用 BPMN 提供的符号可以创建业务流程。</p>
<p>2004 年 5 月发布了 BPMN1.0 规范.BPMI 于 2005 年 9 月并入 OMG（The Object Management Group 对象管理组织) 组织。OMG 于 2011 年 1 月发布 BPMN2.0 的最终版本。</p>
<p>具体发展历史如下:</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4a5c9b0e87bab71979a722ea5967d1df.png" alt="img"></p>
<p>BPMN 是目前被各 BPM 厂商广泛接受的 BPM 标准。Activiti 就是使用 BPMN 2.0 进行流程建模、流程执行管理，它包括很多的建模符号，比如：</p>
<p>Event</p>
<p>用一个圆圈表示，它是流程中运行过程中发生的事情。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/c62d43f73620718b749276dd6e9c8c53.png" alt="img"></p>
<p>活动用圆角矩形表示，一个流程由一个活动或多个活动组成</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2e9e2be515de8ff8a0cdd4e238bc35d0.png" alt="img"></p>
<p>Bpmn 图形其实是通过 xml 表示业务流程，上边的.bpmn 文件使用文本编辑器打开：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">definitions</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:activiti</span>=<span class="string">&quot;http://activiti.org/bpmn&quot;</span> <span class="attr">xmlns:bpmndi</span>=<span class="string">&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot;</span> <span class="attr">xmlns:omgdc</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DC&quot;</span> <span class="attr">xmlns:omgdi</span>=<span class="string">&quot;http://www.omg.org/spec/DD/20100524/DI&quot;</span> <span class="attr">typeLanguage</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">expressionLanguage</span>=<span class="string">&quot;http://www.w3.org/1999/XPath&quot;</span> <span class="attr">targetNamespace</span>=<span class="string">&quot;http://www.activiti.org/test&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">process</span> <span class="attr">id</span>=<span class="string">&quot;myProcess&quot;</span> <span class="attr">name</span>=<span class="string">&quot;My process&quot;</span> <span class="attr">isExecutable</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">startEvent</span> <span class="attr">id</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Start&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">startEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;创建请假单&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow1&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;部门经理审核&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow2&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">userTask</span> <span class="attr">id</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;人事复核&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">userTask</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow3&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;usertask3&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">endEvent</span> <span class="attr">id</span>=<span class="string">&quot;endevent1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;End&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">endEvent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sequenceFlow</span> <span class="attr">id</span>=<span class="string">&quot;flow4&quot;</span> <span class="attr">sourceRef</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">targetRef</span>=<span class="string">&quot;endevent1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">sequenceFlow</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">process</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bpmndi:BPMNDiagram</span> <span class="attr">id</span>=<span class="string">&quot;BPMNDiagram_myProcess&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bpmndi:BPMNPlane</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;myProcess&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNPlane_myProcess&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;startevent1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_startevent1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;130.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;160.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;210.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;usertask3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_usertask3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;55.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;105.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;510.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;150.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNShape</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;endevent1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNShape_endevent1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdc:Bounds</span> <span class="attr">height</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;35.0&quot;</span> <span class="attr">x</span>=<span class="string">&quot;660.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;160.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdc:Bounds</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNShape</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;165.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;210.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;315.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;360.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;465.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;510.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bpmndi:BPMNEdge</span> <span class="attr">bpmnElement</span>=<span class="string">&quot;flow4&quot;</span> <span class="attr">id</span>=<span class="string">&quot;BPMNEdge_flow4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;615.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">omgdi:waypoint</span> <span class="attr">x</span>=<span class="string">&quot;660.0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;177.0&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">omgdi:waypoint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">bpmndi:BPMNEdge</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bpmndi:BPMNPlane</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bpmndi:BPMNDiagram</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">definitions</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="22-使用步骤"><a class="markdownIt-Anchor" href="#22-使用步骤">#</a> 2.2 使用步骤</h2>
<h3 id="部署activiti"><a class="markdownIt-Anchor" href="#部署activiti">#</a> 部署 activiti</h3>
<p>Activiti 是一个工作流引擎（其实就是一堆 jar 包 API），业务系统访问 (操作) activiti 的接口，就可以方便的操作流程相关数据，这样就可以把工作流环境与业务系统的环境集成在一起。</p>
<h3 id="流程定义"><a class="markdownIt-Anchor" href="#流程定义">#</a> 流程定义</h3>
<p>使用 activiti 流程建模工具 (activity-designer) 定义业务流程 (.bpmn 文件) 。</p>
<p>.bpmn 文件就是业务流程定义文件，通过 xml 定义业务流程。</p>
<h3 id="流程定义部署"><a class="markdownIt-Anchor" href="#流程定义部署">#</a> 流程定义部署</h3>
<p>activiti 部署业务流程定义（.bpmn 文件）。</p>
<p>使用 activiti 提供的 api 把流程定义内容存储起来，在 Activiti 执行过程中可以查询定义的内容</p>
<p>Activiti 执行把流程定义内容存储在数据库中</p>
<h3 id="启动一个流程实例"><a class="markdownIt-Anchor" href="#启动一个流程实例">#</a> 启动一个流程实例</h3>
<p>流程实例也叫：ProcessInstance</p>
<p>启动一个流程实例表示开始一次业务流程的运行。</p>
<p>在员工请假流程定义部署完成后，如果张三要请假就可以启动一个流程实例，如果李四要请假也启动一个流程实例，两个流程的执行互相不影响。</p>
<h3 id="用户查询待办任务task"><a class="markdownIt-Anchor" href="#用户查询待办任务task">#</a> 用户查询待办任务 (Task)</h3>
<p>因为现在系统的业务流程已经交给 activiti 管理，通过 activiti 就可以查询当前流程执行到哪了，当前用户需要办理什么任务了，这些 activiti 帮我们管理了，而不需要开发人员自己编写在 sql 语句查询。</p>
<h3 id="用户办理任务"><a class="markdownIt-Anchor" href="#用户办理任务">#</a> 用户办理任务</h3>
<p>用户查询待办任务后，就可以办理某个任务，如果这个任务办理完成还需要其它用户办理，比如采购单创建后由部门经理审核，这个过程也是由 activiti 帮我们完成了。</p>
<h3 id="流程结束"><a class="markdownIt-Anchor" href="#流程结束">#</a> 流程结束</h3>
<p>当任务办理完成没有下一个任务结点了，这个流程实例就完成了。</p>
<h1 id="三-activiti环境"><a class="markdownIt-Anchor" href="#三-activiti环境">#</a> 三、Activiti 环境</h1>
<h2 id="31-开发环境"><a class="markdownIt-Anchor" href="#31-开发环境">#</a> 3.1 开发环境</h2>
<p>Jdk1.8 或以上版本</p>
<p>Mysql 5 及以上的版本</p>
<p>Tomcat8.5</p>
<p>IDEA</p>
<p><strong>注意：activiti 的流程定义工具插件可以安装在 IDEA 下，也可以安装在 Eclipse 工具下</strong></p>
<h2 id="32-activiti环境"><a class="markdownIt-Anchor" href="#32-activiti环境">#</a> 3.2 Activiti 环境</h2>
<p>我们使用：Activiti7.0.0.Beta1 默认支持 spring5</p>
<h3 id="321-下载activiti7"><a class="markdownIt-Anchor" href="#321-下载activiti7">#</a> 3.2.1 下载 activiti7</h3>
<p>Activiti 下载地址：<a target="_blank" rel="noopener" href="http://activiti.org/download.html">http://activiti.org/download.html</a> ，Maven 的依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0.0.Beta1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>1)</strong> <strong>Database</strong>：</p>
<p>activiti 运行需要有数据库的支持，支持的数据库有：h2, mysql, oracle, postgres, mssql, db2。</p>
<h3 id="322-流程设计器idea下安装"><a class="markdownIt-Anchor" href="#322-流程设计器idea下安装">#</a> 3.2.2 流程设计器 IDEA 下安装</h3>
<p>在 IDEA 的 File 菜单中找到子菜单”Settings”, 后面我们再选择左侧的 “plugins” 菜单，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4222667fb5d6374e5d494385bcbf04b4.png" alt="img"></p>
<p>此时我们就可以搜索到 actiBPM 插件，它就是 Activiti Designer 的 IDEA 版本，我们点击 Install 安装。</p>
<p>安装好后，页面如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f5a2177202ea9dd4630e255c403d7100.png" alt="img"></p>
<p>提示需要重启 idea，点击重启。</p>
<p>重启完成后，再次打开 Settings 下的 Plugins（插件列表），点击右侧的 Installed（已安装的插件），在列表中看到 actiBPM，就说明已经安装成功了，如下图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/988e0af68496e1b4d219c78685ab7f2c.png" alt="img"></p>
<p>后面的课程里，我们会使用这个流程设计器进行 Activiti 的流程设计。</p>
<h2 id="33-activiti的数据库支持"><a class="markdownIt-Anchor" href="#33-activiti的数据库支持">#</a> 3.3 Activiti 的数据库支持</h2>
<p>Activiti 在运行时需要数据库的支持，使用 25 张表，把流程定义节点内容读取到数据库表中，以供后续使用。</p>
<h3 id="331-activiti-支持的数据库"><a class="markdownIt-Anchor" href="#331-activiti-支持的数据库">#</a> 3.3.1 Activiti 支持的数据库</h3>
<p>activiti 支持的数据库和版本如下：</p>
<table>
<thead>
<tr>
<th>数据库类型</th>
<th>版本</th>
<th>JDBC 连接示例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>h2</td>
<td>1.3.168</td>
<td>jdbc:h2:tcp://localhost/activiti</td>
<td>默认配置的数据库</td>
</tr>
<tr>
<td>mysql</td>
<td>5.1.21</td>
<td>jdbc:mysql://localhost:3306/activiti?autoReconnect=true</td>
<td>使用 mysql-connector-java 驱动测试</td>
</tr>
<tr>
<td>oracle</td>
<td>11.2.0.1.0</td>
<td>jdbc:oracle:thin:@localhost:1521:xe</td>
<td></td>
</tr>
<tr>
<td>postgres</td>
<td>8.1</td>
<td>jdbc:postgresql://localhost:5432/activiti</td>
<td></td>
</tr>
<tr>
<td>db2</td>
<td>DB2 10.1 using db2jcc4</td>
<td>jdbc:db2://localhost:50000/activiti</td>
<td></td>
</tr>
<tr>
<td>mssql</td>
<td>2008 using sqljdbc4</td>
<td>jdbc:sqlserver://localhost:1433/activiti</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="332-在mysql生成表"><a class="markdownIt-Anchor" href="#332-在mysql生成表">#</a> 3.3.2 在 MySQL 生成表</h3>
<h4 id="3321-创建数据库"><a class="markdownIt-Anchor" href="#3321-创建数据库">#</a> 3.3.2.1 创建数据库</h4>
<p>创建 mysql 数据库 activiti （名字任意）：</p>
<p>CREATE DATABASE activiti DEFAULT CHARACTER SET utf8;</p>
<h4 id="3322-使用java代码生成表"><a class="markdownIt-Anchor" href="#3322-使用java代码生成表">#</a> 3.3.2.2 使用 java 代码生成表</h4>
<h5 id="1-创建-java-工程"><a class="markdownIt-Anchor" href="#1-创建-java-工程">#</a> 1） 创建 java 工程</h5>
<p>使用 idea 创建 java 的 maven 工程，取名：activiti01。</p>
<h5 id="2-加入-maven-依赖的坐标jar-包"><a class="markdownIt-Anchor" href="#2-加入-maven-依赖的坐标jar-包">#</a> 2） 加入 maven 依赖的坐标（jar 包）</h5>
<p>首先需要在 java 工程中加入 ProcessEngine 所需要的 jar 包，包括：</p>
<ol>
<li>activiti-engine-7.0.0.beta1.jar</li>
<li>activiti 依赖的 jar 包： mybatis、 alf4j、 log4j 等</li>
<li>activiti 依赖的 spring 包</li>
<li>mysql 数据库驱动</li>
<li>第三方数据连接池 dbcp</li>
<li>单元测试 Junit-4.12.jar</li>
</ol>
<p>我们使用 maven 来实现项目的构建，所以应当导入这些 jar 所对应的坐标到 pom.xml 文件中。</p>
<p>完整的依赖内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slf4j.version</span>&gt;</span>1.6.6<span class="tag">&lt;/<span class="name">slf4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span>1.2.12<span class="tag">&lt;/<span class="name">log4j.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">activiti.version</span>&gt;</span>7.0.0.Beta1<span class="tag">&lt;/<span class="name">activiti.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn 模型处理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-model<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn 转换 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-converter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn json数据转换 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-json-converter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- bpmn 布局 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-bpmn-layout<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- activiti 云支持 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.activiti.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>activiti-cloud-services-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;activiti.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mysql驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.40<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 链接池 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-dbcp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log start --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;slf4j.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="3-添加log4j日志配置"><a class="markdownIt-Anchor" href="#3-添加log4j日志配置">#</a> 3） 添加 log4j 日志配置</h5>
<p>我们使用 log4j 日志包，可以对日志进行配置</p>
<p>在 resources 下创建 log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set root category priority to INFO and its only appender to CONSOLE.</span></span><br><span class="line"><span class="comment">#log4j.rootCategory=INFO, CONSOLE debug info warn error fatal</span></span><br><span class="line"><span class="attr">log4j.rootCategory</span>=<span class="string">debug, CONSOLE, LOGFILE</span></span><br><span class="line"><span class="comment"># Set the enterprise logger category to FATAL and its only appender to CONSOLE.</span></span><br><span class="line"><span class="attr">log4j.logger.org.apache.axis.enterprise</span>=<span class="string">FATAL, CONSOLE</span></span><br><span class="line"><span class="comment"># CONSOLE is set to be a ConsoleAppender using a PatternLayout.</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.CONSOLE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span></span><br><span class="line"><span class="comment"># LOGFILE is set to be a File appender using a PatternLayout.</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.File</span>=<span class="string">f:\act\activiti.log</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.Append</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.LOGFILE.layout.ConversionPattern</span>=<span class="string">%d&#123;ISO8601&#125; %-6r[%15.15t] %-5p %30.30c %x - %m\n</span></span><br></pre></td></tr></table></figure>
<h5 id="4-添加activiti配置文件"><a class="markdownIt-Anchor" href="#4-添加activiti配置文件">#</a> 4） 添加 activiti 配置文件</h5>
<p>我们使用 activiti 提供的默认方式来创建 mysql 的表。</p>
<p>默认方式的要求是在 resources 下创建 activiti.cfg.xml 文件，注意：默认方式目录和文件名不能修改，因为 activiti 的源码中已经设置，到固定的目录读取固定文件名的文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="5-在-activiticfgxml-中进行配置"><a class="markdownIt-Anchor" href="#5-在-activiticfgxml-中进行配置">#</a> 5） 在 activiti.cfg.xml 中进行配置</h5>
<p>默认方式要在在 activiti.cfg.xml 中 bean 的名字叫 processEngineConfiguration，名字不可修改</p>
<p>在这里有 2 中配置方式：一种是单独配置数据源，一种是不单独配置数据源</p>
<h6 id="1-直接配置processengineconfiguration"><a class="markdownIt-Anchor" href="#1-直接配置processengineconfiguration">#</a> 1、直接配置 processEngineConfiguration</h6>
<p>processEngineConfiguration 用来创建 ProcessEngine，在创建 ProcessEngine 时会执行数据库的操作。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认id对应的值 为processEngineConfiguration --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- processEngine Activiti的流程引擎 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcDriver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUsername&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcPassword&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- activiti数据库表处理策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="2-配置数据源后在processengineconfiguration-引用"><a class="markdownIt-Anchor" href="#2-配置数据源后在processengineconfiguration-引用">#</a> 2、配置数据源后，在 processEngineConfiguration 引用</h6>
<p>首先配置数据源</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 这里可以使用 链接池 dbcp--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 引用数据源 上面已经设置好了--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- activiti数据库表处理策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="6-java类编写程序生成表"><a class="markdownIt-Anchor" href="#6-java类编写程序生成表">#</a> 6） java 类编写程序生成表</h5>
<p>创建一个测试类，调用 activiti 的工具类，生成 acitivti 需要的数据库表。</p>
<p>直接使用 activiti 提供的工具类 ProcessEngines，会默认读取 classpath 下的 activiti.cfg.xml 文件，读取其中的数据库配置，创建 ProcessEngine，在创建 ProcessEngine 时会自动创建表。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.activiti01.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngine;</span><br><span class="line"><span class="keyword">import</span> org.activiti.engine.ProcessEngineConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成 activiti的数据库表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateDbTable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line">		<span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">		System.out.println(processEngine);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>说明：<br>
1、运行以上程序段即可完成 activiti 表创建，通过改变 activiti.cfg.xml 中 databaseSchemaUpdate 参数的值执行不同的数据表处理策略。<br>
2 、 上 边 的 方法 getDefaultProcessEngine 方法在执行时，从 activiti.cfg.xml 中找固定的名称 processEngineConfiguration 。</p>
<p>在测试程序执行过程中，idea 的控制台会输出日志，说明程序正在创建数据表，类似如下，注意红线内容：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/303798960a34b13286c1078b3cdbba1b.png" alt="img"></p>
<p>执行完成后我们查看数据库， 创建了 25 张表，结果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/abf223e14cf32150f025c12b84be2eab.png" alt="img"></p>
<p>到这，我们就完成 activiti 运行需要的数据库和表的创建。</p>
<h2 id="34-表结构介绍"><a class="markdownIt-Anchor" href="#34-表结构介绍">#</a> 3.4 表结构介绍</h2>
<h3 id="341-表的命名规则和作用"><a class="markdownIt-Anchor" href="#341-表的命名规则和作用">#</a> 3.4.1 表的命名规则和作用</h3>
<p>看到刚才创建的表，我们发现 Activiti 的表都以 ACT_ 开头。</p>
<p>第二部分是表示表的用途的两个字母标识。 用途也和服务的 API 对应。<br>
<strong>ACT_RE</strong> ：'RE’表示 repository。 这个前缀的表包含了流程定义和流程静态资源 （图片，规则，等等）。<br>
<strong>ACT_RU</strong>：'RU’表示 runtime。 这些运行时的表，包含流程实例，任务，变量，异步任务，等运行中的数据。 Activiti 只在流程实例执行过程中保存这些数据， 在流程结束时就会删除这些记录。 这样运行时表可以一直很小速度很快。<br>
<strong>ACT_HI</strong>：'HI’表示 history。 这些表包含历史数据，比如历史流程实例， 变量，任务等等。<br>
<strong>ACT_GE</strong> ： GE 表示 general。 通用数据， 用于不同场景下</p>
<h3 id="342-activiti数据表介绍"><a class="markdownIt-Anchor" href="#342-activiti数据表介绍">#</a> 3.4.2 Activiti 数据表介绍</h3>
<table>
<thead>
<tr>
<th><strong>表分类</strong></th>
<th><strong>表名</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>一般数据</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_BYTEARRAY]</td>
<td>通用的流程定义和流程资源</td>
</tr>
<tr>
<td></td>
<td>[ACT_GE_PROPERTY]</td>
<td>系统相关属性</td>
</tr>
<tr>
<td>流程历史记录</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ACTINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_ATTACHMENT]</td>
<td>历史的流程附件</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_COMMENT]</td>
<td>历史的说明性信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_DETAIL]</td>
<td>历史的流程运行中的细节信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_IDENTITYLINK]</td>
<td>历史的流程运行过程中用户关系</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_PROCINST]</td>
<td>历史的流程实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_TASKINST]</td>
<td>历史的任务实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_HI_VARINST]</td>
<td>历史的流程运行中的变量信息</td>
</tr>
<tr>
<td>流程定义表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_DEPLOYMENT]</td>
<td>部署单元信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_MODEL]</td>
<td>模型信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RE_PROCDEF]</td>
<td>已部署的流程定义</td>
</tr>
<tr>
<td>运行实例表</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EVENT_SUBSCR]</td>
<td>运行时事件</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_EXECUTION]</td>
<td>运行时流程执行实例</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_IDENTITYLINK]</td>
<td>运行时用户关系信息，存储任务节点与参与者的相关信息</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_JOB]</td>
<td>运行时作业</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_TASK]</td>
<td>运行时任务</td>
</tr>
<tr>
<td></td>
<td>[ACT_RU_VARIABLE]</td>
<td>运行时变量表</td>
</tr>
</tbody>
</table>
<h1 id="四-activiti类关系图"><a class="markdownIt-Anchor" href="#四-activiti类关系图">#</a> 四、Activiti 类关系图</h1>
<p>上面我们完成了 Activiti 数据库表的生成，java 代码中我们调用 Activiti 的工具类，下面来了解 Activiti 的类关系</p>
<h2 id="41-类关系图"><a class="markdownIt-Anchor" href="#41-类关系图">#</a> 4.1 类关系图</h2>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/eb571b5c4a1dff4f54dd504a537e4ade.png" alt="img"></p>
<p>在新版本中，我们通过实验可以发现 IdentityService，FormService 两个 Serivce 都已经删除了。</p>
<p>所以后面我们对于这两个 Service 也不讲解了，但老版本中还是有这两个 Service，同学们需要了解一下</p>
<h2 id="42-activiticfgxml"><a class="markdownIt-Anchor" href="#42-activiticfgxml">#</a> 4.2 activiti.cfg.xml</h2>
<p>activiti 的引擎配置文件，包括：ProcessEngineConfiguration 的定义、数据源定义、事务管理器等，此文件其实就是一个 spring 配置文件。</p>
<h2 id="43-流程引擎配置类"><a class="markdownIt-Anchor" href="#43-流程引擎配置类">#</a> 4.3 流程引擎配置类</h2>
<p>流程引擎的配置类（ProcessEngineConfiguration），通过 ProcessEngineConfiguration 可以创建工作流引擎 ProceccEngine，常用的两种方法如下：</p>
<h3 id="431-standaloneprocessengineconfiguration"><a class="markdownIt-Anchor" href="#431-standaloneprocessengineconfiguration">#</a> 4.3.1 StandaloneProcessEngineConfiguration</h3>
<p>使用 StandaloneProcessEngineConfigurationActiviti 可以单独运行，来创建 ProcessEngine，Activiti 会自己处理事务。</p>
<p>配置文件方式：</p>
<p>通常在 activiti.cfg.xml 配置文件中定义一个 id 为 processEngineConfiguration 的 bean.</p>
<p>方法如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置数据库相关的信息--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库驱动--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcDriver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库链接--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库用户名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUsername&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库密码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcPassword&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--actviti数据库表在生成时的策略  true - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还可以加入连接池:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/contex</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql:///activiti&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在默认方式下 bean的id  固定为 processEngineConfiguration--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入上面配置好的 链接池--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--actviti数据库表在生成时的策略  true - 如果数据库中已经存在相应的表，那么直接使用，如果不存在，那么会创建--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="432-springprocessengineconfiguration"><a class="markdownIt-Anchor" href="#432-springprocessengineconfiguration">#</a> 4.3.2 SpringProcessEngineConfiguration</h3>
<p>通过<strong> org.activiti.spring.SpringProcessEngineConfiguration 与</strong> Spring 整合。</p>
<p>创建 spring 与 activiti 的整合配置文件：</p>
<p>activity-spring.cfg.xml（名称可修改）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/beans/spring-beans-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/aop </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/aop/spring-aop-3.1.xsd </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="string"><span class="tag">      http://www.springframework.org/schema/tx/spring-tx-3.1.xsd &quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 工作流引擎配置bean --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.activiti.spring.SpringProcessEngineConfiguration&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 数据源 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 使用spring事务管理器 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 数据库策略 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;databaseSchemaUpdate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;drop-create&quot;</span> /&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- activiti的定时任务关闭 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobExecutorActivate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 流程引擎 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.activiti.spring.ProcessEngineFactoryBean&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;processEngineConfiguration&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 资源服务service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;repositoryService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getRepositoryService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 流程运行service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;runtimeService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getRuntimeService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 任务管理service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;taskService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getTaskService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 历史管理service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;historyService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getHistoryService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 用户管理service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;identityService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getIdentityService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 引擎管理service --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;managementService&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;processEngine&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getManagementService&quot;</span> /&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 数据源 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/activiti&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 通知 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 传播行为 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;save*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;insert*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;delete*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;update*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;SUPPORTS&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 切面，根据具体项目修改切点配置 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span>  <span class="attr">pointcut</span>=<span class="string">&quot;execution(* com.itheima.ihrm.service.impl.*.(..))&quot;</span>* /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="创建processengineconfiguration"><a class="markdownIt-Anchor" href="#创建processengineconfiguration">#</a> 创建 processEngineConfiguration</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>上边的代码要求 activiti.cfg.xml 中必须有一个 processEngineConfiguration 的 bean</p>
<p>也可以使用下边的方法，更改 bean 的名字：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(String resource, String beanName);</span><br></pre></td></tr></table></figure>
<h2 id="44-工作流引擎创建"><a class="markdownIt-Anchor" href="#44-工作流引擎创建">#</a> 4.4 工作流引擎创建</h2>
<p>工作流引擎（ProcessEngine），相当于一个门面接口，通过 ProcessEngineConfiguration 创建 processEngine，通过 ProcessEngine 创建各个 service 接口。</p>
<h3 id="441-默认创建方式"><a class="markdownIt-Anchor" href="#441-默认创建方式">#</a> 4.4.1 默认创建方式</h3>
<p>将 activiti.cfg.xml 文件名及路径固定，且 activiti.cfg.xml 文件中有 processEngineConfiguration 的配置， 可以使用如下代码创建 processEngine:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接使用工具类 ProcessEngines，使用classpath下的activiti.cfg.xml中的配置创建processEngine</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">System.out.println(processEngine);</span><br></pre></td></tr></table></figure>
<h3 id="442-一般创建方式"><a class="markdownIt-Anchor" href="#442-一般创建方式">#</a> 4.4.2 一般创建方式</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先构建ProcessEngineConfiguration</span></span><br><span class="line"><span class="type">ProcessEngineConfiguration</span> <span class="variable">configuration</span> <span class="operator">=</span> ProcessEngineConfiguration.createProcessEngineConfigurationFromResource(<span class="string">&quot;activiti.cfg.xml&quot;</span>);</span><br><span class="line"><span class="comment">//通过ProcessEngineConfiguration创建ProcessEngine，此时会创建数据库</span></span><br><span class="line"><span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> configuration.buildProcessEngine();</span><br></pre></td></tr></table></figure>
<h2 id="45-servcie服务接口"><a class="markdownIt-Anchor" href="#45-servcie服务接口">#</a> 4.5 Servcie 服务接口</h2>
<p>Service 是工作流引擎提供用于进行工作流部署、执行、管理的服务接口，我们使用这些接口可以就是操作服务对应的数据表</p>
<h3 id="451-service创建方式"><a class="markdownIt-Anchor" href="#451-service创建方式">#</a> 4.5.1 Service 创建方式</h3>
<p>通过 ProcessEngine 创建 Service</p>
<p>方式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"><span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br></pre></td></tr></table></figure>
<h3 id="452-service总览"><a class="markdownIt-Anchor" href="#452-service总览">#</a> 4.5.2 Service 总览</h3>
<table>
<thead>
<tr>
<th>service 名称</th>
<th>service 作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>RepositoryService</td>
<td>activiti 的资源管理类</td>
</tr>
<tr>
<td>RuntimeService</td>
<td>activiti 的流程运行管理类</td>
</tr>
<tr>
<td>TaskService</td>
<td>activiti 的任务管理类</td>
</tr>
<tr>
<td>HistoryService</td>
<td>activiti 的历史管理类</td>
</tr>
<tr>
<td>ManagerService</td>
<td>activiti 的引擎管理类</td>
</tr>
</tbody>
</table>
<p>简单介绍：</p>
<p><strong>RepositoryService</strong></p>
<p>是 activiti 的资源管理类，提供了管理和控制流程发布包和流程定义的操作。使用工作流建模工具设计的业务流程图需要使用此 service 将流程定义文件的内容部署到计算机。</p>
<p>除了部署流程定义以外还可以：查询引擎中的发布包和流程定义。</p>
<p>暂停或激活发布包，对应全部和特定流程定义。 暂停意味着它们不能再执行任何操作了，激活是对应的反向操作。获得多种资源，像是包含在发布包里的文件， 或引擎自动生成的流程图。</p>
<p>获得流程定义的 pojo 版本， 可以用来通过 java 解析流程，而不必通过 xml。</p>
<h4 id="runtimeservice"><a class="markdownIt-Anchor" href="#runtimeservice">#</a> RuntimeService</h4>
<p>Activiti 的流程运行管理类。可以从这个服务类中获取很多关于流程执行相关的信息</p>
<h4 id="taskservice"><a class="markdownIt-Anchor" href="#taskservice">#</a> TaskService</h4>
<p>Activiti 的任务管理类。可以从这个类中获取任务的信息。</p>
<h4 id="historyservice"><a class="markdownIt-Anchor" href="#historyservice">#</a> HistoryService</h4>
<p>Activiti 的历史管理类，可以查询历史信息，执行流程时，引擎会保存很多数据（根据配置），比如流程实例启动时间，任务的参与者， 完成任务的时间，每个流程实例的执行路径，等等。 这个服务主要通过查询功能来获得这些数据。</p>
<h4 id="managementservice"><a class="markdownIt-Anchor" href="#managementservice">#</a> ManagementService</h4>
<p>Activiti 的引擎管理类，提供了对 Activiti 流程引擎的管理和维护功能，这些功能不在工作流驱动的应用程序中使用，主要用于 Activiti 系统的日常维护。</p>
<h1 id="五-activiti入门"><a class="markdownIt-Anchor" href="#五-activiti入门">#</a> 五、Activiti 入门</h1>
<p>在本章内容中，我们来创建一个 Activiti 工作流，并启动这个流程。</p>
<p>创建 Activiti 工作流主要包含以下几步：</p>
<p>1、定义流程，按照 BPMN 的规范，使用流程定义工具，用<strong>流程符号</strong>把整个流程描述出来</p>
<p>2、部署流程，把画好的流程定义文件，加载到数据库中，生成表的数据</p>
<p>3、启动流程，使用 java 代码来操作数据库表中的内容</p>
<h2 id="51-流程符号"><a class="markdownIt-Anchor" href="#51-流程符号">#</a> 5.1 流程符号</h2>
<p>BPMN 2.0 是业务流程建模符号 2.0 的缩写。</p>
<p>它由 Business Process Management Initiative 这个非营利协会创建并不断发展。作为一种标识，BPMN 2.0 是使用一些<strong>符号</strong>来明确业务流程设计流程图的一整套符号规范，它能增进业务建模时的沟通效率。</p>
<p>目前 BPMN2.0 是最新的版本，它用于在 BPM 上下文中进行布局和可视化的沟通。</p>
<p>接下来我们先来了解在流程设计中常见的 符号。</p>
<p>BPMN2.0 的<strong>基本符合</strong>主要包含：</p>
<h3 id="事件-event"><a class="markdownIt-Anchor" href="#事件-event">#</a> 事件 Event</h3>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/55da0d46ad4664bec6f38a53aec9e98f.png" alt="1574522151044"></p>
<h3 id="活动-activity"><a class="markdownIt-Anchor" href="#活动-activity">#</a> 活动 Activity</h3>
<p>活动是工作或任务的一个通用术语。一个活动可以是一个任务，还可以是一个当前流程的子处理流程； 其次，你还可以为活动指定不同的类型。常见活动如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/fa7d32728f189f729285e260a68c966b.png" alt="1574562726375"></p>
<h3 id="网关-gateway"><a class="markdownIt-Anchor" href="#网关-gateway">#</a> 网关 GateWay</h3>
<p>网关用来处理决策，有几种常用网关需要了解：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4e671fa1ca691aae89fcba2f6cd9c7f4.png" alt="1574563600305"></p>
<h4 id="排他网关-x"><a class="markdownIt-Anchor" href="#排他网关-x">#</a> 排他网关 (x)</h4>
<p>—— 只有一条路径会被选择。流程执行到该网关时，按照输出流的顺序逐个计算，当条件的计算结果为 true 时，继续执行当前网关的输出流；</p>
<p>如果多条线路计算结果都是 true，则会执行第一个值为 true 的线路。如果所有网关计算结果没有 true，则引擎会抛出异常。</p>
<p>排他网关需要和条件顺序流结合使用，default 属性指定默认顺序流，当所有的条件不满足时会执行默认顺序流。</p>
<h4 id="并行网关"><a class="markdownIt-Anchor" href="#并行网关">#</a> 并行网关 (+)</h4>
<p>—— 所有路径会被同时选择</p>
<p>拆分 —— 并行执行所有输出顺序流，为每一条顺序流创建一个并行执行线路。</p>
<p>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</p>
<h4 id="包容网关"><a class="markdownIt-Anchor" href="#包容网关">#</a> 包容网关 (+)</h4>
<p>—— 可以同时执行多条线路，也可以在网关上设置条件</p>
<p>拆分 —— 计算每条线路上的表达式，当表达式计算结果为 true 时，创建一个并行线路并继续执行</p>
<p>合并 —— 所有从并行网关拆分并执行完成的线路均在此等候，直到所有的线路都执行完成才继续向下执行。</p>
<h4 id="事件网关"><a class="markdownIt-Anchor" href="#事件网关">#</a> 事件网关 (+)</h4>
<p>—— 专门为中间捕获事件设置的，允许设置多个输出流指向多个不同的中间捕获事件。当流程执行到事件网关后，流程处于等待状态，需要等待抛出事件才能将等待状态转换为活动状态。</p>
<h3 id="流向-flow"><a class="markdownIt-Anchor" href="#流向-flow">#</a> 流向 <a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Flow&amp;spm=1001.2101.3001.7020">Flow</a></h3>
<p>流是连接两个流程节点的连线。常见的流向包含以下几种：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/3628cf5044d11d8aa723d8d62de112a9.png" alt="1574563937457"></p>
<h2 id="52-流程设计器使用"><a class="markdownIt-Anchor" href="#52-流程设计器使用">#</a> 5.2 流程设计器使用</h2>
<h3 id="activiti-designer使用"><a class="markdownIt-Anchor" href="#activiti-designer使用">#</a> Activiti-Designer 使用</h3>
<h4 id="palette画板"><a class="markdownIt-Anchor" href="#palette画板">#</a> Palette（画板）</h4>
<p>在 idea 中安装插件即可使用，画板中包括以下结点：</p>
<p>Connection— 连接</p>
<p>Event— 事件</p>
<p>Task— 任务</p>
<p>Gateway— 网关</p>
<p>Container— 容器</p>
<p>Boundary event— 边界事件</p>
<p>Intermediate event- - 中间事件</p>
<p>流程图设计完毕保存生成.bpmn 文件</p>
<h4 id="新建流程idea工具"><a class="markdownIt-Anchor" href="#新建流程idea工具">#</a> 新建流程 (IDEA 工具)</h4>
<p>首先选中存放图形的目录 (选择 resources 下的 bpmn 目录)，点击菜单：New -&gt; BpmnFile，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/a29cab07f2cdeeecf23a121b955f1f38.png" alt="1575106985823"></p>
<p>弹出如下图所示框，输入 evection 表示 出差审批流程：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b73038594eb6a617ab01d06ecd67d71f.png" alt="1575107231004"></p>
<p>起完名字 evection 后（默认扩展名为 bpmn），就可以看到流程设计页面，如图所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5e11bd3ce21ca2170f3aab1954de69af.png" alt="1575107336431"></p>
<p>左侧区域是绘图区，右侧区域是 palette 画板区域</p>
<p>鼠标先点击画板的元素即可在左侧绘图</p>
<h3 id="绘制流程"><a class="markdownIt-Anchor" href="#绘制流程">#</a> 绘制流程</h3>
<p>使用滑板来绘制流程，通过从右侧把图标拖拽到左侧的画板，最终效果如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1938218ad58d78c29863e3c3cbaf13ac.png" alt="1575107648105"></p>
<h3 id="指定流程定义key"><a class="markdownIt-Anchor" href="#指定流程定义key">#</a> 指定流程定义 Key</h3>
<p>流程定义 key 即流程定义的标识，通过 properties 视图查看流程的 key</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/80e8ed41d420a613bb3601866bccc0b3.png" alt="1575115474865"></p>
<h3 id="指定任务负责人"><a class="markdownIt-Anchor" href="#指定任务负责人">#</a> 指定任务负责人</h3>
<p>在 properties 视图指定每个任务结点的负责人，如：填写出差申请的负责人为 zhangsan</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f5c59207b9f63ed98c0b14b07c35e172.png" alt="1575121491752"></p>
<p>经理审批负责人为 jerry</p>
<p>总经理审批负责人为 jack</p>
<p>财务审批负责人为 rose</p>
<h1 id="六-流程操作"><a class="markdownIt-Anchor" href="#六-流程操作">#</a> 六、流程操作</h1>
<h2 id="61-流程定义"><a class="markdownIt-Anchor" href="#61-流程定义">#</a> 6.1 流程定义</h2>
<h3 id="概述"><a class="markdownIt-Anchor" href="#概述">#</a> 概述</h3>
<p>流程定义是线下按照 bpmn2.0 标准去描述 业务流程，通常使用 idea 中的插件对业务流程进行建模。</p>
<p>使用 idea 下的 designer 设计器绘制流程，并会生成两个文件：.bpmn 和.png</p>
<h3 id="bpmn文件"><a class="markdownIt-Anchor" href="#bpmn文件">#</a> .bpmn 文件</h3>
<p>使用 activiti-desinger 设计业务流程，会生成.bpmn 文件，上面我们已经创建好了 bpmn 文件</p>
<p>BPMN 2.0 根节点是 definitions 节点。 这个元素中，可以定义多个流程定义（不过我们建议每个文件只包含一个流程定义， 可以简化开发过程中的维护难度）。 注意，definitions 元素 最少也要包含 xmlns 和 targetNamespace 的声明。 targetNamespace 可以是任意值，它用来对流程实例进行分类。</p>
<p>流程定义部分：定义了流程每个结点的描述及结点之间的流程流转。</p>
<p>流程布局定义：定义流程每个结点在流程图上的位置坐标等信息。</p>
<h3 id="生成png图片文件"><a class="markdownIt-Anchor" href="#生成png图片文件">#</a> 生成.png 图片文件</h3>
<p>IDEA 工具中的操作方式</p>
<h4 id="1-修改文件后缀为xml"><a class="markdownIt-Anchor" href="#1-修改文件后缀为xml">#</a> 1、修改文件后缀为 xml</h4>
<p>首先将 evection.bpmn 文件改名为 evection.xml，如下图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/68e0b7ef038641fe75c8b4789bc9fd82.png" alt="1575108966935"></p>
<p>evection.xml 修改前的 bpmn 文件，效果如下：<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210624233410152.png" alt="在这里插入图片描述"></p>
<h4 id="2-使用designer设计器打开xml文件"><a class="markdownIt-Anchor" href="#2-使用designer设计器打开xml文件">#</a> 2、使用 designer 设计器打开.xml 文件</h4>
<p>在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 Show BPMN2.0 Designer…</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/56cf4c6dbe90593db85bff1b5c0b10dc.png" alt="1575109268443"></p>
<h4 id="3-查看打开的文件"><a class="markdownIt-Anchor" href="#3-查看打开的文件">#</a> 3、查看打开的文件</h4>
<p>打开后，却出现乱码，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/98adf795b3a3c57761fc49084a28af51.png" alt="1575109366989"></p>
<h4 id="4-解决中文乱码"><a class="markdownIt-Anchor" href="#4-解决中文乱码">#</a> 4、解决中文乱码</h4>
<p>1、打开 Settings，找到 File Encodings，把 encoding 的选项都选择 UTF-8</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/223fbee930641ac8f6d65a467a5d36c2.png" alt="1575112075626"></p>
<p>2、打开 IDEA 安装路径，找到如下的安装目录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/4a5e3f122c63db4551f7e675fd36fa4e.png" alt="1575109627745"></p>
<p>根据自己所安装的版本来决定，我使用的是 64 位的 idea，所以在 idea64.exe.vmoptions 文件的最后一行追加一条命令： -Dfile.encoding=UTF-8</p>
<p>如下所示：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b393629505f3409a3aca9578840b8606.png" alt="https://images2017.cnblogs.com/blog/963440/201712/963440-20171221132445475-1259807908.png"></p>
<p>一定注意，不要有空格，否则重启 IDEA 时会打不开，然后 重启 IDEA。</p>
<p>如果以上方法已经做完，还出现乱码，就再修改一个文件，并在文件的末尾添加： -Dfile.encoding=UTF-8，然后重启 idea，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/ff19450a5625b5ae625128507546bb3c.png" alt="1575113551947"></p>
<p>最后重新在 evection.xml 文件上面，点右键并选择 Diagrams 菜单，再选择 Show BPMN2.0 Designer…，看到生成图片，如图：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/5b284f4d81d5207b8ea7e857f2f58ba1.png" alt="1575113951966"></p>
<p>到此，解决乱码问题</p>
<h4 id="5-导出为图片文件"><a class="markdownIt-Anchor" href="#5-导出为图片文件">#</a> 5、导出为图片文件</h4>
<p>点击 Export To File 的小图标，打开如下窗口，注意填写文件名及扩展名，选择好保存图片的位置：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/31410de865cf7a691087db4009d0fcd2.png" alt="1575114245068"></p>
<p>然后，我们把 png 文件拷贝到 resources 下的 bpmn 目录，并且把 evection.xml 改名为 evection.bpmn。</p>
<h2 id="62-流程定义部署"><a class="markdownIt-Anchor" href="#62-流程定义部署">#</a> 6.2 流程定义部署</h2>
<h3 id="概述-2"><a class="markdownIt-Anchor" href="#概述-2">#</a> 概述</h3>
<p>将上面在设计器中定义的流程部署到 activiti 数据库中，就是流程定义部署。</p>
<p>通过调用 activiti 的 api 将流程定义的 bpmn 和 png 两个文件一个一个添加部署到 activiti 中，也可以将两个文件打成 zip 包进行部署。</p>
<h3 id="单个文件部署方式"><a class="markdownIt-Anchor" href="#单个文件部署方式">#</a> 单个文件部署方式</h3>
<p>分别将 bpmn 文件和 png 图片文件部署。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivitiDemo</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 部署流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeployment</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、得到RepositoryService实例</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、使用RepositoryService进行部署</span></span><br><span class="line">        <span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.bpmn&quot;</span>) <span class="comment">// 添加bpmn资源</span></span><br><span class="line">                .addClasspathResource(<span class="string">&quot;bpmn/evection.png&quot;</span>)  <span class="comment">// 添加png资源</span></span><br><span class="line">                .name(<span class="string">&quot;出差申请流程&quot;</span>)</span><br><span class="line">                .deploy();</span><br><span class="line"><span class="comment">//        4、输出部署信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h3 id="压缩包部署方式"><a class="markdownIt-Anchor" href="#压缩包部署方式">#</a> 压缩包部署方式</h3>
<p>将 evection.bpmn 和 evection.png 压缩成 zip 包。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deployProcessByZip</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 定义zip输入流</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span></span><br><span class="line">				.getClass()</span><br><span class="line">				.getClassLoader()</span><br><span class="line">				.getResourceAsStream(</span><br><span class="line">						<span class="string">&quot;bpmn/evection.zip&quot;</span>);</span><br><span class="line">		<span class="type">ZipInputStream</span> <span class="variable">zipInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(inputStream);</span><br><span class="line">		<span class="comment">// 获取repositoryService</span></span><br><span class="line">		<span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine</span><br><span class="line">				.getRepositoryService();</span><br><span class="line">		<span class="comment">// 流程部署</span></span><br><span class="line">		<span class="type">Deployment</span> <span class="variable">deployment</span> <span class="operator">=</span> repositoryService.createDeployment()</span><br><span class="line">				.addZipInputStream(zipInputStream)</span><br><span class="line">				.deploy();</span><br><span class="line">		System.out.println(<span class="string">&quot;流程部署id：&quot;</span> + deployment.getId());</span><br><span class="line">		System.out.println(<span class="string">&quot;流程部署名称：&quot;</span> + deployment.getName());</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>执行此操作后 activiti 会将上边代码中指定的 bpm 文件和图片文件保存在 activiti 数据库。</p>
<h3 id="操作数据表"><a class="markdownIt-Anchor" href="#操作数据表">#</a> 操作数据表</h3>
<p>流程定义部署后操作 activiti 的 3 张表如下：</p>
<p>act_re_deployment 流程定义部署表，每部署一次增加一条记录</p>
<p>act_re_procdef 流程定义表，部署每个新的流程定义都会在这张表中增加一条记录</p>
<p>act_ge_bytearray 流程资源表</p>
<p>接下来我们来看看，写入了什么数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_re_deployment #流程定义部署表，记录流程部署信息</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/bcf465a3c35a6e66e2ca075a0f793dd1.png" alt="1575116732147"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_re_procdef #流程定义表，记录流程定义信息</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p>注意，KEY 这个字段是用来唯一识别不同流程的关键字</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f84eb1d97f90541675bd5a538b51d381.png" alt="1575116797665"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> act_ge_bytearray #资源表 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/20210624233344315.png" alt="在这里插入图片描述"></p>
<p>注意：</p>
<p>act_re_deployment 和 act_re_procdef 一对多关系，一次部署在流程部署表生成一条记录，但一次部署可以部署多个流程定义，每个流程定义在流程定义表生成一条记录。每一个流程定义在 act_ge_bytearray 会存在两个资源记录，bpmn 和 png。</p>
<p>建议：一次部署一个流程，这样部署表和流程定义表是一对一有关系，方便读取流程部署及流程定义信息。</p>
<h2 id="63-启动流程实例"><a class="markdownIt-Anchor" href="#63-启动流程实例">#</a> 6.3 启动流程实例</h2>
<p>流程定义部署在 activiti 后就可以通过工作流管理业务流程了，也就是说上边部署的出差申请流程可以使用了。</p>
<p>针对该流程，启动一个流程表示发起一个新的出差申请单，这就相当于 java 类与 java 对象的关系，类定义好后需要 new 创建一个对象使用，当然可以 new 多个对象。对于请出差申请流程，张三发起一个出差申请单需要启动一个流程实例，出差申请单发起一个出差单也需要启动一个流程实例。</p>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动流程实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testStartProcess</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        1、创建ProcessEngine</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取RunTimeService</span></span><br><span class="line">        <span class="type">RuntimeService</span> <span class="variable">runtimeService</span> <span class="operator">=</span> processEngine.getRuntimeService();</span><br><span class="line"><span class="comment">//        3、根据流程定义Id启动流程</span></span><br><span class="line">        <span class="type">ProcessInstance</span> <span class="variable">processInstance</span> <span class="operator">=</span> runtimeService</span><br><span class="line">                .startProcessInstanceByKey(<span class="string">&quot;myEvection&quot;</span>);</span><br><span class="line"><span class="comment">//        输出内容</span></span><br><span class="line">        System.out.println(<span class="string">&quot;流程定义id：&quot;</span> + processInstance.getProcessDefinitionId());</span><br><span class="line">        System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + processInstance.getId());</span><br><span class="line">        System.out.println(<span class="string">&quot;当前活动Id：&quot;</span> + processInstance.getActivityId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出内容如下：</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/1638a3cecc5fbee4dc99ceb37e4647dd.png" alt="1575117588624"></p>
<p><strong>操作数据表</strong></p>
<p>act_hi_actinst 流程实例执行历史</p>
<p>act_hi_identitylink 流程的参与用户历史信息</p>
<p>act_hi_procinst 流程实例历史信息</p>
<p>act_hi_taskinst 流程任务历史信息</p>
<p>act_ru_execution 流程执行信息</p>
<p>act_ru_identitylink 流程的参与用户信息</p>
<p>act_ru_task 任务信息</p>
<h2 id="64-任务查询"><a class="markdownIt-Anchor" href="#64-任务查询">#</a> 6.4 任务查询</h2>
<p>流程启动后，任务的负责人就可以查询自己当前需要处理的任务，查询出来的任务都是该用户的待办任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询当前个人待执行的任务</span></span><br><span class="line"><span class="comment">      */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindPersonalTaskList</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="comment">//        任务负责人</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">assignee</span> <span class="operator">=</span> <span class="string">&quot;zhangsan&quot;</span>;</span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        创建TaskService</span></span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line"><span class="comment">//        根据流程key 和 任务负责人 查询任务</span></span><br><span class="line">        List&lt;Task&gt; list = taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(assignee)<span class="comment">//只查询该任务负责人的任务</span></span><br><span class="line">                .list();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Task task : list) &#123;</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;流程实例id：&quot;</span> + task.getProcessInstanceId());</span><br><span class="line">            System.out.println(<span class="string">&quot;任务id：&quot;</span> + task.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;任务负责人：&quot;</span> + task.getAssignee());</span><br><span class="line">            System.out.println(<span class="string">&quot;任务名称：&quot;</span> + task.getName());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程实例id：2501</span><br><span class="line">任务id：2505</span><br><span class="line">任务负责人：zhangsan</span><br><span class="line">任务名称：创建出差申请</span><br></pre></td></tr></table></figure>
<h2 id="65-流程任务处理"><a class="markdownIt-Anchor" href="#65-流程任务处理">#</a> 6.5 流程任务处理</h2>
<p>任务负责人查询待办任务，选择任务进行处理，完成任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 完成任务</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">completTask</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取taskService</span></span><br><span class="line">        <span class="type">TaskService</span> <span class="variable">taskService</span> <span class="operator">=</span> processEngine.getTaskService();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        根据流程key 和 任务的负责人 查询任务</span></span><br><span class="line"><span class="comment">//        返回一个任务对象</span></span><br><span class="line">        <span class="type">Task</span> <span class="variable">task</span> <span class="operator">=</span> taskService.createTaskQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>) <span class="comment">//流程Key</span></span><br><span class="line">                .taskAssignee(<span class="string">&quot;zhangsan&quot;</span>)  <span class="comment">//要查询的负责人</span></span><br><span class="line">                .singleResult();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        完成任务,参数：任务id</span></span><br><span class="line">        taskService.complete(task.getId());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="66-流程定义信息查询"><a class="markdownIt-Anchor" href="#66-流程定义信息查询">#</a> 6.6 流程定义信息查询</h2>
<p>查询流程相关信息，包含流程定义，流程部署，流程定义版本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询流程定义</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryProcessDefinition</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//        获取引擎</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        得到ProcessDefinitionQuery 对象</span></span><br><span class="line">        <span class="type">ProcessDefinitionQuery</span> <span class="variable">processDefinitionQuery</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery();</span><br><span class="line"><span class="comment">//          查询出当前所有的流程定义</span></span><br><span class="line"><span class="comment">//          条件：processDefinitionKey =evection</span></span><br><span class="line"><span class="comment">//          orderByProcessDefinitionVersion 按照版本排序</span></span><br><span class="line"><span class="comment">//        desc倒叙</span></span><br><span class="line"><span class="comment">//        list 返回集合</span></span><br><span class="line">        List&lt;ProcessDefinition&gt; definitionList = processDefinitionQuery.processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .orderByProcessDefinitionVersion()</span><br><span class="line">                .desc()</span><br><span class="line">                .list();</span><br><span class="line"><span class="comment">//      输出流程定义信息</span></span><br><span class="line">        <span class="keyword">for</span> (ProcessDefinition processDefinition : definitionList) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;流程定义 id=&quot;</span>+processDefinition.getId());</span><br><span class="line">            System.out.println(<span class="string">&quot;流程定义 name=&quot;</span>+processDefinition.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;流程定义 key=&quot;</span>+processDefinition.getKey());</span><br><span class="line">            System.out.println(<span class="string">&quot;流程定义 Version=&quot;</span>+processDefinition.getVersion());</span><br><span class="line">            System.out.println(<span class="string">&quot;流程部署ID =&quot;</span>+processDefinition.getDeploymentId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>输出结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">流程定义id：myEvection:1:4</span><br><span class="line">流程定义名称：出差申请单</span><br><span class="line">流程定义key：myEvection</span><br><span class="line">流程定义版本：1</span><br></pre></td></tr></table></figure>
<h2 id="67-流程删除"><a class="markdownIt-Anchor" href="#67-流程删除">#</a> 6.7 流程删除</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDeployment</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 流程部署id</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">deploymentId</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">		</span><br><span class="line">    <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line">    <span class="comment">// 通过流程引擎获取repositoryService</span></span><br><span class="line">		<span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine</span><br><span class="line">				.getRepositoryService();</span><br><span class="line">		<span class="comment">//删除流程定义，如果该流程定义已有流程实例启动则删除时出错</span></span><br><span class="line">		repositoryService.deleteDeployment(deploymentId);</span><br><span class="line">		<span class="comment">//设置true 级联删除流程定义，即使该流程有流程实例启动也可以删除，设置为false非级别删除方式，如果流程</span></span><br><span class="line">		<span class="comment">//repositoryService.deleteDeployment(deploymentId, true);</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol>
<li>
<pre><code>  使用repositoryService删除流程定义，历史表信息不会被删除
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">     如果该流程定义下没有正在运行的流程，则可以用普通删除。</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ol>
<p>如果该流程定义下存在已经运行的流程，使用普通删除报错，可用级联删除方法将流程及相关记录全部删除。</p>
<p>先删除没有完成流程节点，最后就可以完全删除流程定义信息</p>
<p>项目开发中级联删除操作一般只开放给超级管理员使用.</p>
<h2 id="68-流程资源下载"><a class="markdownIt-Anchor" href="#68-流程资源下载">#</a> 6.8 流程资源下载</h2>
<p>现在我们的流程资源文件已经上传到数据库了，如果其他用户想要查看这些资源文件，可以从数据库中把资源文件下载到本地。</p>
<p>解决方案有：</p>
<p>1、jdbc 对 blob 类型，clob 类型数据读取出来，保存到文件目录</p>
<p>2、使用 activiti 的 api 来实现</p>
<p>使用 commons-io.jar 解决 IO 的操作</p>
<p>引入 commons-io 依赖包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过流程定义对象获取流程定义资源，获取 bpmn 和 png</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDeployment</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//        获取引擎</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        根据部署id 删除部署信息,如果想要级联删除，可以添加第二个参数，true</span></span><br><span class="line">        repositoryService.deleteDeployment(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span>  <span class="title function_">queryBpmnFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"><span class="comment">//        1、得到引擎</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        2、获取repositoryService</span></span><br><span class="line">        <span class="type">RepositoryService</span> <span class="variable">repositoryService</span> <span class="operator">=</span> processEngine.getRepositoryService();</span><br><span class="line"><span class="comment">//        3、得到查询器：ProcessDefinitionQuery，设置查询条件,得到想要的流程定义</span></span><br><span class="line">        <span class="type">ProcessDefinition</span> <span class="variable">processDefinition</span> <span class="operator">=</span> repositoryService.createProcessDefinitionQuery()</span><br><span class="line">                .processDefinitionKey(<span class="string">&quot;myEvection&quot;</span>)</span><br><span class="line">                .singleResult();</span><br><span class="line"><span class="comment">//        4、通过流程定义信息，得到部署ID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">deploymentId</span> <span class="operator">=</span> processDefinition.getDeploymentId();</span><br><span class="line"><span class="comment">//        5、通过repositoryService的方法，实现读取图片信息和bpmn信息</span></span><br><span class="line"><span class="comment">//        png图片的流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">pngInput</span> <span class="operator">=</span> repositoryService.getResourceAsStream(deploymentId, processDefinition.getDiagramResourceName());</span><br><span class="line"><span class="comment">//        bpmn文件的流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">bpmnInput</span> <span class="operator">=</span> repositoryService.getResourceAsStream(deploymentId, processDefinition.getResourceName());</span><br><span class="line"><span class="comment">//        6、构造OutputStream流</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file_png</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/evectionflow01.png&quot;</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file_bpmn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;d:/evectionflow01.bpmn&quot;</span>);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">bpmnOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file_bpmn);</span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">pngOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(file_png);</span><br><span class="line"><span class="comment">//        7、输入流，输出流的转换</span></span><br><span class="line">        IOUtils.copy(pngInput,pngOut);</span><br><span class="line">        IOUtils.copy(bpmnInput,bpmnOut);</span><br><span class="line"><span class="comment">//        8、关闭流</span></span><br><span class="line">        pngOut.close();</span><br><span class="line">        bpmnOut.close();</span><br><span class="line">        pngInput.close();</span><br><span class="line">        bpmnInput.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol>
<li>
<pre><code>  deploymentId为流程部署ID
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">     resource_name为act_ge_bytearray表中NAME_列的值</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
<li>
<pre><code>  使用repositoryService的getDeploymentResourceNames方法可以获取指定部署下得所有文件的名称
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. ```</span><br><span class="line">     使用repositoryService的getResourceAsStream方法传入部署ID和资源图片名称可以获取部署下指定名称文件的输入流</span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ol>
<p>最后的将输入流中的图片资源进行输出。</p>
<h2 id="69-流程历史信息的查看"><a class="markdownIt-Anchor" href="#69-流程历史信息的查看">#</a> 6.9 流程历史信息的查看</h2>
<p>即使流程定义已经删除了，流程执行的历史信息通过前面的分析，依然保存在 activiti 的 act_hi_* 相关的表中。所以我们还是可以查询流程执行的历史信息，可以通过 HistoryService 来查看相关的历史记录。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看历史信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findHistoryInfo</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//      获取引擎</span></span><br><span class="line">        <span class="type">ProcessEngine</span> <span class="variable">processEngine</span> <span class="operator">=</span> ProcessEngines.getDefaultProcessEngine();</span><br><span class="line"><span class="comment">//        获取HistoryService</span></span><br><span class="line">        <span class="type">HistoryService</span> <span class="variable">historyService</span> <span class="operator">=</span> processEngine.getHistoryService();</span><br><span class="line"><span class="comment">//        获取 actinst表的查询对象</span></span><br><span class="line">        <span class="type">HistoricActivityInstanceQuery</span> <span class="variable">instanceQuery</span> <span class="operator">=</span> historyService.createHistoricActivityInstanceQuery();</span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 InstanceId 查询</span></span><br><span class="line"><span class="comment">//        instanceQuery.processInstanceId(&quot;2501&quot;);</span></span><br><span class="line"><span class="comment">//        查询 actinst表，条件：根据 DefinitionId 查询</span></span><br><span class="line">        instanceQuery.processDefinitionId(<span class="string">&quot;myEvection:1:4&quot;</span>);</span><br><span class="line"><span class="comment">//        增加排序操作,orderByHistoricActivityInstanceStartTime 根据开始时间排序 asc 升序</span></span><br><span class="line">        instanceQuery.orderByHistoricActivityInstanceStartTime().asc();</span><br><span class="line"><span class="comment">//        查询所有内容</span></span><br><span class="line">        List&lt;HistoricActivityInstance&gt; activityInstanceList = instanceQuery.list();</span><br><span class="line"><span class="comment">//        输出</span></span><br><span class="line">        <span class="keyword">for</span> (HistoricActivityInstance hi : activityInstanceList) &#123;</span><br><span class="line">            System.out.println(hi.getActivityId());</span><br><span class="line">            System.out.println(hi.getActivityName());</span><br><span class="line">            System.out.println(hi.getProcessDefinitionId());</span><br><span class="line">            System.out.println(hi.getProcessInstanceId());</span><br><span class="line">            System.out.println(<span class="string">&quot;&lt;==========================&gt;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a class="markdownIt-Anchor" href="#总结">#</a> 总结</h1>
<ul>
<li>基本功能介绍以及完成了，如果还需要更加高级的功能比如挂起、激活流程实例、流程变量等请参考<a target="_blank" rel="noopener" href="https://andyoung.blog.csdn.net/article/details/118345330">【https://andyoung.blog.csdn.net/article/details/118345330】</a>。</li>
<li>工作流引擎 Activiti 与 Spring boot 结合会是开发跟简单，不如来看下 <a target="_blank" rel="noopener" href="https://andyoung.blog.csdn.net/article/details/118372175">【工作流引擎 Activiti 实战系列】</a></li>
</ul>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 <code>Java</code>  程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa31569d28cd4d5baa3a7168d4021f37~tplv-k3u1fbpfcp-zoom-1.image" alt="图片"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"> 非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/11/">上一页</a></div><div class="pagination-next is-invisible is-hidden-mobile"><a href="/page/13/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/11/">11</a></li><li><a class="pagination-link is-current" href="/page/12/">12</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:52:53.490Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90HEXO%E3%80%91%E4%BD%BF%E7%94%A8Hexo%E6%90%AD%E5%BB%BA%E5%B1%9E%E4%BA%8E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/">【HEXO】使用Hexo搭建属于自己的博客</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.463Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E3%80%91%E8%85%BE%E8%AE%AF%E4%BA%91%E7%94%B3%E8%AF%B7%E7%9A%84%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6%E9%83%A8%E7%BD%B2%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91CDN%E5%92%8C%E4%BA%91%E7%9B%BE%E8%AF%81%E4%B9%A6%E4%B8%AD%E5%BF%83/">腾讯云申请的免费证书部署到阿里云CDN和云盾证书中心</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.459Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E5%A4%96%E8%AE%BE%E3%80%91%E6%9C%BA%E6%A2%B0%E9%94%AE%E7%9B%98%E8%BD%B4%E4%BD%93%E6%80%8E%E4%B9%88%E9%80%89%EF%BC%9F%E4%B8%89%E6%A8%A1%E7%83%AD%E6%8F%92%E6%8B%94%E5%8E%9F%E6%9D%A5%E6%98%AF%E8%BF%99%E4%B9%88%E5%9B%9E%E4%BA%8B/">【外设】机械键盘轴体怎么选？三模热插拔原来是这么回事</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.456Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E6%9E%B6%E6%9E%84%E3%80%91DDD%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%9E%8B/">【架构】DDD分层架构模型</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-20T06:02:20.452Z">2023-04-20</time></p><p class="title"><a href="/2023/04/20/%E3%80%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%91%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/">云服务器部署宝塔面板</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">119</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">119</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">119</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>