<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/me.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Brath-Blog"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Brath-Blog","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/me.png"}},"description":""}</script><link rel="icon" href="https://brath.cloud/me.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-27T20:44:21.000Z" title="2023/3/28 04:44:21">2023-03-28</time>发表</span><span class="level-item"><time dateTime="2023-09-06T01:04:52.000Z" title="2023/9/6 09:04:52">2023-09-06</time>更新</span><span class="level-item">1 小时读完 (大约7699个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/28/%E3%80%90Elasticsearch%E3%80%91Elasticsearch/">Elasticsearch学习</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="elasticsearch"><a class="markdownIt-Anchor" href="#elasticsearch">#</a> Elasticsearch</h1>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/elasticsearch.jpg" alt="img"></p>
<h2 id="目标"><a class="markdownIt-Anchor" href="#目标">#</a> 目标</h2>
<ul>
<li>了解 ES 中的基本概念</li>
<li>掌握 RESTFul 操作 ES 的 CRUD</li>
<li>掌握 Spring Data Elasticsearch 操作 ES</li>
</ul>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Elasticsearch 是一个基于 Lucene 的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>
<p>我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用 JSON 通过 HTTP 来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多用户，我们希望建立一个云的解决方案。因此我们利用 Elasticsearch 来解决所有这些问题及可能出现的更多其它问题。</p>
<h2 id="安装和运行"><a class="markdownIt-Anchor" href="#安装和运行">#</a> 安装和运行</h2>
<p>该软件是基于 Java 编写的解压即用的软件，只需要有 Java 的运行环境即可，把压缩包解压后，进入到 bin 目录运行 elasticsearch.bat，出现以下界面，表示成功启动服务器</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606092632.png" alt="img"></p>
<p>浏览器输入：<strong>localhost:9200</strong>，看到浏览器输出服务器的信息，表示安装成功，可以使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606093141.png" alt="img"></p>
<p>注意：程序启动后有两个端口 9200 和 9300，9200 端口用于 HTTP 协议，基于 RESTFul 来使用，9300 端口用于 TCP 协议，基于 jar 包来使用</p>
<h3 id="后台启动"><a class="markdownIt-Anchor" href="#后台启动">#</a> 后台启动</h3>
<p>使用<strong>安装目录 /bin/elasticsearch-service.bat</strong> 程序可以把 Elasticsearch 安装后服务列表中，以后我们可以在服务列表来启动该程序，也可以设置成开机启动模式</p>
<p>注意：设置后台启动需要手动配置 Java 虚拟机的路径，使用命令<strong> elasticsearch-service.bat manager</strong> 来配置</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190622211819.png" alt="img"></p>
<h3 id="安装head插件"><a class="markdownIt-Anchor" href="#安装head插件">#</a> 安装 head 插件</h3>
<p>Elasticsearch 默认的客户端工具是命令行形式的，操作起来不方便，也不直观看到数据的展示，所以我们需要去安装一个可视化插件，但是这些插件都是基于 H5 开发的，在谷歌的应用商店中找到<strong> elasticsearch-head</strong> 插件，然后安装，使用该插件能比较直观的展示服务器中的数据</p>
<h3 id="安装kibana"><a class="markdownIt-Anchor" href="#安装kibana">#</a> 安装 kibana</h3>
<p>该软件也是解压即用的工具，用于管理和监控 Elasticsearch 的运作，同时内部包含了客户端工具，支持 RESTFul 操作 Elasticsearch。解压后运行 bin/kibana.bat，看到启动成功的端口号即可以使用浏览器来使用了</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606141235.png" alt="img"></p>
<p>浏览器输入：<a target="_blank" rel="noopener" href="http://localhost:5601/">http://localhost:5601</a></p>
<h2 id="概念名词"><a class="markdownIt-Anchor" href="#概念名词">#</a> 概念名词</h2>
<h3 id="数据存储图"><a class="markdownIt-Anchor" href="#数据存储图">#</a> 数据存储图</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604113843.png" alt="img"></p>
<p>注意：从 Elasticsearch6 开始一个索引里面只能有一个类型，后续计划删除类型这个概念，从 ES6 开始一般让索引名称和类型名称一致</p>
<h3 id="主要组件"><a class="markdownIt-Anchor" href="#主要组件">#</a> 主要组件</h3>
<ul>
<li>
<p>索引</p>
<p>ES 将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于 SQL 中的一个数据库，或者一个数据存储方案 (schema)。索引由其名称 (必须为全小写字符) 进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个 ES 集群中可以按需创建任意数目的索引。</p>
</li>
<li>
<p>类型</p>
<p>类型是索引内部的逻辑分区 (category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型 (type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于表。</p>
</li>
<li>
<p>映射</p>
<p>Mapping, 就是对索引库中索引的字段名称及其数据类型进行定义，类似于 mysql 中的表结构信息。不过 es 的 mapping 比数据库灵活很多，它可以动态识别字段。一般不需要指定 mapping 都可以，因为 es 会自动根据数据格式识别它的类型，如果你需要对某些字段添加特殊属性（如：定义使用其它分词器、是否分词、是否存储等），就必须手动添加 mapping。</p>
<p>需要注意的是映射是不可修改的，一旦确定就不允许改动，在使用自动识别功能时，会以第一个存入的文档为参考来建立映射，后面存入的文档也必须符合该映射才能存入</p>
</li>
<li>
<p>文档</p>
<p>文档是 Lucene 索引和搜索的原子单位，它是包含了一个或多个域的容器，基于 JSON 格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为多值域。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p>
</li>
</ul>
<h3 id="分片和副本"><a class="markdownIt-Anchor" href="#分片和副本">#</a> 分片和副本</h3>
<p>ES 的分片 (shard) 机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的 Lucene 索引完成索引数据的分割存储功能，这每一个物理的 Lucene 索引称为一个分片 (shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为 5 个。</p>
<p>Shard 有两种类型：primary 和 replica，即主 shard 及副本 shard。Primary shard 用于文档存储，每个新的索引会自动创建 5 个 Primary shard，当然此数量可在索引创建之前通过配置自行定义，不过，一旦创建完成，其 Primary shard 的数量将不可更改。Replica shard 是 Primary Shard 的副本，用于冗余数据及提高搜索性能。每个 Primary shard 默认配置了一个 Replica shard，但也可以配置多个，且其数量可动态更改。ES 会根据需要自动增加或减少这些 Replica shard 的数量。</p>
<h3 id="分词器"><a class="markdownIt-Anchor" href="#分词器">#</a> 分词器</h3>
<p>把文本内容按照标准进行切分，默认的是 standard，该分词器按照单词切分，内容转变为小写，去掉标点，遇到每个中文字符都当成 1 个单词处理，后面会安装开源的中文分词器插件（ik）</p>
<h4 id="感受分词器效果"><a class="markdownIt-Anchor" href="#感受分词器效果">#</a> 感受分词器效果</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">先创建一个名叫shop_product的索引，然后再感受分词效果</span><br><span class="line">PUT /shop_product</span><br><span class="line"></span><br><span class="line">默认分词器：</span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;</span><br><span class="line">&#125;</span><br><span class="line">结论：默认的分词器只能对英文正常分词，不能对中文正常分词</span><br></pre></td></tr></table></figure>
<h4 id="安装ik分词器"><a class="markdownIt-Anchor" href="#安装ik分词器">#</a> 安装 IK 分词器</h4>
<p>直接把压缩文件中的内容解压，然后放在 elasticsearch/plugins 下，然后重启即可</p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190611130218.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IK分词器：</span><br><span class="line">ik_smart：粗力度分词</span><br><span class="line">ik_max_word：细力度分词</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;I am Groot&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET /shop_product/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class="line">  &quot;analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">结论：都能正常分词</span><br></pre></td></tr></table></figure>
<h4 id="拓展词库"><a class="markdownIt-Anchor" href="#拓展词库">#</a> 拓展词库</h4>
<p>最简单的方式就是找到 IK 插件中的<strong> config/main.dic</strong> 文件，往里面添加新的词汇，然后重启服务器即可</p>
<h3 id="倒排索引"><a class="markdownIt-Anchor" href="#倒排索引">#</a> 倒排索引</h3>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604141259.png" alt="img"></p>
<h2 id="基本操作了解"><a class="markdownIt-Anchor" href="#基本操作了解">#</a> 基本操作（了解）</h2>
<h3 id="索引操作"><a class="markdownIt-Anchor" href="#索引操作">#</a> 索引操作</h3>
<p>建表索引，相当于在是在建立数据库</p>
<h4 id="建立索引"><a class="markdownIt-Anchor" href="#建立索引">#</a> 建立索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">在没有特殊设置的情况下，默认有5个分片，1个备份，也可以通过请求参数的方式来指定</span><br><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 5, //设置5个片区</span><br><span class="line">    &quot;number_of_replicas&quot;: 1 //设置1个备份</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="删除索引"><a class="markdownIt-Anchor" href="#删除索引">#</a> 删除索引</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名</span><br></pre></td></tr></table></figure>
<h3 id="映射操作"><a class="markdownIt-Anchor" href="#映射操作">#</a> 映射操作</h3>
<h4 id="建立索引和映射"><a class="markdownIt-Anchor" href="#建立索引和映射">#</a> 建立索引和映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    类型名: &#123;</span><br><span class="line">      &quot;properties..0&quot;: &#123;</span><br><span class="line">        字段名: &#123;</span><br><span class="line">          &quot;type&quot;: 字段类型, </span><br><span class="line">          &quot;analyzer&quot;: 分词器类型, </span><br><span class="line">          &quot;search_analyzer&quot;: 分词器类型,</span><br><span class="line">          ...</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">字段类型：double / long / integer / text / keyword / date / binary</span><br><span class="line">注意：text和keyword都是字符串类型，但是只有text类型的数据才能分词，字段的配置一旦确定就不能更改</span><br><span class="line">映射的配置项有很多，我们可以根据需要只配置用得上的属性</span><br></pre></td></tr></table></figure>
<h4 id="查询映射"><a class="markdownIt-Anchor" href="#查询映射">#</a> 查询映射</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：GET /索引名/_mapping</span><br></pre></td></tr></table></figure>
<h2 id="crud操作"><a class="markdownIt-Anchor" href="#crud操作">#</a> CRUD 操作</h2>
<h3 id="文档操作"><a class="markdownIt-Anchor" href="#文档操作">#</a> 文档操作</h3>
<h4 id="新增和替换文档"><a class="markdownIt-Anchor" href="#新增和替换文档">#</a> 新增和替换文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">语法：PUT /索引名/类型名/文档ID</span><br><span class="line">&#123;</span><br><span class="line">  field1: value1,</span><br><span class="line">  field2: value2,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">注意：当索引/类型/映射不存在时，会使用默认设置自动添加</span><br><span class="line">ES中的数据一般是从别的数据库导入的，所以文档的ID会沿用原数据库中的ID</span><br><span class="line">索引库中没有该ID对应的文档时则新增，拥有该ID对应的文档时则替换</span><br><span class="line"></span><br><span class="line">需求1：新增一个文档</span><br><span class="line">需求2：替换一个文档</span><br></pre></td></tr></table></figure>
<p>每一个文档都内置以下字段</p>
<blockquote>
<p>_index：所属索引</p>
<p>_type：所属类型</p>
<p>_id：文档 ID</p>
<p>_version：乐观锁版本号</p>
<p>_source：数据内容</p>
</blockquote>
<h4 id="查询文档"><a class="markdownIt-Anchor" href="#查询文档">#</a> 查询文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">根据ID查询 -&gt; GET /索引名/类型名/文档ID</span><br><span class="line">查询所有（基本查询语句） -&gt; GET /索引名/类型名/_search</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID查询一个文档</span><br><span class="line">需求2：查询所有的文档</span><br></pre></td></tr></table></figure>
<p>查询所有结果中包含以下字段</p>
<blockquote>
<p>took：耗时</p>
<p>_shards.total：分片总数</p>
<p>hits.total：查询到的数量</p>
<p>hits.max_score：最大匹配度</p>
<p>hits.hits：查询到的结果</p>
<p>hits.hits._score：匹配度</p>
</blockquote>
<h4 id="删除文档"><a class="markdownIt-Anchor" href="#删除文档">#</a> 删除文档</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：DELETE /索引名/类型名/文档ID</span><br><span class="line">注意：这里的删除并且不是真正意义上的删除，仅仅是清空文档内容而已，并且标记该文档的状态为删除</span><br><span class="line"></span><br><span class="line">需求1：根据文档ID删除一个文档</span><br><span class="line">需求2：替换刚刚删除的文档</span><br></pre></td></tr></table></figure>
<h2 id="高级查询"><a class="markdownIt-Anchor" href="#高级查询">#</a> 高级查询</h2>
<p>数据准备：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">PUT /shop_product</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;shop_product&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;price&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;double&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;intro&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;, </span><br><span class="line">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class="line">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;brand&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /shop_product/shop_product/_bulk</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:1,&quot;title&quot;:&quot;Apple iPhone XR (A2108) 128GB 白色 移动联通电信4G手机 双卡双待&quot;,&quot;price&quot;:5299,&quot;intro&quot;:&quot;【iPhoneXR限时特惠！】6.1英寸视网膜显示屏，A12仿生芯片，面容识别，无线充电，支持双卡！选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:2,&quot;title&quot;:&quot;Apple 2019款 Macbook Pro 13.3【带触控栏】八代i7 18G 256G RP645显卡 深空灰 苹果笔记本电脑 轻薄本 MUHN2CH/A&quot;,&quot;price&quot;:15299,&quot;intro&quot;:&quot;【八月精选】Pro2019年新品上市送三重好礼，现在购买领满8000减400元优惠神劵，劵后更优惠！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;Apple iPad Air 3 2019年新款平板电脑 10.5英寸（64G WLAN版/A12芯片/Retina显示屏/MUUL2CH/A）金色&quot;,&quot;price&quot;:3788,&quot;intro&quot;:&quot;8月尊享好礼！买iPad即送蓝牙耳机！领券立减！多款产品支持手写笔！【新一代iPad，总有一款适合你】选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 4&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;华为HUAWEI MateBook X Pro 2019款 英特尔酷睿i5 13.9英寸全面屏轻薄笔记本电脑(i5 8G 512G 3K 触控) 灰&quot;,&quot;price&quot;:7999,&quot;intro&quot;:&quot;3K全面屏开启无界视野;轻薄设计灵动有型，HuaweiShare一碰传&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 5&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:5,&quot;title&quot;:&quot;华为 HUAWEI Mate20 X (5G) 7nm工艺5G旗舰芯片全面屏超大广角徕卡三摄8GB+256GB翡冷翠5G双模全网通手机&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;【5G双模，支持SA/NSA网络，7.2英寸全景巨屏，石墨烯液冷散热】5G先驱，极速体验。&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 6&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:6,&quot;title&quot;:&quot;华为平板 M6 10.8英寸麒麟980影音娱乐平板电脑4GB+64GB WiFi（香槟金）&quot;,&quot;price&quot;:2299,&quot;intro&quot;:&quot;【华为暑期购】8月2日-4日，M5青春版指定爆款型号优惠100元，AI语音控制&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 7&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:7,&quot;title&quot;:&quot;荣耀20 PRO DXOMARK全球第二高分 4800万四摄 双光学防抖 麒麟980 全网通4G 8GB+128GB 蓝水翡翠 拍照手机&quot;,&quot;price&quot;:3199,&quot;intro&quot;:&quot;白条6期免息！麒麟980，4800万全焦段AI四摄！荣耀20系列2699起，4800万超广角AI四摄！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 8&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:8,&quot;title&quot;:&quot;荣耀MagicBook Pro 16.1英寸全面屏轻薄性能笔记本电脑（酷睿i7 8G 512G MX250 IPS FHD 指纹解锁）冰河银&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;16.1英寸无界全面屏金属轻薄本，100%sRGB色域，全高清IPS防眩光护眼屏，14小时长续航，指纹一健开机登录，魔法一碰传高速传输。&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 9&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:9,&quot;title&quot;:&quot;荣耀平板5 麒麟8核芯片 GT游戏加速 4G+128G 10.1英寸全高清屏影音平板电脑 WiFi版 冰川蓝&quot;,&quot;price&quot;:1549,&quot;intro&quot;:&quot;【爆款平板推荐】哈曼卡顿专业调音，10.1英寸全高清大屏，双喇叭立体环绕音，配置多重护眼，值得拥有！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 10&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:10,&quot;title&quot;:&quot;小米9 4800万超广角三摄 6GB+128GB全息幻彩蓝 骁龙855 全网通4G 双卡双待 水滴全面屏拍照智能游戏手机&quot;,&quot;price&quot;:2799,&quot;intro&quot;:&quot;限时优惠200，成交价2799！索尼4800万广角微距三摄，屏下指纹解锁！&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 11&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:11,&quot;title&quot;:&quot;小米(MI)Pro 2019款 15.6英寸金属轻薄笔记本(第八代英特尔酷睿i7-8550U 16G 512GSSD MX250 2G独显) 深空灰&quot;,&quot;price&quot;:6899,&quot;intro&quot;:&quot;【PCIE固态硬盘、72%NTSC高色域全高清屏】B面康宁玻璃覆盖、16G双通道大内存、第八代酷睿I7处理器、专业级调校MX150&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class="line">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 12&#125;&#125;</span><br><span class="line">&#123;&quot;id&quot;:12,&quot;title&quot;:&quot;联想(Lenovo)拯救者Y7000P 2019英特尔酷睿i7 15.6英寸游戏笔记本电脑(i7 9750H 16G 1T SSD GTX1660Ti 144Hz)&quot;,&quot;price&quot;:9299,&quot;intro&quot;:&quot;超大1T固态，升级双通道16G内存一步到位，GTX1660Ti电竞级独显，英特尔9代i7H高性能处理器，144Hz电竞屏窄边框！&quot;,&quot;brand&quot;:&quot;联想&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>Elasticsearch 基于 JSON 提供完整的查询 DSL（Domain Specific Language：领域特定语言）来定义查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">基本语法：</span><br><span class="line">GET /索引名/类型名/_search</span><br></pre></td></tr></table></figure>
<p>一般都是需要配合查询参数来使用的，配合不同的参数有不同的查询效果</p>
<p>参数配置项可以参考博客：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/6333940621ec">https://www.jianshu.com/p/6333940621ec</a></p>
<h3 id="结果排序"><a class="markdownIt-Anchor" href="#结果排序">#</a> 结果排序</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;field: 排序规则&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">排序</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">排序规则：</span><br><span class="line">asc表示升序</span><br><span class="line">desc:表示降序</span><br><span class="line">没有配置排序的情况下，默认按照评分降序排列</span><br></pre></td></tr></table></figure>
<h3 id="分页查询"><a class="markdownIt-Anchor" href="#分页查询">#</a> 分页查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: start,</span><br><span class="line">  &quot;size&quot;: pageSize</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分页 从第几个开始 每页几个</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;from&quot;: 2,</span><br><span class="line">  &quot;size&quot;: 4,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">需求1：查询所有文档按照价格降序排列</span><br><span class="line">需求2：分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br></pre></td></tr></table></figure>
<h3 id="检索查询"><a class="markdownIt-Anchor" href="#检索查询">#</a> 检索查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    检索方式: &#123;field: value&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 全文检索</span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;游戏 手机&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索查询 精准匹配</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: 15299</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">检索查询 范围检索</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;range&quot;: &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;gte&quot;: 5000,</span><br><span class="line">        &quot;lte&quot;: 10000</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;price&quot;: &#123;</span><br><span class="line">        &quot;order&quot;: &quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">检索方式：</span><br><span class="line">term表示精确匹配，value值不会被分词器拆分，按照倒排索引匹配</span><br><span class="line">match表示全文检索，value值会被分词器拆分，然后去倒排索引中匹配</span><br><span class="line">range表示范围检索，其value值是一个对象，如&#123; &quot;range&quot;: &#123;field: &#123;比较规则: value, ...&#125;&#125; &#125;</span><br><span class="line">  比较规则有gt / gte / lt / lte 等</span><br><span class="line">  </span><br><span class="line">注意：term和match都能用在数值和字符上，range用在数值上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">需求2：查询商品价格等于15299的商品</span><br><span class="line">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br></pre></td></tr></table></figure>
<h3 id="关键字查询"><a class="markdownIt-Anchor" href="#关键字查询">#</a> 关键字查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: value,</span><br><span class="line">      &quot;fields&quot;: [field1, field2, ...]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">关键字查询</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">multi_match：表示在多个字段间做检索，只要其中一个字段满足条件就能查询出来，多用在字段上</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br></pre></td></tr></table></figure>
<h3 id="高亮显示"><a class="markdownIt-Anchor" href="#高亮显示">#</a> 高亮显示</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123; ... &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      field1: &#123;&#125;,</span><br><span class="line">      field2: &#123;&#125;,</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;: 开始标签,</span><br><span class="line">    &quot;post_tags&quot; 结束标签</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">高亮显示</span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;&#125;,</span><br><span class="line">      &quot;intro&quot;: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;pre_tags&quot;:&quot;&lt;h1&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;:&quot;&lt;/h1&gt;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight：表示高亮显示，需要在fields中配置哪些字段中检索到该内容需要高亮显示</span><br><span class="line">  必须配合检索(term / match)一起使用</span><br><span class="line">  </span><br><span class="line">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br></pre></td></tr></table></figure>
<h3 id="逻辑查询"><a class="markdownIt-Anchor" href="#逻辑查询">#</a> 逻辑查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">参数格式： </span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      逻辑规则: [</span><br><span class="line">        &#123;检索方式: &#123;field: value&#125;&#125;, </span><br><span class="line">        ...</span><br><span class="line">      ],</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;i7&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gt&quot;: 7000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">逻辑查询</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123;&quot;range&quot;: &#123;</span><br><span class="line">          &quot;price&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 1000,</span><br><span class="line">            &quot;lte&quot;: 3000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">逻辑规则：must / should / must_not，相当于and / or / not</span><br><span class="line"></span><br><span class="line">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br></pre></td></tr></table></figure>
<h3 id="过滤查询"><a class="markdownIt-Anchor" href="#过滤查询">#</a> 过滤查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123; 检索方式: &#123; field: value &#125; &#125;，            	</span><br><span class="line">        ...</span><br><span class="line">      ]</span><br><span class="line">    &#125;             </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">过滤查询 不评分</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: [</span><br><span class="line">        &#123;&quot;match&quot;: &#123;</span><br><span class="line">          &quot;title&quot;: &quot;pro&quot;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">从效果上讲过滤查询和检索查询能做一样的效果</span><br><span class="line">区别在于过滤查询不评分，结果能缓存，检索查询要评分，结果不缓存</span><br><span class="line">一般是不会直接使用过滤查询，都是在检索了一定数据的基础上再使用</span><br></pre></td></tr></table></figure>
<p>关于 filter 的更多认知推荐大家读这篇博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/laoyang360/article/details/80468757">https://blog.csdn.net/laoyang360/article/details/80468757</a></p>
<h3 id="分组查询"><a class="markdownIt-Anchor" href="#分组查询">#</a> 分组查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">参数格式：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    自定义分组字段: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: 分组字段, </span><br><span class="line">        &quot;order&quot;: &#123;自定义统计字段:排序规则&#125;, </span><br><span class="line">        &quot;size&quot;: 10  //默认显示10组 </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; //分组后的统计查询，相当于MySQL分组函数查询</span><br><span class="line">        自定义统计字段: &#123;</span><br><span class="line">          分组运算: &#123;</span><br><span class="line">            &quot;field&quot;: 统计字段</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;value_count&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;id&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组查询</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br><span class="line">GET /shop_product/shop_product/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">      &quot;terms&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class="line">        &quot;order&quot;: &#123;&quot;brand_group_aggs.count&quot;:&quot;desc&quot;&#125;, </span><br><span class="line">        &quot;size&quot;: 10  </span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123; </span><br><span class="line">        &quot;brand_group_aggs&quot;: &#123;</span><br><span class="line">          &quot;stats&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;price&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;       </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">分组运算：avg / sum / min / max / value_count / stats(执行以上所有功能的)</span><br><span class="line">注意：这里是size=0其目的是为了不要显示hit内容，专注点放在观察分组上</span><br><span class="line"></span><br><span class="line">需求1：按照品牌分组，统计各品牌的数量</span><br><span class="line">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class="line">需求3：按照品牌分组，统计各品牌的价格数据</span><br></pre></td></tr></table></figure>
<h2 id="批处理了解"><a class="markdownIt-Anchor" href="#批处理了解">#</a> 批处理（了解）</h2>
<p>当需要集中的批量处理文档时，如果依然使用传统的操作单个 API 的方式，将会浪费大量网络资源，Elasticsearch 为了提高操作的性能，专门提供了批处理的 API</p>
<h3 id="mget批量查询"><a class="markdownIt-Anchor" href="#mget批量查询">#</a> mget 批量查询</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">GET /索引名/类型/_mget</span><br><span class="line">&#123;</span><br><span class="line">  &quot;docs&quot;: [</span><br><span class="line">    &#123;&quot;_id&quot;: 文档ID&#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="bulk批量增删改"><a class="markdownIt-Anchor" href="#bulk批量增删改">#</a> bulk 批量增删改</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法：</span><br><span class="line">POST /索引名/类型/_bulk</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class="line">&#123;...&#125;</span><br><span class="line"></span><br><span class="line">动作：create / update / delete，其中delete只有1行JSON，其他操作都是有2行JSON，并且JSON不能格式化，如果是update动作，它的数据需要加个key为doc</span><br><span class="line">如：</span><br><span class="line">&#123;&quot;update&quot;: &#123;&quot;_id&quot;: xx&#125;&#125;</span><br><span class="line">&#123;&quot;doc&quot;: &#123;&quot;xx&quot;:xx, &quot;xx&quot;:xx&#125;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="spring-data-elasticsearch"><a class="markdownIt-Anchor" href="#spring-data-elasticsearch">#</a> Spring Data Elasticsearch</h2>
<h3 id="准备环境"><a class="markdownIt-Anchor" href="#准备环境">#</a> 准备环境</h3>
<h4 id="导入依赖"><a class="markdownIt-Anchor" href="#导入依赖">#</a> 导入依赖</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;!--SpringBoot整合Spring Data Elasticsearch的依赖--&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.8.3&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h4 id="编写domain"><a class="markdownIt-Anchor" href="#编写domain">#</a> 编写 DOMAIN</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  @Document：配置操作哪个索引下的哪个类型</span><br><span class="line">  @Id：标记文档ID字段</span><br><span class="line">  @Field：配置映射信息，如：分词器</span><br><span class="line"> */</span><br><span class="line">@Getter@Setter@ToString</span><br><span class="line">@NoArgsConstructor</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@Document(indexName=&quot;shop_product&quot;, type=&quot;shop_product&quot;)</span><br><span class="line">public class Product &#123;</span><br><span class="line">    @Id</span><br><span class="line">    private String id;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String title;</span><br><span class="line"></span><br><span class="line">    private Integer price;</span><br><span class="line"></span><br><span class="line">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class="line">    private String intro;</span><br><span class="line"></span><br><span class="line">    @Field(type=FieldType.Keyword)</span><br><span class="line">    private String brand;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置连接信息"><a class="markdownIt-Anchor" href="#配置连接信息">#</a> 配置连接信息</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#application.properties</span><br><span class="line"># 配置集群名称，名称写错会连不上服务器，默认elasticsearch</span><br><span class="line">spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"># 配置集群节点</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchrepository"><a class="markdownIt-Anchor" href="#elasticsearchrepository">#</a> ElasticsearchRepository</h3>
<p>该接口是框架封装的用于操作 Elastsearch 的高级接口，只要我们自己的写个接口去继承该接口就能直接对 Elasticsearch 进行 CRUD 操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">  泛型1：domain的类型</span><br><span class="line">  泛型2：文档主键类型</span><br><span class="line">  该接口直接该给Spring，底层会使用JDK代理的方式创建对象，交给容器管理</span><br><span class="line"> */</span><br><span class="line">@Repository</span><br><span class="line">public interface ProductESRepository extends ElasticsearchRepository&lt;Product, String&gt; &#123;</span><br><span class="line">    // 符合Spring Data规范的高级查询方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完成crud分页排序"><a class="markdownIt-Anchor" href="#完成crud分页排序">#</a> 完成 CRUD + 分页 + 排序</h3>
<h3 id="组件介绍"><a class="markdownIt-Anchor" href="#组件介绍">#</a> 组件介绍</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ElasticsearchRepository：框架封装的用于便捷完成常用操作的工具接口</span><br><span class="line">ElasticsearchTemplate：框架封装的用于便捷操作Elasticsearch的模板类</span><br><span class="line"></span><br><span class="line">NativeSearchQueryBuilder：用于生成查询条件的构建器，需要去封装各种查询条件</span><br><span class="line">QueryBuilder：该接口表示一个查询条件，其对象可以通过QueryBuilders工具类中的方法快速生成各种条件</span><br><span class="line">  boolQuery()：生成bool条件，相当于 &quot;bool&quot;: &#123; &#125;</span><br><span class="line">  matchQuery()：生成match条件，相当于 &quot;match&quot;: &#123; &#125;</span><br><span class="line">  rangeQuery()：生成range条件，相当于 &quot;range&quot;: &#123; &#125;</span><br><span class="line">AbstractAggregationBuilder：用于生成分组查询的构建器，其对象通过AggregationBuilders工具类生成</span><br><span class="line">Pageable：表示分页参数，对象通过PageRequest.of(页数, 容量)获取</span><br><span class="line">SortBuilder：排序构建器，对象通过SortBuilders.fieldSort(字段).order(规则)获取</span><br></pre></td></tr></table></figure>
<h3 id="elasticsearchtemplate"><a class="markdownIt-Anchor" href="#elasticsearchtemplate">#</a> ElasticsearchTemplate</h3>
<p>该模板类，封装了便捷操作 Elasticsearch 的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作，该对象用起来会略微复杂些，尤其是对于查询，还需要把查询到的结果自己封装对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//该对象已经由SpringBoot完成自动配置，直接注入即可</span><br><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br></pre></td></tr></table></figure>
<p>一般情况下，ElasticsearchTemplate 和 ElasticsearchRepository 是分工合作的，ElasticsearchRepository 已经能完成绝大部分的功能，如果遇到复杂的查询则要使用 ElasticsearchTemplate，如多字段分组、高亮显示等</p>
<h3 id="实例代码"><a class="markdownIt-Anchor" href="#实例代码">#</a> 实例代码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ElasticsearchTemplate template;</span><br><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">private ProductESRepository repository;</span><br><span class="line"></span><br><span class="line">// 新增或者覆盖一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testSaveOrUpdate() throws Exception &#123;</span><br><span class="line">    // 索引库中不存在则新增，存在则覆盖</span><br><span class="line">    Product p = new Product(&quot;13&quot;, &quot;华为手环 B5（Android 运动手环）&quot;, 999,</span><br><span class="line">                            &quot;高清彩屏 腕上蓝牙耳机 心率检测 来电消息提醒&quot;, &quot;华为&quot;);</span><br><span class="line">    repostitory.save(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testDelete() throws Exception &#123;</span><br><span class="line">    repostitory.deleteById(&quot;13&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 根据ID查询一个文档</span><br><span class="line">@Test</span><br><span class="line">public void testGet() throws Exception &#123;</span><br><span class="line">    Optional&lt;Product&gt; optional = repostitory.findById(&quot;1&quot;);</span><br><span class="line">    optional.ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询所有文档</span><br><span class="line">@Test</span><br><span class="line">public void testList() throws Exception &#123;</span><br><span class="line">    Iterable&lt;Product&gt; iter = repostitory.findAll();</span><br><span class="line">    iter.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br><span class="line">@Test</span><br><span class="line">public void testQuery1() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置分页信息</span><br><span class="line">    builder.withPageable(PageRequest.of(1, 3));</span><br><span class="line">    // 设置排序信息</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.DESC));</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    System.out.println(page.getTotalElements()); //总记录数</span><br><span class="line">    System.out.println(page.getTotalPages()); //总页数</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery2() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.matchQuery(&quot;title&quot;, &quot;游戏 手机&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格等于15299的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery3() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.termQuery(&quot;price&quot;, 15299)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品价格在5000~9000之间商品，按照价格升序排列</span><br><span class="line">@Test</span><br><span class="line">public void testQuery4() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.rangeQuery(&quot;price&quot;)</span><br><span class="line">            .gte(5000).lte(9000)</span><br><span class="line">    );</span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.ASC));</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery5() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery6() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">        .must(QueryBuilders.matchQuery(&quot;title&quot;, &quot;i7&quot;))</span><br><span class="line">        .must(QueryBuilders.rangeQuery(&quot;price&quot;).gt(7000))</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class="line">@Test</span><br><span class="line">public void testQuery7() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.boolQuery()</span><br><span class="line">            .should(QueryBuilders.matchQuery(&quot;title&quot;, &quot;pro&quot;))</span><br><span class="line">            .should(QueryBuilders.rangeQuery(&quot;price&quot;).gte(1000).lte(3000))</span><br><span class="line">    );</span><br><span class="line">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的数量</span><br><span class="line">@Test</span><br><span class="line">public void testQuery8() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; System.out.println(bucket.getDocCount()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的平均价格</span><br><span class="line">@Test</span><br><span class="line">public void testQuery9() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.avg(&quot;avgPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalAvg avgPrice = bucket.getAggregations().get(&quot;avgPrice&quot;);</span><br><span class="line">        System.out.println(avgPrice.getValue());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 按照品牌分组，统计各品牌的价格数据</span><br><span class="line">@Test</span><br><span class="line">public void testQuery10() throws Exception &#123;</span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    builder.addAggregation(</span><br><span class="line">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class="line">        .subAggregation(AggregationBuilders.stats(&quot;statsPrice&quot;).field(&quot;price&quot;))</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class="line">    // 获取自定义的分组字段</span><br><span class="line">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class="line">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class="line">        InternalStats statsPrice = bucket.getAggregations().get(&quot;statsPrice&quot;);</span><br><span class="line">        System.out.println(statsPrice.getSumAsString());</span><br><span class="line">        System.out.println(statsPrice.getAvgAsString());</span><br><span class="line">        System.out.println(statsPrice.getMaxAsString());</span><br><span class="line">        System.out.println(statsPrice.getMinAsString());</span><br><span class="line">        System.out.println(statsPrice.getCount());</span><br><span class="line">        System.out.println(&quot;-----------------------&quot;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class="line">@Test</span><br><span class="line">public void testHighlight() throws Exception &#123;</span><br><span class="line">    // Java与JSON互转的工具对象</span><br><span class="line">    ObjectMapper mapper = new ObjectMapper();</span><br><span class="line"></span><br><span class="line">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class="line">    // 设置查询哪个索引中的哪个类型</span><br><span class="line">    builder.withIndices(&quot;shop_product&quot;).withTypes(&quot;shop_product&quot;);</span><br><span class="line">    builder.withQuery(</span><br><span class="line">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class="line">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class="line">    );</span><br><span class="line">    builder.withHighlightFields(</span><br><span class="line">        new HighlightBuilder.Field(&quot;title&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;),</span><br><span class="line">        new HighlightBuilder.Field(&quot;intro&quot;)</span><br><span class="line">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;)</span><br><span class="line">    );</span><br><span class="line">    AggregatedPage&lt;Product&gt; page = template.queryForPage(builder.build(), Product.class, new SearchResultMapper() &#123;</span><br><span class="line">        public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse resp, Class&lt;T&gt; clazz, Pageable pageable) &#123;</span><br><span class="line">            List&lt;T&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">            try &#123;</span><br><span class="line">                for (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class="line">                    // 把查询到的JSON字符串转换成Java对象</span><br><span class="line">                    T t = mapper.readValue(hit.getSourceAsString(), clazz);</span><br><span class="line">                    for (HighlightField field : hit.getHighlightFields().values()) &#123;</span><br><span class="line">                        // 替换需要高亮显示的字段，用到Apache的BeanUtils工具</span><br><span class="line">                        BeanUtils.setProperty(t, field.getName(), field.getFragments()[0].string());</span><br><span class="line">                    &#125;</span><br><span class="line">                    list.add(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">            long total = resp.getHits().totalHits;</span><br><span class="line">            return new AggregatedPageImpl&lt;&gt;(list, pageable, total);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    page.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="springboot23x以上配置"><a class="markdownIt-Anchor" href="#springboot23x以上配置">#</a> springboot2.3.x 以上配置</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.0.1.RELEASE/reference/html/#new-features">配置关系对应</a></p>
<p><img src="https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png" alt="截屏2021-08-14 14.17.14"></p>
</blockquote>
<ol>
<li>
<p>pom 相同</p>
</li>
<li>
<p>配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 旧版本以spring.data.elasticsearch.开头;访问地址配置不用声明访问协议,监听es的tcp端口</span><br><span class="line">#spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br><span class="line">#spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class="line"></span><br><span class="line">## 新版本以spring.elasticsearch.rest.开头;访问地址配置需要声明访问协议,直接监听es访问端口</span><br><span class="line">spring.elasticsearch.rest.uris=http://localhost:9200</span><br><span class="line">spring.elasticsearch.rest.username=elasticsearch</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>使用</p>
<ul>
<li>
<p>旧版的核心访问对象是 ElasticsearchTemplate；新版的核心访问对象是 ElasticsearchRestTemplate；</p>
</li>
<li>
<p>实体类没有类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// @Document指定当前类是索引对象。indexName:索引名称;shards:创建索引时的分片数;replicas:创建索引时的备份数</span><br><span class="line">@Document(indexName = &quot;book_&quot;, shards = 5, replicas = 1)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-07T02:12:13.000Z" title="2023/3/7 10:12:13">2023-03-07</time>发表</span><span class="level-item"><time dateTime="2023-04-26T02:22:12.911Z" title="2023/4/26 10:22:12">2023-04-26</time>更新</span><span class="level-item">4 分钟读完 (大约581个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/07/%E3%80%90chatGPT%E3%80%91%E5%88%A9%E7%94%A8%E8%85%BE%E8%AE%AF%E4%BA%91%E5%87%BD%E6%95%B0%E5%85%8D%E8%B4%B9%E9%83%A8%E7%BD%B2%E5%9B%BD%E5%86%85%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8ChatGPT%E4%BB%A3%E7%90%86%EF%BC%8C%E8%A7%A3%E5%86%B3%E7%BD%91%E7%BB%9C%E4%B8%8D%E5%8F%AF%E7%94%A8%E5%8F%8A1020%E7%AD%89%E9%97%AE%E9%A2%98/">【chatGPT】利用腾讯云函数免费部署国内直接使用ChatGPT代理，解决网络不可用及1020等问题</a></p><div class="content"><h1 id="chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题"><a class="markdownIt-Anchor" href="#chatgpt利用腾讯云函数免费部署国内直接使用chatgpt代理解决网络不可用及1020等问题">#</a> 【chatGPT】利用腾讯云函数免费部署国内直接使用 ChatGPT 代理，解决网络不可用及 1020 等问题</h1>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>在 Github 上发现一个项目，可以利用腾讯云提供的云函数，一分钟就能搭建好一台可以直接访问 ChatGPT 的代理，关键还是免费的。今天就来一起折腾它。</p>
<h2 id="项目"><a class="markdownIt-Anchor" href="#项目">#</a> 项目</h2>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/geekr-dev/openai-proxy">https://github.com/geekr-dev/openai-proxy</a></p>
<h2 id="教程"><a class="markdownIt-Anchor" href="#教程">#</a> 教程</h2>
<p>可以直接看官方文字教程，如果是新手，可以按我图文教程</p>
<h5 id="第一步"><a class="markdownIt-Anchor" href="#第一步">#</a> 第一步：</h5>
<p>​	登录腾讯控制台：<a target="_blank" rel="noopener" href="https://console.cloud.tencent.com/scf/list">https://console.cloud.tencent.com/scf/list</a></p>
<p>​	如果之前没使用腾讯云函数，会提示授权</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085936706.png" alt="image-20230420085936706"></p>
<h5 id="第二步前往访问管理"><a class="markdownIt-Anchor" href="#第二步前往访问管理">#</a> 第二步：前往访问管理</h5>
<p>​	<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420085957003.png" alt="image-20230420085957003"></p>
<h5 id="第三步新建函数记得选择非大陆地区哟"><a class="markdownIt-Anchor" href="#第三步新建函数记得选择非大陆地区哟">#</a> 第三步：新建函数，记得选择<strong>非大陆</strong>地区哟</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090015818.png" alt="image-20230420090015818"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090031428.png" alt="image-20230420090031428"></p>
<h5 id="上传github项目中的zip文件"><a class="markdownIt-Anchor" href="#上传github项目中的zip文件">#</a> 上传 Github 项目中的 ZIP 文件</h5>
<h5 id="第四步高级配置"><a class="markdownIt-Anchor" href="#第四步高级配置">#</a> 第四步：高级配置</h5>
<p>上传完 ZIP 文件，接着下拉，找到高级配置，点进去编辑<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090114681.png" alt="image-20230420090114681"></p>
<p>点高级配置的最右边的编辑按钮</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090132944.png" alt="image-20230420090132944"></p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090140465.png" alt="image-20230420090140465"></p>
<h5 id="第五步获取代理地址"><a class="markdownIt-Anchor" href="#第五步获取代理地址">#</a> 第五步：获取代理地址</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090255336.png" alt="image-20230420090255336"></p>
<p>不要 &quot;/release&quot; 路径，只要取子域名部分就可以了</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230420090309398.png" alt="image-20230420090309398"></p>
<p>这时候访问路径内容和 api.open.com 的结果是一至的了。</p>
<p><strong>至此：已经有了海外域名的代理地址了。</strong></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-03-04T12:23:03.000Z" title="2023/3/4 20:23:03">2023-03-04</time>发表</span><span class="level-item"><time dateTime="2023-04-26T02:22:15.829Z" title="2023/4/26 10:22:15">2023-04-26</time>更新</span><span class="level-item">9 分钟读完 (大约1359个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/03/04/%E3%80%90chatGPT%E3%80%91%E5%9F%BA%E4%BA%8EDocker%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2%E8%87%AA%E5%B7%B1%E7%9A%84ChatGPT/">【chatGPT】基于Docker如何快速部署自己的ChatGPT</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="基于docker如何快速部署自己的chatgpt"><a class="markdownIt-Anchor" href="#基于docker如何快速部署自己的chatgpt">#</a> 基于 Docker 如何快速部署自己的 ChatGPT</h1>
<h2 id="背景"><a class="markdownIt-Anchor" href="#背景">#</a> 背景</h2>
<p>随着<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=OpenAI&amp;spm=1001.2101.3001.7020"> OpenAI</a> 在 2022 年底发布的 LLM 模型 - ChatGPT 展现出的强大效果，ChatGPT 无疑成为了当下炙手可热的明星模型。</p>
<p>现有的基于<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=GPT&amp;spm=1001.2101.3001.7020"> GPT</a> 的开源项目已经非常多，本文以现有的高热度 github 开源项目<a target="_blank" rel="noopener" href="https://github.com/Chanzhaoyu/chatgpt-web"> chatgpt-web</a> 为例，教大家简单快速地搭建属于自己的 ChatGPT。</p>
<h2 id="chatgpt-web"><a class="markdownIt-Anchor" href="#chatgpt-web">#</a> ChatGPT-Web</h2>
<p>chatgpt-web 项目中的部署教程已经非常完整，本文不再过多解释。</p>
<p>仅以 Docker 部署为例</p>
<p>前置条件</p>
<ul>
<li>本地或者服务器应该具有 Docker 环境</li>
<li>具有 ChatGPT 帐号</li>
</ul>
<p>以 token 模式为例，请求 chatgpt web 版本，免费但稍微具有延迟</p>
<p><strong>Step1. 找到你帐号的 token</strong></p>
<p>点击 https://chat.openai.com/api/auth/session，获取你帐号的 token，并记录他</p>
<p><strong>Step2. 运行 docker</strong></p>
<p>按需配置访问 Web 页面的密码，Token、超时等信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p><strong>Step3. 访问 localhost:3002 查看效果</strong><br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/b6ea40d61cb741129cc1d98af9633d18.png" alt="在这里插入图片描述"><br>
在上述步骤中我们无需进行任何代理，就可以直接与 GPT 交流，使用 API 方式同理。当然了，根据项目作者的介绍，<strong>使用 API 时需要进行代理自建</strong>。</p>
<p>如果你只是在本地部署给自己使用，那么以上 3 步就满足了需求，如果想要在公网访问，或者像 App 一样访问你的 ChatGPT，那么请接着往下看。</p>
<h2 id="nginx反向代理"><a class="markdownIt-Anchor" href="#nginx反向代理">#</a> Nginx 反向代理</h2>
<p>以宝塔面板为例，我们在服务器上拉起 docker 镜像后，可以通过 <code>ip:port</code>  进行访问</p>
<p>但通常来说我们的网站带有域名，以笔者所使用的腾讯云服务器为例</p>
<p>前置条件</p>
<ul>
<li>拥有一个域名</li>
<li>拥有一台云服务器</li>
</ul>
<p><strong>Step1. SSL 证书</strong></p>
<p>首先在云产品中找到 SSL 证书，点击我的证书 - 免费证书 - 申请免费证书</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/34d88a1248ea4158ba5e2e6a07ab0a67.png" alt="在这里插入图片描述"></p>
<p>填写申请的域名，申请成功之后，点击下载，下载 nginx 格式的即可</p>
<p><strong>Step2. 配置域名 SSL</strong></p>
<p>在宝塔面板中选择 - 网站 - 添加站点</p>
<p>填写刚刚申请 SSL 证书的域名，选择纯静态，其余默认，点击确定即可</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/9ece432796a34885adc258df4bc25555.png" alt="在这里插入图片描述"></p>
<p><strong>Step3. 配置证书</strong></p>
<p>点击添加好的网站，然后点击 SSL，填入刚刚下载的文件中的 <code>key</code>  和 <code>pem</code> <br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/852f85f818444491bc4b8e04248b9a4b.png" alt="在这里插入图片描述"></p>
<p>配置完成后点击保存</p>
<p><strong>Step4. 配置 DNS 解析</strong></p>
<p>在云产品中搜索 - 云解析 - 选择 DNS 解析 DNSPod</p>
<p>点击我的域名 - 添加记录</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/383f44e9fe714847ab5c5f2079d81982.png" alt="在这里插入图片描述"></p>
<p>填入刚刚申请的域名，如果带有前缀，则第一个红框填入你的域名前缀，<a target="_blank" rel="noopener" href="http://xn--www-eo8er22f.baidu.com">比如 www.baidu.com</a>，则这里填 www</p>
<p>第二个红框填写你的服务器 ip，或者你的 CDN 域名</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/2882e7602c324fc4a9a5520262c23a0a.png" alt="在这里插入图片描述"></p>
<p><strong>Step5. 配置反向代理</strong></p>
<p>在宝塔面板中，点击刚刚添加的网站，点击反向代理，填入刚刚 docker 启动时的宿主机端口<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/abbf944aab284d368e63d28b61024d7f.png" alt="在这里插入图片描述"></p>
<p>如上文中的 3888</p>
<p>以上配置完成之后，访问 https:// 你的域名就可以了～</p>
<h2 id="pwa支持"><a class="markdownIt-Anchor" href="#pwa支持">#</a> PWA 支持</h2>
<p>PWA 技术可以让我们访问网站能够拥有访问 App 一般的体验，在 chatgpt-web 中已经内嵌，但默认是关闭的</p>
<p>我们可以通过设置启动时的参数 <code>-env VITE_GLOB_APP_PWA=true</code>  将他打开</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run --name chatgpt-web -d -p 127.0.0.1:3888:3002 --<span class="built_in">env</span> OPENAI_ACCESS_TOKEN=your_access_token --<span class="built_in">env</span> AUTH_SECRET_KEY=you_secret_key --<span class="built_in">env</span> VITE_GLOB_APP_PWA=<span class="literal">true</span> chenzhaoyu94/chatgpt-web</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>部署成功之后，我们再到手机上访问该网站时便可以保存他在桌面了。</p>
<p>默认的 PWA 图标和全局用户信息配置在项目中，即使在网页可以修改当前登陆者的用户信息，在清除 Cookie 之后便会还原，如果你想定制这两种信息，请拉下 chatgpt-web 项目进行镜像自定义</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-02-24T14:08:51.000Z" title="2023/2/24 22:08:51">2023-02-24</time>发表</span><span class="level-item"><time dateTime="2022-12-17T00:57:31.000Z" title="2022/12/17 08:57:31">2022-12-17</time>更新</span><span class="level-item">11 分钟读完 (大约1615个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/24/%E3%80%90Docker%E3%80%91Linux%E9%83%A8%E7%BD%B2Docker/">【Docker】Linux部署Docker</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="dockerlinux部署docker"><a class="markdownIt-Anchor" href="#dockerlinux部署docker">#</a> 【Docker】Linux 部署 Docker</h1>
<p>接触一段时间 docker，这个工具大大提高了开发者打包应用的效率。</p>
<p>一直都是直接把镜像扔到到 docker 里构建容器启动，并没有深入了解。</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3eca951ddd044e9d9e1e6f2fcd5c680b.png" alt="在这里插入图片描述"><br>
本文由<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808?type=blog"> alpha0808</a> 大佬指导，如果要了解 docker 的概念以及命令，请去看大佬这篇<a target="_blank" rel="noopener" href="https://blog.csdn.net/alpha0808/article/details/125699252?spm=1001.2014.3001.5502"> DOCKER 之入门篇</a></p>
<p>本篇文章集中于 linux 系统下对 docker 及相关组件的部署。</p>
<h3 id="目录"><a class="markdownIt-Anchor" href="#目录">#</a> 目录</h3>
<ul>
<li><a href="#docker_9">一、安装 docker</a></li>
<li><a href="#_47">二、镜像加速</a></li>
<li>
<ul>
<li><a href="#_50">获取阿里云镜像地址</a></li>
<li><a href="#_56">添加加速器地址</a></li>
</ul>
</li>
<li><a href="#Portainer_75">三、可视化管理工具 Portainer</a></li>
<li>
<ul>
<li><a href="#_76">简介</a></li>
<li><a href="#_79">展示</a></li>
<li><a href="#_90">安装</a></li>
<li>
<ul>
<li><a href="#_92">镜像下载</a></li>
<li><a href="#_105">容器运行</a></li>
<li><a href="#_113">创建用户</a></li>
<li><a href="#docker_116">docker 连接管理</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_134">四、补充</a></li>
<li>
<ul>
<li><a href="#docker_135">docker 开机自启</a></li>
<li><a href="#_139">容器开机自启</a></li>
</ul>
</li>
</ul>
<h1 id="一-安装docker"><a class="markdownIt-Anchor" href="#一-安装docker">#</a> 一、安装 docker</h1>
<p>按照官网 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4%E5%8D%B3%E5%8F%AF">https://docs.docker.com/engine/install/centos/ 执行命令即可</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">1.</span>yum检查更新</span><br><span class="line">sudo yum check-update</span><br><span class="line">#<span class="number">2.</span>删除旧版本</span><br><span class="line">sudo yum remove docker docker-client docker-client-latest  docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine</span><br><span class="line">#<span class="number">3.</span>安装gcc环境</span><br><span class="line">yum -y install gcc</span><br><span class="line">yum -y install gcc-c++</span><br><span class="line">#<span class="number">4.</span>安装依赖项</span><br><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">#<span class="number">5.</span>将 Docker 存储库添加到 CentOS</span><br><span class="line">sudo yum-config-manager --add-repo https:<span class="comment">//download.docker.com/linux/centos/docker-ce.repo</span></span><br><span class="line">#使用阿里服务器下载</span><br><span class="line">yum-config-manager --add-repo http:<span class="comment">//mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line">#如果没有执行命令<span class="number">1</span>更新，那么此时执行命令即可</span><br><span class="line">yum makecache fast</span><br><span class="line">#<span class="number">6.</span>下载docker</span><br><span class="line">sudo yum install -y docker #注意这样下载需要接受GPG秘钥，相当于一个数字指纹，指纹格式：<span class="number">060</span>A <span class="number">61</span>C5 <span class="number">1B</span>55 <span class="number">8</span>A7F <span class="number">742B</span> <span class="number">77</span>AA C52F EB6B <span class="number">621</span>E <span class="number">9F</span>35</span><br><span class="line">#或者社区版本</span><br><span class="line">yum -y install docker-ce</span><br><span class="line">#<span class="number">7.</span>检查版本</span><br><span class="line">docker version</span><br><span class="line">#或者</span><br><span class="line">docker -v</span><br><span class="line">#<span class="number">8.</span>查看docker进程</span><br><span class="line">docker ps</span><br></pre></td></tr></table></figure>
<p>执行第 8 步，如果报错<br>
 “<strong>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemo</strong>”<br>
 是因为 docker 还没启动</p>
<p>解决方案：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker.service</span><br></pre></td></tr></table></figure>
<h1 id="二-镜像加速"><a class="markdownIt-Anchor" href="#二-镜像加速">#</a> 二、镜像加速</h1>
<p>使用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F&amp;spm=1001.2101.3001.7020">阿里云镜像</a>地址来加速镜像下载的速度</p>
<h2 id="获取阿里云镜像地址"><a class="markdownIt-Anchor" href="#获取阿里云镜像地址">#</a> 获取阿里云镜像地址</h2>
<p>点击<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/cn-hangzhou/instances">容器镜像服务</a><br>
<strong>镜像工具</strong>→<strong>镜像加速器</strong>，生成<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%8A%A0%E9%80%9F%E5%99%A8&amp;spm=1001.2101.3001.7020">加速器</a>地址</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/644a2eab2b884c86874988c992891308.png" alt="在这里插入图片描述"></p>
<h2 id="添加加速器地址"><a class="markdownIt-Anchor" href="#添加加速器地址">#</a> 添加加速器地址</h2>
<p>切换目录至 /etc/docker</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/docker</span><br></pre></td></tr></table></figure>
<p>编辑 daemon.js 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;加速器地址&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E9%87%8D%E5%90%AFdocker&amp;spm=1001.2101.3001.7020">重启 docker</a> 的伴随线程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure>
<p>重启 docker 服务</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>
<h1 id="三-可视化管理工具portainer"><a class="markdownIt-Anchor" href="#三-可视化管理工具portainer">#</a> 三、可视化管理工具 Portainer</h1>
<h2 id="简介"><a class="markdownIt-Anchor" href="#简介">#</a> 简介</h2>
<p>Portainer 是 Docker 的<strong>图形化</strong>管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm 集群和服务等集中管理和操作、登录用户管理和控制等功能</p>
<h2 id="展示"><a class="markdownIt-Anchor" href="#展示">#</a> 展示</h2>
<ul>
<li>首页<br>
包含 docker-compose、容器、镜像、卷、网络总体概况<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/a02aadfe750448a2b68d3af149c24a3a.png" alt="在这里插入图片描述"></li>
<li>容器<br>
包含容器的启动、暂停、杀死进程、重启、新增，监控，日志查看，容器控制台等功能。<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/906ebda299ae49dab32718dbd0519d2f.png" alt="在这里插入图片描述"></li>
<li>镜像<br>
包含镜像详细查看、删除、导入、导出等功能<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/14cc4c0cbaea403f895b07bbc006474a.png" alt="在这里插入图片描述"></li>
</ul>
<h2 id="安装"><a class="markdownIt-Anchor" href="#安装">#</a> 安装</h2>
<p>采用 docker 安装</p>
<h3 id="镜像下载"><a class="markdownIt-Anchor" href="#镜像下载">#</a> 镜像下载</h3>
<p>查询 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/52a91f8890aa4618999620689636e6ce.png" alt="在这里插入图片描述"></p>
<p>下载 portainer 镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull portainer/portainer</span><br></pre></td></tr></table></figure>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/15a7b2b883bd41c78d66d8f391e791eb.png" alt="在这里插入图片描述"></p>
<h3 id="容器运行"><a class="markdownIt-Anchor" href="#容器运行">#</a> 容器运行</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>开放 9000 端口</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=9000/tcp --permanent &amp;&amp; firewall-cmd --reload</span><br></pre></td></tr></table></figure>
<h3 id="创建用户"><a class="markdownIt-Anchor" href="#创建用户">#</a> 创建用户</h3>
<p>访问 9000 端口，第一次登录设置管理员账号和密码<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/90ff15efcc5e44f38105bf45c4a10faa.png" alt="在这里插入图片描述"></p>
<h3 id="docker连接管理"><a class="markdownIt-Anchor" href="#docker连接管理">#</a> docker 连接管理</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e0730e684e3c407fba300d41ad5dff7e.png" alt="在这里插入图片描述"><br>
可以选择管理本地 Local 和远程 Remote 的 Docker 两个选项，我们安装在本机，直接选择 Local，然后 Connect 进入管理界面<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/50e22542b48144a7bebcc9c2cc194dfc.png" alt="在这里插入图片描述"><br>
点击 connect，报错</p>
<blockquote>
<p>Failure dial unix /var/run/docker.sock: connect: permission denied</p>
</blockquote>
<p>可以猜测是 SElinux 的问题，看 SELinux 状态：sestatus 命令进行查看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/sestatus -v      ##如果SELinux status参数为enabled即为开启状态</span><br><span class="line">SELinux status:                 enabled</span><br></pre></td></tr></table></figure>
<p>修改 /etc/selinux/config 文件，保存后重启机器</p>
<blockquote>
<p>将<strong> SELINUX=enforcing</strong> 改为<strong> SELINUX=disabled</strong></p>
</blockquote>
<p>再次访问 9000，连接 local，成功<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/e2756cc7d9154993992f2c3a00d5ca58.png" alt="在这里插入图片描述"></p>
<h1 id="四-补充"><a class="markdownIt-Anchor" href="#四-补充">#</a> 四、补充</h1>
<h2 id="docker开机自启"><a class="markdownIt-Anchor" href="#docker开机自启">#</a> docker 开机自启</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable docker</span><br></pre></td></tr></table></figure>
<h2 id="容器开机自启"><a class="markdownIt-Anchor" href="#容器开机自启">#</a> 容器开机自启</h2>
<p>以上面的 docker 可视化管理工具 portainer 为例，希望开机的时候，自动启动镜像</p>
<p>启动命令加–restart=always</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9000</span>:<span class="number">9000</span> --name portainer --restart=always  -v /var/run/docker.sock:/var/run/docker.sock -d portainer/portainer</span><br></pre></td></tr></table></figure>
<p>如果已经在运行的镜像</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker update --restart=always portainer</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-02-24T03:58:39.000Z" title="2023/2/24 11:58:39">2023-02-24</time>发表</span><span class="level-item"><time dateTime="2020-01-04T09:13:01.000Z" title="2020/1/4 17:13:01">2020-01-04</time>更新</span><span class="level-item">22 分钟读完 (大约3342个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/24/%E3%80%90Java%E3%80%91CAS%E6%9C%BA%E5%88%B6/">CAS机制</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="cas机制"><a class="markdownIt-Anchor" href="#cas机制">#</a> CAS 机制</h1>
<h3 id="我们先看一段代码"><a class="markdownIt-Anchor" href="#我们先看一段代码">#</a> 我们先看一段代码：</h3>
<p>启动两个线程，每个线程中让静态变量 count 循环累加 100 次。</p>
<p><img src="https://img-blog.csdn.net/20180312170840546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>最终输出的 count 结果一定是 200 吗？因为这段代码是非<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8&amp;spm=1001.2101.3001.7020">线程安全</a>的，所以最终的自增结果很可能会小于 200。我们再加上 synchronized 同步锁，再来看一下。</p>
<p><img src="https://img-blog.csdn.net/20180312170827236?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>加了同步锁之后，count 自增的操作变成了原子性操作，所以最终输出一定是 count=200，代码实现了线程安全。虽然 synchronized 确保了线程安全，但是在某些情况下，这并不是一个最有的选择。</p>
<p>关键在于性能问题。</p>
<p>synchronized 关键字会让没有得到锁资源的线程进入 BLOCKED 状态，而后在争夺到锁资源后恢复为 RUNNABLE 状态，这个过程中涉及到操作系统用户模式和内核模式的转换，代价比较高。</p>
<p>尽管 JAVA 1.6 为 synchronized 做了优化，增加了从偏向锁到轻量级锁再到重量级锁的过过度，但是在最终转变为重量级锁之后，性能仍然比较低。所以面对这种情况，我们就可以使用 java 中的 “原子操作类”。</p>
<p>所谓原子操作类，指的是 java.util.concurrent.atomic 包下，一系列以 Atomic 开头的包装类。如 AtomicBoolean，AtomicUInteger，AtomicLong。它们分别用于 Boolean，Integer，Long 类型的原子性操作。</p>
<p>现在我们尝试使用 AtomicInteger 类：</p>
<p><img src="https://img-blog.csdn.net/20180312172106130?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>使用 AtomicInteger 之后，最终的输出结果同样可以保证是 200。并且在某些情况下，代码的性能会比 synchronized 更好。</p>
<p>而 Atomic 操作类的底层正是用到了 “CAS 机制”。</p>
<p>CAS 是英文单词 Compare and Swap 的缩写，翻译过来就是比较并替换。</p>
<p>CAS 机制中使用了 3 个基本操作数：内存地址 V，旧的预期值 A，要修改的新值 B。</p>
<p>更新一个变量的时候，只有当变量的预期值 A 和内存地址 V 当中的实际值相同时，才会将内存地址 V 对应的值修改为 B。</p>
<p>我们看一个例子：</p>
<p>\1. 在内存地址 V 当中，存储着值为 10 的变量。</p>
<p><img src="https://img-blog.csdn.net/20180312172707148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\2. 此时线程 1 想把变量的值增加 1. 对线程 1 来说，旧的预期值 A=10，要修改的新值 B=11.</p>
<p><img src="https://img-blog.csdn.net/20180312172814864?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\3. 在线程 1 要提交更新之前，另一个线程 2 抢先一步，把内存地址 V 中的变量值率先更新成了 11。</p>
<p><img src="https://img-blog.csdn.net/20180312172943800?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\4. 线程 1 开始提交更新，首先进行 A 和地址 V 的实际值比较，发现 A 不等于 V 的实际值，提交失败。</p>
<p><img src="https://img-blog.csdn.net/20180312173045349?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\5. 线程 1 重新获取内存地址 V 的当前值，并重新计算想要修改的值。此时对线程 1 来说，A=11，B=12。这个重新尝试的过程被称为自旋。</p>
<p><img src="https://img-blog.csdn.net/20180312173220371?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\6. 这一次比较幸运，没有其他线程改变地址 V 的值。线程 1 进行比较，发现 A 和地址 V 的实际值是相等的。</p>
<p><img src="https://img-blog.csdn.net/20180312173331761?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>\7. 线程 1 进行交换，把地址 V 的值替换为 B，也就是 12.</p>
<p><img src="https://img-blog.csdn.net/20180312173421205?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>从思想上来说，synchronized 属于悲观锁，悲观的认为程序中的并发情况严重，所以严防死守，CAS 属于乐观锁，乐观地认为程序中的并发情况不那么严重，所以让线程不断去重试更新。</p>
<p>在 java 中除了上面提到的 Atomic 系列类，以及 Lock 系列类夺得底层实现，甚至在 JAVA1.6 以上版本，synchronized 转变为重量级锁之前，也会采用 CAS 机制。</p>
<p><strong>CAS 的缺点：</strong></p>
<p>1） CPU 开销过大</p>
<p>在并发量比较高的情况下，如果许多线程反复尝试更新某一个变量，却又一直更新不成功，循环往复，会给 CPU 带来很到的压力。</p>
<p>2） 不能保证代码块的原子性</p>
<p>CAS 机制所保证的知识一个变量的原子性操作，而不能保证整个代码块的原子性。比如需要保证 3 个变量共同进行原子性的更新，就不得不使用 synchronized 了。</p>
<p>3） ABA 问题</p>
<p>这是 CAS 机制最大的问题所在。（后面有介绍）</p>
<p>我们下面来介绍一下两个问题：</p>
<p><em><strong>*1. JAVA 中 CAS 的底层实现 *</strong></em></p>
<p><em><strong>*2. CAS 的 ABA 问题和解决办法。*</strong></em></p>
<p>我们看一下 AtomicInteger 当中常用的自增方法 incrementAndGet：</p>
<p>public final int incrementAndGet() {</p>
<p>for (;😉 {</p>
<p>​    int current = get();</p>
<p>​    int next = current + 1;</p>
<p>​    if (compareAndSet(current, next))</p>
<p>​      return next;</p>
<p>}</p>
<p>}</p>
<p>private volatile int value;</p>
<p>public final int get() {</p>
<p>return value;</p>
<p>}</p>
<p>这段代码是一个无限循环，也就是 CAS 的自旋，循环体中做了三件事：</p>
<p>\1. 获取当前值</p>
<p>\2. 当前值 + 1，计算出目标值</p>
<p>\3. 进行 CAS 操作，如果成功则跳出循环，如果失败则重复上述步骤</p>
<p>这里需要注意的重点是 get 方法，这个方法的作用是获取变量的当前值。</p>
<p>如何保证获取的当前值是内存中的最新值？很简单，用 volatile 关键字来保证（保证线程间的可见性）。我们接下来看一下 compareAndSet 方法的实现：</p>
<p><img src="https://img-blog.csdn.net/2018031217514825?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>compareAndSet 方法的实现很简单，只有一行代码。这里涉及到两个重要的对象，一个是 unsafe，一个是 valueOffset。</p>
<p>什么是 unsafe 呢？Java 语言不像 C，C++ 那样可以直接访问底层操作系统，但是 JVM 为我们提供了一个后门，这个后门就是 unsafe。unsafe 为我们提供了硬件级别的原子操作。</p>
<p>至于 valueOffset 对象，是通过 unsafe.objectFiledOffset 方法得到，所代表的是 AtomicInteger 对象 value 成员变量在内存中的偏移量。我们可以简单的把 valueOffset 理解为 value 变量的内存地址。</p>
<p>我们上面说过，CAS 机制中使用了 3 个基本操作数：内存地址 V，旧的预期值 A，要修改的新值 B。</p>
<p>而 unsafe 的 compareAndSwapInt 方法的参数包括了这三个基本元素：valueOffset 参数代表了 V，expect 参数代表了 A，update 参数代表了 B。</p>
<p>正是 unsafe 的 compareAndSwapInt 方法保证了 Compare 和 Swap 操作之间的原子性操作。</p>
<p>我们现在来说什么是 ABA 问题。假设内存中有一个值为 A 的变量，存储在地址 V 中。</p>
<p><img src="https://img-blog.csdn.net/2018031218013467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>此时有三个线程想使用 CAS 的方式更新这个变量的值，每个线程的执行时间有略微偏差。线程 1 和线程 2 已经获取当前值，线程 3 还未获取当前值。</p>
<p><img src="https://img-blog.csdn.net/20180312180247202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>接下来，线程 1 先一步执行成功，把当前值成功从 A 更新为 B；同时线程 2 因为某种原因被阻塞住，没有做更新操作；线程 3 在线程 1 更新之后，获取了当前值 B。</p>
<p><img src="https://img-blog.csdn.net/20180312180432152?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>在之后，线程 2 仍然处于阻塞状态，线程 3 继续执行，成功把当前值从 B 更新成了 A。</p>
<p><img src="https://img-blog.csdn.net/20180312180546889?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>最后，线程 2 终于恢复了运行状态，由于阻塞之前已经获得了 “当前值 A”，并且经过 compare 检测，内存地址 V 中的实际值也是 A，所以成功把变量值 A 更新成了 B。</p>
<p><img src="https://img-blog.csdn.net/20180312180729792?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>看起来这个例子没啥问题，但如果结合实际，就可以发现它的问题所在。</p>
<p>我们假设一个提款机的例子。假设有一个遵循 CAS 原理的提款机，小灰有 100 元存款，要用这个提款机来提款 50 元。</p>
<p><img src="https://img-blog.csdn.net/20180312181342879?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>由于提款机硬件出了点问题，小灰的提款操作被同时提交了两次，开启了两个线程，两个线程都是获取当前值 100 元，要更新成 50 元。</p>
<p>理想情况下，应该一个线程更新成功，一个线程更新失败，小灰的存款值被扣一次。</p>
<p><img src="https://img-blog.csdn.net/20180312181404403?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>线程 1 首先执行成功，把余额从 100 改成 50. 线程 2 因为某种原因阻塞。这时，小灰的妈妈刚好给小灰汇款 50 元。</p>
<p><img src="https://img-blog.csdn.net/20180312181531202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>线程 2 仍然是阻塞状态，线程 3 执行成功，把余额从 50 改成了 100。</p>
<p><img src="https://img-blog.csdn.net/20180312181635868?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>线程 2 恢复运行，由于阻塞之前获得了 “当前值” 100，并且经过 compare 检测，此时存款实际值也是 100，所以会成功把变量值 100 更新成 50。</p>
<p><img src="https://img-blog.csdn.net/20180312181813320?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>原本线程 2 应当提交失败，小灰的正确余额应该保持 100 元，结果由于 ABA 问题提交成功了。</p>
<p>怎么解决呢？加个版本号就可以了。</p>
<p>真正要做到严谨的 CAS 机制，我们在 compare 阶段不仅要比较期望值 A 和地址 V 中的实际值，还要比较变量的版本号是否一致。</p>
<p>我们仍然以刚才的例子来说明，假设地址 V 中存储着变量值 A，当前版本号是 01。线程 1 获取了当前值 A 和版本号 01，想要更新为 B，但是被阻塞了。</p>
<p><img src="https://img-blog.csdn.net/20180312182255181?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>这时候，内存地址 V 中变量发生了多次改变，版本号提升为 03，但是变量值仍然是 A。</p>
<p><img src="https://img-blog.csdn.net/20180312182346458?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>随后线程 1 恢复运行，进行 compare 操作。经过比较，线程 1 所获得的值和地址的实际值都是 A，但是版本号不相等，所以这一次更新失败。</p>
<p><img src="https://img-blog.csdn.net/20180312182506360?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p>在 Java 中，AtomicStampedReference 类就实现了用版本号作比较额 CAS 机制。</p>
<p><em><strong>*1. java 语言 CAS 底层如何实现？*</strong></em></p>
<p><em><strong>* 利用 unsafe 提供的原子性操作方法。*</strong></em></p>
<p><em><strong>*2. 什么事 ABA 问题？怎么解决？*</strong></em></p>
<p><em><strong>* 当一个值从 A 变成 B，又更新回 A，普通 CAS 机制会误判通过检测。*</strong></em></p>
<p><em><strong>* 利用版本号比较可以有效解决 ABA 问题。*</strong></em></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-02-23T15:57:03.000Z" title="2023/2/23 23:57:03">2023-02-23</time>发表</span><span class="level-item"><time dateTime="2022-01-16T11:58:13.000Z" title="2022/1/16 19:58:13">2022-01-16</time>更新</span><span class="level-item">4 分钟读完 (大约646个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/23/%E3%80%90Java%E3%80%91Java%E5%AD%97%E7%AC%A6%E4%B8%8EASCII%E7%A0%81%E4%BA%92%E8%BD%AC/">【Java】Java字符与ASCII码互转</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="javajava字符与ascii码互转"><a class="markdownIt-Anchor" href="#javajava字符与ascii码互转">#</a> 【Java】Java 字符与 ASCII 码互转</h1>
<p>字符转对应<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=ASCII%E7%A0%81&amp;spm=1001.2101.3001.7020"> ASCII 码</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法一：将char强制转换为byte</span></span><br><span class="line"><span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="type">byte</span> <span class="variable">byteAscii</span> <span class="operator">=</span> (<span class="type">byte</span>) ch;</span><br><span class="line">System.out.println(byteAscii);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：将char直接转化为int，其值就是字符的ascii</span></span><br><span class="line"><span class="type">int</span> <span class="variable">byteAscii1</span> <span class="operator">=</span> (<span class="type">int</span>) ch;</span><br><span class="line">System.out.println(byteAscii1);</span><br></pre></td></tr></table></figure>
<p>ASCII 码转字符</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 直接int强制转换为char</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ascii</span> <span class="operator">=</span> <span class="number">65</span>;</span><br><span class="line"><span class="type">char</span> <span class="variable">ch1</span> <span class="operator">=</span> (<span class="type">char</span>)ascii;</span><br><span class="line">System.out.println(ch1);</span><br></pre></td></tr></table></figure>
<p>应用实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HJ21 简单密码</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 描述</span></span><br><span class="line"><span class="comment"> * 现在有一种密码变换算法。</span></span><br><span class="line"><span class="comment"> * 九键手机键盘上的数字与字母的对应： 1--1， abc--2, def--3, ghi--4, jkl--5, mno--6, pqrs--7, tuv--8 wxyz--9, 0--0，把密码中出现的小写字母都变成九键键盘对应的数字，如：a 变成 2，x 变成 9.</span></span><br><span class="line"><span class="comment"> * 而密码中出现的大写字母则变成小写之后往后移一位，如：X ，先变成小写，再往后移一位，变成了 y ，例外：Z 往后移是 a 。</span></span><br><span class="line"><span class="comment"> * 数字和其它的符号都不做变换。</span></span><br><span class="line"><span class="comment"> * 数据范围： 输入的字符串长度满足 1≤n≤100</span></span><br><span class="line"><span class="comment"> * 输入描述：</span></span><br><span class="line"><span class="comment"> * 输入一组密码，长度不超过100个字符。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 输出描述：</span></span><br><span class="line"><span class="comment"> * 输出密码变换后的字符串</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 示例1</span></span><br><span class="line"><span class="comment"> * 输入：</span></span><br><span class="line"><span class="comment"> * YUANzhi1987</span></span><br><span class="line"><span class="comment"> * 输出：</span></span><br><span class="line"><span class="comment"> * zvbo9441987</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HJ21Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> scanner.next();</span><br><span class="line"></span><br><span class="line">        Map&lt;Integer, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="number">1</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        map.put(<span class="number">3</span>, <span class="string">&quot;def&quot;</span>);</span><br><span class="line">        map.put(<span class="number">4</span>, <span class="string">&quot;ghi&quot;</span>);</span><br><span class="line">        map.put(<span class="number">5</span>, <span class="string">&quot;jkl&quot;</span>);</span><br><span class="line">        map.put(<span class="number">6</span>, <span class="string">&quot;mno&quot;</span>);</span><br><span class="line">        map.put(<span class="number">7</span>, <span class="string">&quot;pqrs&quot;</span>);</span><br><span class="line">        map.put(<span class="number">8</span>, <span class="string">&quot;tuv&quot;</span>);</span><br><span class="line">        map.put(<span class="number">9</span>, <span class="string">&quot;wxyz&quot;</span>);</span><br><span class="line">        map.put(<span class="number">0</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] chars = input.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> chars.length;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">finalI</span> <span class="operator">=</span> i;</span><br><span class="line">            map.forEach((k, v) -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (v.contains(String.valueOf(chars[finalI]))) &#123;</span><br><span class="line">                    builder.append(k);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> chars[finalI];</span><br><span class="line">            <span class="keyword">if</span> (u &gt;= <span class="number">65</span> &amp;&amp; u &lt;= <span class="number">90</span>) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> u + <span class="number">33</span>;</span><br><span class="line">                <span class="keyword">if</span> (i1 == <span class="number">123</span> ) &#123;</span><br><span class="line">                    builder.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="type">char</span> <span class="variable">ch</span> <span class="operator">=</span> (<span class="type">char</span>) (u + <span class="number">33</span>);</span><br><span class="line">                    builder.append(ch);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;[2-9]&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (pattern.matcher(String.valueOf(chars[finalI])).matches()) &#123;</span><br><span class="line">                builder.append(chars[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(builder);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果<br>
<img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/7919845b2d094760963faf40cd23cbde.png" alt="在这里插入图片描述"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-01-31T22:25:21.000Z" title="2023/2/1 06:25:21">2023-02-01</time>发表</span><span class="level-item"><time dateTime="2020-02-12T17:46:41.000Z" title="2020/2/13 01:46:41">2020-02-13</time>更新</span><span class="level-item">28 分钟读完 (大约4168个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/02/01/%E3%80%90Git%E3%80%91SVN&amp;Git%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/">SVN&amp;Git使用手册</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<p>切记 代码是先更新再提交.<br>
（一）SVN 和 GIt 区别<br>
 1．基本<br>
 SVN 是集中式版本控制工具<br>
 git 是分布式版本控制工具</p>
<p>2．SVN 和 Git 优缺点<br>
 svn 优点:<br>
1. 方便管理者查看每个开发者开发进度<br>
 2. 方便对开发者进行权限控制<br>
 svn 缺点:<br>
1. 严重依赖网络环境进行版本控制<br>
 2. 中央服务器宕机，无法进行版本控制<br>
 3. 中央服务器磁盘损坏，丢失历史版本内容<br>
 Git 优点:<br>
1. 很完美的解决了 SVN 存在的缺点</p>
<p>TortoiseGit 小乌龟<br>
给当前项目提交到码云上<br>
 1. 用浏览器登录码云，在码云上创建一个仓库<br>
 2. 打开 TortoiseGit 软件<br>
 3. 新建一个文件夹改好名字 (注意是空文件夹)<br>
 4. 右键文件夹–&gt;Git 克隆…–&gt; 弹出如下图–&gt; 粘贴好 url<br>
5. 点击确定就可以了</p>
<p>6. 然后就给你自己的代码放入刚才的文件夹下，然后就点击推送等等.<br>
2．设置用户名和邮箱</p>
<p>直接设置即可。签名密钥不需要管</p>
<p>Git 使用笔记<br>
（一）概念<br>
 1．什么是版本控制</p>
<p>版本控制是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。 除了项目源代码，你可以对任何类型的文件进行版本控制。</p>
<p>2．为什么要版本控制<br>
有了它你就可以将某个文件回溯到之前的状态，甚至将整个项目都回退到过去某个时间点的状态，你可以比较文件的变化细节，查出最后是谁修改了哪个地方，从而找出导致怪异问题出现的原因，又是谁在何时报告了某个功能缺陷等等。<br>
许多人习惯用复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别。 这么做唯一的好处就是简单，但是特别容易犯错。 有时候会混淆所在的工作目录，一不小心会写错文件或者覆盖意想外的文件。<br>
为了解决这个问题，人们很久以前就开发了许多种本地版本控制系统，大多都是采用某种简单的数据库来记录文件的历次更新差异。<br>
3．集中化的版本控制系统<br>
接下来人们又遇到一个问题，如何让在不同系统上的开发者协同工作？ 于是，集中化的版本控制系统（Centralized Version Control Systems，简称 CVCS）应运而生。<br>
集中化的版本控制系统都有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。<br>
这么做虽然解决了本地版本控制系统无法让在不同系统上的开发者协同工作的诟病，但也还是存在下面的问题：</p>
<p>单点故障： 中央服务器宕机，则其他人无法使用；如果中心数据库磁盘损坏有没有进行备份，你将丢失所有数据。本地版本控制系统也存在类似问题，只要整个项目的历史记录被保存在单一位置，就有丢失所有历史更新记录的风险。</p>
<p>必须联网才能工作： 受网络状况、带宽影响。</p>
<p>4．分布式版本控制系统<br>
于是分布式版本控制系统（Distributed Version Control System，简称 DVCS）面世了。 Git 就是一个典型的分布式版本控制系统。<br>
这类系统，客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来。 这么一来，任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复。 因为每一次的克隆操作，实际上都是一次对代码仓库的完整备份。<br>
分布式版本控制系统可以不用联网就可以工作，因为每个人的电脑上都是完整的版本库，当你修改了某个文件后，你只需要将自己的修改推送给别人就可以了。但是，在实际使用分布式版本控制系统的时候，很少会直接进行推送修改，而是使用一台充当 “中央服务器” 的东西。这个服务器的作用仅仅是用来方便 “交换” 大家的修改，没有它大家也一样干活，只是交换修改不方便而已。<br>
分布式版本控制系统的优势不单是不必联网这么简单，后面我们还会看到 Git 极其强大的分支管理等功能。<br>
5．Git 与其他版本管理系统的主要区别<br>
 Git 在保存和对待各种信息的时候与其它版本控制系统有很大差异，尽管操作起来的命令形式非常相近，理解这些差异将有助于防止你使用中的困惑。<br>
下面我们主要说一个关于 Git 其他版本管理系统的主要差别：对待数据的方式。<br>
Git 采用的是直接记录快照的方式，而非差异比较。我后面会详细介绍这两种方式的差别。<br>
大部分版本控制系统（CVS、Subversion、Perforce、Bazaar 等等）都是以文件变更列表的方式存储信息，这类系统将它们保存的信息看作是一组基本文件和每个文件随时间逐步累积的差异。<br>
具体原理如下图所示，理解起来其实很简单，每个我们对提交更新一个文件之后，系统记录都会记录这个文件做了哪些更新，以增量符号 Δ(Delta) 表示。</p>
<p>我们怎样才能得到一个文件的最终版本呢？<br>
很简单，高中数学的基本知识，我们只需要将这些原文件和这些增加进行相加就行了。<br>
这种方式有什么问题呢？<br>
比如我们的增量特别特别多的话，如果我们要得到最终的文件是不是会耗费时间和性能。<br>
Git 不按照以上方式对待或保存数据。 反之，Git 更像是把数据看作是对小型文件系统的一组快照。 每次你提交更新，或在 Git 中保存项目状态时，它主要对当时的全部文件制作一个快照并保存这个快照的索引。 为了高效，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git 对待数据更像是一个 快照流。</p>
<p>6．使用 git 原因<br>
分布式版本控制工具<br>
为什么使用 git 呢？<br>
互联网项目，业务越来越复杂，项目越来越大，使用 SVN 版本控制不太好使了。<br>
从 git 目标，看 git 的优势 速度快、分布式、有能力管理大型项目</p>
<p>7．工作流程以及流程图</p>
<p>在工作目录中修改文件。<br>
暂存文件，将文件的快照放入暂存区域。<br>
提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录。<br>
8．程序员工作流程<br>
项目经理：1 创建项目 2 项目添加本地暂存态 3 项目提交到本地 4 建立远程连接 5 推送代码到远程服务器<br>
程序员 A：1 克隆代码到本地 2 编写代码，将代码添加本地暂存态 3 代码提交本地 4 推送代码到服务器<br>
程序员 B：1 克隆代码到本地 2 编写代码，将代码添加本地暂存态 3 代码提交本地 4 推送代码到服务器 5 更新其他程序员提交的代码<br>
 9．git 三种状态</p>
<p>已提交（committed）：数据已经安全的保存在本地数据库中。</p>
<p>已修改（modified）：已修改表示修改了文件，但还没保存到数据库中。</p>
<p>已暂存（staged）：表示对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中。</p>
<p>由此引入 Git 项目的三个工作区域的概念：Git 仓库 (.git directoty) 、工作目录 (Working Directory) 以及 暂存区域 (Staging Area) 。</p>
<p>（二）Git 分支<br>
 1．分支概念</p>
<p>几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来，然后在不影响主线的同时继续工作。在很多版本控制系统中，这是个昂贵的过程，常常需要创建一个源代码目录的完整副本，对大型项目来说会花费很长时间。</p>
<p>有人把 Git 的分支模型称为 “必杀技特性”，而正是因为它，将 Git 从版本控制系统家族里区分出来。Git 有何特别之处呢？Git 的分支可谓是难以置信的轻量级，它的新建操作几乎可以在瞬间完成，并且在不同分支间切换起来也差不多一样快。和许多其他版本控制系统不同，Git 鼓励在工作流程中频繁使用分支与合并，哪怕一天之内进行许多次都没有关系。理解分支的概念并熟练运用后，你才会意识到为什么 Git 是一个如此强大而独特的工具，并从此真正改变你的开发方式。<br>
2．分支需求<br>
现在让我们来看一个简单的分支与合并的例子，实际工作中大体也会用到这样的工作流<br>
程：</p>
<p>开发某个网站。<br>
为实现某个新的需求，创建一个分支。<br>
在这个分支上开展工作。<br>
假设此时，你突然接到一个电话说有个很严重的问题需要紧急修补，那么可以按照下面的方<br>
式处理：<br>
返回到原先已经发布到生产服务器上的分支。<br>
为这次紧急修补建立一个新分支。<br>
测试通过后，将此修补分支合并，再推送到生产服务器上。<br>
切换到之前实现新需求的分支，继续工作。<br>
（三）git 指令<br>
 1．创建 git 目录<br>
 git init</p>
<p>创建 git 目录:<br>
 该命令将创建一个名为 .git 的子目录，这个子目录含有你初始化的 Git 仓库中所有的必须文件，这些文件是 Git 仓库的骨干。但是，在这个时候，我们仅仅是做了一个初始化的操作，你的项目里的文件还没有被跟踪。(参见 Git 内部原理 来了解更多关于到底 .git 文件夹中包含了哪些文件的信息。)<br>
 2．克隆仓库<br>
 git clone [url]<br>
 克隆仓库的命令格式是 git clone [url] 。比如，要克隆 Git 的可链接库 libgit2，可以用下面的命令<br>
 $ git clone <a target="_blank" rel="noopener" href="https://github.com/libgit2/libgit2">https://github.com/libgit2/libgit2</a></p>
<p>这会在当前目录下创建一个名为 “libgit2” 的目录，并在这个目录下初始化一个 .git 文件夹，从远程仓库拉取下所有数据放入 .git 文件夹，然后从中读取最新版本的文件的拷贝。如果你进入到这个新建的 libgit2 文件夹，你会发现所有的项目文件已经在里面了，准备就绪等待后续的开发和使用。如果你想在克隆远程仓库的时<br>
候，自定义本地仓库的名字，你可以使用如下命令<br>
 $ git clone <a target="_blank" rel="noopener" href="https://github.com/libgit2/libgit2">https://github.com/libgit2/libgit2</a> mylibgit<br>
 这将执行与上一个命令相同的操作，不过在本地创建的仓库名字变为 mylibgit<br>
3．查看文件状态<br>
 git status<br>
 要查看哪些文件处于什么状态，可以用 git status 命令。如果在克隆仓库后立即使用此命令，会看到类似这<br>
样的输出.</p>
<p>跟踪新文件</p>
<p>（四）使用<br>
 1．安装 git</p>
<p><a target="_blank" rel="noopener" href="http://note.youdao.com/noteshare?id=448878ab8bdba693717f8967e6aa6a4f">http://note.youdao.com/noteshare?id=448878ab8bdba693717f8967e6aa6a4f</a></p>
<p>2．将项目上传到码云上</p>
<p>如果账户已经配置好，git 客户端也安装好，在将要上传的文件中，右键打开 Git Bash Here, 按如下步骤即可：<br>
1.git init<br>
2.git remote add origin “你的码云项目地址（ssh 或 https）”<br>
 开始提交项目<br>
 3.git pull origin master 如果密码报错看下面<br>
 4.git touch init .txt  // 如果已经存在更改的文件，则操作这一步，否则跳过即可<br>
 5.git add .<br>
6.git commit -m “第一次提交（提交信息）”<br>
7.git push origin master<br>
 如出现错误 hint: Updates were rejected because the tip of your current branch is behind<br>
hint: its remote counterpart. Integrate the remote changes (e.g.<br>
hint: ‘git pull …’) before pushing again.<br>
hint: See the ‘Note about fast-forwards’ in ‘git push --help’ for details.<br>
 可执行此操作继续，git push -u origin master -f  强制命令会覆盖别人分支，慎用</p>
<p>密码报错在这里进行修改</p>
<p>3．用 git 从 github 上下载代码</p>
<p>新建一个文件夹，放你需要下载的东西。右键点击 “Git Bash Here”</p>
<p>此时会弹出 git 的命令窗口</p>
<p>3、输入  git clone + 下载地址，回车即可。如   git clone <a target="_blank" rel="noopener" href="https://github.comxxx.git">https://github.comxxx.git</a><br>
 等待下载</p>
<p>下载好之后，文件夹里就会出现相应的项目啦～</p>
<p>（五）GitGUI 操作<br>
 1．使用 gui 上传代码到码云上<br>
<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33867131/article/details/80831491"> https://blog.csdn.net/qq_33867131/article/details/80831491</a></p>
<p>SVN 的基本使用<br>
（一）基本简介<br>
开源的版本控制系统，可以用来保存代码，同步代码，也可以保存图片文档电影什么的.<br>
 主要作用就是可以随时进行代码同步。但是会存在一些问题，会有一些解决方案<br>
（二）服务端创建仓库<br>
 1．搭建仓库，添加用户</p>
<p><a target="_blank" rel="noopener" href="http://note.youdao.com/noteshare?id=549663e56580a3643bbcc9104c357226">http://note.youdao.com/noteshare?id=549663e56580a3643bbcc9104c357226</a></p>
<p>2．分配权限</p>
<p>创建好用户后，用户还是不能访问我们的仓库，接下来我们要给用户分个组（如果想让用户不进组也能访问仓库，可以直接给单个用户权限</p>
<p>3．给代码放到 svn 上面</p>
<p>然后复制仓库地址</p>
<p>在你要上传的项目右键</p>
<p>然后点击确定</p>
<p>（三）错误解决<br>
 1．代码错乱问题<br>
去查看日志，下载正确的时间段的代码，然后再创建新的仓库，放那个代码，原来的仓库就删除掉就可以了.</p>
<p>2．No appropriate protocol<br>
 公司的 SVN 协议从 svn 协议变更到 https 协议，结果 IDEA 的 SVN 报 No appropriate protocol，查询资料，最终解决方案是：<br>
Go to Preferences &gt; Version Control &gt; SubVersion &gt; Enable Interactive Mode<br>
3．versionControl 里面找不到 subversion 选项<br>
去安装 svnToolBox 插件 即可解决</p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-01-28T05:53:40.000Z" title="2023/1/28 13:53:40">2023-01-28</time>发表</span><span class="level-item"><time dateTime="2023-11-11T14:03:11.000Z" title="2023/11/11 22:03:11">2023-11-11</time>更新</span><span class="level-item">8 分钟读完 (大约1167个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/28/%E3%80%90Java%E3%80%91%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E5%B0%86%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2%E4%B8%BAList%E9%9B%86%E5%90%88/">【Java】如何优雅的将数组转换为List集合</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="java如何优雅的将数组转换为list集合"><a class="markdownIt-Anchor" href="#java如何优雅的将数组转换为list集合">#</a> 【Java】如何优雅的将数组转换为 List 集合</h1>
<h2 id="第一种方式未必最佳使用arraylistasliststrarray"><a class="markdownIt-Anchor" href="#第一种方式未必最佳使用arraylistasliststrarray">#</a> 第一种方式 (未必最佳): 使用 ArrayList.asList (strArray)</h2>
<p>使用 Arrays 工具类 Arrays.asList (strArray) 方式，转换完成后，只能对 List 数组进行查改，不能增删，增删就会抛出<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=UnsupportedOperationException&amp;spm=1001.2101.3001.7020"> UnsupportedOperationException</a> 异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List; </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Demo1</span><span class="params">()</span> &#123;</span><br><span class="line">        String[] str = &#123;<span class="string">&quot;fgx&quot;</span>, <span class="string">&quot;lzy&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//注意这个List不是Collections包内的List,而是util包里面的List接口</span></span><br><span class="line">        List&lt;String&gt; ints = Arrays.asList(str);</span><br><span class="line">    	<span class="comment">//这里会报错</span></span><br><span class="line">        ints.add(<span class="string">&quot;laopo&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>添加数据报错:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.UnsupportedOperationException</span><br><span class="line">at java.util.AbstractList.add(AbstractList.java:<span class="number">148</span>)</span><br><span class="line">at java.util.AbstractList.add(AbstractList.java:<span class="number">108</span>)</span><br><span class="line">at JAVA基础.JDK8新特性.Java数组转List.Demo1(Java数组转List.java:<span class="number">20</span>)</span><br><span class="line">at JAVA基础.JDK8新特性.Java数组转List.main(Java数组转List.java:<span class="number">13</span>)</span><br><span class="line"></span><br><span class="line">报错原因:Arrays.asList(str)返回值是java.util.Arrays类中一个私有静态内部类 </span><br><span class="line">java.utiil.Arrays.Arraylist,并不是我们平时用的java.util.ArrayList();</span><br><span class="line"></span><br><span class="line">使用场景:Arrays.asList(strArray)方式仅能用在将数组转换为List后，不需要增删其中的值，仅作为数据源读取使用。</span><br></pre></td></tr></table></figure>
<h2 id="第二种方法支持增删查改"><a class="markdownIt-Anchor" href="#第二种方法支持增删查改">#</a> 第二种方法 (支持增删查改):</h2>
<p>通过 ArrayList 的构造器，将 Arrays.asList (strArray) 的返回值由 java.utilArrays.ArrayList 转为 java.util.ArrayList.<br>
 关键代码：ArrayList list = new ArrayList (Arrays.asList (strArray)) ;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String[] str = &#123;<span class="string">&quot;fgx&quot;</span>, <span class="string">&quot;lzy&quot;</span>&#125;;</span><br><span class="line">      <span class="comment">//注意这个List不是Collections包内的List,而是util包里面的List接口</span></span><br><span class="line">      java.util.ArrayList&lt;String&gt; strings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(str));</span><br><span class="line">      strings.add(<span class="string">&quot;aop&quot;</span>);</span><br><span class="line">      strings.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/f33d7ecf29754253b15d6abeda2034aa.png" alt="在这里插入图片描述"><br>
使用场景：需要在将数组转换为 List 后，对 List 进行增删改查操作，在 List 的数据量不大的情况下，可以使用。</p>
<h2 id="第三种方式通过集合工具类collectionsaddall方法最高效"><a class="markdownIt-Anchor" href="#第三种方式通过集合工具类collectionsaddall方法最高效">#</a> 第三种方式 (通过集合工具类 Collections.<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=addAll&amp;spm=1001.2101.3001.7020">addAll</a> () 方法 (最高效))</h2>
<p>通过 Collections.addAll (arrayList, strArray) 方式转换，根据数组的长度创建一个长度相同的 List，然后通过 Collections.addAll () 方法，将数组中的元素转为二进制，然后添加到 List 中，这是最高效的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">Demo3</span><span class="params">()</span> &#123;</span><br><span class="line">       <span class="comment">//注意这个List不是Collections包内的List,而是util包里面的List接口</span></span><br><span class="line">       String[] str = &#123;<span class="string">&quot;fgx&quot;</span>, <span class="string">&quot;lzy&quot;</span>&#125;;</span><br><span class="line">       java.util.ArrayList&lt;String&gt; stringList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(str.length);</span><br><span class="line">       Collections.addAll(stringList,str);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四种方式通过jdk8的stream流将3总基本类型数组转为list"><a class="markdownIt-Anchor" href="#第四种方式通过jdk8的stream流将3总基本类型数组转为list">#</a> 第四种方式通过 JDK8 的 Stream 流将 3 总基本类型数组转为 List</h2>
<p>如果 JDK 版本在 1.8 以上，使用流 stream 来将下列 3 种数组快速转为 List, 分别是 int [],long [],double [], 不支持 short [ ],byte [ ],char [] 在 JDK1.8 中暂不支持.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] ints = &#123;<span class="number">2</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">22</span>, <span class="number">11</span>&#125;;</span><br><span class="line">       <span class="type">long</span>[] longs = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">       <span class="type">double</span>[] doubles = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">       Arrays.stream(ints).boxed().collect(Collectors.toList());</span><br><span class="line">       Arrays.stream(longs).boxed().collect(Collectors.toList());</span><br><span class="line">       Arrays.stream(doubles).boxed().collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<p>TIPs: 为什么 int [] 不能直接转为 List, 而 Integer [] 可以转为 List, 而 Integer [] 就可以转为 List 了，因为 List 中的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E6%B3%9B%E5%9E%8B&amp;spm=1001.2101.3001.7020">泛型</a>必须是引用类型。</p>
<p><strong>java 数组转 list 误区</strong><br>
<strong>一、不能把基本数据类型转化为列表</strong><br>
仔细观察可以发现 asList 接受的参数是一个泛型的变长参数，而基本数据类型是无法泛型化的，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span>  <span class="title class_">App</span> &#123;</span><br><span class="line">   <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="type">int</span> [] intarray = &#123; <span class="number">1</span> ,  <span class="number">2</span> ,  <span class="number">3</span> ,  <span class="number">4</span> ,  <span class="number">5</span> &#125;;</span><br><span class="line">     <span class="comment">//List&lt;Integer&gt; list = Arrays.asList(intarray); 编译通不过</span></span><br><span class="line">     List&lt; <span class="type">int</span> []&gt; list = Arrays.asList(intarray);</span><br><span class="line">     System.out.println(list);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output：</span><br><span class="line">[[I @66d3c617 ]</span><br></pre></td></tr></table></figure>
<p>这是因为把 int 类型的数组当参数了，所以转换后的列表就只包含一个 int [] 元素。<br>
解决方案：<br>
要想把基本数据类型的数组转化为其包装类型的 list，可以使用 guava 类库的工具方法，示例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> [] intArray = &#123; <span class="number">1</span> ,  <span class="number">2</span> ,  <span class="number">3</span> ,  <span class="number">4</span> &#125;;</span><br><span class="line">List&lt;Integer&gt; list = Ints.asList(intArray);</span><br></pre></td></tr></table></figure>
<p><strong>二、asList 方法返回的是数组的一个视图</strong><br>
视图意味着，对这个 list 的操作都会反映在原数组上，而且这个 list 是定长的，不支持 add、remove 等改变长度的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>  <span class="keyword">class</span>  <span class="title class_">App</span> &#123;</span><br><span class="line">   <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">     <span class="type">int</span> [] intArray = &#123; <span class="number">1</span> ,  <span class="number">2</span> ,  <span class="number">3</span> ,  <span class="number">4</span> &#125;;</span><br><span class="line">     List&lt;Integer&gt; list = Ints.asList(intArray);</span><br><span class="line">     list.set( <span class="number">0</span> ,  <span class="number">100</span> );</span><br><span class="line">     System.out.println(Arrays.toString(intArray));</span><br><span class="line">     list.add( <span class="number">5</span> );</span><br><span class="line">     list.remove( <span class="number">0</span> );</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output：</span><br><span class="line">[ <span class="number">100</span> ,  <span class="number">2</span> ,  <span class="number">3</span> ,  <span class="number">4</span> ]</span><br><span class="line">UnsupportedOperationException</span><br><span class="line">UnsupportedOperationException</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-01-27T11:21:19.000Z" title="2023/1/27 19:21:19">2023-01-27</time>发表</span><span class="level-item"><time dateTime="2022-12-20T18:32:42.000Z" title="2022/12/21 02:32:42">2022-12-21</time>更新</span><span class="level-item">6 分钟读完 (大约916个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/27/%E3%80%90Jenkins%E3%80%91Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85jenkins/">Linux环境下安装jenkins</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="linux环境下安装jenkins"><a class="markdownIt-Anchor" href="#linux环境下安装jenkins">#</a> Linux 环境下安装 jenkins</h1>
<h3 id="1-添加存储库"><a class="markdownIt-Anchor" href="#1-添加存储库">#</a> 1、添加存储库</h3>
<p>yum 的 repo 中默认没有 Jenkins，需要先将 Jenkins 存储库添加到 yum repos，执行下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br></pre></td></tr></table></figure>
<p>完成界面：</p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171035460.png" alt="在这里插入图片描述"></p>
<p>然后执行下面的命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br></pre></td></tr></table></figure>
<h3 id="2-安装jenkins"><a class="markdownIt-Anchor" href="#2-安装jenkins">#</a> 2、安装 jenkins</h3>
<p>执行安装命令： yum install jenkins<br>
 如下图所示，出现询问是否下载时，输入 y，然后点击回车，等待安装完成：<br>
<img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171215646.png" alt="在这里插入图片描述"></p>
<h3 id="3-修改配置"><a class="markdownIt-Anchor" href="#3-修改配置">#</a> <strong>3、修改配置</strong></h3>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=jenkins&amp;spm=1001.2101.3001.7020">jenkins</a> 安装成功后，默认的用户是 jenkins，端口是 8080，为了防止冲突，并且给用户赋权限，我们修改用户名和端口。<br>
输入命令，进入 jenkins 配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/jenkins</span><br></pre></td></tr></table></figure>
<p>找到如下配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">JENKINS_USER=&quot;jenkins&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Type:        string</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># Default: &quot;false&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ServiceRestart: jenkins</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Whether to skip potentially long-running chown at the</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="variable">$JENKINS_HOME</span> location. Do not <span class="built_in">enable</span> this, <span class="string">&quot;true&quot;</span>, unless</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">you know what you<span class="string">&#x27;re doing. See JENKINS-23273.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">#JENKINS_INSTALL_SKIP_CHOWN=&quot;false&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Type: string</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Default:     &quot;-Djava.awt.headless=true&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># ServiceRestart: jenkins</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Options to pass to java when running Jenkins.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Type:        integer(0:65535)</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Default:     8080</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># ServiceRestart: jenkins</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># Port Jenkins is listening on.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Set to -1 to disable</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash">JENKINS_PORT=&quot;8080&quot;</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Type:        string</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># Default:     &quot;&quot;</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"># ServiceRestart: jenkins</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"># IP address Jenkins listens on for HTTP requests.</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="string">Default is all interfaces (0.0.0.0).</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="string"></span></span></span><br><span class="line"><span class="string"><span class="language-bash"></span></span></span><br></pre></td></tr></table></figure>
<h4 id="修改用户名端口"><a class="markdownIt-Anchor" href="#修改用户名端口">#</a> 修改用户名，端口：</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171521366.png" alt="在这里插入图片描述"></p>
<h3 id="若为云服务器需配置安全组并开放端口才可以正常访问"><a class="markdownIt-Anchor" href="#若为云服务器需配置安全组并开放端口才可以正常访问">#</a> 若为云服务器，需配置安全组并开放端口才可以正常访问</h3>
<h1 id="启动jenkins"><a class="markdownIt-Anchor" href="#启动jenkins">#</a> 启动 jenkins</h1>
<h4 id="1如果是2022年7月以后安装的jekins需要下载jdk11或者jdk17版本的jdk环境"><a class="markdownIt-Anchor" href="#1如果是2022年7月以后安装的jekins需要下载jdk11或者jdk17版本的jdk环境">#</a> 1. 如果是 2022 年 7 月以后安装的 jekins，需要下载 jdk11 或者 jdk17 版本的 jdk 环境</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install fontconfig java-11-openjdk</span><br></pre></td></tr></table></figure>
<h3 id="设置自启后启动jenkins服务systemctl-enable-now-jenkins"><a class="markdownIt-Anchor" href="#设置自启后启动jenkins服务systemctl-enable-now-jenkins">#</a> 设置自启后启动 jenkins 服务：systemctl enable --now jenkins</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ebae0938355.png" alt="jenkins在linux下安装（rpm包）_javascript_07"></p>
<h3 id="查看是否自启动systemctl-is-enabled-jenkins"><a class="markdownIt-Anchor" href="#查看是否自启动systemctl-is-enabled-jenkins">#</a> 查看是否自启动：systemctl is-enabled jenkins</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ecdddd6790.png" alt="jenkins在linux下安装（rpm包）_java_08"></p>
<h3 id="查看服务状态systemctl-status-jenkinsservice"><a class="markdownIt-Anchor" href="#查看服务状态systemctl-status-jenkinsservice">#</a> 查看服务状态：systemctl status jenkins.service</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ee068451100.png" alt="jenkins在linux下安装（rpm包）_java_09"></p>
<h3 id="jenkins-failed-to-find-a-valid-java-installation"><a class="markdownIt-Anchor" href="#jenkins-failed-to-find-a-valid-java-installation">#</a> jenkins: failed to find a valid Java installation</h3>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288eeec5c74170.png" alt="jenkins在linux下安装（rpm包）_javascript_10"></p>
<h3 id="使用以下方法启动jenkins"><a class="markdownIt-Anchor" href="#使用以下方法启动jenkins">#</a> 使用以下方法启动 jenkins</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/init.d</span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">./jenkins start</span><br><span class="line"># 停止</span><br><span class="line">./jenkins stop</span><br><span class="line"># 状态</span><br><span class="line">./jenkins status</span><br></pre></td></tr></table></figure>
<h3 id="提示jdk版本不满足-可能是jdk11没有配置到jeknins上"><a class="markdownIt-Anchor" href="#提示jdk版本不满足-可能是jdk11没有配置到jeknins上">#</a> 提示 jdk 版本不满足，可能是 jdk11 没有配置到 jeknins 上</h3>
<h4 id="jenkins-requires-java-versions-17-11-but-you-are-running-with-java-18-from-usrlocaljdk180_211jre"><a class="markdownIt-Anchor" href="#jenkins-requires-java-versions-17-11-but-you-are-running-with-java-18-from-usrlocaljdk180_211jre">#</a> Jenkins requires Java versions [17, 11] but you are running with Java 1.8 from /usr/local/jdk1.8.0_211/jre</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013407_6337288f30b9997576.png" alt="jenkins在linux下安装（rpm包）_json_13"></p>
<h4 id="将jdk11的环境配置到-etcrcdinitdjenkins-的candidates中"><a class="markdownIt-Anchor" href="#将jdk11的环境配置到-etcrcdinitdjenkins-的candidates中">#</a> 将 jdk11 的环境配置到 /etc/rc.d/init.d/jenkins 的 candidates 中</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105322847.png" alt="image-20221122105322847"></p>
<h4 id="重新启动服务没有报错"><a class="markdownIt-Anchor" href="#重新启动服务没有报错">#</a> 重新启动服务，没有报错</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105452465.png" alt="image-20221122105452465"></p>
<h4 id="访问-jenkins第一次需要输入生成的密码在-varlibjenkinssecrets-目录下的initialadminpassword文件中"><a class="markdownIt-Anchor" href="#访问-jenkins第一次需要输入生成的密码在-varlibjenkinssecrets-目录下的initialadminpassword文件中">#</a> 访问 Jenkins，第一次需要输入生成的密码，在 /var/lib/jenkins/secrets 目录下的 initialAdminPassword 文件中</h4>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122104907426.png" alt="image-20221122104907426"></p>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122104919096.png" alt="image-20221122104919096"></p>
<h2 id="成功"><a class="markdownIt-Anchor" href="#成功">#</a> 成功</h2>
<p><img src="https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105607288.png" alt="image-20221122105607288"></p>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-01-21T10:15:28.000Z" title="2023/1/21 18:15:28">2023-01-21</time>发表</span><span class="level-item"><time dateTime="2019-12-01T00:58:19.000Z" title="2019/12/1 08:58:19">2019-12-01</time>更新</span><span class="level-item">12 分钟读完 (大约1778个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2023/01/21/%E3%80%90Flutter%E3%80%91Flutter%E9%9B%86%E6%88%90%E4%B8%AD%E5%9B%BD%E7%A7%BB%E5%8A%A8%E4%B8%80%E9%94%AE%E7%99%BB%E5%BD%95%E4%B8%9A%E5%8A%A1%EF%BC%8C%E4%BA%B2%E6%B5%8B%E5%8F%AF%E8%A1%8C/">Flutter集成中国移动一键登录业务，亲测可行</a></p><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="flutter集成中国移动一键登录业务"><a class="markdownIt-Anchor" href="#flutter集成中国移动一键登录业务">#</a> Flutter 集成中国移动一键登录业务</h1>
<p>#本文适用于 Flutter 平台开发的小伙伴需要所谓一键登录的业务</p>
<p><img src="https://img.mukewang.com/szimg/5e3fda1b28fe88e205001000.jpg" alt="https://img.mukewang.com/szimg/5e3fda1b08fe88e203600780.jpg"></p>
<p>先贴上链接</p>
<p>中国移动互联网能力开放平台：<a target="_blank" rel="noopener" href="https://dev.10086.cn">https://dev.10086.cn</a></p>
<p>号码认证 Android_5.9.5 接入文档：<a target="_blank" rel="noopener" href="http://dev.10086.cn/dev10086/pub/loadAttach?attachId=9324E5A5EB8E4DF5BC5118221A93D3ED">http://dev.10086.cn/dev10086/pub/loadAttach?attachId=9324E5A5EB8E4DF5BC5118221A93D3ED</a></p>
<p>移动认证服务端接入文档：<a target="_blank" rel="noopener" href="https://dev.10086.cn/dev10086/pub/loadAttach?attachId=6EF75FD09D4F40D1973CB7C36C3DB2E2">https://dev.10086.cn/dev10086/pub/loadAttach?attachId=6EF75FD09D4F40D1973CB7C36C3DB2E2</a></p>
<p>话不多说，直接上正题，本文比某 SDN 的质量高不知道多少倍呢。</p>
<h3 id="1准备工作"><a class="markdownIt-Anchor" href="#1准备工作">#</a> 1. 准备工作</h3>
<h4 id="11注册账号并创建一个应用"><a class="markdownIt-Anchor" href="#11注册账号并创建一个应用">#</a> 1.1 注册账号并创建一个应用</h4>
<p>​	<img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112193829020.png" alt="image-20230112193829020"></p>
<h4 id="12-下载好统一认证sdk这里使用的版本是-quick_login_android_595jar"><a class="markdownIt-Anchor" href="#12-下载好统一认证sdk这里使用的版本是-quick_login_android_595jar">#</a> 1.2 下载好统一认证 SDK，这里使用的版本是 quick_login_android_5.9.5.jar</h4>
<p>请求我的服务器下载：<a target="_blank" rel="noopener" href="http://43.143.40.221:8080/quick_login_android_5.9.5.rar">http://43.143.40.221:8080/quick_login_android_5.9.5.rar</a><br>
 下载好后解压</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194426269.png" alt="image-20230112194426269"></p>
<h4 id="13-在移动开发平台申请好应用拿到appid-appkey"><a class="markdownIt-Anchor" href="#13-在移动开发平台申请好应用拿到appid-appkey">#</a> 1.3 在移动开发平台申请好应用拿到 appid、appkey</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112193937792.png" alt="image-20230112193937792"></p>
<h3 id="2开始接入"><a class="markdownIt-Anchor" href="#2开始接入">#</a> 2. 开始接入</h3>
<h4 id="21-使用as打开你的项目新建lib文件夹导入quick_login_android_595jar-右键aslibirary导入库"><a class="markdownIt-Anchor" href="#21-使用as打开你的项目新建lib文件夹导入quick_login_android_595jar-右键aslibirary导入库">#</a> 2.1 使用 AS 打开你的项目，新建 lib 文件夹，导入 quick_login_android_5.9.5.jar ，右键 asLibirary，导入库</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194530336.png" alt="image-20230112194530336"></p>
<p>打开项目视图</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194611295.png" alt="image-20230112194611295"></p>
<p>点击 APP 栏位，出现 quick_login_android_5.9.5.jar 即可</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194628573.png" alt="image-20230112194628573"></p>
<h4 id="22-在app级别下的-buildgradle-中的-dependencies-栏位导入依赖使用相对路径引入即可"><a class="markdownIt-Anchor" href="#22-在app级别下的-buildgradle-中的-dependencies-栏位导入依赖使用相对路径引入即可">#</a> 2.2 在 app 级别下的 build.gradle 中的 dependencies 栏位导入依赖，使用相对路径引入即可</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ···</span><br><span class="line">    implementation files(&#x27;..\\lib\\quick_login_android_5.9.5.jar&#x27;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194743574.png" alt="image-20230112194743574"></p>
<h4 id="23-打开-androidmanifestxml-在application引入-androidnetworksecurityconfigxmlnetwork_security_config"><a class="markdownIt-Anchor" href="#23-打开-androidmanifestxml-在application引入-androidnetworksecurityconfigxmlnetwork_security_config">#</a> 2.3 打开 AndroidManifest.xml 在 application 引入 android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194847830.png" alt="image-20230112194847830"></p>
<p>同时，在 res 目录下新建一个 xml 目录</p>
<p>新建 network_security_config.xml 文件 引入以下代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195214620.png" alt="image-20230112195214620"></p>
<p>下一步、将 SDK 集成的 GenLoginAuthActivity 引入主文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:name</span>=<span class="string">&quot;com.cmic.gen.sdk.view.GenLoginAuthActivity&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:configChanges</span>=<span class="string">&quot;orientation|keyboardHidden|screenSize&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:screenOrientation</span>=<span class="string">&quot;unspecified&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:theme</span>=<span class="string">&quot;@style/AuthPage&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">android:launchMode</span>=<span class="string">&quot;singleTop&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195050430.png" alt="image-20230112195050430"></p>
<p>同时，在 res 目录下的两个 values 文件中的 styles.xml 中引入代码：（两个都需要引入）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AuthPage&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;@android:style/Theme.Holo.Light.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:background&quot;</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:colorBackground&quot;</span>&gt;</span>@null<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowIsTranslucent&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112194947904.png" alt="image-20230112194947904"></p>
<p>下一步、引入权限代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_NETWORK_STATE&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195305682.png" alt="image-20230112195305682"></p>
<p>至此、主文件配置完成！</p>
<h4 id="24-将上面压缩包文件中sdk提供的demo程序中的res-umc文件目录引入到我们的main目录中与res同级"><a class="markdownIt-Anchor" href="#24-将上面压缩包文件中sdk提供的demo程序中的res-umc文件目录引入到我们的main目录中与res同级">#</a> 2.4 将上面压缩包文件中 SDK 提供的 Demo 程序中的 res-umc 文件目录引入到我们的 main 目录中，与 res 同级</h4>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195514010.png" alt="image-20230112195514010"></p>
<p>将 res-umc 目录下的文件复制进入 res</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195543408.png" alt="image-20230112195543408"></p>
<p>最终效果：</p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195605424.png" alt="image-20230112195605424"></p>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112195619339.png" alt="image-20230112195619339"></p>
<h4 id="25-打开-kotlin-下的-mainactivitykt-将代码全部复制进入如果导不到包可以看看你的jar包有没有成功引入"><a class="markdownIt-Anchor" href="#25-打开-kotlin-下的-mainactivitykt-将代码全部复制进入如果导不到包可以看看你的jar包有没有成功引入">#</a> 2.5 打开 kotlin 下的 MainActivity.kt ，将代码全部复制进入，如果导不到包可以看看你的 Jar 包有没有成功引入</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">package com.example.mobiledemo</span><br><span class="line"></span><br><span class="line">import android.os.Bundle</span><br><span class="line">import android.widget.Toast</span><br><span class="line">import com.cmic.gen.sdk.auth.GenAuthnHelper</span><br><span class="line">import com.cmic.gen.sdk.auth.GenTokenListener</span><br><span class="line">import com.cmic.gen.sdk.view.GenAuthThemeConfig</span><br><span class="line">import io.flutter.Log</span><br><span class="line">import io.flutter.embedding.android.FlutterActivity</span><br><span class="line">import io.flutter.plugin.common.MethodChannel</span><br><span class="line">import io.flutter.plugins.GeneratedPluginRegistrant</span><br><span class="line">import org.json.JSONObject</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class MainActivity : FlutterActivity() &#123;</span><br><span class="line">    private var mHelper: GenAuthnHelper? = null</span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        MethodChannel(</span><br><span class="line">            getFlutterEngine()?.getDartExecutor()?.getBinaryMessenger(),</span><br><span class="line">            &quot;TYRZ&quot;</span><br><span class="line">        ).setMethodCallHandler &#123; methodCall, result -&gt;</span><br><span class="line">            if (methodCall.method == &quot;loginAuth&quot;) &#123;</span><br><span class="line">                loginAuth(result)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.e(&quot;TYRZ&quot;, &quot;notImplemented&quot;)</span><br><span class="line">                result.notImplemented()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //创建AuthnHelper实例</span><br><span class="line">        mHelper = GenAuthnHelper.getInstance(this)</span><br><span class="line">        //打开SDK日志打印开关</span><br><span class="line">        GenAuthnHelper.setDebugMode(true)</span><br><span class="line">        //初始化授权页主题</span><br><span class="line">        mHelper?.setAuthThemeConfig(GenAuthThemeConfig.Builder().build())</span><br><span class="line">        getFlutterEngine()?.let &#123; GeneratedPluginRegistrant.registerWith(it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 统一认证SDK授权方法调用</span><br><span class="line">     */</span><br><span class="line">    private fun loginAuth(result: MethodChannel.Result) &#123;</span><br><span class="line">        //调用授权方法，这里要填写的appid、appkey为开发者在移动开发平台申请的appid、appkey</span><br><span class="line">        mHelper?.loginAuth(</span><br><span class="line">            &quot;300012327504&quot;,</span><br><span class="line">            &quot;2FDF3FA644E7476FE6733E123D968A82&quot;,</span><br><span class="line">            object : GenTokenListener &#123;</span><br><span class="line">                override fun onGetTokenComplete(i: Int, jsonObject: JSONObject) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        val resultCode = jsonObject.optString(&quot;resultCode&quot;, &quot;没有返回码！&quot;)</span><br><span class="line">                        Toast.makeText(this@MainActivity, resultCode, Toast.LENGTH_SHORT).show()</span><br><span class="line">                        //将结果回传给flutter</span><br><span class="line">                        result.success(resultCode)</span><br><span class="line">                    &#125; catch (e: Exception) &#123;</span><br><span class="line">                        e.printStackTrace()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3运行调试"><a class="markdownIt-Anchor" href="#3运行调试">#</a> 3. 运行调试</h3>
<p>3.1 demo 代码如下：</p>
<p>核心逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//调用方法通道 TYRZ，即我们在MainActivity中注册的方法，调用loginAuth登录方法</span><br><span class="line">String result = await const MethodChannel(&quot;TYRZ&quot;).invokeMethod(&quot;loginAuth&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/services.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      title: <span class="string">&#x27;Flutter Demo&#x27;</span>,</span><br><span class="line">      theme: ThemeData(</span><br><span class="line">        primarySwatch: Colors.blue,</span><br><span class="line">      ),</span><br><span class="line">      home: MyHomePage(title: <span class="string">&#x27;Flutter Demo Home Page&#x27;</span>),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHomePage</span> <span class="keyword">extends</span> <span class="title">StatefulWidget</span> </span>&#123;</span><br><span class="line">  MyHomePage(&#123;Key? key, <span class="keyword">this</span>.title&#125;) : <span class="keyword">super</span>(key: key);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">String?</span> title;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  _MyHomePageState createState() =&gt; _MyHomePageState();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//调用java方法</span></span><br><span class="line">  <span class="keyword">void</span> loginAuth() <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;按钮点击！&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="built_in">String</span> result = <span class="keyword">await</span> <span class="keyword">const</span> MethodChannel(<span class="string">&quot;TYRZ&quot;</span>).invokeMethod(<span class="string">&quot;loginAuth&quot;</span>);</span><br><span class="line">      <span class="comment">//打印统一认证回调的响应码</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;resultCode = &quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="built_in">print</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建一个按钮，在点击按钮时调用统一认证的loginAuth方法拉起授权页。</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> Scaffold(</span><br><span class="line">      appBar: AppBar(</span><br><span class="line">        title: Text(widget.title!),</span><br><span class="line">      ),</span><br><span class="line">      body: Center(</span><br><span class="line">        child: Column(</span><br><span class="line">          mainAxisAlignment: MainAxisAlignment.center,</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            RaisedButton(</span><br><span class="line">              child: <span class="keyword">const</span> Text(<span class="string">&quot;一键登录&quot;</span>),</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                loginAuth();</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="结果成功打印"><a class="markdownIt-Anchor" href="#结果成功打印">#</a> 结果：成功打印</h3>
<p><img src="C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20230112200118488.png" alt="image-20230112200118488"></p>
<p>客户端部分就此结束。</p>
<h2 id="服务端接入认证并请求移动接口获取用户手机号"><a class="markdownIt-Anchor" href="#服务端接入认证并请求移动接口获取用户手机号">#</a> 服务端接入认证并请求移动接口获取用户手机号：</h2>
<p>贴上部分代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">String mobile;</span><br><span class="line">     HashMap&lt;String, String&gt; res = <span class="literal">null</span>;</span><br><span class="line">     Map&lt;Object, Object&gt; result = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="comment">//获取到结果</span></span><br><span class="line">         res = JSONObject.parseObject(post(CHINA_MOBILE_OBTAINS_MOBILE_PHONE_NUMBER, JSONObject.toJSONString(getMD5NoEncryPtionRequestParamMap(token))), HashMap.class);</span><br><span class="line">         <span class="comment">//结果集判断</span></span><br><span class="line">         <span class="keyword">if</span> (AssertUtil.isEmpty(res) || !res.containsKey(<span class="string">&quot;msisdn&quot;</span>)) &#123;</span><br><span class="line">             logger.error(<span class="string">&quot;一键登录异常：&#123;&#125;,&#123;&#125;&quot;</span>, res, ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());<span class="comment">// 一键登录异常</span></span><br><span class="line">             result.put(ResponseCode.MOBILE_LOGIN_EXCEPTION.code(), ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());</span><br><span class="line">             <span class="keyword">return</span> result;</span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="comment">//获取到手机号</span></span><br><span class="line">             mobile = res.get(<span class="string">&quot;msisdn&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         logger.error(<span class="string">&quot;一键登录异常：&#123;&#125;,&#123;&#125;&quot;</span>, res, ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());<span class="comment">// 一键登录异常</span></span><br><span class="line">         result.put(ResponseCode.MOBILE_LOGIN_EXCEPTION.code(), ResponseCode.MOBILE_LOGIN_EXCEPTION.desc());</span><br><span class="line">         <span class="keyword">return</span> result;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>MD5 加密签名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calculates the MD5 digest and returns the value as a 32 character hex string.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data Data to digest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> MD5 digest as a hex string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5Hex</span><span class="params">(String data)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> org.apache.commons.codec.digest.DigestUtils.md5Hex(data).toUpperCase();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获取请求集合：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 获取MD5加密方式的无对称加密的请求集合</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> HashMap&lt;String, String&gt; <span class="title function_">getMD5NoEncryPtionRequestParamMap</span><span class="params">(String token)</span> &#123;</span><br><span class="line">     HashMap&lt;String, String&gt; param = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     <span class="type">String</span> <span class="variable">msgId</span> <span class="operator">=</span> UserUtil.createUUID();</span><br><span class="line">     <span class="type">String</span> <span class="variable">time</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyyMMddHHmmssSSS&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">     param.put(<span class="string">&quot;version&quot;</span>, <span class="string">&quot;2.0&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;msgid&quot;</span>, msgId);</span><br><span class="line">     param.put(<span class="string">&quot;systemtime&quot;</span>, time);</span><br><span class="line">     param.put(<span class="string">&quot;strictcheck&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;appid&quot;</span>, appId);</span><br><span class="line">     param.put(<span class="string">&quot;token&quot;</span>, token);</span><br><span class="line">     param.put(<span class="string">&quot;encryptionalgorithm&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">     param.put(<span class="string">&quot;sign&quot;</span>, md5Hex(appId + <span class="string">&quot;2.0&quot;</span> + msgId + time + <span class="string">&quot;0&quot;</span> + token + APPSecret));</span><br><span class="line">     <span class="keyword">return</span> param;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>post 请求方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">post</span><span class="params">(String URL, String json)</span> &#123;</span><br><span class="line">      <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultHttpClient</span>();</span><br><span class="line">      <span class="type">HttpPost</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(URL);</span><br><span class="line">      post.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">          <span class="type">StringEntity</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(json, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">          s.setContentEncoding(<span class="keyword">new</span> <span class="title class_">BasicHeader</span>(HTTP.CONTENT_TYPE,</span><br><span class="line">                  <span class="string">&quot;application/json&quot;</span>));</span><br><span class="line">          post.setEntity(s);</span><br><span class="line">          <span class="comment">// 发送请求</span></span><br><span class="line">          <span class="type">HttpResponse</span> <span class="variable">httpResponse</span> <span class="operator">=</span> client.execute(post);</span><br><span class="line">          <span class="comment">// 获取响应输入流</span></span><br><span class="line">          <span class="type">InputStream</span> <span class="variable">inStream</span> <span class="operator">=</span> httpResponse.getEntity().getContent();</span><br><span class="line">          <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(</span><br><span class="line">                  inStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">          <span class="type">StringBuilder</span> <span class="variable">strber</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">          <span class="type">String</span> <span class="variable">line</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">          <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>)</span><br><span class="line">              strber.append(line + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">          inStream.close();</span><br><span class="line">          result = strber.toString();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">上一页</a></div><div class="pagination-next"><a href="/page/4/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/14/">14</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-05T05:58:11.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/%E3%80%90%E7%AE%97%E6%B3%95%E3%80%91%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/">【算法】算法的时间与空间复杂度</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-05T01:57:09.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/%E3%80%90IDEA%E3%80%91IDEA%E7%9A%84debug%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7%E8%AF%A6%E8%A7%A3/">【IDEA】IDEA的debug调试技巧详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-05-05T01:57:09.000Z">2023-05-05</time></p><p class="title"><a href="/2023/05/05/%E3%80%90%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80%E3%80%91%E7%99%BE%E5%BA%A6%E6%96%87%E5%BF%83%E4%B8%80%E8%A8%80%E5%A4%A7%E5%9E%8B%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E6%8E%A5%E5%85%A5%E6%95%99%E7%A8%8B/">【文心一言】百度文心一言大型语言模型接入教程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-29T11:42:37.000Z">2023-04-29</time></p><p class="title"><a href="/2023/04/29/%E3%80%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E3%80%9123%20%E7%A7%8D%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%EF%BC%88%E5%85%A823%E7%A7%8D%EF%BC%89/">【设计模式】23 种设计模式详解（全23种）</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-04-27T09:20:49.000Z">2023-04-27</time></p><p class="title"><a href="/2023/04/27/%E3%80%90Dubbo%E3%80%91Dubbo%E8%AF%A6%E8%A7%A3%EF%BC%8C%E7%94%A8%E5%BF%83%E7%9C%8B%E8%BF%99%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B0%B1%E5%A4%9F%E4%BA%86%E3%80%90%E9%87%8D%E7%82%B9%E3%80%91/">【Dubbo】Dubbo详解，用心看这一篇文章就够了【重点】</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">34</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">51</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">44</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">136</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">136</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别呜谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/me.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2029</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>