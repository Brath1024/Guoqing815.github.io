<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享 - Brath-Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Brath-Blog"><meta name="msapplication-TileImage" content="https://brath.cloud/avatar.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Brath-Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="# 【公众号开发】公众号技术分享第二期 - 公众号模板消息 - 模板模式实战分享 # 打一波广告… # 面试记 APP Github：https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Guoqing815&amp;#x2F;interview 安卓 APP 下载：https:&amp;#x2F;&amp;#x2F;www.pgyer.com&amp;#x2F;interview_app_release Brath 的个人博客：https:&amp;#x2F;&amp;#x2F;brath.top 面试记官方公众号"><meta property="og:type" content="blog"><meta property="og:title" content="【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享"><meta property="og:url" content="http://example.com/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/"><meta property="og:site_name" content="Brath-Blog"><meta property="og:description" content="# 【公众号开发】公众号技术分享第二期 - 公众号模板消息 - 模板模式实战分享 # 打一波广告… # 面试记 APP Github：https:&amp;#x2F;&amp;#x2F;github.com&amp;#x2F;Guoqing815&amp;#x2F;interview 安卓 APP 下载：https:&amp;#x2F;&amp;#x2F;www.pgyer.com&amp;#x2F;interview_app_release Brath 的个人博客：https:&amp;#x2F;&amp;#x2F;brath.top 面试记官方公众号"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png"><meta property="og:image" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141325324.png"><meta property="og:image" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141135188.png"><meta property="og:image" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606143429408.png"><meta property="og:image" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png"><meta property="article:published_time" content="2023-06-06T00:13:41.000Z"><meta property="article:modified_time" content="2023-06-06T06:56:51.685Z"><meta property="article:author" content="Brath"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/"},"headline":"【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享","image":["https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png","https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141325324.png","https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141135188.png","https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606143429408.png","https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png"],"datePublished":"2023-06-06T00:13:41.000Z","dateModified":"2023-06-06T06:56:51.685Z","author":{"@type":"Person","name":"Brath"},"publisher":{"@type":"Organization","name":"Brath-Blog","logo":{"@type":"ImageObject","url":"https://brath.cloud/avatar.png"}},"description":"# 【公众号开发】公众号技术分享第二期 - 公众号模板消息 - 模板模式实战分享 # 打一波广告… # 面试记 APP Github：https:&#x2F;&#x2F;github.com&#x2F;Guoqing815&#x2F;interview 安卓 APP 下载：https:&#x2F;&#x2F;www.pgyer.com&#x2F;interview_app_release Brath 的个人博客：https:&#x2F;&#x2F;brath.top 面试记官方公众号"}</script><link rel="canonical" href="http://example.com/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/"><link rel="icon" href="https://brath.cloud/avatar.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章列表</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">更多</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2023-06-06T00:13:41.000Z" title="2023/6/6 08:13:41">2023-06-06</time>发表</span><span class="level-item"><time dateTime="2023-06-06T06:56:51.685Z" title="2023/6/6 14:56:51">2023-06-06</time>更新</span><span class="level-item">29 分钟读完 (大约4331个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享</h1><div class="content"><p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png" alt="InterviewCoder"></p>
<h1 id="公众号开发公众号技术分享第二期-公众号模板消息-模板模式实战分享"><a class="markdownIt-Anchor" href="#公众号开发公众号技术分享第二期-公众号模板消息-模板模式实战分享">#</a> 【公众号开发】公众号技术分享第二期 - 公众号模板消息 - 模板模式实战分享</h1>
<h5 id="打一波广告"><a class="markdownIt-Anchor" href="#打一波广告">#</a> 打一波广告…</h5>
<h1 id="面试记app"><a class="markdownIt-Anchor" href="#面试记app">#</a> 面试记 APP</h1>
<p>Github：<a target="_blank" rel="noopener" href="https://github.com/Guoqing815/interview">https://github.com/Guoqing815/interview</a></p>
<p>安卓 APP 下载：<a target="_blank" rel="noopener" href="https://www.pgyer.com/interview_app_release">https://www.pgyer.com/interview_app_release</a></p>
<p>Brath 的个人博客：<a target="_blank" rel="noopener" href="https://brath.top">https://brath.top</a></p>
<p>面试记官方公众号，定期分享有趣的编程知识：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA">https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA</a></p>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言">#</a> 前言</h2>
<p>​		大家好啊，我是 Brath，一名激进的全栈开发者，从这期专栏开始，我会逐渐分享面试记项目中的部分优质源码给到大家。还希望大家多多关注！</p>
<p>​		上期我们介绍了微信模板消息的配置方式，以及 Java 代码示例，接下来我们要用更优雅的方式来实现发送模板消息！</p>
<h6 id="注意这是实战代码不是demo"><a class="markdownIt-Anchor" href="#注意这是实战代码不是demo">#</a> 注意：这是实战代码，不是 Demo！</h6>
<h4 id="模板模式介绍"><a class="markdownIt-Anchor" href="#模板模式介绍">#</a> 模板模式介绍：</h4>
<p>​		模板模式是一种行为型设计模式，它定义了一个操作中的算法骨架，而将一些步骤延迟到子类中实现。模板方法使得子类可以不改变一个算法的结构即可重新定义该算法的某些特定步骤。</p>
<p>​		在模板模式中，我们定义一个抽象类，其中包含一个模板方法，该方法定义了算法的骨架，以及一些抽象的方法，这些方法需要子类去实现。子类可以继承该抽象类，并实现其中的抽象方法，从而完成具体的业务逻辑。</p>
<h2 id="如何使用模板设计模式优雅的实现发送微信公众号模板消息"><a class="markdownIt-Anchor" href="#如何使用模板设计模式优雅的实现发送微信公众号模板消息">#</a> 如何使用模板设计模式优雅的实现发送微信公众号模板消息？</h2>
<h2 id="一-设计模板架构"><a class="markdownIt-Anchor" href="#一-设计模板架构">#</a> 一、设计模板架构</h2>
<p>​		我们的业务就是发送模板消息，最开始我使用了 switch 分支来判断不同的模板消息，起初它是好用的，但是随着消息类型的增加，慢慢的代码开始冗余了起来，所以我想到了利用模板模式来彻底优化这个业务。</p>
<p>​		这次设计的模板架构分为五个模块：</p>
<h6 id="1模板定义每个模板的规范抽取共性方法凝练重要功能"><a class="markdownIt-Anchor" href="#1模板定义每个模板的规范抽取共性方法凝练重要功能">#</a> 1. 模板：定义每个模板的规范，抽取共性方法，凝练重要功能</h6>
<h6 id="2消息类型分类管理为不同的消息类型赋能"><a class="markdownIt-Anchor" href="#2消息类型分类管理为不同的消息类型赋能">#</a> 2. 消息类型：分类管理，为不同的消息类型赋能</h6>
<h6 id="3类型配置便携管理消息类型摒弃了if与switch判断"><a class="markdownIt-Anchor" href="#3类型配置便携管理消息类型摒弃了if与switch判断">#</a> 3. 类型配置：便携管理消息类型，摒弃了 if 与 switch 判断</h6>
<h6 id="4数据支撑为模板消息提供基础数据支撑例如公众号消息推送业务"><a class="markdownIt-Anchor" href="#4数据支撑为模板消息提供基础数据支撑例如公众号消息推送业务">#</a> 4. 数据支撑：为模板消息提供基础数据支撑，例如公众号消息推送业务</h6>
<h6 id="5统一校验在抽象的层面去校验模板合法性校验通过发送消息"><a class="markdownIt-Anchor" href="#5统一校验在抽象的层面去校验模板合法性校验通过发送消息">#</a> 5. 统一校验：在抽象的层面去校验模板合法性，校验通过发送消息</h6>
<h6 id="6消息注入接口层面通过反射实例化消息并将参数集合注入消息体"><a class="markdownIt-Anchor" href="#6消息注入接口层面通过反射实例化消息并将参数集合注入消息体">#</a> 6. 消息注入：接口层面通过反射实例化消息，并将参数集合注入消息体</h6>
<h2 id="二-结构预览"><a class="markdownIt-Anchor" href="#二-结构预览">#</a> 二、结构预览</h2>
<h4 id="messagedata包定义消息体规范消息格式"><a class="markdownIt-Anchor" href="#messagedata包定义消息体规范消息格式">#</a> messageData 包，定义消息体，规范消息格式</h4>
<p>1.IMessage 为模板通用定义，实现了两个方法，getMessageName 用于获取模板自己的名称，getWxMaTemplateData 用于获取模板的参数配置</p>
<p>2.LoginSuccessTemplateImpl 为登录成功模板消息的实例定义，实现了 IMessage 接口，并且重写 getMessageName 和 getWxMaTemplateData 方法，即能提供自己的名称和参数列表到接口定义中。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141325324.png" alt="image-20230606141325324"></p>
<h4 id="messagemodule包定义模板配置发送流程"><a class="markdownIt-Anchor" href="#messagemodule包定义模板配置发送流程">#</a> messageModule 包，定义模板配置，发送流程</h4>
<p>1.WechatMessageConfig 为模板配置，用于获取所有模板映射的集合，方便我们通过名称获取模板配置实例，摒弃了 ifelse 的判断模式。</p>
<p>2.WechatMessageSupport 为基础数据支撑，用于提供基础的微信模板发送消息的方法，以及模板消息注入方法的实现。</p>
<p>3.IWechatMessageExec 为发送模板的接口，用于实现发送模板消息的规范。</p>
<p>4.AbstractWechatMessageBase 为抽象的微信模板消息，用于抽象化管理所有模板消息，在这里做参数的校验，以及 unionId 的获取。</p>
<p>5.IWechatMessageExecImpl 为发送消息的实现，在抽象层面获取到 fromOpenId 后即可通过抽象层继承的 Support 层的微信模板发送消息的方法来发送微信模板消息。</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606141135188.png" alt="image-20230606141135188"></p>
<p>预览了结构之后，可以更好的理解下面的代码实现</p>
<h2 id="三-模板消息以及实现类型"><a class="markdownIt-Anchor" href="#三-模板消息以及实现类型">#</a> 三、模板消息以及实现类型</h2>
<p>现在开始实现代码的部分，首先我们来定义一个消息体的抽象接口，用来表示统一的模板</p>
<h5 id="抽象接口"><a class="markdownIt-Anchor" href="#抽象接口">#</a> 抽象接口：</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 18:10</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 消息体的抽象接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取消息名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">getMessageName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板消息集合</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;WxMaTemplateData&gt; <span class="title function_">getWxMaTemplateData</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="实现类"><a class="markdownIt-Anchor" href="#实现类">#</a> 实现类：</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 18:13</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 登录成功模板消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;loginSuccessTemplateMessage&quot;)</span></span><br><span class="line"><span class="meta">@ApiModel(value = &quot;登录成功模板消息&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSuccessTemplateImpl</span> <span class="keyword">implements</span> <span class="title class_">IMessage</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;登录用户不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginUser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;登录地址不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginAddr;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;登录IP不能为空&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String loginIp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMessageName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NotifyType.LOGIN_SUCCESS_TEMPLATE_MESSAGE.getType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;WxMaTemplateData&gt; <span class="title function_">getWxMaTemplateData</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;WxMaTemplateData&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword1&quot;</span>, loginUser + <span class="string">&quot;，您的账号刚刚在&quot;</span> + loginAddr + <span class="string">&quot;登录。请关注本次登录时间和地点，若是您本人登录，请忽略本提醒，若非本人登录，请点击修改密码，并检查账号最近登录和操作行为是否有问题。&quot;</span>, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword2&quot;</span>, <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>).format(<span class="keyword">new</span> <span class="title class_">Date</span>()), <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        params.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword3&quot;</span>, loginIp, <span class="string">&quot;#173177&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：NotifyType 表示消息的类型，你可以自己定义常量来代替这段代码</p>
<h6 id="这两段代码实现了一个抽象的消息模板接口并创建了登录成功模板消息类型实现了对应的方法"><a class="markdownIt-Anchor" href="#这两段代码实现了一个抽象的消息模板接口并创建了登录成功模板消息类型实现了对应的方法">#</a> 这两段代码实现了一个抽象的消息模板接口，并创建了登录成功模板消息类型，实现了对应的方法</h6>
<h2 id="四-数据支撑以及数据配置"><a class="markdownIt-Anchor" href="#四-数据支撑以及数据配置">#</a> 四、数据支撑以及数据配置</h2>
<h5 id="数据支撑"><a class="markdownIt-Anchor" href="#数据支撑">#</a> 数据支撑：</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 19:11</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageSupport</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageSupport</span> <span class="keyword">extends</span> <span class="title class_">WechatMessageConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(WechatMessageSupport.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Information service interface</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> NotifyService notifyService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注入消息服务接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyService</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNotifyService</span><span class="params">(NotifyService notifyService)</span> &#123;</span><br><span class="line">        WechatMessageSupport.notifyService = notifyService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注入消息体</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> paramMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> iMessage</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IMessage <span class="title function_">injectMessage</span><span class="params">(HashMap&lt;String, Object&gt; paramMap, IMessage iMessage)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取class模板</span></span><br><span class="line">        Class&lt;?&gt; clazz = iMessage.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 缓存setter方法</span></span><br><span class="line">        Map&lt;String, Method&gt; setterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">        <span class="keyword">for</span> (Method method : clazz.getMethods()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (method.getName().startsWith(Consts.SET)) setterMap.put(method.getName(), method);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注入参数到字段中</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : paramMap.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">paramName</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">paramValue</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="type">String</span> <span class="variable">setterName</span> <span class="operator">=</span> generateSetterName(paramName);</span><br><span class="line">            <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> setterMap.get(setterName);</span><br><span class="line">            <span class="keyword">if</span> (method != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 检查参数类型是否匹配</span></span><br><span class="line">                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span><br><span class="line">                <span class="keyword">if</span> (parameterTypes.length != <span class="number">1</span> || !parameterTypes[<span class="number">0</span>].isInstance(paramValue)) &#123;</span><br><span class="line">                    logger.warn(<span class="string">&quot;无法为消息对象设置参数 &#123;&#125; = &#123;&#125;, 参数类型不匹配&quot;</span>, paramName, paramValue);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 检查方法是否可访问</span></span><br><span class="line">                <span class="keyword">if</span> (!method.isAccessible()) &#123;</span><br><span class="line">                    method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    method.invoke(iMessage, paramValue);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;无法为消息对象设置参数 &#123;&#125; = &#123;&#125;&quot;</span>, paramName, paramValue, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;无法为消息对象设置参数 &#123;&#125; = &#123;&#125;&quot;</span>, paramName, paramValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> iMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成setter方法名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> propertyName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">generateSetterName</span><span class="params">(String propertyName)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(propertyName).filter(name -&gt; !name.isEmpty()).map(name -&gt; <span class="string">&quot;set&quot;</span> + Character.toUpperCase(name.charAt(<span class="number">0</span>)) + name.substring(<span class="number">1</span>)).orElse(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="数据配置"><a class="markdownIt-Anchor" href="#数据配置">#</a> 数据配置：</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 19:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: WechatMessageConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WechatMessageConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消息策略组映射表</span></span><br><span class="line"><span class="comment">     * 疑：为什么初始值会设置成8？而不是6呢？</span></span><br><span class="line"><span class="comment">     * 答：因为 HashMap 的实现可能会自动将 initcp 调整为接近 2 的幂次方的值，以便更好地处理哈希冲突</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, IMessage&gt; messageStrategyGroup = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化消息组</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> properties</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initService</span><span class="params">(IMessage[] properties)</span> &#123;</span><br><span class="line">        Arrays.stream(properties).forEach(</span><br><span class="line">                property -&gt; messageStrategyGroup.put(property.getMessageName(), property)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两段代码我们实现了数据的基础支撑，以及类型模式配置。</p>
<h2 id="五-注入抽象消息到模板并且实现发送流程"><a class="markdownIt-Anchor" href="#五-注入抽象消息到模板并且实现发送流程">#</a> 五、注入抽象消息到模板，并且实现发送流程</h2>
<h5 id="抽象消息接口定义发送模板消息的接口"><a class="markdownIt-Anchor" href="#抽象消息接口定义发送模板消息的接口">#</a> 抽象消息接口：定义发送模板消息的接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-5 20:23</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: IWechatMessageExec</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IWechatMessageExec</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送模板消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String unionId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象消息实现在抽象消息层面去判断消息体的参数合法性并且将unionid转换为fromopenid"><a class="markdownIt-Anchor" href="#抽象消息实现在抽象消息层面去判断消息体的参数合法性并且将unionid转换为fromopenid">#</a> 抽象消息实现：在抽象消息层面去判断消息体的参数合法性，并且将 unionId 转换为 fromOpenId</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:12</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: AbstractWechatMessage</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractWechatMessageBase</span> <span class="keyword">extends</span> <span class="title class_">WechatMessageSupport</span> <span class="keyword">implements</span> <span class="title class_">IWechatMessageExec</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AbstractWechatMessageBase.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送抽象消息，准备消息体，转换FromOpenID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String unionId)</span> &#123;</span><br><span class="line">        ValidatorUtils.validateEntity(message);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (AssertUtil.isEmpty(unionId)) &#123;</span><br><span class="line">            logger.error(DEFALUT_FAIL, ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这段代码原本在WechatMessageSupport层实现，被我剔除掉了，这个需要大家去自己实现收集公众号关注人的fromOpenId，不是微信的openId，是关注了公众号后，产生的openId。</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">fromOpenId</span> <span class="operator">=</span> wxservFollowService.getFromOpenIdByUnionId(unionId);</span><br><span class="line">        <span class="keyword">if</span> (AssertUtil.isEmpty(fromOpenId)) &#123;</span><br><span class="line">            logger.error(DEFALUT_FAIL, ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(ResponseCode.DATA_DOES_NOT_EXIST.desc());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//总之fromOpenId就是关注了公众号后产生的唯一ID</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sendMessage(message, fromOpenId, message.getMessageName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送抽象消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> messageType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String openId, String messageType)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体消息实现在抽象层确保消息体完整性后调用抽象层面的具体实现类调用数据支撑层的notifyservice服务完成发送模板消息"><a class="markdownIt-Anchor" href="#具体消息实现在抽象层确保消息体完整性后调用抽象层面的具体实现类调用数据支撑层的notifyservice服务完成发送模板消息">#</a> 具体消息实现：在抽象层确保消息体完整性后，调用抽象层面的具体实现类，调用数据支撑层的 notifyService 服务完成发送模板消息</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 模板消息推送实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;wechatMessageExecImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IWechatMessageExecImpl</span> <span class="keyword">extends</span> <span class="title class_">AbstractWechatMessageBase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(IWechatMessageExecImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">sendMessage</span><span class="params">(IMessage message, String openId, String messageType)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;【公众号模板消息推送】：开始 --  messageType：&#123;&#125;,openId：&#123;&#125;&quot;</span>, messageType, openId);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            notifyService.notifyWxTemplate(</span><br><span class="line">                    openId,</span><br><span class="line">                    NotifyType.of(messageType),</span><br><span class="line">                    message.getWxMaTemplateData()</span><br><span class="line">            );</span><br><span class="line">            logger.info(<span class="string">&quot;【公众号模板消息推送】：结束 -- messageType：&#123;&#125;,openId：&#123;&#125;&quot;</span>, messageType, openId);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            logger.error(<span class="string">&quot;【公众号模板消息推送】：异常 -- &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">            <span class="keyword">return</span> ResponseUtil.fail(e.getMessage());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseUtil.ok();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="springboot配置文件-消息类型-notifyservice实现"><a class="markdownIt-Anchor" href="#springboot配置文件-消息类型-notifyservice实现">#</a> SpringBoot 配置文件、消息类型、NotifyService 实现：</h4>
<h5 id="pom文件配置依赖这里我们使用大神binarywang的miniapp库来实现微信支持"><a class="markdownIt-Anchor" href="#pom文件配置依赖这里我们使用大神binarywang的miniapp库来实现微信支持">#</a> pom 文件配置依赖：这里我们使用大神 binarywang 的 miniapp 库来实现微信支持</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;weixin-java-miniapp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.binarywang&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;weixin-java-pay&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">3.3</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h5 id="yaml配置实现自定义配置类配置模板集合以及是否开启"><a class="markdownIt-Anchor" href="#yaml配置实现自定义配置类配置模板集合以及是否开启">#</a> yaml 配置：实现自定义配置类，配置模板集合，以及是否开启</h5>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">system:</span></span><br><span class="line">  <span class="attr">notify:</span></span><br><span class="line">    <span class="attr">wx:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#启动模板消息</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">loginSuccessTemplateMessage</span> <span class="comment">#登录成功模板消息</span></span><br><span class="line">          <span class="attr">templateId:</span> <span class="string">qDHo-UXXXXXXXXXXXXXXXXXXXXX</span> <span class="comment">#公众平台模板ID</span></span><br></pre></td></tr></table></figure>
<h5 id="配置信息类使用静态内部类实现子配置"><a class="markdownIt-Anchor" href="#配置信息类使用静态内部类实现子配置">#</a> 配置信息类：使用静态内部类实现子配置</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: NotifyProperties</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;system.notify&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Wx wx;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Data</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Wx</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">boolean</span> enable;</span><br><span class="line">		<span class="keyword">private</span> List&lt;Map&lt;String, String&gt;&gt; template = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="自动配置类使用enableconfigurationproperties注解注入notifyproperties配置并实现notifyservice配置注入"><a class="markdownIt-Anchor" href="#自动配置类使用enableconfigurationproperties注解注入notifyproperties配置并实现notifyservice配置注入">#</a> 自动配置类：使用 EnableConfigurationProperties 注解注入 NotifyProperties 配置并实现 notifyService 配置注入</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:  挂载NotifyProperties类，获取配置信息并自动加载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(NotifyProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> NotifyProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NotifyAutoConfiguration</span><span class="params">(NotifyProperties properties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;NotifyService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> NotifyService <span class="title function_">notifyService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NotifyService</span> <span class="variable">notifyService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NotifyService</span>();</span><br><span class="line"></span><br><span class="line">        NotifyProperties.<span class="type">Wx</span> <span class="variable">wxConfig</span> <span class="operator">=</span> properties.getWx();</span><br><span class="line">        <span class="keyword">if</span> (wxConfig.isEnable()) &#123;</span><br><span class="line">            notifyService.setWxTemplateSender(wxTemplateSender());</span><br><span class="line">            NotifyService.wxTemplate = wxConfig.getTemplate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> notifyService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WxTemplateSender <span class="title function_">wxTemplateSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WxTemplateSender</span> <span class="variable">wxTemplateSender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxTemplateSender</span>();</span><br><span class="line">        <span class="keyword">return</span> wxTemplateSender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="消息类型配置模板消息类型"><a class="markdownIt-Anchor" href="#消息类型配置模板消息类型">#</a> 消息类型：配置模板消息类型</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-05-25 08:49</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: NotifyType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">NotifyType</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//登录成功模板消息</span></span><br><span class="line">    LOGIN_SUCCESS_TEMPLATE_MESSAGE(<span class="string">&quot;loginSuccessTemplateMessage&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EnumMap&lt;NotifyType, String&gt; typeMap = <span class="keyword">new</span> <span class="title class_">EnumMap</span>&lt;&gt;(NotifyType.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (NotifyType notifyType : NotifyType.values()) &#123;</span><br><span class="line">            typeMap.put(notifyType, notifyType.type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    NotifyType(String type) &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> NotifyType <span class="title function_">of</span><span class="params">(String messageType)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (NotifyType notifyType : typeMap.keySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typeMap.get(notifyType).equals(messageType)) &#123;</span><br><span class="line">                <span class="keyword">return</span> notifyType;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No such enum object for the given messageType&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.type;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="notifyservice服务实现实现发送消息的服务类"><a class="markdownIt-Anchor" href="#notifyservice服务实现实现发送消息的服务类">#</a> NotifyService 服务实现：实现发送消息的服务类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 公众号模板消息服务</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotifyService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MailSender mailSender;</span><br><span class="line">    <span class="keyword">private</span> String sendFrom;</span><br><span class="line">    <span class="keyword">private</span> String sendTo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> WxTemplateSender wxTemplateSender;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Map&lt;String, String&gt;&gt; wxTemplate = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isWxEnable</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> wxTemplateSender != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信模版消息通知,不跳转</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 该方法会尝试从数据库获取缓存的FormId去发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser     接收者openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType 通知类别，通过该枚举值在配置文件中获取相应的模版ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params     通知模版内容里的参数，类似&quot;您的验证码为&#123;1&#125;&quot;中&#123;1&#125;的值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyWxTemplate</span><span class="params">(String touser, NotifyType notifyType, List&lt;WxMaTemplateData&gt; params)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (wxTemplateSender == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateId</span> <span class="operator">=</span> getTemplateId(notifyType, wxTemplate);</span><br><span class="line">        wxTemplateSender.sendWechatMsg(touser, templateId, params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 微信模版消息通知，带跳转</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * 该方法会尝试从数据库获取缓存的FormId去发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser     接收者openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType 通知类别，通过该枚举值在配置文件中获取相应的模版ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params     通知模版内容里的参数，类似&quot;您的验证码为&#123;1&#125;&quot;中&#123;1&#125;的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page       点击消息跳转的页面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyWxTemplate</span><span class="params">(String touser, NotifyType notifyType, List&lt;WxMaTemplateData&gt; params, String page)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (wxTemplateSender == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">templateId</span> <span class="operator">=</span> getTemplateId(notifyType, wxTemplate);</span><br><span class="line">        wxTemplateSender.sendWechatMsg(touser, templateId, params, page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取模板ID</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> notifyType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getTemplateId</span><span class="params">(NotifyType notifyType, List&lt;Map&lt;String, String&gt;&gt; values)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Map&lt;String, String&gt; item : values) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">notifyTypeStr</span> <span class="operator">=</span> notifyType.getType();</span><br><span class="line">            <span class="keyword">if</span> (item.get(<span class="string">&quot;name&quot;</span>).equals(notifyTypeStr))</span><br><span class="line">                <span class="keyword">return</span> item.get(<span class="string">&quot;templateId&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="wxtemplatesender发送者实现实现发送消息的基础类使用wxmaservice库发送消息"><a class="markdownIt-Anchor" href="#wxtemplatesender发送者实现实现发送消息的基础类使用wxmaservice库发送消息">#</a> WxTemplateSender 发送者实现：实现发送消息的基础类，使用 WxMaService 库发送消息</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 07:40</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 微信模版消息通知</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxTemplateSender</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">logger</span> <span class="operator">=</span> LogFactory.getLog(WxTemplateSender.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WxMaService wxMaService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送微信消息(模板消息),不带跳转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            用户 OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            模板消息ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            详细内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, String[] parms)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送微信消息(模板消息),不带跳转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            用户 OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            模板消息ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            详细内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送微信消息(模板消息),带跳转</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     *            用户 OpenID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     *            模板消息ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     *            详细内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     *            跳转页面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendWechatMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms, String page)</span> &#123;</span><br><span class="line">        sendMsg(touser, templatId, parms, page, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送消息基类</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> touser</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> templatId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parms</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emphasisKeyword</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String touser, String templatId, String[] parms, String page, String color,</span></span><br><span class="line"><span class="params">                         String emphasisKeyword)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (touser == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">WxMaTemplateMessage</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMaTemplateMessage</span>();</span><br><span class="line">        msg.setTemplateId(templatId);</span><br><span class="line">        msg.setToUser(touser);</span><br><span class="line">        msg.setFormId(touser);</span><br><span class="line">        msg.setPage(page);</span><br><span class="line">        msg.setColor(color);</span><br><span class="line">        msg.setEmphasisKeyword(emphasisKeyword);</span><br><span class="line">        msg.setData(createMsgData(parms));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wxMaService.getMsgService().sendTemplateMsg(msg);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">JsonParser</span> <span class="variable">JSON_PARSER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JsonParser</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEND_MSG_API</span> <span class="operator">=</span> <span class="string">&quot;https://api.weixin.qq.com/cgi-bin/message/template/send&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String touser, String templatId, List&lt;WxMaTemplateData&gt; parms, String page, String color,</span></span><br><span class="line"><span class="params">                         String emphasisKeyword)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (touser == <span class="literal">null</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">WxMaTemplateMessage</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxMaTemplateMessage</span>();</span><br><span class="line">        msg.setTemplateId(templatId);</span><br><span class="line">        msg.setToUser(touser);</span><br><span class="line">        msg.setFormId(touser);</span><br><span class="line">        msg.setPage(page);</span><br><span class="line">        msg.setColor(color);</span><br><span class="line">        msg.setEmphasisKeyword(emphasisKeyword);</span><br><span class="line">        msg.setData(parms);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">responseContent</span> <span class="operator">=</span> <span class="built_in">this</span>.wxMaService.post(SEND_MSG_API, msg.toJson());</span><br><span class="line">            <span class="type">JsonObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON_PARSER.parse(responseContent).getAsJsonObject();</span><br><span class="line">            <span class="keyword">if</span> (jsonObject.get(WxMaConstants.ERRCODE).getAsInt() != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">WxErrorException</span>(WxError.fromJson(responseContent));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (WxErrorException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;【微信消息模板】：服务端异常，原因可能是：&#123;&#125;&quot;</span>, e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;WxMaTemplateData&gt; <span class="title function_">createMsgData</span><span class="params">(String[] parms)</span> &#123;</span><br><span class="line">        List&lt;WxMaTemplateData&gt; dataList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;WxMaTemplateData&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= parms.length; i++) &#123;</span><br><span class="line">            dataList.add(<span class="keyword">new</span> <span class="title class_">WxMaTemplateData</span>(<span class="string">&quot;keyword&quot;</span> + i, parms[i - <span class="number">1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dataList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="在配置完如上代码后我们的代码就完成了接下来即可通过单元测试来测试模板消息"><a class="markdownIt-Anchor" href="#在配置完如上代码后我们的代码就完成了接下来即可通过单元测试来测试模板消息">#</a> 在配置完如上代码后，我们的代码就完成了，接下来即可通过单元测试来测试模板消息！</h6>
<h2 id="六-使用抽象模板发送消息"><a class="markdownIt-Anchor" href="#六-使用抽象模板发送消息">#</a> 六、使用抽象模板发送消息</h2>
<p>单元测试发送消息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Brath</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span>: 2023-06-6 08:21</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@github</span>: https://github.com/Guoqing815</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Copyright</span>: 公众号：InterviewCoder | 博客：https://brath.top - 为了更好的你，也为了更好的世界。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: 单测</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRunnerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(SpringRunnerTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> IWechatMessageExec messageExec;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_sendMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//产品提测消息</span></span><br><span class="line">        <span class="type">ProductTestTemplateImpl</span> <span class="variable">productTestTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProductTestTemplateImpl</span>()</span><br><span class="line">                .setCompanyName(<span class="string">&quot;测试公司&quot;</span>)</span><br><span class="line">                .setUserName(<span class="string">&quot;Brath&quot;</span>)</span><br><span class="line">                .setVersion(<span class="string">&quot;2.0.6&quot;</span>);</span><br><span class="line">        <span class="comment">//注册成功消息</span></span><br><span class="line">        <span class="type">RegistTemplateImpl</span> <span class="variable">registTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RegistTemplateImpl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//登录成功消息</span></span><br><span class="line">        <span class="type">LoginSuccessTemplateImpl</span> <span class="variable">loginSuccessTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LoginSuccessTemplateImpl</span>()</span><br><span class="line">                .setLoginUser(<span class="string">&quot;Brath&quot;</span>)</span><br><span class="line">                .setLoginAddr(<span class="string">&quot;JVM&quot;</span>)</span><br><span class="line">                .setLoginIp(<span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line">        messageExec.sendMessage(loginSuccessTemplate, <span class="string">&quot;o-KKr6Qwsxxxxxxxxxxxxxxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="测试成功~"><a class="markdownIt-Anchor" href="#测试成功~">#</a> 测试成功～</h5>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/image-20230606143429408.png" alt="image-20230606143429408"></p>
<h6 id="tips如果你觉得brath分享的代码还可以的话请将我分享给更多需要帮助的人~"><a class="markdownIt-Anchor" href="#tips如果你觉得brath分享的代码还可以的话请将我分享给更多需要帮助的人~">#</a> tips：如果你觉得 Brath 分享的代码还可以的话，请将我分享给更多需要帮助的人～</h6>
<h6 id="到此为止公众号发送模板消息的知识分享就结束啦还请同学们多多关注interviewcoder做一个激进的开发者为了更好的你也为了更好的世界"><a class="markdownIt-Anchor" href="#到此为止公众号发送模板消息的知识分享就结束啦还请同学们多多关注interviewcoder做一个激进的开发者为了更好的你也为了更好的世界">#</a> 到此为止，公众号发送模板消息的知识分享就结束啦，还请同学们多多关注 InterviewCoder，做一个激进的开发者，为了更好的你，也为了更好的世界！</h6>
<h1 id="完结撒花"><a class="markdownIt-Anchor" href="#完结撒花">#</a> 完结撒花❀</h1>
<h2 id="关于我"><a class="markdownIt-Anchor" href="#关于我">#</a> 关于我</h2>
<p>Brath 是一个热爱技术的 Java 程序猿，公众号「InterviewCoder」定期分享有趣有料的精品原创文章！</p>
<p><img src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></p>
<p>非常感谢各位人才能看到这里，原创不易，文章如果有帮助可以关注、点赞、分享或评论，这都是对我的莫大支持！</p>
</div><div class="sharethis-inline-share-buttons"></div><script src="https://brath.cn" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="https://brath.cloud/zfb.jpg" alt="支付宝"></span></a><a class="button donate" href="https://brath.cloud/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BA%8C%E5%90%88%E4%B8%80.png" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="https://brath.cloud/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E5%AE%9D%E4%BA%8C%E5%90%88%E4%B8%80.png" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="https://brath.cloud/wx.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2023/06/12/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%89%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">【公众号开发】公众号技术分享第三期-公众号事件处理-设计模式实战分享</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/"><span class="level-item">【公众号开发】公众号技术分享第一期-如何注册微信公众平台并使用公众号模板消息</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="SOHUCS" sid="2023/06/06/【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享/"></div><script charset="utf-8" src="https://changyan.sohu.com/upload/changyan.js"></script><script>window.changyan.api.config({appid: 'cywzQRCbe',conf: '485cd826ef6d780dcea71d0f3b37304a'});</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-12T04:13:41.000Z">2023-06-12</time></p><p class="title"><a href="/2023/06/12/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%89%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">【公众号开发】公众号技术分享第三期-公众号事件处理-设计模式实战分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:13:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%BA%8C%E6%9C%9F-%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF-%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%AE%9E%E6%88%98%E5%88%86%E4%BA%AB/">【公众号开发】公众号技术分享第二期-公众号模板消息-模板模式实战分享</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-06T00:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E3%80%91%E5%85%AC%E4%BC%97%E5%8F%B7%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB%E7%AC%AC%E4%B8%80%E6%9C%9F-%E5%A6%82%E4%BD%95%E6%B3%A8%E5%86%8C%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0%E5%B9%B6%E4%BD%BF%E7%94%A8%E5%85%AC%E4%BC%97%E5%8F%B7%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF/">【公众号开发】公众号技术分享第一期-如何注册微信公众平台并使用公众号模板消息</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T17:10:41.000Z">2023-06-06</time></p><p class="title"><a href="/2023/06/06/%E3%80%90Sentinel%E3%80%91Docker%E6%90%AD%E5%BB%BASentinel/">【Sentinel】Docker搭建Sentinel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-06-05T07:25:21.000Z">2023-06-05</time></p><p class="title"><a href="/2023/06/05/%E3%80%90Git%E3%80%91Github%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E9%81%87%E5%88%B0%E9%94%99%E8%AF%AF%EF%BC%9AERROR%20You%E2%80%98re%20using%20an%20RSA%20key%20with%20SHA-1,%20which%20is%20no%20longer%20allowed/">【Git】Github提交代码遇到错误：ERROR You‘re using an RSA key with SHA-1, which is no longer allowed</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">41</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">61</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">43</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://brath4.oss-cn-shenzhen.aliyuncs.com/picgo/%E4%BA%8C%E7%BB%B4%E7%A0%81plus.png" alt="InterviewCoder"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">InterviewCoder</p><p class="is-size-6 is-block">面试记官方公众号</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">150</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://mp.weixin.qq.com/s/jWs6lLHl5L-atXJhHc4YvA" target="_blank" rel="noopener">关注我</a></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://brath.cloud/me.png" alt="Brath"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Brath</p><p class="is-size-6 is-block">技能改变人生，知识改变命运。</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>中国·江苏·无锡</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">150</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Guoqing815" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Guoqing815"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Gitee" href="https://gitee.com/Guoqing-Li"><i class="fab fa-gitee"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://schokolade.cn/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">泠灵(特别鸣谢)</span></span><span class="level-right"><span class="level-item tag">schokolade.cn</span></span></a></li><li><a class="level is-mobile" href="https://github.com/Guoqing815/interview" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">面试记Github</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://www.pgyer.com/interview_app_release" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">面试记App(Android)</span></span><span class="level-right"><span class="level-item tag">www.pgyer.com</span></span></a></li><li><a class="level is-mobile" href="https://gitee.com/Guoqing-Li" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Gitee(码云)</span></span><span class="level-right"><span class="level-item tag">gitee.com</span></span></a></li><li><a class="level is-mobile" href="https://blog.csdn.net/Brath?type=blog" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">CSDN</span></span><span class="level-right"><span class="level-item tag">blog.csdn.net</span></span></a></li><li><a class="level is-mobile" href="https://juejin.cn/user/settings/profile" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">掘金</span></span><span class="level-right"><span class="level-item tag">juejin.cn</span></span></a></li><li><a class="level is-mobile" href="https://oss.console.aliyun.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">AliCloud(阿里云)</span></span><span class="level-right"><span class="level-item tag">oss.console.aliyun.com</span></span></a></li><li><a class="level is-mobile" href="https://cloud.tencent.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">TencentCloud(腾讯云)</span></span><span class="level-right"><span class="level-item tag">cloud.tencent.com</span></span></a></li><li><a class="level is-mobile" href="https://www.zhipin.com/web/user/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">BOSS</span></span><span class="level-right"><span class="level-item tag">www.zhipin.com</span></span></a></li><li><a class="level is-mobile" href="https://www.bilibili.com/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bilibili(B站)</span></span><span class="level-right"><span class="level-item tag">www.bilibili.com</span></span></a></li></ul></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://brath.cloud/avatar.png" alt="Brath-Blog" height="28"></a><p class="is-size-7"><span>&copy; 2023 Brath</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p><p class="is-size-7">© 2030</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>