{
    "version": "https://jsonfeed.org/version/1",
    "title": "BrathBlog",
    "description": "",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2023/01/11/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%94%E8%AE%B0/",
            "url": "http://example.com/2023/01/11/JVM%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AC%94%E8%AE%B0/",
            "title": "JVM学习记录",
            "date_published": "2023-01-11T00:54:34.021Z",
            "content_html": "<h4 id=\"jvm位置在操作系统之上运行操作系统在硬件之上运行\"><a class=\"markdownIt-Anchor\" href=\"#jvm位置在操作系统之上运行操作系统在硬件之上运行\">#</a> JVM 位置：在操作系统之上运行，操作系统在硬件之上运行</h4>\n<p>JDK（JRE（JVM））: JDK 包含了 JRE，JRE 包含了 JVM</p>\n<h4 id=\"jvm体系结构\"><a class=\"markdownIt-Anchor\" href=\"#jvm体系结构\">#</a> JVM 体系结构：</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/JVM%E5%BA%95%E5%B1%82%E7%BB%93%E6%9E%84%E7%94%BB%E5%9B%BE%EF%BC%88%E7%B2%BE%E7%BB%86%EF%BC%89.jpg\" alt=\"JVM底层结构画图（精细）\"></p>\n<p>Java File</p>\n<p>=&gt; Class File</p>\n<p>=&gt; Class Loader SubSystem {</p>\n<p>1 . Loading : [1 . ApplicationClassLoader   2 . ExtClassLoader  3 . BootStrapClassLoader]</p>\n<p>2 . Linking : [1. Verify  2.Prepare  3. Resolve ]</p>\n<p>3 . Initialization</p>\n<p>}</p>\n<p>=&gt; RuntimeData Areas ：(1,2) : Memory sharing，(3,4,5) : Memory is not shared{</p>\n<p>1 . Method Area</p>\n<p>2 . Heap Area </p>\n<p>3 . Stack Area   {</p>\n<p>T1 [1. Thread  2. Stack Frame ]</p>\n<p>T2 [1. Thread  2. Stack Frame ]</p>\n<p>}</p>\n<p>4 . Native MethodStack Area    --&gt; JNI</p>\n<p>5 . Program Counter Register [PC Registers for Thread]</p>\n<p>}</p>\n<p>=&gt; Execution Engine {</p>\n<p>1 . interpreter</p>\n<p>2 . JIT Compiler  {</p>\n<p>Intermediate Code Generator</p>\n<p>=&gt; Code Optimizer</p>\n<p>=&gt; Target Code Generator</p>\n<p>}</p>\n<p>3 . Profiler</p>\n<p>4 . Garbage Collection</p>\n<p>}</p>\n<p>=&gt; Java Native Method Interface （JNI）</p>\n<p>=&gt; Native Method Library</p>\n<h4 id=\"类加载器-classloader-subsystem-类加载器子系统-运行时在堆中运行-不运行时是独立子系统\"><a class=\"markdownIt-Anchor\" href=\"#类加载器-classloader-subsystem-类加载器子系统-运行时在堆中运行-不运行时是独立子系统\">#</a> 类加载器： ClassLoader SubSystem : 类加载器子系统 运行时在堆中运行 不运行时是独立子系统</h4>\n<p>application ClassLoader 应用程序加载器  主要负责加载应用程序的主函数类</p>\n<p>Ext ClassLoader 扩展加载器  主要负责加载 jre/lib/ext 目录下的一些扩展的 jar。</p>\n<p>BootStrap ClassLoader 根类加载器  主要负责加载核心的类库 (java.lang.* 等)</p>\n<p>加载过程：class File =&gt; Loading 加载 =&gt; Linking （验证，准备，解析） 链接 =&gt; Initialization 初始化</p>\n<h4 id=\"双亲委派机制\"><a class=\"markdownIt-Anchor\" href=\"#双亲委派机制\">#</a> 双亲委派机制</h4>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20201217213314510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGV5YW5iYW8=,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>从上图中我们就更容易理解了，当一个 Hello.class 这样的文件要被加载时。不考虑我们自定义类加载器，首先会在 AppClassLoader 中检查是否加载过，如果有那就无需再加载了。如果没有，那么会拿到父加载器，然后调用父加载器的 loadClass 方法。父类中同理也会先检查自己是否已经加载过，如果没有再往上。注意这个类似递归的过程，直到到达 Bootstrap classLoader 之前，都是在检查是否加载过，并不会选择自己去加载。直到 BootstrapClassLoader，已经没有父加载器了，这时候开始考虑自己是否能加载了，如果自己无法加载，会下沉到子加载器去加载，一直到最底层，如果没有任何加载器能加载，就会抛出 ClassNotFoundException。那么有人就有下面这种疑问了？</p>\n<p>为什么要设计这种机制<br>\n这种设计有个好处是，如果有人想替换系统级别的类：String.java。篡改它的实现，在这种机制下这些系统的类已经被 Bootstrap classLoader 加载过了（为什么？因为当一个类需要加载的时候，最先去尝试加载的就是 BootstrapClassLoader），所以其他类加载器并没有机会再去加载，从一定程度上防止了危险代码的植入。</p>\n<p>沙箱安全机制</p>\n<p>在 Java 中将执行程序分成本地代码和远程代码两种，本地代码默认视为可信任的，而远程代码则被看作是不受信的。对于授信的本地代码，可以访问一切本地资源。而对于非授信的远程代码在早期的 Java 实现中，安全依赖于沙箱 (Sandbox) 机制。</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20200312212803678.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MDkyNzQzNg==,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>当前最新的安全机制实现，则引入了域 (Domain) 的概念。虚拟机会把所有代码加载到不同的系统域和应用域，系统域部分专门负责与关键资源进行交互，而各个应用域部分则通过系统域的部分代理来对各种需要的资源进行访问。虚拟机中不同的受保护域 (Protected Domain)，对应不一样的权限 (Permission)。存在于不同域中的类文件就具有了当前域的全部权限，如下图所示</p>\n<h4 id=\"native\"><a class=\"markdownIt-Anchor\" href=\"#native\">#</a> Native</h4>\n<p><strong>native 即 JNI,Java Native Interface</strong></p>\n<p>Native 关键字是  JNI，也就是 java 本地方法接口，用来调用本地方法库，可以调用本地方法中的 C 语言代码</p>\n<h4 id=\"pc寄存器\"><a class=\"markdownIt-Anchor\" href=\"#pc寄存器\">#</a> PC 寄存器</h4>\n<p>每次线程启动的时候会创建一个 PC 寄存器，保存正在执行的 JVM 指令地址，每个线程都有自己的 PC 寄存器，是一个比较小的内存空间，是为一个一个不会出现 OutOfMemoryError 的内存区域，它的生命周期随着线程的创建而创建，随着线程的结束而死亡。</p>\n<h4 id=\"方法区\"><a class=\"markdownIt-Anchor\" href=\"#方法区\">#</a> 方法区</h4>\n<p>Hotspot 虚拟机，方法区别称：non-heap（非堆），其实就是存储堆类型的数据，而不占据堆内存的空间</p>\n<p>方法区和堆区线程共享，方法区大小和堆一样，可以选择固定大小或者拓展</p>\n<p>方法区大小决定了系统可以保存多少个类，如果系统定义了太多的类，导致方法区溢出，虚拟机同样会抛出内存溢出错误。</p>\n<p>关闭 JVM 就会释放这个区域的内存</p>\n<p>设置方法区的内存大小：</p>\n<h4 id=\"jdk17-之前\"><a class=\"markdownIt-Anchor\" href=\"#jdk17-之前\">#</a> JDK1.7 之前：</h4>\n<p><strong>-XX：PermSize 设置永久代初始分配空间  默认是 20.75m</strong></p>\n<p><strong>-XX：MaxPermSize 设置最大永久代分配空间，32 位机器默认 64m，64 位机器默认 82m</strong></p>\n<h4 id=\"jdk18-及以后永久代被元空间代替metaspace\"><a class=\"markdownIt-Anchor\" href=\"#jdk18-及以后永久代被元空间代替metaspace\">#</a> JDK1.8 及以后：永久代被元空间代替（MetaSpace）</h4>\n<p>元空间大小可以用参数：-XX:MetaspaceSzie 和 -XX:MaxMetaspaceSize 指定</p>\n<p>-XX:MetaspaceSzie 默认 21.75m -XX:MaxMetaspaceSize 默认 - 1 没有限制</p>\n<p>默认情况下，虚拟机会耗尽所有可用的系统内存，如果元空间发生溢出，虚拟机照样会抛出 OOM</p>\n<p>如果初始高位线设置过低，通过垃圾回收器日志可以观察到 Full GC 多次调用，为了避免频繁 GC，</p>\n<p>建议将 - XX:MetaspaceSize 设置为一个相对较高的值。</p>\n<h4 id=\"栈数据结构\"><a class=\"markdownIt-Anchor\" href=\"#栈数据结构\">#</a> 栈：数据结构</h4>\n<p>程序 = 数据结构 + 算法</p>\n<p>先进后出，后进先出</p>\n<p>栈是桶的概念：先进去的后出来，后进去的先出来</p>\n<p>栈有压栈、弹栈</p>\n<p>队列是管道概念：先进先出 (F I F O) ，后进后出 First Input First Out</p>\n<p>喝多了吐就是栈，吃多了拉就是队列</p>\n<p>栈：主管程序运行，生命周期和线程同步；</p>\n<p>main 主线程结束，栈内存也就释放了，对于栈来说，不存在垃圾回收问题，一旦线程结束，栈就 Over 了。</p>\n<p>栈存什么东西：</p>\n<p>八大基本数据类型 + 对象的引用地址 + 实例方法</p>\n<p>栈运行原理：栈帧：方法索引，输入输出参数，本地变量，类引用，父帧，子帧</p>\n<p>栈满了就会抛出错误 Error：StackOverflowError 栈溢出</p>\n<h3 id=\"堆heap\"><a class=\"markdownIt-Anchor\" href=\"#堆heap\">#</a> 堆：Heap</h3>\n<p>​\t\t一个 JVM 只有一个堆内存，堆内存大小是可以调节的。</p>\n<p>​\t\t类加载器读取的类文件后，一般会把：类，方法，常量，变量，引用类型的真实对象放到堆中。</p>\n<p>​\t\t堆内存还要细分为三个区域：{</p>\n<p>新生代：Eden Space：</p>\n<p>Survior0 区和 Survior1 区：幸存者 0/1 区</p>\n<p>经过新生代的轻 GC 15 次的考验进入老年代。</p>\n<p>老年代：重量级 Full GC 垃圾回收</p>\n<p>永久代：（1.8 移除）</p>\n<p>GC 垃圾回收集中在新生代和老年代执行。</p>\n<p>假设内存满了，爆出 OOM，堆内存溢出。</p>\n<p>内存溢出代码怎么写：</p>\n<p>利用 while 循环一个字符串无限 += 随机数</p>\n<p>JDK8 以后，永久代被移除，更名为元空间：MetaSpace</p>\n<p>}</p>\n<h4 id=\"详解\"><a class=\"markdownIt-Anchor\" href=\"#详解\">#</a> 详解：</h4>\n<h5 id=\"新生代\"><a class=\"markdownIt-Anchor\" href=\"#新生代\">#</a> 新生代：</h5>\n<p>​\t类：诞生成长的地方，也可能类死亡的地方</p>\n<p>​\tEden 区、幸存者 0 和 1 区，</p>\n<p>​\t所有对象都是在 Eden 区 new 出来的</p>\n<p>​\tEden 区没死亡的对象在幸存者区存活</p>\n<p>​\t如果 Eden 区存储触发了轻 GC 回收机制，就会对 Eden 区进行清除，存活下来对象在幸存区，清除的对象会消失。当 Eden 区和幸存者区都满了之后会执行一次 Full GC，再次存活下来的对象会进入老年代。</p>\n<p>Tips：新生代 99% 都是临时对象！，能进入老年代的对象并不多。所以平时很少见到 OOM 的错误</p>\n<h5 id=\"老年代\"><a class=\"markdownIt-Anchor\" href=\"#老年代\">#</a> 老年代：</h5>\n<p>每次发生轻 GC 会对新生代进行对象清理，当新生代和幸存区的对象在轻 GC 清除下存活 15 次之后，进入老年代</p>\n<p>永久代：用来存放 jdk 自身携带的 calss 对象，interface 元数据，存储的是运行的一些时环境，永久代不存在垃圾回收，关闭 JJVM 虚拟机就会释放永久代内存。</p>\n<p>假设一个启动类，加载了大量的第三方 jar 包，或者一个 tomcat 部署了太多应用，或者大量动态生成的反射类，如果不断的加载，可能会导致永久代内存溢出。</p>\n<p>jdk1.6 之前：永久代，常量池存在于方法区中</p>\n<p>jdk1.7：去永久代，常量池在堆中</p>\n<p>jdk1.8：无永久代，常量池在元空间中</p>\n<p><strong>元空间：</strong></p>\n<p>（方法区）：非堆</p>\n<p>非堆指的是空间上，不属于堆空间；但是由于存储的内容，特性上又被称为堆</p>\n<p>默认情况下：虚拟机被分配到的总内存是电脑内存的 1/4 ，而初始化的内存只有 1/64</p>\n<p>因为与堆共享内存，逻辑上存在，物理上不存在</p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/image-20210908225948384.png\" alt=\"image-20210908225948384\"></p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/image-20210908230652551.png\" alt=\"image-20210908230652551\"></p>\n<p>dump 文件～Jprofiler 插件</p>\n<p>-Xms : 初始化内存</p>\n<p>-Xmx : 最大内存</p>\n<p>-XX:+PrintGCDetails  打印 GC 回收的详细信息</p>\n<p>-XX:+HeapDumpOnOutOfMemoryError 发生 OOM 异常打印 dump 内存快照</p>\n<p>-XX:MaxTenuringReshlod 设置最大存活时间，默认是 15 次</p>\n<p>GC：垃圾回收</p>\n<p>JVM 在进行 GC 时：大部分回收都在新生代，并不是三个区都回收</p>\n<p>新生代</p>\n<p>幸存区（form、to）Survior0、Survior1 区</p>\n<p>老年代</p>\n<p>GC 两个种类：轻 GC（GC）、重 GC（Full GC）</p>\n<p>轻 GC 对新生代和幸存区进行回收</p>\n<p>重 GC 进行全局回收</p>\n<p>如何区分 from 和 to 区：谁空谁是 to 区</p>\n<p>1 . 每次 GC 都会将 Eden 区活的对象移到幸存区中：一旦 Eden 区被 GC 后，就会是空的！</p>\n<p>2 . 当一个对象经历了 15 次 GC，还没有死，就会进入老年代</p>\n<p>-XX:MaxTenuringReshold，通过这个参数可以设定进入老年代的时间（指定在 0~15 次之间）</p>\n<h4 id=\"常用算法\"><a class=\"markdownIt-Anchor\" href=\"#常用算法\">#</a> <strong>常用算法：</strong></h4>\n<p>**1 . 标记清除 **</p>\n<p>分为两步骤：标记 ---- 清除</p>\n<p>标记：扫描，对存活的对象进行标记</p>\n<p>清除：扫描，对没有标记的对象进行清除</p>\n<p>优点：简单，成功率高</p>\n<p>缺点：两次扫描严重耗时，清除会产生内存碎片</p>\n<p><strong>2 .  标记压缩（标记 — 清除 — 压缩）</strong></p>\n<p>标记清除的优化版：防止内存碎片产生</p>\n<p>在标记清除基础上，再次扫描，向一端移动仍存活的对象，清除另一外的碎片</p>\n<p>优点：在标记清除优点上优化了内存碎片</p>\n<p>缺点：对于标记清除又多了一次移动成本，时间增加</p>\n<p><strong>3 .  复制算法</strong>（新生代主要用的复制算法）</p>\n<p>把 from 区向 to 区复制一份，然后清空 from 区，这时 from 区会变成 to 区，复制过去的 to 区变成 from 区等待回收。</p>\n<p>优点：没有内存碎片</p>\n<p>缺点：浪费内存空间（多了一半空间永远是 to 区，假设对象 100% 存活）极端情况下不适用</p>\n<p>复制算法最佳使用场景：对象存活度较低的时候，新生区使用复制算法！</p>\n<p><strong>4 . 分代收集算法：</strong></p>\n<p>​\t\t<strong>由于每个收集算法都无法符合所有的场景，就好比每个对象所在的内存阶段不一样，被回收的概率也不一样，比如在新生代，基本 90% 的对象会被回收，而到了老年代则一半以上的对象存活，所以针对不同的场景，回收的策略也就不一样，所以引出了分代收集算法，根据新生代和老年代不同的场景下使用不同的算法，比如新生代用复制算法，老年代则用标记整理算法</strong></p>\n<p><strong>5.  引用计数器（不高效）</strong></p>\n<p>给每个对象设置计数器，只要有引用就会计数，当一个对象计数器为 0 时，进行回收。缺点：效率低下，现在基本不用</p>\n<h2 id=\"总结\"><a class=\"markdownIt-Anchor\" href=\"#总结\">#</a> 总结：</h2>\n<p>内存效率：复制算法 &gt; 标记清除算法 &gt; 标记压缩（时间复杂度）</p>\n<p>内存整齐度：复制算法 == 标记压缩算法 &gt; 标记清除算法</p>\n<p>内存利用率：标记压缩算法 == 标记清除算法 &gt; 复制算法</p>\n<p>// 思考一个问题：难道没有最优算法吗？</p>\n<p>答案：永远不能有最优算法。只有最合适的算法。</p>\n<p>GC：分代收集算法：根据每个代需求来配置不同算法</p>\n<p>年轻代：存活率低：需求时间短：所以用复制算法</p>\n<p>老年代：存活率高、区域大：标记清除 + 标记压缩混合</p>\n<p>内存碎片不是很多就标记清除，内存碎片太多就用压缩</p>\n<p>JMM：</p>\n<p>1 . 什么是 JMM：Java 内存模型（Java Memory Model）</p>\n<p>2 . JMM 作用：</p>\n<p>3 . 如何学习：</p>\n<p>经历过很多面试大部分都会问一句： 你知道 Java 内存模型么？ 然后我就 pulapula 的说一大堆什么堆呀，栈呀，GC 呀什么的，这段时间把 JVM 虚拟机和多线程编程完整的学习了一遍，发现 JMM 和堆 / 栈这些完全不是一个概念，不知道是不是就是因为这才被拒了十来次的 / 尴尬。</p>\n<p>JVM 是 Java 实现的虚拟计算机（Java Virtual Machine），对于熟悉计算机结构的同学，我感觉把这些概念和物理机对应起来更好理解。</p>\n<p>JVM 对应的就是物理机，它有存放数据的存储区：堆、栈等由 JVM 管理的内存（对应于物理机的内存）、执行数据计算的执行单元：线程（对应于物理机的 CPU）、加速线程执行的本次存储区：可能会从存储区里分配一块空间来存储线程本地数据，比如栈（对应于物理机的 cache）。</p>\n<p>众所周知，现代计算机一般都会包含多个处理器，多个处理器共享主内存。为了提升性能，会在每个处理器上增加一个小容量的 cache 加速数据读写。cache 会导致了缓存一致性问题，为了解决缓存一致性问题又引入了一系列 Cache 一致性协议（比如 MSI、MESI、MOSI、Synapse、Firefly 及 Dragon Protocol）来解决 CPU 本地缓存和主内存数据不一致问题。</p>\n<p>而 JVM 中管理下的存储空间（包括堆、栈等）就对应与物理机的内存；</p>\n<p>线程本次存储区（例如栈）就对应于物理机的 cache；</p>\n<p>而 JMM 就对应于类似于 MSI、MESI、MOSI、Synapse、Firefly 及 Dragon Protocol 这样的缓存一致性协议，用于定义数据读写的规则。</p>\n<p>JMM 相对于物理机的缓存一致性协议来说它还要处理 JVM 自身特有的问题：重排序问题，参见： <span class=\"exturl\" data-url=\"aHR0cDovL2Ntc2Jsb2dzLmNvbS8/cD0yMTE2JUUzJTgwJTgy\">http://cmsblogs.com/?p=2116。</span></p>\n<p>那么 JMM 都有哪些内容呢？</p>\n<p>官方文档： <span class=\"exturl\" data-url=\"aHR0cDovLzEwMS45Ni4xMC42NC93d3cuY3MudW1kLmVkdS9+cHVnaC9qYXZhL21lbW9yeU1vZGVsL0NvbW11bml0eVJldmlldy5wZGY=\">http://101.96.10.64/www.cs.umd.edu/~pugh/java/memoryModel/CommunityReview.pdf</span></p>\n<p>通俗理解就是 happens-before 原则 <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vY2hlbnNzeS9wLzYzOTMzMjEuaHRtbA==\">https://www.cnblogs.com/chenssy/p/6393321.html</span></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/11/%E3%80%90MySQL%E3%80%91MySQL%E4%B8%BB%E4%BB%8E%E5%BC%80%E5%85%B3%E6%9C%BA%E9%A1%BA%E5%BA%8F/",
            "url": "http://example.com/2023/01/11/%E3%80%90MySQL%E3%80%91MySQL%E4%B8%BB%E4%BB%8E%E5%BC%80%E5%85%B3%E6%9C%BA%E9%A1%BA%E5%BA%8F/",
            "title": "【MySQL】MySQL主从开关机顺序",
            "date_published": "2023-01-11T00:50:56.612Z",
            "content_html": "<p>MySQL 主从开关机顺序<br>\n停应用 -&gt; 停数据库（先备后主） -&gt; 改配置 -&gt; 启数据库（先主后备）-&gt; 启应用</p>\n<p>关闭 MySQL 从库<br>\n a. 先查看当前的主从同步状态 show slave statusG; 看是否双 yes<br>\nb. 执行 stop slave<br>\nc. 停止从库服务 mysqladmin shutdown -u 用户名 -p 密码<br>\n d. 查看是否还有 mysql 的进程 ps -ef | grep mysql<br>\nd. 如果部署了多个实例，那每个实例都要按照以上步骤来操作</p>\n<p>关闭 MySQL 主库<br>\n a. 停止主库服务 mysqladmin shutdown -u 用户名 -p 密码<br>\n b. 查看是否还有 mysql 的进程 ps -ef | grep mysql</p>\n<p>启动 MySQL 主库<br>\n a. 启动主库服务 mysqladmin start -u 用户名 -p 密码<br>\n b. 查看 mysql 的进程 ps -ef | grep mysql</p>\n<p>启动 MySQL 从库<br>\n a. 启动从库服务 mysqladmin start -u 用户名 -p 密码<br>\n b. 启动复制 start slave;<br>\nc. 检查同步状态 show slave statusG; 是否双 yes<br>\nd. 查看 mysql 的进程 ps -ef | grep mysql</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/06/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0(%E5%90%90%E8%A1%80%E8%B6%85%E8%AF%A6%E7%BB%86%E6%80%BB%E7%BB%93)/",
            "url": "http://example.com/2023/01/06/Java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0(%E5%90%90%E8%A1%80%E8%B6%85%E8%AF%A6%E7%BB%86%E6%80%BB%E7%BB%93)/",
            "title": "Java多线程学习（吐血超详细总结）",
            "date_published": "2023-01-06T01:27:00.332Z",
            "content_html": "<h1 id=\"java多线程学习吐血超详细总结\"><a class=\"markdownIt-Anchor\" href=\"#java多线程学习吐血超详细总结\">#</a> Java 多线程学习（吐血超详细总结）</h1>\n<p>写在前面的话：此文只能说是 java<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTUlQTQlOUElRTclQkElQkYlRTclQTglOEImYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\"> 多线程</span>的一个入门，其实 Java 里头线程完全可以写一本书了，但是如果最基本的你都学掌握好，又怎么能更上一个台阶呢？如果你觉得此文很简单，那推荐你看看 Java 并发包的的线程池（<span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzUxNDg5MzIy\">Java 并发编程与技术内幕：线程池深入理解</span>），或者看这个专栏：<span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY29sdW1uL2RldGFpbHMvamF2YWhoaWdoY29uY3VycmVuY2UuaHRtbA==\">Java 并发编程与技术内幕</span>。你将会对 Java 里头的高并发场景下的线程有更加深刻的理解。</p>\n<p>目录<span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5Iw==\"> (?)</span>[<span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5Iw==\">-]</span></p>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Qw\">一扩展 javalangThread 类</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Qx\">二实现 javalangRunnable 接口</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Qy\">三 Thread 和 Runnable 的区别</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Qz\">四线程状态转换</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q0\">五线程调度</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q1\">六常用函数说明</span></li>\n<li>\n<ol>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q2\">使用方式</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q3\">为什么要用 join 方法</span></li>\n</ol>\n</li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q4\">七常见线程名词解释</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3Q5\">八线程同步</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzQ0MTUzNzA5I3QxMA==\">九线程数据传递</span></li>\n</ol>\n<p>​    本文主要讲了 java 中多线程的使用方法、线程同步、线程数据传递、线程状态及相应的一些线程函数用法、概述等。在这之前，首先让我们来了解下在操作系统中进程和线程的区别：</p>\n<p><strong>进程：每个进程都有独立的代码和数据空间（进程上下文），进程间的切换会有较大的开销，一个进程包含 1–n 个线程。（进程是资源分配的最小单位）</strong></p>\n<p><strong>线程：同一类线程共享代码和数据空间，每个线程有独立的运行栈和程序计数器 (PC)，线程切换开销小。（线程是 cpu 调度的最小单位）</strong></p>\n<p>线程和进程一样分为五个阶段：创建、就绪、运行、阻塞、终止。</p>\n<p>多进程是指操作系统能同时运行多个任务（程序）。</p>\n<p>多线程是指在同一程序中有多个顺序流在执行。</p>\n<p>在<em> java</em> 中要想实现多线程，有两种手段，一种是继续<em> Thread</em> 类，另外一种是实现<em> Runable</em> 接口.(<strong>其实准确来讲，应该有三种，还有一种是实现 Callable 接口</strong>，并与 Future、线程池结合使用，此文这里不讲这个，有兴趣看这里<span class=\"exturl\" data-url=\"aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZXZhbmtha2EvYXJ0aWNsZS9kZXRhaWxzLzUxNjEwNjM1\"> Java 并发编程与技术内幕：Callable、Future、FutureTask、CompletionService</span> )</p>\n<h1 id=\"一-扩展javalangthread类\"><a class=\"markdownIt-Anchor\" href=\"#一-扩展javalangthread类\">#</a> 一、扩展 java.lang.Thread 类</h1>\n<p>这里继承 Thread 类的方法是比较常用的一种，如果说你只是想起一条线程。没有什么其它特殊的要求，那么可以使用 Thread.（<strong>笔者推荐使用 Runable，后头会说明为什么</strong>）。下面来看一个简单的实例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.multithread.learning;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Thread1</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Thread1</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.name=name;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.println(name + <span class=\"string\">&quot;运行  :  &quot;</span> + i);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                sleep((<span class=\"type\">int</span>) Math.random() * <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh1=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh2=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh1.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh2.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<p>A 运行 : 0<br>\nB 运行 : 0<br>\nA 运行 : 1<br>\nA 运行 : 2<br>\nA 运行 : 3<br>\nA 运行 : 4<br>\nB 运行 : 1<br>\nB 运行 : 2<br>\nB 运行 : 3<br>\nB 运行 : 4</p>\n<p>再运行一下：</p>\n<p>A 运行 : 0<br>\nB 运行 : 0<br>\nB 运行 : 1<br>\nB 运行 : 2<br>\nB 运行 : 3<br>\nB 运行 : 4<br>\nA 运行 : 1<br>\nA 运行 : 2<br>\nA 运行 : 3<br>\nA 运行 : 4</p>\n<p>说明：</p>\n<p>程序启动运行 main 时候，java 虚拟机启动一个进程，主线程 main 在 main () 调用时候被创建。随着调用 MitiSay 的两个对象的 start 方法，另外两个线程也启动了，这样，整个应用就在多线程下运行。</p>\n<p>注意：start () 方法的调用后并不是立即执行多线程代码，而是使得该线程变为可运行态（Runnable），什么时候运行是由操作系统决定的。</p>\n<p>从程序运行的结果可以发现，多线程程序是乱序执行。因此，只有乱序执行的代码才有必要设计为多线程。</p>\n<p>Thread.sleep () 方法调用目的是不让当前线程独自霸占该进程所获取的 CPU 资源，以留出一定时间给其他线程执行的机会。</p>\n<p>实际上所有的多线程代码执行顺序都是不确定的，每次执行的结果都是随机的。</p>\n<p>但是 start 方法重复调用的话，会出现 java.lang.IllegalThreadStateException 异常。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Thread1 mTh1=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Thread1 mTh2=mTh1;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mTh1.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">mTh2.start();</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<p>Exception in thread “main” java.lang.IllegalThreadStateException<br>\nat java.lang.Thread.start(Unknown Source)<br>\nat com.multithread.learning.Main.main(Main.java:31)<br>\n A 运行 : 0<br>\nA 运行 : 1<br>\nA 运行 : 2<br>\nA 运行 : 3<br>\nA 运行 : 4</p>\n<h1 id=\"二-实现javalangrunnable接口\"><a class=\"markdownIt-Anchor\" href=\"#二-实现javalangrunnable接口\">#</a> 二、实现 java.lang.Runnable 接口</h1>\n<p>采用 Runnable 也是非常常见的一种，我们只需要重写 run 方法即可。下面也来看个实例。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@functon</span> 多线程学习</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@author</span> 林炳文</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@time</span> 2015.3.9</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.multithread.runnable;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Thread2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"title function_\">Thread2</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.name=name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t  <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t            System.out.println(name + <span class=\"string\">&quot;运行  :  &quot;</span> + i);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t            \tThread.sleep((<span class=\"type\">int</span>) Math.random() * <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t                e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Thread2</span>(<span class=\"string\">&quot;C&quot;</span>)).start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Thread2</span>(<span class=\"string\">&quot;D&quot;</span>)).start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>输出：</p>\n<p>C 运行 : 0<br>\nD 运行 : 0<br>\nD 运行 : 1<br>\nC 运行 : 1<br>\nD 运行 : 2<br>\nC 运行 : 2<br>\nD 运行 : 3<br>\nC 运行 : 3<br>\nD 运行 : 4<br>\nC 运行 : 4</p>\n<p>说明：</p>\n<p>Thread2 类通过实现 Runnable 接口，使得该类有了多线程类的特征。run（）方法是多线程程序的一个约定。所有的多线程代码都在 run 方法里面。Thread 类实际上也是实现了 Runnable 接口的类。</p>\n<p>在启动的多线程的时候，需要先通过 Thread 类的构造方法 Thread (Runnable target) 构造出对象，然后调用 Thread 对象的 start () 方法来运行多线程代码。</p>\n<p>实际上所有的多线程代码都是通过运行 Thread 的 start () 方法来运行的。因此，不管是扩展 Thread 类还是实现 Runnable 接口来实现多线程，最终还是通过 Thread 的对象的 API 来控制线程的，熟悉 Thread 类的 API 是进行多线程编程的基础。</p>\n<h1 id=\"三-thread和runnable的区别\"><a class=\"markdownIt-Anchor\" href=\"#三-thread和runnable的区别\">#</a> 三、Thread 和 Runnable 的区别</h1>\n<p>如果一个类继承 Thread，则不适合资源共享。但是如果实现了 Runable 接口的话，则很容易的实现资源共享。</p>\n<p>** 总结：<br>\n**</p>\n<p><strong>实现 Runnable 接口比继承 Thread 类所具有的优势：</strong></p>\n<p><strong>1）：适合多个相同的程序代码的线程去处理同一个资源</strong></p>\n<p><strong>2）：可以避免 java 中的单继承的限制</strong></p>\n<p><strong>3）：增加程序的健壮性，代码可以被多个线程共享，代码和数据独立</strong></p>\n<p><strong>4）：线程池只能放入实现 Runable 或 callable 类线程，不能直接放入继承 Thread 的类</strong></p>\n<p><strong><em>* 提醒一下大家：*</em>*<em>main*</em>*<em> 方法其实也是一个线程。在 *</em>*<em>java*</em>*<em> 中所以的线程都是同时启动的，至于什么时候，哪个先执行，完全看谁先得到 *</em>*<em>CPU*</em>*<em> 的资源。*</em></strong></p>\n<p><strong>在<strong><strong> java</strong></strong> 中，每次程序运行至少启动<strong><strong> 2</strong></strong> 个线程。一个是<strong><strong> main</strong></strong> 线程，一个是垃圾收集线程。因为每当使用<strong><strong> java</strong></strong> 命令执行一个类的时候，实际上都会启动一个ＪＶＭ，每一个ｊＶＭ实习在就是在操作系统中启动了一个进程。</strong></p>\n<h1 id=\"四-线程状态转换\"><a class=\"markdownIt-Anchor\" href=\"#四-线程状态转换\">#</a> 四、线程状态转换</h1>\n<p>下面的这个图非常重要！你如果看懂了这个图，那么对于多线程的理解将会更加深刻！</p>\n<p><img data-src=\"https://img-blog.csdn.net/20150309140927553\" alt=\"img\"></p>\n<p>1、新建状态（New）：新创建了一个线程对象。</p>\n<p>2、就绪状态（Runnable）：线程对象创建后，其他线程调用了该对象的 start () 方法。该状态的线程位于可运行线程池中，变得可运行，等待获取 CPU 的使用权。</p>\n<p>3、运行状态（Running）：就绪状态的线程获取了 CPU，执行程序代码。</p>\n<p><strong>4、阻塞状态（Blocked）：阻塞状态是线程因为某种原因放弃 CPU 使用权，暂时停止运行。直到线程进入就绪状态，才有机会转到运行状态。阻塞的情况分三种：</strong></p>\n<p><strong>（一）、等待阻塞：运行的线程执行 wait () 方法，JVM 会把该线程放入等待池中。(wait 会释放持有的锁)</strong></p>\n<p><strong>（二）、同步阻塞：运行的线程在获取对象的同步锁时，若该同步锁被别的线程占用，则 JVM 会把该线程放入锁池中。</strong></p>\n<p><strong>（三）、其他阻塞：运行的线程执行 sleep () 或 join () 方法，或者发出了 I/O 请求时，JVM 会把该线程置为阻塞状态。当 sleep () 状态超时、join () 等待线程终止或者超时、或者 I/O 处理完毕时，线程重新转入就绪状态。（注意，sleep 是不会释放持有的锁）</strong></p>\n<p>5、死亡状态（Dead）：线程执行完了或者因异常退出了 run () 方法，该线程结束生命周期。</p>\n<h1 id=\"五-线程调度\"><a class=\"markdownIt-Anchor\" href=\"#五-线程调度\">#</a> 五、线程调度</h1>\n<p>线程的调度</p>\n<p>1、调整线程优先级：Java 线程有优先级，优先级高的线程会获得较多的运行机会。</p>\n<p>Java 线程的优先级用整数表示，取值范围是 1~10，Thread 类有以下三个静态常量：</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> MAX_PRIORITY</span><br><span class=\"line\">          线程可以具有的最高优先级，取值为<span class=\"number\">10</span>。</span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> MIN_PRIORITY</span><br><span class=\"line\">          线程可以具有的最低优先级，取值为<span class=\"number\">1</span>。</span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> NORM_PRIORITY</span><br><span class=\"line\">          分配给线程的默认优先级，取值为<span class=\"number\">5</span>。</span><br></pre></td></tr></table></figure>\n<p>Thread 类的 setPriority () 和 getPriority () 方法分别用来设置和获取线程的优先级。</p>\n<p>每个线程都有默认的优先级。主线程的默认优先级为 Thread.NORM_PRIORITY。</p>\n<p>线程的优先级有继承关系，比如 A 线程中创建了 B 线程，那么 B 将和 A 具有相同的优先级。</p>\n<p>JVM 提供了 10 个线程优先级，但与常见的操作系统都不能很好的映射。如果希望程序能移植到各个操作系统中，应该仅仅使用 Thread 类有以下三个静态常量作为优先级，这样能保证同样的优先级采用了同样的调度方式。</p>\n<p>2、线程睡眠：Thread.sleep (long millis) 方法，使线程转到阻塞状态。millis 参数设定睡眠的时间，以毫秒为单位。当睡眠结束后，就转为就绪（Runnable）状态。sleep () 平台移植性好。</p>\n<p>3、线程等待：Object 类中的 wait () 方法，导致当前的线程等待，直到其他线程调用此对象的 notify () 方法或 notifyAll () 唤醒方法。这个两个唤醒方法也是 Object 类中的方法，行为等价于调用 wait (0) 一样。</p>\n<p>4、线程让步：Thread.yield () 方法，暂停当前正在执行的线程对象，把执行机会让给相同或者更高优先级的线程。</p>\n<p>5、线程加入：join () 方法，等待其他线程终止。在当前线程中调用另一个线程的 join () 方法，则当前线程转入阻塞状态，直到另一个进程运行结束，当前线程再由阻塞转为就绪状态。</p>\n<p>6、线程唤醒：Object 类中的 notify () 方法，唤醒在此对象监视器上等待的单个线程。如果所有线程都在此对象上等待，则会选择唤醒其中一个线程。选择是任意性的，并在对实现做出决定时发生。线程通过调用其中一个 wait 方法，在对象的监视器上等待。 直到当前的线程放弃此对象上的锁定，才能继续执行被唤醒的线程。被唤醒的线程将以常规方式与在该对象上主动同步的其他所有线程进行竞争；例如，唤醒的线程在作为锁定此对象的下一个线程方面没有可靠的特权或劣势。类似的方法还有一个 notifyAll ()，唤醒在此对象监视器上等待的所有线程。</p>\n<p>注意：Thread 中 suspend () 和 resume () 两个方法在 JDK1.5 中已经废除，不再介绍。因为有死锁倾向。</p>\n<h1 id=\"六-常用函数说明\"><a class=\"markdownIt-Anchor\" href=\"#六-常用函数说明\">#</a> 六、常用函数说明</h1>\n<p>**①sleep (long millis): 在指定的毫秒数内让当前正在执行的线程休眠（暂停执行）</p>\n<p>②join (): 指等待 t 线程终止。**</p>\n<h3 id=\"使用方式\"><a class=\"markdownIt-Anchor\" href=\"#使用方式\">#</a> 使用方式。</h3>\n<p>join 是 Thread 类的一个方法，启动线程后直接调用，即 join () 的作用是：“等待该线程终止”，这里需要理解的就是该线程是指的主线程等待子线程的终止。也就是在子线程调用了 join () 方法后面的代码，只有等到子线程结束了才能执行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AThread</span>(); t.start(); t.join();</span><br></pre></td></tr></table></figure>\n<h3 id=\"为什么要用join方法\"><a class=\"markdownIt-Anchor\" href=\"#为什么要用join方法\">#</a> 为什么要用 join () 方法</h3>\n<p>在很多情况下，主线程生成并起动了子线程，如果子线程里要进行大量的耗时的运算，主线程往往将于子线程之前结束，但是如果主线程处理完其他的事务后，需要用到子线程的处理结果，也就是主线程需要等待子线程执行完成之后再结束，这个时候就要用到 join () 方法了。</p>\n<p>不加 join。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@functon</span> 多线程学习,join</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@author</span> 林炳文</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *<span class=\"doctag\">@time</span> 2015.3.9</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.multithread.join;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Thread1</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> String name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Thread1</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    \t<span class=\"built_in\">super</span>(name);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"built_in\">this</span>.name=name;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; 线程运行开始!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;子线程&quot;</span>+name + <span class=\"string\">&quot;运行 : &quot;</span> + i);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                sleep((<span class=\"type\">int</span>) Math.random() * <span class=\"number\">10</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; 线程运行结束!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;主线程运行开始!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh1=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh2=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh1.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh2.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName()+ <span class=\"string\">&quot;主线程运行结束!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n<p>输出结果：<br>\nmain 主线程运行开始！<br>\nmain 主线程运行结束！<br>\nB 线程运行开始！<br>\n 子线程 B 运行 : 0<br>\nA 线程运行开始！<br>\n 子线程 A 运行 : 0<br>\n 子线程 B 运行 : 1<br>\n 子线程 A 运行 : 1<br>\n 子线程 A 运行 : 2<br>\n 子线程 A 运行 : 3<br>\n 子线程 A 运行 : 4<br>\nA 线程运行结束！<br>\n 子线程 B 运行 : 2<br>\n 子线程 B 运行 : 3<br>\n 子线程 B 运行 : 4<br>\nB 线程运行结束！<br>\n 发现主线程比子线程早结束</p>\n<p>加 join</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;主线程运行开始!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh1=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThread1 mTh2=<span class=\"keyword\">new</span> <span class=\"title class_\">Thread1</span>(<span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh1.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmTh2.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tmTh1.join();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tmTh2.join();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSystem.out.println(Thread.currentThread().getName()+ <span class=\"string\">&quot;主线程运行结束!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行结果：<br>\nmain 主线程运行开始！<br>\nA 线程运行开始！<br>\n 子线程 A 运行 : 0<br>\nB 线程运行开始！<br>\n 子线程 B 运行 : 0<br>\n 子线程 A 运行 : 1<br>\n 子线程 B 运行 : 1<br>\n 子线程 A 运行 : 2<br>\n 子线程 B 运行 : 2<br>\n 子线程 A 运行 : 3<br>\n 子线程 B 运行 : 3<br>\n 子线程 A 运行 : 4<br>\n 子线程 B 运行 : 4<br>\nA 线程运行结束！<br>\n 主线程一定会等子线程都结束了才结束</p>\n<p><strong>③yield (): 暂停当前正在执行的线程对象，并执行其他线程。</strong></p>\n<p>​    Thread.yield () 方法作用是：暂停当前正在执行的线程对象，并执行其他线程。</p>\n<p>​      ****yield () 应该做的是让当前运行线程回到可运行状态，以允许具有相同优先级的其他线程获得运行机会。**** 因此，使用 yield () 的目的是让相同优先级的线程之间能适当的轮转执行。但是，实际中无法保证 yield () 达到让步目的，因为让步的线程还有可能被线程调度程序再次选中。</p>\n<p>结论：yield () 从未导致线程转到等待 / 睡眠 / 阻塞状态。在大多数情况下，yield () 将导致线程从运行状态转到可运行状态，但有可能没有效果。可看上面的图。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *@functon 多线程学习 yield</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *@author 林炳文</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> *@time 2015.3.9</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">package com.multithread.yield;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ThreadYield</span> extends Thread&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ThreadYield</span><span class=\"params\">(String name)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    @<span class=\"function\">Override</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">public</span> <span class=\"type\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">1</span>; i &lt;= <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            System.out.<span class=\"built_in\">println</span>(<span class=\"string\">&quot;&quot;</span> + <span class=\"keyword\">this</span>.<span class=\"built_in\">getName</span>() + <span class=\"string\">&quot;-----&quot;</span> + i);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">// 当i为30时，该线程就会把CPU时间让掉，让其他或者自己的线程执行（也就是谁先抢到谁执行）</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i ==<span class=\"number\">30</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">this</span>.<span class=\"built_in\">yield</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"type\">static</span> <span class=\"type\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t\tThreadYield yt1 = <span class=\"keyword\">new</span> <span class=\"built_in\">ThreadYield</span>(<span class=\"string\">&quot;张三&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    \tThreadYield yt2 = <span class=\"keyword\">new</span> <span class=\"built_in\">ThreadYield</span>(<span class=\"string\">&quot;李四&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        yt1.<span class=\"built_in\">start</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        yt2.<span class=\"built_in\">start</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>运行结果：</p>\n<p>第一种情况：李四（线程）当执行到 30 时会 CPU 时间让掉，这时张三（线程）抢到 CPU 时间并执行。</p>\n<p>第二种情况：李四（线程）当执行到 30 时会 CPU 时间让掉，这时李四（线程）抢到 CPU 时间并执行。</p>\n<p><strong>sleep () 和 yield () 的区别</strong><br>\n sleep () 和 yield () 的区别):sleep () 使当前线程进入停滞状态，所以执行 sleep () 的线程在指定的时间内肯定不会被执行；yield () 只是使当前线程重新回到可执行状态，所以执行 yield () 的线程有可能在进入到可执行状态后马上又被执行。<br>\nsleep 方法使当前运行中的线程睡眼一段时间，进入不可运行状态，这段时间的长短是由程序设定的，yield 方法使当前线程让出 CPU 占有权，但让出的时间是不可设定的。实际上，yield () 方法对应了如下操作：先检测当前是否有相同优先级的线程处于同可运行状态，如有，则把 CPU 的占有权交给此线程，否则，继续运行原来的线程。所以 yield () 方法称为 “退让”，它把运行机会让给了同等优先级的其他线程<br>\n另外，sleep 方法允许较低优先级的线程获得运行机会，但 yield () 方法执行时，当前线程仍处在可运行状态，所以，不可能让出较低优先级的线程些时获得 CPU 占有权。在一个运行系统中，如果较高优先级的线程没有调用 sleep 方法，又没有受到 I\\O 阻塞，那么，较低优先级线程只能等待所有较高优先级的线程运行结束，才有机会运行。</p>\n<p><strong>④setPriority (): 更改线程的优先级。</strong></p>\n<p>MIN_PRIORITY = 1<br>\n　　  NORM_PRIORITY = 5<br>\nMAX_PRIORITY = 10</p>\n<p>用法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Thread4 t1 = new Thread4(&quot;t1&quot;);</span><br><span class=\"line\">Thread4 t2 = new Thread4(&quot;t2&quot;);</span><br><span class=\"line\">t1.setPriority(Thread.MAX_PRIORITY);</span><br><span class=\"line\">t2.setPriority(Thread.MIN_PRIORITY);</span><br></pre></td></tr></table></figure>\n<p><strong><em>*⑤interrupt (): 不要以为它是中断某个线程！它只是线线程发送一个中断信号，让线程在无限等待时（如死锁时）能抛出抛出，从而结束线程，但是如果你吃掉了这个异常，那么 *</em>*<em> 这个线程还是不会中断的！*</em></strong></p>\n<p>⑥wait()</p>\n<p>Obj.wait ()，与 Obj.notify () 必须要与 synchronized (Obj) 一起使用，也就是 wait, 与 notify 是针对已经获取了 Obj 锁进行操作，从语法角度来说就是 Obj.wait (),Obj.notify 必须在 synchronized (Obj){…} 语句块内。从功能上来说 wait 就是说线程在获取对象锁后，主动释放对象锁，同时本线程休眠。直到有其它线程调用对象的 notify () 唤醒该线程，才能继续获取对象锁，并继续执行。相应的 notify () 就是对对象锁的唤醒操作。但有一点需要注意的是 notify () 调用后，并不是马上就释放对象锁的，而是在相应的 synchronized (){} 语句块执行结束，自动释放锁后，JVM 会在 wait () 对象锁的线程中随机选取一线程，赋予其对象锁，唤醒线程，继续执行。这样就提供了在线程间同步、唤醒的操作。Thread.sleep () 与 Object.wait () 二者都可以暂停当前线程，释放 CPU 控制权，主要的区别在于 Object.wait () 在释放 CPU 同时，释放了对象锁的控制。</p>\n<p>单单在概念上理解清楚了还不够，需要在实际的例子中进行测试才能更好的理解。对 Object.wait ()，Object.notify () 的应用最经典的例子，应该是三线程打印 ABC 的问题了吧，这是一道比较经典的面试题，题目要求如下：</p>\n<p>建立三个线程，A 线程打印 10 次 A，B 线程打印 10 次 B,C 线程打印 10 次 C，要求线程同时运行，交替打印 10 次 ABC。这个问题用 Object 的 wait ()，notify () 就可以很方便的解决。代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> * wait用法</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> DreamSea </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@time</span> 2015.3.9 </span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> com.multithread.wait;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThreadPrinter2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object prev;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object self;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"title function_\">MyThreadPrinter2</span><span class=\"params\">(String name, Object prev, Object self)</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.prev = prev;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.self = self;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span>  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (count &gt; <span class=\"number\">0</span>) &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (prev) &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (self) &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    System.out.print(name);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    count--;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    self.notify();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    prev.wait();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                    e.printStackTrace();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">c</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Object</span>();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">MyThreadPrinter2</span> <span class=\"variable\">pa</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThreadPrinter2</span>(<span class=\"string\">&quot;A&quot;</span>, c, a);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">MyThreadPrinter2</span> <span class=\"variable\">pb</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThreadPrinter2</span>(<span class=\"string\">&quot;B&quot;</span>, a, b);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">MyThreadPrinter2</span> <span class=\"variable\">pc</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThreadPrinter2</span>(<span class=\"string\">&quot;C&quot;</span>, b, c);   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">           </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">           </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(pa).start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">100</span>);  <span class=\"comment\">//确保按顺序A、B、C执行</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(pb).start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">100</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(pc).start();   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">100</span>);  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;   </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n<p>输出结果：</p>\n<p>ABCABCABCABCABCABCABCABCABCABC</p>\n<p>先来解释一下其整体思路，从大的方向上来讲，该问题为三线程间的同步唤醒操作，主要的目的就是 ThreadA-&gt;ThreadB-&gt;ThreadC-&gt;ThreadA 循环执行三个线程。为了控制线程执行的顺序，那么就必须要确定唤醒、等待的顺序，所以每一个线程必须同时持有两个对象锁，才能继续执行。一个对象锁是 prev，就是前一个线程所持有的对象锁。还有一个就是自身对象锁。主要的思想就是，为了控制执行的顺序，必须要先持有 prev 锁，也就前一个线程要释放自身对象锁，再去申请自身对象锁，两者兼备时打印，之后首先调用 self.notify () 释放自身对象锁，唤醒下一个等待线程，再调用 prev.wait () 释放 prev 对象锁，终止当前线程，等待循环结束后再次被唤醒。运行上述代码，可以发现三个线程循环打印 ABC，共 10 次。程序运行的主要过程就是 A 线程最先运行，持有 C,A 对象锁，后释放 A,C 锁，唤醒 B。线程 B 等待 A 锁，再申请 B 锁，后打印 B，再释放 B，A 锁，唤醒 C，线程 C 等待 B 锁，再申请 C 锁，后打印 C，再释放 C,B 锁，唤醒 A。看起来似乎没什么问题，但如果你仔细想一下，就会发现有问题，就是初始条件，三个线程按照 A,B,C 的顺序来启动，按照前面的思考，A 唤醒 B，B 唤醒 C，C 再唤醒 A。但是这种假设依赖于 JVM 中线程调度、执行的顺序。<br>\n<strong>wait 和 sleep 区别<br>\n共同点：</strong><br>\n\\1. 他们都是在多线程的环境下，都可以在程序的调用处阻塞指定的毫秒数，并返回。<br>\n\\2. wait () 和 sleep () 都可以通过 interrupt () 方法 打断线程的暂停状态 ，从而使线程立刻抛出 InterruptedException。<br>\n如果线程 A 希望立即结束线程 B，则可以对线程 B 对应的 Thread 实例调用 interrupt 方法。如果此刻线程 B 正在 wait/sleep/join，则线程 B 会立刻抛出 InterruptedException，在 catch () {} 中直接 return 即可安全地结束线程。<br>\n需要注意的是，InterruptedException 是线程自己从内部抛出的，并不是 interrupt () 方法抛出的。对某一线程调用 interrupt () 时，如果该线程正在执行普通的代码，那么该线程根本就不会抛出 InterruptedException。但是，一旦该线程进入到 wait ()/sleep ()/join () 后，就会立刻抛出 InterruptedException 。<br>\n<strong>不同点：</strong><br>\n\\1. Thread 类的方法：sleep (),yield () 等<br>\n Object 的方法：wait () 和 notify () 等<br>\n \\2. 每个对象都有一个锁来控制同步访问。Synchronized 关键字可以和对象的锁交互，来实现线程的同步。<br>\nsleep 方法没有释放锁，而 wait 方法释放了锁，使得其他线程可以使用同步控制块或者方法。<br>\n\\3. wait，notify 和 notifyAll 只能在同步控制方法或者同步控制块里面使用，而 sleep 可以在任何地方使用<br>\n所以 sleep () 和 wait () 方法的最大区别是：<br>\n　　　　sleep () 睡眠时，保持对象锁，仍然占有该锁；<br>\n　　　　而 wait () 睡眠时，释放对象锁。<br>\n　　但是 wait () 和 sleep () 都可以通过 interrupt () 方法打断线程的暂停状态，从而使线程立刻抛出 InterruptedException（但不建议使用该方法）。<br>\n<strong>sleep（）方法</strong><br>\n sleep () 使当前线程进入停滞状态（阻塞当前线程），让出 CUP 的使用、目的是不让当前线程独自霸占该进程所获的 CPU 资源，以留一定时间给其他线程执行的机会；<br>\n　　 sleep () 是 Thread 类的 Static (静态) 的方法；因此他不能改变对象的机锁，所以当在一个 Synchronized 块中调用 Sleep () 方法是，线程虽然休眠了，但是对象的机锁并木有被释放，其他线程无法访问这个对象（即使睡着也持有对象锁）。<br>\n　　在 sleep () 休眠时间期满后，该线程不一定会立即执行，这是因为其它线程可能正在运行而且没有被调度为放弃执行，除非此线程具有更高的优先级。<br>\n<strong>wait（）方法</strong><br>\n wait () 方法是 Object 类里的方法；当一个线程执行到 wait () 方法时，它就进入到一个和该对象相关的等待池中，同时失去（释放）了对象的机锁（暂时失去机锁，wait (long timeout) 超时时间到后还需要返还对象锁）；其他线程可以访问；<br>\n　　wait () 使用 notify 或者 notifyAlll 或者指定睡眠时间来唤醒当前等待池中的线程。<br>\n　　wiat () 必须放在 synchronized block 中，否则会在 program runtime 时扔出”java.lang.IllegalMonitorStateException“异常。</p>\n<h1 id=\"七-常见线程名词解释\"><a class=\"markdownIt-Anchor\" href=\"#七-常见线程名词解释\">#</a> 七、常见线程名词解释</h1>\n<p>主线程：JVM 调用程序 main () 所产生的线程。</p>\n<p>当前线程：这个是容易混淆的概念。一般指通过 Thread.currentThread () 来获取的进程。</p>\n<p>后台线程：指为其他线程提供服务的线程，也称为守护线程。JVM 的垃圾回收线程就是一个后台线程。 <strong>用户线程和守护线程的区别在于，是否等待主线程依赖于主线程结束而结束</strong></p>\n<p>前台线程：是指接受后台线程服务的线程，其实前台后台线程是联系在一起，就像傀儡和幕后操纵者一样的关系。傀儡是前台线程、幕后操纵者是后台线程。由前台线程创建的线程默认也是前台线程。可以通过 isDaemon () 和 setDaemon () 方法来判断和设置一个线程是否为后台线程。</p>\n<p>** 线程类的一些常用方法：</p>\n<p>sleep (): 强迫一个线程睡眠Ｎ毫秒。<br>\n　　isAlive (): 判断一个线程是否存活。<br>\n　　join (): 等待线程终止。<br>\n　　activeCount (): 程序中活跃的线程数。<br>\n　　enumerate (): 枚举程序中的线程。<br>\ncurrentThread (): 得到当前线程。<br>\n　　isDaemon (): 一个线程是否为守护线程。<br>\n　　setDaemon (): 设置一个线程为守护线程。(用户线程和守护线程的区别在于，是否等待主线程依赖于主线程结束而结束)<br>\n　　setName (): 为线程设置一个名称。<br>\n　　wait (): 强迫一个线程等待。<br>\n　　notify (): 通知一个线程继续运行。<br>\n　　setPriority (): 设置一个线程的优先级。<br>\n**</p>\n<h1 id=\"八-线程同步\"><a class=\"markdownIt-Anchor\" href=\"#八-线程同步\">#</a> 八、线程同步</h1>\n<p>1、synchronized 关键字的作用域有二种：<br>\n1）是某个对象实例内，synchronized aMethod (){} 可以防止多个线程同时访问这个对象的 synchronized 方法（如果一个对象有多个 synchronized 方法，只要一个线程访问了其中的一个 synchronized 方法，其它线程不能同时访问这个对象中任何一个 synchronized 方法）。这时，不同的对象实例的 synchronized 方法是不相干扰的。也就是说，其它线程照样可以同时访问相同类的另一个对象实例中的 synchronized 方法；<br>\n2）是某个类的范围，synchronized static aStaticMethod {} 防止多个线程同时访问这个类中的 synchronized static 方法。它可以对类的所有对象实例起作用。</p>\n<p>2、除了方法前用 synchronized 关键字，synchronized 关键字还可以用于方法中的某个区块中，表示只对这个区块的资源实行互斥访问。用法是: synchronized (this){/<em> 区块</em> /}，它的作用域是当前对象；</p>\n<p>3、synchronized 关键字是不能继承的，也就是说，基类的方法 synchronized f (){} 在继承类中并不自动是 synchronized f (){}，而是变成了 f (){}。继承类需要你显式的指定它的某个方法为 synchronized 方法；</p>\n<p>Java 对多线程的支持与同步机制深受大家的喜爱，似乎看起来使用了 synchronized 关键字就可以轻松地解决多线程共享数据同步问题。到底如何？――还得对 synchronized 关键字的作用进行深入了解才可定论。</p>\n<p>总的说来，synchronized 关键字可以作为函数的修饰符，也可作为函数内的语句，也就是平时说的同步方法和同步语句块。如果再细的分类，synchronized 可作用于 instance 变量、object reference（对象引用）、static 函数和 class literals (类名称字面常量) 身上。</p>\n<p>在进一步阐述之前，我们需要明确几点：</p>\n<p>A．无论 synchronized 关键字加在方法上还是对象上，它取得的锁都是对象，而不是把一段代码或函数当作锁――而且同步方法很可能还会被其他线程的对象访问。</p>\n<p>B．每个对象只有一个锁（lock）与之相关联。</p>\n<p>C．实现同步是要很大的系统开销作为代价的，甚至可能造成死锁，所以尽量避免无谓的同步控制。</p>\n<p>接着来讨论 synchronized 用到不同地方对代码产生的影响：</p>\n<p>假设 P1、P2 是同一个类的不同对象，这个类中定义了以下几种情况的同步块或同步方法，P1、P2 就都可以调用它们。</p>\n<p>1． 把 synchronized 当作函数修饰符时，示例代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Public <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">methodAAA</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//….</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这也就是同步方法，那这时 synchronized 锁定的是哪个对象呢？它锁定的是调用这个同步方法对象。也就是说，当一个对象 P1 在不同的线程中执行这个同步方法时，它们之间会形成互斥，达到同步的效果。但是这个对象所属的 Class 所产生的另一对象 P2 却可以任意调用这个被加了 synchronized 关键字的方法。</p>\n<p>上边的示例代码等同于如下代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">methodAAA</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">synchronized</span> (<span class=\"built_in\">this</span>)      <span class=\"comment\">//  (1)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">//…..</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>(1) 处的 this 指的是什么呢？它指的就是调用这个方法的对象，如 P1。可见同步方法实质是将 synchronized 作用于 object reference。――那个拿到了 P1 对象锁的线程，才可以调用 P1 的同步方法，而对 P2 而言，P1 这个锁与它毫不相干，程序也可能在这种情形下摆脱同步机制的控制，造成数据混乱：（</p>\n<p>2．同步块，示例代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">method3</span><span class=\"params\">(SomeObject so)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">              &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">                     <span class=\"keyword\">synchronized</span>(so)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"comment\">//…..</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这时，锁就是 so 这个对象，谁拿到这个锁谁就可以运行它所控制的那段代码。当有一个明确的对象作为锁时，就可以这样写程序，但当没有明确的对象作为锁，只是想让一段代码同步时，可以创建一个特殊的 instance 变量（它得是一个对象）来充当锁：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Foo</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">private</span> <span class=\"type\">byte</span>[] lock = <span class=\"keyword\">new</span> <span class=\"title class_\">byte</span>[<span class=\"number\">0</span>];  <span class=\"comment\">// 特殊的instance变量</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    Public <span class=\"keyword\">void</span> <span class=\"title function_\">methodA</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">synchronized</span>(lock) &#123; <span class=\"comment\">//… &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//…..</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>注：零长度的 byte 数组对象创建起来将比任何对象都经济――查看编译后的字节码：生成零长度的 byte [] 对象只需 3 条操作码，而 Object lock = new Object () 则需要 7 行操作码。</p>\n<p>3．将 synchronized 作用于 static 函数，示例代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Class Foo</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">methodAAA</span><span class=\"params\">()</span>   <span class=\"comment\">// 同步的static 函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//….</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">methodBBB</span><span class=\"params\">()</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">synchronized</span>(Foo.class)   <span class=\"comment\">//  class literal(类名称字面常量)</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<p>代码中的 methodBBB () 方法是把 class literal 作为锁的情况，它和同步的 static 函数产生的效果是一样的，取得的锁很特别，是当前调用这个方法的对象所属的类（Class，而不再是由这个 Class 产生的某个具体对象了）。</p>\n<p>记得在《Effective Java》一书中看到过将 Foo.class 和 P1.getClass () 用于作同步锁还不一样，不能用 P1.getClass () 来达到锁这个 Class 的目的。P1 指的是由 Foo 类产生的对象。</p>\n<p>可以推断：如果一个类中定义了一个 synchronized 的 static 函数 A，也定义了一个 synchronized 的 instance 函数 B，那么这个类的同一对象 Obj 在多线程中分别访问 A 和 B 两个方法时，不会构成同步，因为它们的锁都不一样。A 方法的锁是 Obj 这个对象，而 B 的锁是 Obj 所属的那个 Class。</p>\n<p><strong>总结一下：</strong></p>\n<p>1、线程同步的目的是为了保护多个线程反问一个资源时对资源的破坏。<br>\n2、线程同步方法是通过锁来实现，每个对象都有切仅有一个锁，这个锁与一个特定的对象关联，线程一旦获取了对象锁，其他访问该对象的线程就无法再访问该对象的其他非同步方法<br>\n 3、对于静态同步方法，锁是针对这个类的，锁对象是该类的 Class 对象。静态和非静态方法的锁互不干预。一个线程获得锁，当在一个同步方法中访问另外对象上的同步方法时，会获取这两个对象锁。<br>\n4、对于同步，要时刻清醒在哪个对象上同步，这是关键。<br>\n5、编写线程安全的类，需要时刻注意对多个线程竞争访问资源的逻辑和安全做出正确的判断，对 “原子” 操作做出分析，并保证原子操作期间别的线程无法访问竞争资源。<br>\n6、当多个线程等待一个对象锁时，没有获取到锁的线程将发生阻塞。<br>\n7、死锁是线程间相互等待锁锁造成的，在实际中发生的概率非常的小。真让你写个死锁程序，不一定好使，呵呵。但是，一旦程序发生死锁，程序将死掉。</p>\n<h1 id=\"九-线程数据传递\"><a class=\"markdownIt-Anchor\" href=\"#九-线程数据传递\">#</a> 九、线程数据传递</h1>\n<p>在传统的同步开发模式下，当我们调用一个函数时，通过这个函数的参数将数据传入，并通过这个函数的返回值来返回最终的计算结果。但在多线程的异步开发模式下，数据的传递和返回和同步开发模式有很大的区别。由于线程的运行和结束是不可预料的，因此，在传递和返回数据时就无法象函数一样通过函数参数和 return 语句来返回数据。</p>\n<p>9.1、通过构造方法传递数据<br>\n在创建线程时，必须要建立一个 Thread 类的或其子类的实例。因此，我们不难想到在调用 start 方法之前通过线程类的构造方法将数据传入线程。并将传入的数据使用类变量保存起来，以便线程使用 (其实就是在 run 方法中使用)。下面的代码演示了如何通过构造方法来传递数据：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> mythread; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThread1</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> String name; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">MyThread1</span><span class=\"params\">(String name)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">this</span>.name = name; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;hello &quot;</span> + name); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThread1</span>(<span class=\"string\">&quot;world&quot;</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">thread.start(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>由于这种方法是在创建线程对象的同时传递数据的，因此，在线程运行之前这些数据就就已经到位了，这样就不会造成数据在线程运行后才传入的现象。如果要传递更复杂的数据，可以使用集合、类等数据结构。使用构造方法来传递数据虽然比较安全，但如果要传递的数据比较多时，就会造成很多不便。由于 Java 没有默认参数，要想实现类似默认参数的效果，就得使用重载，这样不但使构造方法本身过于复杂，又会使构造方法在数量上大增。因此，要想避免这种情况，就得通过类方法或类变量来传递数据。</p>\n<p>9.2、通过变量和方法传递数据<br>\n向对象中传入数据一般有两次机会，第一次机会是在建立对象时通过构造方法将数据传入，另外一次机会就是在类中定义一系列的 public 的方法或变量（也可称之为字段）。然后在建立完对象后，通过对象实例逐个赋值。下面的代码是对 MyThread1 类的改版，使用了一个 setName 方法来设置 name 变量：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> mythread; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThread2</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runnable</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> String name; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">this</span>.name = name; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;hello &quot;</span> + name); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">MyThread2</span> <span class=\"variable\">myThread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThread2</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">myThread.setName(<span class=\"string\">&quot;world&quot;</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(myThread); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">thread.start(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>9.3、通过回调函数传递数据</p>\n<p>上面讨论的两种向线程中传递数据的方法是最常用的。但这两种方法都是 main 方法中主动将数据传入线程类的。这对于线程来说，是被动接收这些数据的。然而，在有些应用中需要在线程运行的过程中动态地获取数据，如在下面代码的 run 方法中产生了 3 个随机数，然后通过 Work 类的 process 方法求这三个随机数的和，并通过 Data 类的 value 将结果返回。从这个例子可以看出，在返回 value 之前，必须要得到三个随机数。也就是说，这个 value 是无法事先就传入线程类的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> mythread; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Data</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Work</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">process</span><span class=\"params\">(Data data, Integer numbers)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"type\">int</span> n : numbers) </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">data.value += n; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThread3</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Thread</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> Work work; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"title function_\">MyThread3</span><span class=\"params\">(Work work)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">this</span>.work = work; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">java.util.<span class=\"type\">Random</span> <span class=\"variable\">random</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">java</span>.util.Random(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">Data</span> <span class=\"variable\">data</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Data</span>(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">n1</span> <span class=\"operator\">=</span> random.nextInt(<span class=\"number\">1000</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">n2</span> <span class=\"operator\">=</span> random.nextInt(<span class=\"number\">2000</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"variable\">n3</span> <span class=\"operator\">=</span> random.nextInt(<span class=\"number\">3000</span>); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">work.process(data, n1, n2, n3); <span class=\"comment\">// 使用回调函数 </span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">System.out.println(String.valueOf(n1) + <span class=\"string\">&quot;+&quot;</span> + String.valueOf(n2) + <span class=\"string\">&quot;+&quot;</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">+ String.valueOf(n3) + <span class=\"string\">&quot;=&quot;</span> + data.value); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#123; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">thread</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyThread3</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Work</span>()); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">thread.start(); </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<p>好了，Java 多线程的基础知识就讲到这里了，有兴趣研究多线程的推荐直接看 java 的源码，你将会得到很大的提升！</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/06/Go%E8%AF%AD%E8%A8%80%E8%B6%85%E5%85%A8%E8%AF%A6%E8%A7%A3(%E5%85%A5%E9%97%A8%E7%BA%A7)/",
            "url": "http://example.com/2023/01/06/Go%E8%AF%AD%E8%A8%80%E8%B6%85%E5%85%A8%E8%AF%A6%E8%A7%A3(%E5%85%A5%E9%97%A8%E7%BA%A7)/",
            "title": "",
            "date_published": "2023-01-06T01:22:50.140Z",
            "content_html": "<hr>\n<h2 id=\"titlego语言超全详解入门级\"><a class=\"markdownIt-Anchor\" href=\"#titlego语言超全详解入门级\">#</a> title：Go 语言超全详解（入门级）</h2>\n<h1 id=\"go语言超全详解入门级\"><a class=\"markdownIt-Anchor\" href=\"#go语言超全详解入门级\">#</a> Go 语言超全详解（入门级）</h1>\n<h3 id=\"文章目录\"><a class=\"markdownIt-Anchor\" href=\"#文章目录\">#</a> 文章目录</h3>\n<ul>\n<li><a href=\"#1_Go_6\">1. Go 语言的出现</a></li>\n<li><a href=\"#2_gohello_world_12\">2. go 版本的 hello world</a></li>\n<li><a href=\"#3__36\">3. 数据类型</a></li>\n<li>\n<ul>\n<li><a href=\"#30__48\">3.0 定义变量</a></li>\n<li>\n<ul>\n<li><a href=\"#301__61\">3.0.1 如果变量没有初始化</a></li>\n<li><a href=\"#302__70\">3.0.2 如果变量没有指定类型</a></li>\n<li><a href=\"#303___82\">3.0.3 := 符号</a></li>\n<li><a href=\"#304__94\">3.0.4 多变量声明</a></li>\n<li><a href=\"#305__121\">3.0.5 匿名变量</a></li>\n<li><a href=\"#306__141\">3.0.6 变量作用域</a></li>\n</ul>\n</li>\n<li><a href=\"#31__150\">3.1 基本类型</a></li>\n<li><a href=\"#32__164\">3.2 指针</a></li>\n<li>\n<ul>\n<li><a href=\"#321__169\">3.2.1 指针声明和初始化</a></li>\n<li><a href=\"#322__188\">3.2.2 空指针</a></li>\n</ul>\n</li>\n<li><a href=\"#33__193\">3.3 数组</a></li>\n<li>\n<ul>\n<li><a href=\"#331__196\">3.3.1 声明数组</a></li>\n<li><a href=\"#332__208\">3.3.2 初始化数组</a></li>\n<li><a href=\"#333_go_219\">3.3.3 go 中的数组名意义</a></li>\n<li><a href=\"#334__225\">3.3.4 数组指针</a></li>\n</ul>\n</li>\n<li><a href=\"#34__243\">3.4 结构体</a></li>\n<li>\n<ul>\n<li><a href=\"#341__246\">3.4.1 声明结构体</a></li>\n<li><a href=\"#342__265\">3.4.2 访问结构体成员</a></li>\n<li><a href=\"#343__285\">3.4.3 结构体指针</a></li>\n</ul>\n</li>\n<li><a href=\"#35__297\">3.5 字符串</a></li>\n<li>\n<ul>\n<li><a href=\"#351__301\">3.5.1 字符串定义和初始化</a></li>\n<li><a href=\"#352_UTF8_317\">3.5.2 字符串 UTF8 编码</a></li>\n<li><a href=\"#353__343\">3.5.3 字符串的强制类型转换</a></li>\n</ul>\n</li>\n<li><a href=\"#36_slice_354\">3.6 slice</a></li>\n<li>\n<ul>\n<li><a href=\"#361_slice_359\">3.6.1 slice 定义</a></li>\n<li><a href=\"#362__381\">3.6.2 添加元素</a></li>\n<li><a href=\"#363__428\">3.6.3 删除元素</a></li>\n</ul>\n</li>\n<li><a href=\"#37__491\">3.7 函数</a></li>\n<li>\n<ul>\n<li><a href=\"#371__493\">3.7.1 函数分类</a></li>\n<li><a href=\"#372__521\">3.7.2 函数声明和定义</a></li>\n<li><a href=\"#373__538\">3.7.3 函数传参</a></li>\n<li><a href=\"#374__559\">3.7.4 函数返回值</a></li>\n<li><a href=\"#375__610\">3.7.5 递归调用</a></li>\n</ul>\n</li>\n<li><a href=\"#38__628\">3.8 方法</a></li>\n<li><a href=\"#39__673\">3.9 接口</a></li>\n<li>\n<ul>\n<li><a href=\"#391__674\">3.9.1 什么是接口</a></li>\n<li><a href=\"#392__684\">3.9.2 结构体类型</a></li>\n<li><a href=\"#393__738\">3.9.3 具体类型向接口类型赋值</a></li>\n<li><a href=\"#394__749\">3.9.4 获取接口类型数据的具体类型信息</a></li>\n</ul>\n</li>\n<li><a href=\"#310_channel_754\">3.10 channel</a></li>\n<li>\n<ul>\n<li><a href=\"#3101__755\">3.10.1 相关结构体定义</a></li>\n<li><a href=\"#3102_channel_794\">3.10.2 阻塞式读写 channel 操作</a></li>\n<li><a href=\"#3103_channel_826\">3.10.3 非阻塞式读写 channel 操作</a></li>\n</ul>\n</li>\n<li><a href=\"#311_map_855\">3.11 map</a></li>\n<li>\n<ul>\n<li><a href=\"#3111__944\">3.11.1 插入数据</a></li>\n<li><a href=\"#3112__957\">3.11.2 删除数据</a></li>\n<li><a href=\"#3113__966\">3.11.3 查找数据</a></li>\n<li><a href=\"#3114__980\">3.11.4 扩容</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#4__1012\">4. 常用语句及关键字</a></li>\n<li>\n<ul>\n<li><a href=\"#41__1014\">4.1 条件语句</a></li>\n<li><a href=\"#42__1078\">4.2 循环语句</a></li>\n<li>\n<ul>\n<li><a href=\"#421__1079\">4.2.1 循环处理语句</a></li>\n<li><a href=\"#421__1095\">4.2.1 循环控制语句</a></li>\n</ul>\n</li>\n<li><a href=\"#43__1200\">4.3 关键字</a></li>\n</ul>\n</li>\n</ul>\n<hr>\n<h1 id=\"1-go语言的出现\"><a class=\"markdownIt-Anchor\" href=\"#1-go语言的出现\">#</a> 1. Go 语言的出现</h1>\n<p>在具体学习 go 语言的基础语法之前，我们来了解一下 go 语言出现的时机及其特点。</p>\n<p>Go 语言最初由 Google 公司的 Robert Griesemer、Ken Thompson 和 Rob Pike 三个大牛于 2007 年开始设计发明，他们最终的目标是设计一种<strong>适应网络和多核时代的 C 语言</strong>。所以 Go 语言很多时候被描述为 “类 C 语言”，或者是 “21 世纪的 C 语言”，当然从各种角度看，Go 语言确实是从 C 语言继承了相似的表达式语法、控制流结构、基础数据类型、调用参数传值、指针等诸多编程思想。但是 Go 语言更是对 C 语言最彻底的一次扬弃，它舍弃了 C 语言中灵活但是危险的指针运算，还重新设计了 C 语言中部分不太合理运算符的优先级，并在很多细微的地方都做了必要的打磨和改变。</p>\n<h1 id=\"2-go版本的hello-world\"><a class=\"markdownIt-Anchor\" href=\"#2-go版本的hello-world\">#</a> 2. go 版本的 hello world</h1>\n<p>在这一部分我们只是使用 “hello world” 的程序来向大家介绍一下 go 语言的所编写的程序的基本组成。</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">package main</span><br><span class=\"line\">import <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\">func <span class=\"title function_\">main</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 终端输出hello world</span></span><br><span class=\"line\">\tfmt.Println(<span class=\"string\">&quot;Hello world!&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n<p>和 C 语言相似，go 语言的基本组成有：</p>\n<ul>\n<li>包声明，编写源文件时，必须在非注释的第一行指明这个文件属于哪个包，如 <code>package main</code> 。</li>\n<li>引入包，其实就是告诉 Go 编译器这个程序需要使用的包，如 <code>import &quot;fmt&quot;</code>  其实就是引入了 fmt 包。</li>\n<li>函数，和 c 语言相同，即是一个可以实现某一个功能的函数体，每一个可执行程序中必须拥有一个 main 函数。</li>\n<li>变量，Go 语言变量名由字母、数字、下划线组成，其中首个字符不能为数字。</li>\n<li>语句 / 表达式，在 Go 程序中，一行代表一个语句结束。每个语句不需要像 C 家族中的其它语言一样以分号；结尾，因为这些工作都将由 Go 编译器自动完成。</li>\n<li>注释，和 c 语言中的注释方式相同，可以在任何地方使用以 // 开头的单行注释。以 /* 开头，并以 */ 结尾来进行多行注释，且不可以嵌套使用，多行注释一般用于包的文档描述或注释成块的代码片段。</li>\n</ul>\n<blockquote>\n<p>需要注意的是：<strong>标识符</strong>是用来命名变量、类型等程序实体。一个标识符实际上就是一个或是多个字母和数字、下划线_组成的序列，但是第一个字符必须是字母或下划线而不能是数字。</p>\n<ol>\n<li>当标识符（包括常量、变量、类型、函数名、结构字段等等）以一个大写字母开头，如：Group1，那么使用这种形式的标识符的对象就可以被外部包的代码所使用（客户端程序需要先导入这个包），这被称为导出（像面向对象语言中的 public）；</li>\n<li>标识符如果以小写字母开头，则对包外是不可见的，但是他们在整个包的内部是可见并且可用的（像面向对象语言中的 protected）。</li>\n</ol>\n</blockquote>\n<h1 id=\"3-数据类型\"><a class=\"markdownIt-Anchor\" href=\"#3-数据类型\">#</a> 3. 数据类型</h1>\n<p>在 Go 编程语言中，数据类型用于声明函数和变量。</p>\n<p>数据类型的出现是为了把数据分成所需内存大小不同的数据，编程的时候需要用大数据的时候才需要申请大内存，就可以充分利用内存。具体分类如下：</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>详解</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>布尔型</td>\n<td>布尔型的值只可以是常量 true 或者 false。</td>\n</tr>\n<tr>\n<td>数字类型</td>\n<td>整型 int 和浮点型 float。Go 语言支持整型和浮点型数字，并且支持复数，其中位的运算采用补码。</td>\n</tr>\n<tr>\n<td>字符串类型</td>\n<td>字符串就是一串固定长度的字符连接起来的字符序列。Go 的字符串是由单个字节连接起来的。Go 语言的字符串的字节使用 UTF-8 编码标识 Unicode 文本。</td>\n</tr>\n<tr>\n<td>派生类型</td>\n<td>(a) 指针类型（Pointer）(b) 数组类型 © 结构化类型 (struct)(d) Channel 类型 (e) 函数类型 (f) 切片类型 (g) 接口类型（interface）(h) Map 类型</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"30-定义变量\"><a class=\"markdownIt-Anchor\" href=\"#30-定义变量\">#</a> 3.0 定义变量</h2>\n<p>声明变量的一般形式是使用 var 关键字，具体格式为： <code>var identifier typename</code> 。如下的代码中我们定义了一个类型为 int 的变量。</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> a <span class=\"type\">int</span> = <span class=\"number\">27</span></span><br><span class=\"line\">\tfmt.Println(a);</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"><span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"301-如果变量没有初始化\"><a class=\"markdownIt-Anchor\" href=\"#301-如果变量没有初始化\">#</a> 3.0.1 如果变量没有初始化</h3>\n<p>在 go 语言中定义了一个变量，指定变量类型，如果没有初始化，则变量默认为零值。<strong>零值就是变量没有做初始化时系统默认设置的值</strong>。</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>零值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>数值类型</td>\n<td>0</td>\n</tr>\n<tr>\n<td>布尔类型</td>\n<td>false</td>\n</tr>\n<tr>\n<td>字符串</td>\n<td>“”（空字符串）</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"302-如果变量没有指定类型\"><a class=\"markdownIt-Anchor\" href=\"#302-如果变量没有指定类型\">#</a> 3.0.2 如果变量没有指定类型</h3>\n<p>在 go 语言中如果没有指定变量类型，可以通过变量的初始值来判断变量类型。如下代码</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> d = <span class=\"literal\">true</span></span><br><span class=\"line\">    fmt.Println(d)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"303-符号\"><a class=\"markdownIt-Anchor\" href=\"#303-符号\">#</a> 3.0.3 := 符号</h3>\n<p>当我们定义一个变量后又使用该符号初始化变量，就会产生编译错误，因为该符号其实是一个声明语句。</p>\n<p>使用格式： <code>typename := value</code></p>\n<p>也就是说 <code>intVal := 1</code>  相等于：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> intVal <span class=\"type\">int</span> </span><br><span class=\"line\">intVal =<span class=\"number\">1</span> </span><br><span class=\"line\"><span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"304-多变量声明\"><a class=\"markdownIt-Anchor\" href=\"#304-多变量声明\">#</a> 3.0.4 多变量声明</h3>\n<p>可以同时声明多个类型相同的变量（非全局变量），如下图所示：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> x, y <span class=\"type\">int</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> c, d <span class=\"type\">int</span> = <span class=\"number\">1</span>, <span class=\"number\">2</span></span><br><span class=\"line\">g, h := <span class=\"number\">123</span>, <span class=\"string\">&quot;hello&quot;</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<p>关于全局变量的声明如下：<br>\n <code>var ( vname1 v_type1 vname2 v_type2 )</code> <br>\n 具体举例如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ( </span><br><span class=\"line\">    a <span class=\"type\">int</span></span><br><span class=\"line\">    b <span class=\"type\">bool</span></span><br><span class=\"line\">)</span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"305-匿名变量\"><a class=\"markdownIt-Anchor\" href=\"#305-匿名变量\">#</a> 3.0.5 匿名变量</h3>\n<p>匿名变量的特点是一个下画线 <code>_</code> ，这本身就是一个特殊的标识符，被称为空白标识符。它可以像其他标识符那样用于变量的声明或赋值（任何类型都可以赋值给它），但任何赋给这个标识符的值都将被抛弃，因此这些值<strong>不能在后续的代码中使用</strong>，也不可以使用这个标识符作为变量对其它变量进行赋值或运算。</p>\n<p>使用匿名变量时，只需要在<strong>变量声明的地方</strong>使用下画线替换即可。</p>\n<p>示例代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">GetData</span><span class=\"params\">()</span></span> (<span class=\"type\">int</span>, <span class=\"type\">int</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">10</span>, <span class=\"number\">20</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        a, _ := GetData()</span><br><span class=\"line\">        _, b := GetData()</span><br><span class=\"line\">        fmt.Println(a, b)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"><span class=\"number\">12345678</span></span><br></pre></td></tr></table></figure>\n<p>需要注意的是匿名变量不占用内存空间，不会分配内存。匿名变量与匿名变量之间也不会因为多次声明而无法使用。</p>\n<h3 id=\"306-变量作用域\"><a class=\"markdownIt-Anchor\" href=\"#306-变量作用域\">#</a> 3.0.6 变量作用域</h3>\n<p>作用域指的是已声明的标识符所表示的常量、类型、函数或者包在源代码中的作用范围，在此我们主要看一下 go 中变量的作用域，根据变量定义位置的不同，可以分为一下三个类型：</p>\n<ol>\n<li>函数内定义的变量为<strong>局部变量</strong>，这种局部变量的作用域只在函数体内，函数的参数和返回值变量都属于局部变量。这种变量在存在于函数被调用时，销毁于函数调用结束后。</li>\n<li>函数外定义的变量为<strong>全局变量</strong>，全局变量只需要在一个源文件中定义，就可以在所有源文件中使用，甚至可以使用 import 引入外部包来使用。全局变量声明必须<strong>以 var 关键字开头</strong>，如果想要在<strong>外部包中使用</strong>全局变量的<strong>首字母必须大写</strong>。</li>\n<li>函数定义中的变量成为<strong>形式参数</strong>，定义函数时函数名后面括号中的变量叫做形式参数（简称形参）。形式参数只在函数调用时才会生效，函数调用结束后就会被销毁，在函数未被调用时，函数的形参并不占用实际的存储单元，也没有实际值。<strong>形式参数会作为函数的局部变量来使用</strong>。</li>\n</ol>\n<h2 id=\"31-基本类型\"><a class=\"markdownIt-Anchor\" href=\"#31-基本类型\">#</a> 3.1 基本类型</h2>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>uint8 / uint16 / uint32 / uint64</td>\n<td>无符号 8 / 16 / 32 / 64 位整型</td>\n</tr>\n<tr>\n<td>int8 / int16 / int32 / int64</td>\n<td>有符号 8 / 16 / 32 / 64 位整型</td>\n</tr>\n<tr>\n<td>float32 / float64</td>\n<td>IEEE-754 32 / 64 位浮点型数</td>\n</tr>\n<tr>\n<td>complex64 / complex128</td>\n<td>32 / 64 位实数和虚数</td>\n</tr>\n<tr>\n<td>byte</td>\n<td>类似 uint8</td>\n</tr>\n<tr>\n<td>rune</td>\n<td>类似 int32</td>\n</tr>\n<tr>\n<td>uintptr</td>\n<td>无符号整型，用于存放一个指针</td>\n</tr>\n</tbody>\n</table>\n<p>以上就是 go 语言基本的数据类型，有了数据类型，我们就可以使用这些类型来定义变量，Go 语言变量名由字母、数字、下划线组成，其中首个字符不能为数字。</p>\n<h2 id=\"32-指针\"><a class=\"markdownIt-Anchor\" href=\"#32-指针\">#</a> 3.2 指针</h2>\n<p>与 C 相同，Go 语言让程序员决定何时使用指针。变量其实是一种使用方便的占位符，用于引用计算机内存地址。Go 语言中的的取地址符是 <code>&amp;</code> ，放到一个变量前使用就会返回相应变量的内存地址。</p>\n<p>指针变量其实就是用于存放某一个对象的内存地址。</p>\n<h3 id=\"321-指针声明和初始化\"><a class=\"markdownIt-Anchor\" href=\"#321-指针声明和初始化\">#</a> 3.2.1 指针声明和初始化</h3>\n<p>和基础类型数据相同，在使用指针变量之前我们首先需要申明指针，声明格式如下： <code>var var_name *var-type</code> ，其中的 var-type 为指针类型，var_name 为指针变量名，* 号用于指定变量是作为一个指针。</p>\n<p>代码举例如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> ip *<span class=\"type\">int</span>        <span class=\"comment\">/* 指向整型*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> fp *<span class=\"type\">float32</span>    <span class=\"comment\">/* 指向浮点型 */</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>指针的初始化就是取出相对应的变量地址对指针进行赋值，具体如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   <span class=\"keyword\">var</span> a <span class=\"type\">int</span>= <span class=\"number\">20</span>   <span class=\"comment\">/* 声明实际变量 */</span></span><br><span class=\"line\">   <span class=\"keyword\">var</span> ip *<span class=\"type\">int</span>        <span class=\"comment\">/* 声明指针变量 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">   ip = &amp;a  <span class=\"comment\">/* 指针变量的存储地址 */</span></span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"322-空指针\"><a class=\"markdownIt-Anchor\" href=\"#322-空指针\">#</a> 3.2.2 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclQTklQkElRTYlOEMlODclRTklOTIlODgmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\">空指针</span></h3>\n<p>当一个指针被定义后<strong>没有分配到任何变量</strong>时，它的值为 <strong>nil</strong>，也称为空指针。它概念上和其它语言的 null、NULL 一样，都指代零值或空值。</p>\n<h2 id=\"33-数组\"><a class=\"markdownIt-Anchor\" href=\"#33-数组\">#</a> 3.3 数组</h2>\n<p>和 c 语言相同，Go 语言也提供了数组类型的数据结构，数组是具有<strong>相同唯一类型</strong>的一组已编号且<strong>长度固定</strong>的数据项序列，这种类型可以是任意的原始类型例如整型、字符串或者自定义类型。</p>\n<h3 id=\"331-声明数组\"><a class=\"markdownIt-Anchor\" href=\"#331-声明数组\">#</a> 3.3.1 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTUlQTMlQjAlRTYlOTglOEUlRTYlOTUlQjAlRTclQkIlODQmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\">声明数组</span></h3>\n<p>Go 语言数组声明需要指定元素类型及元素个数，语法格式如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var variable_name [SIZE] variable_type</span><br></pre></td></tr></table></figure>\n<p>以上就可以定一个一维数组，我们举例代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> balance [<span class=\"number\">10</span>] <span class=\"type\">float32</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"332-初始化数组\"><a class=\"markdownIt-Anchor\" href=\"#332-初始化数组\">#</a> 3.3.2 初始化数组</h3>\n<p>数组的初始化方式有不止一种方式，我们列举如下：</p>\n<ol>\n<li>直接进行初始化： <code>var balance = [5]float32&#123;1000.0, 2.0, 3.4, 7.0, 50.0&#125;</code></li>\n<li>通过字面量在声明数组的同时快速初始化数组： <code>balance := [5]float32&#123;1000.0, 2.0, 3.4, 7.0, 50.0&#125;</code></li>\n<li>数组长度不确定，编译器通过元素个数自行推断数组长度，在 [ ] 中填入 <code>...</code> ，举例如下： <code>var balance = [...]float32&#123;1000.0, 2.0, 3.4, 7.0, 50.0&#125;</code>  和 <code>balance := [...]float32&#123;1000.0, 2.0, 3.4, 7.0, 50.0&#125;</code></li>\n<li>数组长度确定，指定下标进行部分初始化： <code>balanced := [5]float32(1:2.0, 3:7.0)</code></li>\n</ol>\n<blockquote>\n<p>注意：</p>\n<ul>\n<li>初始化数组中 {} 中的元素个数不能大于 [] 中的数字。<br>\n如果忽略 [] 中的数字不设置数组大小，Go 语言会根据元素的个数来设置数组的大小。</li>\n</ul>\n</blockquote>\n<h3 id=\"333-go中的数组名意义\"><a class=\"markdownIt-Anchor\" href=\"#333-go中的数组名意义\">#</a> 3.3.3 go 中的数组名意义</h3>\n<p>在 c 语言中我们知道数组名在本质上是数组中第一个元素的地址，而在 go 语言中，数组名仅仅表示整个数组，是一个完整的值，一个数组变量即是表示整个数组。</p>\n<p>所以在 go 中一个数组变量被赋值或者被传递的时候实际上就会复制整个数组。如果数组比较大的话，这种复制往往会占有很大的开销。所以为了避免这种开销，往往需要传递一个指向数组的指针，这个数组指针并不是数组。关于数组指针具体在指针的部分深入的了解。</p>\n<h3 id=\"334-数组指针\"><a class=\"markdownIt-Anchor\" href=\"#334-数组指针\">#</a> 3.3.4 数组指针</h3>\n<p>通过数组和指针的知识我们就可以定义一个数组指针，代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = [...]<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125; <span class=\"comment\">// a 是一个数组</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> b = &amp;a                <span class=\"comment\">// b 是指向数组的指针</span></span><br><span class=\"line\"><span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p>数组指针除了可以防止数组作为参数传递的时候浪费空间，还可以利用其和 <code>for range</code>  来遍历数组，具体代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> i, v := <span class=\"keyword\">range</span> b &#123;     <span class=\"comment\">// 通过数组指针迭代数组的元素</span></span><br><span class=\"line\">    fmt.Println(i, v)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<p>具体关于 go 语言的循环语句我们在后文中再进行详细介绍。</p>\n<h2 id=\"34-结构体\"><a class=\"markdownIt-Anchor\" href=\"#34-结构体\">#</a> 3.4 结构体</h2>\n<p>通过上述数组的学习，我们就可以直接定义多个同类型的变量，但这往往也是一种限制，只能存储同一种类型的数据，而我们在结构体中就可以定义多个不同的数据类型。</p>\n<h3 id=\"341-声明结构体\"><a class=\"markdownIt-Anchor\" href=\"#341-声明结构体\">#</a> 3.4.1 声明结构体</h3>\n<p>在声明结构体之前我们首先需要定义一个结构体类型，这需要使用 type 和 struct，type 用于设定结构体的名称，struct 用于定义一个新的数据类型。具体结构如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> struct_variable_type <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">   member definition</span><br><span class=\"line\">   member definition</span><br><span class=\"line\">   ...</span><br><span class=\"line\">   member definition</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n<p>定义好了结构体类型，我们就可以使用该结构体声明这样一个结构体变量，语法如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">variable_name := structure_variable_type &#123;value1, value2...valuen&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">variable_name := structure_variable_type &#123; key1: value1, key2: value2..., keyn: valuen&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"342-访问结构体成员\"><a class=\"markdownIt-Anchor\" href=\"#342-访问结构体成员\">#</a> 3.4.2 访问结构体成员</h3>\n<p>如果要访问结构体成员，需要使用点号  <code>.</code>  操作符，格式为： <code>结构体变量名.成员名</code> 。举例代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> main</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&quot;fmt&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> Books <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">   title <span class=\"type\">string</span></span><br><span class=\"line\">   author <span class=\"type\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> book1 Books</span><br><span class=\"line\">\tBook1.title = <span class=\"string\">&quot;Go 语言入门&quot;</span></span><br><span class=\"line\">\tBook1.author = <span class=\"string\">&quot;mars.hao&quot;</span>\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">1234567891011121314</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"343-结构体指针\"><a class=\"markdownIt-Anchor\" href=\"#343-结构体指针\">#</a> 3.4.3 结构体指针</h3>\n<p>关于结构体指针的定义和申明同样可以套用前文中讲到的指针的相关定义，从而使用一个指针变量存放一个结构体变量的地址。</p>\n<p>定义一个结构体变量的语法： <code>var struct_pointer *Books</code> 。</p>\n<p>这种指针变量的初始化和上文指针部分的初始化方式相同 <code>struct_pointer = &amp;Book1</code> ，但是和 c 语言中有所不同，使用结构体指针访问结构体成员仍然使用 <code>.</code>  操作符。格式如下： <code>struct_pointer.title</code></p>\n<h2 id=\"35-字符串\"><a class=\"markdownIt-Anchor\" href=\"#35-字符串\">#</a> 3.5 字符串</h2>\n<p>一个字符串是一个<strong>不可改变</strong>的字节序列，字符串通常是用来包含人类可读的文本数据。和数组不同的是，字符串的元素不可修改，是一个只读的<strong>字节数组</strong>。每个字符串的长度虽然也是固定的，但是字符串的长度并不是字符串类型的一部分。</p>\n<h3 id=\"351-字符串定义和初始化\"><a class=\"markdownIt-Anchor\" href=\"#351-字符串定义和初始化\">#</a> 3.5.1 字符串定义和初始化</h3>\n<p>Go 语言字符串的底层结构在 reflect.StringHeader 中定义，具体如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> StringHeader <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Data <span class=\"type\">uintptr</span></span><br><span class=\"line\">    Len  <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<p>也就是说字符串结构由两个信息组成：第一个是字符串指向的底层字节数组，第二个是字符串的字节的长度。</p>\n<p>字符串其实是一个结构体，因此字符串的赋值操作也就是 reflect.StringHeader 结构体的复制过程，并不会涉及底层字节数组的复制，所以我们也可以将字符串数组看作一个结构体数组。</p>\n<p>字符串和数组类似，内置的 len 函数返回字符串的长度。</p>\n<h3 id=\"352-字符串utf8编码\"><a class=\"markdownIt-Anchor\" href=\"#352-字符串utf8编码\">#</a> 3.5.2 字符串 UTF8 编码</h3>\n<p>根据 Go 语言规范，Go 语言的源文件都是采用<strong> UTF8</strong> 编码。因此，Go 源文件中出现的字符串面值常量一般也是 UTF8 编码的（对于转义字符，则没有这个限制）。提到 Go 字符串时，我们一般都会假设字符串对应的是一个合法的 UTF8 编码的字符序列。</p>\n<p>Go 语言的字符串中可以存放任意的二进制字节序列，而且即使是 UTF8 字符序列也可能会遇到坏的编码。如果遇到一个<strong>错误的 UTF8 编码输入</strong>，将生成一个<strong>特别的 Unicode 字符</strong>‘\\uFFFD’，这个字符在不同的软件中的显示效果可能不太一样，在印刷中这个符号通常是一个黑色六角形或钻石形状，里面包含一个白色的问号‘ ’。</p>\n<p>下面的字符串中，我们故意损坏了第一字符的第二和第三字节，因此第一字符将会打印为 “”，第二和第三字节则被忽略；后面的 “abc” 依然可以正常解码打印（<strong>错误编码不会向后扩散是 UTF8 编码的优秀特性之一</strong>）。代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fmt.Println(<span class=\"string\">&quot;\\xe4\\x00\\x00\\xe7\\x95\\x8cabc&quot;</span>) <span class=\"comment\">//  界abc</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>不过在 for range 迭代这个含有损坏的 UTF8 字符串时，第一字符的第二和第三字节依然会被单独迭代到，不过此时迭代的值是损坏后的 0：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 0 65533  // \\uFFFD, 对应  </span></span><br><span class=\"line\"><span class=\"comment\">// 1 0      // 空字符</span></span><br><span class=\"line\"><span class=\"comment\">// 2 0      // 空字符</span></span><br><span class=\"line\"><span class=\"comment\">// 3 30028  // 界</span></span><br><span class=\"line\"><span class=\"comment\">// 6 97     // a</span></span><br><span class=\"line\"><span class=\"comment\">// 7 98     // b</span></span><br><span class=\"line\"><span class=\"comment\">// 8 99     // c</span></span><br><span class=\"line\"><span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"353-字符串的强制类型转换\"><a class=\"markdownIt-Anchor\" href=\"#353-字符串的强制类型转换\">#</a> 3.5.3 字符串的强制类型转换</h3>\n<p>在上文中我们知道源代码往往会采用 UTF8 编码，如果不想解码 UTF8 字符串，想直接遍历原始的字节码：</p>\n<ol>\n<li>可以将字符串强制转为 [] byte 字节序列后再行遍历（这里的转换一般不会产生运行时开销）：</li>\n<li>采用传统的下标方式遍历字符串的字节数组</li>\n</ol>\n<p>除此以外，字符串相关的强制类型转换主要<strong>涉及到 [] byte 和 [] rune 两种类型</strong>。每个转换都可能隐含<strong>重新分配内存</strong>的代价，最坏的情况下它们的运算时间复杂度都是 O (n)。</p>\n<p>不过字符串和 [] rune 的转换要更为特殊一些，因为一般这种强制类型转换要求两个类型的底层内存结构要尽量一致，显然它们底层对应的 [] byte 和 [] int32 类型是完全不同的内部布局，因此这种转换可能隐含重新分配内存的操作。</p>\n<h2 id=\"36-slice\"><a class=\"markdownIt-Anchor\" href=\"#36-slice\">#</a> 3.6 slice</h2>\n<p>简单地说，切片就是一种简化版的<strong>动态数组</strong>。因为动态数组的<strong>长度不固定</strong>，切片的长度自然也就不能是类型的组成部分了。数组虽然有适用它们的地方，但是数组的类型和操作都不够灵活，而切片则使用得相当广泛。</p>\n<p>切片高效操作的要点是要降低内存分配的次数，尽量保证 append 操作（在后续的插入和删除操作中都涉及到这个函数）不会超出 cap 的容量，降低触发内存分配的次数和每次分配内存大小。</p>\n<h3 id=\"361-slice定义\"><a class=\"markdownIt-Anchor\" href=\"#361-slice定义\">#</a> 3.6.1 slice 定义</h3>\n<p>我们先看看切片的结构定义，reflect.SliceHeader：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> SliceHeader <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Data <span class=\"type\">uintptr</span>   <span class=\"comment\">// 指向底层的的数组指针</span></span><br><span class=\"line\">    Len  <span class=\"type\">int</span>\t   <span class=\"comment\">// 切片长度</span></span><br><span class=\"line\">    Cap  <span class=\"type\">int</span>\t   <span class=\"comment\">// 切片最大长度</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n<p>和数组一样，内置的 len 函数返回切片中有效元素的长度，内置的 cap 函数返回切片容量大小，容量必须大于或等于切片的长度。</p>\n<p>切片可以和<strong> nil</strong> 进行比较，只有当切片<strong>底层数据指针为空时</strong>切片本身为 nil，这时候<strong>切片的长度和容量信息将是无效的</strong>。如果有切片的底层数据指针为空，但是长度和容量不为 0 的情况，那么说明切片本身已经被损坏了</p>\n<p>只要是<strong>切片的底层</strong>数据指针、长度和容量<strong>没有发生变化</strong>的话，对切片的遍历、元素的读取和修改都和数组是一样的。在对切片本身赋值或参数传递时，和数组指针的操作方式类似，只是复制切片头信息（reflect.SliceHeader），并不会复制底层的数据。对于类型，和数组的最大不同是，切片的类型和长度信息无关，只要是相同类型元素构成的切片均对应相同的切片类型。</p>\n<p>当我们想定义声明一个切片时可以如下：</p>\n<p>在对切片本身赋值或参数传递时，和数组指针的操作方式类似，只是复制切片头信息・（reflect.SliceHeader），并不会复制底层的数据。对于类型，和数组的最大不同是，切片的类型和长度信息无关，<strong>只要是相同类型元素构成的切片均对应相同的切片类型</strong>。</p>\n<h3 id=\"362-添加元素\"><a class=\"markdownIt-Anchor\" href=\"#362-添加元素\">#</a> 3.6.2 添加元素</h3>\n<p><code>append()</code>  ：内置的泛型函数，可以向切片中增加元素。</p>\n<ol>\n<li>在切片尾部追加 N 个元素</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a []<span class=\"type\">int</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a, <span class=\"number\">1</span>)               <span class=\"comment\">// 追加1个元素</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a, <span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)         <span class=\"comment\">// 追加多个元素, 手写解包方式</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a, []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;...) <span class=\"comment\">// 追加一个切片, 切片需要解包</span></span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：尾部添加在容量不足的条件下需要重新分配内存，可能导致巨大的内存分配和复制数据代价。即使容量足够，依然需要用 append 函数的返回值来更新切片本身，因为新切片的长度已经发生了变化。</p>\n</blockquote>\n<ol>\n<li>在切片开头位置添加元素</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;</span><br><span class=\"line\">a = <span class=\"built_in\">append</span>([]<span class=\"type\">int</span>&#123;<span class=\"number\">0</span>&#125;, a...)        <span class=\"comment\">// 在开头位置添加1个元素</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>([]<span class=\"type\">int</span>&#123;<span class=\"number\">-3</span>,<span class=\"number\">-2</span>,<span class=\"number\">-1</span>&#125;, a...) <span class=\"comment\">// 在开头添加1个切片</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：在开头一般都会导致内存的重新分配，而且会导致已有的元素全部复制 1 次。因此，从切片的开头添加元素的性能一般要比从尾部追加元素的性能差很多。</p>\n</blockquote>\n<ol>\n<li>append 链式操作</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a []<span class=\"type\">int</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:i], <span class=\"built_in\">append</span>([]<span class=\"type\">int</span>&#123;x&#125;, a[i:]...)...)     <span class=\"comment\">// 在第i个位置插入x</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:i], <span class=\"built_in\">append</span>([]<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;, a[i:]...)...) <span class=\"comment\">// 在第i个位置插入切片</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>每个添加操作中的第二个 append 调用都会创建一个<strong>临时切片</strong>，并将 a [i:] 的内容复制到新创建的切片中，然后将临时创建的切片再追加到 a [:i]。</p>\n</blockquote>\n<ol>\n<li>append 和 copy 组合</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = <span class=\"built_in\">append</span>(a, <span class=\"number\">0</span>)     <span class=\"comment\">// 切片扩展1个空间</span></span><br><span class=\"line\"><span class=\"built_in\">copy</span>(a[i+<span class=\"number\">1</span>:], a[i:]) <span class=\"comment\">// a[i:]向后移动1个位置</span></span><br><span class=\"line\">a[i] = x             <span class=\"comment\">// 设置新添加的元素</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>第三个操作中会创建一个临时对象，我们可以借用 copy 函数避免这个操作，这种方式操作语句虽然冗长了一点，但是相比前面的方法，可以减少中间创建的临时切片。</p>\n</blockquote>\n<h3 id=\"363-删除元素\"><a class=\"markdownIt-Anchor\" href=\"#363-删除元素\">#</a> 3.6.3 删除元素</h3>\n<p>根据要删除元素的位置有三种情况：</p>\n<ol>\n<li>从开头位置删除；</li>\n</ol>\n<ul>\n<li>直接移动数据指针，代码如下：</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, ...&#125;</span><br><span class=\"line\">a = a[<span class=\"number\">1</span>:]                       <span class=\"comment\">// 删除开头1个元素</span></span><br><span class=\"line\">a = a[N:]                       <span class=\"comment\">// 删除开头N个元素</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>将后面的数据向开头移动，使用<strong> append 原地完成</strong>（所谓原地完成是指在原有的切片数据对应的内存区间内完成，不会导致内存空间结构的变化）</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, ...&#125;</span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:<span class=\"number\">0</span>], a[<span class=\"number\">1</span>:]...) <span class=\"comment\">// 删除开头1个元素</span></span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:<span class=\"number\">0</span>], a[N:]...) <span class=\"comment\">// 删除开头N个元素</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用 copy 将后续数据向前移动，代码如下：</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;</span><br><span class=\"line\">a = a[:<span class=\"built_in\">copy</span>(a, a[<span class=\"number\">1</span>:])] <span class=\"comment\">// 删除开头1个元素</span></span><br><span class=\"line\">a = a[:<span class=\"built_in\">copy</span>(a, a[N:])] <span class=\"comment\">// 删除开头N个元素</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>从中间位置删除；<br>\n对于删除中间的元素，需要对剩余的元素进行一次整体挪动，同样可以用 append 或 copy 原地完成：</li>\n</ol>\n<ul>\n<li>append 删除操作如下：</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, ...&#125;</span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:i], a[i+<span class=\"number\">1</span>], ...)</span><br><span class=\"line\">a = <span class=\"built_in\">append</span>(a[:i], a[i+N:], ...)</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>copy 删除操作如下：</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;</span><br><span class=\"line\">a = a[:<span class=\"built_in\">copy</span>(a[:i], a[i+<span class=\"number\">1</span>:])] <span class=\"comment\">// 删除中间1个元素</span></span><br><span class=\"line\">a = a[:<span class=\"built_in\">copy</span>(a[:i], a[i+N:])] <span class=\"comment\">// 删除中间N个元素</span></span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>从尾部删除。</li>\n</ol>\n<p>代码如下所示：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, ...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">a = a[:<span class=\"built_in\">len</span>(a)<span class=\"number\">-1</span>]   <span class=\"comment\">// 删除尾部1个元素</span></span><br><span class=\"line\">a = a[:<span class=\"built_in\">len</span>(a)-N]   <span class=\"comment\">// 删除尾部N个元素</span></span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>删除切片尾部的元素是最快的</p>\n</blockquote>\n<h2 id=\"37-函数\"><a class=\"markdownIt-Anchor\" href=\"#37-函数\">#</a> 3.7 函数</h2>\n<p>为完成某一功能的程序指令 (语句) 的集合，称为函数。</p>\n<h3 id=\"371-函数分类\"><a class=\"markdownIt-Anchor\" href=\"#371-函数分类\">#</a> 3.7.1 函数分类</h3>\n<p>在 Go 语言中，函数是第一类对象，我们可以将函数保持到变量中。函数主要有<strong>具名</strong>和<strong>匿名</strong>之分，包级函数一般都是具名函数，具名函数是匿名函数的一种特例，当匿名函数引用了外部作用域中的变量时就成了<strong>闭包函数</strong>，闭包函数是函数式编程语言的核心。</p>\n<p>举例代码如下：</p>\n<ol>\n<li>具名函数：就和 c 语言中的普通函数意义相同，具有函数名、返回值以及函数参数的函数。</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Add</span><span class=\"params\">(a, b <span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>匿名函数：指不需要定义函数名的一种函数实现方式，它由一个不带函数名的函数声明和函数体组成。</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> Add = <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(a, b <span class=\"type\">int</span>)</span></span> <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>解释几个名词如下：</p>\n<ol>\n<li>闭包函数：返回为函数对象，不仅仅是一个函数对象，在该函数外还包裹了一层作用域，这使得，该函数无论在何处调用，优先使用自己外层包裹的作用域。</li>\n<li>一级对象：支持闭包的多数语言都将函数作为第一级对象，就是说函数可以存储到变量中作为参数传递给其他函数，最重要的是能够被函数动态创建和返回。</li>\n<li>包：go 的每一个文件都是属于一个包的，也就是说 go 是以包的形式来管理文件和项目目录结构的。</li>\n</ol>\n</blockquote>\n<h3 id=\"372-函数声明和定义\"><a class=\"markdownIt-Anchor\" href=\"#372-函数声明和定义\">#</a> 3.7.2 函数声明和定义</h3>\n<p>Go 语言函数定义格式如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">fuction_name</span><span class=\"params\">([parameter list])</span></span>[<span class=\"keyword\">return</span> types]&#123;</span><br><span class=\"line\">\t函数体</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>解析</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>func</td>\n<td>函数由 func 开始声明</td>\n</tr>\n<tr>\n<td>function_name</td>\n<td>函数名称</td>\n</tr>\n<tr>\n<td>parameter list</td>\n<td>参数列表</td>\n</tr>\n<tr>\n<td>return_types</td>\n<td>返回类型</td>\n</tr>\n<tr>\n<td>函数体</td>\n<td>函数定义的代码集合</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"373-函数传参\"><a class=\"markdownIt-Anchor\" href=\"#373-函数传参\">#</a> 3.7.3 函数传参</h3>\n<blockquote>\n<p>Go 语言中的函数可以有多个参数和多个返回值，参数和返回值都是以传值的方式和被调用者交换数据。在语法上，函数还支持可变数量的参数，<strong>可变数量的参数必须是最后出现的参数</strong>，可变数量的参数其实是一个切片类型的参数。</p>\n</blockquote>\n<p>当可变参数是一个<strong>空接口类型</strong>时，调用者是否解包可变参数会导致不同的结果，我们解释一下解包的含义，代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> a = []<span class=\"type\">int</span>&#123;<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>&#125;</span><br><span class=\"line\">\tPrint(a...)   <span class=\"comment\">// 解包</span></span><br><span class=\"line\">\tPrint(a)\t  <span class=\"comment\">// 未解包</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Print</span><span class=\"params\">(a ...<span class=\"type\">int</span>&#123;&#125;)</span></span> &#123;</span><br><span class=\"line\">\tfmt.Println(a...)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456789</span></span><br></pre></td></tr></table></figure>\n<p>以上当传入参数为 <code>a...</code>  时即是对切片 a 进行了解包，此时其实相当于直接调用 <code>Print(1,2,3)</code> 。当传入参数直接为  <code>a</code>  时等价于直接调用 <code>Print([]int&#123;&#125;&#123;1,2,3&#125;)</code></p>\n<h3 id=\"374-函数返回值\"><a class=\"markdownIt-Anchor\" href=\"#374-函数返回值\">#</a> 3.7.4 函数返回值</h3>\n<blockquote>\n<p>不仅函数的参数可以有名字，也可以给函数的返回值命名。</p>\n</blockquote>\n<p>举例代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">Find</span><span class=\"params\">(m <span class=\"keyword\">map</span>[<span class=\"type\">int</span>]<span class=\"type\">int</span>, key <span class=\"type\">int</span>)</span></span>(value <span class=\"type\">int</span>, ok <span class=\"type\">bool</span>) &#123;</span><br><span class=\"line\">\tvalue,ok = m[key]</span><br><span class=\"line\">\t<span class=\"keyword\">return</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n<p>如果返回值命名了，可以通过名字来修改返回值，也可以通过 defer 语句在 return 语句之后修改返回值，举例代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">mian</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> i := <span class=\"number\">0</span> ; i&lt;<span class=\"number\">3</span>; i++ &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span> &#123; <span class=\"built_in\">println</span>(i) &#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 该函数最终的输出为：</span></span><br><span class=\"line\"><span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"comment\">// 3</span></span><br><span class=\"line\"><span class=\"number\">12345678910</span></span><br></pre></td></tr></table></figure>\n<p>以上代码中如果没有 defer 其实返回值就是 <code>0,1,2</code> ，但 defer 语句会在函数 return 之后才会执行，也就是或只有以上函数在执行结束 return 之后才会执行 defer 语句，而该函数 return 时的 <code>i</code>  值将会达到 3，所以最终的 defer 语句执行 printlin 的输出都是 3。</p>\n<p>defer 语句延迟执行的其实是一个匿名函数，因为这个匿名函数捕获了外部函数的局部变量 v，这种函数我们一般叫闭包。闭包对捕获的外部变量并不是传值方式访问，而是以<strong>引用</strong>的方式访问。</p>\n<p>这种方式往往会带来一些问题，修复方法为在每一轮迭代中都为 defer 函数提供一个独有的变量，修改代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++ &#123;</span><br><span class=\"line\">        i := i <span class=\"comment\">// 定义一个循环体内局部变量i</span></span><br><span class=\"line\">        <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">()</span></span>&#123; <span class=\"built_in\">println</span>(i) &#125; ()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"number\">0</span>; i &lt; <span class=\"number\">3</span>; i++ &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 通过函数传入i</span></span><br><span class=\"line\">        <span class=\"comment\">// defer 语句会马上对调用参数求值</span></span><br><span class=\"line\">        <span class=\"comment\">// 不再捕获，而是直接传值</span></span><br><span class=\"line\">        <span class=\"keyword\">defer</span> <span class=\"function\"><span class=\"keyword\">func</span><span class=\"params\">(i <span class=\"type\">int</span>)</span></span>&#123; <span class=\"built_in\">println</span>(i) &#125; (i)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456789101112131415</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"375-递归调用\"><a class=\"markdownIt-Anchor\" href=\"#375-递归调用\">#</a> 3.7.5 递归调用</h3>\n<p>Go 语言中，函数还可以直接或间接地调用自己，也就是支持递归调用。Go 语言函数的递归调用<strong>深度逻辑上没有限制</strong>，函数调用的栈是<strong>不会出现溢出错误</strong>的，因为 Go 语言运行时会根据需要动态地调整函数栈的大小。这部分的知识将会涉及 goroutint 和动态栈的相关知识，我们将会在之后的博文中向大家解释。</p>\n<p>它的语法和 c 很相似，格式如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">recursion</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">   recursion() <span class=\"comment\">/* 函数调用自身 */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">main</span><span class=\"params\">()</span></span> &#123;</span><br><span class=\"line\">   recursion()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"38-方法\"><a class=\"markdownIt-Anchor\" href=\"#38-方法\">#</a> 3.8 方法</h2>\n<p>方法一般是面向对象编程 (OOP) 的一个特性，在 C++ 语言中方法对应一个类对象的成员函数，是关联到具体对象上的虚表中的。但是 Go 语言的方法却是<strong>关联到类型</strong>的，这样可以在<strong>编译阶段完成方法的静态绑定</strong>。一个面向对象的程序会用方法来表达其属性对应的操作，这样使用这个对象的用户就不需要直接去操作对象，而是借助方法来做这些事情。</p>\n<p>实现 C 语言中的一组函数如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 文件对象</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> File <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    fd <span class=\"type\">int</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 打开文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">OpenFile</span><span class=\"params\">(name <span class=\"type\">string</span>)</span></span> (f *File, err <span class=\"type\">error</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">CloseFile</span><span class=\"params\">(f *File)</span></span> <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读文件数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">ReadFile</span><span class=\"params\">(f *File, offset <span class=\"type\">int64</span>, data []<span class=\"type\">byte</span>)</span></span> <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345678910111213141516171819</span></span><br></pre></td></tr></table></figure>\n<p>以上的三个函数都是普通的函数，需要占用包级空间中的名字资源。不过 CloseFile 和 ReadFile 函数只是针对 File 类型对象的操作，这时候我们更希望这类函数和操作对象的类型紧密绑定在一起。</p>\n<p>所以在 go 语言中我们修改如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 关闭文件</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *File)</span></span> CloseFile() <span class=\"type\">error</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 读文件数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"params\">(f *File)</span></span> ReadFile(offset <span class=\"type\">int64</span>, data []<span class=\"type\">byte</span>) <span class=\"type\">int</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456789</span></span><br></pre></td></tr></table></figure>\n<p>将 CloseFile 和 ReadFile 函数的第一个参数移动到函数名的开头，这两个函数就成了<strong> File 类型</strong>独有的方法了（而不是 File 对象方法）</p>\n<p>从代码角度看虽然只是一个小的改动，但是从编程哲学角度来看，Go 语言已经是进入面向对象语言的行列了。我们可以给任何自定义类型添加一个或多个方法。每种类型对应的方法必须和类型的定义在同一个包中，因此是无法给 int 这类内置类型添加方法的（因为方法的定义和类型的定义不在一个包中）。对于给定的类型，每个方法的名字必须是唯一的，同时方法和函数一样也不支持重载。</p>\n<h2 id=\"39-接口\"><a class=\"markdownIt-Anchor\" href=\"#39-接口\">#</a> 3.9 接口</h2>\n<h3 id=\"391-什么是接口\"><a class=\"markdownIt-Anchor\" href=\"#391-什么是接口\">#</a> 3.9.1 什么是接口</h3>\n<p>Go 语言提供了另外一种数据类型即接口，它把所有的具有共性的方法定义在一起，任何其他类型只要实现了这些方法就是实现了这个接口。</p>\n<p>Go 的接口类型是对其它类型行为的抽象和概括；因为接口类型<strong>不会和特定的实现细节绑定在一起</strong>，通过这种抽象的方式我们可以让对象更加灵活和更具有适应能力。很多面向对象的语言都有相似的接口概念，但 Go 语言中接口类型的独特之处在于它是满足隐式实现的鸭子类型。</p>\n<p>所谓<strong>鸭子类型</strong>说的是：只要走起路来像鸭子、叫起来也像鸭子，那么就可以把它当作鸭子。Go 语言中的面向对象就是如此，如果一个对象只要看起来像是某种接口类型的实现，那么它就可以作为该接口类型使用。</p>\n<p>就比如说在 c 语言中，使用 printf 在终端输出的时候只能输出有限类型的几个变量，而在 go 中可以使用 fmt.Printf，实际上是 fmt.Fprintf 向任意自定义的输出流对象打印，甚至可以打印到网络甚至是压缩文件，同时打印的数据不限于语言内置的基础类型，任意隐士满足 fmt.Stringer 接口的对象都可以打印，不满足 fmt.Stringer 接口的依然可以通过反射的技术打印。</p>\n<h3 id=\"392-结构体类型\"><a class=\"markdownIt-Anchor\" href=\"#392-结构体类型\">#</a> 3.9.2 结构体类型</h3>\n<p>interface 实际上就是一个结构体，包含两个成员。其中一个成员是指向具体数据的指针，另一个成员中包含了类型信息。空接口和带方法的接口略有不同，下面分别是空接口的数据结构：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> Eface</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Type*    <span class=\"keyword\">type</span>;</span><br><span class=\"line\">    void*    data;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n<p>其中的 Type 指的是：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> Type</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">uintptr</span> size;</span><br><span class=\"line\">    <span class=\"type\">uint32</span> hash;</span><br><span class=\"line\">    <span class=\"type\">uint8</span> _unused;</span><br><span class=\"line\">    <span class=\"type\">uint8</span> align;</span><br><span class=\"line\">    <span class=\"type\">uint8</span> fieldAlign;</span><br><span class=\"line\">    <span class=\"type\">uint8</span> kind;</span><br><span class=\"line\">    Alg *alg;</span><br><span class=\"line\">    void *gc;</span><br><span class=\"line\">    String *<span class=\"type\">string</span>;</span><br><span class=\"line\">    UncommonType *x;</span><br><span class=\"line\">    Type *ptrto;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">1234567891011121314</span></span><br></pre></td></tr></table></figure>\n<p>和带方法的接口使用的数据结构：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> Iface</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Itab*    tab;</span><br><span class=\"line\">    void*    data;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n<p>其中的 Iface 指的是：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span>    Itab</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    InterfaceType*    inter;</span><br><span class=\"line\">    Type*    <span class=\"keyword\">type</span>;</span><br><span class=\"line\">    Itab*    link;</span><br><span class=\"line\">    <span class=\"type\">int32</span>    bad;</span><br><span class=\"line\">    <span class=\"type\">int32</span>    unused;</span><br><span class=\"line\">    void    (*fun[])(void);   <span class=\"comment\">// 方法表</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">123456789</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"393-具体类型向接口类型赋值\"><a class=\"markdownIt-Anchor\" href=\"#393-具体类型向接口类型赋值\">#</a> 3.9.3 具体类型向接口类型赋值</h3>\n<p>将一个具体类型数据赋值给 interface 这样的抽象类型，需要进行类型转换。这个转换过程中涉及哪些操作呢？</p>\n<p>如果转换为空接口，返回一个 Eface，将 Eface 中的 data 指针指向原型数据，type 指针会指向数据的 Type 结构体。</p>\n<p>如果将其转化为带方法的 interface，需要进行一次检测，该类型必须实现 interface 中声明的所有方法才可以进行转换，这个检测将会在编译过程中进行。检测过程具体实现式通过比较具体类型的方法表和接口类型的方法表来进行的。</p>\n<ul>\n<li>具体类型方法表：Type 的 UncommonType 中有一个方法表，某个具体类型实现的所有方法都会被收集到这张表中。</li>\n<li>接口类型方法表：Iface 的 Itab 的 InterfaceType 中也有一张方法表，这张方法表中是接口所声明的方法。Iface 中的 Itab 的 func 域也是一张方法表，这张表中的每一项就是一个函数指针，也就是只有实现没有声明。</li>\n</ul>\n<p>这两处方法表都是排序过的，只需要一遍顺序扫描进行比较，应该可以知道 Type 中否实现了接口中声明的所有方法。最后还会将 Type 方法表中的函数指针，拷贝到 Itab 的 fun 字段中。Iface 中的 Itab 的 func 域也是一张方法表，这张表中的每一项就是一个函数指针，也就是只有实现没有声明。</p>\n<h3 id=\"394-获取接口类型数据的具体类型信息\"><a class=\"markdownIt-Anchor\" href=\"#394-获取接口类型数据的具体类型信息\">#</a> 3.9.4 获取接口类型数据的具体类型信息</h3>\n<p>接口类型转换为具体类型 (也就是反射，reflect)，也涉及到了类型转换。reflect 包中的 TypeOf 和 ValueOf 函数来得到接口变量的 Type 和 Value。</p>\n<h2 id=\"310-channel\"><a class=\"markdownIt-Anchor\" href=\"#310-channel\">#</a> 3.10 channel</h2>\n<h3 id=\"3101-相关结构体定义\"><a class=\"markdownIt-Anchor\" href=\"#3101-相关结构体定义\">#</a> 3.10.1 相关结构体定义</h3>\n<p>go 中的 channel 是可以被存储在变量中，可以作为参数传递给函数，也可以作为函数返回值返回，我们先来看一下 channel 的结构体定义：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span>    Hchan</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    uintgo    qcount;            <span class=\"comment\">// 队列q中的总数据数量</span></span><br><span class=\"line\">    uintgo    dataqsize;        <span class=\"comment\">// 环形队列q的数据大小</span></span><br><span class=\"line\">    <span class=\"type\">uint16</span>    elemsize;\t\t\t<span class=\"comment\">// 当前队列的使用量</span></span><br><span class=\"line\">    <span class=\"type\">bool</span>    closed;\t\t\t\t</span><br><span class=\"line\">    <span class=\"type\">uint8</span>    elemalign;</span><br><span class=\"line\">    Alg*    elemalg;        <span class=\"comment\">// interface for element type</span></span><br><span class=\"line\">    uintgo    sendx;            <span class=\"comment\">// 发送index</span></span><br><span class=\"line\">    uintgo    recvx;            <span class=\"comment\">// 接收index</span></span><br><span class=\"line\">    WaitQ    recvq;            <span class=\"comment\">// 因recv而阻塞的等待队列</span></span><br><span class=\"line\">    WaitQ    sendq;            <span class=\"comment\">// 因send而阻塞的等待队列</span></span><br><span class=\"line\">    Lock;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">1234567891011121314</span></span><br></pre></td></tr></table></figure>\n<p>Hchan 结构体中的核心部分是存放 channel 数据的环形队列，相关数据的作用已经在其后做出了备注。在该结构体中没有存放数据的域，如果是带缓冲区的 chan，则缓冲区数据实际上是紧接着 Hchan 结构体中分配的。</p>\n<p>另一个重要部分就是 recvq 和 sendq 两个链表，一个是因读这个通道而导致阻塞的 goroutine，另一个是因为写这个通道而阻塞的 goroutine。如果一个 goroutine 阻塞于 channel 了，那么它就被挂在 recvq 或 sendq 中。WaitQ 是链表的定义，包含一个头结点和一个尾结点，该链表中中存放的成员是一个 sudoG 结构体变量，具体定义如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span>    SudoG</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    G*    g;        <span class=\"comment\">// g and selgen constitute</span></span><br><span class=\"line\">    <span class=\"type\">uint32</span>    selgen;        <span class=\"comment\">// a weak pointer to g</span></span><br><span class=\"line\">    SudoG*    link;</span><br><span class=\"line\">    <span class=\"type\">int64</span>    releasetime;</span><br><span class=\"line\">    <span class=\"type\">byte</span>*    elem;        <span class=\"comment\">// data element</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"number\">12345678</span></span><br></pre></td></tr></table></figure>\n<p>该结构体中最主要的是 g 和 elem。elem 用于存储 goroutine 的数据。读通道时，数据会从 Hchan 的队列中拷贝到 SudoG 的 elem 域。写通道时，数据则是由 SudoG 的 elem 域拷贝到 Hchan 的队列中。</p>\n<p>Hchan 结构如下：<br>\n<img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/ddf2855d06234305a122bea469d0adaa.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"3102-阻塞式读写channel操作\"><a class=\"markdownIt-Anchor\" href=\"#3102-阻塞式读写channel操作\">#</a> 3.10.2 阻塞式读写 channel 操作</h3>\n<p>写操作代码如下，其中的 c 就是 channel，v 指的是数据：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c &lt;- v</span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>事实上基本的阻塞模式写 channel 操作在底层运行时库中对应的是一个 runtime.chansend 函数。具体如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void runtime·chansend(ChanType *t, Hchan *c, byte *ep, bool *pres, void *pc)</span><br></pre></td></tr></table></figure>\n<p>其中的 ep 指的是变量 v 的地址，这里的传值约定是调用者负责分配好 ep 的空间，仅需要简单的取变量地址就好了，pres 是在 select 中的通道操作中使用的。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/22fb68eff45145c89f2f64d51b3e556f.png\" alt=\"在这里插入图片描述\"></p>\n<p>阻塞模式读操作的核心函数有两种包装如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected, received bool)</span><br></pre></td></tr></table></figure>\n<p>以及</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chanrecv(c *hchan, ep unsafe.Pointer, block bool) (selected)</span><br></pre></td></tr></table></figure>\n<p>这两种的区别主要在于返回值是否会返回一个 bool 类型值，该值只是用于判断 channel 是否能读取出数据。</p>\n<p>读写操作的以上阻塞的过程类似，故而不再做出说明，我们补充三个细节：</p>\n<ul>\n<li>以上我们都强调是阻塞式的读写操作，其实相对应的也有<strong>非阻塞的</strong>读写操作，使用过 select-case 来进行调用的。</li>\n<li>空通道，指的是将一个 channel 赋值为 nil，或者调用后不适用 make 进行初始化。读写空通道是永远阻塞的。</li>\n<li>关闭的通道，永远不会阻塞，会返回一个通道数据类型的零值。首先将 closed 置为 1，第二步收集读等待队列 recvq 的所有 sg，每个 sg 的 elem 都设为类型零值，第三步收集写等待队列 sendq 的所有 sg，每个 sg 的 elem 都设为 nil，最后唤醒所有收集的 sg。</li>\n</ul>\n<h3 id=\"3103-非阻塞式读写channel操作\"><a class=\"markdownIt-Anchor\" href=\"#3103-非阻塞式读写channel操作\">#</a> 3.10.3 非阻塞式读写 channel 操作</h3>\n<p>如上文所说，非阻塞式其实就是使用 select-case 来实现，在编译时将会被编译为 if-else。</p>\n<p>如：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">case</span> v = &lt;-c:</span><br><span class=\"line\">        ...foo</span><br><span class=\"line\"><span class=\"keyword\">default</span>:</span><br><span class=\"line\">        ...bar</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456</span></span><br></pre></td></tr></table></figure>\n<p>就会被编译为：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> selectnbrecv(&amp;v, c) &#123;</span><br><span class=\"line\">        ...foo</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ...bar</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n<p>至于其中的 selectnbrecv 相关的函数简单地调 runtime.chanrecv 函数，设置了一个参数，告诉 runtime.chanrecv 函数，当不能完成操作时不要阻塞，而是返回失败。</p>\n<p>但是 select 中的 case 的执行顺序是随机的，而不像 switch 中的 case 那样一条一条的顺序执行。让每一个 select 都对应一个 Select 结构体。在 Select 数据结构中有个 Scase 数组，记录下了每一个 case，而 Scase 中包含了 Hchan。然后 pollorder 数组将元素随机排列，这样就可以将 Scase 乱序了。</p>\n<h2 id=\"311-map\"><a class=\"markdownIt-Anchor\" href=\"#311-map\">#</a> 3.11 map</h2>\n<p>map 表的底层原理是哈希表，其结构体定义如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> Map <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    Key  *Type <span class=\"comment\">// Key type</span></span><br><span class=\"line\">    Elem *Type <span class=\"comment\">// Val (elem) type</span></span><br><span class=\"line\"></span><br><span class=\"line\">    Bucket *Type <span class=\"comment\">// 哈希桶</span></span><br><span class=\"line\">    Hmap   *Type <span class=\"comment\">// 底层使用的哈希表元信息</span></span><br><span class=\"line\">    Hiter  *Type <span class=\"comment\">// 用于遍历哈希表的迭代器</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345678</span></span><br></pre></td></tr></table></figure>\n<p>其中的 Hmap 的具体化数据结构如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> hmap <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Note: the format of the hmap is also encoded in cmd/compile/internal/gc/reflect.go.</span></span><br><span class=\"line\">    <span class=\"comment\">// Make sure this stays in sync with the compiler&#x27;s definition.</span></span><br><span class=\"line\">    count     <span class=\"type\">int</span> <span class=\"comment\">// map目前的元素数目</span></span><br><span class=\"line\">    flags     <span class=\"type\">uint8</span> <span class=\"comment\">// map状态（正在被遍历/正在被写入）</span></span><br><span class=\"line\">    B         <span class=\"type\">uint8</span>  <span class=\"comment\">// 哈希桶数目以2为底的对数（哈希桶的数目都是 2 的整数次幂，用位运算来计算取余运算的值, 即 N mod M = N &amp; (M-1))）</span></span><br><span class=\"line\">    noverflow <span class=\"type\">uint16</span> <span class=\"comment\">//溢出桶的数目, 这个数值不是恒定精确的, 当其 B&gt;=16 时为近似值</span></span><br><span class=\"line\">    hash0     <span class=\"type\">uint32</span> <span class=\"comment\">// 随机哈希种子</span></span><br><span class=\"line\"></span><br><span class=\"line\">    buckets    unsafe.Pointer <span class=\"comment\">// 指向当前哈希桶的指针</span></span><br><span class=\"line\">    oldbuckets unsafe.Pointer <span class=\"comment\">// 扩容时指向旧桶的指针</span></span><br><span class=\"line\">    nevacuate  <span class=\"type\">uintptr</span>        <span class=\"comment\">// 桶进行调整时指示的搬迁进度</span></span><br><span class=\"line\"></span><br><span class=\"line\">    extra *mapextra <span class=\"comment\">// 表征溢出桶的变量</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456789101112131415</span></span><br></pre></td></tr></table></figure>\n<p>以上 hmap 基本都是涉及到了哈希桶和溢出桶，我们首先看一下它的数据结构，如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> bmap <span class=\"keyword\">struct</span> &#123;</span><br><span class=\"line\">    topbits  [<span class=\"number\">8</span>]<span class=\"type\">uint8</span>    <span class=\"comment\">// 键哈希值的高8位</span></span><br><span class=\"line\">    keys     [<span class=\"number\">8</span>]keytype  <span class=\"comment\">// 哈希桶中所有键</span></span><br><span class=\"line\">    elems    [<span class=\"number\">8</span>]elemtype\t<span class=\"comment\">// 哈希桶中所有值</span></span><br><span class=\"line\">    <span class=\"comment\">//pad      uintptr(新的 go 版本已经移除了该字段, 我未具体了解此处的 change detail, 之前设置该字段是为了在 nacl/amd64p32 上的内存对齐)</span></span><br><span class=\"line\">    overflow <span class=\"type\">uintptr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">1234567</span></span><br></pre></td></tr></table></figure>\n<p>我们会发现哈希桶 bmap 一般指定其能保存 8 个键值对，如果多于 8 个键值对，就会申请新的 buckets，并将其于之前的 buckets 链接在一起。</p>\n<p>其中的联系如图所示：<br>\n<img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/13c1b9f9899d48b08c32b76ef4037a17.png\" alt=\"在这里插入图片描述\"></p>\n<p>在具体插入时，首先会根据 key 值采用相应的 hash 算法计算对应的哈希值，将哈希值的低 8 位作为 Hmap 结构体中 buckets 数组的索引，找到 key 值所对应的 bucket，将哈希值的高 8 位催出在 bucket 的 tophash 中。</p>\n<p>特点如下：</p>\n<ul>\n<li>map 是<strong>无序的</strong>（原因为无序写入以及扩容导致的元素顺序发生变化），每次打印出来的 map 都会不一样，它不能通过 index 获取，而必须通过 key 获取</li>\n<li>map 的<strong>长度是不固定</strong>的，也就是和 slice 一样，也是一种引用类型</li>\n<li>内置的 len 函数同样适用于 map，返回 map 拥有的 key 的数量</li>\n<li>map 的 key 可以是所有可比较的类型，如布尔型、整数型、浮点型、复杂型、字符串型…… 也可以键。</li>\n</ul>\n<p>如下方式即可进行初始化：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a <span class=\"keyword\">map</span>[keytype]valuetype</span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th>类型名</th>\n<th>意义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>a</td>\n<td>map 表名字</td>\n</tr>\n<tr>\n<td>keytype</td>\n<td>键类型</td>\n</tr>\n<tr>\n<td>valuetype</td>\n<td>键对应的值的类型</td>\n</tr>\n</tbody>\n</table>\n<p>除此以外还可以使用 make 进行初始化，代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map_variable = <span class=\"built_in\">make</span>(<span class=\"keyword\">map</span>[key_data_type]value_data_type)</span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>我们还可以使用初始值进行初始化，如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> m <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">int</span> = <span class=\"keyword\">map</span>[<span class=\"type\">string</span>]<span class=\"type\">int</span>&#123;<span class=\"string\">&quot;hunter&quot;</span>:<span class=\"number\">12</span>,<span class=\"string\">&quot;tony&quot;</span>:<span class=\"number\">10</span>&#125;</span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3111-插入数据\"><a class=\"markdownIt-Anchor\" href=\"#3111-插入数据\">#</a> 3.11.1 插入数据</h3>\n<p>map 的数据插入代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">map_variable[<span class=\"string\">&quot;mars&quot;</span>] = <span class=\"number\">27</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>插入过程如下：</p>\n<ol>\n<li>根据 key 值计算出哈希值</li>\n<li>取哈希值低位和 hmap.B 取模确定 bucket 位置</li>\n<li>查找该 key 是否已经存在，如果存在则直接更新值</li>\n<li>如果没有找到 key，则将这一对 key-value 插入</li>\n</ol>\n<h3 id=\"3112-删除数据\"><a class=\"markdownIt-Anchor\" href=\"#3112-删除数据\">#</a> 3.11.2 删除数据</h3>\n<p><strong>delete(map, key)</strong> 函数用于删除集合的元素，参数为 map 和其对应的 key。删除函数不返回任何值。相关代码如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   countryCapitalMap := <span class=\"keyword\">map</span>[<span class=\"type\">string</span>] <span class=\"type\">string</span> &#123;<span class=\"string\">&quot;France&quot;</span>:<span class=\"string\">&quot;Paris&quot;</span>,<span class=\"string\">&quot;Italy&quot;</span>:<span class=\"string\">&quot;Rome&quot;</span>,<span class=\"string\">&quot;Japan&quot;</span>:<span class=\"string\">&quot;Tokyo&quot;</span>,<span class=\"string\">&quot;India&quot;</span>:<span class=\"string\">&quot;New Delhi&quot;</span>&#125;</span><br><span class=\"line\">   <span class=\"comment\">/* 删除元素 */</span></span><br><span class=\"line\">   <span class=\"built_in\">delete</span>(countryCapitalMap,<span class=\"string\">&quot;France&quot;</span>);</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3113-查找数据\"><a class=\"markdownIt-Anchor\" href=\"#3113-查找数据\">#</a> 3.11.3 查找数据</h3>\n<p>通过 key 获取 map 中对应的 value 值。语法为： <code>map[key] </code> . 但是当 key 如果不存在的时候，我们会得到该 value 值类型的默认值，比如 string 类型得到空字符串，int 类型得到 0。但是程序不会报错。</p>\n<p>所以我们可以使用<strong> ok-idiom</strong> 获取值，如下： <code>value, ok := map[key] </code> ，其中的 value 是返回值，ok 是一个 bool 值，可知道 key/value 是否存在。</p>\n<p>在 map 表中的查找过程如下：</p>\n<ol>\n<li>查找或者操作 map 时，首先 key 经过 hash 函数生成 hash 值</li>\n<li>通过哈希值的低 8 位来判断当前数据属于哪个桶</li>\n<li>找到桶之后，通过哈希值的高八位与 bucket 存储的高位哈希值循环比对</li>\n<li>如果相同就比较刚才找到的底层数组的 key 值，如果 key 相同，取出 value</li>\n<li>如果高八位 hash 值在此 bucket 没有，或者有，但是 key 不相同，就去链表中下一个溢出 bucket 中查找，直到查找到链表的末尾</li>\n<li>如果查找不到，也不会返回空值，而是返回相应类型的 0 值。</li>\n</ol>\n<h3 id=\"3114-扩容\"><a class=\"markdownIt-Anchor\" href=\"#3114-扩容\">#</a> 3.11.4 扩容</h3>\n<p>哈希表就是以空间换时间，访问速度是直接跟填充因子相关的，所以当哈希表太满之后就需要进行扩容。</p>\n<p>如果扩容前的哈希表大小为 2B 扩容之后的大小为 2 (B+1)，每次扩容都变为<strong>原来大小的两倍</strong>，哈希表大小始终为 2 的指数倍，则有 (hash mod 2B) 等价于 (hash &amp; (2B-1))。这样可以简化运算，避免了取余操作。</p>\n<blockquote>\n<p>触发扩容的条件？</p>\n</blockquote>\n<ol>\n<li>负载因子 (负载因子 = 键数量 /bucket 数量) &gt; 6.5 时，也即平均每个 bucket 存储的键值对达到 6.5 个。</li>\n<li>溢出桶（overflow）数量 &gt; 2^15 时，也即 overflow 数量超过 32768 时。</li>\n</ol>\n<blockquote>\n<p>什么是增量扩容呢？</p>\n</blockquote>\n<p>如果负载因子 &gt; 6.5 时，进行增量扩容。这时会新建一个桶（bucket），新的 bucket 长度是原来的 2 倍，然后旧桶数据搬迁到新桶。每个旧桶的键值对都会分流到两个新桶中</p>\n<p>主要是缩短 map 容器的响应时间。假如我们直接将 map 用作某个响应实时性要求非常高的 web 应用存储，如果不采用增量扩容，当 map 里面存储的元素很多之后，扩容时系统就会卡往，导致较长一段时间内无法响应请求。不过增量扩容本质上还是将总的扩容时间分摊到了每一次哈希操作上面。</p>\n<blockquote>\n<p>什么是等量扩容？它的触发条件是什么？进行等量扩容后的优势是什么？</p>\n</blockquote>\n<p>等量扩容，就是创建和旧桶数目一样多的新桶，然后把原来的键值对迁移到新桶中，重新做一遍类似增量扩容的搬迁动作。</p>\n<p>触发条件：负载因子没超标，溢出桶较多。这个较多的评判标准为：</p>\n<ul>\n<li>如果常规桶数目不大于 2^15，那么使用的溢出桶数目超过常规桶就算是多了；</li>\n<li>如果常规桶数目大于 215，那么使用溢出桶数目一旦超过 215 就算多了。</li>\n</ul>\n<p>这样做的目的是把松散的键值对重新排列一次，能够存储的更加紧凑，进而减少溢出桶的使用，以使 bucket 的使用率更高，进而保证更快的存取。</p>\n<h1 id=\"4-常用语句及关键字\"><a class=\"markdownIt-Anchor\" href=\"#4-常用语句及关键字\">#</a> 4. 常用语句及关键字</h1>\n<p>接下来我们了解一下关于 go 语言语句的基本内容。</p>\n<h2 id=\"41-条件语句\"><a class=\"markdownIt-Anchor\" href=\"#41-条件语句\">#</a> 4.1 条件语句</h2>\n<p>和 c 语言类似，相关的条件语句如下表所示：</p>\n<table>\n<thead>\n<tr>\n<th>语句</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>if 语句</td>\n<td>if 语句 由一个布尔表达式后紧跟一个或多个语句组成。</td>\n</tr>\n<tr>\n<td>if…else 语句</td>\n<td>if 语句 后可以使用可选的 else 语句，else 语句中的表达式在布尔表达式为 false 时执行。</td>\n</tr>\n<tr>\n<td>switch 语句</td>\n<td>switch 语句用于基于不同条件执行不同动作。</td>\n</tr>\n<tr>\n<td>select 语句</td>\n<td>select 语句类似于 switch 语句，但是 select 会随机执行一个可运行的 case。如果没有 case 可运行，它将阻塞，直到有 case 可运行。</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>if 语句<br>\n语法如下：</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> 布尔表达式 &#123;</span><br><span class=\"line\">   <span class=\"comment\">/* 在布尔表达式为 true 时执行 */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>if-else 语句</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> 布尔表达式 &#123;</span><br><span class=\"line\">   <span class=\"comment\">/* 在布尔表达式为 true 时执行 */</span></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">/* 在布尔表达式为 false 时执行 */</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>switch 语句<br>\n其中的变量 <code>v</code>  可以是任何类型， <code>val1</code>  和 <code>val2</code>  可以是同类型的任意值，类型不局限为常量或者整数，或者最终结果为相同类型的表达式。</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">switch</span> v &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> val1:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    <span class=\"keyword\">case</span> val2:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    <span class=\"keyword\">default</span>:</span><br><span class=\"line\">        ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">12345678</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>select 语句<br>\n select 是 Go 中的一个控制结构，类似于用于通信的 switch 语句。每个 case 必须是一个<strong>通信操作</strong>，要么是发送要么是接收。它将会随机执行一个可运行的 case。如果没有 case 可运行，它将阻塞，直到有 case 可运行。一个默认的子句应该总是可运行的。</li>\n</ul>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">select</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> communication clause  :</span><br><span class=\"line\">       statement(s);      </span><br><span class=\"line\">    <span class=\"keyword\">case</span> communication clause  :</span><br><span class=\"line\">       statement(s);</span><br><span class=\"line\">    <span class=\"comment\">/* 你可以定义任意数量的 case */</span></span><br><span class=\"line\">    <span class=\"keyword\">default</span> : <span class=\"comment\">/* 可选 */</span></span><br><span class=\"line\">       statement(s);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123456789</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：</p>\n<ul>\n<li>每个 case 必须都是一个通信</li>\n<li>所有 channel 表达式都会被求值，所有被发送的表达式都会被求值</li>\n<li>如果任意某一个通信都可以，它就执行，其他就忽略</li>\n<li>如果有多个 case 都可以运行，select 就会随机挑选一个来执行。</li>\n<li>如果没有一个 case 可以被运行：如果有 default 子句，就执行 default 子句，select 将被阻塞，直到某个通信可以运行，从而避免饥饿问题。</li>\n</ul>\n</blockquote>\n<h2 id=\"42-循环语句\"><a class=\"markdownIt-Anchor\" href=\"#42-循环语句\">#</a> 4.2 循环语句</h2>\n<h3 id=\"421-循环处理语句\"><a class=\"markdownIt-Anchor\" href=\"#421-循环处理语句\">#</a> 4.2.1 循环处理语句</h3>\n<p>go 中时使用 for 实现循环的，共有三种形式：</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>语法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>和 c 语言中的 for 相同</td>\n<td>for init; condition; post {}</td>\n</tr>\n<tr>\n<td>和 c 语言中的 while 相同</td>\n<td>for condition{}</td>\n</tr>\n<tr>\n<td>和 c 语言中的 <code>for(;;)</code>  相同</td>\n<td>for{}</td>\n</tr>\n</tbody>\n</table>\n<p>除此以外，for 循环还可以直接使用<strong> range</strong> 对 slice、map、数组以及字符串等进行迭代循环，格式如下：</p>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> key, value := <span class=\"keyword\">range</span> oldmap &#123;</span><br><span class=\"line\">\tnewmap[key] = value</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"number\">123</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"421-循环控制语句\"><a class=\"markdownIt-Anchor\" href=\"#421-循环控制语句\">#</a> 4.2.1 循环控制语句</h3>\n<table>\n<thead>\n<tr>\n<th>控制语句</th>\n<th>详解</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>break</td>\n<td>中断跳出循环或者 switch 语句</td>\n</tr>\n<tr>\n<td>continue</td>\n<td>跳过当前循环的剩余语句，然后继续下一轮循环</td>\n</tr>\n<tr>\n<td>goto 语句</td>\n<td>将控制转移到被标记的语句</td>\n</tr>\n</tbody>\n</table>\n<ol>\n<li>break<br>\nbreak 主要用于循环语句跳出循环，和 c 语言中的使用方式是相同的。且在多重循环的时候还可以使用 label 标出想要 break 的循环。<br>\n实例代码如下：</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a := <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> a&lt;<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;%d\\n&quot;</span>, a)</span><br><span class=\"line\">\ta++</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> a==<span class=\"number\">2</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">/* output</span></span><br><span class=\"line\"><span class=\"comment\">0</span></span><br><span class=\"line\"><span class=\"comment\">1</span></span><br><span class=\"line\"><span class=\"comment\">2</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"number\">12345678910111213</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>continue<br>\nGo 语言的 continue 语句 有点像 break 语句。但是 continue 不是跳出循环，而是跳过当前循环执行下一次循环语句。在多重循环中，可以用标号 label 标出想 continue 的循环。<br>\n实例代码如下：</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    <span class=\"comment\">// 不使用标记</span></span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;---- continue ---- &quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt;= <span class=\"number\">3</span>; i++ &#123;</span><br><span class=\"line\">        fmt.Printf(<span class=\"string\">&quot;i: %d\\n&quot;</span>, i)</span><br><span class=\"line\">            <span class=\"keyword\">for</span> i2 := <span class=\"number\">11</span>; i2 &lt;= <span class=\"number\">13</span>; i2++ &#123;</span><br><span class=\"line\">                fmt.Printf(<span class=\"string\">&quot;i2: %d\\n&quot;</span>, i2)</span><br><span class=\"line\">                <span class=\"keyword\">continue</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* output</span></span><br><span class=\"line\"><span class=\"comment\">i: 1</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">i2: 12</span></span><br><span class=\"line\"><span class=\"comment\">i2: 13</span></span><br><span class=\"line\"><span class=\"comment\">i: 2</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">i2: 12</span></span><br><span class=\"line\"><span class=\"comment\">i2: 13</span></span><br><span class=\"line\"><span class=\"comment\">i: 3</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">i2: 12</span></span><br><span class=\"line\"><span class=\"comment\">i2: 13</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 使用标记</span></span><br><span class=\"line\">    fmt.Println(<span class=\"string\">&quot;---- continue label ----&quot;</span>)</span><br><span class=\"line\">    re:</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i := <span class=\"number\">1</span>; i &lt;= <span class=\"number\">3</span>; i++ &#123;</span><br><span class=\"line\">            fmt.Printf(<span class=\"string\">&quot;i: %d&quot;</span>, i)</span><br><span class=\"line\">                <span class=\"keyword\">for</span> i2 := <span class=\"number\">11</span>; i2 &lt;= <span class=\"number\">13</span>; i2++ &#123;</span><br><span class=\"line\">                    fmt.Printf(<span class=\"string\">&quot;i2: %d\\n&quot;</span>, i2)</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span> re</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* output</span></span><br><span class=\"line\"><span class=\"comment\">i: 1</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">i: 2</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">i: 3</span></span><br><span class=\"line\"><span class=\"comment\">i2: 11</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"number\">1234567891011121314151617181920212223242526272829303132333435363738394041424344</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>goto<br>\ngoto 语句主要是无条件转移到过程中<strong>指定的行</strong>。goto 语句通常和条件语句配合使用，可用来实现条件转移、构成循环以及跳出循环体等功能。但是并不主张使用 goto 语句，以免造成程序流程混乱。<br>\n示例代码如下：</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> a <span class=\"type\">int</span> = <span class=\"number\">0</span></span><br><span class=\"line\">LOOP: <span class=\"keyword\">for</span> a&lt;<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> a == <span class=\"number\">2</span> &#123;</span><br><span class=\"line\">\t\ta = a+<span class=\"number\">1</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">goto</span> LOOP</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfmt.Printf(<span class=\"string\">&quot;%d\\n&quot;</span>, a)</span><br><span class=\"line\">\ta++</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">output:</span></span><br><span class=\"line\"><span class=\"comment\">0</span></span><br><span class=\"line\"><span class=\"comment\">1</span></span><br><span class=\"line\"><span class=\"comment\">2</span></span><br><span class=\"line\"><span class=\"comment\">3</span></span><br><span class=\"line\"><span class=\"comment\">4</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"number\">123456789101112131415161718</span></span><br></pre></td></tr></table></figure>\n<p>以上代码中的 LOOP 就是一个标签，当运行到 goto 语句的时候，此时执行流就会跳转到 LOOP 标志的哪一行上。</p>\n<h2 id=\"43-关键字\"><a class=\"markdownIt-Anchor\" href=\"#43-关键字\">#</a> 4.3 关键字</h2>\n<p>我们这一部分直接列表供大家了解 go 中的关键字如下：</p>\n<table>\n<thead>\n<tr>\n<th>关键字</th>\n<th>用法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>import</td>\n<td>导入相应的包文件</td>\n</tr>\n<tr>\n<td>package</td>\n<td>创建包文件，用于标记该文件归属哪个包</td>\n</tr>\n<tr>\n<td>chan</td>\n<td>channal，通道</td>\n</tr>\n<tr>\n<td>var</td>\n<td>变量控制，用于简短声明定义变量（:= 符号只能在函数内部使用，不能全局使用）</td>\n</tr>\n<tr>\n<td>const</td>\n<td>常量声明，任何时候 const 和 var 都可以同时出现</td>\n</tr>\n<tr>\n<td>func</td>\n<td>定义函数和方法</td>\n</tr>\n<tr>\n<td>interface</td>\n<td>接口，是一种具有一组方法的类型，这些方法定义了 interface 的行为</td>\n</tr>\n<tr>\n<td>map</td>\n<td>哈希表</td>\n</tr>\n<tr>\n<td>struct</td>\n<td>定义结构体</td>\n</tr>\n<tr>\n<td>type</td>\n<td>声明类型，取别名</td>\n</tr>\n<tr>\n<td>for</td>\n<td>for 是 go 中唯一的循环结构，上文中已经介绍过它的用法</td>\n</tr>\n<tr>\n<td>break</td>\n<td>中止，跳出循环</td>\n</tr>\n<tr>\n<td>continue</td>\n<td>继续下一轮循环</td>\n</tr>\n<tr>\n<td>select</td>\n<td>选择流程，可以同时等待多个通道操作</td>\n</tr>\n<tr>\n<td>switch</td>\n<td>多分枝选择，上文中已经详细介绍过它的用法</td>\n</tr>\n<tr>\n<td>case</td>\n<td>和 switch 配套使用</td>\n</tr>\n<tr>\n<td>default</td>\n<td>用于选择结构的默认选型</td>\n</tr>\n<tr>\n<td>defer</td>\n<td>用于资源释放，会在函数返回之前进行调用</td>\n</tr>\n<tr>\n<td>if</td>\n<td>分支选择</td>\n</tr>\n<tr>\n<td>else</td>\n<td>和 if 配套使用</td>\n</tr>\n<tr>\n<td>go</td>\n<td>通过 <code>go func()</code>  来开启一个 goroutine</td>\n</tr>\n<tr>\n<td>goto</td>\n<td>跳转至标志点的代码块，不推荐使用</td>\n</tr>\n<tr>\n<td>fallthrouth</td>\n<td></td>\n</tr>\n<tr>\n<td>range</td>\n<td>用于遍历 slice 类型数据</td>\n</tr>\n<tr>\n<td>return</td>\n<td>用于标注函数返回值</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/06/Linux%E4%B8%8B%E4%BD%BF%E7%94%A8war%E5%8C%85%E9%83%A8%E7%BD%B2Jenkins/",
            "url": "http://example.com/2023/01/06/Linux%E4%B8%8B%E4%BD%BF%E7%94%A8war%E5%8C%85%E9%83%A8%E7%BD%B2Jenkins/",
            "title": "Linux下使用war包部署Jenkins",
            "date_published": "2023-01-06T01:06:38.037Z",
            "content_html": "<h1 id=\"linux下使用war包部署jenkins\"><a class=\"markdownIt-Anchor\" href=\"#linux下使用war包部署jenkins\">#</a> Linux 下使用 war 包部署 Jenkins</h1>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>jenkins 可以多种方式安装，可以 docker，也可以直接下载 war 包，然后 java -jar 方式启动。</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.创建安装目录</span><br><span class=\"line\">\tmkdir -p /jenkins</span><br><span class=\"line\">2.切换目录</span><br><span class=\"line\">\tcd  /jenkins</span><br><span class=\"line\">3.下载war包</span><br><span class=\"line\">\twget -O /jenkins/jenkins.war http://mirrors.jenkins.io/war-stable/latest/jenkins.war</span><br><span class=\"line\">4.启动</span><br><span class=\"line\">\tBUILD_ID=dontKillMe nohup java -DJENKINS_HOME=/jenkins (如果有历史home可以指定其他home：/root/.jenkins) -Xms1046m -Xmx2000m -jar jenkins.war --httpPort=9444  &gt;&gt;jenkinsLog.log 2&gt;&amp;1 &amp;</span><br><span class=\"line\">5.访问</span><br><span class=\"line\">\thttp://&#123;your ip&#125;:9444</span><br></pre></td></tr></table></figure>\n<h3 id=\"备注\"><a class=\"markdownIt-Anchor\" href=\"#备注\">#</a> <strong>备注:</strong></h3>\n<ol>\n<li>–httpPort 自定义端口</li>\n<li>jenkins 默认工作目录：/root/.jenkins</li>\n<li>nohup 后台启动</li>\n<li>‘&gt;&gt;log’ 以追加的方式记录日志</li>\n<li>2&gt;&amp;1 2: 标准异常输出 1: 标准输出 ，2&gt;&amp;1 两种输出都记录到 log 文件中</li>\n<li>&amp; 后台启动方式</li>\n<li>BUILD_ID=dontKillMe 防止误杀包</li>\n</ol>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/06/Docker%E5%AE%89%E8%A3%85Jenkins/",
            "url": "http://example.com/2023/01/06/Docker%E5%AE%89%E8%A3%85Jenkins/",
            "title": "Docker安装Jenkins",
            "date_published": "2023-01-06T00:37:50.763Z",
            "content_html": "<h1 id=\"docker安装jenkins\"><a class=\"markdownIt-Anchor\" href=\"#docker安装jenkins\">#</a> Docker 安装 Jenkins</h1>\n<h1 id=\"一-前言\"><a class=\"markdownIt-Anchor\" href=\"#一-前言\">#</a> 一、前言</h1>\n<h2 id=\"1-领头羊\"><a class=\"markdownIt-Anchor\" href=\"#1-领头羊\">#</a> 1、领头羊</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">作为领先的开源自动化服务器，Jenkins 提供了数百个插件来支持构建、部署和自动化任何项目。</span><br></pre></td></tr></table></figure>\n<h2 id=\"2-特点\"><a class=\"markdownIt-Anchor\" href=\"#2-特点\">#</a> 2、特点</h2>\n<ul>\n<li>持续集成和持续交付：作为可扩展的自动化服务器，Jenkins 可以用作简单的 CI 服务器或变成任何项目的持续交付中心。</li>\n<li>简易安装：Jenkins 是一个独立的基于 Java 的程序，可以开箱即用，包含适用于 Windows、Linux、macOS 和其他类 Unix 操作系统的软件包。</li>\n<li>易于配置：Jenkins 可以通过其 Web 界面轻松设置和配置，其中包括即时错误检查和内置帮助。</li>\n<li>插件：凭借更新中心的数百个插件，Jenkins 与持续集成和持续交付工具链中的几乎所有工具集成。</li>\n<li>可扩展：Jenkins 可以通过其插件架构进行扩展，为 Jenkins 可以做的事情提供几乎无限的可能性。</li>\n<li>分散式：Jenkins 可以轻松地在多台机器上分配工作，帮助更快地跨多个平台推动构建、测试和部署。</li>\n</ul>\n<h1 id=\"二-docker安装jenkins\"><a class=\"markdownIt-Anchor\" href=\"#二-docker安装jenkins\">#</a> 二、<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1Eb2NrZXIlRTUlQUUlODklRTglQTMlODVKZW5raW5zJmFtcDtzcG09MTAwMS4yMTAxLjMwMDEuNzAyMA==\">Docker 安装 Jenkins</span></h1>\n<h2 id=\"1-docker-search-jenkins查询镜像\"><a class=\"markdownIt-Anchor\" href=\"#1-docker-search-jenkins查询镜像\">#</a> 1、docker search jenkins 查询镜像</h2>\n<h3 id=\"11-正常查询结果\"><a class=\"markdownIt-Anchor\" href=\"#11-正常查询结果\">#</a> 1.1、正常查询结果</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]# docker search jenkins</span><br><span class=\"line\">NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class=\"line\">jenkins                            DEPRECATED; use &quot;jenkins/jenkins:lts&quot; instead   5504                [OK]                </span><br><span class=\"line\">jenkins/jenkins                    The leading open source automation server       3087                                    </span><br><span class=\"line\">jenkins/jnlp-slave                 a Jenkins agent which can connect to Jenkins…   150                                     [OK]</span><br><span class=\"line\">jenkins/inbound-agent                                                              65                                      </span><br><span class=\"line\">bitnami/jenkins                    Bitnami Docker Image for Jenkins                53                                      [OK]</span><br><span class=\"line\">jenkins/slave                      base image for a Jenkins Agent, which includ…   48                                      [OK]</span><br><span class=\"line\">jenkins/agent                                                                      39                                      </span><br><span class=\"line\">jenkins/ssh-slave                  A Jenkins slave using SSH to establish conne…   38                                      [OK]</span><br><span class=\"line\">jenkins/ssh-agent                  Docker image for Jenkins agents connected ov…   24                                      </span><br><span class=\"line\">jenkins/jnlp-agent-docker                                                          8                                       </span><br><span class=\"line\">jenkins/jnlp-agent-maven           A JNLP-based agent with Maven 3 built in        7                                       </span><br><span class=\"line\">jenkins/pct                        Plugin Compat Tester                            5                                       [OK]</span><br><span class=\"line\">jenkins/jenkins-experimental       Experimental images of Jenkins. These images…   3                                       [OK]</span><br><span class=\"line\">jenkins/jnlp-agent-python          A JNLP-based agent with Python built in         3                                       </span><br><span class=\"line\">jenkins/jnlp-agent-alpine                                                          2                                       </span><br><span class=\"line\">jenkins/jnlp-agent-node                                                            1                                       </span><br><span class=\"line\">rancher/jenkins-jenkins                                                            1                                       </span><br><span class=\"line\">jenkins/ath                        Jenkins Acceptance Test Harness                 1                                       [OK]</span><br><span class=\"line\">jenkins/core-changelog-generator   Tool for generating Jenkins core changelogs     1                                       </span><br><span class=\"line\">jenkins/jenkinsfile-runner         Jenkinsfile Runner packages                     1                                       </span><br><span class=\"line\">jenkins/core-pr-tester             Docker image for testing pull-requests sent …   1                                       </span><br><span class=\"line\">jenkins/jnlp-agent-ruby                                                            1                                       </span><br><span class=\"line\">jenkins/remoting-kafka-agent       Remoting Kafka Agent                            1                                       [OK]</span><br><span class=\"line\">rancher/jenkins-jnlp-slave                                                         0                                       </span><br><span class=\"line\">rancher/jenkins-slave              Jenkins Build Slave                             0                                       [OK]</span><br><span class=\"line\">[root@localhost ~]# ^C</span><br><span class=\"line\">[root@localhost ~]# </span><br></pre></td></tr></table></figure>\n<h3 id=\"12-可能异常情况这个异常解决方法为下面第2点\"><a class=\"markdownIt-Anchor\" href=\"#12-可能异常情况这个异常解决方法为下面第2点\">#</a> 1.2、可能异常情况，这个异常解决方法为下面第 2 点</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/07f347955491462592d6f37cc2394fc6.png\" alt=\"img\"></p>\n<h2 id=\"2-上面报这个error解决方法\"><a class=\"markdownIt-Anchor\" href=\"#2-上面报这个error解决方法\">#</a> 2、上面报这个 ERROR 解决方法</h2>\n<h3 id=\"21-更新时间同步即可ntpdate-cnpoolntporg\"><a class=\"markdownIt-Anchor\" href=\"#21-更新时间同步即可ntpdate-cnpoolntporg\">#</a> 2.1、更新<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTYlOTclQjYlRTklOTclQjQlRTUlOTAlOEMlRTYlQUQlQTUmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\">时间同步</span>即可：ntpdate <span class=\"exturl\" data-url=\"aHR0cDovL2NuLnBvb2wubnRwLm9yZw==\">cn.pool.ntp.org</span></h3>\n<h3 id=\"22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate\"><a class=\"markdownIt-Anchor\" href=\"#22-如果提示不存在-ntpdate-命令需要先安装该命令yum-install-ntpdate\">#</a> 2.2、如果提示不存在 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1udHBkYXRlJmFtcDtzcG09MTAwMS4yMTAxLjMwMDEuNzAyMA==\">ntpdate</span> 命令需要先安装该命令：yum install ntpdate</h3>\n<h3 id=\"23-date中国时间\"><a class=\"markdownIt-Anchor\" href=\"#23-date中国时间\">#</a> 2.3、date 中国时间</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/315167c9692b4ebbad480fdffdf439c0.png\" alt=\"img\"></p>\n<h2 id=\"3-docker-pull-jenkinsciblueocean拉取jenkins镜像\"><a class=\"markdownIt-Anchor\" href=\"#3-docker-pull-jenkinsciblueocean拉取jenkins镜像\">#</a> 3、****docker pull jenkinsci/blueocean**** 拉取 Jenkins 镜像</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1ef511da220c4ca4bca8143aa55c9e52.png\" alt=\"img\"></p>\n<h2 id=\"4-docker-images-查看本地镜像\"><a class=\"markdownIt-Anchor\" href=\"#4-docker-images-查看本地镜像\">#</a> 4、docker images 查看本地镜像</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d9690427ee344603ac96cfa1a6a5510c.png\" alt=\"img\"></p>\n<h2 id=\"5-centos7安装jdk安装-已有jdk可以跳过\"><a class=\"markdownIt-Anchor\" href=\"#5-centos7安装jdk安装-已有jdk可以跳过\">#</a> 5、CentOS7 安装 JDK 安装 已有 JDK 可以跳过</h2>\n<h3 id=\"51-可以下载linux版本targz压缩包到本地不用解压\"><a class=\"markdownIt-Anchor\" href=\"#51-可以下载linux版本targz压缩包到本地不用解压\">#</a> 5.1、可以下载 linux 版本 tar.gz 压缩包到本地不用解压</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b413890d2adc4b8ea27f016d215c14e7.png\" alt=\"img\"></p>\n<h3 id=\"52-cd-usr-mkdir-java进入usr创建java文件夹\"><a class=\"markdownIt-Anchor\" href=\"#52-cd-usr-mkdir-java进入usr创建java文件夹\">#</a> 5.2、****cd /usr, mkdir java**** 进入 usr 创建 java 文件夹</h3>\n<h3 id=\"53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里\"><a class=\"markdownIt-Anchor\" href=\"#53-cd-java进入java文件夹用rz将linux版的jdk压缩包上传到这里\">#</a> 5.3、****cd java*<em><strong> 进入 java 文件夹，用</strong></em> * rz**** 将 linux 版的 jdk 压缩包上传到这里</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/32e9bd440462402a80f0aa6a0ef32a18.png\" alt=\"img\"></p>\n<h3 id=\"54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令\"><a class=\"markdownIt-Anchor\" href=\"#54-将jdk移到javamv-jdk-8u301-linux-x64targz-usrjava移动文件命令\">#</a> 5.4、(将 JDK 移到 java，mv jdk-8u301-linux-x64.tar.gz/usr/java) 移动文件命令</h3>\n<h3 id=\"55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现\"><a class=\"markdownIt-Anchor\" href=\"#55-tar-zxvf-jdk-8u301-linux-x64targz解压会有jdk180_301出现\">#</a> 5.5、<em><strong>*tar*</strong></em> <em><strong>*-*</strong></em><em><strong>*zxvf*</strong></em> jdk-8u301-linux-x64.tar.gz，解压会有 jdk1.8.0_301 出现</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/100d06f1ce4e4ee7b4b209cbf37491db.png\" alt=\"img\"></p>\n<h3 id=\"56-vi-etcprofile配置linux系统jdk环境变量\"><a class=\"markdownIt-Anchor\" href=\"#56-vi-etcprofile配置linux系统jdk环境变量\">#</a> 5.6、****vi /etc/profile**** 配置 linux 系统 JDK 环境变量</h3>\n<p><strong>1) 配置内容</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export JAVA_HOME=/usr/java/jdk1.8.0_301</span><br><span class=\"line\">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre</span><br></pre></td></tr></table></figure>\n<h3 id=\"57-source-etcprofile使配置生效\"><a class=\"markdownIt-Anchor\" href=\"#57-source-etcprofile使配置生效\">#</a> 5.7、****source /etc/profile**** 使配置生效</h3>\n<h3 id=\"58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到\"><a class=\"markdownIt-Anchor\" href=\"#58-sudo-yum-install-glibci686可能报错解决方案-否则会会报找不到\">#</a> 5.8、<em><strong>*sudo yum install glibc.i686*</strong></em>，可能报错解决方案、否则会会报找不到</h3>\n<h3 id=\"59-java-version测试出现如下即为成功\"><a class=\"markdownIt-Anchor\" href=\"#59-java-version测试出现如下即为成功\">#</a> 5.9、****java -version**** 测试，出现如下即为成功</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f3cca3db43c84bf79be1bfa8282c4ba9.png\" alt=\"img\"></p>\n<h2 id=\"6-centos7安装maven\"><a class=\"markdownIt-Anchor\" href=\"#6-centos7安装maven\">#</a> 6、CentOS7 安装 Maven</h2>\n<h3 id=\"61-cd-usrlocal\"><a class=\"markdownIt-Anchor\" href=\"#61-cd-usrlocal\">#</a> 6.1、<em><strong>*cd /usr/local*</strong></em></h3>\n<h3 id=\"62-rz上传tar-zxvf-apache-maven-361-bintargz解压\"><a class=\"markdownIt-Anchor\" href=\"#62-rz上传tar-zxvf-apache-maven-361-bintargz解压\">#</a> 6.2、****rz*<em><strong> 上传，</strong></em>*tar -zxvf apache-maven-3.6.1-bin.tar.gz**** 解压</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/1055aa0df0184f6bb28bde13fed60bc5.png\" alt=\"img\"></p>\n<h3 id=\"63-vi-etcprofile\"><a class=\"markdownIt-Anchor\" href=\"#63-vi-etcprofile\">#</a> 6.3、<em><strong>*vi /etc/profile*</strong></em></h3>\n<h3 id=\"64-source-etcprofile刷新环境变量\"><a class=\"markdownIt-Anchor\" href=\"#64-source-etcprofile刷新环境变量\">#</a> 6.4、****source /etc/profile**** 刷新环境变量</h3>\n<h3 id=\"65-mvn-v查看版本\"><a class=\"markdownIt-Anchor\" href=\"#65-mvn-v查看版本\">#</a> 6.5、****mvn -v**** 查看版本</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost local]# mvn -v</span><br><span class=\"line\">Apache Maven 3.6.3 (cecedd343002696d0abb50b32b541b8a6ba2883f)</span><br><span class=\"line\">Maven home: /usr/local/apache-maven-3.6.3</span><br><span class=\"line\">Java version: 1.8.0_301, vendor: Oracle Corporation, runtime: /usr/java/jdk1.8.0_301/jre</span><br><span class=\"line\">Default locale: en_US, platform encoding: UTF-8</span><br><span class=\"line\">OS name: &quot;linux&quot;, version: &quot;3.10.0-1127.el7.x86_64&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;</span><br><span class=\"line\">[root@localhost local]# </span><br></pre></td></tr></table></figure>\n<p>到此 JDK、Maven 环境准备完成</p>\n<h2 id=\"7-启动容器并挂载上面配置的环境\"><a class=\"markdownIt-Anchor\" href=\"#7-启动容器并挂载上面配置的环境\">#</a> 7、<em><strong>* 启动容器，并 *</strong></em><em><strong>* 挂载上面配置的环境 *</strong></em></h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run \\</span><br><span class=\"line\">-u root \\</span><br><span class=\"line\">-d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">-p 8001:8080 \\</span><br><span class=\"line\">-p 50000:50000 \\</span><br><span class=\"line\">-v /var/run/docker.sock:/var/run/docker.sock \\</span><br><span class=\"line\">-v /var/jenkins_home:/var/jenkins_home \\</span><br><span class=\"line\">jenkinsci/blueocean</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/172131aa0a9f47b3a15e5bd5d4555986.png\" alt=\"img\"></p>\n<h2 id=\"9-访问jenkins提示输入密码\"><a class=\"markdownIt-Anchor\" href=\"#9-访问jenkins提示输入密码\">#</a> 9、访问 Jenkins，提示输入密码</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2b6d909e4c4e46efaa98216f1c33fdf7.png\" alt=\"img\"></p>\n<h2 id=\"10-初次可以选择推荐的\"><a class=\"markdownIt-Anchor\" href=\"#10-初次可以选择推荐的\">#</a> 10、初次可以选择推荐的</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5e9a6ebdd6954093bf6a23f4f876221a.png\" alt=\"img\"></p>\n<h2 id=\"11-等待安装\"><a class=\"markdownIt-Anchor\" href=\"#11-等待安装\">#</a> 11、 <strong>等待安装</strong></h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/25caae9dae8b49878adca5e32647e915.png\" alt=\"img\"></p>\n<h2 id=\"12-如下访问jenkins成功啦\"><a class=\"markdownIt-Anchor\" href=\"#12-如下访问jenkins成功啦\">#</a> 12、如下访问 Jenkins 成功啦</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/4beeeb654aec4e608a22ce6b49afa1ae.png\" alt=\"img\"></p>\n<p>到此就结束 Docker 安装 Jenkins 啦，后面的章节将介绍如何配置 jenkins，敬请期待！</p>\n<h6 id=\"版权声明本文为csdn博主卡布奇诺-海晨的原创文章遵循cc-40-by-sa版权协议转载请附上原文出处链接及本声明\"><a class=\"markdownIt-Anchor\" href=\"#版权声明本文为csdn博主卡布奇诺-海晨的原创文章遵循cc-40-by-sa版权协议转载请附上原文出处链接及本声明\">#</a> 版权声明：本文为 CSDN 博主「卡布奇诺 - 海晨」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</h6>\n<h6 id=\"原文链接httpsblogcsdnnetqq_57756904articledetails125697440\"><a class=\"markdownIt-Anchor\" href=\"#原文链接httpsblogcsdnnetqq_57756904articledetails125697440\">#</a> 原文链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzU3NzU2OTA0L2FydGljbGUvZGV0YWlscy8xMjU2OTc0NDA=\">https://blog.csdn.net/qq_57756904/article/details/125697440</span></h6>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2023/01/04/Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%83%A8%E7%BD%B2RocketMQ%E4%BB%A5%E5%8F%8AConsole/",
            "url": "http://example.com/2023/01/04/Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%83%A8%E7%BD%B2RocketMQ%E4%BB%A5%E5%8F%8AConsole/",
            "title": "Docker环境下部署RocketMQ以及Console",
            "date_published": "2023-01-04T00:25:41.825Z",
            "content_html": "<h1 id=\"docker环境下部署rocketmq以及console\"><a class=\"markdownIt-Anchor\" href=\"#docker环境下部署rocketmq以及console\">#</a> Docker 环境下部署 RocketMQ 以及 Console</h1>\n<h2 id=\"1docker-安装rocketmq镜像\"><a class=\"markdownIt-Anchor\" href=\"#1docker-安装rocketmq镜像\">#</a> 1.docker 安装 rocketmq 镜像</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#拉取镜像 </span><br><span class=\"line\">docker pull foxiswho/rocketmq:server-4.7.0</span><br><span class=\"line\">docker pull foxiswho/rocketmq:broker-4.7.0</span><br></pre></td></tr></table></figure>\n<h2 id=\"2创建server和broker目录并在目录opt下创建brokerconf\"><a class=\"markdownIt-Anchor\" href=\"#2创建server和broker目录并在目录opt下创建brokerconf\">#</a> 2. 创建 server 和 broker 目录，并在目录 /opt 下创建 broker.conf</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">创建目录</span></span><br><span class=\"line\">mkdir /opt/rocketmq-server</span><br><span class=\"line\">mkdir /opt/rocketmq-broker/conf -p</span><br><span class=\"line\">[root@localhost opt]# cat /opt/rocketmq-broker/conf/broker.conf </span><br><span class=\"line\">namesrvAddr=&#123;YourNameIPAddr&#125; eg：192.168.1.200:9876</span><br><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">brokerName = broker-a</span><br><span class=\"line\">brokerId = 0</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\">brokerIP1 = &#123;YourBrokerIPAddr&#125; eg：192.168.1.200</span><br><span class=\"line\">listenPort=10911</span><br></pre></td></tr></table></figure>\n<h2 id=\"3启动容器并在防火墙放行端口-9876-10911-11011\"><a class=\"markdownIt-Anchor\" href=\"#3启动容器并在防火墙放行端口-9876-10911-11011\">#</a> 3. 启动容器并在防火墙放行端口 9876 、10911 、11011</h2>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RocketMQ默认使用3个端口：9876 、10911 、11011</span><br><span class=\"line\">如果防火墙没有关闭的话，那么防火墙就必须开放这些端口：</span><br><span class=\"line\">nameserver 默认使用 9876 端口</span><br><span class=\"line\">master 默认使用 10911 端口</span><br><span class=\"line\">slave 默认使用11011 端口</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动rocketmq-server</span></span><br><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">--name rmqnamesrv \\</span><br><span class=\"line\">-p 9876:9876 \\</span><br><span class=\"line\">-v /opt/rocketmq-server/logs:/root/logs \\</span><br><span class=\"line\">-v /opt/rocketmq-server/store:/root/store \\</span><br><span class=\"line\">-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \\</span><br><span class=\"line\">foxiswho/rocketmq:4.7.0 \\</span><br><span class=\"line\">sh mqnamesrv</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动rocketmq-broker</span></span><br><span class=\"line\">docker run -d  \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">--name rmqbroker \\</span><br><span class=\"line\">--link rmqnamesrv:namesrv \\</span><br><span class=\"line\">-p 10911:10911 \\</span><br><span class=\"line\">-p 10909:10909 \\</span><br><span class=\"line\">-v  /opt/rocketmq-broker/logs:/root/logs \\</span><br><span class=\"line\">-v  /opt/rocketmq-broker/store:/root/store \\</span><br><span class=\"line\">-v /opt/rocketmq-broker/conf/broker.conf:/opt/rocketmq-4.7.0/conf/broker.conf \\</span><br><span class=\"line\">-e &quot;NAMESRV_ADDR=namesrv:9876&quot; \\</span><br><span class=\"line\">-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \\</span><br><span class=\"line\">-e &quot;autoCreateTopicEnable=true&quot; \\</span><br><span class=\"line\">foxiswho/rocketmq:4.7.0 \\</span><br><span class=\"line\">sh mqbroker -c /opt/rocketmq-4.7.0/conf/broker.conf</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动RocketMQ的管理工具rocketmq-console</span></span><br><span class=\"line\">docker run -itd -e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.1.200:9876 -Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; -p 9877:8080 -t styletang/rocketmq-console-ng:latest</span><br></pre></td></tr></table></figure>\n<h2 id=\"4测试访问console控制台\"><a class=\"markdownIt-Anchor\" href=\"#4测试访问console控制台\">#</a> 4. 测试访问 console 控制台</h2>\n<p>浏览器输入：192.168.1.200:9877</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20230104082814121.png\" alt=\"image-20230104082814121\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/29/TheadLocal/",
            "url": "http://example.com/2022/12/29/TheadLocal/",
            "title": "ThreadLocal",
            "date_published": "2022-12-29T09:20:11.710Z",
            "content_html": "<h1 id=\"threadlocal-详解\"><a class=\"markdownIt-Anchor\" href=\"#threadlocal-详解\">#</a> ThreadLocal 详解</h1>\n<p>ThreadLocal 概述<br>\n ThreadLocal 类用来提供线程内部的局部变量，不同的线程之间不会相互干扰<br>\n这种变量在多线程环境下访问（通过 get 和 set 方法访问）时能保证各个线程的变量相对独立于其他线程内的变量<br>\n在线程的生命周期内起作用，可以减少同一个线程内多个函数或组件之间一些公共变量传递的复杂度<br>\n使用<br>\n常用方法</p>\n<table>\n<thead>\n<tr>\n<th><strong>方法名</strong></th>\n<th><strong>描述</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ThreadLocal()</td>\n<td>创建 ThreadLocal 对象</td>\n</tr>\n<tr>\n<td>public void set( T value)</td>\n<td>设置当前线程绑定的局部变量</td>\n</tr>\n<tr>\n<td>public T get()</td>\n<td>获取当前线程绑定的局部变量</td>\n</tr>\n<tr>\n<td>public T remove()</td>\n<td>移除当前线程绑定的局部变量，该方法可以帮助 JVM 进行 GC</td>\n</tr>\n<tr>\n<td>protected T initialValue()</td>\n<td>返回当前线程局部变量的初始值</td>\n</tr>\n</tbody>\n</table>\n<p>案例<br>\n场景：让每个线程获取其设置的对应的共享变量值<br>\n共享变量访问问题案例</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 线程间访问共享变量之间问题</span></span><br><span class=\"line\"><span class=\"comment\"> * */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DemoQuestion</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">DemoQuestion</span> <span class=\"variable\">demoQuestion</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DemoQuestion</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// int j = i;</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt;&#123;</span><br><span class=\"line\">                <span class=\"comment\">// demoQuestion.setAge(j);</span></span><br><span class=\"line\">                demoQuestion.setName(Thread.currentThread().getName() + <span class=\"string\">&quot;的数据&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;=================&quot;</span>);</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;---&gt;&quot;</span> + demoQuestion.getName());</span><br><span class=\"line\">                <span class=\"comment\">// System.out.println(Thread.currentThread().getName() + &quot;---&gt;&quot; + demoQuestion.getAge());</span></span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;t&quot;</span> + i).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAge</span><span class=\"params\">(<span class=\"type\">int</span> age)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用关键字 Synchronized 关键字加锁解决方案</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 使用加锁的方式解决：线程间访问共享变量之间问题</span></span><br><span class=\"line\"><span class=\"comment\"> * 将对共享变量的操作进行加锁，保证其原子性</span></span><br><span class=\"line\"><span class=\"comment\"> * */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SolveDemoQuestionBySynchronized</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SolveDemoQuestionBySynchronized</span> <span class=\"variable\">demoQuestion</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SolveDemoQuestionBySynchronized</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// int j = i;</span></span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt;&#123;</span><br><span class=\"line\">                <span class=\"keyword\">synchronized</span> (SolveDemoQuestionBySynchronized.class)&#123;</span><br><span class=\"line\">                    demoQuestion.setName(Thread.currentThread().getName() + <span class=\"string\">&quot;的数据&quot;</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot;=================&quot;</span>);</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;---&gt;&quot;</span> + demoQuestion.getName());</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;t&quot;</span> + i).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAge</span><span class=\"params\">(<span class=\"type\">int</span> age)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>使用 ThreadLocal 方式解决</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SolveDemoQuestionByThreadLocal</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span>  ThreadLocal&lt;String&gt; name = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocal</span>&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SolveDemoQuestionByThreadLocal</span> <span class=\"variable\">demoQuestion</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SolveDemoQuestionByThreadLocal</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt;&#123;</span><br><span class=\"line\">                demoQuestion.setName(Thread.currentThread().getName() + <span class=\"string\">&quot;的数据&quot;</span>);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;=================&quot;</span>);</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;---&gt;&quot;</span> + demoQuestion.getName());</span><br><span class=\"line\">            &#125;,<span class=\"string\">&quot;t&quot;</span> + i).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> name.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String content)</span> &#123;</span><br><span class=\"line\">        name.set(content);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAge</span><span class=\"params\">(<span class=\"type\">int</span> age)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"threadlocalmap-内部结果\"><a class=\"markdownIt-Anchor\" href=\"#threadlocalmap-内部结果\">#</a> ThreadLocalMap 内部结果</h2>\n<blockquote>\n<p>JDK8 之前的设计<br>\n每个 ThreadLocal 都创建一个 ThreadLocalMap，用线程作为 ThreadLocalMap 的 key，要存储的局部变量作为 ThreadLocalMap 的 value，这样就能达到各个线程的局部变量隔离的效果</p>\n</blockquote>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/baa00cdb33a14aaeab7b453c1bb1469b.png\" alt=\"在这里插入图片描述\"></p>\n<p>JDK8 之后的设计<br>\n每个 Thread 维护一个 ThreadLocalMap，这个 ThreadLocalMap 的 key 是 ThreadLocal 实例本身，value 才是真正要存储的值 Object<br>\n 每个 Thread 线程内部都有一个 ThreadLocalMap<br>\nMap 里面存储 ThreadLocal 对象（key）和线程的变量副本（value）<br>\nThread 内部的 Map 是由 ThreadLocal 维护的，由 ThreadLocal 负责向 map 获取和设置线程的变量值<br>\n对于不同的线程，每次获取副本值时，别的线程并不能获取到当前线程的副本值，形成了副本的隔离，互不干扰</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5633b9ff01d84aaeb06b799d825e289e.png\" alt=\"在这里插入图片描述\"></p>\n<p>JDK 对 ThreadLocal 这样改造的好处<br>\n减少 ThreadLocalMap 存储的 Entry 数量：因为之前的存储数量由 Thread 的数量决定，现在是由 ThreadLocal 的数量决定。在实际运用当中，往往 ThreadLocal 的数量要少于 Thread 的数量<br>\n当 Thread 销毁之后，对应的 ThreadLocalMap 也会随之销毁，能减少内存的使用（但是不能避免内存泄漏问题，解决内存泄漏问题应该在使用完后及时调用 remove () 对 ThreadMap 里的 Entry 对象进行移除，由于 Entry 继承了弱引用类，会在下次 GC 时被 JVM 回收）</p>\n<h2 id=\"threadlocal相关方法源码解析\"><a class=\"markdownIt-Anchor\" href=\"#threadlocal相关方法源码解析\">#</a> ThreadLocal 相关方法源码解析</h2>\n<h3 id=\"set方法\"><a class=\"markdownIt-Anchor\" href=\"#set方法\">#</a> set 方法</h3>\n<ul>\n<li>源码及相关注释</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 设置当前线程对应的ThreadLocal的值</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> value 将要保存在当前线程对应的ThreadLocal的值</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">set</span><span class=\"params\">(T value)</span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// 获取当前线程对象</span></span><br><span class=\"line\">       <span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">       <span class=\"comment\">// 获取此线程对象中维护的ThreadLocalMap对象</span></span><br><span class=\"line\">       <span class=\"type\">ThreadLocalMap</span> <span class=\"variable\">map</span> <span class=\"operator\">=</span> getMap(t);</span><br><span class=\"line\">       <span class=\"comment\">// 判断map是否存在</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (map != <span class=\"literal\">null</span>)</span><br><span class=\"line\">           <span class=\"comment\">// 存在则调用map.set设置此实体entry,this这里指调用此方法的ThreadLocal对象</span></span><br><span class=\"line\">           map.set(<span class=\"built_in\">this</span>, value);</span><br><span class=\"line\">       <span class=\"keyword\">else</span></span><br><span class=\"line\">           <span class=\"comment\">// 1）当前线程Thread 不存在ThreadLocalMap对象</span></span><br><span class=\"line\">           <span class=\"comment\">// 2）则调用createMap进行ThreadLocalMap对象的初始化</span></span><br><span class=\"line\">           <span class=\"comment\">// 3）并将 t(当前线程)和value(t对应的值)作为第一个entry存放至ThreadLocalMap中</span></span><br><span class=\"line\">           createMap(t, value);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 获取当前线程Thread对应维护的ThreadLocalMap </span></span><br><span class=\"line\"><span class=\"comment\">    * </span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span>  t the current thread 当前线程</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> the map 对应维护的ThreadLocalMap </span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   ThreadLocalMap <span class=\"title function_\">getMap</span><span class=\"params\">(Thread t)</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> t.threadLocals;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   </span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    *创建当前线程Thread对应维护的ThreadLocalMap </span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> t 当前线程</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@param</span> firstValue 存放到map中第一个entry的值</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">createMap</span><span class=\"params\">(Thread t, T firstValue)</span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">//这里的this是调用此方法的threadLocal</span></span><br><span class=\"line\">       t.threadLocals = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocalMap</span>(<span class=\"built_in\">this</span>, firstValue);</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>相关流程图</li>\n</ul>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/2430f09d315e40769a63720f84a8a06c.png\" alt=\"在这里插入图片描述\"></p>\n<ul>\n<li>执行流程</li>\n</ul>\n<ol>\n<li>获取当前线程，并根据当前线程获取一个 Map</li>\n<li>如果获取的 Map 不为空，则将参数设置到 Map 中（当前 ThreadLocal 的引用作为 key）</li>\n<li>如果 Map 为空，则给该线程创建 Map，并设置初始值</li>\n</ol>\n<h3 id=\"get方法\"><a class=\"markdownIt-Anchor\" href=\"#get方法\">#</a> get () 方法</h3>\n<ul>\n<li>源码及相关注释</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 返回当前线程中保存ThreadLocal的值</span></span><br><span class=\"line\"><span class=\"comment\">    * 如果当前线程没有此ThreadLocal变量，</span></span><br><span class=\"line\"><span class=\"comment\">    * 则它会通过调用&#123;<span class=\"doctag\">@link</span> #initialValue&#125; 方法进行初始化值</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> 返回当前线程对应此ThreadLocal的值</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> T <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// 获取当前线程对象</span></span><br><span class=\"line\">       <span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">       <span class=\"comment\">// 获取此线程对象中维护的ThreadLocalMap对象</span></span><br><span class=\"line\">       <span class=\"type\">ThreadLocalMap</span> <span class=\"variable\">map</span> <span class=\"operator\">=</span> getMap(t);</span><br><span class=\"line\">       <span class=\"comment\">// 如果此map存在</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (map != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">           <span class=\"comment\">// 以当前的ThreadLocal 为 key，调用getEntry获取对应的存储实体e</span></span><br><span class=\"line\">           ThreadLocalMap.<span class=\"type\">Entry</span> <span class=\"variable\">e</span> <span class=\"operator\">=</span> map.getEntry(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">           <span class=\"comment\">// 对e进行判空 </span></span><br><span class=\"line\">           <span class=\"keyword\">if</span> (e != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">               <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">               <span class=\"comment\">// 获取存储实体 e 对应的 value值,即为我们想要的当前线程对应此ThreadLocal的值</span></span><br><span class=\"line\">               <span class=\"type\">T</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> (T)e.value;</span><br><span class=\"line\">               <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">       \t初始化 : 有两种情况有执行当前代码</span></span><br><span class=\"line\"><span class=\"comment\">       \t第一种情况: map不存在，表示此线程没有维护的ThreadLocalMap对象</span></span><br><span class=\"line\"><span class=\"comment\">       \t第二种情况: map存在, 但是没有与当前ThreadLocal关联的entry</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> setInitialValue();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 初始化</span></span><br><span class=\"line\"><span class=\"comment\">    * <span class=\"doctag\">@return</span> the initial value 初始化后的值</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> T <span class=\"title function_\">setInitialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       <span class=\"comment\">// 调用initialValue获取初始化的值</span></span><br><span class=\"line\">       <span class=\"comment\">// 此方法可以被子类重写, 如果不重写默认返回null</span></span><br><span class=\"line\">       <span class=\"type\">T</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> initialValue();</span><br><span class=\"line\">       <span class=\"comment\">// 获取当前线程对象</span></span><br><span class=\"line\">       <span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">       <span class=\"comment\">// 获取此线程对象中维护的ThreadLocalMap对象</span></span><br><span class=\"line\">       <span class=\"type\">ThreadLocalMap</span> <span class=\"variable\">map</span> <span class=\"operator\">=</span> getMap(t);</span><br><span class=\"line\">       <span class=\"comment\">// 判断map是否存在</span></span><br><span class=\"line\">       <span class=\"keyword\">if</span> (map != <span class=\"literal\">null</span>)</span><br><span class=\"line\">           <span class=\"comment\">// 存在则调用map.set设置此实体entry</span></span><br><span class=\"line\">           map.set(<span class=\"built_in\">this</span>, value);</span><br><span class=\"line\">       <span class=\"keyword\">else</span></span><br><span class=\"line\">           <span class=\"comment\">// 1）当前线程Thread 不存在ThreadLocalMap对象</span></span><br><span class=\"line\">           <span class=\"comment\">// 2）则调用createMap进行ThreadLocalMap对象的初始化</span></span><br><span class=\"line\">           <span class=\"comment\">// 3）并将 t(当前线程)和value(t对应的值)作为第一个entry存放至ThreadLocalMap中</span></span><br><span class=\"line\">           createMap(t, value);</span><br><span class=\"line\">       <span class=\"comment\">// 返回设置的值value</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>流程图</li>\n</ul>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/a7e417b2719348729b4229071e4d3f4f.png\" alt=\"在这里插入图片描述\"></p>\n<p>执行流程<br>\n获取当前线程，根据当前线程获取一个 Map<br>\n 如果获取的 Map 不为空，则在 Map 中以 ThreadLocal 的引用作为 key 来在 Map 中获取对应的 Entrye，否则转到 4<br>\n 如果 e 不为 null，则返回 e.value，否则转到 4<br>\nMap 为空或者 e 为空，则通过 initialValue 函数获取初始值 value，然后用 ThreadLocal 的引用和 value 作为 firstKey 和 firstValue 创建一个新的 Map</p>\n<h2 id=\"remove方法\"><a class=\"markdownIt-Anchor\" href=\"#remove方法\">#</a> remove 方法</h2>\n<ul>\n<li>源码及相关注释</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除当前线程中保存的ThreadLocal对应的实体entry</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">     <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">remove</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取当前线程对象中维护的ThreadLocalMap对象</span></span><br><span class=\"line\">         <span class=\"type\">ThreadLocalMap</span> <span class=\"variable\">m</span> <span class=\"operator\">=</span> getMap(Thread.currentThread());</span><br><span class=\"line\">        <span class=\"comment\">// 如果此map存在</span></span><br><span class=\"line\">         <span class=\"keyword\">if</span> (m != <span class=\"literal\">null</span>)</span><br><span class=\"line\">            <span class=\"comment\">// 存在则调用map.remove</span></span><br><span class=\"line\">            <span class=\"comment\">// 以当前ThreadLocal为key删除对应的实体entry</span></span><br><span class=\"line\">             m.remove(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">     &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>执行流程</li>\n</ul>\n<ol>\n<li>首先获取当前线程，并根据当前线程获取一个 Map</li>\n<li>如果获取的 Map 不为空，则移除当前 ThreadLocal 对象对应的 entry</li>\n</ol>\n<p>initialValue 方法<br>\n此方法的作用是返回该线程局部变量的初始值<br>\n这个方法是一个延迟调用方法，从上面的代码我们得知，在 set 方法还未调用而先调用了 get 方法时才执行，并且仅执行 1 次<br>\n这个方法缺省实现直接返回一个 null<br>\n 如果想要一个除 null 之外的初始值，可以重写此方法。（备注： 该方法是一个 protected 的方法，显然是为了让子类覆盖而设计的）<br>\n源码及相关注释</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * 返回当前线程对应的ThreadLocal的初始值</span></span><br><span class=\"line\"><span class=\"comment\">  * 此方法的第一次调用发生在，当线程通过get方法访问此线程的ThreadLocal值时</span></span><br><span class=\"line\"><span class=\"comment\">  * 除非线程先调用了set方法，在这种情况下，initialValue 才不会被这个线程调用。</span></span><br><span class=\"line\"><span class=\"comment\">  * 通常情况下，每个线程最多调用一次这个方法。</span></span><br><span class=\"line\"><span class=\"comment\">  *</span></span><br><span class=\"line\"><span class=\"comment\">  * &lt;p&gt;这个方法仅仅简单的返回null &#123;<span class=\"doctag\">@code</span> null&#125;;</span></span><br><span class=\"line\"><span class=\"comment\">  * 如果想ThreadLocal线程局部变量有一个除null以外的初始值，</span></span><br><span class=\"line\"><span class=\"comment\">  * 必须通过子类继承&#123;<span class=\"doctag\">@code</span> ThreadLocal&#125; 的方式去重写此方法</span></span><br><span class=\"line\"><span class=\"comment\">  * 通常, 可以通过匿名内部类的方式实现</span></span><br><span class=\"line\"><span class=\"comment\">  *</span></span><br><span class=\"line\"><span class=\"comment\">  * <span class=\"doctag\">@return</span> 当前ThreadLocal的初始值</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\"><span class=\"keyword\">protected</span> T <span class=\"title function_\">initialValue</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ThreadLocalMap 解析</p>\n<h2 id=\"内部结构\"><a class=\"markdownIt-Anchor\" href=\"#内部结构\">#</a> 内部结构</h2>\n<p>ThreadLocalMap 是 ThreadLocal 的内部类，没有实现 Map 接口，用独立的方式实现了 Map 的功能，其内部的 Entry 也是独立实现的，而 Entry 又是 ThreadLocalMap 的内部类，且集成弱引用 (WeakReference) 类。</p>\n<h2 id=\"成员变量\"><a class=\"markdownIt-Anchor\" href=\"#成员变量\">#</a> 成员变量</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">        * The entries in this hash map extend WeakReference, using</span></span><br><span class=\"line\"><span class=\"comment\">        * its main ref field as the key (which is always a</span></span><br><span class=\"line\"><span class=\"comment\">        * ThreadLocal object).  Note that null keys (i.e. entry.get()</span></span><br><span class=\"line\"><span class=\"comment\">        * == null) mean that the key is no longer referenced, so the</span></span><br><span class=\"line\"><span class=\"comment\">        * entry can be expunged from table.  Such entries are referred to</span></span><br><span class=\"line\"><span class=\"comment\">        * as &quot;stale entries&quot; in the code that follows.</span></span><br><span class=\"line\"><span class=\"comment\">        * </span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t* Entry继承WeakReference，并且用ThreadLocal作为key.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t* 如果key为null(entry.get() == null)，意味着key不再被引用，</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t* 因此这时候entry也可以从table中清除。</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">       <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Entry</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; &#123;</span><br><span class=\"line\">           <span class=\"comment\">/** The value associated with this ThreadLocal. */</span></span><br><span class=\"line\">           Object value;</span><br><span class=\"line\"></span><br><span class=\"line\">           Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</span><br><span class=\"line\">               <span class=\"built_in\">super</span>(k);</span><br><span class=\"line\">               value = v;</span><br><span class=\"line\">           &#125;</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 初始容量 —— 必须是2的整次幂</span></span><br><span class=\"line\"><span class=\"comment\">    *  The initial capacity -- MUST be a power of two.  </span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">INITIAL_CAPACITY</span> <span class=\"operator\">=</span> <span class=\"number\">16</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 存放数据的table，Entry类的定义在下面分析</span></span><br><span class=\"line\"><span class=\"comment\">    * 同样，数组长度必须是2的整次幂。</span></span><br><span class=\"line\"><span class=\"comment\">    * The table, resized as necessary.</span></span><br><span class=\"line\"><span class=\"comment\">    * table.length MUST always be a power of two.</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> Entry[] table;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 数组里面entrys的个数，可以用于判断table当前使用量是否超过阈值。</span></span><br><span class=\"line\"><span class=\"comment\">    * The number of entries in the table</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 进行扩容的阈值，表使用量大于它的时候进行扩容。</span></span><br><span class=\"line\"><span class=\"comment\">    * The next size value at which to resize</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"type\">int</span> threshold; <span class=\"comment\">// Default to 0</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"弱引用和内存泄漏\"><a class=\"markdownIt-Anchor\" href=\"#弱引用和内存泄漏\">#</a> 弱引用和内存泄漏</h2>\n<p>弱引用相关概念<br>\n强引用（“Strong” Reference），就是我们最常见的普通对象引用，只要还有强引用指向一个对象，就能表明对象还 “活着”，垃圾回收器就不会回收这种对象<br>\n弱引用（WeakReference），垃圾回收器一旦发现了只具有弱引用的对象，不管当前内存空间足够与否，都会回收它的内存</p>\n<h2 id=\"内存泄漏相关概念\"><a class=\"markdownIt-Anchor\" href=\"#内存泄漏相关概念\">#</a> 内存泄漏相关概念</h2>\n<p>Memory overflow: 内存溢出，没有足够的内存提供申请者使用<br>\n Memory leak: 内存泄漏是指程序中己动态分配的堆内存由于某种原因程序未释放或无法释放，造成系统内存的浪费，导致程序运行速度减慢甚至系统崩溃等严重后果。内存泄漏的堆积终将导致内存溢出</p>\n<h2 id=\"内存泄漏与强弱引用关系\"><a class=\"markdownIt-Anchor\" href=\"#内存泄漏与强弱引用关系\">#</a> 内存泄漏与强弱引用关系</h2>\n<p>ThreadLocal 内存结构</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/7476f5b3aec44f20b884e118880925b1.png\" alt=\"在这里插入图片描述\"></p>\n<p>如果 key 使用强引用，也就是上图中的红色背景框部分<br>\n业务代码中使用完 ThreadLocal ，threadLocal Ref 被回收了<br>\n因为 threadLocalMap 的 Entry 强引用了 threadLocal，造成 threadLocal 无法被回收<br>\n在没有手动删除这个 Entry 以及 CurrentThread 依然运行的前提下，始终有强引用链 threadRef-&gt;currentThread-&gt;threadLocalMap-&gt;entry，Entry 就不会被回收（Entry 中包括了 ThreadLocal 实例和 value），导致 Entry 内存泄漏<br>\n如果 key 使用弱引用，也就是上图中的红色背景框部分<br>\n业务代码中使用完 ThreadLocal ，threadLocal Ref 被回收了<br>\n由于 ThreadLocalMap 只持有 ThreadLocal 的弱引用，没有任何强引用指向 threadlocal 实例，所以 threadlocal 就可以顺利被 gc 回收，此时 Entry 中的 key=null<br>\n 但是在没有手动删除这个 Entry 以及 CurrentThread 依然运行的前提下，也存在有强引用链 threadRef-&gt;currentThread-&gt;threadLocalMap-&gt;entry -&gt; value ，value 不会被回收， 而这块 value 永远不会被访问到了，导致 value 内存泄漏</p>\n<h2 id=\"出现内存泄漏的真实原因\"><a class=\"markdownIt-Anchor\" href=\"#出现内存泄漏的真实原因\">#</a> 出现内存泄漏的真实原因</h2>\n<p>没有手动删除对应的 Entry 节点信息<br>\n ThreadLocal 对象使用完后，对应线程仍然在运行</p>\n<h2 id=\"避免内存泄漏的的两种方式\"><a class=\"markdownIt-Anchor\" href=\"#避免内存泄漏的的两种方式\">#</a> 避免内存泄漏的的两种方式</h2>\n<p>使用完 ThreadLocal，调用其 remove 方法删除对应的 Entry<br>\n 使用完 ThreadLocal，当前 Thread 也随之运行结束<br>\n对于第一种方式很好控制，调用对应 remove () 方法即可，但是对于第二种方式，我们是很难控制的，正因为不好控制，这也是为什么 ThreadLocalMap 里对应的 Entry 对象继承弱引用的原因，因为使用了弱引用，当 ThreadLocal 使用完后，key 的引用就会为 null，而在调用 ThreadLocal 中的 get ()/set () 方法时，当判断 key 为 null 时会将 value 置为 null，这就就会在 jvm 下次 GC 时将对应的 Entry 对象回收，从而避免内存泄漏问题的出现。</p>\n<h2 id=\"hash冲突问题及解决方法\"><a class=\"markdownIt-Anchor\" href=\"#hash冲突问题及解决方法\">#</a> hash 冲突问题及解决方法</h2>\n<p>首先从 ThreadLocal 的 set () 方法入手</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void set(T value) &#123;</span><br><span class=\"line\">        Thread t = Thread.currentThread();</span><br><span class=\"line\">        ThreadLocal.ThreadLocalMap map = getMap(t);</span><br><span class=\"line\">        if (map != null)</span><br><span class=\"line\">            //调用了ThreadLocalMap的set方法</span><br><span class=\"line\">            map.set(this, value);</span><br><span class=\"line\">        else</span><br><span class=\"line\">            createMap(t, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    ThreadLocal.ThreadLocalMap getMap(Thread t) &#123;</span><br><span class=\"line\">        return t.threadLocals;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    void createMap(Thread t, T firstValue) &#123;</span><br><span class=\"line\">        \t//调用了ThreadLocalMap的构造方法</span><br><span class=\"line\">        t.threadLocals = new ThreadLocal.ThreadLocalMap(this, firstValue);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>构造方法 <code>ThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue)</code></p>\n</li>\n<li>\n<pre><code> /*\n  * firstKey : 本ThreadLocal实例(this)\n  * firstValue ： 要保存的线程本地变量\n  */\nThreadLocalMap(ThreadLocal&lt;?&gt; firstKey, Object firstValue) &#123;\n        //初始化table\n        table = new ThreadLocal.ThreadLocalMap.Entry[INITIAL_CAPACITY];\n        //计算索引(重点代码）\n        int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1);\n        //设置值\n        table[i] = new ThreadLocal.ThreadLocalMap.Entry(firstKey, firstValue);\n        size = 1;\n        //设置阈值\n        setThreshold(INITIAL_CAPACITY);\n    &#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">构造函数首先创建一个长度为16的Entry数组，然后计算出firstKey对应的索引，然后存储到table中，并设置size和threshold</span><br><span class=\"line\"></span><br><span class=\"line\">分析：int i = firstKey.threadLocalHashCode &amp; (INITIAL_CAPACITY - 1)</span><br><span class=\"line\">关于：firstKey.threadLocalHashCode</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\nprivate final int threadLocalHashCode = nextHashCode();\n    \n    private static int nextHashCode() &#123;\n        return nextHashCode.getAndAdd(HASH_INCREMENT);\n    &#125;\n//AtomicInteger是一个提供原子操作的Integer类，通过线程安全的方式操作加减,适合高并发情况下的使用\n    private static AtomicInteger nextHashCode =  new AtomicInteger();\n     //特殊的hash值\n    private static final int HASH_INCREMENT = 0x61c88647;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">这里定义了一个AtomicInteger类型，每次获取当前值并加上HASH_INCREMENT，HASH_INCREMENT = 0x61c88647,这个值跟斐波那契数列（黄金分割数）有关，其主要目的就是为了让哈希码能均匀的分布在2的n次方的数组里, 也就是Entry[] table中，这样做可以尽量避免hash冲突</span><br><span class=\"line\"></span><br><span class=\"line\">关于：&amp; (INITIAL_CAPACITY - 1)</span><br><span class=\"line\">计算hash的时候里面采用了hashCode &amp; (size - 1)的算法，这相当于取模运算hashCode % size的一个更高效的实现。正是因为这种算法，我们要求size必须是2的整次幂，这也能保证在索引不越界的前提下，使得hash发生冲突的次数减小</span><br><span class=\"line\">ThreadLocalMap中的set方法</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\nprivate void set(ThreadLocal&lt;?&gt; key, Object value) &#123;\n        ThreadLocal.ThreadLocalMap.Entry[] tab = table;\n        int len = tab.length;\n        //计算索引(重点代码，刚才分析过了）\n        int i = key.threadLocalHashCode &amp; (len-1);\n        /**\n         * 使用线性探测法查找元素（重点代码）\n         */\n        for (ThreadLocal.ThreadLocalMap.Entry e = tab[i];\n             e != null;\n             e = tab[i = nextIndex(i, len)]) &#123;\n            ThreadLocal&lt;?&gt; k = e.get();\n            //ThreadLocal 对应的 key 存在，直接覆盖之前的值\n            if (k == key) &#123;\n                e.value = value;\n                return;\n            &#125;\n            // key为 null，但是值不为 null，说明之前的 ThreadLocal 对象已经被回收了，\n           // 当前数组中的 Entry 是一个陈旧（stale）的元素\n            if (k == null) &#123;\n                //用新元素替换陈旧的元素，这个方法进行了不少的垃圾清理动作，防止内存泄漏\n                replaceStaleEntry(key, value, i);\n                return;\n            &#125;\n        &#125;\n    \n    \t//ThreadLocal对应的key不存在并且没有找到陈旧的元素，则在空元素的位置创建一个新的Entry。\n            tab[i] = new Entry(key, value);\n            int sz = ++size;\n            /**\n             * cleanSomeSlots用于清除那些e.get()==null的元素，\n             * 这种数据key关联的对象已经被回收，所以这个Entry(table[index])可以被置null。\n             * 如果没有清除任何entry,并且当前使用量达到了负载因子所定义(长度的2/3)，那么进行\t\t\t\t * rehash（执行一次全表的扫描清理工作）\n             */\n            if (!cleanSomeSlots(i, sz) &amp;&amp; sz &gt;= threshold)\n                rehash();\n&#125;\n\n /**\n     * 获取环形数组的下一个索引\n     */\n    private static int nextIndex(int i, int len) &#123;\n        return ((i + 1 &lt; len) ? i + 1 : 0);\n    &#125;\n</code></pre>\n<h2 id=\"代码执行流程\"><a class=\"markdownIt-Anchor\" href=\"#代码执行流程\">#</a> 代码执行流程：</h2>\n<p>1. 首先还是根据 key 计算出索引 i，然后查找 i 位置上的 Entry</p>\n<p>2. 若是 Entry 已经存在并且 key 等于传入的 key，那么这时候直接给这个 Entry 赋新的 value 值</p>\n<p>3. 若是 Entry 存在，但是 key 为 null，则调用 replaceStaleEntry 来更换这个 key 为空的 Entry</p>\n<p>4. 不断循环检测，直到遇到为 null 的地方，这时候要是还没在循环过程中 return，那么就在这个 null 的位置新建一个 Entry，并且插入，同时 size 增加 1</p>\n<p>5. 最后调用 cleanSomeSlots，清理 key 为 null 的 Entry，最后返回是否清理了 Entry，接下来再判断 sz 是否 &gt;= thresgold 达到了 rehash 的条件，达到的话就会调用 rehash 函数执行一次全表的扫描清理</p>\n<ul>\n<li>分析 ： ThreadLocalMap 使用线性探测法来解决哈希冲突的</li>\n</ul>\n<p>1. 该方法一次探测下一个地址，直到有空的地址后插入，若整个空间都找不到空余的地址，则产生溢出<br>\n 2. 假设当前 table 长度为 16，也就是说如果计算出来 key 的 hash 值为 14，如果 table [14] 上已经有值，并且其 key 与当前 key 不一致，那么就发生了 hash 冲突，这个时候将 14 加 1 得到 15，取 table [15] 进行判断，这个时候如果还是冲突会回到 0，取 table [0], 以此类推，直到可以插入</p>\n<p>3. 可以把 Entry [] table 看成一个环形数组</p>\n</li>\n</ul>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E7%9A%84CDN%E5%8A%A0%E9%80%9F%E5%92%8COSS%E4%BC%A0%E8%BE%93%E5%8A%A0%E9%80%9F%E7%9A%84%E5%8C%BA%E5%88%AB/",
            "url": "http://example.com/2022/12/27/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E7%9A%84CDN%E5%8A%A0%E9%80%9F%E5%92%8COSS%E4%BC%A0%E8%BE%93%E5%8A%A0%E9%80%9F%E7%9A%84%E5%8C%BA%E5%88%AB/",
            "title": "阿里云OSS的CDN加速和OSS传输加速的区别",
            "date_published": "2022-12-27T08:18:48.660Z",
            "content_html": "<h2 id=\"概述\"><a class=\"markdownIt-Anchor\" href=\"#概述\">#</a> 概述</h2>\n<p>本文主要介绍阿里云对象存储 OSS 的传输加速功能和 CDN 加速 OSS 资源的区别，以便您根据实际业务进行选择。</p>\n<h2 id=\"详细信息\"><a class=\"markdownIt-Anchor\" href=\"#详细信息\">#</a> 详细信息</h2>\n<p>阿里云对象存储 OSS 以海量、安全、低成本、高可靠等特点已经成为用户存储静态资源和文件的首要选择，实际使用中面向全球各地用户访问 OSS 资源时，访问速度会受到客户端网络、OSS 的下行带宽、Bucket 地域、访问链路长等限制出现访问慢的情况。以下主要介绍 CDN 加速 OSS 和 OSS 传输加速的加速方式：</p>\n<h3 id=\"实现原理\"><a class=\"markdownIt-Anchor\" href=\"#实现原理\">#</a> 实现原理</h3>\n<p>具体实现加速的原理如下：</p>\n<ul>\n<li>CDN 加速 OSS：是建立并覆盖在承载网之上，由遍布全球的边缘节点服务器群组成的分布式网络。阿里云 CDN 能分担源站压力，避免网络拥塞，确保在不同区域、不同场景下加速网站内容的分发，提高资源访问速度。由 CDN 全球广泛分布的边缘节点缓存 OSS 存储的静态数据，从而实现客户端从边缘节点直接获取数据的方式来实现访问的加速。</li>\n<li>OSS 传输加速：利用全球分布的云机房，将全球各地用户对您存储空间（Bucket）的访问，经过智能路由解析至就近的接入点，使用优化后的网络及协议，为云存储互联网的上传、下载提供端到端的加速方案。</li>\n</ul>\n<h3 id=\"资源加速场景介绍\"><a class=\"markdownIt-Anchor\" href=\"#资源加速场景介绍\">#</a> 资源加速场景介绍</h3>\n<p>OSS 传输加速是针对 OSS 的链路加速，使用 OSS 传输加速后支持 OSS 提供的任意特性。CDN 通过全球边缘节点缓存 OSS 资源，加速同时可降低带宽成本。OSS 传输加速和 CDN 加速完全是两个不同的产品，且应对的场景不同，详情请参见<span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZWxwLmFsaXl1bi5jb20vZG9jdW1lbnRfZGV0YWlsLzEwOTg5NS5odG0=\"> CDN 应用场景</span>和<span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZWxwLmFsaXl1bi5jb20vZG9jdW1lbnRfZGV0YWlsLzEzMTMxMi5odG0=\">传输加速场景</span>。</p>\n<ul>\n<li>如果您的业务是第三方数据源加速，推荐您使用 CDN 加速。</li>\n<li>如果您的 OSS 资源需要进行多次下载的操作，并且不要求数据强一致性，推荐您使用 CDN 加速。</li>\n<li>如果您的 OSS 资源需要加速下载，并且访问量少，推荐您使用 OSS 传输加速。</li>\n<li>如果您的 OSS 资源需要进行多次下载的操作，并且要求数据强一致性，推荐您使用 OSS 传输加速。</li>\n<li>如果您的业务存储的是动态资源，且数据更新频繁，推荐您使用 OSS 传输加速。</li>\n<li>如果您的业务存储的是静态资源，且更新少，推荐您使用 CDN 加速。</li>\n</ul>\n<h3 id=\"cdn加速和oss传输加速的对比\"><a class=\"markdownIt-Anchor\" href=\"#cdn加速和oss传输加速的对比\">#</a> CDN 加速和 OSS 传输加速的对比</h3>\n<p>CDN 加速和 OSS 传输加速的使用场景不同，其优缺点对比如下：</p>\n<table>\n<thead>\n<tr>\n<th><strong>加速方式</strong></th>\n<th><strong>实现方法</strong></th>\n<th><strong>应用场景</strong></th>\n<th><strong>优点</strong></th>\n<th><strong>缺点</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CDN 加速 OSS</td>\n<td>通过全球分布的边缘节点缓存数据来实现加速。</td>\n<td>网站或应用中小文件大文件的下载视音频点播</td>\n<td>CDN 边缘节点全球分布，数量多。CDN 节点提供的服务带宽量大。</td>\n<td>对于访问量大的资源，命中率高，访问量小的资源命中率低，节点未缓存的情况下，还是需要回源访问，回源依赖实时的公网回源链路。CDN 静态资源的访问，对于上传、删除等动态请求加速效果不明显。</td>\n</tr>\n<tr>\n<td>OSS 传输加速</td>\n<td>实现的是客户端到 OSS 服务端之间链路优化来实现的加速功能，实际每次资源的请求还是从 OSS 来进行获取。</td>\n<td>远距离数据传输加速 GB、TB 级大文件上传和下载非静态、非热点数据下载加速</td>\n<td>OSS 存储节点全球主要区域分布。远距离以及大文件的上传和下载加速。</td>\n<td>所有的访问都是回源到 OSS 访问，占用 OSS 的服务带宽。同一区域大量用户集中访问资源的情况下，效果没有 CDN 加速效果好。只能使用 HTTPS 方式访问。</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h2>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0/",
            "url": "http://example.com/2022/12/27/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0/",
            "title": "设计模式（一）",
            "date_published": "2022-12-27T08:18:48.658Z",
            "content_html": "<h3 id=\"设计模式笔记-__brathli\"><a class=\"markdownIt-Anchor\" href=\"#设计模式笔记-__brathli\">#</a> 设计模式笔记  <strong>__Brath.Li</strong></h3>\n<h3 id=\"gof2323种设计模式\"><a class=\"markdownIt-Anchor\" href=\"#gof2323种设计模式\">#</a> GoF23：23 种设计模式</h3>\n<p>​\t\t<strong>设计模式的本质是面向对象设原则的实际运用，是对类的封装性，继承性，多态性以及类的关联关系和组合关系的充分理解。</strong></p>\n<p>​\t\t\t<strong>正确使用设计模式具有以下优点：</strong></p>\n<p>​\t\t\t<strong>1. 提高程序员思维能力，编程能力和设计能力</strong></p>\n<p>​\t\t\t<strong>2. 使程序设计更加标准化，代码编制更加工程化，使软件开发效率大大提高，从而缩短软件的开的周期。</strong></p>\n<p>​\t\t\t<strong>3. 使设计的代码可重用性高、可读性强、可靠性高、灵活性好、可维护性强。</strong></p>\n<h3 id=\"创建型模式\"><a class=\"markdownIt-Anchor\" href=\"#创建型模式\">#</a> <strong>创建型模式：</strong></h3>\n<p>​\t\t\t<strong>单例模式、工厂模式、抽象工厂模式、建造者模式、原型模式。</strong></p>\n<h3 id=\"结构型模式\"><a class=\"markdownIt-Anchor\" href=\"#结构型模式\">#</a> <strong>结构型模式：</strong></h3>\n<p>​\t\t\t<strong>适配器模式、桥接模式、装饰模式、组合模式、外欧冠模式、享元模式、代理模式。</strong></p>\n<h3 id=\"行为性模式\"><a class=\"markdownIt-Anchor\" href=\"#行为性模式\">#</a> <strong>行为性模式：</strong></h3>\n<p>​\t\t\t<strong>模板方法模式、命令模式、迭代器模式、观察者模式、中介者模式、备忘录模式、解释器模式、状态模式、策略模式、责任链模式、访问者模式。</strong></p>\n<h4 id=\"oop面向对象七大原则\"><a class=\"markdownIt-Anchor\" href=\"#oop面向对象七大原则\">#</a> OOP 面向对象七大原则：</h4>\n<p><strong>1.OCP 开闭原则：</strong></p>\n<p>​\t\t\t<strong>软件实体（包括类、模块、功能等）应该对扩展开放，但是对修改关闭。</strong></p>\n<p><strong>2. 里氏替换原则：</strong></p>\n<p>​\t\t\t<strong>继承必须确保超类锁拥有的性质在子类中仍然成立。</strong></p>\n<p><strong>3. 依赖倒置原则：</strong></p>\n<p>​\t\t\t<strong>面向接口编程，不要面向实现编程。</strong></p>\n<p><strong>4. 单一职责原则：</strong></p>\n<p>​\t\t\t<strong>控制类粒度大小、将对象解耦合、提高内聚性。</strong></p>\n<p><strong>5. 接口隔离原则：</strong></p>\n<p>​\t\t\t<strong>要为各个类建立他们需要的专用接口。</strong></p>\n<p><strong>6. 迪米特法则：</strong></p>\n<p>​\t\t\t** 只与你的直接朋友交谈、不跟 “陌生人” 说话。 **</p>\n<p><strong>7. 合成复用原则：</strong></p>\n<p>​\t\t\t<strong>尽量先使用组合或者聚合等关联关系来实现，其次才考虑使用继承关系来实现。</strong></p>\n<h2 id=\"单例设计模式\"><a class=\"markdownIt-Anchor\" href=\"#单例设计模式\">#</a> 单例设计模式：</h2>\n<p>作用：让一个类只能创建一个实例（因为频繁的创建对象，回收对象会造成系统性能下降。）。解决对象的唯一性，保证了内存中一个对象是唯一的 。</p>\n<h4 id=\"饿汉式hunary\"><a class=\"markdownIt-Anchor\" href=\"#饿汉式hunary\">#</a> 饿汉式：Hunary</h4>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C%E9%A5%BF%E6%B1%89%E5%BC%8F.png\" alt=\"饿汉式\"></p>\n<p><strong>步骤：1. 私有化构造器  2. 直接创建静态对象 3. 创建一个静态的方法，供外部调用实例</strong></p>\n<p>优点：类初始化的时候，会立即加载该对象，线程天生安全，调用效率高。</p>\n<p>缺点：无法避免被反射破解，不安全</p>\n<h4 id=\"懒汉式lazyman\"><a class=\"markdownIt-Anchor\" href=\"#懒汉式lazyman\">#</a> 懒汉式：LazyMan</h4>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910151318667.png\" alt=\"image-20210910151318667\"></p>\n<p>步骤：1. 私有化构造器，不会直接创建对象  2. 向外暴露调用对象方法，在方法中先进行对象判空，为空才创建对象，这就是懒汉式</p>\n<p>优点：类初始化时，不会初始化该对象，真正需要使用的时候才会去创建该对象，具备懒加载功能。</p>\n<p>缺点：</p>\n<p>1. 判空浪费时间</p>\n<p>2. 不加 Synchronized 的懒汉式线程不安全，需要用到 volatile 关键字保持 new 对象的原子性一致</p>\n<p>懒汉式单线程下是 OK 的，但是多线程并发下不安全。</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153316119.png\" alt=\"image-20210910153316119\"> 开启十次线程测试</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153327761.png\" alt=\"image-20210910153327761\"></p>\n<p><strong>每次重启线程数都不一致</strong>，线程不安全。</p>\n<p>怎么解决：</p>\n<p>Tips：懒汉式也是可以实现线程安全的：只要加上 Synchronized 加锁即可：</p>\n<p>但是这样一来，会降低整个访问的速度，而且每次都要判断。那么有没有更好的方式来实现呢？</p>\n<p>解决方案：</p>\n<p><strong>double-check-lock 双重加锁</strong></p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910152638263.png\" alt=\"image-20210910152638263\"></p>\n<p>所谓双重加锁机制。指的是，并不是每次进入 getInstance 方法都需要同步，而是先不同步，进入方法之后先检查实例是否存在，如果不存在才进入下面 Synchronized 加锁，之后会再次检查实例是否存在，如果还不存在才创建实例。</p>\n<p>双重检测方式（因为 JVM 本身重排序的原因，可能会出现多次的初始化）</p>\n<p>这种模式下的懒汉式，称为<strong> DCL 懒汉式</strong>！</p>\n<p>你以为这样就没问题了？大错特错，注意：这里的 new 对象操作不是原子性的</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153630120.png\" alt=\"image-20210910153630120\"></p>\n<p>new 一个对象的执行顺序 ↓</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">  * 1.分配内存空间</span></span><br><span class=\"line\"><span class=\"comment\">  * 2.执行构造方法初始化对象</span></span><br><span class=\"line\"><span class=\"comment\">  * 3.把这个对象指向内存空间</span></span><br><span class=\"line\"><span class=\"comment\">  * 这是创建对象的步骤 正确顺序为 123</span></span><br><span class=\"line\"><span class=\"comment\">  * 举例：</span></span><br><span class=\"line\"><span class=\"comment\">  * 线程A 创建对象 步骤为 123, 我们的代码没有问题</span></span><br><span class=\"line\"><span class=\"comment\">  * 线程B 创建对象 因为操作步骤不是原子性的，可能会走成 1 3 2，先指向了内存空间，再去构造对象</span></span><br><span class=\"line\"><span class=\"comment\">  * 这时会出现一个问题，指令重排：双重检测模式会失效，因为此时我们的类，不为空了，但是里面返回的对象是空的。</span></span><br><span class=\"line\"><span class=\"comment\">  * 所以就要用到一个关键字volatile，避免指令重排，保持操作原子性</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910153756918.png\" alt=\"image-20210910153756918\"></p>\n<h4 id=\"静态内部类模式\"><a class=\"markdownIt-Anchor\" href=\"#静态内部类模式\">#</a> 静态内部类模式：</h4>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910155204370.png\" alt=\"image-20210910155204370\"></p>\n<p>步骤：1. 私有化构造器  2. 创建一个静态内部类，类中创建外部类的实例  3. 向外暴露一个方法获取静态内部类中创建的对象</p>\n<p>优点：结合了懒汉式和饿汉式各自的优点，真正需要对象的时候才会加载，加载类是线程安全的。</p>\n<p>缺点：每次调用都会创建多余的对象</p>\n<h3 id=\"以上单例设计模式都会被反射破解枚举不会\"><a class=\"markdownIt-Anchor\" href=\"#以上单例设计模式都会被反射破解枚举不会\">#</a> 以上单例设计模式都会被反射破解，枚举不会！</h3>\n<p>枚举：枚举本身是一个类，继承了 Enum 的实例就成为了枚举类</p>\n<p>使用枚举实现单例模式，实现简单、调用效率高，枚举本身就是单例，由 JVM 从根本上提供保障，避免通过反射和反序列化的漏洞，缺点是没有延迟加载。</p>\n<p>在源码 Constructor 中<img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150042754.png\" alt=\"image-20210910150042754\"></p>\n<p>如果是对象是通过反射机制创建的会抛出一个异常</p>\n<p>IllegalArgumentException: Cannot reflectively create enum objects</p>\n<p>枚举类在 traget 输出的代码中，构造器是空的，隐藏起来了，用 javap -p 反编译也看不见构造器</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150706569.png\" alt=\"image-20210910150706569\"></p>\n<p>我们用反射机制获取空构造器会获取不到对象，这时候用 jad 反编译工具，得到的 java 文件中，</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150400927.png\" alt=\"image-20210910150400927\"></p>\n<p>可以看见构造器其实是有数据的，我们把数据放到反射中实现，就会得到这个异常 Cannot reflectively create enum objects</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150429958.png\" alt=\"image-20210910150429958\"></p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910150418256.png\" alt=\"image-20210910150418256\"></p>\n<p>由此可见，反射不能破坏枚举的单例模式</p>\n<p>优点：实现简单，线程安全，防止反射攻击等。</p>\n<p>缺点： 在不需要的时候可能就加载了，造成内存浪费</p>\n<p>Tips：利用反射破解懒汉式。懒汉式不是安全的！</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910160648326.png\" alt=\"image-20210910160648326\"></p>\n<p>私有化构造器的时候判断外面的字段 guoqing 是否 ==false，等于的话就设置为 true，如果不等于的话就抛出运行异常，这样设计的话在我们用反射机制获取构造器的时候，就获取不到对象了</p>\n<p>但是有解决方法：利用反射强大的机制，假如我们反编译，知道要破解的字段是 guoqing，那我们直接用反射获取 guoqing 字段，然后设置解除私有化限制，在创建构造器实例的时候，把 guoqing 设置为 true，就可以破解 DCL 懒汉式了</p>\n<p><img data-src=\"C:%5CUsers%5C26344%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210910160638735.png\" alt=\"image-20210910160638735\"></p>\n<h2 id=\"工厂设计模式-factory-model\"><a class=\"markdownIt-Anchor\" href=\"#工厂设计模式-factory-model\">#</a> 工厂设计模式 Factory Model：</h2>\n<p>​\t\t<strong>核心本质：</strong></p>\n<p>​\t\t\t<strong>实例化对象不使用 new，用工厂方法代替</strong></p>\n<p>​\t\t\t<strong>将选择实现类，创建对象统一管理和控制。从而将调用者跟我们的实现类解耦。</strong></p>\n<p>​\t\t<strong>详细分类：</strong></p>\n<p>​\t\t\t<strong>简单工厂模式</strong></p>\n<p>​\t\t\t\t\t\t<strong>用来生产同一等级结构中的任意产品：扩展性差</strong></p>\n<p>​\t\t\t<strong>工厂方法模式</strong></p>\n<p>​\t\t\t\t\t\t<strong>用来生产同一等级结构中的固定产品：扩展性强</strong></p>\n<p>​\t\t\t<strong>抽象工厂模式</strong></p>\n<p>​\t\t\t\t\t\t<strong>围绕一个超级工厂创建其他工厂。该超级工厂又称为其他工厂的工厂。</strong></p>\n<p><strong>工厂设计模式应用场景：</strong></p>\n<p>​\t\t\t<strong>JDK 中的 Calendar 的 getInstance 方法</strong></p>\n<p>​\t\t\t<strong>JDBC 中的 Connection 对象的获取</strong></p>\n<p>​\t\t\t<strong>Spring 的 IOC 容器创建管理 Bean 对象</strong></p>\n<p>​\t\t\t<strong>反射 Class 对象的 newInsetance 方法</strong></p>\n<h2 id=\"建造者模式\"><a class=\"markdownIt-Anchor\" href=\"#建造者模式\">#</a> 建造者模式：</h2>\n<p>​\t<strong>建造者模式也属于创建型模式，它提供了一种创建对象的最佳方式。</strong></p>\n<p>​\t<strong>定义：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示</strong></p>\n<p>​\t<strong>主要作用：在用户不知道对象的建造过程和细节的情况下就可以直接创建复杂对象。</strong></p>\n<p>​\t<strong>用户只需要给出指定复杂对象的类型和内容，建造者模式负责将按顺序创建复杂对象（把内部的建造过程和细节隐藏起来）</strong></p>\n<p>​\t<strong>例子：</strong></p>\n<p>​\t\t\t<strong>工厂（建造者模式）：负责制造汽车（组装过程和细节在工厂内）</strong></p>\n<p>​\t\t\t<strong>汽车购买者（用户）：你只需要说你需要的型号（对象的类型和内容），然后直接购买就可以了（不需要知道汽车是怎么组装的（发动机、变速箱、轮毂、车门））</strong></p>\n<h2 id=\"原型模式\"><a class=\"markdownIt-Anchor\" href=\"#原型模式\">#</a> 原型模式：</h2>\n<p>​\t\t创建型模式之一。</p>\n<p>​</p>\n<h2 id=\"适配器模式\"><a class=\"markdownIt-Anchor\" href=\"#适配器模式\">#</a> 适配器模式</h2>\n<p>​\t\t将一个类的接口转换成客户希望的另外一个接口，Adapter 模式使得原本由于接口不兼容而不能一起工作的那些类可以在一起工作！</p>\n<p>​\t\t角色分析：</p>\n<p>​\t\t\t\t1 . 目标接口：客户所期待的接口，目标可以使具体或抽象的类，也可以是接口。</p>\n<p>​\t\t\t\t2 . 需要适配的类：需要适配的类或者适配者类。</p>\n<p>​\t\t\t\t3 . 适配器：通过包装一个需要适配的对象，将原接口转换成目标对象。</p>\n<p>​\t\t对象适配器优点</p>\n<p>​\t\t\t\t1 . 一个对象适配器可以把多个不同的适配者适配到同一个目标</p>\n<p>​\t\t\t\t2 . 可以适配一个适配者的子类，由于适配器和适配者之间是关联关系，根据 “里氏代换原则” ，适配者的子类也可以通过该适配器进行适配。</p>\n<p>​\t\t类适配器缺点：</p>\n<p>​\t\t\t\t1 . 对于 Java、C# 等不支持多重类继承的语言，一次最多只能适配一个适配者类，不能同时适配多个适配者。</p>\n<p>​\t\t\t\t2 . 在 Java、C# 等语言中，适配器模式中的目标抽象类只能为接口，不能为类，其使用有一定的局限性。</p>\n<p>​\t\t适用场景：</p>\n<p>​\t\t\t\t1 . 系统需要使用一些现有的类，而这些类的接口不符合系统的需要，甚至没有这些类的代码。</p>\n<p>​\t\t\t\t2 . 想创建一个可以重复使用的类，用于与一些彼此之间没有太大关联的一些类，包括一些可能在将来引进的类一起工作。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8liux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87springBoot%E5%86%85%E7%BD%AEmail%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/",
            "url": "http://example.com/2022/12/27/%E8%85%BE%E8%AE%AF%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8liux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%97%A0%E6%B3%95%E9%80%9A%E8%BF%87springBoot%E5%86%85%E7%BD%AEmail%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/",
            "title": "腾讯云服务器liux系统下无法通过springBoot内置mail发送邮件的解决方案",
            "date_published": "2022-12-27T08:18:48.655Z",
            "content_html": "<h3 id=\"腾讯云服务器liux系统下无法通过springboot内置mail发送邮件的解决方案\"><a class=\"markdownIt-Anchor\" href=\"#腾讯云服务器liux系统下无法通过springboot内置mail发送邮件的解决方案\">#</a> 腾讯云服务器 liux 系统下无法通过 springBoot 内置 mail 发送邮件的解决方案</h3>\n<p>原因</p>\n<p>原来是腾讯云基于安全考虑，禁用了端口 25。改成 465 或者解封 25 就可以发邮件了。</p>\n<p>原始配置  本地可发送</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  mail:</span><br><span class=\"line\">    username: ***********</span><br><span class=\"line\">    password: ***********</span><br><span class=\"line\">    host: smtp<span class=\"number\">.163</span>.com</span><br><span class=\"line\">    port: <span class=\"number\">25</span></span><br><span class=\"line\">    <span class=\"keyword\">default</span>-encoding: UTF-<span class=\"number\">8</span></span><br><span class=\"line\">    properties:</span><br><span class=\"line\">      mail:</span><br><span class=\"line\">        smtp:</span><br><span class=\"line\">          timeout: <span class=\"number\">10000</span></span><br><span class=\"line\">          auth: <span class=\"literal\">true</span></span><br><span class=\"line\">          starttls:</span><br><span class=\"line\">            enable: <span class=\"literal\">true</span></span><br><span class=\"line\">            required: <span class=\"literal\">true</span></span><br><span class=\"line\">          socketFactory:</span><br><span class=\"line\">            port: <span class=\"number\">25</span></span><br><span class=\"line\">            class: javax.net.ssl.SSLSocketFactory</span><br><span class=\"line\">            fallback: <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>修改的配置 测试 部署到服务器上是可以发送的</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">spring:</span><br><span class=\"line\">  mail:</span><br><span class=\"line\">    username: ***********</span><br><span class=\"line\">    password: ***********</span><br><span class=\"line\">    host: smtp<span class=\"number\">.163</span>.com</span><br><span class=\"line\">    port: <span class=\"number\">465</span></span><br><span class=\"line\">    <span class=\"keyword\">default</span>-encoding: UTF-<span class=\"number\">8</span></span><br><span class=\"line\">    properties:</span><br><span class=\"line\">      mail:</span><br><span class=\"line\">        smtp:</span><br><span class=\"line\">          timeout: <span class=\"number\">10000</span></span><br><span class=\"line\">          auth: <span class=\"literal\">true</span></span><br><span class=\"line\">          starttls:</span><br><span class=\"line\">            enable: <span class=\"literal\">true</span></span><br><span class=\"line\">            required: <span class=\"literal\">true</span></span><br><span class=\"line\">          socketFactory:</span><br><span class=\"line\">            port: <span class=\"number\">465</span></span><br><span class=\"line\">            class: javax.net.ssl.SSLSocketFactory</span><br><span class=\"line\">            fallback: <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E7%AB%AF%E5%8F%A3%E5%8F%B7%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3/",
            "url": "http://example.com/2022/12/27/%E7%AB%AF%E5%8F%A3%E5%8F%B7%E8%A2%AB%E5%8D%A0%E7%94%A8%E7%9A%84%E6%83%85%E5%86%B5%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3/",
            "title": "端口占用问题",
            "date_published": "2022-12-27T08:18:48.652Z",
            "content_html": "<p>安装好 Maven 之后配置环境变量：</p>\n<p>netstat -ano：查询全部活动连接</p>\n<p>tasklist ：查询全部的进程和 PID</p>\n<p>tasklist | findstr “占用端口的进程 PID”</p>\n<p>taskkill /f/t /im 占用端口的进程名字.exe</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E7%BB%86%E5%88%99/",
            "url": "http://example.com/2022/12/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8B%86%E5%88%86%E7%BB%86%E5%88%99/",
            "title": "微服务拆分细则",
            "date_published": "2022-12-27T08:18:48.649Z",
            "content_html": "<p>​\t在微服务的设计过程中，微服务设计有多大，微服务粒度的把控，一直是设计人员需要考虑和设计的难点。</p>\n<p>因为服务粒度设计过大，不能得到微服务架构带来的便利，例如：更加敏态的开发，更频繁的版本发布，由于服务功能划分的小，可以根据实际的业务场景，选择更加合适的技术进行代码重构等等。</p>\n<p>​\t\t但同时我们也要注意，不是服务越” 微 “越好，因为服务的过度拆分会使架构的设计复杂度大大提升，同时也会大大提升运维和测试的复杂度等。</p>\n<p>​\t\t所以对服务拆分粒度的把控，对设计人员来讲就至关重要了，甚至对项目的成败有非常重要的影响。</p>\n<p>这篇文档提供了一些主要的微服务拆分原则，供您参考，来帮助您进行更加合理粒度的微服务设计。</p>\n<h3 id=\"微服务的拆分原则-通用\"><a class=\"markdownIt-Anchor\" href=\"#微服务的拆分原则-通用\">#</a> 微服务的拆分原则 - 通用</h3>\n<table>\n<thead>\n<tr>\n<th><strong>编号</strong></th>\n<th><strong>原则</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>原则 1</td>\n<td>基于业务分析拆分</td>\n<td>基于 TOGAF， ADA 等</td>\n</tr>\n<tr>\n<td>原则 2</td>\n<td>基于 DDD 领域驱动设计中的子域设计拆分</td>\n<td>基于领域驱动设计</td>\n</tr>\n<tr>\n<td>原则 3</td>\n<td>根据动作和用例拆分</td>\n<td>比如支付</td>\n</tr>\n<tr>\n<td>原则 4</td>\n<td>根据名词或者资源拆</td>\n<td>比如账号</td>\n</tr>\n<tr>\n<td>原则 5</td>\n<td>架构稳定</td>\n<td>拆分的结构稳定，不会经常修改</td>\n</tr>\n<tr>\n<td>原则 6</td>\n<td>服务是可测试的</td>\n<td>集成测试要可定义，测试可回溯</td>\n</tr>\n<tr>\n<td>原则 7</td>\n<td>单一原则</td>\n<td>一个服务做一个业务， 自己治理自己的数据库</td>\n</tr>\n<tr>\n<td>原则 8</td>\n<td>开闭原则</td>\n<td>面向对象理论， 对扩展开放， 对修改关闭</td>\n</tr>\n<tr>\n<td>原则 9</td>\n<td>高内聚</td>\n<td>强一致，强依赖关系的放在一起， 减少分布式事务</td>\n</tr>\n<tr>\n<td>原则 10</td>\n<td>低耦合</td>\n<td>服务间互相独立</td>\n</tr>\n<tr>\n<td>原则 11</td>\n<td>足够小的团队可维护，最大两个 pizza team</td>\n<td>6-10 人一个 pizza team</td>\n</tr>\n<tr>\n<td>原则 12</td>\n<td>团队自治，自己的服务的开发和发布要跟别的团队尽可能小的协调</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"微服务的拆分原则-技术侧重点\"><a class=\"markdownIt-Anchor\" href=\"#微服务的拆分原则-技术侧重点\">#</a> 微服务的拆分原则 - 技术侧重点</h2>\n<table>\n<thead>\n<tr>\n<th><strong>编号</strong></th>\n<th><strong>原则</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>原则 1</td>\n<td>潜在风险</td>\n<td>服务的风险性</td>\n</tr>\n<tr>\n<td>原则 2</td>\n<td>资源性能计算性能硬盘性能内存容量网络带宽</td>\n<td>机器的性能决定了方案的部分选择</td>\n</tr>\n<tr>\n<td>原则 3</td>\n<td>安全</td>\n<td>安全要求是否很高，安全的策略</td>\n</tr>\n<tr>\n<td>原则 4</td>\n<td>高并发瞬时并发持续并发</td>\n<td>并发的种类， 持续的时间</td>\n</tr>\n<tr>\n<td>原则 5</td>\n<td>数据库数据量大小读操作写操作数据类型</td>\n<td>数据的类型， 读写的多少，数据量</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E5%AE%9D%E5%A1%94%E9%83%A8%E7%BD%B2Docker%E2%80%94Mysql%E9%95%9C%E5%83%8F/",
            "url": "http://example.com/2022/12/27/%E5%AE%9D%E5%A1%94%E9%83%A8%E7%BD%B2Docker%E2%80%94Mysql%E9%95%9C%E5%83%8F/",
            "title": "宝塔部署Docker—Mysql镜像",
            "date_published": "2022-12-27T08:18:48.646Z",
            "content_html": "<p>转自 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTE2MzAyNTkvYXJ0aWNsZS9kZXRhaWxzLzEyNDQ5NzM0Mw==\">https://blog.csdn.net/u011630259/article/details/124497343</span></p>\n<h2 id=\"宝塔部署dockermysql镜像\"><a class=\"markdownIt-Anchor\" href=\"#宝塔部署dockermysql镜像\">#</a> 宝塔部署 Docker—Mysql 镜像</h2>\n<p>如何在面板上使用 Docker 项目管理器快速创建多个版本的 MySQL？手把手的教你如何创建多个版本的 MySQL 服务<br>\n环境介绍：<br>\n宿主机：CentOS7.9<br>\n 配置：2 核 4G（测试机器，生产环境建议配置高点）<br>\n面板版本：7.9.26（测试版）<br>\nDocker 项目管理器：3.9</p>\n<p><img data-src=\"https://brath.cloud/blogImg/90825147a852493a8feea8efc0220deb.png\" alt=\"img\"></p>\n<p>Docker 版本：Docker version 20.10.14, build a224086<br>\n 测试 MySQL 版本：<br>\nMySQL5.7.37<br>\nMySQL8.0.28<br>\n1、获取 MySQL 版本</p>\n<p><img data-src=\"https://brath.cloud/blogImg/0241ca9c68d545819f8f100b33b2d8b9.png\" alt=\"img\"></p>\n<p><img data-src=\"https://brath.cloud/blogImg/90825147a852493a8feea8efc0220deb.png\" alt=\"\"></p>\n<p>默认情况下，直接输入 mysql 名，会拉取 mysql:latest 镜像，就是最新版本的镜像，指定版本后拉取的是指定版本的 MySQL 镜像，如 mysql:5.7.37</p>\n<p><img data-src=\"https://brath.cloud/blogImg/2418dbfa7fac47bbac12fd3abe9e7229.png\" alt=\"img\"></p>\n<p>2、创建容器：</p>\n<p>指定容器中数据库的密码：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/5d2c09a1667744fd9538381efd7b67b0.png\" alt=\"img\"></p>\n<p>MYSQL_ROOT_PASSWORD=dapaotest1</p>\n<p><img data-src=\"https://brath.cloud/blogImg/241882e051fd4940bd09e98f61369215.png\" alt=\"img\"></p>\n<p>3、容器创建成功后，进入终端命令行查看数据库</p>\n<p><img data-src=\"https://brath.cloud/blogImg/f6245e7abacc4d768dd616d4067c3a4a.png\" alt=\"img\"></p>\n<p>4、创建数据库表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看数据库的命令</span><br><span class=\"line\">show databases;</span><br><span class=\"line\">创建数据库的命令</span><br><span class=\"line\">create database dapaodocker;</span><br><span class=\"line\">创建用户的命令</span><br><span class=\"line\">create user &#x27;dapaodocker&#x27;@&#x27;%&#x27; identified by &#x27;dapao666!&#x27;;</span><br><span class=\"line\">授权</span><br><span class=\"line\">grant all on dapaodocker.* to dapaodocker@&#x27;%&#x27;;</span><br><span class=\"line\"></span><br><span class=\"line\">查看用户权限</span><br><span class=\"line\">select host,user from user;</span><br><span class=\"line\">测试数据库是否可以连接</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/ee582242679c4da1b2fc04db16bad384.png\" alt=\"img\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%B0%E5%BD%95/",
            "url": "http://example.com/2022/12/27/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E8%AE%B0%E5%BD%95/",
            "title": "使用docker搭建开发环境记录",
            "date_published": "2022-12-27T08:18:48.644Z",
            "content_html": "<h1 id=\"使用docker搭建开发环境记录\"><a class=\"markdownIt-Anchor\" href=\"#使用docker搭建开发环境记录\">#</a> 使用 docker 搭建开发环境记录</h1>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker start 容器名</span><br><span class=\"line\">docker stop 容器名</span><br><span class=\"line\">docker restart 容器名</span><br><span class=\"line\"></span><br><span class=\"line\">docker run = docker create + docker start</span><br></pre></td></tr></table></figure>\n<h3 id=\"mysql\"><a class=\"markdownIt-Anchor\" href=\"#mysql\">#</a> mysql</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拉取镜像</span></span><br><span class=\"line\">docker pull mysql:5.7</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建实例并启动</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-p 映射端口</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">--name 名称</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-v 映射文件</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-e MYSQL_ROOT_PASSWORD mysql密码</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">-d 后台运行并运行</span></span><br><span class=\"line\">docker run -p 3306:3306 --name mysql -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=root -d mysql:5.7</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入容器</span></span><br><span class=\"line\">docker exec -it mysql /bin/bash</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">退出容器</span></span><br><span class=\"line\">exit</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置my.conf</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># 1.在容器外编辑配置文件</span></span></span><br><span class=\"line\">vi /mydata/mysql/conf/my.cnf</span><br><span class=\"line\"></span><br><span class=\"line\">[client]</span><br><span class=\"line\">default-character-set=utf8</span><br><span class=\"line\">[mysql]</span><br><span class=\"line\">default-character-set=utf8</span><br><span class=\"line\">[mysqld]</span><br><span class=\"line\">init_connect=&#x27;SET conllation_connection = utf8_unicode_ci&#x27;</span><br><span class=\"line\">init_connect=&#x27;SET NAMES utf8&#x27;</span><br><span class=\"line\">character-set-server=utf8</span><br><span class=\"line\">collation-server=utf8_unicode_ci</span><br><span class=\"line\">skip-character-set-client-handshake</span><br><span class=\"line\">skip-name-resolve</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># 2. 重启mysql容器</span></span></span><br><span class=\"line\">docker restart mysql</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># 3. 进入mysql容器验证</span></span></span><br><span class=\"line\">docker exec -it mysql /bin/bash </span><br><span class=\"line\">cat /etc/mysql/my.cnf</span><br></pre></td></tr></table></figure>\n<h3 id=\"redis\"><a class=\"markdownIt-Anchor\" href=\"#redis\">#</a> Redis</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拉取镜像</span></span><br><span class=\"line\">docker pull redis</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置文件</span></span><br><span class=\"line\">本地：/mydata/redis/data/redis.conf 提前准备好</span><br><span class=\"line\">主要配置</span><br><span class=\"line\">bind 127.0.0.1 #注释掉这部分，使redis可以外部访问</span><br><span class=\"line\">daemonize no#用守护线程的方式启动</span><br><span class=\"line\">requirepass 你的密码#给redis设置密码</span><br><span class=\"line\">appendonly yes#redis持久化　　默认是no</span><br><span class=\"line\">tcp-keepalive 300 #防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建实例并启动</span></span><br><span class=\"line\">docker run -p 6379:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"rabbitmq\"><a class=\"markdownIt-Anchor\" href=\"#rabbitmq\">#</a> Rabbitmq</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拉取镜像management带控制台</span></span><br><span class=\"line\">docker pull rabbitmq:management</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建实例并启动</span></span><br><span class=\"line\">docker run -d --hostname my-rabbit --name rabbit -v /mydata/rabbitmq:/var/lib/rabbitmq -e RABBITMQ_DEFAULT_USER=root -e RABBITMQ_DEFAULT_PASS=Mm_123456 -p 15672:15672 -p 5672:5672 rabbitmq:management</span><br></pre></td></tr></table></figure>\n<h3 id=\"mongo\"><a class=\"markdownIt-Anchor\" href=\"#mongo\">#</a> mongo</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">拉取镜像</span></span><br><span class=\"line\">docker pull mongo</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建实例并启动</span></span><br><span class=\"line\">docker run -p 27017:27017 -v /mydata/mongo:/data/db --name mongodb -d mongo</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/",
            "url": "http://example.com/2022/12/27/%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/",
            "title": "云服务器部署宝塔面板",
            "date_published": "2022-12-27T08:18:48.640Z",
            "content_html": "<p>购买好服务器后，进入 Xshell：</p>\n<p>1. 安装宝塔面板</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh</span><br></pre></td></tr></table></figure>\n<p>获得：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">==================================================================</span><br><span class=\"line\">Congratulations! Installed successfully!</span><br><span class=\"line\">==================================================================</span><br><span class=\"line\">外网面板地址: http://42.193.125.92:8888/ef1f509f</span><br><span class=\"line\">内网面板地址: http://172.21.0.3:8888/ef1f509f</span><br><span class=\"line\">username: upqknxq4</span><br><span class=\"line\">password: f3701931</span><br><span class=\"line\">If you cannot access the panel,</span><br><span class=\"line\">release the following panel port [8888] in the security group</span><br><span class=\"line\">若无法访问面板，请检查防火墙/安全组是否有放行面板[8888]端口</span><br><span class=\"line\">==================================================================</span><br><span class=\"line\">Time consumed: 1 Minute!</span><br></pre></td></tr></table></figure>\n<p>访问 <span class=\"exturl\" data-url=\"aHR0cDovL2lwOjg4ODgvZWYxZjUwOWY=\">http://ip:8888/ef1f509f</span> 打开宝塔</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%BC%82%E5%B8%B8%E8%AE%B0%E5%BD%95/",
            "url": "http://example.com/2022/12/27/%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%BC%82%E5%B8%B8%E8%AE%B0%E5%BD%95/",
            "title": "主从同步遇到 Got fatal error 1236 from master when reading data from binary log",
            "date_published": "2022-12-27T08:18:48.638Z",
            "content_html": "<h1 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h1>\n<p>首先遇到这个是因为 binlog 位置索引处的问题，不要<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1yZXNldCZhbXA7c3BtPTEwMDEuMjEwMS4zMDAxLjcwMjA=\"> reset</span> slave；</p>\n<p>reset slave 会将主从同步的文件以及位置恢复到初始状态，一开始没有数据还好，有数据的话，相当于重新开始同步，可能会出现一些问题；</p>\n<p>一般做主从同步，都是要求以后的数据实现主从同步，而对于旧的数据完全可以使用数据库同步工具先将数据库同步，完了再进行主从同步；</p>\n<p>好了遇到上面的问题，正确做法是：</p>\n<p>1. 打开主服务器，进入 mysql</p>\n<p>2. 执行 flush logs；// 这时主服务器会重新创建一个 binlog 文件；</p>\n<p>3. 在主服务上执行 show master status;  显示如下：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/1620811-20190720113929965-58969472.png\" alt=\"img\"></p>\n<p>4. 来到从服务器的 mysql；</p>\n<p>5.stop slave;</p>\n<p>6.change master to master_log_file=‘mysql-bin.000012’,master_log_pos=154;// 这里的 file 和 pos 都是上面主服务器 master 显示的。</p>\n<p>7.start slave;// 这时候就应可以了</p>\n<p>8.show slave status \\G;</p>\n<p><img data-src=\"https://brath.cloud/blogImg/1620811-20190720114247073-1479221471.png\" alt=\"img\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/ZGC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AZGC%E7%AE%80%E4%BB%8B%E5%92%8CJDK17%E5%AF%B9ZGC%E7%9A%84%E4%BC%98%E5%8C%96/",
            "url": "http://example.com/2022/12/27/ZGC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9AZGC%E7%AE%80%E4%BB%8B%E5%92%8CJDK17%E5%AF%B9ZGC%E7%9A%84%E4%BC%98%E5%8C%96/",
            "title": "ZGC学习笔记：ZGC简介和JDK17对ZGC的优化",
            "date_published": "2022-12-27T08:18:48.635Z",
            "content_html": "<p>01 ZGC 简介<br>\n ZGC 是一个可扩展的低延迟垃圾收集器，能够处理 8MB 到 16TB 大小的堆，最大暂停时间为亚毫秒。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20220929120415958.png\" alt=\"image-20220929120415958\"></p>\n<p>OpenJDK 的官网只写到这里，然后让我们自己去看 Wiki（链接 2）…… 好偷懒……</p>\n<pre><code>    Wiki的介绍是更详细一些。\n\n    Z Garbage Collector，也称为 ZGC，是一种可扩展的低延迟垃圾收集器，旨在满足以下目标：\n</code></pre>\n<p>亚毫秒最大暂停时间</p>\n<p>暂停时间不会随着堆、live-set 或 root-set 的大小而增加</p>\n<p>处理大小从 8MB 到 16TB 的堆</p>\n<p>ZGC 最初是作为 JDK 11 中的一项实验性功能引入的，并在 JDK 15 中被宣布为 Production Ready。</p>\n<p>ZGC 的几个特征：</p>\n<p>并发</p>\n<p>基于区域</p>\n<p>基于压缩</p>\n<p>NUMA 感知</p>\n<p>使用染色指针</p>\n<p>使用负载屏障（原文为 load barriers）</p>\n<p>ZGC 的核心是一个并发垃圾收集器，这意味着所有繁重的工作都在 Java 线程继续执行的同时完成。这极大地减少了垃圾收集对应用程序响应时间的影响。</p>\n<p>ZGC 项目由 HotSpot Group 赞助。</p>\n<p>下图是截止目前为止（2020-04-17）的 ZGC 的发布时间表，可以看出 ZGC 总 JDK11 开始实验性推出，JDK15 开始正式发布。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/07193612e6885c5946cf49cd8b796561.png\" alt=\"img\"></p>\n<pre><code>    ZGC的部分参数：\n</code></pre>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/5cd0e8857e5f10201c406b4b8c23a379.png\" alt=\"img\"></p>\n<p>ZGC 部分操作：</p>\n<p>使用下述命令选项启用 ZGC</p>\n<p>-XX:+UseZGC<br>\n 启用 ZGC</p>\n<p>设置堆大小</p>\n<pre><code>ZGC 最重要的调优选项是设置最大堆大小（-Xmx&lt;size&gt;）。由于 ZGC 是一个并发收集器，因此必须选择最大堆大小，以便 \n</code></pre>\n<ol>\n<li>\n<p>堆可以容纳应用程序的实时集，</p>\n</li>\n<li>\n<p>堆中有足够的空间来允许在 GC 时处理处理分配。</p>\n</li>\n</ol>\n<p>需要多少空间取决于应用程序的分配率和 live-set 大小。一般而言，给 ZGC 的内存越多越好。但与此同时，浪费内存是不可取的，所以这一切都是为了在内存使用和 GC 需要运行的频率之间找到一个平衡点。</p>\n<p>3. 设置并发 GC 线程数</p>\n<pre><code>    第二个重要的选项是设置并发 GC 线程的数量 (-XX:ConcGCThreads=&lt;number&gt;)。ZGC 具有自动选择此数字的启发式方法。这种启发式通常效果很好，但根据应用程序的特性，这可能需要进行调整。这个选项本质上决定了应该给 GC 多少 CPU-time（ps：这个不知道咋翻译，就叫CPU时间？先不翻译）。给了ZGC太多运行时间，GC 将从应用程序中占用过多的 CPU-time。给它太少，应用程序分配垃圾的速度可能比 GC 收集它的速度快。\n\n    一般来说，如果低延迟（即低应用程序响应时间）是工业环境中的最大痛点，在配置相应操作时候就不需要太吝啬。理想情况下，系统的 CPU 利用率不应超过 70%。\n</code></pre>\n<p>4. 返回未使用内存给操作系统</p>\n<pre><code>    默认情况下，ZGC 取消提交未使用的内存，将其返回给操作系统。这对于注重内存占用的应用程序和环境很有用。可以使用 -XX:-ZUncommit 禁用此功能。此外，内存不会被取消提交，因此堆大小会缩小到最小堆大小 (-Xms) 以下。这意味着如果最小堆大小 (-Xms) 配置为等于最大堆大小 (-Xmx)，则此功能将被隐式禁用。\n\n    可以使用 -XX:ZUncommitDelay=&lt;seconds&gt; 配置取消提交延迟（默认为 300 秒）。此延迟指定内存在有资格取消提交之前应该未使用多长时间。\n\n注意事项：在 Linux 上，取消提交未使用的内存需要具有 FALLOC_FL_PUNCH_HOLE 支持的 fallocate(2)，此特性首先出现在内核版本 3.5（用于 tmpfs）和 4.3（用于 hugetlbfs）中。\n</code></pre>\n<p>5. 启用 Linux 的大页（large page）操作</p>\n<pre><code>    将 ZGC 配置为使用大页面通常会产生更好的性能（在吞吐量、延迟和启动时间方面）并且没有真正的缺点，只是设置起来稍微复杂一些。设置过程通常需要 root 权限，这就是默认情况下不启用它的原因。\n\n    在 Linux/x86 上，大页面（英文原文为large page和huge page）的大小为 2MB。\n\n    假设您需要一个 16G Java 堆。这意味着您需要 16G / 2M = 8192 个大页面。\n\n    首先为大页面池分配至少 16G（8192 页）的内存。“至少”部分很重要，因为在 JVM 中启用大页面意味着不仅 GC 会尝试将这些用于 Java 堆，而且 JVM 的其他部分也会尝试将它们用于各种 内部数据结构（代码堆、标记位图等）。因此，在本例中，我们将保留 9216 个页面 (18G) 以允许 2G 的非 Java 堆分配来使用大页面。\n</code></pre>\n<p>6. 启用 Linux 的透明大页（transparent large page）操作</p>\n<pre><code>    使用显式大页面（explicit large pages，就是5小节的大页面）的替代方法是使用透明大页面（ transparent huge pages）。通常不建议对延迟敏感的应用程序使用透明大页面（ latency sensitive，因为它往往会导致不必要的延迟峰值。但是，可能值得尝试看看系统的工作负载是否/如何受到它的影响。\n\n    注意事项：在 Linux 上，使用启用透明大页的 ZGC 需要kernel &gt;= 4.7。\n</code></pre>\n<p>7. 启用 NUMA 支持</p>\n<pre><code>    ZGC 支持 NUMA，这意味着它会尽量将 Java 堆分配指向 NUMA 本地内存。默认情况下启用此功能。但是，如果 JVM 检测到它只能使用单个 NUMA 节点上的内存，它将自动被禁用。通常，无需担心此设置，但如果您想显式覆盖 JVM 的决定，可以使用 -XX:+UseNUMA 或 -XX:-UseNUMA 选项来实现。\n\n    在 NUMA 机器（例如多插槽 x86 机器）上运行时，启用 NUMA 支持通常会显著提升性能。\n\n    注:\n\n   关于NUMA,即Non Uniform Memory Access，非统一内存管理技术。以下直接截图于百度百科：\n</code></pre>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9fa912e0f93d4dd49a4eecd618d86951.png\" alt=\"img\"></p>\n<p>8. 启用 GC 日志</p>\n<p>打个日志而已，就截图了。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0f12489b9377904e0ada4b5977cb3e19.png\" alt=\"img\"></p>\n<p>具体操作还是参考链接 2。</p>\n<p>02 ZGC 在 JDK17 中的最新优化<br>\n翻译自链接 4。</p>\n<pre><code>   JDK 17 于2021年 9 月 14 日发布。这是一个长期支持 (LTS) 版本，这意味着它将得到多年的支持和更新。这也是第一个包含 ZGC 生产就绪版本（production ready version）的 LTS 版本。 稍微回忆一下，JDK 11（以前的 LTS 版本）中包含了 ZGC 的实验版本，而 ZGC 的第一个生产就绪版本出现在 JDK 15（非 LTS 版本）中。\n\n    因此，可以说JDK17是第一个开始推出成熟的ZGC的长期支持的ZGC版本。\n\n    （本来还想把JDK15，JDK16啥的ZGC的翻译一下，不过既然JDK17中ZGC这么重要，就只搬运JDK17的优化好了。）\n</code></pre>\n<p>1. 动态 GC 线程数</p>\n<pre><code>    长期以来，JVM 都有一个名为\n\n    -XX:+UseDynamicNumberOfGCThreads \n</code></pre>\n<p>的选项。它默认启用，并告诉 GC 智能地了解它用于各种操作的 GC 线程数。使用的线程数将不断重新评估，因此会随着时间而变化。这个选项很有用有几个原因。例如，很难确定给定工作负载的最佳 GC 线程数是多少。通常发生的情况是，运维人员尝试各种设置 -XX:ParallelGCThreads 和 / 或 -XX:ConcGCThreads （取决于使用的 GC），看看哪个似乎给出了最好的结果。更复杂的是，最佳 GC 线程数可能会随着应用程序经历不同阶段而随时间变化，因此设置固定数量的 GC 线程本质上可能不是最佳的。</p>\n<pre><code>    在 JDK 17 之前，ZGC 忽略 -XX:+UseDynamicNumberOfGCThreads 并始终使用固定数量的线程。在 JVM 启动期间，ZGC 使用启发式方法来决定该固定数字 (-XX:ConcGCThreads) 应该是什么。一旦设定了这个数字，它就再也不会改变了。从 JDK 17 开始，ZGC 现在支持 -XX:+UseDynamicNumberOfGCThreads 并尝试使用尽可能少、但是足够多的线程来保持以创建的速度收集垃圾。这有助于避免使用比需要更多的 CPU 时间，从而使 Java 线程可以使用更多的 CPU 时间。\n\n    另请注意，启用此功能后，-XX:ConcGCThreads 的含义从“使用这么多线程”变为“最多使用这么多线程”。除非有一个非常规的工作负载，否则你通常不需要摆弄 -XX:ConcGCThreads。ZGC 的启发式算法会根据运行的系统的大小为机器选择合适的最大线程数。\n\n    （注：就是说JDK17开始，ZGC的运行时线程数是动态的，-XX:ConcGCThreads 设置的是最大可用线程，但是如果更少的线程就能满足需求，ZGC就会使用更少的线程；如果运行中需要增加线程数，ZGC也会动态增加线程数）\n</code></pre>\n<p>为了说明此功能的实际作用，官方贴出了一下运行 SPECjbb2015 时的一些图表。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/8d76e888d04e4ade98e9570cc2e6b6c2.png\" alt=\"img\"></p>\n<pre><code>    第一张图显示了整个运行过程中使用的 GC 线程数。SPECjbb2015 有一个初始加速阶段，随后是一个较长的阶段，其中负载（注入速率）逐渐增加。我们可以看到 ZGC 使用的线程数反映了它需要做的工作量来跟上。只有在少数情况下，它需要所有（在本例中为 5 个）线程。\n\n    JDK16和JDK17的打分比较图如下。\n</code></pre>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/0ee86707c2957f6abf19e262612ec1db.png\" alt=\"img\"></p>\n<pre><code>    如果出于某种原因希望始终使用固定数量的 GC 线程（如在 JDK 16 和更早版本中），则可以使用 -XX:-UseDynamicNumberOfGCThreads 禁用此功能（注：应该没人会用吧？）。\n</code></pre>\n<p>2. 快速 JVM 终止</p>\n<pre><code>    在之前使用版本的Java程序中，如果使用的垃圾回收器是 ZGC ，终止正在运行的 Java 进程（例如，通过按 Ctrl+C 或通过让应用程序调用 System.exit()）， JVM 有时可能需要一段时间（在最坏的情况下为数秒）才能真正终止。这在一些需要快速宕机的场景下很烦人，如果某个场景需要快速终止程序，JVM的慢停止会导致一定问题。。\n\n    那么，为什么之前在使用 ZGC 时，JVM 有时会需要一些时间来终止呢？原因是 JVM 的关闭顺序需要与 GC 协调，让 GC 停止正在做的事情，进入“安全”状态。ZGC 仅在空闲时处于“安全”状态，即当前不收集垃圾。如果终止信号到达时正在进行一个非常长的 GC 周期，那么 JVM 关闭序列只需等待该 GC 周期完成，然后 ZGC 变为空闲并再次进入“安全”状态。\n\n    这已在 JDK 17 中得到解决。ZGC 现在能够中止正在进行的 GC 循环，以按需快速达到“安全”状态。终止运行 ZGC 的 JVM 现在或多或少是即时的。\n</code></pre>\n<p>3. 减少标记堆栈内存使用</p>\n<pre><code>    ZGC做条纹标记。这是指将堆划分为条带，并分配每个 GC 线程来标记其中一个条带（strip）中的对象。这有助于最小化 GC 线程之间的共享状态，并使标记过程对缓存更加友好，因为两个 GC 线程不会在堆的同一部分标记对象。这种方法还可以在 GC 线程之间实现自然的工作平衡，因为一个条带（strip）中的工作量往往大致相同。\n\n    下图是ZGC的基于多线程垃圾回收器对基于条带的Java堆内存的回收机制示意图。\n</code></pre>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/3792f57ec3bd3c6ddb1b3f61b7f70b5c.png\" alt=\"img\"></p>\n<pre><code>    在 JDK 17 之前，ZGC 的标记严格遵守条带化。如果一个 GC 线程在跟踪对象图时遇到一个对象引用，该对象引用指向不属于其分配的条带的堆的一部分，则该对象引用被放置在与该其他对象关联的线程本地标记堆栈上条纹。一旦该堆栈已满（254 个条目），它就会被移交给分配给该条带处理标记的 GC 线程。将对象引用加载到尚未标记的对象的 Java 线程会做同样的事情，只是它总是将对象引用放在关联的线程本地标记堆栈上，并且不会自己做任何实际的标记工作。\n\n    这种方法适用于大多数工作负载，但也存在病态问题。如果您有一个具有一个或多个 N:1 关系的对象图，其中 N 是一个非常大的数字，那么您可能会为标记堆栈使用大量内存（如许多 GB）。我们一直都知道这可能是一个问题，您可以编写一个小型综合测试来引发它，但我们从未真正遇到过暴露它的真实工作负载。也就是说，直到来自腾讯的 OpenJDK 贡献者报告他们在野外遇到了这个问题（注：我去，鹅厂！）。\n\n    JDK 17 中对此的修复涉及通过以下方式放松严格条带化：\n</code></pre>\n<p>对于 GC 线程，无论对象引用指向哪个条带，首先尝试标记对象（即可能跳出 GC 线程分配的条带），如果尚未标记，则将对象引用推送到关联标记 堆。</p>\n<p>对于 Java 线程，首先检查对象是否已标记，如果尚未标记，则将对象引用推送到关联的标记堆栈。</p>\n<p>（注：这一块我其实看的不是很懂。要是有人有兴趣讨论的话欢迎交流）。</p>\n<pre><code>这些调整有助于阻止在病态 N:1 情况下过度使用标记堆栈内存，其中 GC 线程一遍又一遍地遇到相同的对象引用，将大量重复的对象引用推入标记堆栈。重复是没有用的，因为一个对象只需要标记一次。通过在推送之前进行标记，并且只推送以前未标记的对象，复制品的生产就会停止。\n\n我们最初有点不愿意这样做，因为 GC 线程现在正在执行原子比较和交换操作，以标记内存中属于分配给其他 GC 线程工作的条带的对象。这打破了严格的条带化，使其对缓存不太友好。Java 线程现在也在进行原子加载以查看对象是否被标记，这是他们以前没有做过的事情。同时，GC 线程完成的其他工作（扫描/跟踪对象字段和跟踪每个堆区域的活动对象/字节数）仍然遵守严格的条带化。最后，基准测试表明我们最初的担忧是没有根据的。GC 标记时间不受影响，对 Java 线程的影响也不明显。另一方面，我们现在有一个更健壮的标记方案，不会出现过多的内存使用。\n\n    （注：所以其实出现这个问题，是不是因为只是因为某厂的代码写的太烂了……）\n</code></pre>\n<p>支持 ARM 上的 macOS</p>\n<pre><code>    前段时间（注：苹果2020年的秋季发布会的消息），Apple 宣布了一项将其 Mac 计算机产品线从 x86 过渡到 ARM 的长期计划。不久之后，JEP 391: macOS/AArch64 Port 提出了 JDK 到这个新平台的移植。JVM 代码库是相当模块化的，特定于操作系统和 CPU 的代码与共享平台无关代码隔离。JDK 已经支持 macOS/x86 和 Linux/Aarch64，因此支持 macOS/Aarch64 所需的主要部分已经存在。当然，任何计划发布和支持 JDK 的 macOS/Aarch64 构建的人仍然需要做一些工作，比如投资新硬件，将这个新平台集成到 CI 管道中等。\n\n    ZGC的故事几乎相同。macOS/x86 和 Linux/Aarch64 都已经得到支持，因此主要是启用构建和测试这种新的 OS/CPU 组合的问题。从 JDK 17 开始，ZGC 在以下平台上运行：\n</code></pre>\n<p>Linux/x64</p>\n<p>Linux/AArch64</p>\n<p>macOS/x64</p>\n<p>macOS/AArch64</p>\n<p>Window/x64</p>\n<p>Windows/AArch64</p>\n<p>大多数 ZGC 代码库继续独立于平台。当前的代码分布如下所示：</p>\n<p>​        <img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d43c84500703a456f8a4ad7e2a2c686b.png\" alt=\"img\"></p>\n<p>用于循环和暂停的 GarbageCollectorMXBeans</p>\n<pre><code>    GarbageCollectorMXBean 提供有关 GC 的信息。通过这个 bean，应用程序可以提取摘要信息（到目前为止完成的 GC 次数、累计花费的 GC 时间等）并监听 GarbageCollectionNotificationInfo 通知以获取有关单个 GC 的更细粒度的信息（GC 原因、开始时间、结束时间， ETC）。\n\n    在 JDK 17 之前，ZGC 发布了一个名为 ZGC 的单个 bean。这个 bean 提供了有关 ZGC 周期的信息。一个循环包括从开始到结束的所有 GC 阶段。大多数阶段是并发的，但有些是 Stop-The-World 暂停。虽然有关周期的信息很有用，但您可能还想知道在执行 GC 上花费了多少时间在 Stop-The-World 暂停上。此信息不适用于单个 ZGC bean。为了解决这个问题，ZGC 现在发布了两个 bean，一个称为 ZGC Cycles，一个称为 ZGC Pauses。顾名思义，每个 bean 提供的信息分别映射到周期和暂停。\n</code></pre>\n<p>总结：</p>\n<pre><code>    作为第一个支持生产版本ZGC的LTS版本的JDK，JDK17中对ZGC做了下述优化：\n</code></pre>\n<p>支持 JVM 选项 -XX:+UseDynamicNumberOfGCThreads。此功能默认启用，并告诉 ZGC 对其使用的 GC 线程数保持智能，这通常会导致 Java 应用程序级别的更高吞吐量和更低延迟。</p>\n<p>使用了 ZGC 的 JVM 在停止运行时， 基本上是实时的，而之前版本花费的时间更多。</p>\n<p>标记算法现在通常使用更少的内存，并且不再容易出现过多的内存使用。</p>\n<p>ZGC 现在可以在 macOS/Aarch64 上运行。</p>\n<p>ZGC 现在发布了两个 GarbageCollectorMXBean，以提供有关 GC 周期和 GC 暂停的信息。</p>\n<p>03 一些很搞笑的事情</p>\n<pre><code>    据说有哥们在面试时候被面试官问到，ZGC的Z代表的是啥？\n\n    面试者老哥内心OS：我去葛格不讲武德啊，之前面经没有讲到这个啊。但是呆胶布，我现场编一个。\n\n    于是他说，“ZGC的Z是英文字母的最后一个字母，这说明Oracle公司想把ZGC作为Java的最终解决方案，是一个革命性的Java垃圾回收机制解决方案，blabla。”\n\n    面试官微微一笑贴出官网截屏：\n</code></pre>\n<p>​</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/b5813b2129f9db814556823199eb2355.png\" alt=\"img\"></p>\n<p>翻译：ZGC 的 Z 毛线都不表示，莫得含义。</p>\n<pre><code>    面试者：不听不听王八念经。\n\n    笑死。</code></pre>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Volatile%E5%85%B3%E9%94%AE%E5%AD%97/",
            "url": "http://example.com/2022/12/27/Volatile%E5%85%B3%E9%94%AE%E5%AD%97/",
            "title": "Volatile关键字",
            "date_published": "2022-12-27T08:18:48.633Z",
            "content_html": "<h1 id=\"volatile关键字\"><a class=\"markdownIt-Anchor\" href=\"#volatile关键字\">#</a> Volatile 关键字</h1>\n<p>Volatile 关键字的作用主要有如下两个：</p>\n<p>线程的可见性：当一个线程修改一个共享变量时，另外一个线程能读到这个修改的值。</p>\n<p>顺序一致性：禁止指令重排序。</p>\n<h1 id=\"一-线程可见性\"><a class=\"markdownIt-Anchor\" href=\"#一-线程可见性\">#</a> 一、线程可见性</h1>\n<p>我们先通过一个例子来看看线程的可见性：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">VolatileTest</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">updateFlag</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;修改flag值为：&quot;</span> + <span class=\"built_in\">this</span>.flag);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">VolatileTest</span> <span class=\"variable\">test</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">VolatileTest</span>();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (test.flag) &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;结束&quot;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;Thread1&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">                test.updateFlag();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;Thread2&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>打印结果如下，我们可以看到虽然线程 Thread2 已经把 flag 修改为 false 了，但是线程 Thread1 没有读取到 flag 修改后的值，线程一直在运行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改flag值为：false</span><br></pre></td></tr></table></figure>\n<p>我们把 flag 变量加上 volatile：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">volatile  boolean flag = true;</span><br></pre></td></tr></table></figure>\n<p>重新运行程序，打印结果如下。Thread1 结束，说明 Thread1 读取到了 flage 修改后的值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改flag值为：false</span><br><span class=\"line\">Thread1结束</span><br></pre></td></tr></table></figure>\n<p>说到可见性，我们需要先了解一下 Java 内存模型，Java 内存模型如下所示：</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/d90e39f9caa340b0bb589ef1dbb2f667.png\" alt=\"在这里插入图片描述\"></p>\n<p>线程之间的共享变量存储在主内存中（Main Memory）中，每个线程都一个都有一个私有的本地内存（Local Memory），本地内存中存储了该线程以读 / 写共享变量的副本。</p>\n<p>所以当一个线程把主内存中的共享变量读取到自己的本地内存中，然后做了更新。在还没有把共享变量刷新的主内存的时候，另外一个线程是看不到的。</p>\n<p>如何把修改后的值刷新到主内存中的？<br>\n现代的处理器使用写缓冲区临时保存向内存写入的数据。写缓冲区可以保证指令流水线持续运行，它可以避免由于处理器停顿下来等向内存写入数据而产生的延迟。同时，通过以批处理的方式刷新写缓冲区，以及合并写缓冲区中对同一内存地址的多次写，较少对内存总线的占用。但是什么时候写入到内存是不知道的。<img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f96ceb17a5644f7db67d3a64f8b888fa.png\" alt=\"在这里插入图片描述\"></p>\n<p>所以就引入了 volatile，volatile 是如何保证可见性的呢？<br>\n在 X86 处理器下通过工具获取 JIT 编译器生成的汇编指令来查看对 volatile 进行写操作时，会多出 lock addl。Lock 前缀的指令在多核处理器下会引发两件事情：</p>\n<p>1. 将当前处理器缓存行的数据写回到系统内存。<br>\n2. 这个写回内存的操作会使其他 cpu 里缓存了该内存地址的数据无效。<br>\n如果声明了 volatile 的变量进行写操作，JVM 就会向处理器发送一条 Lock 前缀的指令，将这个变量所在缓存行的数据写回到系统内存。但是，就算写回到内存，如果其他处理器缓存的还是旧的，在执行操作就会有问题。所以，在多处理器下，为了保证各个处理器的缓存是一致的，就会实现缓存一致性协议，每个处理器通过嗅探在总线传播的数据来检查自己缓存的值是不是过期了，当处理器发现自己缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改操作的时候，会重新从系统内存中把数据读到处理器缓存里。</p>\n<h1 id=\"二-顺序一致性\"><a class=\"markdownIt-Anchor\" href=\"#二-顺序一致性\">#</a> 二、顺序一致性</h1>\n<p>在执行程序时，为了提高性能，编译器和处理器常常会对指令做重排序。重排序分为如下三种：</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/39a6b41a1a1a4d0191f418b0519aa532.png\" alt=\"在这里插入图片描述\"></p>\n<p>1 属于编译器重排序，2 和 3 属于处理器重排序。这些重排序可能会导致多线程程序出现内存可见性问题。<br>\n当变量声明为 volatile 时，Java 编译器在生成指令序列时，会插入内存屏障指令。通过内存屏障指令来禁止重排序。<br>\nJMM 内存屏障插入策略如下：<br>\n在每个 volatile 写操作的前面插入一个 StoreStore 屏障，后面插入一个 StoreLoad 屏障。<br>\n在每个 volatile 读操作后面插入一个 LoadLoad，LoadStore 屏障。</p>\n<p>Volatile 写插入内存屏障后生成指令序列示意图：</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/f44d26762f704a28905e2f65b2a75d53.png\" alt=\"在这里插入图片描述\"></p>\n<p>Volatile 读插入内存屏障后生成指令序列示意图：</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/97e184ee75ed4e18b3066e1c8ab585e1.png\" alt=\"在这里插入图片描述\"></p>\n<p>通过上面这些我们可以得出如下结论：编译器不会对 volatile 读与 volatile 读后面的任意内存操作重排序；编译器不会对 volatile 写与 volatile 写前面的任意内存操作重排序。</p>\n<p>防止重排序使用案例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SafeDoubleCheckedLocking</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> Instance instane;</span><br><span class=\"line\">    <span class=\"keyword\">public</span>  <span class=\"keyword\">static</span> Instance <span class=\"title function_\">getInstane</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(instane==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (SafeDoubleCheckedLocking.class)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(instane==<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                    instane=<span class=\"keyword\">new</span> <span class=\"title class_\">Instance</span>();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instane;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>创建一个对象主要分为如下三步：</p>\n<p>分配对象的内存空间。<br>\n初始化对象。<br>\n设置 instance 指向内存空间。<br>\n如果 instane 不加 volatile，上面的 2，3 可能会发生重排序。假设 A，B 两个线程同时获取，A 线程获取到了锁，发生了指令重排序，先设置了 instance 指向内存空间。这个时候 B 线程也来获取，instance 不为空，这样 B 拿到了没有初始化完成的单例对象（如下图）</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/70457cf0d7904aa5a8b3edb1bffd4561.png\" alt=\"在这里插入图片描述\"></p>\n<p>二、Volatile 与 Synchronized 比较<br>\n 1.Volatile 是轻量级的 synchronized，因为它不会引起上下文的切换和调度，所以 Volatile 性能更好。<br>\n2.Volatile 只能修饰变量，synchronized 可以修饰方法，静态方法，代码块。<br>\n3.Volatile 对任意单个变量的读 / 写具有原子性，但是类似于 i++ 这种复合操作不具有原子性。而锁的互斥执行的特性可以确保对整个临界区代码执行具有原子性。<br>\n4. 多线程访问 volatile 不会发生阻塞，而 synchronized 会发生阻塞。<br>\n5.volatile 是变量在多线程之间的可见性，synchronize 是多线程之间访问资源的同步性。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/typora%E9%85%8D%E7%BD%AEAliCloudOss%E5%9B%BE%E5%BA%93%E4%BD%BF%E7%94%A8picgo%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/",
            "url": "http://example.com/2022/12/27/typora%E9%85%8D%E7%BD%AEAliCloudOss%E5%9B%BE%E5%BA%93%E4%BD%BF%E7%94%A8picgo%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87/",
            "title": "Typora使用gitee作为图库用picgo上传图片的教程~",
            "date_published": "2022-12-27T08:18:48.631Z",
            "content_html": "<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<ul>\n<li>这一年，写的博客也多，总是需要<strong>插入图片</strong>的，图片存在本地的话上传到博客网站去就没法显示了，就算一个图一个图的复制粘贴上去，想移植到其他的博客网站，图就会失效，为了解决这个问题，这篇文章就诞生了！</li>\n<li>首先，还是一如既往的推荐别人是怎么搞的！</li>\n<li>参考文章如下：</li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9ibG9nLmNzZG4ubmV0L21ha2VfMTExMTExMTEvYXJ0aWNsZS9kZXRhaWxzLzEwNDgzOTQ5Mg==\">《Typora 上传图片到 CSDN——PicGo + Gitee (码云) 实现 markdown 免费图床 —— 开局第一篇》</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9zZWdtZW50ZmF1bHQuY29tL2EvMTE5MDAwMDAyMjUzNTE1NA==\">《markdown 笔记神器 Typora 如何上传图片？（图床功能）</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy93d3cuY29kZW5vbmcuY29tL2NzMTA2NTI4Nzk1Lw==\">《一文教你用 Typora + Gitee (码云) + PicGo 实现 云 markdown 笔记》</span></li>\n</ul>\n<h2 id=\"环境配置预览\"><a class=\"markdownIt-Anchor\" href=\"#环境配置预览\">#</a> 环境配置预览</h2>\n<ul>\n<li>安装 nodejs：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9ub2RlanMub3JnL2VuLw==\">https://nodejs.org/en/</span></li>\n<li>Gitee 账户：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9naXRlZS5jb20v\">https://gitee.com/</span></li>\n<li>Typora 软件:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy93d3cudHlwb3JhLmlvLyUyM3dpbmRvd3M=\">https://www.typora.io/#windows</span></li>\n<li>PicGo:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9tb2x1bmVyZmlubi5jb20vUGljR28v\">https://molunerfinn.com/PicGo/</span></li>\n<li></li>\n</ul>\n<h2 id=\"01安装nodejs\"><a class=\"markdownIt-Anchor\" href=\"#01安装nodejs\">#</a> 01. 安装 nodejs</h2>\n<p>请百度自行安装，不过多介绍</p>\n<p>node 和 npm 环境检测：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\&gt;node -v</span><br><span class=\"line\">v14.16.0</span><br><span class=\"line\"></span><br><span class=\"line\">C:\\&gt;npm -v</span><br><span class=\"line\">6.14.11</span><br></pre></td></tr></table></figure>\n<h2 id=\"02gitee账户配置\"><a class=\"markdownIt-Anchor\" href=\"#02gitee账户配置\">#</a> 02.Gitee 账户配置</h2>\n<h2 id=\"新建仓库\"><a class=\"markdownIt-Anchor\" href=\"#新建仓库\">#</a> 新建仓库</h2>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-2fe1a9ce620e81b91401ea878be94548_720w.jpg\" alt=\"img\"></p>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-02b0a2c63381b110e5bdc4ac994bd274_720w.jpg\" alt=\"img\"></p>\n<h2 id=\"私人令牌token配置获取\"><a class=\"markdownIt-Anchor\" href=\"#私人令牌token配置获取\">#</a> 私人令牌 token 配置获取</h2>\n<ul>\n<li>找到 <code>设置</code>  -&gt; <code>安全设置</code>  -&gt; <code>私人令牌</code> ，点击生成新令牌</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-5493431b257b8313f420cd1c456d5550_720w.jpg\" alt=\"img\"></p>\n<ul>\n<li>选择下面的选项即可！</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-06263bbbc624e2b9d5d3782cad1f68b3_720w.jpg\" alt=\"img\"></p>\n<ul>\n<li>点击提交，账户安全验证即可</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-a9ab747329a35bc374101fe870a48084_720w.jpg\" alt=\"img\"></p>\n<ul>\n<li>保存后面生成的私人令牌</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-cf484c849d232aaf07e91460899b0a0e_720w.jpg\" alt=\"v2-cf484c849d232aaf07e91460899b0a0e_720w\"></p>\n<ul>\n<li>gitee 配置到此完毕！</li>\n</ul>\n<h2 id=\"03picgo配置\"><a class=\"markdownIt-Anchor\" href=\"#03picgo配置\">#</a> 03.PicGo 配置</h2>\n<h2 id=\"插件安装\"><a class=\"markdownIt-Anchor\" href=\"#插件安装\">#</a> 插件安装</h2>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-c6b94bdc27f8f0300673d02e4800c360_720w.jpg\" alt=\"img\"></p>\n<h2 id=\"插件配置\"><a class=\"markdownIt-Anchor\" href=\"#插件配置\">#</a> 插件配置</h2>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-599672d63434fc5cc4dff76104f21778_720w.jpg\" alt=\"img\"></p>\n<h2 id=\"上传尝试\"><a class=\"markdownIt-Anchor\" href=\"#上传尝试\">#</a> 上传尝试</h2>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-9cd264eef40166488ebdda103631689d_720w.jpg\" alt=\"img\"></p>\n<ul>\n<li>这里，您可以随便截图一张，剪贴板图片上传试试效果</li>\n<li>图片放大看看，本文的图片是不是就在下面这里！哈哈哈！</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-05a45967b7af32a9f3299d93fdeab526_720w.jpg\" alt=\"img\"></p>\n<h2 id=\"04typora配置\"><a class=\"markdownIt-Anchor\" href=\"#04typora配置\">#</a> 04.Typora 配置</h2>\n<ul>\n<li>说实话，写这篇文章，就是想用到 markdown 自动上传图片，自动同步图片到各个平台！</li>\n<li>废话不多说，建议直接和博主配置一样就行！</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220428093756533.png\" alt=\"image-20220428093756533\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/SVN&Git%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/",
            "url": "http://example.com/2022/12/27/SVN&Git%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C/",
            "title": "SVN&Git使用手册",
            "date_published": "2022-12-27T08:18:48.629Z",
            "content_html": "<p>切记 代码是先更新再提交.<br>\n（一）SVN 和 GIt 区别<br>\n 1．基本<br>\n SVN 是集中式版本控制工具<br>\n git 是分布式版本控制工具</p>\n<p>2．SVN 和 Git 优缺点<br>\n svn 优点:<br>\n1. 方便管理者查看每个开发者开发进度<br>\n 2. 方便对开发者进行权限控制<br>\n svn 缺点:<br>\n1. 严重依赖网络环境进行版本控制<br>\n 2. 中央服务器宕机，无法进行版本控制<br>\n 3. 中央服务器磁盘损坏，丢失历史版本内容<br>\n Git 优点:<br>\n1. 很完美的解决了 SVN 存在的缺点</p>\n<p>TortoiseGit 小乌龟<br>\n给当前项目提交到码云上<br>\n 1. 用浏览器登录码云，在码云上创建一个仓库<br>\n 2. 打开 TortoiseGit 软件<br>\n 3. 新建一个文件夹改好名字 (注意是空文件夹)<br>\n 4. 右键文件夹–&gt;Git 克隆…–&gt; 弹出如下图–&gt; 粘贴好 url<br>\n5. 点击确定就可以了</p>\n<p>6. 然后就给你自己的代码放入刚才的文件夹下，然后就点击推送等等.<br>\n2．设置用户名和邮箱</p>\n<p>直接设置即可。签名密钥不需要管</p>\n<p>Git 使用笔记<br>\n（一）概念<br>\n 1．什么是版本控制</p>\n<p>版本控制是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。 除了项目源代码，你可以对任何类型的文件进行版本控制。</p>\n<p>2．为什么要版本控制<br>\n有了它你就可以将某个文件回溯到之前的状态，甚至将整个项目都回退到过去某个时间点的状态，你可以比较文件的变化细节，查出最后是谁修改了哪个地方，从而找出导致怪异问题出现的原因，又是谁在何时报告了某个功能缺陷等等。<br>\n许多人习惯用复制整个项目目录的方式来保存不同的版本，或许还会改名加上备份时间以示区别。 这么做唯一的好处就是简单，但是特别容易犯错。 有时候会混淆所在的工作目录，一不小心会写错文件或者覆盖意想外的文件。<br>\n为了解决这个问题，人们很久以前就开发了许多种本地版本控制系统，大多都是采用某种简单的数据库来记录文件的历次更新差异。<br>\n3．集中化的版本控制系统<br>\n接下来人们又遇到一个问题，如何让在不同系统上的开发者协同工作？ 于是，集中化的版本控制系统（Centralized Version Control Systems，简称 CVCS）应运而生。<br>\n集中化的版本控制系统都有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。<br>\n这么做虽然解决了本地版本控制系统无法让在不同系统上的开发者协同工作的诟病，但也还是存在下面的问题：</p>\n<p>单点故障： 中央服务器宕机，则其他人无法使用；如果中心数据库磁盘损坏有没有进行备份，你将丢失所有数据。本地版本控制系统也存在类似问题，只要整个项目的历史记录被保存在单一位置，就有丢失所有历史更新记录的风险。</p>\n<p>必须联网才能工作： 受网络状况、带宽影响。</p>\n<p>4．分布式版本控制系统<br>\n于是分布式版本控制系统（Distributed Version Control System，简称 DVCS）面世了。 Git 就是一个典型的分布式版本控制系统。<br>\n这类系统，客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来。 这么一来，任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复。 因为每一次的克隆操作，实际上都是一次对代码仓库的完整备份。<br>\n分布式版本控制系统可以不用联网就可以工作，因为每个人的电脑上都是完整的版本库，当你修改了某个文件后，你只需要将自己的修改推送给别人就可以了。但是，在实际使用分布式版本控制系统的时候，很少会直接进行推送修改，而是使用一台充当 “中央服务器” 的东西。这个服务器的作用仅仅是用来方便 “交换” 大家的修改，没有它大家也一样干活，只是交换修改不方便而已。<br>\n分布式版本控制系统的优势不单是不必联网这么简单，后面我们还会看到 Git 极其强大的分支管理等功能。<br>\n5．Git 与其他版本管理系统的主要区别<br>\n Git 在保存和对待各种信息的时候与其它版本控制系统有很大差异，尽管操作起来的命令形式非常相近，理解这些差异将有助于防止你使用中的困惑。<br>\n下面我们主要说一个关于 Git 其他版本管理系统的主要差别：对待数据的方式。<br>\nGit 采用的是直接记录快照的方式，而非差异比较。我后面会详细介绍这两种方式的差别。<br>\n大部分版本控制系统（CVS、Subversion、Perforce、Bazaar 等等）都是以文件变更列表的方式存储信息，这类系统将它们保存的信息看作是一组基本文件和每个文件随时间逐步累积的差异。<br>\n具体原理如下图所示，理解起来其实很简单，每个我们对提交更新一个文件之后，系统记录都会记录这个文件做了哪些更新，以增量符号 Δ(Delta) 表示。</p>\n<p>我们怎样才能得到一个文件的最终版本呢？<br>\n很简单，高中数学的基本知识，我们只需要将这些原文件和这些增加进行相加就行了。<br>\n这种方式有什么问题呢？<br>\n比如我们的增量特别特别多的话，如果我们要得到最终的文件是不是会耗费时间和性能。<br>\nGit 不按照以上方式对待或保存数据。 反之，Git 更像是把数据看作是对小型文件系统的一组快照。 每次你提交更新，或在 Git 中保存项目状态时，它主要对当时的全部文件制作一个快照并保存这个快照的索引。 为了高效，如果文件没有修改，Git 不再重新存储该文件，而是只保留一个链接指向之前存储的文件。 Git 对待数据更像是一个 快照流。</p>\n<p>6．使用 git 原因<br>\n分布式版本控制工具<br>\n为什么使用 git 呢？<br>\n互联网项目，业务越来越复杂，项目越来越大，使用 SVN 版本控制不太好使了。<br>\n从 git 目标，看 git 的优势 速度快、分布式、有能力管理大型项目</p>\n<p>7．工作流程以及流程图</p>\n<p>在工作目录中修改文件。<br>\n暂存文件，将文件的快照放入暂存区域。<br>\n提交更新，找到暂存区域的文件，将快照永久性存储到 Git 仓库目录。<br>\n8．程序员工作流程<br>\n项目经理：1 创建项目 2 项目添加本地暂存态 3 项目提交到本地 4 建立远程连接 5 推送代码到远程服务器<br>\n程序员 A：1 克隆代码到本地 2 编写代码，将代码添加本地暂存态 3 代码提交本地 4 推送代码到服务器<br>\n程序员 B：1 克隆代码到本地 2 编写代码，将代码添加本地暂存态 3 代码提交本地 4 推送代码到服务器 5 更新其他程序员提交的代码<br>\n 9．git 三种状态</p>\n<p>已提交（committed）：数据已经安全的保存在本地数据库中。</p>\n<p>已修改（modified）：已修改表示修改了文件，但还没保存到数据库中。</p>\n<p>已暂存（staged）：表示对一个已修改文件的当前版本做了标记，使之包含在下次提交的快照中。</p>\n<p>由此引入 Git 项目的三个工作区域的概念：Git 仓库 (.git directoty) 、工作目录 (Working Directory) 以及 暂存区域 (Staging Area) 。</p>\n<p>（二）Git 分支<br>\n 1．分支概念</p>\n<p>几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来，然后在不影响主线的同时继续工作。在很多版本控制系统中，这是个昂贵的过程，常常需要创建一个源代码目录的完整副本，对大型项目来说会花费很长时间。</p>\n<p>有人把 Git 的分支模型称为 “必杀技特性”，而正是因为它，将 Git 从版本控制系统家族里区分出来。Git 有何特别之处呢？Git 的分支可谓是难以置信的轻量级，它的新建操作几乎可以在瞬间完成，并且在不同分支间切换起来也差不多一样快。和许多其他版本控制系统不同，Git 鼓励在工作流程中频繁使用分支与合并，哪怕一天之内进行许多次都没有关系。理解分支的概念并熟练运用后，你才会意识到为什么 Git 是一个如此强大而独特的工具，并从此真正改变你的开发方式。<br>\n2．分支需求<br>\n现在让我们来看一个简单的分支与合并的例子，实际工作中大体也会用到这样的工作流<br>\n程：</p>\n<p>开发某个网站。<br>\n为实现某个新的需求，创建一个分支。<br>\n在这个分支上开展工作。<br>\n假设此时，你突然接到一个电话说有个很严重的问题需要紧急修补，那么可以按照下面的方<br>\n式处理：<br>\n返回到原先已经发布到生产服务器上的分支。<br>\n为这次紧急修补建立一个新分支。<br>\n测试通过后，将此修补分支合并，再推送到生产服务器上。<br>\n切换到之前实现新需求的分支，继续工作。<br>\n（三）git 指令<br>\n 1．创建 git 目录<br>\n git init</p>\n<p>创建 git 目录:<br>\n 该命令将创建一个名为 .git 的子目录，这个子目录含有你初始化的 Git 仓库中所有的必须文件，这些文件是 Git 仓库的骨干。但是，在这个时候，我们仅仅是做了一个初始化的操作，你的项目里的文件还没有被跟踪。(参见 Git 内部原理 来了解更多关于到底 .git 文件夹中包含了哪些文件的信息。)<br>\n 2．克隆仓库<br>\n git clone [url]<br>\n 克隆仓库的命令格式是 git clone [url] 。比如，要克隆 Git 的可链接库 libgit2，可以用下面的命令<br>\n $ git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpYmdpdDIvbGliZ2l0Mg==\">https://github.com/libgit2/libgit2</span></p>\n<p>这会在当前目录下创建一个名为 “libgit2” 的目录，并在这个目录下初始化一个 .git 文件夹，从远程仓库拉取下所有数据放入 .git 文件夹，然后从中读取最新版本的文件的拷贝。如果你进入到这个新建的 libgit2 文件夹，你会发现所有的项目文件已经在里面了，准备就绪等待后续的开发和使用。如果你想在克隆远程仓库的时<br>\n候，自定义本地仓库的名字，你可以使用如下命令<br>\n $ git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2xpYmdpdDIvbGliZ2l0Mg==\">https://github.com/libgit2/libgit2</span> mylibgit<br>\n 这将执行与上一个命令相同的操作，不过在本地创建的仓库名字变为 mylibgit<br>\n3．查看文件状态<br>\n git status<br>\n 要查看哪些文件处于什么状态，可以用 git status 命令。如果在克隆仓库后立即使用此命令，会看到类似这<br>\n样的输出.</p>\n<p>跟踪新文件</p>\n<p>（四）使用<br>\n 1．安装 git</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL25vdGUueW91ZGFvLmNvbS9ub3Rlc2hhcmU/aWQ9NDQ4ODc4YWI4YmRiYTY5MzcxN2Y4OTY3ZTZhYTZhNGY=\">http://note.youdao.com/noteshare?id=448878ab8bdba693717f8967e6aa6a4f</span></p>\n<p>2．将项目上传到码云上</p>\n<p>如果账户已经配置好，git 客户端也安装好，在将要上传的文件中，右键打开 Git Bash Here, 按如下步骤即可：<br>\n1.git init<br>\n2.git remote add origin “你的码云项目地址（ssh 或 https）”<br>\n 开始提交项目<br>\n 3.git pull origin master 如果密码报错看下面<br>\n 4.git touch init .txt  // 如果已经存在更改的文件，则操作这一步，否则跳过即可<br>\n 5.git add .<br>\n6.git commit -m “第一次提交（提交信息）”<br>\n7.git push origin master<br>\n 如出现错误 hint: Updates were rejected because the tip of your current branch is behind<br>\nhint: its remote counterpart. Integrate the remote changes (e.g.<br>\nhint: ‘git pull …’) before pushing again.<br>\nhint: See the ‘Note about fast-forwards’ in ‘git push --help’ for details.<br>\n 可执行此操作继续，git push -u origin master -f  强制命令会覆盖别人分支，慎用</p>\n<p>密码报错在这里进行修改</p>\n<p>3．用 git 从 github 上下载代码</p>\n<p>新建一个文件夹，放你需要下载的东西。右键点击 “Git Bash Here”</p>\n<p>此时会弹出 git 的命令窗口</p>\n<p>3、输入  git clone + 下载地址，回车即可。如   git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29teHh4LmdpdA==\">https://github.comxxx.git</span><br>\n 等待下载</p>\n<p>下载好之后，文件夹里就会出现相应的项目啦～</p>\n<p>（五）GitGUI 操作<br>\n 1．使用 gui 上传代码到码云上<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzMzODY3MTMxL2FydGljbGUvZGV0YWlscy84MDgzMTQ5MQ==\"> https://blog.csdn.net/qq_33867131/article/details/80831491</span></p>\n<p>SVN 的基本使用<br>\n（一）基本简介<br>\n开源的版本控制系统，可以用来保存代码，同步代码，也可以保存图片文档电影什么的.<br>\n 主要作用就是可以随时进行代码同步。但是会存在一些问题，会有一些解决方案<br>\n（二）服务端创建仓库<br>\n 1．搭建仓库，添加用户</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL25vdGUueW91ZGFvLmNvbS9ub3Rlc2hhcmU/aWQ9NTQ5NjYzZTU2NTgwYTM2NDNiYmNjOTEwNGMzNTcyMjY=\">http://note.youdao.com/noteshare?id=549663e56580a3643bbcc9104c357226</span></p>\n<p>2．分配权限</p>\n<p>创建好用户后，用户还是不能访问我们的仓库，接下来我们要给用户分个组（如果想让用户不进组也能访问仓库，可以直接给单个用户权限</p>\n<p>3．给代码放到 svn 上面</p>\n<p>然后复制仓库地址</p>\n<p>在你要上传的项目右键</p>\n<p>然后点击确定</p>\n<p>（三）错误解决<br>\n 1．代码错乱问题<br>\n去查看日志，下载正确的时间段的代码，然后再创建新的仓库，放那个代码，原来的仓库就删除掉就可以了.</p>\n<p>2．No appropriate protocol<br>\n 公司的 SVN 协议从 svn 协议变更到 https 协议，结果 IDEA 的 SVN 报 No appropriate protocol，查询资料，最终解决方案是：<br>\nGo to Preferences &gt; Version Control &gt; SubVersion &gt; Enable Interactive Mode<br>\n3．versionControl 里面找不到 subversion 选项<br>\n去安装 svnToolBox 插件 即可解决</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/SQuirreL%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/",
            "url": "http://example.com/2022/12/27/SQuirreL%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/",
            "title": "Squirrel SQL客户端安装与使用",
            "date_published": "2022-12-27T08:18:48.626Z",
            "content_html": "<h1 id=\"一-squirrel简介\"><a class=\"markdownIt-Anchor\" href=\"#一-squirrel简介\">#</a> 一、Squirrel 简介</h1>\n<p>Squirrel 是一个连接数据库的客户端工具，一般支持 JDBC 的数据库都可以用它来简介，如连接 MySQL。</p>\n<h1 id=\"二-安装准备\"><a class=\"markdownIt-Anchor\" href=\"#二-安装准备\">#</a> 二、安装准备</h1>\n<p>下载 jar 包：squirrel-sql-3.7.1-standard.jar</p>\n<h1 id=\"三-安装\"><a class=\"markdownIt-Anchor\" href=\"#三-安装\">#</a> 三、安装</h1>\n<p>①进入 squirrel-sql-3.7.1-standard.jar 文件所在的目录，在地址栏输入：cmd，进入命令窗口</p>\n<p>②在命令窗口输入：java -jar squirrel-sql-3.7.1-standard.jar，进入安装界面</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172341679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172428945.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172456338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>自行选择安装目录，然后点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172529452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Yes</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172626599.png\" alt=\"img\"></p>\n<p>在下面这个页面，最好选中所有的复选框，以免后续出问题，然后点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172830834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>进入安装窗口，结束后点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207172908294.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>选中复选框，然后点击 Next</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207173028690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Done，完成安装</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207173319861.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>此时，桌面会多出一个图标</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207173404141.png\" alt=\"img\"></p>\n<h1 id=\"四-配置客户端\"><a class=\"markdownIt-Anchor\" href=\"#四-配置客户端\">#</a> 四、配置客户端</h1>\n<p>点击 SQuirrel，进入客户端页面</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207174019153.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>双击 Phoenix 安装包</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207174359249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>将 phoenix-4.8.1-HBase-0.98-client.jar 文件拷贝到 SQuirrel 安装目录的 lib 目录下</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207174203592.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207174320964.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>添加驱动</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/2018120717512761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 OK 后，出现下面界面，说明配置成功</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207175248755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>可以看到添加的驱动</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207175400924.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Aliases，添加 “别名”</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/2018120717573623.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>点击 Test，Connect</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207175819496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>如下所示，配置成功</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207180120990.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>列表中出现添加的 Hadoop01</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207180202313.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p>双击 Hadoop01，点击 TABLE 即可看到对应的表</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20181207180425693.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0pvaG5zb244NzAy,size_16,color_FFFFFF,t_70\" alt=\"img\"></p>\n<p><strong>至此，Squirrel SQL 客户端安装配置完成！</strong></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/",
            "url": "http://example.com/2022/12/27/SpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86/",
            "title": "SpringBoot自动装配原理",
            "date_published": "2022-12-27T08:18:48.624Z",
            "content_html": "<p>自动装配原理：</p>\n<p>要学会 SpringBoot 自动装配原理，首先要来看装配了什么？或者说是装配有什么用？</p>\n<p>1 . 自动装配了什么？</p>\n<p>​\t\tPom 文件：SpringBoot 帮我们配置好了所有 web 开发常见场景、组件、比如 tomcat、mutipart 文件上传。</p>\n<p>​\t\t配置文件：SpringBoot 帮我们装配好了所有组件或者类需要的配置，这些类都有默认的配置，可以通过 application.ymal 或者 application.properties 来修改：比如 server.port=80 修改端口号，默认为 80</p>\n<p>2 . 自动装配有什么用？</p>\n<p>​\t\t简化 SpringMVC 复杂的配置流程、复杂的依赖引入。SpringBoot 旨在：简化开发，约定大于配置。</p>\n<p><strong>总结：</strong></p>\n<ul>\n<li>\n<p><strong>SpringBoot 先加载所有的自动配置类  xxxAutoConfiguration</strong></p>\n</li>\n<li>\n<p><strong>每个自动配置类按照条件进行生效，默认都会绑定配置文件指定的值。xxxProperties 里面拿。xxxProperties 和配置文件进行了绑定</strong></p>\n</li>\n<li>\n<p><strong>生效的配置类就会给容器中装配很多组件</strong></p>\n</li>\n<li>\n<p><strong>只要容器中有这些组件，相当于这些功能就有了</strong></p>\n</li>\n<li>\n<p><strong>定制化配置</strong></p>\n</li>\n<li>\n<ul>\n<li><strong>用户直接自己 @Bean 替换底层的组件</strong></li>\n<li><strong>用户去看这个组件是获取的配置文件什么值就去修改。</strong></li>\n</ul>\n</li>\n</ul>\n<p><strong>xxxAutoConfiguration —&gt; 组件  —&gt;</strong> <strong>xxxProperties 里面拿值  ----&gt; application.properties</strong></p>\n<h1 id=\"1-springboot特点\"><a class=\"markdownIt-Anchor\" href=\"#1-springboot特点\">#</a> 1、SpringBoot 特点</h1>\n<h2 id=\"11-依赖管理\"><a class=\"markdownIt-Anchor\" href=\"#11-依赖管理\">#</a> 1.1、依赖管理</h2>\n<ul>\n<li>父项目做依赖管理</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">依赖管理    </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">他的父项目</span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">几乎声明了所有开发中常用的依赖的版本号,自动版本仲裁机制</span><br></pre></td></tr></table></figure>\n<ul>\n<li>开发导入 starter 场景启动器</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、见到很多 spring-boot-starter-* ： *就某种场景</span><br><span class=\"line\">2、只要引入starter，这个场景的所有常规需要的依赖我们都自动引入</span><br><span class=\"line\">3、SpringBoot所有支持的场景</span><br><span class=\"line\">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</span><br><span class=\"line\">4、见到的  *-spring-boot-starter： 第三方为我们提供的简化开发的场景启动器。</span><br><span class=\"line\">5、所有场景启动器最底层的依赖</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>无需关注版本号，自动版本仲裁</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、引入依赖默认都可以不写版本</span><br><span class=\"line\">2、引入非版本仲裁的jar，要写版本号。</span><br></pre></td></tr></table></figure>\n<ul>\n<li>可以修改默认版本号</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、查看spring-boot-dependencies里面规定当前依赖的版本 用的 key。</span><br><span class=\"line\">2、在当前项目里面重写配置</span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">mysql.version</span>&gt;</span>5.1.43<span class=\"tag\">&lt;/<span class=\"name\">mysql.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"12-自动配置\"><a class=\"markdownIt-Anchor\" href=\"#12-自动配置\">#</a> 1.2、自动配置</h2>\n<ul>\n<li>\n<p>自动配好 Tomcat</p>\n</li>\n<li>\n<ul>\n<li>引入 Tomcat 依赖。</li>\n<li>配置 Tomcat</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.3.4.RELEASE<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>自动配好 SpringMVC</p>\n</li>\n<li>\n<ul>\n<li>引入 SpringMVC 全套组件</li>\n<li>自动配好 SpringMVC 常用组件（功能）</li>\n</ul>\n</li>\n<li>\n<p>自动配好 Web 常见功能，如：字符编码问题</p>\n</li>\n<li>\n<ul>\n<li>SpringBoot 帮我们配置好了所有 web 开发的常见场景</li>\n</ul>\n</li>\n<li>\n<p>默认的包结构</p>\n</li>\n<li>\n<ul>\n<li>主程序所在包及其下面的所有子包里面的组件都会被默认扫描进来</li>\n<li>无需以前的包扫描配置</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>想要改变扫描路径，@SpringBootApplication (scanBasePackages=<strong>“com.atguigu”</strong>)</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>\n<ul>\n<li>或者 @ComponentScan 指定扫描路径</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\">等同于</span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(&quot;com.atguigu.boot&quot;)</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>各种配置拥有默认值</p>\n</li>\n<li>\n<ul>\n<li>默认配置最终都是映射到某个类上，如：MultipartProperties</li>\n<li>配置文件的值最终会绑定每个类上，这个类会在容器中创建对象</li>\n</ul>\n</li>\n<li>\n<p>按需加载所有自动配置项</p>\n</li>\n<li>\n<ul>\n<li>非常多的 starter</li>\n<li>引入了哪些场景这个场景的自动配置才会开启</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>SpringBoot 所有的自动配置功能都在 spring-boot-autoconfigure 包里面</li>\n<li></li>\n</ul>\n</li>\n<li>\n<p>…</p>\n</li>\n</ul>\n<h1 id=\"2-容器功能\"><a class=\"markdownIt-Anchor\" href=\"#2-容器功能\">#</a> 2、容器功能</h1>\n<h2 id=\"21-组件添加\"><a class=\"markdownIt-Anchor\" href=\"#21-组件添加\">#</a> 2.1、组件添加</h2>\n<h3 id=\"1-configuration\"><a class=\"markdownIt-Anchor\" href=\"#1-configuration\">#</a> 1、@Configuration</h3>\n<ul>\n<li>\n<p>基本使用</p>\n</li>\n<li>\n<p><strong>Full 模式与 Lite 模式</strong></p>\n</li>\n<li>\n<ul>\n<li>示例</li>\n<li>最佳实战</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>\n<ul>\n<li>配置 类组件之间无依赖关系用 Lite 模式加速容器启动过程，减少判断</li>\n<li>配置类组件之间有依赖关系，方法会被调用得到之前单实例组件，用 Full 模式</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#############################Configuration使用示例######################################################</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 1、配置类里面使用<span class=\"doctag\">@Bean</span>标注在方法上给容器注册组件，默认也是单实例的</span></span><br><span class=\"line\"><span class=\"comment\"> * 2、配置类本身也是组件</span></span><br><span class=\"line\"><span class=\"comment\"> * 3、proxyBeanMethods：代理bean的方法</span></span><br><span class=\"line\"><span class=\"comment\"> *      Full(proxyBeanMethods = true)、【保证每个<span class=\"doctag\">@Bean</span>方法被调用多少次返回的组件都是单实例的】</span></span><br><span class=\"line\"><span class=\"comment\"> *      Lite(proxyBeanMethods = false)【每个<span class=\"doctag\">@Bean</span>方法被调用多少次返回的组件都是新创建的】</span></span><br><span class=\"line\"><span class=\"comment\"> *      组件依赖必须使用Full模式默认。其他默认是否Lite模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration(proxyBeanMethods = false)</span> <span class=\"comment\">//告诉SpringBoot这是一个配置类 == 配置文件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Full:外部无论对配置类中的这个组件注册方法调用多少次获取的都是之前注册容器中的单实例对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//给容器中添加组件。以方法名作为组件的id。返回类型就是组件类型。返回的值，就是组件在容器中的实例</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user01</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">zhangsan</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\">        <span class=\"comment\">//user组件依赖了Pet组件</span></span><br><span class=\"line\">        zhangsan.setPet(tomcatPet());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> zhangsan;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;tom&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Pet <span class=\"title function_\">tomcatPet</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Pet</span>(<span class=\"string\">&quot;tomcat&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">################################<span class=\"meta\">@Configuration</span>测试代码如下########################################</span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(&quot;com.atguigu.boot&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MainApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//1、返回我们IOC容器</span></span><br><span class=\"line\">        <span class=\"type\">ConfigurableApplicationContext</span> <span class=\"variable\">run</span> <span class=\"operator\">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//2、查看容器里面的组件</span></span><br><span class=\"line\">        String[] names = run.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String name : names) &#123;</span><br><span class=\"line\">            System.out.println(name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//3、从容器中获取组件</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Pet</span> <span class=\"variable\">tom01</span> <span class=\"operator\">=</span> run.getBean(<span class=\"string\">&quot;tom&quot;</span>, Pet.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Pet</span> <span class=\"variable\">tom02</span> <span class=\"operator\">=</span> run.getBean(<span class=\"string\">&quot;tom&quot;</span>, Pet.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;组件：&quot;</span>+(tom01 == tom02));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//4、com.atguigu.boot.config.MyConfig$$EnhancerBySpringCGLIB$$51f1e1ca@1654a892</span></span><br><span class=\"line\">        <span class=\"type\">MyConfig</span> <span class=\"variable\">bean</span> <span class=\"operator\">=</span> run.getBean(MyConfig.class);</span><br><span class=\"line\">        System.out.println(bean);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//如果@Configuration(proxyBeanMethods = true)代理对象调用方法。SpringBoot总会检查这个组件是否在容器中有。</span></span><br><span class=\"line\">        <span class=\"comment\">//保持组件单实例</span></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> bean.user01();</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user1</span> <span class=\"operator\">=</span> bean.user01();</span><br><span class=\"line\">        System.out.println(user == user1);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user01</span> <span class=\"operator\">=</span> run.getBean(<span class=\"string\">&quot;user01&quot;</span>, User.class);</span><br><span class=\"line\">        <span class=\"type\">Pet</span> <span class=\"variable\">tom</span> <span class=\"operator\">=</span> run.getBean(<span class=\"string\">&quot;tom&quot;</span>, Pet.class);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;用户的宠物：&quot;</span>+(user01.getPet() == tom));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-bean-component-controller-service-repository\"><a class=\"markdownIt-Anchor\" href=\"#2-bean-component-controller-service-repository\">#</a> 2、@Bean、@Component、@Controller、@Service、@Repository</h3>\n<h3 id=\"3-componentscan-import\"><a class=\"markdownIt-Anchor\" href=\"#3-componentscan-import\">#</a> 3、@ComponentScan、@Import</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> * <span class=\"number\">4</span>、<span class=\"meta\">@Import(&#123;User.class, DBHelper.class&#125;)</span></span><br><span class=\"line\"> *      给容器中自动创建出这两个类型的组件、默认组件的名字就是全类名</span><br><span class=\"line\"> *</span><br><span class=\"line\"> *</span><br><span class=\"line\"> *</span><br><span class=\"line\"> */</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;User.class, DBHelper.class&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration(proxyBeanMethods = false)</span> <span class=\"comment\">//告诉SpringBoot这是一个配置类 == 配置文件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyConfig</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>@Import 高级用法： <span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMWdXNDExVzd3eT9wPTg=\">https://www.bilibili.com/video/BV1gW411W7wy?p=8</span></p>\n<h3 id=\"4-conditional\"><a class=\"markdownIt-Anchor\" href=\"#4-conditional\">#</a> 4、@Conditional</h3>\n<p>条件装配：满足 Conditional 指定的条件，则进行组件注入</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602835786727-28b6f936-62f5-4fd6-a6c5-ae690bd1e31d.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_17%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=====================测试条件装配==========================</span><br><span class=\"line\"><span class=\"meta\">@Configuration(proxyBeanMethods = false)</span> <span class=\"comment\">//告诉SpringBoot这是一个配置类 == 配置文件</span></span><br><span class=\"line\"><span class=\"comment\">//@ConditionalOnBean(name = &quot;tom&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(name = &quot;tom&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Full:外部无论对配置类中的这个组件注册方法调用多少次获取的都是之前注册容器中的单实例对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span> <span class=\"comment\">//给容器中添加组件。以方法名作为组件的id。返回类型就是组件类型。返回的值，就是组件在容器中的实例</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user01</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">zhangsan</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;zhangsan&quot;</span>, <span class=\"number\">18</span>);</span><br><span class=\"line\">        <span class=\"comment\">//user组件依赖了Pet组件</span></span><br><span class=\"line\">        zhangsan.setPet(tomcatPet());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> zhangsan;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean(&quot;tom22&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Pet <span class=\"title function_\">tomcatPet</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Pet</span>(<span class=\"string\">&quot;tomcat&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//1、返回我们IOC容器</span></span><br><span class=\"line\">        <span class=\"type\">ConfigurableApplicationContext</span> <span class=\"variable\">run</span> <span class=\"operator\">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//2、查看容器里面的组件</span></span><br><span class=\"line\">        String[] names = run.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (String name : names) &#123;</span><br><span class=\"line\">            System.out.println(name);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tom</span> <span class=\"operator\">=</span> run.containsBean(<span class=\"string\">&quot;tom&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;容器中Tom组件：&quot;</span>+tom);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">user01</span> <span class=\"operator\">=</span> run.containsBean(<span class=\"string\">&quot;user01&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;容器中user01组件：&quot;</span>+user01);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">tom22</span> <span class=\"operator\">=</span> run.containsBean(<span class=\"string\">&quot;tom22&quot;</span>);</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;容器中tom22组件：&quot;</span>+tom22);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"22-原生配置文件引入\"><a class=\"markdownIt-Anchor\" href=\"#22-原生配置文件引入\">#</a> 2.2、原生配置文件引入</h2>\n<h3 id=\"1-importresource\"><a class=\"markdownIt-Anchor\" href=\"#1-importresource\">#</a> 1、@ImportResource</h3>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">======================beans.xml=========================</span><br><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">beans</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xmlns:context</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">       <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;haha&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.atguigu.boot.bean.User&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;zhangsan&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;age&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;18&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">bean</span> <span class=\"attr\">id</span>=<span class=\"string\">&quot;hehe&quot;</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;com.atguigu.boot.bean.Pet&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">property</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">value</span>=<span class=\"string\">&quot;tomcat&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">property</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">bean</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">beans</span>&gt;</span></span><br><span class=\"line\">@ImportResource(&quot;classpath:beans.xml&quot;)</span><br><span class=\"line\">public class MyConfig &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">======================测试=================</span><br><span class=\"line\">        boolean haha = run.containsBean(&quot;haha&quot;);</span><br><span class=\"line\">        boolean hehe = run.containsBean(&quot;hehe&quot;);</span><br><span class=\"line\">        System.out.println(&quot;haha：&quot;+haha);//true</span><br><span class=\"line\">        System.out.println(&quot;hehe：&quot;+hehe);//true</span><br></pre></td></tr></table></figure>\n<h2 id=\"23-配置绑定\"><a class=\"markdownIt-Anchor\" href=\"#23-配置绑定\">#</a> 2.3、配置绑定</h2>\n<p>如何使用 Java 读取到 properties 文件中的内容，并且把它封装到 JavaBean 中，以供随时使用；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">getProperties</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> FileNotFoundException, IOException &#123;</span><br><span class=\"line\">         <span class=\"type\">Properties</span> <span class=\"variable\">pps</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Properties</span>();</span><br><span class=\"line\">         pps.load(<span class=\"keyword\">new</span> <span class=\"title class_\">FileInputStream</span>(<span class=\"string\">&quot;a.properties&quot;</span>));</span><br><span class=\"line\">         <span class=\"type\">Enumeration</span> <span class=\"variable\">enum1</span> <span class=\"operator\">=</span> pps.propertyNames();<span class=\"comment\">//得到配置文件的名字</span></span><br><span class=\"line\">         <span class=\"keyword\">while</span>(enum1.hasMoreElements()) &#123;</span><br><span class=\"line\">             <span class=\"type\">String</span> <span class=\"variable\">strKey</span> <span class=\"operator\">=</span> (String) enum1.nextElement();</span><br><span class=\"line\">             <span class=\"type\">String</span> <span class=\"variable\">strValue</span> <span class=\"operator\">=</span> pps.getProperty(strKey);</span><br><span class=\"line\">             System.out.println(strKey + <span class=\"string\">&quot;=&quot;</span> + strValue);</span><br><span class=\"line\">             <span class=\"comment\">//封装到JavaBean。</span></span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-configurationproperties\"><a class=\"markdownIt-Anchor\" href=\"#1-configurationproperties\">#</a> 1、@ConfigurationProperties</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 只有在容器中的组件，才会拥有SpringBoot提供的强大功能</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String brand;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer price;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getBrand</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> brand;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setBrand</span><span class=\"params\">(String brand)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.brand = brand;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Integer <span class=\"title function_\">getPrice</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setPrice</span><span class=\"params\">(Integer price)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.price = price;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;Car&#123;&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;brand=&#x27;&quot;</span> + brand + <span class=\"string\">&#x27;\\&#x27;&#x27;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;, price=&quot;</span> + price +</span><br><span class=\"line\">                <span class=\"string\">&#x27;&#125;&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-enableconfigurationproperties-configurationproperties\"><a class=\"markdownIt-Anchor\" href=\"#2-enableconfigurationproperties-configurationproperties\">#</a> 2、@EnableConfigurationProperties + @ConfigurationProperties</h3>\n<h3 id=\"3-component-configurationproperties\"><a class=\"markdownIt-Anchor\" href=\"#3-component-configurationproperties\">#</a> 3、@Component + @ConfigurationProperties</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(Car.class)</span></span><br><span class=\"line\"><span class=\"comment\">//1、开启Car配置绑定功能</span></span><br><span class=\"line\"><span class=\"comment\">//2、把这个Car这个组件自动注册到容器中</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyConfig</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"3-自动配置原理入门\"><a class=\"markdownIt-Anchor\" href=\"#3-自动配置原理入门\">#</a> 3、自动配置原理入门</h1>\n<h2 id=\"31-引导加载自动配置类\"><a class=\"markdownIt-Anchor\" href=\"#31-引导加载自动配置类\">#</a> 3.1、引导加载自动配置类</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class=\"line\"><span class=\"meta\">\t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SpringBootApplication&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">======================</span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n<h3 id=\"1-springbootconfiguration\"><a class=\"markdownIt-Anchor\" href=\"#1-springbootconfiguration\">#</a> 1、@SpringBootConfiguration</h3>\n<p>@Configuration。代表当前是一个配置类</p>\n<h3 id=\"2-componentscan\"><a class=\"markdownIt-Anchor\" href=\"#2-componentscan\">#</a> 2、@ComponentScan</h3>\n<p>指定扫描哪些，Spring 注解；</p>\n<h3 id=\"3-enableautoconfiguration\"><a class=\"markdownIt-Anchor\" href=\"#3-enableautoconfiguration\">#</a> 3、@EnableAutoConfiguration</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AutoConfigurationPackage</span></span><br><span class=\"line\"><span class=\"meta\">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> EnableAutoConfiguration &#123;&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"1-autoconfigurationpackage\"><a class=\"markdownIt-Anchor\" href=\"#1-autoconfigurationpackage\">#</a> 1、@AutoConfigurationPackage</h4>\n<p>自动配置包？指定了默认的包规则</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Import(AutoConfigurationPackages.Registrar.class)</span>  <span class=\"comment\">//给容器中导入一个组件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AutoConfigurationPackage &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//利用Registrar给容器中导入一系列组件</span></span><br><span class=\"line\"><span class=\"comment\">//将指定的一个包下的所有组件导入进来？MainApplication 所在包下。</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-importautoconfigurationimportselectorclass\"><a class=\"markdownIt-Anchor\" href=\"#2-importautoconfigurationimportselectorclass\">#</a> 2、@Import(AutoConfigurationImportSelector.class)</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span>、利用getAutoConfigurationEntry(annotationMetadata);给容器中批量导入一些组件</span><br><span class=\"line\"><span class=\"number\">2</span>、调用List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes)获取到所有需要导入到容器中的配置类</span><br><span class=\"line\"><span class=\"number\">3</span>、利用工厂加载 Map&lt;String, List&lt;String&gt;&gt; <span class=\"title function_\">loadSpringFactories</span><span class=\"params\">(<span class=\"meta\">@Nullable</span> ClassLoader classLoader)</span>；得到所有的组件</span><br><span class=\"line\"><span class=\"number\">4</span>、从META-INF/spring.factories位置来加载一个文件。</span><br><span class=\"line\">\t默认扫描我们当前系统里面所有META-INF/spring.factories位置的文件</span><br><span class=\"line\">    spring-boot-autoconfigure-<span class=\"number\">2.3</span><span class=\"number\">.4</span>.RELEASE.jar包里面也有META-INF/spring.factories</span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n<h2 id=\"img\"><a class=\"markdownIt-Anchor\" href=\"#img\">#</a> <img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602845382065-5c41abf5-ee10-4c93-89e4-2a9b831c3ceb.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_29%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">文件里面写死了spring-boot一启动就要给容器中加载的所有配置类</span><br><span class=\"line\">spring-boot-autoconfigure-2.3.4.RELEASE.jar/META-INF/spring.factories</span><br><span class=\"line\"># Auto Configure</span><br><span class=\"line\">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.r2dbc.R2dbcTransactionManagerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration,\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration</span><br></pre></td></tr></table></figure>\n<h2 id=\"32-按需开启自动配置项\"><a class=\"markdownIt-Anchor\" href=\"#32-按需开启自动配置项\">#</a> 3.2、按需开启自动配置项</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">虽然我们<span class=\"number\">127</span>个场景的所有自动配置启动的时候默认全部加载。xxxxAutoConfiguration</span><br><span class=\"line\">按照条件装配规则（<span class=\"meta\">@Conditional</span>），最终会按需配置。</span><br></pre></td></tr></table></figure>\n<h2 id=\"33-修改默认配置\"><a class=\"markdownIt-Anchor\" href=\"#33-修改默认配置\">#</a> 3.3、修改默认配置</h2>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"meta\">@Bean</span></span><br><span class=\"line\">\t\t<span class=\"meta\">@ConditionalOnBean(MultipartResolver.class)</span>  <span class=\"comment\">//容器中有这个类型组件</span></span><br><span class=\"line\">\t\t<span class=\"meta\">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span> <span class=\"comment\">//容器中没有这个名字 multipartResolver 的组件</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">public</span> MultipartResolver <span class=\"title function_\">multipartResolver</span><span class=\"params\">(MultipartResolver resolver)</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//给@Bean标注的方法传入了对象参数，这个参数的值就会从容器中找。</span></span><br><span class=\"line\">            <span class=\"comment\">//SpringMVC multipartResolver。防止有些用户配置的文件上传解析器不符合规范</span></span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Detect if the user has created a MultipartResolver but named it incorrectly</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> resolver;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">给容器中加入了文件上传解析器；</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h2>\n<h3 id=\"springboot默认会在底层配好所有的组件-但是如果用户自己配置了以用户的优先\"><a class=\"markdownIt-Anchor\" href=\"#springboot默认会在底层配好所有的组件-但是如果用户自己配置了以用户的优先\">#</a> SpringBoot 默认会在底层配好所有的组件。但是如果用户自己配置了以用户的优先</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\">\t<span class=\"meta\">@ConditionalOnMissingBean</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> CharacterEncodingFilter <span class=\"title function_\">characterEncodingFilter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"-2\"><a class=\"markdownIt-Anchor\" href=\"#-2\">#</a> </h2>\n<p>总结：</p>\n<ul>\n<li>\n<p>SpringBoot 先加载所有的自动配置类  xxxxxAutoConfiguration</p>\n</li>\n<li>\n<p>每个自动配置类按照条件进行生效，默认都会绑定配置文件指定的值。xxxxProperties 里面拿。xxxProperties 和配置文件进行了绑定</p>\n</li>\n<li>\n<p>生效的配置类就会给容器中装配很多组件</p>\n</li>\n<li>\n<p>只要容器中有这些组件，相当于这些功能就有了</p>\n</li>\n<li>\n<p>定制化配置</p>\n</li>\n<li>\n<ul>\n<li>用户直接自己 @Bean 替换底层的组件</li>\n<li>用户去看这个组件是获取的配置文件什么值就去修改。</li>\n</ul>\n</li>\n</ul>\n<p><strong>xxxxxAutoConfiguration —&gt; 组件  —&gt;</strong> <strong>xxxxProperties 里面拿值  ----&gt; application.properties</strong></p>\n<h2 id=\"34-最佳实践\"><a class=\"markdownIt-Anchor\" href=\"#34-最佳实践\">#</a> 3.4、最佳实践</h2>\n<ul>\n<li>\n<p>引入场景依赖</p>\n</li>\n<li>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctYm9vdC9kb2NzL2N1cnJlbnQvcmVmZXJlbmNlL2h0bWwvdXNpbmctc3ByaW5nLWJvb3QuaHRtbCN1c2luZy1ib290LXN0YXJ0ZXI=\">https://docs.spring.io/spring-boot/docs/current/reference/html/using-spring-boot.html#using-boot-starter</span></li>\n</ul>\n</li>\n<li>\n<p>查看自动配置了哪些（选做）</p>\n</li>\n<li>\n<ul>\n<li>自己分析，引入场景对应的自动配置一般都生效了</li>\n<li>配置文件中 debug=true 开启自动配置报告。Negative（不生效）\\Positive（生效）</li>\n</ul>\n</li>\n<li>\n<p>是否需要修改</p>\n</li>\n<li>\n<ul>\n<li>参照文档修改配置项</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctYm9vdC9kb2NzL2N1cnJlbnQvcmVmZXJlbmNlL2h0bWwvYXBwZW5kaXgtYXBwbGljYXRpb24tcHJvcGVydGllcy5odG1sI2NvbW1vbi1hcHBsaWNhdGlvbi1wcm9wZXJ0aWVz\">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#common-application-properties</span></li>\n<li>自己分析。xxxxProperties 绑定了配置文件的哪些。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>自定义加入或者替换组件</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>\n<ul>\n<li>@Bean、@Component。。。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>自定义器  <strong>XXXXXCustomizer</strong>；</li>\n<li>…</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"4-开发小技巧\"><a class=\"markdownIt-Anchor\" href=\"#4-开发小技巧\">#</a> 4、开发小技巧</h1>\n<h2 id=\"41-lombok\"><a class=\"markdownIt-Anchor\" href=\"#41-lombok\">#</a> 4.1、Lombok</h2>\n<p>简化 JavaBean 开发</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">idea中搜索安装lombok插件</span><br><span class=\"line\">===============================简化JavaBean开发===================================</span><br><span class=\"line\">@NoArgsConstructor</span><br><span class=\"line\">//@AllArgsConstructor</span><br><span class=\"line\">@Data</span><br><span class=\"line\">@ToString</span><br><span class=\"line\">@EqualsAndHashCode</span><br><span class=\"line\">public class User &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private String name;</span><br><span class=\"line\">    private Integer age;</span><br><span class=\"line\"></span><br><span class=\"line\">    private Pet pet;</span><br><span class=\"line\"></span><br><span class=\"line\">    public User(String name,Integer age)&#123;</span><br><span class=\"line\">        this.name = name;</span><br><span class=\"line\">        this.age = age;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">================================简化日志开发===================================</span><br><span class=\"line\">@Slf4j</span><br><span class=\"line\">@RestController</span><br><span class=\"line\">public class HelloController &#123;</span><br><span class=\"line\">    @RequestMapping(&quot;/hello&quot;)</span><br><span class=\"line\">    public String handle01(@RequestParam(&quot;name&quot;) String name)&#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        log.info(&quot;请求进来了....&quot;);</span><br><span class=\"line\">        </span><br><span class=\"line\">        return &quot;Hello, Spring Boot 2!&quot;+&quot;你好：&quot;+name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"42-dev-tools\"><a class=\"markdownIt-Anchor\" href=\"#42-dev-tools\">#</a> 4.2、dev-tools</h2>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-devtools<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>项目或者页面修改以后：Ctrl+F9；</p>\n<h2 id=\"43-spring-initailizr项目初始化向导\"><a class=\"markdownIt-Anchor\" href=\"#43-spring-initailizr项目初始化向导\">#</a> 4.3、Spring Initailizr（项目初始化向导）</h2>\n<h3 id=\"0-选择我们需要的开发场景\"><a class=\"markdownIt-Anchor\" href=\"#0-选择我们需要的开发场景\">#</a> 0、选择我们需要的开发场景</h3>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602922147241-73fb2496-e795-4b5a-b909-a18c6011a028.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_37%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></p>\n<h3 id=\"1-自动依赖引入\"><a class=\"markdownIt-Anchor\" href=\"#1-自动依赖引入\">#</a> 1、自动依赖引入</h3>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602921777330-8fc5c198-75da-4ff9-b82c-71ee3fe18af8.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_28%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></p>\n<h3 id=\"2-自动创建项目结构\"><a class=\"markdownIt-Anchor\" href=\"#2-自动创建项目结构\">#</a> 2、自动创建项目结构</h3>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602921758313-5099fe18-4c7b-4417-bf6f-2f40b9028296.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_18%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></p>\n<h3 id=\"3-自动编写好主配置类\"><a class=\"markdownIt-Anchor\" href=\"#3-自动编写好主配置类\">#</a> 3、自动编写好主配置类</h3>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2020/png/1354552/1602922039074-79e98aad-8158-4113-a7e7-305b57b0a6bf.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_29%2Ctext_YXRndWlndS5jb20g5bCa56GF6LC3%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10\" alt=\"img\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/SpringBoot+Redis%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E5%BC%BA%E6%94%AF%E6%8C%81%E7%9A%84%E7%82%B9%E8%B5%9E-%E6%9F%A5%E7%9C%8B%E6%94%B6%E8%97%8F%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1/",
            "url": "http://example.com/2022/12/27/SpringBoot+Redis%E5%AE%9E%E7%8E%B0%E9%AB%98%E6%80%A7%E8%83%BD%EF%BC%8C%E5%BC%BA%E6%94%AF%E6%8C%81%E7%9A%84%E7%82%B9%E8%B5%9E-%E6%9F%A5%E7%9C%8B%E6%94%B6%E8%97%8F%E6%B5%81%E7%A8%8B%E8%AE%BE%E8%AE%A1/",
            "title": "SpringBoot+Redis实现高性能，强支持的点赞-查看收藏流程设计",
            "date_published": "2022-12-27T08:18:48.622Z",
            "content_html": "<h1 id=\"springbootredis实现高性能强支持的点赞流程设计\"><a class=\"markdownIt-Anchor\" href=\"#springbootredis实现高性能强支持的点赞流程设计\">#</a> SpringBoot+Redis 实现高性能，强支持的点赞流程设计</h1>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>本文基于 SpringCloudAlibaba, 用户发起点赞、取消点赞，后先存入 Redis 中，再每隔两小时从 Redis 读取点赞数据写入数据库中做持久化存储。</p>\n<p>点赞功能在很多系统中都有，但别看功能小，想要做好需要考虑的东西还挺多的。</p>\n<p>点赞、取消点赞是高频次的操作，若每次都读写数据库，大量的操作会影响数据库性能，所以需要做缓存。</p>\n<p>至于多久从 Redis 取一次数据存到数据库中，根据项目的实际情况定吧，我是暂时设了两个小时。</p>\n<p>项目需求需要查看都谁点赞了，所以要存储每个点赞的点赞人、被点赞人，不能简单的做计数。</p>\n<h3 id=\"文章分四部分介绍\"><a class=\"markdownIt-Anchor\" href=\"#文章分四部分介绍\">#</a> 文章分四部分介绍：</h3>\n<ul>\n<li>\n<p>Redis 缓存设计及实现</p>\n</li>\n<li>\n<p>数据库设计</p>\n</li>\n<li>\n<p>数据库操作</p>\n</li>\n<li>\n<p>开启定时任务持久化存储到数据库</p>\n</li>\n</ul>\n<h2 id=\"一-redis-缓存设计及实现\"><a class=\"markdownIt-Anchor\" href=\"#一-redis-缓存设计及实现\">#</a> 一、Redis 缓存设计及实现</h2>\n<h3 id=\"11-redis-安装及运行\"><a class=\"markdownIt-Anchor\" href=\"#11-redis-安装及运行\">#</a> 1.1 Redis 安装及运行</h3>\n<p>Redis 安装请自行查阅相关教程。</p>\n<p>说下 Docker 安装运行 Redis</p>\n<figure class=\"highlight arduino\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p <span class=\"number\">6379</span>:<span class=\"number\">6379</span> redis:<span class=\"number\">4.0</span><span class=\"number\">.8</span></span><br></pre></td></tr></table></figure>\n<p>如果已经安装了 Redis，打开命令行，输入启动 Redis 的命令</p>\n<figure class=\"highlight vbscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-<span class=\"built_in\">server</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"12-redis-与-springboot-项目的整合\"><a class=\"markdownIt-Anchor\" href=\"#12-redis-与-springboot-项目的整合\">#</a> 1.2 Redis 与 SpringBoot 项目的整合</h3>\n<ol>\n<li>在  <code>pom.xml</code>  中引入依赖</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<ol>\n<li>在启动类上添加注释  <code>@EnableCaching</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@EnableDiscoveryClient</span></span><br><span class=\"line\"><span class=\"meta\">@EnableSwagger2</span></span><br><span class=\"line\"><span class=\"meta\">@EnableFeignClients(basePackages = &quot;com.solo.coderiver.project.client&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableCaching</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(UserApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>编写 Redis 配置类  <code>RedisConfig</code></li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.UnknownHostException;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;String, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">            RedisConnectionFactory redisConnectionFactory)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> UnknownHostException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = <span class=\"keyword\">new</span> <span class=\"title class_\">Jackson2JsonRedisSerializer</span>&lt;Object&gt;(Object.class);</span><br><span class=\"line\">        <span class=\"type\">ObjectMapper</span> <span class=\"variable\">om</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>();</span><br><span class=\"line\">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class=\"line\">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class=\"line\">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class=\"line\"></span><br><span class=\"line\">        RedisTemplate&lt;String, Object&gt; template = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;String, Object&gt;();</span><br><span class=\"line\">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class=\"line\">        template.setKeySerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setHashKeySerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class=\"line\">        template.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConditionalOnMissingBean(StringRedisTemplate.class)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> StringRedisTemplate <span class=\"title function_\">stringRedisTemplate</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">            RedisConnectionFactory redisConnectionFactory)</span></span><br><span class=\"line\">            <span class=\"keyword\">throws</span> UnknownHostException &#123;</span><br><span class=\"line\">        <span class=\"type\">StringRedisTemplate</span> <span class=\"variable\">template</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisTemplate</span>();</span><br><span class=\"line\">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>至此 Redis 在 SpringBoot 项目中的配置已经完成，可以愉快的使用了。</p>\n<h3 id=\"13-redis-的数据结构类型\"><a class=\"markdownIt-Anchor\" href=\"#13-redis-的数据结构类型\">#</a> 1.3 Redis 的数据结构类型</h3>\n<p>Redis 可以存储键与 5 种不同数据结构类型之间的映射，这 5 种数据结构类型分别为 String（字符串）、List（列表）、Set（集合）、Hash（散列）和 Zset（有序集合）。</p>\n<p>下面来对这 5 种数据结构类型作简单的介绍：</p>\n<table>\n<thead>\n<tr>\n<th>结构类型</th>\n<th>结构存储的值</th>\n<th>结构的读写能力</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>String</td>\n<td>可以是字符串、整数或者浮点数</td>\n<td>对整个字符串或者字符串的其中一部分执行操作；对象和浮点数执行自增 (increment) 或者自减 (decrement)</td>\n</tr>\n<tr>\n<td>List</td>\n<td>一个链表，链表上的每个节点都包含了一个字符串</td>\n<td>从链表的两端推入或者弹出元素；根据偏移量对链表进行修剪 (trim)；读取单个或者多个元素；根据值来查找或者移除元素</td>\n</tr>\n<tr>\n<td>Set</td>\n<td>包含字符串的无序收集器 (unorderedcollection)，并且被包含的每个字符串都是独一无二的、各不相同</td>\n<td>添加、获取、移除单个元素；检查一个元素是否存在于某个集合中；计算交集、并集、差集；从集合里卖弄随机获取元素</td>\n</tr>\n<tr>\n<td>Hash</td>\n<td>包含键值对的无序散列表</td>\n<td>添加、获取、移除单个键值对；获取所有键值对</td>\n</tr>\n<tr>\n<td>Zset</td>\n<td>字符串成员 (member) 与浮点数分值 (score) 之间的有序映射，元素的排列顺序由分值的大小决定</td>\n<td>添加、获取、删除单个元素；根据分值范围 (range) 或者成员来获取元素</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"14-点赞数据在-redis-中的存储格式\"><a class=\"markdownIt-Anchor\" href=\"#14-点赞数据在-redis-中的存储格式\">#</a> 1.4 点赞数据在 Redis 中的存储格式</h3>\n<p>用 Redis 存储两种数据，一种是记录点赞人、被点赞人、点赞状态的数据，另一种是每个用户被点赞了多少次，做个简单的计数。</p>\n<p>由于需要记录点赞人和被点赞人，还有点赞状态（点赞、取消点赞），还要固定时间间隔取出 Redis 中所有点赞数据，分析了下 Redis 数据格式中  <code>Hash</code>  最合适。</p>\n<p>因为  <code>Hash</code>  里的数据都是存在一个键里，可以通过这个键很方便的把所有的点赞数据都取出。这个键里面的数据还可以存成键值对的形式，方便存入点赞人、被点赞人和点赞状态。</p>\n<p>设点赞人的 id 为  <code>likedPostId</code> ，被点赞人的 id 为  <code>likedUserId</code>  ，点赞时状态为 1，取消点赞状态为 0。将点赞人 id 和被点赞人 id 作为键，两个 id 中间用  <code>::</code>   隔开，点赞状态作为值。</p>\n<p>所以如果用户点赞，存储的键为： <code>likedUserId::likedPostId</code> ，对应的值为 1 。</p>\n<p>取消点赞，存储的键为： <code>likedUserId::likedPostId</code> ，对应的值为 0 。</p>\n<p>取数据时把键用  <code>::</code>  切开就得到了两个 id，也很方便。</p>\n<h3 id=\"15-操作-redis\"><a class=\"markdownIt-Anchor\" href=\"#15-操作-redis\">#</a> 1.5 操作 Redis</h3>\n<p>Redis 各种数据格式的操作方法可以看看 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZ3d3cuamlhbnNodS5jb20lMkZwJTJGN2JmNWRjNjFjYTA2JTJG\">这篇文章</span> ，写的非常好。</p>\n<p>将具体操作方法封装到了  <code>RedisService</code>  接口里</p>\n<blockquote>\n<p>RedisService.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.dto.LikedCountDTO;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">RedisService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 点赞。状态为1</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">saveLiked2Redis</span><span class=\"params\">(String likedUserId, String likedPostId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 取消点赞。将状态改变为0</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">unlikeFromRedis</span><span class=\"params\">(String likedUserId, String likedPostId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 从Redis中删除一条点赞数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">deleteLikedFromRedis</span><span class=\"params\">(String likedUserId, String likedPostId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 该用户的点赞数加1</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">incrementLikedCount</span><span class=\"params\">(String likedUserId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 该用户的点赞数减1</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">decrementLikedCount</span><span class=\"params\">(String likedUserId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取Redis中存储的所有点赞数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    List&lt;UserLike&gt; <span class=\"title function_\">getLikedDataFromRedis</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取Redis中存储的所有点赞数量</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    List&lt;LikedCountDTO&gt; <span class=\"title function_\">getLikedCountFromRedis</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>实现类 RedisServiceImpl.java</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.dto.LikedCountDTO;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.enums.LikedStatusEnum;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.service.LikedService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.service.RedisService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.utils.RedisKeyUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.Cursor;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.redis.core.ScanOptions;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Service;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RedisService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    LikedService likedService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">saveLiked2Redis</span><span class=\"params\">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class=\"line\">        redisTemplate.opsForHash().put(RedisKeyUtils.MAP_KEY_USER_LIKED, key, LikedStatusEnum.LIKE.getCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">unlikeFromRedis</span><span class=\"params\">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class=\"line\">        redisTemplate.opsForHash().put(RedisKeyUtils.MAP_KEY_USER_LIKED, key, LikedStatusEnum.UNLIKE.getCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">deleteLikedFromRedis</span><span class=\"params\">(String likedUserId, String likedPostId)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> RedisKeyUtils.getLikedKey(likedUserId, likedPostId);</span><br><span class=\"line\">        redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED, key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">incrementLikedCount</span><span class=\"params\">(String likedUserId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.opsForHash().increment(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, likedUserId, <span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">decrementLikedCount</span><span class=\"params\">(String likedUserId)</span> &#123;</span><br><span class=\"line\">        redisTemplate.opsForHash().increment(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, likedUserId, -<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;UserLike&gt; <span class=\"title function_\">getLikedDataFromRedis</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        Cursor&lt;Map.Entry&lt;Object, Object&gt;&gt; cursor = redisTemplate.opsForHash().scan(RedisKeyUtils.MAP_KEY_USER_LIKED, ScanOptions.NONE);</span><br><span class=\"line\">        List&lt;UserLike&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (cursor.hasNext())&#123;</span><br><span class=\"line\">            Map.Entry&lt;Object, Object&gt; entry = cursor.next();</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> (String) entry.getKey();</span><br><span class=\"line\">            <span class=\"comment\">//分离出 likedUserId，likedPostId</span></span><br><span class=\"line\">            String[] split = key.split(<span class=\"string\">&quot;::&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">likedUserId</span> <span class=\"operator\">=</span> split[<span class=\"number\">0</span>];</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">likedPostId</span> <span class=\"operator\">=</span> split[<span class=\"number\">1</span>];</span><br><span class=\"line\">            <span class=\"type\">Integer</span> <span class=\"variable\">value</span> <span class=\"operator\">=</span> (Integer) entry.getValue();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//组装成 UserLike 对象</span></span><br><span class=\"line\">            <span class=\"type\">UserLike</span> <span class=\"variable\">userLike</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UserLike</span>(likedUserId, likedPostId, value);</span><br><span class=\"line\">            list.add(userLike);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//存到 list 后从 Redis 中删除</span></span><br><span class=\"line\">            redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED, key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> List&lt;LikedCountDTO&gt; <span class=\"title function_\">getLikedCountFromRedis</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        Cursor&lt;Map.Entry&lt;Object, Object&gt;&gt; cursor = redisTemplate.opsForHash().scan(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, ScanOptions.NONE);</span><br><span class=\"line\">        List&lt;LikedCountDTO&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (cursor.hasNext())&#123;</span><br><span class=\"line\">            Map.Entry&lt;Object, Object&gt; map = cursor.next();</span><br><span class=\"line\">            <span class=\"comment\">//将点赞数量存储在 LikedCountDT</span></span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> (String)map.getKey();</span><br><span class=\"line\">            <span class=\"type\">LikedCountDTO</span> <span class=\"variable\">dto</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">LikedCountDTO</span>(key, (Integer) map.getValue());</span><br><span class=\"line\">            list.add(dto);</span><br><span class=\"line\">            <span class=\"comment\">//从Redis中删除这条记录</span></span><br><span class=\"line\">            redisTemplate.opsForHash().delete(RedisKeyUtils.MAP_KEY_USER_LIKED_COUNT, key);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> list;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>用到的工具类和枚举类</p>\n<blockquote>\n<p>RedisKeyUtils, 用于根据一定规则生成 key</p>\n</blockquote>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisKeyUtils</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//保存用户点赞数据的key</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> final <span class=\"title class_\">String</span> <span class=\"variable constant_\">MAP_KEY_USER_LIKED</span> = <span class=\"string\">&quot;MAP_USER_LIKED&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">//保存用户被点赞数量的key</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> final <span class=\"title class_\">String</span> <span class=\"variable constant_\">MAP_KEY_USER_LIKED_COUNT</span> = <span class=\"string\">&quot;MAP_USER_LIKED_COUNT&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 拼接被点赞的用户id和点赞的人的id作为key。格式 222222::333333</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId 被点赞的人id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId 点赞的人的id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"title class_\">String</span> <span class=\"title function_\">getLikedKey</span>(<span class=\"params\"><span class=\"built_in\">String</span> likedUserId, <span class=\"built_in\">String</span> likedPostId</span>)&#123;</span><br><span class=\"line\">        <span class=\"title class_\">StringBuilder</span> builder = <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">        builder.<span class=\"title function_\">append</span>(likedUserId);</span><br><span class=\"line\">        builder.<span class=\"title function_\">append</span>(<span class=\"string\">&quot;::&quot;</span>);</span><br><span class=\"line\">        builder.<span class=\"title function_\">append</span>(likedPostId);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.<span class=\"title function_\">toString</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>LikedStatusEnum 用户点赞状态的枚举类</p>\n</blockquote>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.solo.coderiver.user.enums;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Getter;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用户点赞的状态</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Getter</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> LikedStatusEnum &#123;</span><br><span class=\"line\">    LIKE(<span class=\"number\">1</span>, <span class=\"string\">&quot;点赞&quot;</span>),</span><br><span class=\"line\">    UNLIKE(<span class=\"number\">0</span>, <span class=\"string\">&quot;取消点赞/未点赞&quot;</span>),</span><br><span class=\"line\">    ;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\"></span><br><span class=\"line\">    LikedStatusEnum(Integer code, String msg) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.code = code;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.msg = msg;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"二-数据库设计\"><a class=\"markdownIt-Anchor\" href=\"#二-数据库设计\">#</a> 二、数据库设计</h2>\n<p>数据库表中至少要包含三个字段：被点赞用户 id，点赞用户 id，点赞状态。再加上主键 id，创建时间，修改时间就行了。</p>\n<p>建表语句</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">create table <span class=\"string\">`user_like`</span>(</span><br><span class=\"line\">\t<span class=\"string\">`id`</span> int not <span class=\"literal\">null</span> auto_increment,</span><br><span class=\"line\">\t<span class=\"string\">`liked_user_id`</span> <span class=\"title function_\">varchar</span>(<span class=\"number\">32</span>) not <span class=\"literal\">null</span> comment <span class=\"string\">&#x27;被点赞的用户id&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"string\">`liked_post_id`</span> <span class=\"title function_\">varchar</span>(<span class=\"number\">32</span>) not <span class=\"literal\">null</span> comment <span class=\"string\">&#x27;点赞的用户id&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"string\">`status`</span> <span class=\"title function_\">tinyint</span>(<span class=\"number\">1</span>) <span class=\"keyword\">default</span> <span class=\"string\">&#x27;1&#x27;</span> comment <span class=\"string\">&#x27;点赞状态，0取消，1点赞&#x27;</span>,</span><br><span class=\"line\">\t<span class=\"string\">`create_time`</span> timestamp not <span class=\"literal\">null</span> <span class=\"keyword\">default</span> current_timestamp comment <span class=\"string\">&#x27;创建时间&#x27;</span>,</span><br><span class=\"line\">  <span class=\"string\">`update_time`</span> timestamp not <span class=\"literal\">null</span> <span class=\"keyword\">default</span> current_timestamp on update current_timestamp comment <span class=\"string\">&#x27;修改时间&#x27;</span>,</span><br><span class=\"line\">\tprimary <span class=\"title function_\">key</span>(<span class=\"string\">`id`</span>),</span><br><span class=\"line\">\t<span class=\"variable constant_\">INDEX</span> <span class=\"string\">`liked_user_id`</span>(<span class=\"string\">`liked_user_id`</span>),</span><br><span class=\"line\">\t<span class=\"variable constant_\">INDEX</span> <span class=\"string\">`liked_post_id`</span>(<span class=\"string\">`liked_post_id`</span>)</span><br><span class=\"line\">) comment <span class=\"string\">&#x27;用户点赞表&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<p>对应的对象  <code>UserLike</code></p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.enums.LikedStatusEnum;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Entity;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GeneratedValue;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.persistence.GenerationType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.persistence.Id;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 用户点赞表</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Entity</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserLike</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//主键id</span></span><br><span class=\"line\">    <span class=\"meta\">@Id</span></span><br><span class=\"line\">    <span class=\"meta\">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer id;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//被点赞的用户的id</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String likedUserId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//点赞的用户的id</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String likedPostId;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//点赞的状态.默认未点赞</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer status = LikedStatusEnum.UNLIKE.getCode();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> UserLike() &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> UserLike(String likedUserId, String likedPostId, Integer status) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.likedUserId = likedUserId;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.likedPostId = likedPostId;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.status = status;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"三-数据库操作\"><a class=\"markdownIt-Anchor\" href=\"#三-数据库操作\">#</a> 三、数据库操作</h2>\n<p>操作数据库同样封装在接口中</p>\n<blockquote>\n<p>LikedService</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.dataobject.UserLike;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.domain.Page;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.data.domain.Pageable;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">LikedService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 保存点赞记录</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> userLike</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    UserLike <span class=\"title function_\">save</span><span class=\"params\">(UserLike userLike)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 批量保存或修改</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> list</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    List&lt;UserLike&gt; <span class=\"title function_\">saveAll</span><span class=\"params\">(List&lt;UserLike&gt; list)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据被点赞人的id查询点赞列表（即查询都谁给这个人点赞过）</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId 被点赞人的id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> pageable</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Page&lt;UserLike&gt; <span class=\"title function_\">getLikedListByLikedUserId</span><span class=\"params\">(String likedUserId, Pageable pageable)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 根据点赞人的id查询点赞列表（即查询这个人都给谁点赞过）</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> pageable</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Page&lt;UserLike&gt; <span class=\"title function_\">getLikedListByLikedPostId</span><span class=\"params\">(String likedPostId, Pageable pageable)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 通过被点赞人和点赞人id查询是否存在点赞记录</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedUserId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> likedPostId</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    UserLike <span class=\"title function_\">getByLikedUserIdAndLikedPostId</span><span class=\"params\">(String likedUserId, String likedPostId)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将Redis里的点赞数据存入数据库中</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">transLikedFromRedis2DB</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将Redis中的点赞数量数据存入数据库</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">transLikedCountFromRedis2DB</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>LikedServiceImpl 实现类</p>\n</blockquote>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">dataobject</span>.<span class=\"property\">UserInfo</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">dataobject</span>.<span class=\"property\">UserLike</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">dto</span>.<span class=\"property\">LikedCountDTO</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">enums</span>.<span class=\"property\">LikedStatusEnum</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">repository</span>.<span class=\"property\">UserLikeRepository</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">service</span>.<span class=\"property\">LikedService</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">service</span>.<span class=\"property\">RedisService</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.<span class=\"property\">solo</span>.<span class=\"property\">coderiver</span>.<span class=\"property\">user</span>.<span class=\"property\">service</span>.<span class=\"property\">UserService</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.<span class=\"property\">extern</span>.<span class=\"property\">slf4j</span>.<span class=\"property\">Slf4j</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.<span class=\"property\">springframework</span>.<span class=\"property\">beans</span>.<span class=\"property\">factory</span>.<span class=\"property\">annotation</span>.<span class=\"property\">Autowired</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.<span class=\"property\">springframework</span>.<span class=\"property\">data</span>.<span class=\"property\">domain</span>.<span class=\"property\">Page</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.<span class=\"property\">springframework</span>.<span class=\"property\">data</span>.<span class=\"property\">domain</span>.<span class=\"property\">Pageable</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.<span class=\"property\">springframework</span>.<span class=\"property\">stereotype</span>.<span class=\"property\">Service</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.<span class=\"property\">springframework</span>.<span class=\"property\">transaction</span>.<span class=\"property\">annotation</span>.<span class=\"property\">Transactional</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.<span class=\"property\">util</span>.<span class=\"property\">List</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Service</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">LikedServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">LikedService</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"title class_\">UserLikeRepository</span> likeRepository;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"title class_\">RedisService</span> redisService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"title class_\">UserService</span> userService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">UserLike</span> <span class=\"title function_\">save</span>(<span class=\"params\">UserLike userLike</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> likeRepository.<span class=\"title function_\">save</span>(userLike);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">List</span>&lt;<span class=\"title class_\">UserLike</span>&gt; <span class=\"title function_\">saveAll</span>(<span class=\"params\">List&lt;UserLike&gt; list</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> likeRepository.<span class=\"title function_\">saveAll</span>(list);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">Page</span>&lt;<span class=\"title class_\">UserLike</span>&gt; <span class=\"title function_\">getLikedListByLikedUserId</span>(<span class=\"params\"><span class=\"built_in\">String</span> likedUserId, Pageable pageable</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> likeRepository.<span class=\"title function_\">findByLikedUserIdAndStatus</span>(likedUserId, <span class=\"title class_\">LikedStatusEnum</span>.<span class=\"property\">LIKE</span>.<span class=\"title function_\">getCode</span>(), pageable);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">Page</span>&lt;<span class=\"title class_\">UserLike</span>&gt; <span class=\"title function_\">getLikedListByLikedPostId</span>(<span class=\"params\"><span class=\"built_in\">String</span> likedPostId, Pageable pageable</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> likeRepository.<span class=\"title function_\">findByLikedPostIdAndStatus</span>(likedPostId, <span class=\"title class_\">LikedStatusEnum</span>.<span class=\"property\">LIKE</span>.<span class=\"title function_\">getCode</span>(), pageable);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title class_\">UserLike</span> <span class=\"title function_\">getByLikedUserIdAndLikedPostId</span>(<span class=\"params\"><span class=\"built_in\">String</span> likedUserId, <span class=\"built_in\">String</span> likedPostId</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> likeRepository.<span class=\"title function_\">findByLikedUserIdAndLikedPostId</span>(likedUserId, likedPostId);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">void</span> <span class=\"title function_\">transLikedFromRedis2DB</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title class_\">List</span>&lt;<span class=\"title class_\">UserLike</span>&gt; list = redisService.<span class=\"title function_\">getLikedDataFromRedis</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"title class_\">UserLike</span> like : list) &#123;</span><br><span class=\"line\">            <span class=\"title class_\">UserLike</span> ul = <span class=\"title function_\">getByLikedUserIdAndLikedPostId</span>(like.<span class=\"title function_\">getLikedUserId</span>(), like.<span class=\"title function_\">getLikedPostId</span>());</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (ul == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"comment\">//没有记录，直接存入</span></span><br><span class=\"line\">                <span class=\"title function_\">save</span>(like);</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                <span class=\"comment\">//有记录，需要更新</span></span><br><span class=\"line\">                ul.<span class=\"title function_\">setStatus</span>(like.<span class=\"title function_\">getStatus</span>());</span><br><span class=\"line\">                <span class=\"title function_\">save</span>(ul);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"meta\">@Transactional</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">void</span> <span class=\"title function_\">transLikedCountFromRedis2DB</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        <span class=\"title class_\">List</span>&lt;<span class=\"title class_\">LikedCountDTO</span>&gt; list = redisService.<span class=\"title function_\">getLikedCountFromRedis</span>();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"title class_\">LikedCountDTO</span> dto : list) &#123;</span><br><span class=\"line\">            <span class=\"title class_\">UserInfo</span> user = userService.<span class=\"title function_\">findById</span>(dto.<span class=\"title function_\">getId</span>());</span><br><span class=\"line\">            <span class=\"comment\">//点赞数量属于无关紧要的操作，出错无需抛异常</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (user != <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"title class_\">Integer</span> likeNum = user.<span class=\"title function_\">getLikeNum</span>() + dto.<span class=\"title function_\">getCount</span>();</span><br><span class=\"line\">                user.<span class=\"title function_\">setLikeNum</span>(likeNum);</span><br><span class=\"line\">                <span class=\"comment\">//更新点赞数量</span></span><br><span class=\"line\">                userService.<span class=\"title function_\">updateInfo</span>(user);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>数据库的操作就这些，主要还是增删改查。</p>\n<h2 id=\"四-开启定时任务持久化存储到数据库\"><a class=\"markdownIt-Anchor\" href=\"#四-开启定时任务持久化存储到数据库\">#</a> 四、开启定时任务持久化存储到数据库</h2>\n<p>定时任务  <code>Quartz</code>  很强大，就用它了。</p>\n<p><code>Quartz</code>  使用步骤：</p>\n<ol>\n<li>添加依赖</li>\n</ol>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">复制代码</span><br></pre></td></tr></table></figure>\n<ol>\n<li>编写配置文件</li>\n</ol>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.solo.coderiver.user.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.task.LikeTask;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.quartz.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.<span class=\"keyword\">annotation</span>.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.<span class=\"keyword\">annotation</span>.Configuration;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">QuartzConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> static <span class=\"keyword\">final</span> String LIKE_TASK_IDENTITY = <span class=\"string\">&quot;LikeTaskQuartz&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JobDetail quartzDetail()&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JobBuilder.newJob(LikeTask.<span class=\"keyword\">class</span>).withIdentity(LIKE_TASK_IDENTITY).storeDurably().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Trigger quartzTrigger()&#123;</span><br><span class=\"line\">        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule()</span><br><span class=\"line\"><span class=\"comment\">//                .withIntervalInSeconds(10)  //设置时间周期单位秒</span></span><br><span class=\"line\">                .withIntervalInHours(<span class=\"number\">2</span>)  <span class=\"comment\">//两个小时执行一次</span></span><br><span class=\"line\">                .repeatForever();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TriggerBuilder.newTrigger().forJob(quartzDetail())</span><br><span class=\"line\">                .withIdentity(LIKE_TASK_IDENTITY)</span><br><span class=\"line\">                .withSchedule(scheduleBuilder)</span><br><span class=\"line\">                .build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<ol>\n<li>编写执行任务的类继承自  <code>QuartzJobBean</code></li>\n</ol>\n<figure class=\"highlight scala\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.solo.coderiver.user.task;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.solo.coderiver.user.service.<span class=\"type\">LikedService</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.<span class=\"type\">Slf4j</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang.time.<span class=\"type\">DateUtils</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.quartz.<span class=\"type\">JobExecutionContext</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.quartz.<span class=\"type\">JobExecutionException</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.<span class=\"type\">Autowired</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.scheduling.quartz.<span class=\"type\">QuartzJobBean</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.text.<span class=\"type\">SimpleDateFormat</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.<span class=\"type\">Date</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 点赞的定时任务</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf</span>4j</span><br><span class=\"line\">public <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LikeTask</span> <span class=\"keyword\">extends</span> <span class=\"title\">QuartzJobBean</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"type\">LikedService</span> likedService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">SimpleDateFormat</span> sdf = <span class=\"keyword\">new</span> <span class=\"type\">SimpleDateFormat</span>(<span class=\"string\">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> void executeInternal(<span class=\"type\">JobExecutionContext</span> jobExecutionContext) <span class=\"keyword\">throws</span> <span class=\"type\">JobExecutionException</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;LikeTask-------- &#123;&#125;&quot;</span>, sdf.format(<span class=\"keyword\">new</span> <span class=\"type\">Date</span>()));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//将 Redis 里的点赞信息同步到数据库里</span></span><br><span class=\"line\">        likedService.transLikedFromRedis2DB();</span><br><span class=\"line\">        likedService.transLikedCountFromRedis2DB();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在定时任务中直接调用  <code>LikedService</code>  封装的方法完成数据同步。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Seatav%E9%83%A8%E7%BD%B2Linux%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Seatav%E9%83%A8%E7%BD%B2Linux%E6%96%87%E6%A1%A3/",
            "title": "Linux以及Windows部署Seata服务",
            "date_published": "2022-12-27T08:18:48.619Z",
            "content_html": "<p>1. 确保 linux 有 Nacos 正常启动，并知晓正确的端口 用户名 密码</p>\n<ol start=\"2\">\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3NlYXRhL3NlYXRhLmdpdA==\">https://github.com/seata/seata.git</span> 克隆 seata 项目到本地</li>\n<li>在 Github 下载对应你项目 SpringCloudAlibaba 建议版本的 Seata，我的版本是 2.5.5，建议 Seata 版本 1.3.0</li>\n<li>下载好后进入 seata/conf 配置目录，修改 file.conf</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">## transaction log store<span class=\"punctuation\">,</span> only used in seata-server</span><br><span class=\"line\">store <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  ## store mode<span class=\"punctuation\">:</span> file、db、redis</span><br><span class=\"line\">  mode = <span class=\"string\">&quot;db&quot;</span> #如果单机：file 如果是集群：db  并在下方配置你的Mysql数据源</span><br><span class=\"line\"></span><br><span class=\"line\">  ## file store property</span><br><span class=\"line\">  file <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    ## store location dir</span><br><span class=\"line\">    dir = <span class=\"string\">&quot;sessionStore&quot;</span></span><br><span class=\"line\">    # branch session size <span class=\"punctuation\">,</span> if exceeded first try compress lockkey<span class=\"punctuation\">,</span> still exceeded throws exceptions</span><br><span class=\"line\">    maxBranchSessionSize = <span class=\"number\">16384</span></span><br><span class=\"line\">    # globe session size <span class=\"punctuation\">,</span> if exceeded throws exceptions</span><br><span class=\"line\">    maxGlobalSessionSize = <span class=\"number\">512</span></span><br><span class=\"line\">    # file buffer size <span class=\"punctuation\">,</span> if exceeded allocate new buffer</span><br><span class=\"line\">    fileWriteBufferCacheSize = <span class=\"number\">16384</span></span><br><span class=\"line\">    # when recover batch read size</span><br><span class=\"line\">    sessionReloadReadSize = <span class=\"number\">100</span></span><br><span class=\"line\">    # async<span class=\"punctuation\">,</span> sync</span><br><span class=\"line\">    flushDiskMode = async</span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  ## database store property</span><br><span class=\"line\">  db <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    ## the implement of javax.sql.DataSource<span class=\"punctuation\">,</span> such as DruidDataSource(druid)/BasicDataSource(dbcp)/HikariDataSource(hikari) etc.</span><br><span class=\"line\">    datasource = <span class=\"string\">&quot;druid&quot;</span></span><br><span class=\"line\">    ## mysql/oracle/postgresql/h2/oceanbase etc.</span><br><span class=\"line\">    dbType = <span class=\"string\">&quot;mysql&quot;</span></span><br><span class=\"line\">    driverClassName = <span class=\"string\">&quot;com.mysql.jdbc.Driver&quot;</span></span><br><span class=\"line\">    url = <span class=\"string\">&quot;jdbc:mysql://sh-cynosdbmysql-grp-o5n8fbw2.sql.tencentcdb.com:20345/seata_server&quot;</span></span><br><span class=\"line\">    user = <span class=\"string\">&quot;brath&quot;</span></span><br><span class=\"line\">    password = <span class=\"string\">&quot;Lgq081538&quot;</span></span><br><span class=\"line\">    minConn = <span class=\"number\">5</span></span><br><span class=\"line\">    maxConn = <span class=\"number\">30</span></span><br><span class=\"line\">    globalTable = <span class=\"string\">&quot;global_table&quot;</span></span><br><span class=\"line\">    branchTable = <span class=\"string\">&quot;branch_table&quot;</span></span><br><span class=\"line\">    lockTable = <span class=\"string\">&quot;lock_table&quot;</span></span><br><span class=\"line\">    queryLimit = <span class=\"number\">100</span></span><br><span class=\"line\">    maxWait = <span class=\"number\">5000</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>5. 修改 registry.conf</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">registry <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  type = <span class=\"string\">&quot;nacos&quot;</span>  <span class=\"comment\">//配置nacos</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nacos <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    application = <span class=\"string\">&quot;seata-server&quot;</span></span><br><span class=\"line\">    serverAddr = <span class=\"string\">&quot;nacosip+端口&quot;</span> <span class=\"comment\">//nacosip+端口</span></span><br><span class=\"line\">    group = <span class=\"string\">&quot;SEATA_GROUP&quot;</span></span><br><span class=\"line\">    namespace = <span class=\"string\">&quot;命名空间&quot;</span> <span class=\"comment\">//如果默认可以不填</span></span><br><span class=\"line\">    cluster = <span class=\"string\">&quot;default&quot;</span> <span class=\"comment\">//如果是集群请填写集群名</span></span><br><span class=\"line\">    username = <span class=\"string\">&quot;账号&quot;</span></span><br><span class=\"line\">    password = <span class=\"string\">&quot;密码&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  file <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    name = <span class=\"string\">&quot;file.conf&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">config <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  type = <span class=\"string\">&quot;nacos&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">  nacos <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    serverAddr = <span class=\"string\">&quot;nacosip+端口&quot;</span> <span class=\"comment\">//nacosip+端口</span></span><br><span class=\"line\">    namespace = <span class=\"string\">&quot;命名空间&quot;</span> <span class=\"comment\">//如果默认可以不填</span></span><br><span class=\"line\">    group = <span class=\"string\">&quot;SEATA_GROUP&quot;</span></span><br><span class=\"line\">    username = <span class=\"string\">&quot;账号&quot;</span></span><br><span class=\"line\">    password = <span class=\"string\">&quot;密码&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  file <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    name = <span class=\"string\">&quot;file.conf&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>6. 在克隆好的项目中找到 script/confing-center 找到 config.txt 文件</p>\n<p>修改</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.mode=db</span><br></pre></td></tr></table></figure>\n<p>修改数据源</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.db.url=localhost:3306/seata_server?useUnicode=true&amp;rewriteBatchedStatements=true</span><br><span class=\"line\">store.db.user=****</span><br><span class=\"line\">store.db.password=****</span><br></pre></td></tr></table></figure>\n<p>进入 script\\config-center\\nacos</p>\n<p>如果是 windows 系统请确保安装了 GIT 以及 GIT bash</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3huLS1uYWNvcy1jb25maWctd201dDk2NTVhLnNo\">点击 nacos-config.sh</span> 会自动把 config.txt 配置文件，配置到你的 Nacos 客户端中指定命名空间的配置中心供你的 Seata 使用</p>\n<p>7. 进入 Seata/bin</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh seata-server.sh #启动seata服务</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/RocketMQ%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/RocketMQ%E6%96%87%E6%A1%A3/",
            "title": "RocketMQ - 十年双十一并发神器，最好的消息队列 Linux下安装与部署&SpringBoot简单应用",
            "date_published": "2022-12-27T08:18:48.617Z",
            "content_html": "<h2 id=\"rocketmq-440-下载\"><a class=\"markdownIt-Anchor\" href=\"#rocketmq-440-下载\">#</a> RocketMQ 4.4.0 下载</h2>\n<p>作者已经在自己的服务器挂载了 RocketMQ 4.4.0 的安装包和控制台，点击链接下载</p>\n<p>rocketMQ 4.4.0 安装包 http://124.222.229.230:8080/rocketmq-all-4.4.0-bin-release.zip</p>\n<p>rocketMQ 控制台 安装包 http://124.222.229.230:8080/rocketmq-externals-rocketmq-console-1.0.0.zip</p>\n<p>在使用前如果整合微服务，请注意 SpringCloudAliabba 与各组件之间的版本对应关系</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220630110604813.png\" alt=\"image-20220630110604813\"></p>\n<p>作者使用 SpringCloudAlibaba 2.2.5 RELEASE 版本，所以对应使用 RocketMQ 4.4.0 版本</p>\n<p>将下载好的安装包上传至 Linux 服务器</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220701120747236.png\" alt=\"image-20220701120747236\"></p>\n<p>将压缩包解压至创建好的 rocketMQ 文件夹下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip rocketmq-all-4.4.0-bin-release.zip rocketMQ</span><br></pre></td></tr></table></figure>\n<p>按照官网流程，启动 nameServer，brokerServer 服务</p>\n<h3 id=\"启动nameserver\"><a class=\"markdownIt-Anchor\" href=\"#启动nameserver\">#</a> 启动 nameServer</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动服务</span></span><br><span class=\"line\">nohup ./mqnamesrv -n 124.222.229.230:9876 &amp;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">查看日志</span></span><br><span class=\"line\">tail -f ~/logs/rocketmqlogs/namesrv.log</span><br></pre></td></tr></table></figure>\n<h3 id=\"启动brokerserver\"><a class=\"markdownIt-Anchor\" href=\"#启动brokerserver\">#</a> 启动 brokerServer</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动服务</span></span><br><span class=\"line\">nohup ./mqbroker -n 124.222.229.230:9876 -c ../conf/broker.conf autoCreateTopicEnable=true &amp;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">查看日志</span></span><br><span class=\"line\">tail -f ~/logs/rocketmqlogs/broker.log</span><br></pre></td></tr></table></figure>\n<h3 id=\"发送消息测试\"><a class=\"markdownIt-Anchor\" href=\"#发送消息测试\">#</a> 发送消息测试</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure>\n<h4 id=\"消费消息测试\"><a class=\"markdownIt-Anchor\" href=\"#消费消息测试\">#</a> 消费消息测试</h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh bin/tools.sh org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure>\n<h2 id=\"springboot整合\"><a class=\"markdownIt-Anchor\" href=\"#springboot整合\">#</a> SpringBoot 整合</h2>\n<p>pom.xml 添加</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.apache.rocketmq<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>rocketmq-spring-boot<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"封装工具\"><a class=\"markdownIt-Anchor\" href=\"#封装工具\">#</a> 封装工具：</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.brath.common.rocketmq;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.SendCallback;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.client.producer.SendResult;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.spring.core.RocketMQTemplate;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.messaging.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.PostConstruct;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.annotation.PreDestroy;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/3/31 13:59</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 2: enjoy_ light_ sports@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PPseudonym</span>: enjoy sports nutrition</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Program</span> body: enjoy notes</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RocketMQUtil</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * SLF4J日志</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Logger</span> <span class=\"variable\">logger</span> <span class=\"operator\">=</span> LoggerFactory.getLogger(RocketMQUtil.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * rocketmq模板注入</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RocketMQTemplate rocketMQTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PostConstruct</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;---RocketMq工具初始化---&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic   消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message 消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(Enum topic, Message&lt;?&gt; message)</span> &#123;</span><br><span class=\"line\">        asyncSend(topic.name(), message, getDefaultSendCallBack());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic        消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message      消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sendCallback 回调函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(Enum topic, Message&lt;?&gt; message, SendCallback sendCallback)</span> &#123;</span><br><span class=\"line\">        asyncSend(topic.name(), message, sendCallback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic   消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message 消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(String topic, Message&lt;?&gt; message)</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.asyncSend(topic, message, getDefaultSendCallBack());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic        消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message      消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sendCallback 回调函数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(String topic, Message&lt;?&gt; message, SendCallback sendCallback)</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.asyncSend(topic, message, sendCallback);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic        消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message      消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sendCallback 回调函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout      超时时间</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(String topic, Message&lt;?&gt; message, SendCallback sendCallback, <span class=\"type\">long</span> timeout)</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.asyncSend(topic, message, sendCallback, timeout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送异步消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic        消息Topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message      消息实体</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> sendCallback 回调函数</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout      超时时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> delayLevel   延迟消息的级别</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">asyncSend</span><span class=\"params\">(String topic, Message&lt;?&gt; message, SendCallback sendCallback, <span class=\"type\">long</span> timeout, <span class=\"type\">int</span> delayLevel)</span> &#123;</span><br><span class=\"line\">        rocketMQTemplate.asyncSend(topic, message, sendCallback, timeout, delayLevel);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送顺序消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hashKey</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">syncSendOrderly</span><span class=\"params\">(Enum topic, Message&lt;?&gt; message, String hashKey)</span> &#123;</span><br><span class=\"line\">        syncSendOrderly(topic.name(), message, hashKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送顺序消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hashKey</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">syncSendOrderly</span><span class=\"params\">(String topic, Message&lt;?&gt; message, String hashKey)</span> &#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;发送顺序消息，topic:&quot;</span> + topic + <span class=\"string\">&quot;,hashKey:&quot;</span> + hashKey);</span><br><span class=\"line\">        rocketMQTemplate.syncSendOrderly(topic, message, hashKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发送顺序消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> message</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> topic</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hashKey</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">syncSendOrderly</span><span class=\"params\">(String topic, Message&lt;?&gt; message, String hashKey, <span class=\"type\">long</span> timeout)</span> &#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;发送顺序消息，topic:&quot;</span> + topic + <span class=\"string\">&quot;,hashKey:&quot;</span> + hashKey + <span class=\"string\">&quot;,timeout:&quot;</span> + timeout);</span><br><span class=\"line\">        rocketMQTemplate.syncSendOrderly(topic, message, hashKey, timeout);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 默认CallBack函数</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> SendCallback <span class=\"title function_\">getDefaultSendCallBack</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SendCallback</span>() &#123;</span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onSuccess</span><span class=\"params\">(SendResult sendResult)</span> &#123;</span><br><span class=\"line\">                logger.info(<span class=\"string\">&quot;---发送MQ成功---&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onException</span><span class=\"params\">(Throwable throwable)</span> &#123;</span><br><span class=\"line\">                throwable.printStackTrace();</span><br><span class=\"line\">                logger.error(<span class=\"string\">&quot;---发送MQ失败---&quot;</span>+throwable.getMessage(), throwable.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@PreDestroy</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">destroy</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;---RocketMq工具注销---&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>测试发送消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> RocketMqUtil rocketMqutil;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">Producter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">User</span> <span class=\"variable\">user</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>();</span><br><span class=\"line\">        user.setName(<span class=\"string\">&quot;brath&quot;</span>);</span><br><span class=\"line\">        user.setAge(<span class=\"number\">10</span>);</span><br><span class=\"line\">        rocketMqHelper.asyncSend(<span class=\"string\">&quot;REGIST_USER&quot;</span>, MessageBuilder.withPayload(user).build());</span><br><span class=\"line\">       </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>测试消费消息</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.hyh.core.listener;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.hyh.core.po.Person;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.spring.annotation.RocketMQMessageListener;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.rocketmq.spring.core.RocketMQListener;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/3/31 13:59</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 2: enjoy_ light_ sports@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@PPseudonym</span>: enjoy sports nutrition</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Program</span> body: enjoy notes</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@RocketMQMessageListener(consumerGroup = &quot;$&#123;rocketmq.producer.groupName&#125;&quot;, topic = &quot;REGIST_USER&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PersonMqListener</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">RocketMQListener</span>&lt;Person&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">onMessage</span><span class=\"params\">(User user)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;接收到消息，开始消费..name:&quot;</span> + user.getName() + <span class=\"string\">&quot;,age:&quot;</span> + user.getAge());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">IvUserloginLog</span><br><span class=\"line\">IvUserOperateLog</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/RocketMQ/",
            "url": "http://example.com/2022/12/27/RocketMQ/",
            "title": "RocketMQ",
            "date_published": "2022-12-27T08:18:48.615Z",
            "content_html": "<h1 id=\"rocketmq\"><a class=\"markdownIt-Anchor\" href=\"#rocketmq\">#</a> RocketMQ</h1>\n<h2 id=\"应用场景\"><a class=\"markdownIt-Anchor\" href=\"#应用场景\">#</a> 应用场景</h2>\n<ul>\n<li>异步解藕</li>\n<li>削峰填谷</li>\n<li>消息分发</li>\n</ul>\n<h2 id=\"环境搭建\"><a class=\"markdownIt-Anchor\" href=\"#环境搭建\">#</a> 环境搭建</h2>\n<ol>\n<li>\n<p>上传 rocketmq-all-4.4.0-bin-release.zip 到家目录</p>\n</li>\n<li>\n<p>使用解压命令进行解压</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">unzip /usr/local/rocketmq-all-4.4.0-bin-release.zip</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>软件重命名</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv /usr/local/rocketmq-all-4.4.0-bin-release/ /usr/local/rocketmq-4.4/</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>修改启动参数配置</p>\n<blockquote>\n<p>JAVA_OPT=”${JAVA_OPT} -server <strong>-Xms1g -Xmx1g -Xmn1g</strong>“</p>\n</blockquote>\n<p>两个文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /usr/local/rocketmq-4.4/bin/runbroker.sh</span><br><span class=\"line\"></span><br><span class=\"line\">vi /usr/local/rocketmq-4.4/bin/runserver.sh</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>启动名字服务和代理服务</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup sh /usr/local/rocketmq-4.4/bin/mqnamesrv &amp;</span><br><span class=\"line\"></span><br><span class=\"line\"># -n localhost:9876 指定名称服务的地址, 类似于zk的地址</span><br><span class=\"line\"></span><br><span class=\"line\">nohup sh /usr/local/rocketmq-4.4/bin/mqbroker -n localhost:9876 -c /usr/local/rocketmq-4.4/conf/broker.conf &amp;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>检验是否启动正常</p>\n<p>使用 java 的内置命令: <strong>jps 可以看到 BrokerStartup 和 NamesrvStartup 进程</strong></p>\n<p>使用 Linux 命令 **: netstat-ntlp 可以看到 9876 的端口和 10911 的端口 **</p>\n<p>使用 ps-ef |grep java</p>\n<p>查看启动日志:</p>\n<p>tail -100f ~/logs/rocketmqlogs/namesrv.log</p>\n<p>tail -100f ~/logs/rocketmqlogs/broker.log</p>\n</li>\n<li>\n<p>关闭 RocketMQ</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1.关闭NameServer</span><br><span class=\"line\"></span><br><span class=\"line\">sh /usr/local/rocketmq-4.4/bin/mqshutdown namesrv</span><br><span class=\"line\"></span><br><span class=\"line\"># 2.关闭Broker</span><br><span class=\"line\"></span><br><span class=\"line\">sh /usr/local/rocketmq-4.4/bin/mqshutdown broker</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"编写sh脚本文件\"><a class=\"markdownIt-Anchor\" href=\"#编写sh脚本文件\">#</a> 编写 sh 脚本文件</h3>\n<ul>\n<li>\n<p>启动 (<span class=\"exturl\" data-url=\"aHR0cDovL3N0YXJ0Um9ja2V0TVEuc2g=\">startRocketMQ.sh</span>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># !/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">echo &#x27;------------------rocketmq-nameServer-starter-------------------------&#x27; </span><br><span class=\"line\">nohup sh /usr/local/rocketmq-4.4/bin/mqnamesrv &amp;</span><br><span class=\"line\">echo &#x27;------------------rocketmq-nameServer-started-------------------------&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &#x27;------------------rocketmq-brokerServer-starter-----------------------&#x27; </span><br><span class=\"line\">nohup sh /usr/local/rocketmq-4.4/bin/mqbroker -n localhost:9876 -c /usr/local/rocketmq-4.4/conf/broker.conf &amp;</span><br><span class=\"line\">echo &#x27;------------------rocketmq-brokerServer-started-----------------------&#x27;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>关闭 (<span class=\"exturl\" data-url=\"aHR0cDovL3N0dXRkb3duUm9ja2V0TVEuc2g=\">stutdownRocketMQ.sh</span>)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># !/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">echo &#x27;------------------rocketmq-nameServer-shutdown-------------------------&#x27; </span><br><span class=\"line\">sh /usr/local/rocketmq-4.4/bin/mqshutdown namesrv</span><br><span class=\"line\">echo &#x27;------------------rocketmq-nameServer-shutdowned-------------------------&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">echo &#x27;------------------rocketmq-brokerServer-shutdown-----------------------&#x27; </span><br><span class=\"line\">sh /usr/local/rocketmq-4.4/bin/mqshutdown broker</span><br><span class=\"line\">echo &#x27;------------------rocketmq-brokerServer-shutdowned-----------------------&#x27;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"监控平台\"><a class=\"markdownIt-Anchor\" href=\"#监控平台\">#</a> 监控平台</h2>\n<p>使用 jar</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nohup  java -jar  rocketmq-console-ng-1.0.1.jar  &amp;</span><br></pre></td></tr></table></figure>\n<h2 id=\"springboot集成\"><a class=\"markdownIt-Anchor\" href=\"#springboot集成\">#</a> SpringBoot 集成</h2>\n<h3 id=\"依赖\"><a class=\"markdownIt-Anchor\" href=\"#依赖\">#</a> 依赖</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.0.3&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"配置\"><a class=\"markdownIt-Anchor\" href=\"#配置\">#</a> 配置</h3>\n<ul>\n<li>\n<p>生产者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rocketmq.name-server=127.0.0.1:9876</span><br><span class=\"line\">rocketmq.producer.group=my-group</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>消费者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rocketmq.name-server=127.0.0.1:9876</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"编码\"><a class=\"markdownIt-Anchor\" href=\"#编码\">#</a> 编码</h3>\n<ul>\n<li>\n<p>生产者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RestController</span><br><span class=\"line\">public class HelloController &#123;</span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private RocketMQTemplate rocketMQTemplate;</span><br><span class=\"line\">    @RequestMapping(&quot;01-hello&quot;)</span><br><span class=\"line\">    public String sendMsg(String message,String age) throws Exception&#123;</span><br><span class=\"line\">      //发送消息</span><br><span class=\"line\">   \t\t  SendResult sendResult = rocketMQTemplate.syncSend(&quot;01-boot:&quot;, message);</span><br><span class=\"line\">      </span><br><span class=\"line\">        System.out.println(sendResult.getMsgId());</span><br><span class=\"line\">        System.out.println(sendResult.getSendStatus());</span><br><span class=\"line\">        return &quot;success&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>消费者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@RocketMQMessageListener(</span><br><span class=\"line\">        topic = &quot;01-boot&quot;,</span><br><span class=\"line\">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">public class HelloConsumer implements RocketMQListener&lt;MessageExt&gt; &#123;</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onMessage(MessageExt messageExt) &#123;</span><br><span class=\"line\">         System.out.println(&quot;消费消息&quot;+messageExt);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"发送消息方式生产者\"><a class=\"markdownIt-Anchor\" href=\"#发送消息方式生产者\">#</a> 发送消息方式 (生产者)</h4>\n<h5 id=\"发送类型\"><a class=\"markdownIt-Anchor\" href=\"#发送类型\">#</a> 发送类型</h5>\n<ul>\n<li>\n<p>同步消息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SendResult sendResult = rocketMQTemplate.syncSend(&quot;020-boot&quot;, msg);</span><br><span class=\"line\">System.out.println(sendResult.getMsgId());</span><br><span class=\"line\">System.out.println(sendResult.getSendStatus());</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>异步消息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rocketMQTemplate.asyncSend(&quot;020-boot&quot;, msg, new SendCallback() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onSuccess(SendResult sendResult) &#123;</span><br><span class=\"line\">                System.out.println(sendResult.getMsgId());</span><br><span class=\"line\">                System.out.println(sendResult.getSendStatus());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void onException(Throwable throwable) &#123;</span><br><span class=\"line\">                System.out.println(throwable);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>一次性消息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rocketMQTemplate.sendOneWay(&quot;020-boot&quot;, msg);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"发送时间\"><a class=\"markdownIt-Anchor\" href=\"#发送时间\">#</a> 发送时间</h5>\n<blockquote>\n<p>默认立即发送</p>\n</blockquote>\n<ul>\n<li>\n<p>延时发送</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 参数1:主题 2:消息 3:rocket发送最大允许时间 4:延时级别(18级)</span><br><span class=\"line\">SendResult sendResult = rocketMQTemplate.syncSend(&quot;020-boot&quot;, MessageBuilder.withPayload(msg).build(),100000,3);</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"消费模式消费者\"><a class=\"markdownIt-Anchor\" href=\"#消费模式消费者\">#</a> 消费模式 (消费者)</h4>\n<blockquote>\n<p>以组为单位 默认为集群模式</p>\n</blockquote>\n<ul>\n<li>\n<p>集群模式 (每组只有一个可以收到)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@RocketMQMessageListener(</span><br><span class=\"line\">        topic = &quot;020-boot&quot;,</span><br><span class=\"line\">        messageModel = MessageModel.CLUSTERING,</span><br><span class=\"line\">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onMessage(String s) &#123;</span><br><span class=\"line\">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>广播模式 (每组的所有消费者都可以收到)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@RocketMQMessageListener(</span><br><span class=\"line\">        topic = &quot;020-boot&quot;,</span><br><span class=\"line\">        messageModel = MessageModel.BROADCASTING,</span><br><span class=\"line\">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onMessage(String s) &#123;</span><br><span class=\"line\">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h4 id=\"消息过滤\"><a class=\"markdownIt-Anchor\" href=\"#消息过滤\">#</a> 消息过滤</h4>\n<h5 id=\"tag标签模式\"><a class=\"markdownIt-Anchor\" href=\"#tag标签模式\">#</a> Tag 标签模式</h5>\n<blockquote>\n<p>在发送的消息 Topic:Tag 中间使用冒号隔开</p>\n</blockquote>\n<ul>\n<li>\n<p>生产者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RequestMapping(&quot;/sendTagMsg&quot;)</span><br><span class=\"line\">public String sendTagMsg(String msg) &#123;</span><br><span class=\"line\">    rocketMQTemplate.convertAndSend(&quot;020-boot:TagB&quot;,msg);</span><br><span class=\"line\">    return &quot;success&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>消费者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@RocketMQMessageListener(</span><br><span class=\"line\">        topic = &quot;020-boot&quot;,</span><br><span class=\"line\">        selectorType = SelectorType.TAG,</span><br><span class=\"line\">  //接收TagB或TagA</span><br><span class=\"line\">        secretKey = &quot;TagB || TagA&quot;,</span><br><span class=\"line\">        consumerGroup = &quot;wolfcode-consumer&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">public class MqListenner implements RocketMQListener&lt;String&gt; &#123;</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onMessage(String s) &#123;</span><br><span class=\"line\">        System.out.println(&quot;今天上映:&quot;+s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h5 id=\"sql92过滤\"><a class=\"markdownIt-Anchor\" href=\"#sql92过滤\">#</a> SQL92 过滤</h5>\n<blockquote>\n<p>注意：在使用 SQL 过滤的时候，需要配置参数 enablePropertyFilter=true</p>\n</blockquote>\n<ul>\n<li>\n<p>生产者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Sql92过滤</span><br><span class=\"line\">@RequestMapping(&quot;/sendSQLMsg&quot;)</span><br><span class=\"line\">public String sendSQLMsg(int age,String msg) &#123;</span><br><span class=\"line\">    Map&lt;String,Object&gt; map=new HashMap&lt;&gt;();</span><br><span class=\"line\">    //用户自定义属性</span><br><span class=\"line\">    map.put(&quot;age&quot;, age);</span><br><span class=\"line\">    map.put(&quot;name&quot;, &quot;hesj&quot;);</span><br><span class=\"line\">    //也可以设置系统属性</span><br><span class=\"line\">    map.put(MessageConst.PROPERTY_KEYS,age);</span><br><span class=\"line\">    template.convertAndSend(&quot;02-RocketMQ-Top7&quot;,msg,map);</span><br><span class=\"line\">    return &quot;success&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>消费者</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component</span><br><span class=\"line\">@RocketMQMessageListener(</span><br><span class=\"line\">        topic = &quot;02-RocketMQ-Top7&quot;,</span><br><span class=\"line\">        messageModel = MessageModel.CLUSTERING,</span><br><span class=\"line\">        selectorType = SelectorType.SQL92,</span><br><span class=\"line\">        selectorExpression = &quot;age &gt; 16&quot;,</span><br><span class=\"line\">        consumerGroup= &quot;wolfcode-consumer7&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">public class MqListiner7 implements RocketMQListener&lt;String&gt; &#123;</span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public void onMessage(String msg) &#123;</span><br><span class=\"line\">        System.out.println(&quot;消费消息SQl92&quot;+msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/RequestParam%20%E5%92%8C%20PathVariable%E7%9A%84%E5%8C%BA%E5%88%AB/",
            "url": "http://example.com/2022/12/27/RequestParam%20%E5%92%8C%20PathVariable%E7%9A%84%E5%8C%BA%E5%88%AB/",
            "title": "RequestParam 和 PathVariable的区别",
            "date_published": "2022-12-27T08:18:48.613Z",
            "content_html": "<p>RequestParam 和 PathVariable 注解是用于从 request 中接收请求的，两个都可以接收参数，关键点不同的是 RequestParam 是从 request 里面拿取值，而 PathVariable 是从一个 URI 模板里面来填充</p>\n<p>PathVariable<br>\n 主要用于接收 http://host:port/path/{参数值} 数据:</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODg3L3Rlc3QxL2lkMS9uYW1lMQ==\">http://localhost:8887/test1/id1/name1</span></p>\n<p>根据上面的这个 url，你可以用这样的方式来进行获取:</p>\n<pre><code>RequestMapping(&quot;test1/&#123;id&#125;/&#123;name&#125;&quot;)\npublic String testPathVariable(PathVariable String id, PathVariable String name) &#123;\n    return &quot;id=&quot; + id + &quot;, name=&quot; + name;\n&#125;\nPathVariable 支持下面三种参数：\n</code></pre>\n<p>name 绑定本次参数的名称，要跟 URL 上面的一样<br>\n required 这个参数是否必须的<br>\n value 跟 name 一样的作用，是 name 属性的一个别名<br>\n RequestParam<br>\n 主要用于接收 http://host:port/path? 参数名 = 参数值数据，这里后面也可以不跟参数值；</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODg3L3Rlc3QyP2lkPWlkMiZhbXA7bmFtZT1uYW1lMg==\">http://localhost:8887/test2?id=id2&amp;name=name2</span></p>\n<p>根据上面的这个 url，你可以用这样的方式来进行获取:</p>\n<pre><code>RequestMapping(&quot;test2&quot;)\npublic String testRequestParam(RequestParam(&quot;id&quot;) String id, RequestParam(&quot;name&quot;) String name) &#123;\n    return &quot;id=&quot; + id + &quot;, name=&quot; + name;\n&#125;\nRequestParam 支持下面四种参数：\n</code></pre>\n<p>defaultValue 如果本次请求没有携带这个参数，或者参数为空，那么就会启用默认值<br>\n name 绑定本次参数的名称，要跟 URL 上面的一样<br>\n required 这个参数是否必须的<br>\n value 跟 name 一样的作用，是 name 属性的一个别名<br>\n PathVariable 和 RequestParam 混合使用<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4ODg3L3Rlc3QzL2lkMz9uYW1lPW5hbWUz\"> http://localhost:8887/test3/id3?name=name3</span></p>\n<p>根据上面的这个 url，你可以用这样的方式来进行获取:</p>\n<pre><code>RequestMapping(&quot;test3/&#123;id&#125;&quot;)\npublic String test3(PathVariable String id, RequestParam(&quot;name&quot;) String name) &#123;\n    return &quot;id=&quot; + id + &quot;, name=&quot; + name;\n&#125;\n对比\n1.用法上的不同：\nPathVariable只能用于接收url路径上的参数，而RequestParam只能用于接收请求带的params\n2.内部参数不同：\nPathVariable有value，name，required这三个参数，而RequestParam也有这三个参数，并且比PathVariable多一个参数defaultValue（该参数用于当请求体中不包含对应的参数变量时，参数变量使用defaultValue指定的默认值）\n3.PathVariable一般用于get和delete请求，RequestParam一般用于post请求。</code></pre>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Redis%E6%8C%81%E4%B9%85%E5%8C%96/",
            "url": "http://example.com/2022/12/27/Redis%E6%8C%81%E4%B9%85%E5%8C%96/",
            "title": "Redis持久化",
            "date_published": "2022-12-27T08:18:48.611Z",
            "content_html": "<h3 id=\"一-持久化简介\"><a class=\"markdownIt-Anchor\" href=\"#一-持久化简介\">#</a> <strong>一、持久化简介</strong></h3>\n<p><strong>Redis</strong> 的数据 <strong>全部存储</strong> 在 <strong>内存</strong> 中，如果 <strong>突然宕机</strong>，数据就会全部丢失，因此必须有一套机制来保证 Redis 的数据不会因为故障而丢失，这种机制就是 Redis 的 <strong>持久化机制</strong>，它会将内存中的数据库状态保存到磁盘 中。</p>\n<p><strong>持久化发生了什么</strong>？ <strong>|</strong> <strong>从内存到磁盘</strong>：</p>\n<p>我们来稍微考虑一下 <strong>Redis</strong> 作为一个内存数据库 要做的关于持久化的事情。通常来说，从客户端发</p>\n<p>起请求开始，到服务器真实地写入磁盘，需要发生如下几件事情：</p>\n<p><strong>详细版</strong> 的文字描述大概就是下面这样：</p>\n<p>\\1. 客户端向数据库 <strong>发送写命令</strong> <em>(<em>数据在客户端的内存中</em>)</em></p>\n<p>\\2. 数据库 <strong>接收</strong> 到客户端的 <strong>写请求</strong> <em>(<em>数据在服务器的内存中</em>)</em></p>\n<p>\\3. 数据库 <strong>调用系统</strong> <strong>API</strong> 将数据写入磁盘 <em>(<em>数据在内核缓冲区中</em>)</em></p>\n<p>\\4. 操作系统将 <strong>写缓冲区</strong> 传输到 <strong>磁盘控控制器</strong> <em>(<em>数据在磁盘缓存中</em>)</em></p>\n<p>\\5. 操作系统的磁盘控制器将数据 <strong>写入实际的物理媒介</strong> 中 <em>(<em>数据在磁盘中</em>)</em></p>\n<p>** 注意、上面的过程其实是 ** 极度精简 的，在实际的操作系统中，<strong>缓存</strong> 和 <strong>缓冲区</strong> 会比这 <strong>多得多</strong>…</p>\n<h3 id=\"如何尽可能保证持久化的安全\"><a class=\"markdownIt-Anchor\" href=\"#如何尽可能保证持久化的安全\">#</a> <strong>如何尽可能保证持久化的安全</strong></h3>\n<p>如果我们故障仅仅涉及到 <strong>软件层面</strong> <em>(<em>该进程被管理员终止或程序崩溃</em>)</em> 并且没有接触到内核，那么在 上 述步骤 <em>3</em> 成功返回之后，我们就认为成功了。即使进程崩溃，操作系统仍然会帮助我们把数据正确地写入磁盘。</p>\n<p>如果我们考虑 ** 停电 ** 火灾 等 <strong>更具灾难性</strong> 的事情，那么只有在完成了第 <strong>5</strong> 步之后，才是安全的。</p>\n<p>所以我们可以总结得出数据安全最重要的阶段是：<strong>步骤三、四、五</strong>，即：</p>\n<p>数据库软件调用写操作将用户空间的缓冲区转移到内核缓冲区的频率是多少？</p>\n<p>内核多久从缓冲区取数据刷新到磁盘控制器？</p>\n<p>磁盘控制器多久把数据写入物理媒介一次？</p>\n<p><strong>注意：</strong> 如果真的发生灾难性的事件，我们可以从上图的过程中看到，任何一步都可能被意外打断</p>\n<p>丢失，所以只能 <strong>尽可能地保证</strong> 数据的安全，这对于所有数据库来说都是一样的。</p>\n<p>我们从 <strong>第三步</strong> 开始。Linux 系统提供了清晰、易用的用于操作文件的 POSIX file API ， 20 多年过</p>\n<p>去，仍然还有很多人对于这一套 API 的设计津津乐道，我想其中一个原因就是因为你光从 API 的命名</p>\n<p>就能够很清晰地知道这一套 API 的用途：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">open</span><span class=\"params\">(const <span class=\"type\">char</span> *path, <span class=\"type\">int</span> oflag, ...<span class=\"comment\">/*,mode_t mode */</span>)</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">close</span> <span class=\"params\">(<span class=\"type\">int</span> filedes)</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">remove</span><span class=\"params\">( const <span class=\"type\">char</span> *fname )</span>; </span><br><span class=\"line\">ssize_t <span class=\"title function_\">write</span><span class=\"params\">(<span class=\"type\">int</span> fildes, const <span class=\"keyword\">void</span> *buf, size_t nbyte)</span>;</span><br><span class=\"line\">ssize_t <span class=\"title function_\">read</span><span class=\"params\">(<span class=\"type\">int</span> fildes, <span class=\"keyword\">void</span> *buf, size_t nbyte)</span>;</span><br></pre></td></tr></table></figure>\n<p>所以，我们有很好的可用的 API 来完成 <strong>第三步</strong>，但是对于成功返回之前，我们对系统调用花费的时间没有太多的控制权。</p>\n<p>然后我们来说说 <strong>第四步</strong>。我们知道，除了早期对电脑特别了解那帮人 <em>(<em>操作系统就这帮人搞的</em>)</em>，实际的物理硬件都不是我们能够 <strong>直接操作</strong> 的，都是通过 <strong>操作系统调用</strong> 来达到目的的。为了防止过慢的 I/O 操作拖慢整个系统的运行，操作系统层面做了很多的努力，譬如说 <strong>上述第四步</strong> 提到的 <strong>写缓冲区</strong>，并不是所有的写操作都会被立即写入磁盘，而是要先经过一个缓冲区，默认情况下，Linux 将在 <strong>30</strong> <strong>秒</strong> 后实际提交写入。</p>\n<p>但是很明显，<strong>30</strong> <strong>秒</strong> 并不是 Redis 能够承受的，这意味着，如果发生故障，那么最近 30 秒内写入的所有数据都可能会丢失。幸好 PROSIX API 提供了另一个解决方案： fsync ，该命令会 <strong>强制</strong> 内核将 <strong>缓 **** 冲区</strong> 写入 <strong>磁盘</strong>，但这是一个非常消耗性能的操作，每次调用都会 <strong>阻塞等待</strong> 直到设备报告 IO 完成，所以一般在生产环境的服务器中，<strong>Redis</strong> 通常是每隔 1s 左右执行一次 fsync 操作。到目前为止，我们了解到了如何控制 第三步 和 第四步 ，但是对于 <strong>第五步</strong>，我们 <strong>完全无法控制</strong>。也许一些内核实现将试图告诉驱动实际提交物理介质上的数据，或者控制器可能会为了提高速度而重新排序写操作，不会尽快将数据真正写到磁盘上，而是会等待几个多毫秒。这完全是我们无法控制的。</p>\n<h3 id=\"二-redis-中的两种持久化方式\"><a class=\"markdownIt-Anchor\" href=\"#二-redis-中的两种持久化方式\">#</a> ** 二、Redis ** 中的两种持久化方式</h3>\n<p><strong>方式一：快照</strong></p>\n<p><strong>Redis</strong> <strong>快照</strong> 是最简单的 Redis 持久性模式。当满足特定条件时，它将生成数据集的时间点快照，例如，</p>\n<p>如果先前的快照是在 2 分钟前创建的，并且现在已经至少有 <em>100</em> 次新写入，则将创建一个新的快照。此条件可以由用户配置 Redis 实例来控制，也可以在运行时修改而无需重新启动服务器。快照作为包含整个数据集的单个 .rdb 文件生成。</p>\n<p>但我们知道，Redis 是一个 <strong>单线程</strong> 的程序，这意味着，我们不仅仅要响应用户的请求，还需要进行内存快照。而后者要求 Redis 必须进行 IO 操作，这会严重拖累服务器的性能。</p>\n<p>还有一个重要的问题是，我们在 <strong>持久化的同时</strong>，<strong>内存数据结构</strong> 还可能在 <strong>变化</strong>，比如一个大型的 hash 字典正在持久化，结果一个请求过来把它删除了，可是这才刚持久化结束，咋办？</p>\n<p><strong>使用系统多进程</strong> <strong>COW(Copy On Write)</strong> <strong>机制</strong> <strong>| fork</strong> <strong>函数</strong></p>\n<p>操作系统多进程 <strong>COW(Copy On Write)</strong> <strong>机制</strong> 拯救了我们。<strong>Redis</strong> 在持久化时会调用 glibc 的函数</p>\n<p>fork 产生一个子进程，简单理解也就是基于当前进程 <strong>复制</strong> 了一个进程，主进程和子进程会共享内存</p>\n<p>里面的代码块和数据段：</p>\n<p>这里多说一点，<strong>为什么</strong> <strong>fork</strong> <strong>成功调用后会有两个返回值呢？</strong> 因为子进程在复制时复制了父进程的堆栈</p>\n<p>段，所以两个进程都停留在了 fork 函数中 <em>(<em>都在同一个地方往下继续</em> &quot;<em> 同时</em> &quot;<em> 执行</em>)</em>，等待返回，所以 <strong>一</strong></p>\n<p><strong>次在父进程中返回子进程的</strong> <strong>pid</strong>**，另一次在子进程中返回零，系统资源不够时返回负数</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pid = os.fork() </span><br><span class=\"line\">  <span class=\"keyword\">if</span> pid &gt; 0a:</span><br><span class=\"line\">\thandle_client_request() # 父进程继续处理客户端请求 </span><br><span class=\"line\">  <span class=\"keyword\">if</span> pid == <span class=\"number\">0</span>: </span><br><span class=\"line\">    handle_snapshot_write() # 子进程处理快照写磁盘 </span><br><span class=\"line\">  <span class=\"keyword\">if</span> pid &lt; <span class=\"number\">0</span>: # fork error</span><br></pre></td></tr></table></figure>\n<p>所以 <strong>快照持久化</strong> 可以完全交给 <strong>子进程</strong> 来处理，<strong>父进程</strong> 则继续 <strong>处理客户端请求</strong>。<strong>子进程</strong> 做数据持久</p>\n<p>化，它 <strong>不会修改现有的内存数据结构</strong>，它只是对数据结构进行遍历读取，然后序列化写到磁盘中。但是</p>\n<p><strong>父进程</strong> 不一样，它必须持续服务客户端请求，然后对 <strong>内存数据结构进行不间断的修改</strong>。</p>\n<p>这个时候就会使用操作系统的 COW 机制来进行 <strong>数据段页面</strong> 的分离。数据段是由很多操作系统的页面组合而成，当父进程对其中一个页面的数据进行修改时，会将被共享的页面复 制一份分离出来，然后</p>\n<p><strong>对这个复制的页面进行修改</strong>。这时 <strong>子进程</strong> 相应的页面是 <strong>没有变化的</strong>，还是进程产生时那一瞬间的数据。</p>\n<p>子进程因为数据没有变化，它能看到的内存里的数据在进程产生的一瞬间就凝固了，再也不会改变，这也是为什么 <strong>Redis</strong> 的持久化 <strong>叫「快照」的原因</strong>。接下来子进程就可以非常安心的遍历数据了进行序列化写磁盘了。</p>\n<p><strong>快照不是很持久</strong>。如果运行 Redis 的计算机停止运行，电源线出现故障或者您 kill -9 的实例意外发生，则写入 Redis 的最新数据将丢失。尽管这对于某些应用程序可能不是什么大问题，但有些使用案例具有充分的耐用性，在这些情况下，快照并不是可行的选择。</p>\n<p><strong>AOF(Append Only File -</strong> <strong>仅追加文件</strong> **)** 它的工作方式非常简单：每次执行 <strong>修改内存</strong> 中数据集的写操作时，都会 <strong>记录</strong> 该操作。假设 AOF 日志记录了自 Redis 实例创建以来 <strong>所有的修改性指令序列</strong>，那么就可以通过对一个空的 Redis 实例 <strong>顺序执行所有的指令</strong>，也就是 <strong>「重放」</strong>，来恢复 Redis 当前实例的内存数据结构的状态。</p>\n<h3 id=\"aof重写\"><a class=\"markdownIt-Anchor\" href=\"#aof重写\">#</a> AOF 重写</h3>\n<p><strong>Redis</strong> 在长期运行的过程中，AOF 的日志会越变越长。如果实例宕机重启，重放整个 AOF 日志会非常耗时，导致长时间 Redis 无法对外提供服务。所以需要对 <strong>AOF</strong> <strong>日志</strong> 瘦身。</p>\n<p><strong>Redis</strong> 提供了 bgrewriteaof 指令用于对 AOF 日志进行瘦身。其 <strong>原理</strong> 就是 <strong>开辟一个子进程</strong> 对内存进行 <strong>遍历</strong> 转换成一系列 Redis 的操作指令，<strong>序列化到一个新的</strong> <strong>AOF</strong> <strong>日志文件</strong> 中。序列化完毕后再将操作期间发生的 <strong>增量</strong> <strong>AOF</strong> <strong>日志</strong> 追加到这个新的 AOF 日志文件中，追加完毕后就立即替代旧的 AOF 日志文件了，瘦身工作就完成了。</p>\n<p><strong>fsync</strong></p>\n<p>AOF 日志是以文件的形式存在的，当程序对 AOF 日志文件进行写操作时，实际上是将内容写到了内核</p>\n<p>为文件描述符分配的一个内存缓存中，然后内核会异步将脏数据刷回到磁盘的。</p>\n<p>就像我们 上方第四步 描述的那样，我们需要借助 glibc 提供的 fsync (int fd) 函数来讲指定的文件内容 <strong>强制从内核缓存刷到磁盘</strong>。但 强制开车 仍然是一个很消耗资源的一个过程，需要 节制！通常来说，生产环境的服务器，Redis 每隔 1s 左右执行一次 fsync 操作就可以了。</p>\n<p>Redis 同样也提供了另外两种策略，一个是 <strong>永不</strong> <strong>fsync</strong>，来让操作系统来决定合适同步磁盘，很不安全，另一个是 <strong>来一个指令就</strong> <strong>fsync</strong> <strong>一次</strong>，非常慢。但是在生产环境基本不会使用，了解一下即可。</p>\n<h3 id=\"redis-40混合持久化\"><a class=\"markdownIt-Anchor\" href=\"#redis-40混合持久化\">#</a> <strong>Redis 4.0</strong> 混合持久化</h3>\n<p>重启 Redis 时，我们很少使用 rdb 来恢复内存状态，因为会丢失大量数据。我们通常使用 AOF 日志重放，但是重放 AOF 日志性能相对 rdb 来说要慢很多，这样在 Redis 实例很大的情况下，启动需要花费很长的时间。</p>\n<p><strong>Redis 4.0</strong> 为了解决这个问题，带来了一个新的持久化选项 ——<strong> 混合持久化</strong>。将 rdb 文件的内容和增量的 AOF 日志文件存在一起。这里的 AOF 日志不再是全量的日志，而是 <strong>自持久化开始到持久化结束</strong> 的</p>\n<p>这段时间发生的增量 AOF 日志，通常这部分 AOF 日志很小：</p>\n<p>于是在 Redis 重启的时候，可以先加载 rdb 的内容，然后再重放增量 AOF 日志就可以完全替代之前的 AOF 全量文件重放，重启效率因此大幅得到提升。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Redis%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Redis%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/",
            "title": "redis主从集群-哨兵模式搭建文档",
            "date_published": "2022-12-27T08:18:48.609Z",
            "content_html": "<p>准备工作</p>\n<ul>\n<li>\n<h3 id=\"三台服务器\"><a class=\"markdownIt-Anchor\" href=\"#三台服务器\">#</a> 三台服务器</h3>\n</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">服务器 ip</th>\n<th>角色</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">192.168.20.1</td>\n<td>主</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">192.168.20.2</td>\n<td>从</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">192.168.20.3</td>\n<td>从</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>\n<h4 id=\"docker安装redis\"><a class=\"markdownIt-Anchor\" href=\"#docker安装redis\">#</a> docker 安装 redis</h4>\n</li>\n</ol>\n<p>docker pull redis</p>\n<ol start=\"3\">\n<li>\n<h4 id=\"运行\"><a class=\"markdownIt-Anchor\" href=\"#运行\">#</a> 运行</h4>\n</li>\n</ol>\n<p>分别从三台服务器运行 redis 镜像，注意映射不同外端口</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -p 6380:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes --daemonize no --masterauth #如果主节点设置了密码，请输入主服务密码</span><br></pre></td></tr></table></figure>\n<p>docker exec -it redis_master /bin/bash</p>\n<ol start=\"4\">\n<li>\n<h4 id=\"查看角色\"><a class=\"markdownIt-Anchor\" href=\"#查看角色\">#</a> 查看角色</h4>\n</li>\n</ol>\n<h4 id=\"主\"><a class=\"markdownIt-Anchor\" href=\"#主\">#</a> 主：</h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; auth #你的密码</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\">connected_slaves:0</span><br><span class=\"line\">master_failover_state:no-failover</span><br><span class=\"line\">master_replid:f28e9097e4c8cd3f67292181be12955909afd88e</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:0</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:0</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:0</span><br><span class=\"line\">repl_backlog_histlen:0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h4 id=\"从01\"><a class=\"markdownIt-Anchor\" href=\"#从01\">#</a> 从 01:</h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\">connected_slaves:0</span><br><span class=\"line\">master_failover_state:no-failover</span><br><span class=\"line\">master_replid:48a7e3866afc4b6784ef49353b57fbc979ee2935</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:0</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:0</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:0</span><br><span class=\"line\">repl_backlog_histlen:0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h4 id=\"从02\"><a class=\"markdownIt-Anchor\" href=\"#从02\">#</a> 从 02：</h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\">connected_slaves:0</span><br><span class=\"line\">master_failover_state:no-failover</span><br><span class=\"line\">master_replid:de30809041f22f2dd6abc9cb34536f26df97e647</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:0</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:0</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:0</span><br><span class=\"line\">repl_backlog_histlen:0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>\n<h4 id=\"在两台从服务器上执行命令-replicaof-192168201-6379\"><a class=\"markdownIt-Anchor\" href=\"#在两台从服务器上执行命令-replicaof-192168201-6379\">#</a> 在两台从服务器上执行命令 replicaof 192.168.20.1 6379</h4>\n</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; replicaof 192.168.20.1 6379</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<ol start=\"5\">\n<li>\n<h4 id=\"查看主服务信息\"><a class=\"markdownIt-Anchor\" href=\"#查看主服务信息\">#</a> 查看主服务信息</h4>\n</li>\n</ol>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\"><span class=\"meta prompt_\"> </span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##从服务器信息</span></span></span><br><span class=\"line\">connected_slaves:2</span><br><span class=\"line\">slave0:ip=172.17.0.3,port=6379,state=online,offset=1456,lag=1</span><br><span class=\"line\">slave1:ip=172.17.0.4,port=6379,state=online,offset=1456,lag=0</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">##从服务器信息</span></span></span><br><span class=\"line\"> </span><br><span class=\"line\">master_failover_state:no-failover</span><br><span class=\"line\">master_replid:9b8c2ef4539809505fa5bc1dd779c4500298011d</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:1456</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:1</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:1</span><br><span class=\"line\">repl_backlog_histlen:1456</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">127.0.0.1:6379&gt; info replication</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Replication</span></span><br><span class=\"line\">role:master</span><br><span class=\"line\">connected_slaves:0</span><br><span class=\"line\">master_failover_state:no-failover</span><br><span class=\"line\">master_replid:f28e9097e4c8cd3f67292181be12955909afd88e</span><br><span class=\"line\">master_replid2:0000000000000000000000000000000000000000</span><br><span class=\"line\">master_repl_offset:0</span><br><span class=\"line\">second_repl_offset:-1</span><br><span class=\"line\">repl_backlog_active:0</span><br><span class=\"line\">repl_backlog_size:1048576</span><br><span class=\"line\">repl_backlog_first_byte_offset:0</span><br><span class=\"line\">repl_backlog_histlen:0</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ol start=\"6\">\n<li>\n<h4 id=\"测试\"><a class=\"markdownIt-Anchor\" href=\"#测试\">#</a> 测试：</h4>\n</li>\n</ol>\n<p>主服务器上：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; set name zs</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h3 id=\"从服务器也可以查看到信息\"><a class=\"markdownIt-Anchor\" href=\"#从服务器也可以查看到信息\">#</a> 从服务器也可以查看到信息</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">127.0.0.1:6379&gt; replicaof 192.168.20.1 6379</span><br><span class=\"line\">OK</span><br><span class=\"line\">127.0.0.1:6379&gt; get name</span><br><span class=\"line\">&quot;zs&quot;</span><br><span class=\"line\">127.0.0.1:6379&gt; </span><br></pre></td></tr></table></figure>\n<h3 id=\"异常统计\"><a class=\"markdownIt-Anchor\" href=\"#异常统计\">#</a> 异常统计：</h3>\n<p>可能遇到的 BUG：MASTER aborted replication with an error: NOAUTH Authentication required.</p>\n<p>场景：在配置主从后发现两个从节点的 info replication 中出现：master_link_status:down</p>\n<p>原因：大部分原因是因为主节点配置了密码</p>\n<p>解决：在从节点的配置文件中加入 masterauth 你的主节点密码 即可</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Redis%E4%B8%8EMysql%20Master%E4%B8%8ESlave%E5%90%8C%E6%AD%A5%EF%BC%9Acanal%E6%95%99%E5%AD%A6/",
            "url": "http://example.com/2022/12/27/Redis%E4%B8%8EMysql%20Master%E4%B8%8ESlave%E5%90%8C%E6%AD%A5%EF%BC%9Acanal%E6%95%99%E5%AD%A6/",
            "title": "Redis与Mysql | Master与Slave同步：canal教学",
            "date_published": "2022-12-27T08:18:48.606Z",
            "content_html": "<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言：</h2>\n<p>​\t\t作者最近在做自己的项目，使用到 Redis，需要热更新，修改 Mysql 后同步 Redis 缓存，出于对圈子的贡献，也较于当前的 canal 的博客大多数不是很详细，所以写下这篇文章，时间是 2022 年 6 月 29 日。目的是帮助更多的人，希望能为在祖国的经济发展作出小小的贡献。</p>\n<p>​\t\tend</p>\n<h4 id=\"学习canal基本需要\"><a class=\"markdownIt-Anchor\" href=\"#学习canal基本需要\">#</a> 学习 Canal 基本需要：</h4>\n<p>​\tLinux 服务器，性能无大要求</p>\n<p>​\tJava 基础</p>\n<p>​\tMysql，Redis 基础</p>\n<h3 id=\"俗话说要了解一个东西先了解他的由来\"><a class=\"markdownIt-Anchor\" href=\"#俗话说要了解一个东西先了解他的由来\">#</a> 俗话说，要了解一个东西，先了解他的由来：</h3>\n<h2 id=\"一-canal起源\"><a class=\"markdownIt-Anchor\" href=\"#一-canal起源\">#</a> 一、Canal 起源</h2>\n<p>​\t\t阿里巴巴因为业务特性，买家集中在国外，衍生出了杭州美国异地数据同步需求，从 2010 年开始，阿里巴巴开始开发 canal，canal 是基于 Java 开发的数据库增量日志解析，提供增量数据订阅 &amp; 消费的中间件。Canal 主要支持了 Mysql 和 Bilog 解析，解析完成后利用 canal Client 来处理获取相关数据。</p>\n<p>了解完 canal 的起源，再来看看 canal 的核心业务依赖，也就是 mysql 的二进制日志：binary_log 简称：Binlog</p>\n<h2 id=\"二-binlog\"><a class=\"markdownIt-Anchor\" href=\"#二-binlog\">#</a> 二、Binlog</h2>\n<p>​\t\tbinlog 指二进制日志，它记录了数据库上的所有改变，并以二进制的形式保存在磁盘中，它可以用来查看数据库的变更历史、数据库增量备份和恢复、MySQL 的复制（主从数据库的复制）。</p>\n<h4 id=\"binlog有三种格式\"><a class=\"markdownIt-Anchor\" href=\"#binlog有三种格式\">#</a> binlog 有三种格式：</h4>\n<p>statement：基于 SQL 语句的复制（statement-based replication，SBR）<br>\nrow：基于行的复制（row-based replication，RBR）<br>\nmixed：混合模式复制（mixed-based replication，MBR）</p>\n<h4 id=\"statement语句级别\"><a class=\"markdownIt-Anchor\" href=\"#statement语句级别\">#</a> statement：语句级别</h4>\n<p>每一条会修改数据的 sql 都会记录在 binlog 中。</p>\n<p>​\t\t优点：不需要记录每一行的变化，减少了 binlog 日志量，节约了 IO，提高性能。但是注意 statement 相比于 row 能节约多少性能与日志量，取决于应用的 SQL 情况。正常同一条记录修改或者插入 row 格式所产生的日志量还小于 Statement 产生的日志量，但是考虑到如果带条件的 update 操作，以及整表删除，alter 表等操作，ROW 格式会产生大量日志，因此在考虑是否使用 ROW 格式日志时应该跟据应用的实际情况，其所产生的日志量会增加多少，以及带来的 IO 性能问题。</p>\n<p>​\t\t缺点：由于记录的只是执行语句，为了这些语句在 slave 上正确运行，我们还必须记录每条语句在执行时候的一些相关信息，以保证所有语句能在 slave 得到和在 master 端执行时相同的结果。另外，一些特定的函数功能如果要在 slave 和 master 上保持一致会有很多相关问题。</p>\n<h4 id=\"row行数据级别\"><a class=\"markdownIt-Anchor\" href=\"#row行数据级别\">#</a> row：行数据级别</h4>\n<p>5.1.5 版本的 MySQL 才开始支持 row level 的复制，它不记录 sql 语句上下文相关信息，仅保存哪条记录被修改。</p>\n<p>​\t\t优点：binlog 中可以不记录执行的 sql 语句的上下文相关的信息，仅需要记录那一条记录被修改成什么了。所以 row level 的日志会非常清楚的记下每一行数据修改的细节。而且不会出现某些特定情况下的存储过程，或 function，以及 trigger 的调用和触发无法被正确复制的问题。</p>\n<p>​\t\t缺点：所有的执行的语句当记录到日志中的时候，都将以每行记录的修改来记录，这样可能会产生大量的日志内容。但是新版本的 MySQL 对 row level 模式进行了优化，并不是所有的修改都会以 row level 来记录，像遇到表结构变更的时候就会以 statement 模式来记录，如果 sql 语句确实就是 update 或者 delete 等修改数据的语句，那么还是会记录所有行的变更。</p>\n<h4 id=\"mixed混合级别\"><a class=\"markdownIt-Anchor\" href=\"#mixed混合级别\">#</a> mixed：混合级别</h4>\n<p>从 5.1.8 版本开始，MySQL 提供了 Mixed 格式，实际上就是 Statement 与 Row 的结合。</p>\n<p>​\t\t在 Mixed 模式下，一般的语句修改使用 statment 格式保存 binlog，如果一些函数，statement 无法完成主从复制的操作，则采用 row 格式保存 binlog，MySQL 会根据执行的每一条具体的 sql 语句来区分对待记录的日志形式，也就是在 Statement 和 Row 之间选择一种。</p>\n<h5 id=\"由于-statement-和-mixed-的特殊性通过sql来备份总会有数据不一致的情况比如now函数\"><a class=\"markdownIt-Anchor\" href=\"#由于-statement-和-mixed-的特殊性通过sql来备份总会有数据不一致的情况比如now函数\">#</a> 由于 statement 和 mixed 的特殊性，通过 sql 来备份，总会有数据不一致的情况，比如：now () 函数。</h5>\n<h5 id=\"所以绝大多数场景下使用-row级别也就是行级别这样保证我们备份的数据和出口的数据相一致\"><a class=\"markdownIt-Anchor\" href=\"#所以绝大多数场景下使用-row级别也就是行级别这样保证我们备份的数据和出口的数据相一致\">#</a> 所以绝大多数场景下使用 Row 级别，也就是行级别，这样保证我们备份的数据和出口的数据相一致。</h5>\n<h3 id=\"三-下载和安装canal工具\"><a class=\"markdownIt-Anchor\" href=\"#三-下载和安装canal工具\">#</a> 三、下载和安装 Canal 工具</h3>\n<p>下载前，在 mysql 创建 canal 用户，因为 canal 服务端需要连接 mysql 数据库</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-- 使用命令登录：mysql -u root -p</span><br><span class=\"line\">-- 创建用户 用户名：canal 密码：Canal@123456</span><br><span class=\"line\">create user <span class=\"string\">&#x27;canal&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> identified by <span class=\"string\">&#x27;Canal@123456&#x27;</span>;</span><br><span class=\"line\">-- 授权 *.*表示所有库</span><br><span class=\"line\">grant SELECT, REPLICATION SLAVE, REPLICATION CLIENT on *.* to <span class=\"string\">&#x27;canal&#x27;</span>@<span class=\"string\">&#x27;%&#x27;</span> identified by <span class=\"string\">&#x27;Canal@123456&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h4 id=\"改了配置文件之后重启mysql使用命令查看是否打开binlog模式\"><a class=\"markdownIt-Anchor\" href=\"#改了配置文件之后重启mysql使用命令查看是否打开binlog模式\">#</a> 改了配置文件之后，重启 MySQL，使用命令查看是否打开 binlog 模式：</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/20200808151606261.png\" alt=\"在这里插入图片描述\"></p>\n<h4 id=\"查看binlog日志文件列表\"><a class=\"markdownIt-Anchor\" href=\"#查看binlog日志文件列表\">#</a> 查看 binlog 日志文件列表：</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/20200808151715291.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"点此下载canal\"><a class=\"markdownIt-Anchor\" href=\"#点此下载canal\">#</a> 点此下载 Canal👇</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naHByb3h5LmNvbS9odHRwczovL2dpdGh1Yi5jb20vYWxpYmFiYS9jYW5hbC9yZWxlYXNlcy9kb3dubG9hZC9jYW5hbC0xLjEuMi9jYW5hbC5kZXBsb3llci0xLjEuMi50YXIuZ3o=\">https://ghproxy.com/https://github.com/alibaba/canal/releases/download/canal-1.1.2/canal.deployer-1.1.2.tar.gz</span></p>\n<p>此链接为 github 代理提供连接，仅供参考，此处无广告意义。</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220629152616754.png\" alt=\"image-20220629152616754\"></p>\n<p>下载好后上传至 linux 服务器，创建 canal 文件夹并解压到 canal 文件夹中</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220629153150741.png\" alt=\"image-20220629153150741\"></p>\n<p>完成后会得到以上四个核心文件：bin，conf，lib，logs</p>\n<p>需要修改一处配置文件：</p>\n<p>​\t\t/canal/conf/example 下的 instance.properties</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220629153511220.png\" alt=\"image-20220629153511220\"></p>\n<p>修改完成后保存退出</p>\n<p>接下来进入 bin 目录 sh <span class=\"exturl\" data-url=\"aHR0cDovL3N0YXJ0VXAuc2g=\">startUp.sh</span> 启动 canal 服务端</p>\n<h4 id=\"至此服务端的操作基本完成\"><a class=\"markdownIt-Anchor\" href=\"#至此服务端的操作基本完成\">#</a> 至此服务端的操作基本完成</h4>\n<p>Java 客户端操作<br>\n首先引入 maven 依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba.otter<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>canal.client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.1.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>然后创建一个 canal 项目，使用 SpringBoot 构建，如图所示，创建 canal 包：</p>\n<p><img data-src=\"C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20220629153956493.png\" alt=\"image-20220629153956493\"></p>\n<p>canal 工具类，仅供参考</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> cn.brath.canal;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.awt.print.Printable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.LocalDateTime;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.brath.common.redis.service.TokenService;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.brath.common.redis.util.RedisKeys;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.brath.common.utils.AssertUtil;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.brath.common.utils.UserTokenManager;</span><br><span class=\"line\"><span class=\"keyword\">import</span> cn.brath.entity.IvUser;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.otter.canal.client.CanalConnector;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.otter.canal.client.CanalConnectors;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.otter.canal.protocol.CanalEntry.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.alibaba.otter.canal.protocol.Message;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.protobuf.InvalidProtocolBufferException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.Logger;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.slf4j.LoggerFactory;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.print.attribute.standard.MediaPrintableArea;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.net.InetSocketAddress;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.time.ZoneId;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CanalClient</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * SLF4J日志</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"type\">Logger</span> <span class=\"variable\">logger</span> <span class=\"operator\">=</span> LoggerFactory.getLogger(CanalClient.class);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">host</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;***.***.***.***&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">port</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;11111&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">destination</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;example&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 用户令牌业务接口</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> TokenService tokenService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">TokenServiceIn</span><span class=\"params\">(TokenService tokenService)</span> &#123;</span><br><span class=\"line\">        CanalClient.tokenService = tokenService;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * canal启动方法</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!AssertUtil.isEmptys(host, port, destination)) &#123;</span><br><span class=\"line\">            logger.error(<span class=\"string\">&quot;canal客户端连接失败，当前服务端host：&#123;&#125;，port：&#123;&#125;，destination：&#123;&#125;&quot;</span>, host, port, destination);</span><br><span class=\"line\">            <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">CanalConnector</span> <span class=\"variable\">connector</span> <span class=\"operator\">=</span> CanalConnectors.newSingleConnector(</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(host, Integer.valueOf(port)), destination, <span class=\"string\">&quot;&quot;</span>, <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        );</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">batchSize</span> <span class=\"operator\">=</span> <span class=\"number\">1000</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//建立连接</span></span><br><span class=\"line\">            connector.connect();</span><br><span class=\"line\">            <span class=\"comment\">//目标为全部表</span></span><br><span class=\"line\">            connector.subscribe(<span class=\"string\">&quot;.*\\\\..*&quot;</span>);</span><br><span class=\"line\">            connector.rollback();</span><br><span class=\"line\">            logger.info(<span class=\"string\">&quot;canal客户端连接完成，当前服务端host：&#123;&#125;，port：&#123;&#125;，destination：&#123;&#125;&quot;</span>, host, port, destination);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//尝试从master那边拉去数据batchSize条记录，有多少取多少</span></span><br><span class=\"line\">                    <span class=\"type\">Message</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> connector.getWithoutAck(batchSize);</span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">batchId</span> <span class=\"operator\">=</span> message.getId();</span><br><span class=\"line\">                    <span class=\"type\">int</span> <span class=\"variable\">size</span> <span class=\"operator\">=</span> message.getEntries().size();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (batchId == -<span class=\"number\">1</span> || size == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        logger.info(<span class=\"string\">&quot;同步任务进行中，检测到修改数据，执行同步Redis&quot;</span>);</span><br><span class=\"line\">                        dataHandle(message.getEntries());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    connector.ack(batchId);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InvalidProtocolBufferException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            connector.disconnect();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 数据处理</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> entrys</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dataHandle</span><span class=\"params\">(List&lt;Entry&gt; entrys)</span> <span class=\"keyword\">throws</span> InvalidProtocolBufferException &#123;</span><br><span class=\"line\">        <span class=\"type\">JSONObject</span> <span class=\"variable\">beforeData</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">JSONObject</span> <span class=\"variable\">afterData</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Entry entry : entrys) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (EntryType.ROWDATA.equals(entry.getEntryType())) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//反序列化rowdata</span></span><br><span class=\"line\">                <span class=\"type\">RowChange</span> <span class=\"variable\">rowChange</span> <span class=\"operator\">=</span> RowChange.parseFrom(entry.getStoreValue());</span><br><span class=\"line\">                <span class=\"comment\">//获取数据集</span></span><br><span class=\"line\">                List&lt;RowData&gt; rowDataList = rowChange.getRowDatasList();</span><br><span class=\"line\">                <span class=\"comment\">//获取数据遍历</span></span><br><span class=\"line\">                <span class=\"keyword\">for</span> (RowData rowData : rowDataList) &#123;</span><br><span class=\"line\">                    afterData = <span class=\"keyword\">new</span> <span class=\"title class_\">JSONObject</span>();</span><br><span class=\"line\">                    List&lt;Column&gt; afterColumnsList = rowData.getAfterColumnsList();</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (Column column : afterColumnsList) &#123;</span><br><span class=\"line\">                        afterData.put(column.getName(), column.getValue());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">//因为作者这里只做同步Redis，不考虑到操作类型，只需要覆盖相同键值数据</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">//写入Redis</span></span><br><span class=\"line\">                executeRedisWarehousing(afterData);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 执行Redis用户数据入库</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> afterData</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">executeRedisWarehousing</span><span class=\"params\">(JSONObject afterData)</span> &#123;</span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;开始执行Redis热更新入库同步Mysql -- &quot;</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">        <span class=\"keyword\">do</span>...</span><br><span class=\"line\">        </span><br><span class=\"line\">        logger.info(<span class=\"string\">&quot;入库完成&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"启动类使用\"><a class=\"markdownIt-Anchor\" href=\"#启动类使用\">#</a> 启动类使用：</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Application</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(InterviewUserServiceApplication.class, args);</span><br><span class=\"line\">        <span class=\"comment\">//项目启动，执行canal客户端监听</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">CanalClient</span>().run();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">            log.error(<span class=\"string\">&quot; canal客户端监听 启动失败，原因可能是：&#123;&#125;&quot;</span>, e.getMessage());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>接下来启动项目运行，成功连接 canal 后我们尝试修改一个 mysql 的数据，发现在客户端成功完成了与 Redis 的同步操作</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220629154454409.png\" alt=\"image-20220629154454409\"></p>\n<h3 id=\"相关异常\"><a class=\"markdownIt-Anchor\" href=\"#相关异常\">#</a> 相关异常：</h3>\n<p>Canal 异常：</p>\n<p>dump address /124.222.106.122:3306 has an error, retrying. caused by <span class=\"exturl\" data-url=\"aHR0cDovL2phdmEubGE=\">java.la</span></p>\n<p>解决办法：重启 Mysql，删除 example 下的 dat 后缀文件后重启 canal</p>\n<p>其他：</p>\n<p>​\t是否开放端口 11111</p>\n<p>​\tmysql 是否连接成功，查看 logs/example/example.log</p>\n<p>​\t服务端与客户端是否连接成功，查看当前项目日志即可</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/node&npm&cnpm&webpack&yarn%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/",
            "url": "http://example.com/2022/12/27/node&npm&cnpm&webpack&yarn%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/",
            "title": "node&npm&cnpm&webpack&yarn安装教程",
            "date_published": "2022-12-27T08:18:48.604Z",
            "content_html": "<h3 id=\"nodejs\"><a class=\"markdownIt-Anchor\" href=\"#nodejs\">#</a> Node.js</h3>\n<p>​\t\tnodejs 是一个让 JavaScript 运行在服务端的开发平台，它让 JavaScript 成为与 PHP、Python、Perl、Ruby 等服务端语言平起平坐的脚本语言</p>\n<p>​\t\tnodejs 能做 web 开发，REST 开发，小程序开发等等，它就是使用 JavaScript 进行开发的，也就是说，基本上每个 web 开发的人员都可以比较轻松的转到 nodejs 平台，nodejs 就像是 JavaScript 抛弃 window,document 等这些 dom 对象后的东西的一个封装</p>\n<p>nodejs 下载地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ub2RlanMub3JnL2VuLw==\">https://nodejs.org/en/</span></p>\n<h5 id=\"nodejs安装\"><a class=\"markdownIt-Anchor\" href=\"#nodejs安装\">#</a> Node.js 安装：</h5>\n<p>​\t\t1 . 首先要查看本机是否已安装 nodeJs，打开命令提示符，输入 node&amp;node -v 查看。</p>\n<p>​\t\t2 . 打开 Node.js Setup 文件执行安装    选择安装路径，全部下一步。</p>\n<p>​\t\t3 . 安装完毕之后，重新打开一个命令提示符窗口，出入 node -v</p>\n<p>现在，我们来 Hello World 一下，开启命令行窗口，输入 node，进入 node 的命令行，我们可以输入 console.log (“hello world”)<img data-src=\"https://img2018.cnblogs.com/blog/1033563/201906/1033563-20190604153223076-1028024327.png\" alt=\"img\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">或者，我们可以创建一个web服务，进入node命令行后，输入</span><br><span class=\"line\">View Code</span><br><span class=\"line\">回车后，在浏览器输入：http<span class=\"punctuation\">:</span><span class=\"comment\">//localhost:8000就输出了hello world</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h3 id=\"npm\"><a class=\"markdownIt-Anchor\" href=\"#npm\">#</a> npm：</h3>\n<h5 id=\"npm安装\"><a class=\"markdownIt-Anchor\" href=\"#npm安装\">#</a> npm 安装：</h5>\n<p>Nodejs 下的包管理器。</p>\n<p>下载 Node 后自带一个旧版本的 npm。</p>\n<hr>\n<h3 id=\"cnpm\"><a class=\"markdownIt-Anchor\" href=\"#cnpm\">#</a> cnpm:</h3>\n<p>Nodejs 下的包管理器，国内淘宝镜像版本。</p>\n<h5 id=\"cnpm安装\"><a class=\"markdownIt-Anchor\" href=\"#cnpm安装\">#</a> cnpm 安装：</h5>\n<p>首先要有 node 环境和 npm 环境–</p>\n<p>1、安装 cnpm，输入以下命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n<p>如图所示：</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/img_convert/a5fada1c44e9cba82055d5c6db8ea69a.png\" alt=\"img\"></p>\n<p>2、输入 <code>cnpm -v</code>  ，检测是否正常</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/img_convert/374a7ba6c4e04cdb785a5dca12536ad1.png\" alt=\"img\"></p>\n<hr>\n<h3 id=\"webpack\"><a class=\"markdownIt-Anchor\" href=\"#webpack\">#</a> webpack:</h3>\n<p>它主要的用途是通过 CommonJS 的语法把所有浏览器端需要发布的静态资源做相应的准备，比如资源的合并和打包。</p>\n<h5 id=\"webpack安装\"><a class=\"markdownIt-Anchor\" href=\"#webpack安装\">#</a> webpack 安装：</h5>\n<p>首先需要安装好 nodeJs&amp;npm 的环境～</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node -v   <span class=\"comment\">// 查看node的版本 不能太高</span></span><br><span class=\"line\">npm -v   <span class=\"comment\">//查看npm的版本</span></span><br></pre></td></tr></table></figure>\n<p>全局安装:</p>\n<p>打开命令行（win+R    输入 cmd）</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180809221529512?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTMwOTgz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack webpack-cli -g --save-dev #输入并执行下载webpack </span><br><span class=\"line\">-g #全局安装 </span><br><span class=\"line\">--save-dev #信息写入package.json的devDependencies中</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://img-blog.csdn.net/20180809222148241?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTMwOTgz/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>下载好后在命令行执行 webpack -v 查看 webpack 的版本号，正常显示说明安装好了</p>\n<hr>\n<h3 id=\"yarn\"><a class=\"markdownIt-Anchor\" href=\"#yarn\">#</a> yarn：</h3>\n<p>​\t<strong>Yarn 是 facebook 发布的一款取代 npm 的包管理工具。</strong><br>\n​\tYarn 缓存了每个下载过的包，所以再次使用时无需重复下载。 同时利用并行下载以最大化资源利用率，因此安装速度更快，在执行代码之前，Yarn 会通过算法校验每个安装包的完整性，使用详细、简洁的锁文件格式和明确的安装算法，Yarn 能够保证在不同系统上无差异的工作。</p>\n<h5 id=\"yarn安装\"><a class=\"markdownIt-Anchor\" href=\"#yarn安装\">#</a> yarn 安装:</h5>\n<p>首先需要 node.js &amp; npm 环境<br>\n输入命令： npm install -g yarn<br>\n 查看版本：yarn -V &amp; --version</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Yarn 淘宝源安装，分别复制粘贴以下代码行到黑窗口运行即可</span><br><span class=\"line\">yarn config set registry https://registry.npm.taobao.org -g</span><br><span class=\"line\">yarn config set sass_binary_site http://cdn.npm.taobao.org/dist/node-sass -g</span><br></pre></td></tr></table></figure>\n<hr>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yarn的常用命令：</span><br><span class=\"line\">安装yarn：npm install -g yarn</span><br><span class=\"line\">安装成功后，查看版本号：yarn --version</span><br><span class=\"line\">创建文件夹 ：md yarn</span><br><span class=\"line\">进入yarn文件夹：cd yarn</span><br><span class=\"line\">初始化项目：yarn init <span class=\"comment\">// 同npm init，执行输入信息后，会生成package.json文件</span></span><br><span class=\"line\"></span><br><span class=\"line\">yarn的配置项：</span><br><span class=\"line\">yarn config list <span class=\"comment\">// 显示所有配置项</span></span><br><span class=\"line\">yarn config get &lt;key&gt; <span class=\"comment\">//显示某配置项</span></span><br><span class=\"line\">yarn config delete &lt;key&gt; <span class=\"comment\">//删除某配置项</span></span><br><span class=\"line\">yarn config set &lt;key&gt; &lt;value&gt; <span class=\"punctuation\">[</span>-g|--global<span class=\"punctuation\">]</span> <span class=\"comment\">//设置配置项</span></span><br><span class=\"line\"></span><br><span class=\"line\">安装包：</span><br><span class=\"line\">yarn install <span class=\"comment\">//安装package.json里所有包，并将包及它的所有依赖项保存进yarn.lock</span></span><br><span class=\"line\">yarn install --flat <span class=\"comment\">//安装一个包的单一版本</span></span><br><span class=\"line\">yarn install --force <span class=\"comment\">//强制重新下载所有包</span></span><br><span class=\"line\">yarn install --production <span class=\"comment\">//只安装dependencies里的包</span></span><br><span class=\"line\">yarn install --no-lockfile <span class=\"comment\">//不读取或生成yarn.lock</span></span><br><span class=\"line\">yarn install --pure-lockfile <span class=\"comment\">//不生成yarn.lock</span></span><br><span class=\"line\"></span><br><span class=\"line\">添加包（会更新package.json和yarn.lock）：</span><br><span class=\"line\">yarn add <span class=\"punctuation\">[</span>package<span class=\"punctuation\">]</span> <span class=\"comment\">// 在当前的项目中添加一个依赖包，会自动更新到package.json和yarn.lock文件中</span></span><br><span class=\"line\">yarn add <span class=\"punctuation\">[</span>package<span class=\"punctuation\">]</span>@<span class=\"punctuation\">[</span>version<span class=\"punctuation\">]</span> <span class=\"comment\">// 安装指定版本，这里指的是主要版本，如果需要精确到小版本，使用-E参数</span></span><br><span class=\"line\">yarn add <span class=\"punctuation\">[</span>package<span class=\"punctuation\">]</span>@<span class=\"punctuation\">[</span>tag<span class=\"punctuation\">]</span> <span class=\"comment\">// 安装某个tag（比如beta,next或者latest）</span></span><br><span class=\"line\"><span class=\"comment\">//不指定依赖类型默认安装到dependencies里，你也可以指定依赖类型：</span></span><br><span class=\"line\"></span><br><span class=\"line\">yarn add --dev/-D <span class=\"comment\">// 加到 devDependencies</span></span><br><span class=\"line\">yarn add --peer/-P <span class=\"comment\">// 加到 peerDependencies</span></span><br><span class=\"line\">yarn add --optional/-O <span class=\"comment\">// 加到 optionalDependencies</span></span><br><span class=\"line\"><span class=\"comment\">//默认安装包的主要版本里的最新版本，下面两个命令可以指定版本：</span></span><br><span class=\"line\"></span><br><span class=\"line\">yarn add --exact/-E <span class=\"comment\">// 安装包的精确版本。例如yarn add foo@1.2.3会接受1.9.1版，但是yarn add foo@1.2.3 --exact只会接受1.2.3版</span></span><br><span class=\"line\">yarn add --tilde/-T <span class=\"comment\">// 安装包的次要版本里的最新版。例如yarn add foo@1.2.3 --tilde会接受1.2.9，但不接受1.3.0</span></span><br><span class=\"line\"></span><br><span class=\"line\">发布包</span><br><span class=\"line\">yarn publish</span><br><span class=\"line\"></span><br><span class=\"line\">移除一个包</span><br><span class=\"line\">yarn remove &lt;packageName&gt;：移除一个包，会自动更新package.json和yarn.lock</span><br><span class=\"line\"></span><br><span class=\"line\">更新一个依赖</span><br><span class=\"line\">yarn upgrade 用于更新包到基于规范范围的最新版本</span><br><span class=\"line\"></span><br><span class=\"line\">运行脚本</span><br><span class=\"line\">yarn run 用来执行在 package.json 中 scripts 属性下定义的脚本</span><br><span class=\"line\"></span><br><span class=\"line\">显示某个包的信息</span><br><span class=\"line\">yarn info &lt;packageName&gt; 可以用来查看某个模块的最新版本信息</span><br><span class=\"line\"></span><br><span class=\"line\">缓存</span><br><span class=\"line\">yarn cache</span><br><span class=\"line\">yarn cache list # 列出已缓存的每个包 yarn cache dir # 返回 全局缓存位置 yarn cache clean # 清除缓存</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Nginx%E4%BB%A5%E5%8F%8Akeepalived%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/",
            "url": "http://example.com/2022/12/27/Nginx%E4%BB%A5%E5%8F%8Akeepalived%E5%AE%89%E8%A3%85%E4%BB%A5%E5%8F%8A%E9%83%A8%E7%BD%B2/",
            "title": "Nginx以及Keepalived安装以及部署",
            "date_published": "2022-12-27T08:18:48.602Z",
            "content_html": "<p>​\t\t反向代理：指的是用户要访问 youtube, 但是 youtube 悄悄地把这个请求交给后台 N 台服务器中的其中一台来做，这种方式就是反向代理了。</p>\n<p>​\t\t负载均衡：</p>\n<p>1) 使用硬件负载均衡策略，如使用 F5,Array 等负载均衡器.</p>\n<p>2) 使用软件进行负载均衡<br>\n 3) 如使用阿里云服务器均衡 SLB<br>\n4) 使用我们今天所学习的 Nginx+Keepalived<br>\n5) 其他软件负载均衡如 LVS (Linux Virtual Server),haproxy 等技术</p>\n<h3 id=\"环境搭建\"><a class=\"markdownIt-Anchor\" href=\"#环境搭建\">#</a> 环境搭建：</h3>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">步骤:</span><br><span class=\"line\"><span class=\"number\">1.</span>进行安装:tar -zxvf /root/software/nginx-<span class=\"number\">1.6</span><span class=\"number\">.2</span>.tar.gz -C /usr/local/</span><br><span class=\"line\"><span class=\"number\">2.</span>下载所需要的依赖库文件:</span><br><span class=\"line\">   yum install pcre -y</span><br><span class=\"line\">   yum install pcre-devel -y</span><br><span class=\"line\">   yum install zlib -y</span><br><span class=\"line\">   yum install zlib-devel -y</span><br><span class=\"line\"><span class=\"number\">3.</span>进行configure配置,查看是否报错</span><br><span class=\"line\">   cd nginx-<span class=\"number\">1.6</span><span class=\"number\">.2</span></span><br><span class=\"line\">   ./configure --prefix=/usr/local/nginx</span><br><span class=\"line\"><span class=\"number\">4.</span>编译安装:make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"number\">5.</span>在 /usr/local/nginx目录下,可以看到如下<span class=\"number\">4</span>个目录</span><br><span class=\"line\">   conf配置文件,html网页文件,logs日志文件,sbin主要二进制程序</span><br><span class=\"line\"><span class=\"number\">6.</span>启动命令:/usr/local/nginx/sbin/nginx</span><br><span class=\"line\">  关闭命令:/usr/local/nginx/sbin/nginx -s stop</span><br><span class=\"line\">  重启命令:/usr/local/nginx/sbin/nginx -s reload</span><br><span class=\"line\"><span class=\"number\">7.</span>访问浏览器:http:<span class=\"comment\">//192.168.122.133(看到欢迎页面说明没问题)</span></span><br><span class=\"line\"></span><br><span class=\"line\">注意:如果出现这个错误:./configure: error: C compiler cc is not found</span><br><span class=\"line\">执行这个命令:yum -y install gcc gcc-c++ autoconf automake make</span><br></pre></td></tr></table></figure>\n<p>Keepalived：</p>\n<p>首先介绍一下 Keepalived, 它是一个高性能的服务器高可用或热备解决方案，Keepalived 主要防止服务器单点故障的问题，可以通过其与 Nginx 的配合实现 web 服务器端的高可用.<br>\nKeepalived 以 VRRP 协议为实现基础，使用 VRRP 协议来实现高可用性 (HA).VRRP (Virtual Router Redundacy Protocol) 协议用于实现路由器冗余的协议，VRRP 协议将两台或多台路由器设备虚拟成一个设备，向外提供虚拟路由 IP (一个或多个)。</p>\n<p>安装以及部署：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一步：安装keepalived依赖的包</span><br><span class=\"line\">\tyum install -y gcc</span><br><span class=\"line\">    yum install -y openssl-devel</span><br><span class=\"line\">\tyum install -y libnl3-devel</span><br><span class=\"line\">\tyum install -y popt-devel</span><br><span class=\"line\">\tyum install -y iptables-devel</span><br><span class=\"line\">\tyum install -y libnfnetlink-devel</span><br><span class=\"line\">\tyum install -y psmisc</span><br><span class=\"line\">第二步：编译安装keepalived</span><br><span class=\"line\">\t将keepalived的安装包 上传到/usr/local/software 目录下  </span><br><span class=\"line\">\tcd /usr/local/software</span><br><span class=\"line\">\ttar -zxvf keepalived-<span class=\"number\">1.2</span><span class=\"number\">.19</span>.tar.gz -C /usr/local  </span><br><span class=\"line\">\tcd /usr/local/keepalived-<span class=\"number\">1.2</span><span class=\"number\">.19</span>  </span><br><span class=\"line\">\t./configure --prefix=/usr/local/keepalived  </span><br><span class=\"line\">\tmake &amp;&amp; make install </span><br><span class=\"line\">第三步：将 keepalived 安装成 Linux 系统服务</span><br><span class=\"line\">\t安装完成之后， 需要做一些工作复制默认配置文件到 默认路径  </span><br><span class=\"line\">\tmkdir /etc/keepalived  </span><br><span class=\"line\">\tcp /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/  </span><br><span class=\"line\">\tcp /usr/local/keepalived/sbin/keepalived /usr/sbin/  </span><br><span class=\"line\">\tcp /usr/local/keepalived/etc/sysconfig/keepalived /etc/sysconfig/  </span><br><span class=\"line\">\tcd /usr/local/keepalived-<span class=\"number\">1.2</span><span class=\"number\">.19</span>  </span><br><span class=\"line\">\tcp ./keepalived/etc/init.d/keepalived.init /etc/init.d/</span><br><span class=\"line\">\tchmod <span class=\"number\">755</span> /etc/init.d/keepalived.init </span><br><span class=\"line\">第四步：编写nginx检测脚本:</span><br><span class=\"line\">vi /etc/keepalived/nginx_check.sh</span><br><span class=\"line\">内容如下：  </span><br><span class=\"line\">#!/bin/bash  </span><br><span class=\"line\">A=`ps -C nginx –no-header |wc -l`  </span><br><span class=\"line\"><span class=\"keyword\">if</span> [ $A -eq <span class=\"number\">0</span> ];then  </span><br><span class=\"line\">    /usr/local/nginx/sbin/nginx  </span><br><span class=\"line\">    sleep <span class=\"number\">2</span>  </span><br><span class=\"line\">    <span class=\"keyword\">if</span> [ `ps -C nginx --no-header |wc -l` -eq <span class=\"number\">0</span> ];then  </span><br><span class=\"line\">        killall keepalived  </span><br><span class=\"line\">    fi  </span><br><span class=\"line\">fi  </span><br><span class=\"line\">赋予执行权限  </span><br><span class=\"line\">chmod +x /etc/keepalived/nginx_check.sh </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">启动命令:</span><br><span class=\"line\">  keepalived</span><br></pre></td></tr></table></figure>\n<p>修改 Master 配置</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改keepalived的Master配置文件:vi /etc/keepalived/keepalived.conf </span><br><span class=\"line\">! Configuration File <span class=\"keyword\">for</span> keepalived       </span><br><span class=\"line\">global_defs &#123;      </span><br><span class=\"line\">   router_id wolfcode                           ##路由器标志    </span><br><span class=\"line\">&#125;    </span><br><span class=\"line\"># 集群资源监控，组合track_script进行    </span><br><span class=\"line\">vrrp_script check_haproxy &#123;    </span><br><span class=\"line\">\tscript <span class=\"string\">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #检测 nginx 状态的脚本路径  </span><br><span class=\"line\">\tinterval <span class=\"number\">2</span>  #检测时间间隔  </span><br><span class=\"line\">\tweight -<span class=\"number\">20</span>  #条件成立 权重减<span class=\"number\">20</span>  </span><br><span class=\"line\">&#125;    </span><br><span class=\"line\">vrrp_instance PROXY &#123;    </span><br><span class=\"line\">\t# 设置当前主机为主节点，如果是备用节点，则设置为BACKUP   </span><br><span class=\"line\">\tstate MASTER</span><br><span class=\"line\">\t# 指定HA监测网络接口，可以用ifconfig查看来决定设置哪一个    </span><br><span class=\"line\">\t<span class=\"keyword\">interface</span> <span class=\"title class_\">ens32</span></span><br><span class=\"line\">\t# 虚拟路由标识，同一个VRRP实例要使用同一个标识，主备机    </span><br><span class=\"line\">\tvirtual_router_id <span class=\"number\">80</span>    </span><br><span class=\"line\">\t# 因为当前环境中VRRP组播有问题，改为使用单播发送VRRP报文  如果VRRP组播没问题，以下这块的内容可以注释掉。  </span><br><span class=\"line\">\t# 这个地方需要关注，之前未做此设置，结果主备节点互相不能发现，因此主备节点都升级成了MASTER，并且绑定了VIP    </span><br><span class=\"line\">\t# 主节点时，内容为：    </span><br><span class=\"line\">\tunicast_src_ip <span class=\"number\">192.168</span><span class=\"number\">.122</span><span class=\"number\">.133</span></span><br><span class=\"line\">\t# 设置优先级，确保主节点的优先级高过备用节点  </span><br><span class=\"line\">\tpriority <span class=\"number\">100</span>    </span><br><span class=\"line\">\t# 用于设定主备节点间同步检查时间间隔    </span><br><span class=\"line\">\tadvert_int <span class=\"number\">2</span>    </span><br><span class=\"line\">\t# 设置主备节点间的通信验证类型及密码，同一个VRRP实例中需一致    </span><br><span class=\"line\">\tauthentication &#123;    </span><br><span class=\"line\">\t\tauth_type PASS    </span><br><span class=\"line\">\t\tauth_pass wolfcode</span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">\t# 集群资源监控，组合vrrp_script进行    </span><br><span class=\"line\">\ttrack_script &#123;    </span><br><span class=\"line\">\t\tcheck_haproxy    </span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">\t# 设置虚拟IP地址，当keepalived状态切换为MASTER时，此IP会自动添加到系统中    </span><br><span class=\"line\">\t# 当状态切换到BACKUP时，此IP会自动从系统中删除    </span><br><span class=\"line\">\t# 可以通过命令ip add查看切换后的状态    </span><br><span class=\"line\">\tvirtual_ipaddress &#123;    </span><br><span class=\"line\">\t\t<span class=\"number\">192.168</span><span class=\"number\">.122</span><span class=\"number\">.110</span>  #虚拟ip配置完之后就用它访问    </span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>\n<p>修改 Slave 配置：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">修改keepalived的Slave配置文件:vi /etc/keepalived/keepalived.conf </span><br><span class=\"line\">! Configuration File <span class=\"keyword\">for</span> keepalived       </span><br><span class=\"line\">global_defs &#123;      </span><br><span class=\"line\">   router_id wolfcode                           ##路由器标志    </span><br><span class=\"line\">&#125;    </span><br><span class=\"line\"># 集群资源监控，组合track_script进行    </span><br><span class=\"line\">vrrp_script check_haproxy &#123;    </span><br><span class=\"line\">\tscript <span class=\"string\">&quot;/etc/keepalived/nginx_check.sh&quot;</span>  #检测 nginx 状态的脚本路径  </span><br><span class=\"line\">\tinterval <span class=\"number\">2</span>  #检测时间间隔  </span><br><span class=\"line\">\tweight -<span class=\"number\">20</span>  #条件成立 权重减<span class=\"number\">20</span>  </span><br><span class=\"line\">&#125;    </span><br><span class=\"line\">vrrp_instance PROXY &#123;    </span><br><span class=\"line\">\t# 设置当前主机为主节点，如果是备用节点，则设置为BACKUP   </span><br><span class=\"line\">\tstate BACKUP</span><br><span class=\"line\">\t# 指定HA监测网络接口，可以用ifconfig查看来决定设置哪一个    </span><br><span class=\"line\">\t<span class=\"keyword\">interface</span> <span class=\"title class_\">ens32</span></span><br><span class=\"line\">\t# 虚拟路由标识，同一个VRRP实例要使用同一个标识，主备机    </span><br><span class=\"line\">\tvirtual_router_id <span class=\"number\">80</span>    </span><br><span class=\"line\">\t# 因为当前环境中VRRP组播有问题，改为使用单播发送VRRP报文  如果VRRP组播没问题，以下这块的内容可以注释掉。  </span><br><span class=\"line\">\t# 这个地方需要关注，之前未做此设置，结果主备节点互相不能发现，因此主备节点都升级成了MASTER，并且绑定了VIP    </span><br><span class=\"line\">\t# 主节点时，内容为：    </span><br><span class=\"line\">\tunicast_src_ip <span class=\"number\">192.168</span><span class=\"number\">.122</span><span class=\"number\">.134</span>  </span><br><span class=\"line\">\t# 设置优先级，确保主节点的优先级高过备用节点  </span><br><span class=\"line\">\tpriority <span class=\"number\">90</span>    </span><br><span class=\"line\">\t# 用于设定主备节点间同步检查时间间隔    </span><br><span class=\"line\">\tadvert_int <span class=\"number\">2</span>    </span><br><span class=\"line\">\t# 设置主备节点间的通信验证类型及密码，同一个VRRP实例中需一致    </span><br><span class=\"line\">\tauthentication &#123;    </span><br><span class=\"line\">\t\tauth_type PASS    </span><br><span class=\"line\">\t\tauth_pass wolfcode</span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">\t# 集群资源监控，组合vrrp_script进行    </span><br><span class=\"line\">\ttrack_script &#123;    </span><br><span class=\"line\">\t\tcheck_haproxy    </span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">\t# 设置虚拟IP地址，当keepalived状态切换为MASTER时，此IP会自动添加到系统中    </span><br><span class=\"line\">\t# 当状态切换到BACKUP时，此IP会自动从系统中删除    </span><br><span class=\"line\">\t# 可以通过命令ip add查看切换后的状态    </span><br><span class=\"line\">\tvirtual_ipaddress &#123;    </span><br><span class=\"line\">\t\t<span class=\"number\">192.168</span><span class=\"number\">.122</span><span class=\"number\">.110</span>  #虚拟ip配置完之后就用它访问    </span><br><span class=\"line\">\t&#125;    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Mysql%E6%9F%A5%E8%AF%A2%E6%8A%80%E5%B7%A7/",
            "url": "http://example.com/2022/12/27/Mysql%E6%9F%A5%E8%AF%A2%E6%8A%80%E5%B7%A7/",
            "title": "mysql查询技巧",
            "date_published": "2022-12-27T08:18:48.600Z",
            "content_html": "<h1 id=\"mysql-查询当天-昨天-本周-上周-本月-上月-今年-去年数据\"><a class=\"markdownIt-Anchor\" href=\"#mysql-查询当天-昨天-本周-上周-本月-上月-今年-去年数据\">#</a> mysql 查询当天、昨天、本周、上周、本月、上月、今年、去年数据</h1>\n<h2 id=\"mysql查询今天-昨天-7天-近30天-本月-上一月-数据\"><a class=\"markdownIt-Anchor\" href=\"#mysql查询今天-昨天-7天-近30天-本月-上一月-数据\">#</a> mysql 查询今天、昨天、7 天、近 30 天、本月、上一月 数据</h2>\n<p>今天\tselect * from 表名 where to_days (时间字段名) = to_days (now ());</p>\n<p>昨天\tSELECT * FROM 表名 WHERE TO_DAYS (NOW () ) - TO_DAYS ( 时间字段名) = 1</p>\n<p>近 7 天\tSELECT * FROM 表名 where DATE_SUB (CURDATE (), INTERVAL 7 DAY) &lt;= date (时间字段名)</p>\n<p>查询当前这周的数据<br>\n SELECT name,submittime FROM enterprise WHERE YEARWEEK (date_format (submittime,’% Y-% m-% d’)) = YEARWEEK (now ());</p>\n<p>查询上周的数据<br>\n SELECT name,submittime FROM enterprise WHERE YEARWEEK (date_format (submittime,’% Y-% m-% d’)) = YEARWEEK (now ())-1;</p>\n<p>近 30 天\tSELECT * FROM 表名 where DATE_SUB (CURDATE (), INTERVAL 30 DAY) &lt;= date (时间字段名) 本月 SELECT * FROM 表名 WHERE DATE_FORMAT ( 时间字段名，‘% Y% m’ ) = DATE_FORMAT ( CURDATE ( ) , ‘% Y% m’ )</p>\n<p>上一月\tSELECT * FROM 表名 WHERE PERIOD_DIFF (date_format ( now () , ‘% Y% m’ ) , date_format ( 时间字段名，‘% Y% m’ ) ) =1</p>\n<p>查询距离当前现在 6 个月的数据<br>\n select name,submittime from enterprise where submittime between date_sub (now (),interval 6 month) and now (); #查询本季度数据\tselect * from  <code>ht_invoice_information</code>  where QUARTER(create_date)=QUARTER(now());</p>\n<p>查询上季度数据\tselect * from  <code>ht_invoice_information</code>  where QUARTER(create_date)=QUARTER(DATE_SUB(now(),interval 1 QUARTER));</p>\n<p>查询本年数据\tselect * from  <code>ht_invoice_information</code>  where YEAR(create_date)=YEAR(NOW());</p>\n<p>查询上年数据\tselect * from  <code>ht_invoice_information</code>  where year(create_date)=year(date_sub(now(),interval 1 year));</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/MySQL%E5%AE%89%E8%A3%85%20starting%20the%20server%E5%A4%B1%E8%B4%A5%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/",
            "url": "http://example.com/2022/12/27/MySQL%E5%AE%89%E8%A3%85%20starting%20the%20server%E5%A4%B1%E8%B4%A5%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/",
            "title": "MySQL安装 starting the server失败的解决办法",
            "date_published": "2022-12-27T08:18:48.598Z",
            "content_html": "<h3 id=\"mysql安装-starting-the-server失败的解决办法\"><a class=\"markdownIt-Anchor\" href=\"#mysql安装-starting-the-server失败的解决办法\">#</a> MySQL 安装 starting the server 失败的解决办法</h3>\n<p>​\t\t如果电脑是第一次安装 MySQL，一般不会出现这样的报错。如下图所示。starting the server 失败，通常是因为上次安装的该软件未清除干净。</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20190807043159195.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></p>\n<p><strong>完全卸载该软件的办法</strong>：</p>\n<p>第一步，进入… 控制面板 \\ 程序 \\ 程序和功能，卸载下图中的 MySQL 两个软件。</p>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20190807043419726.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"><br>\n第二步，删除上次安装目录的 MySQL 残留文件，更不要忘了删除 ProgramData 下的 MySQL 文件夹，如下图所示。注意：这里的文件夹与上次安装目录里的残留文件不同，C:\\ProgramData 一般默认是隐藏的。<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20190807043522439.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"><br>\n第三步，Win+R 输入 regedit 运行，进入注册表编辑器，按下图路径，找到 MySQL，进而删除 MySQL 注册表信息。<br>\n<img data-src=\"https://img-blog.csdnimg.cn/20190807043623577.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"><br>\n第四步，做完前三步，打开服务，会发现 MySQL57 服务依然存在，如下图所示。这就是导致安装失败的重要原因，所以需要删除 MySQL57 服务。方法：以管理员的权限运行 dos 命令，然后输入 sc delete MySQL57 。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">C</span>:\\<span class=\"title class_\">Windows</span>\\system32&gt;sc <span class=\"keyword\">delete</span> <span class=\"title class_\">MySQL57</span></span><br><span class=\"line\">[<span class=\"variable constant_\">SC</span>] <span class=\"title class_\">DeleteService</span> 成功</span><br><span class=\"line\"><span class=\"number\">12</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://img-blog.csdnimg.cn/20190807043734156.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWFuZ2c1NQ==,size_16,color_FFFFFF,t_70\" alt=\"在这里插入图片描述\"></p>\n<p>现在就可以轻松的安装上 MySQL 软件了！</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Mysql%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Mysql%E4%B8%BB%E4%BB%8E%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%96%87%E6%A1%A3/",
            "title": "Mysql主从集群搭建文档，实现读写分离",
            "date_published": "2022-12-27T08:18:48.595Z",
            "content_html": "<h2 id=\"mysql主从集群搭建文档实现读写分离\"><a class=\"markdownIt-Anchor\" href=\"#mysql主从集群搭建文档实现读写分离\">#</a> Mysql 主从集群搭建文档，实现读写分离</h2>\n<p>​\t\t最近在自己写的项目中需要应对大量的用户查询读写操作，一台服务器当然是不够的，所以在边学边敲的背景下，记录这篇笔记，从 0 开始搭建主从集群。</p>\n<h4 id=\"下面开始操作\"><a class=\"markdownIt-Anchor\" href=\"#下面开始操作\">#</a> 下面👇开始操作：</h4>\n<p>1. 分别在两台服务器搭建 mysql 服务</p>\n<p>​\t\t两台服务器的 IP 地址分别为主服务器（192.168.20.1）和从服务器（192.168.20.2）。<br>\n2. 配置文件 my.cnf 的修改</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">根据上一篇文章，编辑my.cnf文件</span></span><br><span class=\"line\">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class=\"line\"><span class=\"meta prompt_\"> </span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">在[mysqld]中添加：</span></span><br><span class=\"line\">server-id=1</span><br><span class=\"line\">log_bin=master-bin</span><br><span class=\"line\">log_bin_index=master-bin.index</span><br><span class=\"line\">binlog_do_db=test</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">备注：</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">server-id 服务器唯一标识。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">log_bin 启动MySQL二进制日志，即数据同步语句，从数据库会一条一条的执行这些语句。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">binlog_do_db 指定记录二进制日志的数据库，即需要复制的数据库名，如果复制多个数据库，重复设置这个选项即可。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">binlog_ignore_db 指定不记录二进制日志的数据库，即不需要复制的数据库名，如果有多个数据库，重复设置这个选项即可。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">其中需要注意的是，binlog_do_db和binlog_ignore_db为互斥选项，一般只需要一个即可。</span></span><br></pre></td></tr></table></figure>\n<p>3. 创建从服务器的用户和权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">进入mysql数据库</span></span><br><span class=\"line\">[root@localhost mysql]# mysql -uroot -p</span><br><span class=\"line\">Enter password:</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">创建从数据库的root用户和权限</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">grant replication slave on *.* to root@<span class=\"string\">&#x27;192.168.20.%&#x27;</span> identified by <span class=\"string\">&#x27;Lgq081538&#x27;</span>;</span></span><br><span class=\"line\"></span><br><span class=\"line\">grant replication slave on *.* to &#x27;123456&#x27;</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">备注</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">192.168.20.%通配符，表示0-255的IP都可访问主服务器，正式环境请配置指定从服务器IP</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">若将 192.168.20.% 改为 %，则任何ip均可作为其从数据库来访问主服务器</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">退出mysql</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\"><span class=\"built_in\">exit</span>;</span></span><br></pre></td></tr></table></figure>\n<p>4. 重启 mysql 服务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost mysql]# service mysql restart</span><br><span class=\"line\">Shutting down MySQL.... SUCCESS! </span><br><span class=\"line\">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>\n<p>5. 查看主服务器状态</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">进入mysql数据库</span></span><br><span class=\"line\">[root@localhost mysql]# mysql -uroot -p</span><br><span class=\"line\">Enter password:</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">查看主服务器状态</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">show master status;</span></span><br><span class=\"line\">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">| File              | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class=\"line\">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">| master-bin.000001 |      154 | test         |                  |                   |</span><br><span class=\"line\">+-------------------+----------+--------------+------------------+-------------------+</span><br><span class=\"line\">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>\n<p>6.slave 从服务器的配置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">配置文件my.cnf的修改</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">根据上一篇文章，编辑my.cnf文件</span></span><br><span class=\"line\">[root@localhost mysql]# vim /etc/my.cnf</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">在[mysqld]中添加：</span></span><br><span class=\"line\">server-id=2</span><br><span class=\"line\">relay-log=slave-relay-bin</span><br><span class=\"line\">relay-log-index=slave-relay-bin.index</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">replicate-do-db=<span class=\"built_in\">test</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">备注：</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">server-id 服务器唯一标识，如果有多个从服务器，每个服务器的server-id不能重复，跟IP一样是唯一标识，如果你没设置server-id或者设置为0，则从服务器不会连接到主服务器。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">relay-log 启动MySQL二进制日志，可以用来做数据备份和崩溃恢复，或主服务器挂掉了，将此从服务器作为其他从服务器的主服务器。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">replicate-do-db 指定同步的数据库，如果复制多个数据库，重复设置这个选项即可。若在master端不指定binlog-do-db，则在slave端可用replication-do-db来过滤。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">replicate-ignore-db 不需要同步的数据库，如果有多个数据库，重复设置这个选项即可。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">其中需要注意的是，replicate-do-db和replicate-ignore-db为互斥选项，一般只需要一个即可。</span></span><br></pre></td></tr></table></figure>\n<p>7. 重启 mysql 服务</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost mysql]# service mysql restart</span><br><span class=\"line\">Shutting down MySQL.... SUCCESS! </span><br><span class=\"line\">Starting MySQL. SUCCESS! </span><br></pre></td></tr></table></figure>\n<p>8. 连接 master 主服务器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">进入mysql数据库</span></span><br><span class=\"line\">[root@localhost mysql]# mysql -uroot -p</span><br><span class=\"line\">Enter password:</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">连接master主服务器</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">change master to master_host=<span class=\"string\">&#x27;192.168.20.1&#x27;</span>,master_port=3306,master_user=<span class=\"string\">&#x27;root&#x27;</span>,master_password=<span class=\"string\">&#x27;123456&#x27;</span>,master_log_file=<span class=\"string\">&#x27;master-bin.000009&#x27;</span>,master_log_pos=473127;</span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">备注：</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">master_host对应主服务器的IP地址。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">master_port对应主服务器的端口。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">master_log_file对应show master status显示的File列：master-bin.000001。</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">master_log_pos对应show master status显示的Position列：154。</span></span><br></pre></td></tr></table></figure>\n<p>9. 启动 slave 数据同步</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">启动slave数据同步</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">start slave;</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">停止slave数据同步（若有需要）</span></span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">stop slave;</span></span><br><span class=\"line\">3.5 查看slave信息</span><br><span class=\"line\"><span class=\"meta prompt_\">mysql&gt; </span><span class=\"language-bash\">show slave status\\G;</span></span><br><span class=\"line\">Slave_IO_Running和Slave_SQL_Running都为yes，则表示同步成功。</span><br></pre></td></tr></table></figure>\n<p>10. 测试</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">（1）在主服务器上登陆mysql，且进入test数据库，创建test表，且插入一条数据</span><br><span class=\"line\">提示：这里最好用数据库管理工具（如nacicat）来操作。</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">创建tb_test表</span></span><br><span class=\"line\">create table tb_test(ID varchar(36) primary key comment &#x27;主键ID&#x27;,MEMO varchar(500) not null comment &#x27;信息&#x27;);</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">插入一条数据</span></span><br><span class=\"line\">insert into tb_test(ID,MEMO) values(&#x27;1&#x27;,&#x27;one test&#x27;);</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">提交</span></span><br><span class=\"line\">commit;</span><br><span class=\"line\">（2）在从服务器上登陆mysql，且进入test数据库</span><br><span class=\"line\">你会发现从数据库中，也出现了tb_test表，且表中还有one test数据存在，证明同步数据成功。</span><br></pre></td></tr></table></figure>\n<h3 id=\"至此mysql主从读写分离搭建完成\"><a class=\"markdownIt-Anchor\" href=\"#至此mysql主从读写分离搭建完成\">#</a> 至此 Mysql 主从读写分离搭建完成</h3>\n<p>下面开始搭建 Spring Boot 项目中的相关配置以及实现👇</p>\n<p>​\t\t读写分离要做的事情就是对于一条 SQL 该选择哪个数据库去执行，至于谁来做选择数据库这件事，主要有两种实现方式，分别为：<br>\n1. 使用中间件，比如 Atlas，cobar，TDDL，mycat，heisenberg，Oceanus，vitess，OneProxy 等<br>\n 2. 使用程序自己实现，利用 Spring Boot 提供的路由数据源以及 AOP，实现起来简单快捷<br>\n​</p>\n<p>​\t\t我们使用第二种方式 Spring Boot 数据源路由 + AOP ，这样能更好的控制流程，也便于后期提升性能；</p>\n<p>代码实现<br>\n 1. 首先配置下 pom.<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT14bWwmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\">xml</span> 因为我们使用 aop 实现，所以需要 aop 依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-aop<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>2. 数据源路由类功能 RoutingDataSource.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 数据源路由类功能</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RoutingDataSource</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">AbstractRoutingDataSource</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Object <span class=\"title function_\">determineCurrentLookupKey</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DBContext.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>3. 数据源上下文类 DBContext.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 数据源上下文类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Slf4j</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DBContext</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> ThreadLocal&lt;DBTypeEnum&gt; dbContext = <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadLocal</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">AtomicInteger</span> <span class=\"variable\">counter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicInteger</span>(-<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">set</span><span class=\"params\">(DBTypeEnum dbType)</span> &#123;</span><br><span class=\"line\">        dbContext.set(dbType);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> DBTypeEnum <span class=\"title function_\">get</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> dbContext.get();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">master</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        set(DBTypeEnum.MASTER);</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;切换到master库&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">slave</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//  读库负载均衡(轮询方式)</span></span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> counter.getAndIncrement() % <span class=\"number\">2</span>;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;slave库访问线程数==&gt;&#123;&#125;&quot;</span>, counter.get());</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (index == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            set(DBTypeEnum.SLAVE1);</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;切换到slave1库&quot;</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            set(DBTypeEnum.SLAVE2);</span><br><span class=\"line\">            log.info(<span class=\"string\">&quot;切换到slave2库&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4. 数据库枚举类 DBTypeEnum.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.demo.databases;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 数据库枚举类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">DBTypeEnum</span> &#123;</span><br><span class=\"line\">    MASTER, <span class=\"comment\">//主库</span></span><br><span class=\"line\">    SLAVE1, <span class=\"comment\">//从库1</span></span><br><span class=\"line\">    SLAVE2  <span class=\"comment\">//从库2</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这里我们配置三个库，分别是一个写库 Master，2 个读库 slave1,slave2</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.jdbc.DataSourceBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Configuration;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.sql.DataSource;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 数据库配置类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DataSourceConfigs</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(&quot;spring.datasource.master&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">masterDataSource</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DataSourceBuilder.create().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(&quot;spring.datasource.slave1&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">slave1DataSource</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DataSourceBuilder.create().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@ConfigurationProperties(&quot;spring.datasource.slave2&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">slave2DataSource</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> DataSourceBuilder.create().build();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> DataSource <span class=\"title function_\">myRoutingDataSource</span><span class=\"params\">(<span class=\"meta\">@Qualifier(&quot;masterDataSource&quot;)</span> DataSource masterDataSource,</span></span><br><span class=\"line\"><span class=\"params\">                                          <span class=\"meta\">@Qualifier(&quot;slave1DataSource&quot;)</span> DataSource slave1DataSource,</span></span><br><span class=\"line\"><span class=\"params\">                                          <span class=\"meta\">@Qualifier(&quot;slave2DataSource&quot;)</span> DataSource slave2DataSource)</span> &#123;</span><br><span class=\"line\">        Map&lt;Object, Object&gt; targetDataSources = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        targetDataSources.put(DBTypeEnum.MASTER, masterDataSource);</span><br><span class=\"line\">        targetDataSources.put(DBTypeEnum.SLAVE1, slave1DataSource);</span><br><span class=\"line\">        targetDataSources.put(DBTypeEnum.SLAVE2, slave2DataSource);</span><br><span class=\"line\">        <span class=\"type\">RoutingDataSource</span> <span class=\"variable\">routingDataSource</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RoutingDataSource</span>();</span><br><span class=\"line\">        routingDataSource.setDefaultTargetDataSource(masterDataSource);</span><br><span class=\"line\">        routingDataSource.setTargetDataSources(targetDataSources);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> routingDataSource;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>6. 切面类 DataSourceAop.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Before;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 切面类DataSourceAop</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DataSourceAop</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.insert*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.create*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.save*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.add*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.update*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.edit*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.delete*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.remove*(..))&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">writePointcut</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Pointcut(&quot;!@annotation(com.example.demo.databases.Master) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;&amp;&amp; (execution(* com.example.demo.*.service..*.select*(..)) &quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.list*(..))&quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.count*(..))&quot; +</span></span><br><span class=\"line\"><span class=\"meta\">            &quot;|| execution(* com.example.demo.*.service..*.get*(..)))&quot;</span></span><br><span class=\"line\"><span class=\"meta\"></span></span><br><span class=\"line\"><span class=\"meta\">    )</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">readPointcut</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;writePointcut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">write</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        DBContext.master();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Before(&quot;readPointcut()&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">read</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        DBContext.slave();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>7. 注解类 Master.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.example.demo.databases;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@Auther</span>: Brath</span></span><br><span class=\"line\"><span class=\"comment\"> * Create By Administrator on 2022/6/24 12:05</span></span><br><span class=\"line\"><span class=\"comment\"> * Strive to create higher performance code</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> wechat: 17604868415</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> QQ: 2634490675</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@My</span> email 1: email_ guoqing@163.com</span></span><br><span class=\"line\"><span class=\"comment\"> * 注解类Master 主库，可读写</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Master &#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Mysql8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/",
            "url": "http://example.com/2022/12/27/Mysql8%E5%AE%89%E8%A3%85%E6%95%99%E7%A8%8B/",
            "title": "MySQL8下载与安装教程",
            "date_published": "2022-12-27T08:18:48.593Z",
            "content_html": "<h1 id=\"mysql下载与安装8020版教程\"><a class=\"markdownIt-Anchor\" href=\"#mysql下载与安装8020版教程\">#</a> MySQL 下载与安装（8.0.20 版）教程</h1>\n<p>MySQL 官网：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXYubXlzcWwuY29tL2Rvd25sb2Fkcy9teXNxbC8=\">链接</span></p>\n<p>直接点击链接也可以下载：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamI1MS5uZXQvc29mdHMvNjA5MTAxLmh0bWw=\">mysql 8.0.20</span></p>\n<p>登录官网后如下图下载 MySQL 软件：</p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/2036459-20200521220018274-67173082.png\" alt=\"MySQL下载与安装\"></p>\n<p>点击 1 和 2 后进入下图页面：</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220029745-1322700384.png\" alt=\"MySQL下载与安装\"></p>\n<p>再点击 MySQL Community Server 进入下图下载页面：</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220041569-1305043095.png\" alt=\"MySQL下载与安装\"></p>\n<p>根据上图选择好 1 处后点击 2 处进入 Windows 安装包的下载页面 (如下图):</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220158844-1266620614.png\" alt=\"mysql80.20安装教程\"></p>\n<p>上图中有两个下载包，一个是安装引导包，一个是压缩安装包，我们选择第二个。点击 Download 进入下图页面。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220326093-1181789318.png\" alt=\"mysql80.20安装教程\"></p>\n<p>我们不登陆下载，所以直接点击红框按钮进行下载。这样我们就把软件下载下来了。</p>\n<p><strong>安装：</strong></p>\n<p>双击上面下载的软件，打开下图页面。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220337052-1815726332.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Next, 转到下图页面。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220348558-1991987874.png\" alt=\"mysql80.20安装教程\"></p>\n<p>如果大红框上面有些没有安装的软件会出现这里，可以点击 Next 左边的 Excute 按钮安装，安装完成之后点击 Next 按钮，会出现个弹框，如下图。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220400913-2029518725.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Yes。弹出下图页面。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220415332-220059202.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Execute 进行安装。等待所有安装完成。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220425391-1135522490.png\" alt=\"mysql80.20安装教程\"></p>\n<p>至少保证红杠处的 3 项安装成功，假若有安装失败的可以卸载重新安装。安装成功后我们点击 Next。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220438215-1446733656.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220449513-157912578.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360113.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360114.png\" alt=\"img\"></p>\n<p>在红框里输入账号和密码，账号密码必须大于或等于 4 个字符，点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360115.png\" alt=\"img\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360116.png\" alt=\"img\"></p>\n<p>点击 Excute。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360117.png\" alt=\"img\"></p>\n<p>点击 Finish。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360118.png\" alt=\"img\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360119.png\" alt=\"img\"></p>\n<p>点击 Finish。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360120.png\" alt=\"img\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360121.png\" alt=\"img\"></p>\n<p>输入密码后点击 Check, 再点击 Next。</p>\n<p><img data-src=\"https://img.jbzj.com/file_images/article/202005/2020051108360122.png\" alt=\"img\"></p>\n<p>点击 Execute。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220545404-521370663.png\" alt=\"img\"></p>\n<p>点击 Finish。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220534248-896731311.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Next。</p>\n<p><img data-src=\"https://img2020.cnblogs.com/blog/2036459/202005/2036459-20200521220522143-393956818.png\" alt=\"mysql80.20安装教程\"></p>\n<p>点击 Finish。</p>\n<p>到此位置 MySQL 就安装完成了。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/MVN%E5%BC%95%E5%85%A5Jar%E5%8C%85%E6%B5%81%E7%A8%8B/",
            "url": "http://example.com/2022/12/27/MVN%E5%BC%95%E5%85%A5Jar%E5%8C%85%E6%B5%81%E7%A8%8B/",
            "title": "Maven通过命令提示符引入jar包的流程",
            "date_published": "2022-12-27T08:18:48.591Z",
            "content_html": "<p>安装好 Maven 之后配置环境变量：</p>\n<p>​\t\t在系统变量新建 “MAVEN_HOME” 值为：Maven 的安装路径：<strong>E:\\Maven\\apache-maven-3.5.3</strong>，接着在 Path 变量中，添加：% MAVEN_HOME%\\bin，指定 maven 的 bin 路径。</p>\n<p>​\t\t现在在 CMD 中就可以用 mvn -v 的命令查看是否安装成功：</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5Cmaven%E7%8E%AF%E5%A2%83.png\" alt=\"maven环境\"></p>\n<h3 id=\"引入流程\"><a class=\"markdownIt-Anchor\" href=\"#引入流程\">#</a> 引入流程：</h3>\n<p>​\t\t接下来找到你要引入的 jar 包的根路径，指定路径 + jar 包名，指定 groupId、artifactId、version 名，就可以引入了。</p>\n<h4 id=\"举例\"><a class=\"markdownIt-Anchor\" href=\"#举例\">#</a> 举例:</h4>\n<p>​\t\tmvn install:install-file -Dfile=D:\\jar\\WxQyhPrj\\0.0.1-SNAPSHOT\\WxQyhPrj-0.0.1-SNAPSHOT.jar -DgroupId=com.chis.wx -DartifactId=WxQyhPrj -Dversion=0.0.1-SNAPSHOT -Dpackaging=jar</p>\n<p>​\t\tmvn install:install-file -Dfile：Jar 包的绝对路径</p>\n<p>​\t\t-DgroupId：Jar 包的 groupId 分组 id</p>\n<p>​\t\t-DartiactId：Jar 包的 artifactId 版本 id</p>\n<p>​\t\t-Dversion：Jar 包的 version 版本</p>\n<p>其中<br>\n– DgroupId 和 DartifactId 构成了该 jar 包在 pom.xml 的坐标， 对应依赖的 DgroupId 和 DartifactId</p>\n<p>– Dfile 表示需要上传的 jar 包的绝对路径</p>\n<p>– Dpackaging 为安装文件的种类</p>\n<p>– DgroupId 和 DartifactId 构成了该 jar 包在 pom.xml 的坐标， 对应依赖的 DgroupId 和 DartifactId</p>\n<p>– Dfile 表示需要上传的 jar 包的绝对路径</p>\n<p>– Durl 私服上仓库的 url 精确地址 (打开 nexus 左侧 repositories 菜单，可以看到该路径)</p>\n<p>– DrepositoryId 服务器的表示 id，在 nexus 的 configuration 可以看到</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Maven%E5%8A%A0%E5%BC%BA%E7%89%88%20%E2%80%94%20mvnd%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Maven%E5%8A%A0%E5%BC%BA%E7%89%88%20%E2%80%94%20mvnd%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/",
            "title": "Maven加强版 — mvnd的使用测试",
            "date_published": "2022-12-27T08:18:48.588Z",
            "content_html": "<h1 id=\"maven加强版-mvnd的使用测试\"><a class=\"markdownIt-Anchor\" href=\"#maven加强版-mvnd的使用测试\">#</a> Maven 加强版 — mvnd 的使用测试</h1>\n<p>Maven、gradle 作为主流的构建工具，几乎所有的 Java 项目都使用，但是 Maven 相对 gradle 来说，构建还是太慢了。特别是构建十几个子项目的程序。</p>\n<p>如果要把项目从 Maven 转换成 gradle，成本也是巨大的。</p>\n<p>但是现在有了 maven-mvnd ，可以使构建变得更快。</p>\n<h2 id=\"1-maven-mvnd介绍\"><a class=\"markdownIt-Anchor\" href=\"#1-maven-mvnd介绍\">#</a> <strong>1、maven-mvnd 介绍</strong></h2>\n<p><code>maven-mvnd</code>  是 <code>Apache Maven团队</code> 借鉴了 <code>Gradle</code>  和 <code>Takari</code>  的优点，衍生出来的更快的构建工具，是 maven 的 <code>强化版</code> 。</p>\n<p>github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9naXRodWIuY29tL2FwYWNoZS9tYXZlbi1tdm5k\">https://github.com/apache/maven-mvnd</span></p>\n<p>maven-mvnd 特性：</p>\n<ul>\n<li>嵌入 Maven (所以不需要单独安装 Maven)； <code>maven 过渡到 maven-mvnd</code>  的过程中实现  <code>无缝切换</code> ！所以不需要再安装 maven 或进行复杂的配置更改。</li>\n<li>实际的构建发生在一个长期存在的后台进程中，也就是守护进程。如果没有为构建请求服务的空闲守护进程，则可以并行产生多个守护进程。</li>\n<li>一个守护进程实例可以处理来自 mvnd 客户机的多个连续请求。</li>\n<li>使用 GraalVM 构建的本地可执行文件。与传统的 JVM 相比，它启动更快，使用的内存更少。</li>\n</ul>\n<p>这种架构带来的优势有：</p>\n<ul>\n<li>运行实际构建的 JVM 不需要为每个构建重新启动，节省时间。</li>\n<li>JVM 中的实时 (JIT) 编译器生成的本机代码也保留了下来。与 Maven 相比，JIT 编译花费的时间更少。在重复构建过程中，JIT 优化的代码可以立即使用。这不仅适用于来自 Maven 插件和 Maven Core 的代码，也适用于来自 JDK 本身的所有代码。</li>\n</ul>\n<h2 id=\"2-使用步骤\"><a class=\"markdownIt-Anchor\" href=\"#2-使用步骤\">#</a> <strong>2、使用步骤</strong></h2>\n<h3 id=\"21-下载\"><a class=\"markdownIt-Anchor\" href=\"#21-下载\">#</a> <strong>2.1、下载</strong></h3>\n<p>下载：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9naXRodWIuY29tL212bmRhZW1vbi9tdm5kL3JlbGVhc2Vz\">https://github.com/mvndaemon/mvnd/releases</span></p>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-a58a6f79a75eeeb834275d74212cacb1_720w.jpg\" alt=\"img\"></p>\n<p>我这里是 windows，下载  <code>mvnd-0.7.1-windows-amd64.zip</code>  版本即可。</p>\n<h3 id=\"22-安装\"><a class=\"markdownIt-Anchor\" href=\"#22-安装\">#</a> <strong>2.2、安装</strong></h3>\n<p>直接解压。</p>\n<p>然后配置环境变量：将 bin 目录添加到 PATH</p>\n<h3 id=\"23-测试\"><a class=\"markdownIt-Anchor\" href=\"#23-测试\">#</a> <strong>2.3、测试</strong></h3>\n<p>打开 CMD 终端，输入  <code>mvnd -v</code></p>\n<p>可以看到如下信息表示安装成功：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">C:\\Users\\HaC&gt; mvnd -v</span><br><span class=\"line\">mvnd native client 0.7.1-windows-amd64 (97c587c11383a67b5bd0ff8388bd94c694b91c1e)</span><br><span class=\"line\">Terminal: org.jline.terminal.impl.jansi.win.JansiWinSysTerminal</span><br><span class=\"line\">Apache Maven 3.8.3 (ff8e977a158738155dc465c6a97ffaf31982d739)</span><br><span class=\"line\">Maven home: E:\\apache-mvnd-0.7.1-windows-amd64\\mvn</span><br><span class=\"line\">Java version: 1.8.0_131, vendor: Oracle Corporation, runtime: E:\\JDK1.8\\jre</span><br><span class=\"line\">Default locale: zh_CN, platform encoding: GBK</span><br><span class=\"line\">OS name: &quot;windows 10&quot;, version: &quot;10.0&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;</span><br></pre></td></tr></table></figure>\n<p>可以看到 mvnd 集成了 Maven 3.8.3 版本。</p>\n<h3 id=\"24-使用\"><a class=\"markdownIt-Anchor\" href=\"#24-使用\">#</a> <strong>2.4、使用</strong></h3>\n<p>在使用上和 Maven 一样，参数也一致。</p>\n<p>Maven 使用  <code>mvn clean package</code>  ；使用 Maven-mvnd 只需要变成  <code>mvnd clean package</code>  即可，其他同理。</p>\n<h3 id=\"25-配置修改\"><a class=\"markdownIt-Anchor\" href=\"#25-配置修改\">#</a> <strong>2.5、配置修改</strong></h3>\n<p>为了最小程度的兼容原来的 Maven，可以使用原来的  <code>setting.xml</code></p>\n<p>打开 Maven-mvnd 安装目录下 的  <code>/conf/mvnd.properties</code>  文件，修改：</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">maven.settings</span>=<span class=\"string\">E://apache-maven-3.5.4-bin//apache-maven-3.5.4//conf//settings.xml</span></span><br></pre></td></tr></table></figure>\n<p>（注意是  <code>//</code> ）</p>\n<h2 id=\"3-打包对比\"><a class=\"markdownIt-Anchor\" href=\"#3-打包对比\">#</a> <strong>3、打包对比</strong></h2>\n<p>由于 mvnd-0.7.1 版本使用了 Maven 3.8.3 版本，我这里同样使用 Maven 3.8.3 进行对比。</p>\n<p>命令：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># maven 打包命令</span><br><span class=\"line\">mvn clean package -Dmaven.test.skip=true</span><br><span class=\"line\"># mvnd 打包命令</span><br><span class=\"line\">mvnd clean package -Dmaven.test.skip=true</span><br></pre></td></tr></table></figure>\n<p>电脑配置：</p>\n<p>CPU：Intel® Core™ i7-4790 CPU @ 3.60GHz 3.60 GHz</p>\n<p>内存：16GB</p>\n<p>结果如下：</p>\n<ul>\n<li>13 个子项目</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-dd0b655c2c27661612a479ef242058c8_720w.jpg\" alt=\"img\">41 秒 vs 21 秒</p>\n<p>可以看到 <strong>mvnd 打包的总时间比 mvn 快了不少</strong>，因为 mvnd 使用了 CPU 的多核心，可以看到每个子模块打包的时间都差不多，所以在单核的机器，就不要尝试使用 mvnd 了。</p>\n<ul>\n<li>19 个子项目</li>\n</ul>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-0a301e678b6ebab5577d899b6230ffe5_720w.jpg\" alt=\"img\">32 秒 vs 10 秒</p>\n<p>呈现子项目越多，相对速度更快的趋势。</p>\n<p>总的来说：</p>\n<p><strong>如果项目模块很多，可以尝试使用 mvnd 进行辅助打包，比如 测试、生产，可以节省很多时间；</strong></p>\n<p><strong>开发则可以继续使用 mvn ，毕竟 IDEA 无法集成 mvnd，可以在 terminal 通过命令打包。</strong></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2VUE%E9%A1%B9%E7%9B%AE/",
            "url": "http://example.com/2022/12/27/Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2VUE%E9%A1%B9%E7%9B%AE/",
            "title": "Linux服务器下部署vue 2.0项目",
            "date_published": "2022-12-27T08:18:48.586Z",
            "content_html": "<h3 id=\"一-安装vue环境\"><a class=\"markdownIt-Anchor\" href=\"#一-安装vue环境\">#</a> 一、安装 VUE 环境</h3>\n<p>1.wget 指定进行下载，下载后文件默认存在根目录下的 root 包下面；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://nodejs.org/dist/v16.14.0/node-v16.14.0-linux-x64.tar.xz</span><br></pre></td></tr></table></figure>\n<p>解压缩</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xz -d node-v16.14.0-linux-x64.tar.xz  #将xz格式解压为tar</span><br><span class=\"line\"></span><br><span class=\"line\">tar -xvf node-v16.14.0-linux-x64.tar  #将tar解压为文件</span><br></pre></td></tr></table></figure>\n<p>重命名文件夹</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv node-v16.14.0-linux-x64 nodeJS-V16.14.0</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>配置 node.js 环境变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br></pre></td></tr></table></figure>\n<p>进入编辑，在文件最下面加上如下字段</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export NODEJS_HOME=/root/nodeJS-V16.14.0</span><br><span class=\"line\">export PATH=$NODEJS_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>\n<p>个人比较喜欢用 Xftp 将 profile 文件传输到 windows 系统下进行配置后再覆盖回去</p>\n<p>配置完成后使用 source 命令重新执行刚修改的初始化文件，使之立即生效，而不必注销并重新登录</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<p>检查环境变量是否配置成功</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">node -v</span><br></pre></td></tr></table></figure>\n<p>安装 WebPackage</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install webpack -g --registry=https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n<h3 id=\"二-nginx环境搭建配置\"><a class=\"markdownIt-Anchor\" href=\"#二-nginx环境搭建配置\">#</a> 二、Nginx 环境搭建配置</h3>\n<p>wget 指定进行下载，下载后文件默认存在根目录下的 root 下面；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.wget https://nginx.org/download/nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure>\n<p>解压缩</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -zxvf nginx-1.21.6.tar.gz</span><br></pre></td></tr></table></figure>\n<p>进入 nginx 文件夹</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /root/nginx-1.21.6</span><br></pre></td></tr></table></figure>\n<p>检查配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br></pre></td></tr></table></figure>\n<p>安装 gcc 环境，有就不需要安装了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install gcc-c++</span><br></pre></td></tr></table></figure>\n<p>安装 PCRE 依赖库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>\n<p>安装 zlib 依赖库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>\n<p>安装 OpenSSL 安全套接字层密码库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>\n<p>再次执行配置检查命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./configure</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>编译安装 nginx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make install</span><br></pre></td></tr></table></figure>\n<p>查找默认安装路径</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">whereis nginx</span><br></pre></td></tr></table></figure>\n<p>配置 nginx 环境变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/profile</span><br></pre></td></tr></table></figure>\n<p>进入编辑，在文件最下面加上如下字段</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export PATH=$PATH:/usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>\n<p>个人比较喜欢用 Xftp 将 profile 文件传输到 windows 系统下进行配置后再覆盖回去</p>\n<p>初始化配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n<p>检查环境变量是否配置成功</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -v</span><br></pre></td></tr></table></figure>\n<p>启动 nginx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx</span><br></pre></td></tr></table></figure>\n<p>查看 nginx 是否启动，远程访问服务器，跳出 nginx 欢迎界面就算配置成功了！</p>\n<p>nginx 常用命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">启动服务：nginx</span><br><span class=\"line\">退出服务：nginx -s quit</span><br><span class=\"line\">强制关闭服务：nginx -s stop</span><br><span class=\"line\">重载服务：nginx -s reload　　（重载服务配置文件，类似于重启，但服务不会中止）</span><br><span class=\"line\">验证配置文件：nginx -t</span><br><span class=\"line\">使用配置文件：nginx -c &quot;配置文件路径&quot;</span><br><span class=\"line\">使用帮助：nginx -h</span><br></pre></td></tr></table></figure>\n<h3 id=\"三-发布vue项目\"><a class=\"markdownIt-Anchor\" href=\"#三-发布vue项目\">#</a> 三、发布 VUE 项目</h3>\n<h5 id=\"打包vue项目\"><a class=\"markdownIt-Anchor\" href=\"#打包vue项目\">#</a> 打包 VUE 项目</h5>\n<p>1. 首先配置好线上环境的路径：prod.env</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220428084247115.png\" alt=\"image-20220428084247115\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = &#123;</span><br><span class=\"line\">\tNODE_ENV: &#x27;&quot;production&quot;&#x27;,</span><br><span class=\"line\">\tENV_CONFIG: &#x27;&quot;prod&quot;&#x27;,</span><br><span class=\"line\">\tMANAGEMENT_SERVICE_API: &#x27;&quot;http://42.193.125.92:7815&quot;&#x27;,</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>2. 控制台输入 npm run build:prod</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220428084349346.png\" alt=\"image-20220428084349346\"></p>\n<p>3. 打包完会生成一个 dist 文件夹</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220428084359625.png\" alt=\"image-20220428084359625\"></p>\n<p>4. 将 dist 文件夹内容覆盖到 /usr/local/nginx/html 目录下面</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220428084414353.png\" alt=\"image-20220428084414353\"></p>\n<p>5. 修改 nginx 配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/nginx/conf/nginx.conf 编辑打开</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">worker_processes</span>  <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">events</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">worker_connections</span>  <span class=\"number\">1024</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">include</span>       mime.types;</span><br><span class=\"line\">    <span class=\"attribute\">default_type</span>  application/octet-stream;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">sendfile</span>        <span class=\"literal\">on</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"attribute\">keepalive_timeout</span>  <span class=\"number\">65</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">listen</span>       <span class=\"number\">8099</span>;  <span class=\"comment\">#配置当前服务端口</span></span><br><span class=\"line\">        <span class=\"attribute\">server_name</span>  localhost; <span class=\"comment\">#配置当前服务IP</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"section\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span>   html/dist; <span class=\"comment\">#配置服务根目录</span></span><br><span class=\"line\">            <span class=\"attribute\">index</span>  index.html index.htm; <span class=\"comment\">#配置服务索引页面</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"attribute\">error_page</span>   <span class=\"number\">500</span> <span class=\"number\">502</span> <span class=\"number\">503</span> <span class=\"number\">504</span>  /50x.html;</span><br><span class=\"line\">        <span class=\"section\">location</span> = /50x.html &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span>   html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>6. 重启或关闭重开 Nginx</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">nginx</span> -s reload <span class=\"comment\">#重启</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">nginx -s stop <span class=\"comment\">#强制停止</span></span><br><span class=\"line\"></span><br><span class=\"line\">nginx <span class=\"comment\">#开启</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Linux%E4%B8%8Bdocer%E9%83%A8%E7%BD%B2mysql/",
            "url": "http://example.com/2022/12/27/Linux%E4%B8%8Bdocer%E9%83%A8%E7%BD%B2mysql/",
            "title": "Linux下docer部署mysql",
            "date_published": "2022-12-27T08:18:48.583Z",
            "content_html": "<h2 id=\"linux下docer部署mysql\"><a class=\"markdownIt-Anchor\" href=\"#linux下docer部署mysql\">#</a> Linux 下 docer 部署 mysql</h2>\n<p>部署方法：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.首先在Linux系统中启动已经安装好的docker</span><br><span class=\"line\">service docker start</span><br><span class=\"line\"></span><br><span class=\"line\">2.查看docker进程，确认docker启动成功</span><br><span class=\"line\">ps -ef|grep docker</span><br><span class=\"line\"></span><br><span class=\"line\">3.在docker容器中查询MySQL</span><br><span class=\"line\">docker search mysql</span><br><span class=\"line\"></span><br><span class=\"line\">4.在docker中安装MySQL</span><br><span class=\"line\">docker pull mysql</span><br><span class=\"line\"></span><br><span class=\"line\">5.查看MySQL镜像</span><br><span class=\"line\">docker images</span><br><span class=\"line\"></span><br><span class=\"line\">6.创建MySQL用户并且将root账户密码设置为你需要的密码</span><br><span class=\"line\">docker run --name mysqlserver -v $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=『你的账户密码』 -d -i -p 外网端口:3306 mysql:latest</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -p 33001:3306 --name mysqlSlave2 -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e MYSQL_ROOT_PASSWORD=Lgq081538 -d mysql:5.7</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">指定配置文件容器</span></span><br><span class=\"line\">docker run -p 33001:3306 --name mysqlSlave2 \\</span><br><span class=\"line\">-v /usr/local/docker/mysql/logs:/var/log/mysql \\</span><br><span class=\"line\">-v /usr/local/docker/mysql/data:/var/lib/mysql \\</span><br><span class=\"line\">-v /usr/local/docker/mysql/conf/my.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf \\</span><br><span class=\"line\">-e MYSQL_ROOT_PASSWORD=Lgq081538 \\</span><br><span class=\"line\">-d mysql:5.7</span><br><span class=\"line\"></span><br><span class=\"line\">7.在docker中启动MySQL</span><br><span class=\"line\">docker exec -it mysqlSlave2 bash</span><br><span class=\"line\"></span><br><span class=\"line\">8.输入用户名和密码</span><br><span class=\"line\">mysql -uroot -p</span><br><span class=\"line\"></span><br><span class=\"line\">9.开启MySQL远程访问权限</span><br><span class=\"line\">use mysql;</span><br><span class=\"line\">select host,user from user;</span><br><span class=\"line\">ALTER USER &#x27;root&#x27;@&#x27;%&#x27; IDENTIFIED WITH mysql_native_password BY &#x27;Lgq081538&#x27;;</span><br><span class=\"line\">flush privileges;</span><br><span class=\"line\"></span><br><span class=\"line\">一些在docker的常用命令：</span><br><span class=\"line\">1、列出正在运行的容器</span><br><span class=\"line\">docker ps -a</span><br><span class=\"line\"></span><br><span class=\"line\">2、列出包括未运行的所有的容器</span><br><span class=\"line\">docker ps</span><br><span class=\"line\"></span><br><span class=\"line\">3、查看某进程最近10条运行日志</span><br><span class=\"line\">docker logs -f --tail 10 &quot;所查询的进程ID&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">4、关闭docker中运行的进程，以MySQL为例</span><br><span class=\"line\">docker stop mysql</span><br><span class=\"line\"></span><br><span class=\"line\">或者</span><br><span class=\"line\">docker stop &quot;要停止的进程ID&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">5、重启docker中运行的进程</span><br><span class=\"line\">docker restart &quot;要重启的进程ID&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">6、重启docker</span><br><span class=\"line\">systemctl restart docker</span><br><span class=\"line\"></span><br><span class=\"line\">7、停止docker</span><br><span class=\"line\">systemctl stop docker</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Knife4J%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Knife4J%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/",
            "title": "Knife4J接口文档",
            "date_published": "2022-12-27T08:18:48.581Z",
            "content_html": "<p>Swagger2 及 knife4j 使用</p>\n<p>最近项目中用到了 Swagger2 和 knife4j 作为接口文档。所以自己简单搭建了一套环境学习下，总体体验下来，这个框架很方便也很简单易用。</p>\n<p>Swagger2 和 Swagger-ui<br>\nspringFox 官方推荐的是 Swagger2 和 Swagger-ui 配套使用</p>\n<p>maven 依赖<br>\n<dependencies><br>\n<dependency><br>\n<groupId>io.springfox</groupId><br>\n<artifactId>springfox-swagger2</artifactId><br>\n<version>2.9.2</version><br>\n</dependency><br>\n<!--生成UI界面--><br>\n<dependency><br>\n<groupId>io.springfox</groupId><br>\n<artifactId>springfox-swagger-ui</artifactId><br>\n<version>2.9.2</version><br>\n</dependency><br>\n</dependencies></p>\n<p>增加配置文件<br>\n @Configuration<br>\n@EnableSwagger2<br>\npublic class Swagger2 {</p>\n<pre><code>@Bean\npublic Docket controllerApi() &#123;\n    return new Docket(DocumentationType.SWAGGER_2)\n            .apiInfo(new ApiInfoBuilder()\n                    .title(&quot;文档说明--API接口文档&quot;)\n                    .description(&quot;包括保存、查询等&quot;)\n                    .version(&quot;版本号:1.0&quot;)\n                    .build())\n            .select()\n            .apis(RequestHandlerSelectors.basePackage(&quot;com.example.myswagger.controller&quot;))\n            .paths(PathSelectors.any()) // 如果适配所有api，可以改为PathSelectors.any()\n            .build();\n&#125;\n</code></pre>\n<p>API 接口增加 swagger 注解<br>\n @Controller<br>\n@RequestMapping<br>\n@Api (tags = “接口服务”)<br>\npublic class HelloController {</p>\n<pre><code>@ApiOperation(&quot;根目录&quot;)\n@GetMapping(&quot;/&quot;)\n@ResponseBody\npublic  String hello()&#123;\n    System.out.println(&quot;23123&quot;);\n    return &quot;hello&quot;;\n&#125;\n\n\n@ApiOperation(&quot;保存用户信息&quot;)\n@ApiImplicitParams(&#123;\n        @ApiImplicitParam(name = &quot;name&quot;, value = &quot;名字&quot;, required = true, paramType = &quot;path&quot;),\n        @ApiImplicitParam(name = &quot;age&quot;, dataType = &quot;int&quot;, value = &quot;年龄&quot;, required = true, paramType = &quot;query&quot;)\n&#125;)\n@PostMapping(&quot;/save&quot;)\n@ResponseBody\npublic Boolean save(\n        @RequestParam(&quot;name&quot;) String name,\n        @RequestParam(&quot;age&quot;) Integer age\n) &#123;\n    return true;\n&#125;\n</code></pre>\n<p>效果展示<br>\n启动项目访问</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL3N3YWdnZXItdWkuaHRtbA==\">http://localhost:8080/swagger-ui.html</span></p>\n<p>测试接口：</p>\n<p>项目地址<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vTHlsWW9yaWNrL215c3dhZ2dlcg==\"> https://gitee.com/LylYorick/myswagger</span></p>\n<p>swagger 注解详解<br>\n @Api：用在请求的类上，表示对类的说明<br>\n tags=“说明该类的作用，可以在 UI 界面上看到的注解”<br>\nvalue=“该参数没什么意义，在 UI 界面上也看到，所以不需要配置”</p>\n<p>@ApiOperation：用在请求的方法上，说明方法的用途、作用<br>\n value=“说明方法的用途、作用”<br>\nnotes=“方法的备注说明”</p>\n<p>@ApiImplicitParams：用在请求的方法上，表示一组参数说明<br>\n @ApiImplicitParam：用在 @ApiImplicitParams 注解中，指定一个请求参数的各个方面<br>\n name：参数名<br>\n value：参数的汉字说明、解释<br>\n required：参数是否必须传<br>\n paramType：参数放在哪个地方<br>\n・header --&gt; 请求参数的获取：@RequestHeader<br>\n・query --&gt; 请求参数的获取：@RequestParam<br>\n・path（用于 restful 接口）–&gt; 请求参数的获取：@PathVariable<br>\n・body（不常用）<br>\n・form（不常用）<br>\ndataType：参数类型，默认 String，其它值 dataType=“Integer”<br>\ndefaultValue：参数的默认值</p>\n<p>@ApiResponses：用在请求的方法上，表示一组响应<br>\n @ApiResponse：用在 @ApiResponses 中，一般用于表达一个错误的响应信息<br>\n code：数字，例如 400<br>\nmessage：信息，例如 &quot;请求参数没填好&quot;<br>\nresponse：抛出异常的类</p>\n<p>@ApiModel：用于响应类上，表示一个返回响应数据的信息<br>\n（这种一般用在 post 创建的时候，使用 @RequestBody 这样的场景，<br>\n请求参数无法使用 @ApiImplicitParam 注解进行描述的时候）<br>\n@ApiModelProperty：用在属性上，描述响应类的属性<br>\n Swagger2 和 knife4j<br>\n 虽然 Swagger-ui 很好，但是国人还是开发了一个 knife4j 的的 swaggerui，更加好看和方便使用</p>\n<p>maven 依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.github.xiaoymin<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.0.8<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.springfox<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springfox-swagger2<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.10.5<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>增加配置类<br>\n @Configuration<br>\n@EnableSwagger2WebMvc<br>\npublic class Knife4jConfiguration {</p>\n<pre><code>@Bean(value = &quot;defaultApi2&quot;)\npublic Docket defaultApi2() &#123;\n    Docket docket=new Docket(DocumentationType.SWAGGER_2)\n            .apiInfo(new ApiInfoBuilder()\n                    //.title(&quot;swagger-bootstrap-ui-demo RESTful APIs&quot;)\n                    .description(&quot;# swagger-bootstrap-ui-demo RESTful APIs&quot;)\n                    .termsOfServiceUrl(&quot;http://www.xx.com/&quot;)\n                    .contact(&quot;xx@qq.com&quot;)\n                    .version(&quot;1.0&quot;)\n                    .build())\n            //分组名称\n            .groupName(&quot;2.X版本&quot;)\n            .select()\n            //这里指定Controller扫描包路径\n            .apis(RequestHandlerSelectors.basePackage(&quot;com.example.myswaggerknife4j.controller&quot;))\n            .paths(PathSelectors.any())\n            .build();\n    return docket;\n&#125;\n</code></pre>\n<p>API 接口增加 swagger 注解<br>\n @Controller<br>\npublic class HelloController {</p>\n<pre><code>@PostMapping(&quot;/save&quot;)\n@ResponseBody\npublic Boolean save(\n        @RequestParam(&quot;name&quot;) String name,\n        @RequestParam(&quot;age&quot;) Integer age\n) &#123;\n    return true;\n&#125;\n</code></pre>\n<p>效果展示<br>\n访问 <span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo4MDgwL2RvYy5odG1s\">http://localhost:8080/doc.html</span></p>\n<p>项目地址<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vTHlsWW9yaWNrL215LXN3YWdnZXIta25pZmU0ag==\"> https://gitee.com/LylYorick/my-swagger-knife4j</span></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/",
            "url": "http://example.com/2022/12/27/JUC%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E3%80%81%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%AC%94%E8%AE%B0/",
            "title": "JUC并发多线程笔记",
            "date_published": "2022-12-27T08:18:48.578Z",
            "content_html": "<h3 id=\"什么是juc\"><a class=\"markdownIt-Anchor\" href=\"#什么是juc\">#</a> 什么是 JUC</h3>\n<h4 id=\"进程与线程\"><a class=\"markdownIt-Anchor\" href=\"#进程与线程\">#</a> 进程与线程</h4>\n<p>进程：计算机进行资源调度的基本单元（打开一个软件）。</p>\n<p>线程：系统分配时间调度的基本单元。</p>\n<h4 id=\"线程的状态\"><a class=\"markdownIt-Anchor\" href=\"#线程的状态\">#</a> 线程的状态</h4>\n<ul>\n<li>新建</li>\n<li>运行</li>\n<li>阻塞</li>\n<li>等待</li>\n<li>超时等待</li>\n<li>终止</li>\n</ul>\n<h4 id=\"wait和sleep\"><a class=\"markdownIt-Anchor\" href=\"#wait和sleep\">#</a> WAIT 和 SLEEP</h4>\n<p>(1) sleep 是 Thread 的静态方法，wait 是 Object 的方法，任何对象实例都 能调用。</p>\n<p>(2) sleep 不会释放锁，它也不需要占用锁。wait 会释放锁，但调用它的前提 是当前线程占有锁 (即代码要在 synchronized 中)。</p>\n<p>(3) 它们都可以被 interrupted 方法中断。</p>\n<h4 id=\"并发和并行\"><a class=\"markdownIt-Anchor\" href=\"#并发和并行\">#</a> 并发和并行</h4>\n<p>** 并发:** 同一时刻多个线程在访问同一个资源，多个线程对一个点</p>\n<p>** 并行:** 多项工作一起执行，之后再汇总</p>\n<h4 id=\"管程monitor\"><a class=\"markdownIt-Anchor\" href=\"#管程monitor\">#</a> 管程 MONITOR</h4>\n<p>就是说的<strong>锁</strong></p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-10-02%2017.32.19.png\" alt=\"截屏2021-10-02 17.32.19\"></p>\n<h4 id=\"用户线程和守护线程\"><a class=\"markdownIt-Anchor\" href=\"#用户线程和守护线程\">#</a> 用户线程和守护线程</h4>\n<p><strong>用户线程</strong>：平时用到的普通线程，自定义线程</p>\n<p><strong>守护线程</strong>：运行在后台，是一种特殊的线程，比如垃圾回收</p>\n<p>当主线程结束后，用户线程还在运行，JVM 存活</p>\n<p>如果没有用户线程，都是守护线程，JVM 结束</p>\n<h3 id=\"lock接口\"><a class=\"markdownIt-Anchor\" href=\"#lock接口\">#</a> LOCK 接口</h3>\n<h4 id=\"多线程编程步骤\"><a class=\"markdownIt-Anchor\" href=\"#多线程编程步骤\">#</a> 多线程编程步骤</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/03-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4.png\" alt=\"03-多线程编程步骤\"></p>\n<h4 id=\"synchronized\"><a class=\"markdownIt-Anchor\" href=\"#synchronized\">#</a> SYNCHRONIZED</h4>\n<p>synchronized 是 Java 中的关键字，是一种同步锁。它修饰的对象有以下几种:</p>\n<ol>\n<li>修饰一个代码块，被修饰的代码块称为同步语句块，其作用的范围是大括号 {} 括起来的代码，作用的对象是调用这个代码块的对象；</li>\n<li>修饰一个方法，被修饰的方法称为同步方法，其作用的范围是整个方法，作用 的对象是调用这个方法的对象；\n<ul>\n<li>虽然可以使用 synchronized 来定义方法，但 synchronized 并不属于方法定 义的一部分，因此，synchronized 关键字不能被继承。如果在父类中的某个方 法使用了 synchronized 关键字，而在子类中覆盖了这个方法，在子类中的这 个方法默认情况下并不是同步的，而必须显式地在子类的这个方法中加上 synchronized 关键字才可以。当然，还可以在子类方法中调用父类中相应的方 法，这样虽然子类中的方法不是同步的，但子类调用了父类的同步方法，因此， 子类的方法也就相当于同步了。</li>\n</ul>\n</li>\n<li>修改一个静态的方法，其作用的范围是整个静态方法，作用的对象是这个类的 所有对象；</li>\n<li>修改一个类，其作用的范围是 synchronized 后面括号括起来的部分，作用主 的对象是这个类的所有对象。</li>\n</ol>\n<p>例子：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建资源类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Ticket</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//票数</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">number</span> <span class=\"operator\">=</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">    <span class=\"comment\">//操作方法：卖票</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sale</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//判断：是否有票</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (number&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;::&quot;</span>+number--+<span class=\"string\">&quot;还剩&quot;</span>+number);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"reetranlock可重入锁\"><a class=\"markdownIt-Anchor\" href=\"#reetranlock可重入锁\">#</a> REETRANLOCK 可重入锁</h4>\n<p>可重入锁：一个走了才能再进一个</p>\n<p>例子：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">LTicket</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">number</span> <span class=\"operator\">=</span> <span class=\"number\">30</span>;</span><br><span class=\"line\">  <span class=\"comment\">//创建可重入锁 公平锁</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">ReentrantLock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">sale</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (number&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;::&quot;</span>+number--+<span class=\"string\">&quot;剩余：&quot;</span>+number);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>采用 Lock，必须主动去释放锁，并且在发生异常时，不会自动释放锁。因此一 般来说，使用 Lock 必须在 try {} catch {} 块中进行，并且将释放锁的操作放在 finally 块中进行，以保证锁一定被被释放，防止死锁的发生。</p>\n<h4 id=\"lock和synchronized的不同\"><a class=\"markdownIt-Anchor\" href=\"#lock和synchronized的不同\">#</a> LOCK 和 SYNCHRONIZED 的不同</h4>\n<ol>\n<li>\n<p>Lock 是一个接口，而 synchronized 是 Java 中的关键字，synchronized 是内 置的语言实现；</p>\n</li>\n<li>\n<p>synchronized 在发生异常时，会自动释放线程占有的锁，因此不会导致死锁现 象发生；而 Lock 在发生异常时，如果没有主动通过 unLock () 去释放锁，则很 可能造成死锁现象，因此使用 Lock 时需要在 finally 块中释放锁；</p>\n</li>\n<li>\n<p>Lock 可以让等待锁的线程响应中断，而 synchronized 却不行，使用 synchronized 时，等待的线程会一直等待下去，不能够响应中断；</p>\n</li>\n<li>\n<p>通过 Lock 可以知道有没有成功获取锁，而 synchronized 却无法办到。</p>\n</li>\n<li>\n<p>Lock 可以提高多个线程进行读操作的效率。</p>\n<p>在性能上来说，如果竞争资源不激烈，两者的性能是差不多的，而当竞争资源 非常激烈时 (即有大量线程同时竞争)，此时 Lock 的性能要远远优于 synchronized。</p>\n</li>\n</ol>\n<h3 id=\"线程间通信\"><a class=\"markdownIt-Anchor\" href=\"#线程间通信\">#</a> 线程间通信</h3>\n<h4 id=\"synchronized-2\"><a class=\"markdownIt-Anchor\" href=\"#synchronized-2\">#</a> SYNCHRONIZED</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.jsh.juc.sync;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Share</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//初始值</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">number</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//+1的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">      <span class=\"comment\">//判断 干活 通知</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (number != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.wait();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      <span class=\"comment\">//干活</span></span><br><span class=\"line\">        number++;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;::&quot;</span> + number);</span><br><span class=\"line\">      <span class=\"comment\">//通知</span></span><br><span class=\"line\">        <span class=\"built_in\">this</span>.notifyAll();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//+1的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dno</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (number == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.wait();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        number--;</span><br><span class=\"line\">        System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;::&quot;</span> + number);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.notifyAll();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Share</span> <span class=\"variable\">sale</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Share</span>();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.add();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;AA&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.dno();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;BB&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.add();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;CC&quot;</span>).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"lock\"><a class=\"markdownIt-Anchor\" href=\"#lock\">#</a> LOCK</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Share</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//初始值</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">number</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建lock</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Condition</span> <span class=\"variable\">condition</span> <span class=\"operator\">=</span> lock.newCondition();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//+1的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">add</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//上锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//判断（使用while不使用if）</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (number != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//等待</span></span><br><span class=\"line\">                condition.await();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            number++;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;::&quot;</span> + number);</span><br><span class=\"line\">            <span class=\"comment\">//通知</span></span><br><span class=\"line\">            condition.signalAll();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//解锁</span></span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//-1的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dno</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//上锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (number == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//等待</span></span><br><span class=\"line\">                condition.await();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            number--;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;::&quot;</span> + number);</span><br><span class=\"line\">            <span class=\"comment\">//通知</span></span><br><span class=\"line\">            condition.signalAll();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//解锁</span></span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Share</span> <span class=\"variable\">sale</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Share</span>();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.add();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;AA&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.dno();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;BB&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">40</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    sale.add();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;CC&quot;</span>).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"虚假唤醒问题\"><a class=\"markdownIt-Anchor\" href=\"#虚假唤醒问题\">#</a> 虚假唤醒问题</h4>\n<p>等待判断应该放在 while 中，不应该放在 if 中（if 只能判断一次）</p>\n<h3 id=\"线程间定制化通信\"><a class=\"markdownIt-Anchor\" href=\"#线程间定制化通信\">#</a> 线程间定制化通信</h3>\n<blockquote>\n<p>private Condition c3 = lock.newCondition();</p>\n<p>通知谁 调用谁的 signal () 方法</p>\n<p>c3.signal();</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">线程间定制化通知</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">//第一步 创建资源类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">ShareResource</span> &#123; </span><br><span class=\"line\">    <span class=\"comment\">//定义标志位</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;<span class=\"comment\">//1:aa,2:bb,3:cc</span></span><br><span class=\"line\">    <span class=\"comment\">//创建lock锁</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建三个Condition</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Condition</span> <span class=\"variable\">c1</span> <span class=\"operator\">=</span> lock.newCondition();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Condition</span> <span class=\"variable\">c2</span> <span class=\"operator\">=</span> lock.newCondition();</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">Condition</span> <span class=\"variable\">c3</span> <span class=\"operator\">=</span> lock.newCondition();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//打印5次，参数第几轮</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print5</span><span class=\"params\">(<span class=\"type\">int</span> loop)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//上锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//判断</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (flag != <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                c1.await();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//干活</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;::&quot;</span>+i+<span class=\"string\">&quot;第几轮：&quot;</span>+loop);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//通知</span></span><br><span class=\"line\">            flag = <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"comment\">//通知c2</span></span><br><span class=\"line\">            c2.signal();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//打印10次，参数第几轮</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print10</span><span class=\"params\">(<span class=\"type\">int</span> loop)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//上锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//判断</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (flag != <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                c2.await();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//干活</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;::&quot;</span>+i+<span class=\"string\">&quot;第几轮：&quot;</span>+loop);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//通知</span></span><br><span class=\"line\">            flag = <span class=\"number\">3</span>;</span><br><span class=\"line\">            c3.signal();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//打印15次，参数第几轮</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">print15</span><span class=\"params\">(<span class=\"type\">int</span> loop)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//上锁</span></span><br><span class=\"line\">        lock.lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//判断</span></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (flag != <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">                c3.await();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//干活</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">15</span>; i++) &#123;</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;::&quot;</span>+i+<span class=\"string\">&quot;第几轮：&quot;</span>+loop);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//通知</span></span><br><span class=\"line\">            flag = <span class=\"number\">1</span>;</span><br><span class=\"line\">            c1.signal();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            lock.unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadDemo3</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ShareResource</span> <span class=\"variable\">shareResource</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ShareResource</span>();</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                    shareResource.print5(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,<span class=\"string\">&quot;aa&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                    shareResource.print10(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,<span class=\"string\">&quot;bb&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">                    shareResource.print15(i);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,<span class=\"string\">&quot;cc&quot;</span>).start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"集合的线程安全\"><a class=\"markdownIt-Anchor\" href=\"#集合的线程安全\">#</a> 集合的线程安全</h3>\n<p><strong>ArrayList,HashMap,HashSet 线程不安全</strong></p>\n<p>ArrayList 解决方法</p>\n<ul>\n<li>\n<p>Vector</p>\n</li>\n<li>\n<p>Collections</p>\n</li>\n<li>\n<p>CopyOnWriteArrayList</p>\n<p>写时复制技术：并发读，独立写：每次写入的时候先复制一份，写入新内容后再合并</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ArrayListSync</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\"><span class=\"comment\">//        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class=\"line\">        <span class=\"comment\">//1.Vector</span></span><br><span class=\"line\"><span class=\"comment\">//        List&lt;String&gt; list = new Vector&lt;&gt;();</span></span><br><span class=\"line\">        <span class=\"comment\">//2.Collections</span></span><br><span class=\"line\"><span class=\"comment\">//        List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span></span><br><span class=\"line\">        <span class=\"comment\">//CopyOnWriteArrayList</span></span><br><span class=\"line\">        CopyOnWriteArrayList&lt;String&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">400</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">                list.add(UUID.randomUUID().toString().substring(<span class=\"number\">0</span>,<span class=\"number\">8</span>));</span><br><span class=\"line\">                System.out.println(list);</span><br><span class=\"line\">            &#125;).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>HashSet 解决方法</p>\n<p>CopyOnWriteArraySet</p>\n<p>HashMap 解决方法</p>\n<p>ConcurrentHashMap</p>\n<h3 id=\"多线程锁\"><a class=\"markdownIt-Anchor\" href=\"#多线程锁\">#</a> 多线程锁</h3>\n<h4 id=\"锁的八种情况\"><a class=\"markdownIt-Anchor\" href=\"#锁的八种情况\">#</a> 锁的八种情况</h4>\n<p>synchronized 实现同步的基础：Java 中的每一个对象都可以作为锁具体表现为以下 3 种形式。</p>\n<ul>\n<li>对于普通同步方法，锁是当前实例对象。</li>\n<li>对于静态同步方法，锁是当前类的 Class 对象。</li>\n<li>对于同步方法块，锁是 Synchonized 括号里配置的对象</li>\n</ul>\n<h4 id=\"公平锁和非公平锁\"><a class=\"markdownIt-Anchor\" href=\"#公平锁和非公平锁\">#</a> 公平锁和非公平锁</h4>\n<blockquote>\n<p>多线程之间工作的平均</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//创建lock锁 true：公平 false：非公平</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">Lock</span> <span class=\"variable\">lock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantLock</span>(<span class=\"literal\">true</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>公平锁：效率低，平均</li>\n<li>非公平锁：效率高，不平均</li>\n</ul>\n<h4 id=\"死锁\"><a class=\"markdownIt-Anchor\" href=\"#死锁\">#</a> 死锁</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/16-%E6%AD%BB%E9%94%81.png\" alt=\"16-死锁\"></p>\n<h3 id=\"callable\"><a class=\"markdownIt-Anchor\" href=\"#callable\">#</a> Callable</h3>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Runnable</th>\n<th>Callable</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>返回值</td>\n<td>无</td>\n<td>有</td>\n</tr>\n<tr>\n<td>异常</td>\n<td>无</td>\n<td>有</td>\n</tr>\n<tr>\n<td>实现方法</td>\n<td>run</td>\n<td>call</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"代码实现\"><a class=\"markdownIt-Anchor\" href=\"#代码实现\">#</a> 代码实现</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.jsh.juc.callable;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.Callable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.ExecutionException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.FutureTask;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyThread</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Callable</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Object <span class=\"title function_\">call</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">200</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Demo1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//方法一</span></span><br><span class=\"line\">        <span class=\"comment\">//FutureTask 未来任务</span></span><br><span class=\"line\">        FutureTask&lt;Integer&gt; futureTask1 = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;&gt;(<span class=\"keyword\">new</span> <span class=\"title class_\">MyThread</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//方法二</span></span><br><span class=\"line\">        <span class=\"comment\">//lam表达式</span></span><br><span class=\"line\">        FutureTask&lt;Integer&gt; futureTask2 = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;&gt;(() -&gt;&#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1024</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//创建线程 ，启动</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(futureTask2,<span class=\"string\">&quot;lucy&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//线程是否结束</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (!futureTask2.isDone()) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;wait。。。。。&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//第一次调用 计算 返回结果</span></span><br><span class=\"line\">        System.out.println(futureTask2.get());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//第二次调用直接返回结果</span></span><br><span class=\"line\">        System.out.println(futureTask2.get());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"juc辅助类\"><a class=\"markdownIt-Anchor\" href=\"#juc辅助类\">#</a> JUC 辅助类</h3>\n<h4 id=\"减少计数countdownlatch\"><a class=\"markdownIt-Anchor\" href=\"#减少计数countdownlatch\">#</a> 减少计数 COUNTDOWNLATCH</h4>\n<blockquote>\n<ul>\n<li>创建计数器 <code>CountDownLatch countDownLatch = new CountDownLatch(6);</code></li>\n<li>计数 - 1 <code>countDownLatch.countDown();</code></li>\n<li>等待，当计数为 0 时继续 <code>countDownLatch.await();</code></li>\n</ul>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CountDownLatchDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//计数器</span></span><br><span class=\"line\">        <span class=\"type\">CountDownLatch</span> <span class=\"variable\">countDownLatch</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CountDownLatch</span>(<span class=\"number\">6</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt; <span class=\"number\">7</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">                System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;走了&quot;</span>);</span><br><span class=\"line\">                <span class=\"comment\">//计数-1</span></span><br><span class=\"line\">                countDownLatch.countDown();</span><br><span class=\"line\">            &#125;,String.valueOf(i)).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//等待</span></span><br><span class=\"line\">        countDownLatch.await();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;班长锁门&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"循环栅栏cyclicbarrier\"><a class=\"markdownIt-Anchor\" href=\"#循环栅栏cyclicbarrier\">#</a> 循环栅栏 CYCLICBARRIER</h4>\n<blockquote>\n<ul>\n<li>\n<p>创建栅栏：</p>\n<p>`CyclicBarrier cyclicBarrier = new CyclicBarrier(7,()-&gt;{</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">    System.out.println(<span class=\"string\">&quot;召唤神龙&quot;</span>);</span><br><span class=\"line\">&#125;);`</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>等待： <code>cyclicBarrier.await();</code></p>\n</li>\n</ul>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CyclicBarrierDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//循环栅栏</span></span><br><span class=\"line\">        <span class=\"type\">CyclicBarrier</span> <span class=\"variable\">cyclicBarrier</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">CyclicBarrier</span>(<span class=\"number\">7</span>,()-&gt;&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;召唤神龙&quot;</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; i &lt;= <span class=\"number\">7</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;星龙珠被找到了&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//等待</span></span><br><span class=\"line\">                    cyclicBarrier.await();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (BrokenBarrierException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,String.valueOf(i)).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"信号灯semaphore\"><a class=\"markdownIt-Anchor\" href=\"#信号灯semaphore\">#</a> 信号灯 SEMAPHORE</h4>\n<blockquote>\n<p>创建： <code>Semaphore semaphore = new Semaphore(3);</code></p>\n<p>占领： <code>semaphore.acquire();</code></p>\n<p>释放： <code>semaphore.release();</code></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 信号灯</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"comment\">//模拟六辆汽车，停3个停车位</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SemaphoreDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//模拟三个车位</span></span><br><span class=\"line\">        <span class=\"type\">Semaphore</span> <span class=\"variable\">semaphore</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Semaphore</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//模拟6辆汽车</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">6</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//占车位</span></span><br><span class=\"line\">                    semaphore.acquire();</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;抢到了车位&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">//设置随机停车时间</span></span><br><span class=\"line\">                    TimeUnit.SECONDS.sleep(<span class=\"keyword\">new</span> <span class=\"title class_\">Random</span>().nextInt(<span class=\"number\">5</span>));</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;----------离开了车位&quot;</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">//释放车位</span></span><br><span class=\"line\">                    semaphore.release();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,String.valueOf(i)).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"读写锁reentrantreadwritelock\"><a class=\"markdownIt-Anchor\" href=\"#读写锁reentrantreadwritelock\">#</a> 读写锁 ReentrantReadWriteLock</h3>\n<h4 id=\"读写锁概念\"><a class=\"markdownIt-Anchor\" href=\"#读写锁概念\">#</a> 读写锁概念</h4>\n<p>现实中有这样一种场景：对共享资源有读和写的操作，且写操作没有读操作那 么频繁。在没有写操作的时候，多个线程同时读一个资源没有任何问题，所以 应该允许多个线程同时读取共享资源；但是如果一个线程想去写这些共享资源， 就不应该允许其他线程对该资源进行读和写的操作了。</p>\n<p>针对这种场景，<strong>JAVA 的并发包提供了读写锁 ReentrantReadWriteLock， 它表示两个锁，一个是读操作相关的锁，称为共享锁；一个是写相关的锁，称为排他锁</strong></p>\n<h4 id=\"演示读写锁\"><a class=\"markdownIt-Anchor\" href=\"#演示读写锁\">#</a> 演示读写锁</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//资源类</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyCache</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> Map&lt;String, String&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//创建读写锁对象</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">ReadWriteLock</span> <span class=\"variable\">readWriteLock</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ReentrantReadWriteLock</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//放数据</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">put</span><span class=\"params\">(String key, String value)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//添加写锁</span></span><br><span class=\"line\">        readWriteLock.writeLock().lock();</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;正在写数据&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//暂停一会</span></span><br><span class=\"line\">            TimeUnit.MICROSECONDS.sleep(<span class=\"number\">300</span>);</span><br><span class=\"line\">            <span class=\"comment\">//放数据</span></span><br><span class=\"line\">            map.put(key, value);</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;写完了&quot;</span> + key);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//释放锁</span></span><br><span class=\"line\">            readWriteLock.writeLock().unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//取数据</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">get</span><span class=\"params\">(String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//添加读锁</span></span><br><span class=\"line\">        readWriteLock.readLock().lock();</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;正在读数据&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//暂停一会</span></span><br><span class=\"line\">            TimeUnit.MICROSECONDS.sleep(<span class=\"number\">300</span>);</span><br><span class=\"line\">            <span class=\"comment\">//放数据</span></span><br><span class=\"line\">            res = map.get(key);</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot;读完了&quot;</span> + key);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">//释放锁</span></span><br><span class=\"line\">            readWriteLock.readLock().unlock();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ReadWriteLockDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">MyCache</span> <span class=\"variable\">myCache</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">MyCache</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//创建线程 放数据</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">finalI</span> <span class=\"operator\">=</span> i;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">                myCache.put(finalI + <span class=\"string\">&quot;&quot;</span>, finalI + <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;, i + <span class=\"string\">&quot;存&quot;</span>).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//创建线程 取数据</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">5</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">finalI</span> <span class=\"operator\">=</span> i;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">                myCache.get(finalI + <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            &#125;, i + <span class=\"string\">&quot;取&quot;</span>).start();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"读写锁演变\"><a class=\"markdownIt-Anchor\" href=\"#读写锁演变\">#</a> 读写锁演变</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/14-%E8%AF%BB%E5%86%99%E9%94%81%E6%BC%94%E5%8F%98.png\" alt=\"14-读写锁演变\"></p>\n<h4 id=\"读写锁的降级\"><a class=\"markdownIt-Anchor\" href=\"#读写锁的降级\">#</a> 读写锁的降级</h4>\n<blockquote>\n<p>写锁 -&gt; 读锁</p>\n</blockquote>\n<p>可以先写不释放锁 然后读</p>\n<p>不可以先读不释放锁 然后写</p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/15-%E8%AF%BB%E5%86%99%E9%94%81%E9%99%8D%E7%BA%A7.png\" alt=\"15-读写锁降级\"></p>\n<h3 id=\"阻塞队列blockingqueue\"><a class=\"markdownIt-Anchor\" href=\"#阻塞队列blockingqueue\">#</a> 阻塞队列 BlockingQueue</h3>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-10-03%2015.55.49.png\" alt=\"截屏2021-10-03 15.55.49\"></p>\n<h4 id=\"分类\"><a class=\"markdownIt-Anchor\" href=\"#分类\">#</a> 分类</h4>\n<ul>\n<li>ArrayBlockingQueue (常用) 有界</li>\n<li>LinkedBlockingQueue (常用) 有界</li>\n</ul>\n<h4 id=\"核心方法\"><a class=\"markdownIt-Anchor\" href=\"#核心方法\">#</a> 核心方法</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-10-03%2016.00.44.png\" alt=\"截屏2021-10-03 16.00.44\"></p>\n<h4 id=\"实现\"><a class=\"markdownIt-Anchor\" href=\"#实现\">#</a> 实现</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">BlockingQueueDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//创建阻塞队列</span></span><br><span class=\"line\">        BlockingQueue&lt;String&gt; blockingQueue = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBlockingQueue</span>&lt;&gt;(<span class=\"number\">3</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//第一组</span></span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;c&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.element());</span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;x&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.remove());</span><br><span class=\"line\">        System.out.println(blockingQueue.remove());</span><br><span class=\"line\">        System.out.println(blockingQueue.remove());</span><br><span class=\"line\">        System.out.println(blockingQueue.remove());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//第二组</span></span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;c&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;x&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.poll());</span><br><span class=\"line\">        System.out.println(blockingQueue.poll());</span><br><span class=\"line\">        System.out.println(blockingQueue.poll());</span><br><span class=\"line\">        System.out.println(blockingQueue.poll());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 第三组</span></span><br><span class=\"line\">        blockingQueue.put(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">        blockingQueue.put(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">        blockingQueue.put(<span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">        blockingQueue.put(<span class=\"string\">&quot;x&quot;</span>);</span><br><span class=\"line\">        System.out.println(blockingQueue.take());</span><br><span class=\"line\">        System.out.println(blockingQueue.take());</span><br><span class=\"line\">        System.out.println(blockingQueue.take());</span><br><span class=\"line\">        System.out.println(blockingQueue.take());</span><br><span class=\"line\">        <span class=\"comment\">//第四组</span></span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;c&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.offer(<span class=\"string\">&quot;a&quot;</span>, <span class=\"number\">3L</span>, TimeUnit.SECONDS));</span><br><span class=\"line\">        <span class=\"comment\">//第一组</span></span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;a&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.add(<span class=\"string\">&quot;c&quot;</span>));</span><br><span class=\"line\">        System.out.println(blockingQueue.element());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"线程池threadpool\"><a class=\"markdownIt-Anchor\" href=\"#线程池threadpool\">#</a> 线程池 ThreadPool</h3>\n<h4 id=\"使用\"><a class=\"markdownIt-Anchor\" href=\"#使用\">#</a> 使用</h4>\n<blockquote>\n<p>三种都是创建 ThreadPoolExecutor</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//演示线程池的三种常用分类</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadPoolDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//一池五线程</span></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">threadPool1</span> <span class=\"operator\">=</span> Executors.newFixedThreadPool(<span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//一池一线程</span></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">threadPool2</span> <span class=\"operator\">=</span> Executors.newSingleThreadExecutor();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//一池可扩容线程</span></span><br><span class=\"line\">        <span class=\"type\">ExecutorService</span> <span class=\"variable\">threadPool3</span> <span class=\"operator\">=</span> Executors.newCachedThreadPool();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//十个顾客请求</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">1000</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//执行</span></span><br><span class=\"line\">                threadPool3.execute(() -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; 办理业务&quot;</span>);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            threadPool3.shutdown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"threadpoolexecutor\"><a class=\"markdownIt-Anchor\" href=\"#threadpoolexecutor\">#</a> THREADPOOLEXECUTOR</h4>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-10-03%2018.01.50.png\" alt=\"截屏2021-10-03 18.01.50\"></p>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/09-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%B8%83%E4%B8%AA%E5%8F%82%E6%95%B0.png\" alt=\"09-线程池七个参数\"></p>\n<h4 id=\"线程池底层工作流程\"><a class=\"markdownIt-Anchor\" href=\"#线程池底层工作流程\">#</a> 线程池底层工作流程</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/10-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%BA%95%E5%B1%82%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png\" alt=\"10-线程池底层工作流程\"></p>\n<ol>\n<li>\n<p>在创建了线程池后，线程池中的线程数为零</p>\n</li>\n<li>\n<p>当调用 execute () 方法添加一个请求任务时，线程池会做出如下判断:</p>\n<p>2.1 如果正在运行的线程数量小于 corePoolSize，那么马上创建线程运行这个任务；</p>\n<p>2.2 如果正在运行的线程数量大于或等于 corePoolSize，那么将这个任务放入 队列；</p>\n<p>2.3 如果这个时候队列满了且正在运行的线程数量还小于 maximumPoolSize，那么还是要创建非核心线程立刻运行这个任务；</p>\n<p>2.4 如 果队列满了且正在运行的线程数量大于或等于 maximumPoolSize，那么线程 池会启动饱和拒绝策略来执行。</p>\n</li>\n<li>\n<p>当一个线程完成任务时，它会从队列中取下一个任务来执行</p>\n</li>\n<li>\n<p>当一个线程无事可做超过一定的时间 (keepAliveTime) 时，线程会判断:</p>\n<p>4.1 如果当前运行的线程数大于 corePoolSize，那么这个线程就被停掉。</p>\n<p>4.2 所以线程池的所有任务完成后，它最终会收缩到 corePoolSize 的大小。</p>\n</li>\n</ol>\n<h4 id=\"拒绝策略\"><a class=\"markdownIt-Anchor\" href=\"#拒绝策略\">#</a> 拒绝策略</h4>\n<p><img data-src=\"https://xysaobi.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-10-03%2018.12.18.png\" alt=\"截屏2021-10-03 18.12.18\"></p>\n<h4 id=\"自定义线程池\"><a class=\"markdownIt-Anchor\" href=\"#自定义线程池\">#</a> 自定义线程池</h4>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyThreadPool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ThreadPoolExecutor</span> <span class=\"variable\">threadPool</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolExecutor</span>(</span><br><span class=\"line\">                <span class=\"number\">2</span>,</span><br><span class=\"line\">                <span class=\"number\">5</span>,</span><br><span class=\"line\">                <span class=\"number\">2L</span>,</span><br><span class=\"line\">                TimeUnit.SECONDS,</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBlockingQueue</span>&lt;&gt;(<span class=\"number\">3</span>),</span><br><span class=\"line\">                Executors.defaultThreadFactory(),</span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//十个顾客请求</span></span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//执行</span></span><br><span class=\"line\">                threadPool.execute(() -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(Thread.currentThread().getName() + <span class=\"string\">&quot; 办理业务&quot;</span>);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            threadPool.shutdown();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"forkjoin分支合并框架\"><a class=\"markdownIt-Anchor\" href=\"#forkjoin分支合并框架\">#</a> Fork/Join 分支合并框架</h3>\n<blockquote>\n<p>Fork/Join 它可以将一个大的任务拆分成多个子任务进行并行处理，最后将子 任务结果合并成最后的计算结果，并进行输出。</p>\n<p>Fork: 把一个复杂任务进行分拆，大事化小</p>\n<p>Join: 把分拆任务的结果进行合并</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Mytask</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">RecursiveTask</span>&lt;Integer&gt; &#123;</span><br><span class=\"line\">    <span class=\"comment\">//拆分差值不超过10,计算10以内的运算</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Integer</span> <span class=\"variable\">VALUE</span> <span class=\"operator\">=</span> <span class=\"number\">10</span>;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> begin; <span class=\"comment\">//拆分开始值</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> end; <span class=\"comment\">//拆分结束值</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> result; <span class=\"comment\">//返回结果</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Mytask</span><span class=\"params\">(<span class=\"type\">int</span> begin, <span class=\"type\">int</span> end)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.begin = begin;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.end = end;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> Integer <span class=\"title function_\">compute</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> ((end - begin) &lt; VALUE) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//相加</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> begin; i &lt;= end; i++) &#123;</span><br><span class=\"line\">                result += i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;<span class=\"comment\">//进一步拆分</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">middle</span> <span class=\"operator\">=</span> (begin + end) / <span class=\"number\">2</span>;</span><br><span class=\"line\">            <span class=\"type\">Mytask</span> <span class=\"variable\">taskLeft</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Mytask</span>(begin, middle);</span><br><span class=\"line\">            <span class=\"type\">Mytask</span> <span class=\"variable\">taskRight</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Mytask</span>(middle+<span class=\"number\">1</span>, end);</span><br><span class=\"line\"></span><br><span class=\"line\">            taskLeft.fork();</span><br><span class=\"line\">            taskRight.fork();</span><br><span class=\"line\">            result = taskLeft.join()+taskRight.join();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ForkJoinDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//创建MyTask对象</span></span><br><span class=\"line\">        <span class=\"type\">Mytask</span> <span class=\"variable\">mytask</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Mytask</span>(<span class=\"number\">0</span>,<span class=\"number\">100</span>);</span><br><span class=\"line\">        <span class=\"comment\">//创建分支合并池对象</span></span><br><span class=\"line\">        <span class=\"type\">ForkJoinPool</span> <span class=\"variable\">forkJoinPool</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ForkJoinPool</span>();</span><br><span class=\"line\">        ForkJoinTask&lt;Integer&gt; submit = forkJoinPool.submit(mytask);</span><br><span class=\"line\">        <span class=\"comment\">//获取结果</span></span><br><span class=\"line\">        <span class=\"type\">Integer</span> <span class=\"variable\">integer</span> <span class=\"operator\">=</span> submit.get();</span><br><span class=\"line\">        System.out.println(integer);</span><br><span class=\"line\">        <span class=\"comment\">//关闭池对象</span></span><br><span class=\"line\">        forkJoinPool.shutdown();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"异步回调completablefuture\"><a class=\"markdownIt-Anchor\" href=\"#异步回调completablefuture\">#</a> 异步回调 CompletableFuture</h3>\n<blockquote>\n<p>CompletableFuture 在 Java 里面被用于异步编程，异步通常意味着非阻塞， 可以使得我们的任务单独运行在与主线程分离的其他线程中，并且通过回调可 以在主线程中得到异步任务的执行状态，是否完成，和是否异常等信息。</p>\n</blockquote>\n<p>简单实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CompletableFutureDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//异步调用 没有返回值</span></span><br><span class=\"line\">        CompletableFuture&lt;Void&gt; completableFuture1 = CompletableFuture.runAsync(()-&gt;&#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;completableFuture1&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        completableFuture1.get();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//异步调用 有返回值</span></span><br><span class=\"line\">        CompletableFuture&lt;Integer&gt; completableFuture2 = CompletableFuture.supplyAsync(()-&gt;&#123;</span><br><span class=\"line\">            System.out.println(Thread.currentThread().getName()+<span class=\"string\">&quot;completableFuture2&quot;</span>);</span><br><span class=\"line\">            <span class=\"comment\">//模拟异常</span></span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>/<span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"type\">Integer</span> <span class=\"variable\">integer</span> <span class=\"operator\">=</span> completableFuture2.whenComplete((t,u)-&gt;&#123;</span><br><span class=\"line\">            System.out.println(t); <span class=\"comment\">// 2：方法返回值</span></span><br><span class=\"line\">            System.out.println(u); <span class=\"comment\">// null：异常信息</span></span><br><span class=\"line\">        &#125;).get();</span><br><span class=\"line\">        System.out.println(integer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Hexo/",
            "url": "http://example.com/2022/12/27/Hexo/",
            "title": "Hexo搭建",
            "date_published": "2022-12-27T08:18:48.576Z",
            "content_html": "<h1 id=\"hexo框架个人博客搭建\"><a class=\"markdownIt-Anchor\" href=\"#hexo框架个人博客搭建\">#</a> hexo 框架个人博客搭建</h1>\n<h2 id=\"1-环境准备\"><a class=\"markdownIt-Anchor\" href=\"#1-环境准备\">#</a> 1 环境准备</h2>\n<h3 id=\"11-nodejs和npm安装\"><a class=\"markdownIt-Anchor\" href=\"#11-nodejs和npm安装\">#</a> 1.1 Node.js 和 npm 安装</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NoedJS自行百度安装</span><br></pre></td></tr></table></figure>\n<h3 id=\"12选-npm-淘宝镜像\"><a class=\"markdownIt-Anchor\" href=\"#12选-npm-淘宝镜像\">#</a> 1.2 (选) npm 淘宝镜像</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g cnpm --registry.npm.taobao.org</span><br></pre></td></tr></table></figure>\n<h3 id=\"13-hexo框架安装\"><a class=\"markdownIt-Anchor\" href=\"#13-hexo框架安装\">#</a> 1.3 hexo 框架安装</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>\n<h3 id=\"14git安装配置\"><a class=\"markdownIt-Anchor\" href=\"#14git安装配置\">#</a> 1.4git 安装配置</h3>\n<ol>\n<li>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXQtc2NtLmNvbS9kb3dubG9hZA==\">git 官网</span> 下载对应系统安装包</p>\n</li>\n<li>\n<p>运行安装包 一路下一步</p>\n</li>\n<li>\n<p>开始菜单运行 Git Bash (运行成功表示 git 安装成功)</p>\n</li>\n<li>\n<p>git 安装好去 GitHub 上注册一个账号</p>\n</li>\n<li>\n<p>设置 git：在 Git Bush 命令行中输入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 配置用户名</span><br><span class=\"line\">git config --global user.name &quot;username&quot;    //（ &quot;username&quot;是自己的账户名）</span><br><span class=\"line\"># 配置邮箱</span><br><span class=\"line\">git config --global user.email &quot;username@email.com&quot;     //(&quot;username@email.com&quot;注册账号时用的邮箱)</span><br></pre></td></tr></table></figure>\n<p>以上命令执行结束后，可用 git config –global –list 命令查看配置是否 OK</p>\n</li>\n<li>\n<p>生成 ssh, 在命令框中输入以下命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>连续敲三次回车，结束后去系统盘目录下（一般在 C:\\Users\\ 你的用户名.ssh）(mac: /Users/ 用户 /.ssh）查看是否有：ssh 文件夹生成<br>\n \\7. 将 ssh 文件夹中的公钥（ id_rsa.pub）添加到 GitHub 管理平台中，在 GitHub 的个人账户的设置中找到如下界面</p>\n<p><img data-src=\"http://m.qpic.cn/psc?/V13GZ6V642zl3l/LjNfElrpEt6hXz54k3bCMchAT9Eqb8h826wZJlbf5XTg7bk2vbn8iPBmpUMKdT*qmYTTTu6PvI2OOXduLhX4YWkD8PDL7HQ0zwtH8In.gVk!/b&amp;bo=8wKMAQAAAAADB14!&amp;rf=viewer_4\" alt=\"20181012202024433\"></p>\n<p>title 随便起一个，将公钥（ id_rsa.pub）文件中内容复制粘贴到 key 中，然后点击 Ass SSH key 就好啦</p>\n<h2 id=\"2-建立本地网站\"><a class=\"markdownIt-Anchor\" href=\"#2-建立本地网站\">#</a> 2 建立本地网站</h2>\n<h3 id=\"21-在本地建立一个文件夹\"><a class=\"markdownIt-Anchor\" href=\"#21-在本地建立一个文件夹\">#</a> 2.1 在本地建立一个文件夹</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">去任意盘符下，建立一个文件夹，这个文件夹就是你的博客文件夹</span><br></pre></td></tr></table></figure>\n<h3 id=\"22-cmd命令进入这个文件夹\"><a class=\"markdownIt-Anchor\" href=\"#22-cmd命令进入这个文件夹\">#</a> 2.2 cmd 命令进入这个文件夹</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">进入文件夹后，路径输入cmd进入命令提示符窗口</span><br></pre></td></tr></table></figure>\n<h3 id=\"23-hxeo生成博客\"><a class=\"markdownIt-Anchor\" href=\"#23-hxeo生成博客\">#</a> 2.3 hxeo 生成博客</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo hexo init</span><br></pre></td></tr></table></figure>\n<h3 id=\"24-启动博客\"><a class=\"markdownIt-Anchor\" href=\"#24-启动博客\">#</a> 2.4 启动博客</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo s</span><br></pre></td></tr></table></figure>\n<p>进入网站 说明建立成功</p>\n<h2 id=\"3-上传至github\"><a class=\"markdownIt-Anchor\" href=\"#3-上传至github\">#</a> 3 上传至 github</h2>\n<h3 id=\"31-建立仓库\"><a class=\"markdownIt-Anchor\" href=\"#31-建立仓库\">#</a> 3.1 建立仓库</h3>\n<ol>\n<li>登录 github 新建一个仓库</li>\n<li>仓库名必须是 “&lt;&lt;你的 Github 名字&gt;&gt;.github.io”</li>\n</ol>\n<h3 id=\"32-在博客目录安装git插件\"><a class=\"markdownIt-Anchor\" href=\"#32-在博客目录安装git插件\">#</a> 3.2 在博客目录安装 git 插件</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install --save hexo-deployer-git</span><br></pre></td></tr></table></figure>\n<h3 id=\"33-设置文件_configyml最底部\"><a class=\"markdownIt-Anchor\" href=\"#33-设置文件_configyml最底部\">#</a> 3.3 设置文件 “_config.yml”（最底部）</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">     type: git</span><br><span class=\"line\">     repo: //仓库的ssh地址</span><br><span class=\"line\">     branch: master</span><br></pre></td></tr></table></figure>\n<h3 id=\"34-部署到远端\"><a class=\"markdownIt-Anchor\" href=\"#34-部署到远端\">#</a> 3.4 部署到远端</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo d //需要登陆</span><br></pre></td></tr></table></figure>\n<h3 id=\"35-访问\"><a class=\"markdownIt-Anchor\" href=\"#35-访问\">#</a> 3.5 访问</h3>\n<p>”https://&lt;&lt;你的 username&gt;&gt;.github.io“</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">补充命令：</span><br><span class=\"line\"></span><br><span class=\"line\">hexo clean 清理博客</span><br><span class=\"line\"></span><br><span class=\"line\">hexo generate 同步博客</span><br><span class=\"line\"></span><br><span class=\"line\">hexo deploy 提交博客</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Hbase%E5%AD%A6%E4%B9%A0/",
            "url": "http://example.com/2022/12/27/Hbase%E5%AD%A6%E4%B9%A0/",
            "title": "Hbase",
            "date_published": "2022-12-27T08:18:48.574Z",
            "content_html": "<h2 id=\"介绍\"><a class=\"markdownIt-Anchor\" href=\"#介绍\">#</a> 介绍：</h2>\n<p>​\t\tHbase 是 bigtable 的开源山寨版本。是建立在 HDFS 之上，提供高可靠性、高性能、列存储、可伸缩、实时读写的数据库系统。它介于 nosql 和 RDBMS 之间，仅能通过主键 (row key) 和主键的 range 来检索数据，仅支持单行事务 (可通过 hive 支持来实现多表 join 等复杂操作)。主要用来存储非结构化和半结构化的松散数据。与 hadoop 一样，Hbase 目标主要依靠横向扩展，通过不断增加廉价的商用服务器，来增加计算和存储能力。</p>\n<h2 id=\"特点\"><a class=\"markdownIt-Anchor\" href=\"#特点\">#</a> 特点：</h2>\n<p>​\t\tHBase 中的表一般有这样的特点：</p>\n<ol>\n<li>\n<p>大：一个表可以有上亿行，上百万列</p>\n</li>\n<li>\n<p>面向列：面向列 (族) 的存储和权限控制，列 (族) 独立检索。</p>\n</li>\n<li>\n<p>稀疏：对于为空 (null) 的列，并不占用存储空间，因此，表可以设计的非常稀疏。</p>\n</li>\n</ol>\n<p>下面一幅图是 Hbase 在 Hadoop Ecosystem 中的位置。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160429998.png\" alt=\"20180608160429998\"></p>\n<h2 id=\"二-逻辑视图\"><a class=\"markdownIt-Anchor\" href=\"#二-逻辑视图\">#</a> 二、 逻辑视图</h2>\n<p>HBase 以表的形式存储数据。表有行和列组成。列划分为若干个列族 (row family)</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160501841.png\" alt=\"20180608160501841\"></p>\n<p>Row Key</p>\n<p>与 nosql 数据库们一样，row key 是用来检索记录的主键。访问 hbase table 中的行，只有三种方式：</p>\n<p>1 通过单个 row key 访问</p>\n<p>2 通过 row key 的 range</p>\n<p>3 全表扫描</p>\n<p>Row key 行键 (Row key) 可以是任意字符串 (最大长度是 64KB，实际应用中长度一般为 10-100bytes)，在 hbase 内部，row key 保存为字节数组。</p>\n<p>存储时，数据按照 Row key 的字典序 (byte order) 排序存储。设计 key 时，要充分排序存储这个特性，将经常一起读取的行存储放到一起。(位置相关性)</p>\n<p>注意：</p>\n<p>字典序对 int 排序的结果是 1,10,100,11,12,13,14,15,16,17,18,19,2,20,21,…,9,91,92,93,94,95,96,97,98,99。要保持整形的自然序，行键必须用 0 作左填充。</p>\n<p>行的一次读写是原子操作 (不论一次读写多少列)。这个设计决策能够使用户很容易的理解程序在对同一个行进行并发更新操作时的行为。</p>\n<p>列族</p>\n<p>hbase 表中的每个列，都归属与某个列族。列族是表的 chema 的一部分 (而列不是)，必须在使用表之前定义。列名都以列族作为前缀。例如<em> courses:history ， courses:math 都属于 courses</em> 这个列族。</p>\n<p>访问控制、磁盘和内存的使用统计都是在列族层面进行的。实际应用中，列族上的控制权限能 帮助我们管理不同类型的应用：我们允许一些应用可以添加新的基本数据、一些应用可以读取基本数据并创建继承的列族、一些应用则只允许浏览数据（甚至可能因 为隐私的原因不能浏览所有数据）。</p>\n<p>时间戳</p>\n<p>HBase 中通过 row 和 columns 确定的为一个存贮单元称为 cell。每个 cell 都保存着同一份数据的多个版本。版本通过时间戳来索引。时间戳的类型是 64 位整型。时间戳可以由 hbase (在数据写入时自动) 赋值，此时时间戳是精确到毫秒的当前系统时间。时间戳也可以由客户显式赋值。如果应用程序要避免数据版本冲突，就必须自己生成具有唯一性的时间戳。每个 cell 中，不同版本的数据按照时间倒序排序，即最新的数据排在最前面。</p>\n<p>为了避免数据存在过多版本造成的的管理 (包括存贮和索引) 负担，hbase 提供了两种数据版本回收方式。一是保存数据的最后 n 个版本，二是保存最近一段时间内的版本（比如最近七天）。用户可以针对每个列族进行设置。</p>\n<p>Cell</p>\n<p>由 *{row key, column (* =<family> + <label><em>), version}</em> 唯一确定的单元。cell 中的数据是没有类型的，全部是字节码形式存贮。</p>\n<h2 id=\"三-物理存储\"><a class=\"markdownIt-Anchor\" href=\"#三-物理存储\">#</a> 三、 物理存储</h2>\n<p>1 . 已经提到过，Table 中的所有行都按照 row key 的字典序排列。</p>\n<p>2 . Table 在行的方向上分割为多个 Hregion。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C2018060816055431.png\" alt=\"2018060816055431\"></p>\n<p>3 .  region 按大小分割的，每个表一开始只有一个 region，随着数据不断插入表，region 不断增大，当增大到一个阀值的时候，Hregion 就会等分会两个新的 Hregion。当 table 中的行不断增多，就会有越来越多的 Hregion。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160613225.png\" alt=\"20180608160613225\"></p>\n<p>4 . Hregion 是 Hbase 中分布式存储和负载均衡的最小单元。最小单元就表示不同的 Hregion 可以分布在不同的 HRegion server 上。但一个 Hregion 是不会拆分到多个 server 上的。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160632130.png\" alt=\"20180608160632130\"></p>\n<p>5 . HRegion 虽然是分布式存储的最小单元，但并不是存储的最小单元。</p>\n<p>事实上，HRegion 由一个或者多个 Store 组成，每个 store 保存一个 columns family。</p>\n<p>每个 Strore 又由一个 memStore 和 0 至多个 StoreFile 组成。如图：</p>\n<p>StoreFile 以 HFile 格式保存在 HDFS 上。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C2018060816065423.png\" alt=\"2018060816065423\"></p>\n<p>HFile 的格式为：<img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160715293.png\" alt=\"20180608160715293\"></p>\n<p>Trailer 部分的格式:</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160733415.png\" alt=\"20180608160733415\"></p>\n<p>HFile 分为六个部分：</p>\n<p>Data Block 段–保存表中的数据，这部分可以被压缩</p>\n<p>Meta Block 段 (可选的)–保存用户自定义的 kv 对，可以被压缩。</p>\n<p>File Info 段–Hfile 的元信息，不被压缩，用户也可以在这一部分添加自己的元信息。</p>\n<p>Data Block Index 段–Data Block 的索引。每条索引的 key 是被索引的 block 的第一条记录的 key。</p>\n<p>Meta Block Index 段 (可选的)–Meta Block 的索引。</p>\n<p>Trailer–这一段是定长的。保存了每一段的偏移量，读取一个 HFile 时，会首先 读取 Trailer，Trailer 保存了每个段的起始位置 (段的 Magic Number 用来做安全 check)，然后，DataBlock Index 会被读取到内存中，这样，当检索某个 key 时，不需要扫描整个 HFile，而只需从内存中找到 key 所在的 block，通过一次磁盘 io 将整个 block 读取到内存中，再找到需要的 key。DataBlock Index 采用 LRU 机制淘汰。</p>\n<p>HFile 的 Data Block，Meta Block 通常采用压缩方式存储，压缩之后可以大大减少网络 IO 和磁盘 IO，随之而来的开销当然是需要花费 cpu 进行压缩和解压缩。</p>\n<p>目标 Hfile 的压缩支持两种方式：Gzip，Lzo。</p>\n<p>HLog(WAL log)</p>\n<p>WAL 意为 Write ahead log (<span class=\"exturl\" data-url=\"aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Xcml0ZS1haGVhZF9sb2dnaW5n\">http://en.wikipedia.org/wiki/Write-ahead_logging</span>)，类似 mysql 中的 binlog, 用来 做灾难恢复只用，Hlog 记录数据的所有变更，一旦数据修改，就可以从 log 中进行恢复。</p>\n<p>每个 Region Server 维护一个 Hlog, 而不是每个 Region 一个。这样不同 region (来自不同 table) 的日志会混在一起，这样做的目的是不断追加单个 文件相对于同时写多个文件而言，可以减少磁盘寻址次数，因此可以提高对 table 的写性能。带来的麻烦是，如果一台 region server 下线，为了恢复其上的 region，需要将 region server 上的 log 进行拆分，然后分发到其它 region server 上进行恢复。</p>\n<p>HLog 文件就是一个普通的 Hadoop Sequence File，Sequence File 的 Key 是 HLogKey 对象，HLogKey 中记录了写入数据的归属信息，除了 table 和 region 名字外，同时还包括 sequence number 和 timestamp，timestamp 是” 写入时间”，sequence number 的起始值为 0，或者是最近一次存入文件系统中 sequence number。HLog Sequece File 的 Value 是 HBase 的 KeyValue 对象，即对应 HFile 中的 KeyValue，可参见上文描述。</p>\n<h2 id=\"四-系统架构\"><a class=\"markdownIt-Anchor\" href=\"#四-系统架构\">#</a> 四、 系统架构</h2>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160828501.png\" alt=\"20180608160828501\"></p>\n<p>Client</p>\n<p>1 包含访问 hbase 的接口，client 维护着一些 cache 来加快对 hbase 的访问，比如 regione 的位置信息。</p>\n<p>Zookeeper</p>\n<p>1 保证任何时候，集群中只有一个 master</p>\n<p>2 存贮所有 Region 的寻址入口。</p>\n<p>3 实时监控 Region Server 的状态，将 Region server 的上线和下线信息实时通知给 Master</p>\n<p>4 存储 Hbase 的 schema, 包括有哪些 table，每个 table 有哪些 column family</p>\n<p>Master</p>\n<p>1 为 Region server 分配 region</p>\n<p>2 负责 region server 的负载均衡</p>\n<p>3 发现失效的 region server 并重新分配其上的 region</p>\n<p>4 GFS 上的垃圾文件回收</p>\n<p>5 处理 schema 更新请求</p>\n<p>Region Server</p>\n<p>1 Region server 维护 Master 分配给它的 region，处理对这些 region 的 IO 请求</p>\n<p>2 Region server 负责切分在运行过程中变得过大的 region</p>\n<p>可以看到，client 访问 hbase 上数据的过程并不需要 master 参与（寻址访问 zookeeper 和 region server，数据读写访问 regione server），master 仅仅维护者 table 和 region 的元数据信息，负载很低。</p>\n<h2 id=\"五-关键算法-流程\"><a class=\"markdownIt-Anchor\" href=\"#五-关键算法-流程\">#</a> 五、关键算法 / 流程</h2>\n<p>region 定位</p>\n<p>系统如何找到某个 row key (或者某个 row key range) 所在的 region</p>\n<p>bigtable 使用三层类似 B + 树的结构来保存 region 位置。</p>\n<p>第一层是保存 zookeeper 里面的文件，它持有 root region 的位置。</p>\n<p>第二层 root region 是.META. 表的第一个 region 其中保存了.META.z 表其它 region 的位置。通过 root region，我们就可以访问.META. 表的数据。</p>\n<p>.META. 是第三层，它是一个特殊的表，保存了 hbase 中所有数据表的 region 位置信息。</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160858652.png\" alt=\"20180608160858652\"></p>\n<p>说明：</p>\n<p>1 root region 永远不会被 split，保证了最需要三次跳转，就能定位到任意 region 。</p>\n<p>2.META. 表每行保存一个 region 的位置信息，row key 采用表名 + 表的最后一样编码而成。</p>\n<p>3 为了加快访问，.META. 表的全部 region 都保存在内存中。</p>\n<p>假设，.META. 表的一行在内存中大约占用 1KB。并且每个 region 限制为 128MB。</p>\n<p>那么上面的三层结构可以保存的 region 数目为：</p>\n<p>(128MB/1KB) * (128MB/1KB) = = 2 (34) 个 region</p>\n<p>4 client 会将查询过的位置信息保存缓存起来，缓存不会主动失效，因此如果 client 上的缓存全部失效，则需要进行 6 次网络来回，才能定位到正确的 region (其中三次用来发现缓存失效，另外三次用来获取位置信息)。</p>\n<p>读写过程</p>\n<p>上文提到，hbase 使用 MemStore 和 StoreFile 存储对表的更新。</p>\n<p>数据在更新时首先写入 Log (WAL log) 和内存 (MemStore) 中，MemStore 中的数据是排序的，当 MemStore 累计到一定阈值时，就会创建一个新的 MemStore，并 且将老的 MemStore 添加到 flush 队列，由单独的线程 flush 到磁盘上，成为一个 StoreFile。于此同时，系统会在 zookeeper 中 记录一个 redo point，表示这个时刻之前的变更已经持久化了。(minor compact)</p>\n<p>当系统出现意外时，可能导致内存 (MemStore) 中的数据丢失，此时使用 Log (WAL log) 来恢复 checkpoint 之后的数据。</p>\n<p>前面提到过 StoreFile 是只读的，一旦创建后就不可以再修改。因此 Hbase 的更 新其实是不断追加的操作。当一个 Store 中的 StoreFile 达到一定的阈值后，就会进行一次合并 (major compact), 将对同一个 key 的修改合并到一起，形成一个大的 StoreFile，当 StoreFile 的大小达到一定阈值后，又会对 StoreFile 进行 split，等分为两个 StoreFile。</p>\n<p>由于对表的更新是不断追加的，处理读请求时，需要访问 Store 中全部的 StoreFile 和 MemStore，将他们的按照 row key 进行合并，由于 StoreFile 和 MemStore 都是经过排序的，并且 StoreFile 带有内存中索引，合并的过程还是比较快。</p>\n<p>写请求处理过程</p>\n<p><img data-src=\"f:%5Cmd%E5%9B%BE%E7%89%87%5C20180608160916374.png\" alt=\"20180608160916374\"></p>\n<p>1 client 向 region server 提交写请求</p>\n<p>2 region server 找到目标 region</p>\n<p>3 region 检查数据是否与 schema 一致</p>\n<p>4 如果客户端没有指定版本，则获取当前系统时间作为数据版本</p>\n<p>5 将更新写入 WAL log</p>\n<p>6 将更新写入 Memstore</p>\n<p>7 判断 Memstore 的是否需要 flush 为 Store 文件。</p>\n<p>region 分配</p>\n<p>任何时刻，一个 region 只能分配给一个 region server。master 记录了当前有哪些可用的 region server。以及当前哪些 region 分配给了哪些 region server，哪些 region 还没有分配。当存在未分配的 region，并且有一个 region server 上有可用空间时，master 就给这个 region server 发送一个装载请求，把 region 分配给这个 region server。region server 得到请求后，就开始对此 region 提供服务。</p>\n<p>region server 上线</p>\n<p>master 使用 zookeeper 来跟踪 region server 状态。当某个 region server 启动时，会首先在 zookeeper 上的 server 目录下建立代表自己的文件，并获得该文件的独占锁。由于 master 订阅了 server 目录上的变更消息，当 server 目录下的文件出现新增或删除操作时，master 可以得到来自 zookeeper 的实时通知。因此一旦 region server 上线，master 能马上得到消息。</p>\n<p>region server 下线</p>\n<p>当 region server 下线时，它和 zookeeper 的会话断开，zookeeper 而自动释放代表这台 server 的文件上的独占锁。而 master 不断轮询 server 目录下文件的锁状态。如果 master 发现某个 region server 丢失了它自己的独占锁，(或者 master 连续几次和 region server 通信都无法成功),master 就是尝试去获取代表这个 region server 的读写锁，一旦获取成功，就可以确定：</p>\n<p>1 region server 和 zookeeper 之间的网络断开了。</p>\n<p>2 region server 挂了。</p>\n<p>的其中一种情况发生了，无论哪种情况，region server 都无法继续为它的 region 提供服务了，此时 master 会删除 server 目录下代表这台 region server 的文件，并将这台 region server 的 region 分配给其它还活着的同志。</p>\n<p>如果网络短暂出现问题导致 region server 丢失了它的锁，那么 region server 重新连接到 zookeeper 之后，只要代表它的文件还在，它就会不断尝试获取这个文件上的锁，一旦获取到了，就可以继续提供服务。</p>\n<p>master 上线</p>\n<p>master 启动进行以下步骤:</p>\n<p>1 从 zookeeper 上获取唯一一个代码 master 的锁，用来阻止其它 master 成为 master。</p>\n<p>2 扫描 zookeeper 上的 server 目录，获得当前可用的 region server 列表。</p>\n<p>3 和 2 中的每个 region server 通信，获得当前已分配的 region 和 region server 的对应关系。</p>\n<p>4 扫描.META.region 的集合，计算得到当前还未分配的 region，将他们放入待分配 region 列表。</p>\n<p>master 下线</p>\n<p>由于 master 只维护表和 region 的元数据，而不参与表数据 IO 的过 程，master 下线仅导致所有元数据的修改被冻结 (无法创建删除表，无法修改表的 schema，无法进行 region 的负载均衡，无法处理 region 上下线，无法进行 region 的合并，唯一例外的是 region 的 split 可以正常进行，因为只有 region server 参与)，表的数据读写还可以正常进行。因此 master 下线短时间内对整个 hbase 集群没有影响。从上线过程可以看到，master 保存的 信息全是可以冗余信息（都可以从系统其它地方收集到或者计算出来），因此，一般 hbase 集群中总是有一个 master 在提供服务，还有一个以上 的’master’在等待时机抢占它的位置。</p>\n<p>六、访问接口</p>\n<ul>\n<li>HBase Shell</li>\n<li>Java clietn API</li>\n<li>HBase non-java access</li>\n<li>\n<ul>\n<li>languages talking to the JVM</li>\n<li>\n<ul>\n<li>Jython interface to HBase</li>\n<li>Groovy DSL for HBase</li>\n<li>Scala interface to HBase</li>\n</ul>\n</li>\n<li>languages with a custom protocol</li>\n<li>\n<ul>\n<li>REST gateway specification for HBase</li>\n<li>充分利用 HTTP 协议：GET POST PUT DELETE</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>§</p>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li>text/plain</li>\n<li>text/xml</li>\n<li>application/json</li>\n<li>application/x-protobuf</li>\n</ul>\n</li>\n<li>Thrift gateway specification for HBase</li>\n<li>\n<ul>\n<li>java</li>\n<li>cpp</li>\n<li>rb</li>\n<li>py</li>\n<li>perl</li>\n<li>php</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>HBase Map Reduce</li>\n<li>Hive/Pig</li>\n</ul>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Hbase%E4%B8%8Eswagger%E4%B8%8Eguava%E4%BE%9D%E8%B5%96%E9%94%99%E8%AF%AF/",
            "url": "http://example.com/2022/12/27/Hbase%E4%B8%8Eswagger%E4%B8%8Eguava%E4%BE%9D%E8%B5%96%E9%94%99%E8%AF%AF/",
            "title": "Hbase整合SpringBoot的问题",
            "date_published": "2022-12-27T08:18:48.571Z",
            "content_html": "<p>在一个 Demo 中，springboot 整合 Hbase 出了一个难解决的问题：</p>\n<p>tried to access method com.google.common.base.Stopwatch.<init>()V from class org.apache.hadoop.hbase.zookeeper.MetaTableLocator</p>\n<p>调用 hbase 就会报错，这是因为 swagger 和 guava 依赖冲突导致的，整合 habse 的 1.0 版本，依赖中不能有 swagger，guava 的版本要低于 17.</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Github%E8%AE%BF%E9%97%AE%E5%8A%A0%E9%80%9F/",
            "url": "http://example.com/2022/12/27/Github%E8%AE%BF%E9%97%AE%E5%8A%A0%E9%80%9F/",
            "title": "Github访问加速方法",
            "date_published": "2022-12-27T08:18:48.569Z",
            "content_html": "<h2 id=\"1-获取延迟最小ip地址\"><a class=\"markdownIt-Anchor\" href=\"#1-获取延迟最小ip地址\">#</a> 1. 获取延迟最小 IP 地址</h2>\n<p>首先，打开</p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovL3Rvb2wuY2hpbmF6LmNvbS9kbnM/dHlwZT0xJmFtcDtob3N0PWdpdGh1Yi5jb20mYW1wO2lwPQ==\">http://tool.chinaz.com/dns?type=1&amp;host=github.com&amp;ip=</span></p>\n<p>查询 Github 的地址，选择延迟最小的</p>\n<p><img data-src=\"E:%5Cmd%E5%9B%BE%E7%89%87%5C1640222585966.png\" alt=\"1640222585966\"></p>\n<h2 id=\"2-修改系统hosts文件\"><a class=\"markdownIt-Anchor\" href=\"#2-修改系统hosts文件\">#</a> <strong>2. 修改系统 Hosts 文件</strong></h2>\n<p>接着，打开系统 hosts 文件 (需管理员权限)。<br>\n路径：C:\\Windows\\System32\\drivers\\etc</p>\n<blockquote>\n<p>mac 或者其他 linux 系统的话，是 /etc 下的 hosts 文件，需要切入到 root 用户修改</p>\n</blockquote>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># Copyright (c) 1993-2009 Microsoft Corp. </span><br><span class=\"line\"># </span><br><span class=\"line\"># This is a sample HOSTS file used by Microsoft TCP/IP for Windows. </span><br><span class=\"line\"># </span><br><span class=\"line\"># This file contains the mappings of IP addresses to host names. Each </span><br><span class=\"line\"># entry should be kept on an individual line. The IP address should </span><br><span class=\"line\"># be placed in the first column followed by the corresponding host name. </span><br><span class=\"line\"># The IP address and the host name should be separated by at least one </span><br><span class=\"line\"># space. </span><br><span class=\"line\"># </span><br><span class=\"line\"># Additionally, comments (such as these) may be inserted on individual </span><br><span class=\"line\"># lines or following the machine name denoted by a &#x27;#&#x27; symbol. </span><br><span class=\"line\"># </span><br><span class=\"line\"># For example: </span><br><span class=\"line\"># </span><br><span class=\"line\">#      102.54.94.97     rhino.acme.com          # source server </span><br><span class=\"line\">#       38.25.63.10     x.acme.com              # x client host </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># localhost name resolution is handled within DNS itself. </span><br><span class=\"line\">#   127.0.0.1       localhost </span><br><span class=\"line\">#   ::1             localhost </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">52.192.72.89    github.com</span><br></pre></td></tr></table></figure>\n<p>并在末尾添加记录并保存。(需管理员权限，注意 IP 地址与域名间需留有空格)</p>\n<h2 id=\"3-刷新系统dns缓存\"><a class=\"markdownIt-Anchor\" href=\"#3-刷新系统dns缓存\">#</a> <strong>3. 刷新系统 DNS 缓存</strong></h2>\n<p>最后，Windows+X 打开系统命令行（管理员身份）或 powershell</p>\n<p>运行 ipconfig /flushdns 手动刷新系统 DNS 缓存。</p>\n<blockquote>\n<p>mac 系统修改完 hosts 文件，保存并退出就可以了。不要要多一步刷新操作.<br>\ncentos 系统执行 /etc/init.d/network restart 命令 使得 hosts 生效</p>\n</blockquote>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Flutter%E9%87%8D%E5%A4%8D%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2GIF%E4%B8%8D%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/",
            "url": "http://example.com/2022/12/27/Flutter%E9%87%8D%E5%A4%8D%E8%BF%9B%E5%85%A5%E9%A1%B5%E9%9D%A2GIF%E4%B8%8D%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98/",
            "title": "Flutter下加载本地资源GIF，怎么做到每次进入页面都会出现动画效果？",
            "date_published": "2022-12-27T08:18:48.567Z",
            "content_html": "<p>1. 问题：Flutter 加载 GIF 之后，只有第一次进入页面才会执行动画，接下来都不会执行了<br>\n 2. 原因：因为 Flutter 的图片缓存机制，在第一次加载图片后，会将图片缓存下来，所以再次访问，你看见的还是上次的已经执行完毕的动画<br>\n 3. 解决：在 dispose 中把 imageCache 用 clear 方法清理掉</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">String</span> asset = <span class=\"string\">&quot;images/401.gif&quot;</span>;</span><br><span class=\"line\">Widget img = Image.asset(<span class=\"string\">&quot;images/401.gif&quot;</span>,key: UniqueKey(),);</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"meta\">@override</span></span><br><span class=\"line\"> <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">   <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">     <span class=\"comment\">//初始化</span></span><br><span class=\"line\">   toast();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"meta\">@override</span></span><br><span class=\"line\"> <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">   <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">     <span class=\"comment\">//清理缓存</span></span><br><span class=\"line\">\timageCache!.clear();</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"keyword\">void</span> toast() &#123;</span><br><span class=\"line\">   DialogUtils.showErrorMessage(<span class=\"string\">&quot;401&quot;</span>,</span><br><span class=\"line\">       gravity: ToastGravity.CENTER, toastLength: Toast.LENGTH_SHORT);</span><br><span class=\"line\"></span><br><span class=\"line\">   Future.delayed(<span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">3</span>), () &#123;</span><br><span class=\"line\">     DialogUtils.showMessage(<span class=\"string\">&quot;您没有权限访问......&quot;</span>,</span><br><span class=\"line\">         gravity: ToastGravity.CENTER, toastLength: Toast.LENGTH_LONG);</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Flutter%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Flutter%E6%96%87%E6%A1%A3/",
            "title": "Flutter全网最全学习笔记！",
            "date_published": "2022-12-27T08:18:48.564Z",
            "content_html": "<h1 id=\"flutter学习文档authorbrath\"><a class=\"markdownIt-Anchor\" href=\"#flutter学习文档authorbrath\">#</a> Flutter 学习文档 —Author：Brath</h1>\n<p><img data-src=\"https://brath.cloud/blogImg/4d4dd7f20a6a494282214c730611df0e.webp\" alt=\"img\"><img data-src=\"data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==\" alt=\"点击并拖拽以移动\"></p>\n<h4 id=\"欢迎来到-brath-的-csdn-博客你也可访问-brathtop-到我的个人博客来进行观看\"><a class=\"markdownIt-Anchor\" href=\"#欢迎来到-brath-的-csdn-博客你也可访问-brathtop-到我的个人博客来进行观看\">#</a> 欢迎来到 brath 的 CSDN 博客，你也可访问 brath.top 到我的个人博客来进行观看</h4>\n<p>演示 demo-APK 地址: <span class=\"exturl\" data-url=\"aHR0cDovLzEyNC4yMjIuMTA2LjEyMjo4MDgwL2FwcC1yZWxlYXNlLnppcA==\">http://124.222.106.122:8080/app-release.zip</span></p>\n<h5 id=\"前言如果你要学习flutter那么你一定要会dart语言因为flutter是基于dart来封装的一个-ui-组件包\"><a class=\"markdownIt-Anchor\" href=\"#前言如果你要学习flutter那么你一定要会dart语言因为flutter是基于dart来封装的一个-ui-组件包\">#</a> 前言：如果你要学习 flutter，那么你一定要会 dart 语言，因为 flutter 是基于 dart 来封装的一个 UI 组件包</h5>\n<h5 id=\"本文使用-typort-书写禁止转载\"><a class=\"markdownIt-Anchor\" href=\"#本文使用-typort-书写禁止转载\">#</a> 本文使用 Typort 书写，禁止转载。</h5>\n<p>​\t\t本文仅限有后端有语言基础（C/C++/C#/Java/python/Golang/PHP 都可以），前端 (JavaScript，Html，CSS) 的人来学习。如果 0 基础，请先学习任意一门后端语言并熟练掌握！</p>\n<h2 id=\"dart语言学习\"><a class=\"markdownIt-Anchor\" href=\"#dart语言学习\">#</a> Dart 语言学习：</h2>\n<p>​\t安装 Dart：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL0dlS29ybS9kYXJ0LXdpbmRvd3MvcmVsZWFzZXMvZG93bmxvYWQvdjEuNi4wL0RhcnRfeDY0LnN0YWJsZS5zZXR1cC5leGU=\">https://github.com/GeKorm/dart-windows/releases/download/v1.6.0/Dart_x64.stable.setup.exe</span></p>\n<p>​\t安装好后配置环境变量：DART_HOME  E:\\dart\\bin  安装路径</p>\n<p>​\t配置好后 cmd 输入 dart --version 查看环境</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Dart VM version: 2.3.3-dev.0.0.flutter-b37aa3b036 (Tue Jun 11 13:00:50 2019 +0000) on &quot;windows_x64&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"注释\"><a class=\"markdownIt-Anchor\" href=\"#注释\">#</a> 注释：</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*</span><br><span class=\"line\"> *多行注释</span><br><span class=\"line\"> *多行注释</span><br><span class=\"line\"> */</span><br><span class=\"line\"> </span><br><span class=\"line\"> /**</span><br><span class=\"line\">  * 文档注释 与Java相同</span><br><span class=\"line\">  */</span><br><span class=\"line\">  </span><br><span class=\"line\"> ///文档注释 dart独有</span><br></pre></td></tr></table></figure>\n<h3 id=\"变量定义\"><a class=\"markdownIt-Anchor\" href=\"#变量定义\">#</a> 变量定义：</h3>\n<p>dart 语言特点：</p>\n<p>​\t自动类型转换，var 声明的变量可以是任意类型！</p>\n<p>dart 拥有两种变量定义方式。</p>\n<p>指定类型：</p>\n<p>String name = “brath”;</p>\n<p>或者</p>\n<p>类型推导</p>\n<p>var name = “brath”;  // 推导为任意类型</p>\n<p>final name  =  “brath”;  // 不可修改，定义常量，可以初始化</p>\n<p>const name  =  “brath”;  // 不可修改，定义常量，不可以初始化，可以被构造修改</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> name = <span class=\"number\">111111</span>;</span><br><span class=\"line\">  <span class=\"built_in\">String</span> name1 = <span class=\"string\">&quot;brath用类型定义&quot;</span>;</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Hello World! Brath~&quot;</span>);</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(name.runtimeType);</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(name1.runtimeType);</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">console:</span><br><span class=\"line\">Hello World! Brath~</span><br><span class=\"line\"><span class=\"built_in\">int</span></span><br><span class=\"line\"><span class=\"built_in\">String</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"变量拼接\"><a class=\"markdownIt-Anchor\" href=\"#变量拼接\">#</a> 变量拼接：</h4>\n<p>与 Java 不同，拼接方式用 ${}</p>\n<p>如果只拼接普通变量，可以直接 $ 变量名</p>\n<p 变量名.方法名=\"\">如果拼接变量引用方法，必须要 $</p>\n<h4 id=\"集合类型\"><a class=\"markdownIt-Anchor\" href=\"#集合类型\">#</a> 集合类型：</h4>\n<p>list 集合： var names = [“111”,“222”,“333”];</p>\n<p>set 集合:  var movies = {“111”,“222”,&quot;333”};</p>\n<p 11:1,22:2=\"\">map 集合：var info =</p>\n<p>默认情况下，dart 的所有 class 都是隐式接口！</p>\n<h4 id=\"dart函数使用\"><a class=\"markdownIt-Anchor\" href=\"#dart函数使用\">#</a> Dart 函数使用：</h4>\n<figure class=\"highlight d\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main(List&lt;String&gt; args) &#123;</span><br><span class=\"line\">    print(sum(<span class=\"number\">51</span>, <span class=\"number\">14891</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> sum(<span class=\"keyword\">int</span> a,<span class=\"keyword\">int</span> b)&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> a + b;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"函数参数\"><a class=\"markdownIt-Anchor\" href=\"#函数参数\">#</a> 函数参数：</h4>\n<p>必选参数，不能有默认值，可选参数，可以有默认值</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main()&#123;</span><br><span class=\"line\">    sayHello(<span class=\"string\">&quot;why&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//必选参数：String name 必须传参</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> sayHello(<span class=\"built_in\">String</span> name)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(name)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//可选参数：位置可选参数 </span></span><br><span class=\"line\"><span class=\"keyword\">void</span> sayHello2(<span class=\"built_in\">String</span> name, [<span class=\"built_in\">int</span> age, <span class=\"built_in\">String</span> desc])&#123;</span><br><span class=\"line\">    sayHello2(<span class=\"string\">&quot;brath&quot;</span>,<span class=\"number\">12</span>,<span class=\"string\">&quot;waa&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">//位置可选参数：用[]包围的参数可传可不传，但是位置必须对应</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//可选参数：命名可选参数 重点，多用！</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> sayHello3(<span class=\"built_in\">String</span> name, &#123;<span class=\"built_in\">int</span> age, <span class=\"built_in\">String</span> desc&#125;)&#123;</span><br><span class=\"line\">    sayHello3(<span class=\"string\">&quot;brath&quot;</span>,age: <span class=\"number\">13</span>,desc: <span class=\"string\">&quot;212&quot;</span>);</span><br><span class=\"line\">    <span class=\"comment\">//位置可选参数：用&#123;&#125;包围的参数可传可不传，但是必须指定参数名</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"函数是一等公民\"><a class=\"markdownIt-Anchor\" href=\"#函数是一等公民\">#</a> 函数是一等公民:</h4>\n<p>函数可以作为另外一个函数的参数！</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main(<span class=\"built_in\">List</span>&lt;<span class=\"built_in\">String</span>&gt; args) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// test(see);</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//匿名函数</span></span><br><span class=\"line\">  <span class=\"comment\">// test(()&#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//   print(&quot;匿名&quot;);</span></span><br><span class=\"line\">  <span class=\"comment\">//   return 10;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\"></span><br><span class=\"line\">  test(() =&gt; <span class=\"built_in\">print</span>(<span class=\"string\">&quot;箭头&quot;</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> test(<span class=\"built_in\">Function</span> foo)&#123;</span><br><span class=\"line\">    see();</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> see()&#123;</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"string\">&quot;see！&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main(<span class=\"built_in\">List</span>&lt;<span class=\"built_in\">String</span>&gt; args) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// test((num1,num2)&#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return num1+num2;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;);</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">var</span> <span class=\"built_in\">num</span> = demo();</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(<span class=\"built_in\">num</span>(<span class=\"number\">20</span>,<span class=\"number\">12</span>));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//将函数声明式显示，利用 typedef 声明一个函数列表，调用 typedef 声明的函数</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> Calculate = <span class=\"built_in\">int</span> <span class=\"built_in\">Function</span>(<span class=\"built_in\">int</span> num1,<span class=\"built_in\">int</span> num2);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> test(Calculate calculate)&#123;</span><br><span class=\"line\">  calculate(<span class=\"number\">20</span>,<span class=\"number\">30</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// void test(int foo(int num1,int num2))&#123;</span></span><br><span class=\"line\"><span class=\"comment\">//   foo(20,30);</span></span><br><span class=\"line\"><span class=\"comment\">// &#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">Calculate demo()&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (num1,num2)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> num1 * num2;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"赋值运算符\"><a class=\"markdownIt-Anchor\" href=\"#赋值运算符\">#</a> 赋值运算符：</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Flutter中，有诡异的赋值运算符</span><br><span class=\"line\">比如 name ??=&quot;111&quot;;</span><br><span class=\"line\">解释：当原来的变量有值时，不执行</span><br><span class=\"line\">当原来的变量为null时，执行</span><br><span class=\"line\"></span><br><span class=\"line\">或者 var name = name ?? &quot;11&quot;;</span><br><span class=\"line\">解释： 当name不为空时使用name，为空使用后面的变量</span><br></pre></td></tr></table></figure>\n<h3 id=\"级联运算符\"><a class=\"markdownIt-Anchor\" href=\"#级联运算符\">#</a> 级联运算符：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = Person()</span><br><span class=\"line\">    \t\t..name = <span class=\"string\">&quot;brath&quot;</span></span><br><span class=\"line\">    \t\t..eat();</span><br><span class=\"line\">\t\t\t..run();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//利用 .. 连续调用对象中的方法，类似于Java中的链式调用</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span>()</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> name;</span><br><span class=\"line\">   </span><br><span class=\"line\">    <span class=\"keyword\">void</span> eat()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;吃&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">      <span class=\"keyword\">void</span> run()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;跑&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"for循环和switch循环与js和java基本一致\"><a class=\"markdownIt-Anchor\" href=\"#for循环和switch循环与js和java基本一致\">#</a> For 循环和 Switch 循环与 JS 和 Java 基本一致</h4>\n<h3 id=\"构造函数\"><a class=\"markdownIt-Anchor\" href=\"#构造函数\">#</a> 构造函数：</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Person&#123;</span><br><span class=\"line\">\tString name;</span><br><span class=\"line\">\tint age;</span><br><span class=\"line\">\tdouble height;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t//默认构造函数</span><br><span class=\"line\">\tPerson(this.name.this.age);</span><br><span class=\"line\">\t//命名构造函数，指定名字的构造函数</span><br><span class=\"line\">\tPerson.NameCon(this.name.this.age,this.height);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"dynamic\"><a class=\"markdownIt-Anchor\" href=\"#dynamic\">#</a> dynamic：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">dynamic</span>代表任意类型</span><br><span class=\"line\"><span class=\"built_in\">dynamic</span> obj = <span class=\"string\">&quot;obj&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//可以调用</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(obj.subString(<span class=\"number\">1</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">Object</span> obj = <span class=\"string\">&quot;obj&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">//不能调用！</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(obj.subString(<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n<h3 id=\"初始化列表\"><a class=\"markdownIt-Anchor\" href=\"#初始化列表\">#</a> 初始化列表：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mian()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> p = Person(<span class=\"string\">&#x27;brath&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"built_in\">String</span> name;</span><br><span class=\"line\">    <span class=\"keyword\">final</span> <span class=\"built_in\">int</span> age;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//如果传了age参数，就用age参数，如果没传age参数就用10</span></span><br><span class=\"line\">    Person(<span class=\"keyword\">this</span>.name,&#123;<span class=\"built_in\">int</span> age&#125;): <span class=\"keyword\">this</span>.age = age ?? <span class=\"number\">10</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"构造函数重定向\"><a class=\"markdownIt-Anchor\" href=\"#构造函数重定向\">#</a> 构造函数重定向：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mian()&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> name;</span><br><span class=\"line\">    <span class=\"built_in\">int</span> age;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//默认构造函数调用内部构造函数，重定向</span></span><br><span class=\"line\">    Person(<span class=\"built_in\">String</span> name) : <span class=\"keyword\">this</span>._internal(name,<span class=\"number\">0</span>);</span><br><span class=\"line\">    Person._internal(<span class=\"keyword\">this</span>.name,<span class=\"keyword\">this</span>.age)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"工厂构造函数\"><a class=\"markdownIt-Anchor\" href=\"#工厂构造函数\">#</a> 工厂构造函数：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//相比于普通构造函数来说，工厂构造函数可以手动返回对象</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> name;</span><br><span class=\"line\">    <span class=\"built_in\">String</span> color;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"built_in\">Map</span>&lt;<span class=\"built_in\">String</span>,Person&gt; _nameCache = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"built_in\">Map</span>&lt;<span class=\"built_in\">String</span>,Person&gt; _colorCache = &#123;&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//工厂构造函数，手动根据条件返回对象</span></span><br><span class=\"line\">    <span class=\"keyword\">factory</span> Person.withName(<span class=\"built_in\">String</span> name)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(_nameCache.containsKey(name))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> _nameCache[name];</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            _nameCache[name] = Person(name,<span class=\"string\">&quot;default&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Person(name,<span class=\"string\">&quot;default&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"getter和setter\"><a class=\"markdownIt-Anchor\" href=\"#getter和setter\">#</a> Getter 和 Setter：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main(<span class=\"built_in\">List</span>&lt;<span class=\"built_in\">String</span>&gt; args) &#123;</span><br><span class=\"line\">   <span class=\"comment\">//直接访问属性</span></span><br><span class=\"line\">    <span class=\"keyword\">final</span> p = Person();</span><br><span class=\"line\">    p.name = <span class=\"string\">&quot;brath&quot;</span>;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(p.name);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//get，set访问</span></span><br><span class=\"line\">    p.setName(<span class=\"string\">&quot;brath.cloud&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(p.getName);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Person</span></span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">late</span> <span class=\"built_in\">String</span> name;\t</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//  //get,set方法</span></span><br><span class=\"line\">  <span class=\"comment\">//  void setName(String name) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//     this.name = name;</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">  <span class=\"comment\">//   String get getName&#123;</span></span><br><span class=\"line\">  <span class=\"comment\">//       return name;</span></span><br><span class=\"line\">  <span class=\"comment\">//   &#125; </span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get,set方法箭头函数</span></span><br><span class=\"line\">   <span class=\"keyword\">void</span> setName(<span class=\"built_in\">String</span> name) =&gt; <span class=\"keyword\">this</span>.name = name;</span><br><span class=\"line\">   <span class=\"built_in\">String</span> <span class=\"keyword\">get</span> getName =&gt; name;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"隐式接口\"><a class=\"markdownIt-Anchor\" href=\"#隐式接口\">#</a> 隐式接口：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//dart中没有interface关键字，默认所有类都是隐式接口</span></span><br><span class=\"line\"><span class=\"comment\">//当讲将一个类作为接口使用时，实现这个接口的类，必须实现这个接口中的所有方法</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"类的混入\"><a class=\"markdownIt-Anchor\" href=\"#类的混入\">#</a> 类的混入：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用<span class=\"class\"><span class=\"keyword\">class</span>声明的类不可以混入其他类</span></span><br><span class=\"line\"><span class=\"class\">要混入其他类，使用 <span class=\"title\">mixin</span> 声明该类，并在混入时用<span class=\"title\">with</span>关键字来连接被混入的类</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"类属性和类方法\"><a class=\"markdownIt-Anchor\" href=\"#类属性和类方法\">#</a> 类属性和类方法：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">类属性：在类中不用<span class=\"keyword\">static</span>声明的变量，叫做成员变量，不可以被类直接调用</span><br><span class=\"line\">静态属性：在类中用<span class=\"keyword\">static</span>声明的变量，叫做静态属性，类属性，可以被类直接调用</span><br><span class=\"line\">类方法：在类中不用<span class=\"keyword\">static</span>声明的方法，叫做成员方法，不可以被类直接调用</span><br><span class=\"line\">静态方法：在类中用<span class=\"keyword\">static</span>声明的方法，叫做静态方法，类属性，可以被类直接调用</span><br></pre></td></tr></table></figure>\n<h3 id=\"枚举的使用\"><a class=\"markdownIt-Anchor\" href=\"#枚举的使用\">#</a> 枚举的使用：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main(<span class=\"built_in\">List</span>&lt;<span class=\"built_in\">String</span>&gt; args) &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"keyword\">final</span> color = Colors.bule;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">switch</span>(color)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> Colors.bule:</span><br><span class=\"line\">      <span class=\"built_in\">print</span>(<span class=\"string\">&quot;蓝色&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> Colors.red:</span><br><span class=\"line\">      <span class=\"built_in\">print</span>(<span class=\"string\">&quot;红色&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> Colors.yellow:</span><br><span class=\"line\">      <span class=\"built_in\">print</span>(<span class=\"string\">&quot;黄色&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">break</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"built_in\">print</span>(Colors.values);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">enum</span> Colors&#123;</span><br><span class=\"line\">  red,</span><br><span class=\"line\">  bule,</span><br><span class=\"line\">  yellow</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"库的使用\"><a class=\"markdownIt-Anchor\" href=\"#库的使用\">#</a> 库的使用：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//在Dart中，任何一个dart文件都是一个库，类似于Java中的包</span></span><br><span class=\"line\"><span class=\"comment\">//系统库导入： import &#x27;dart:库名&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//自定会库导入： import &#x27;包名/类名&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">//库别名：当本类引用其他库时，出现方法名冲突，可以用 as 来给导入的库起别名，再用别名引用</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;utils/TimeUtil&#x27;</span> <span class=\"keyword\">as</span> timeUtil;</span><br><span class=\"line\"><span class=\"comment\">//默认情况下，导入一个库时，导入的是这个库中所有的内容</span></span><br><span class=\"line\"><span class=\"comment\">//dart提供两个关键字来单独导入方法或者隐藏某个方法：</span></span><br><span class=\"line\"><span class=\"keyword\">show</span>   <span class=\"keyword\">hide</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;utils/TimeUtil&#x27;</span> <span class=\"keyword\">show</span> timeUtil; <span class=\"comment\">//只导入timeUtil方法</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;utils/TimeUtil&#x27;</span> <span class=\"keyword\">hide</span> timeUtil; <span class=\"comment\">//只有timeUtil不会导入</span></span><br><span class=\"line\"><span class=\"comment\">//多个方法可以用逗号分割：</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;utils/TimeUtil&#x27;</span> <span class=\"keyword\">show</span> timeUtil, FileUtil; <span class=\"comment\">//只导入timeUtil,FileUtil方法</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;utils/TimeUtil&#x27;</span> <span class=\"keyword\">hide</span> timeUtil, FileUtil; <span class=\"comment\">//只有timeUtil,FileUtil不会导入</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"抽取公共库文件\"><a class=\"markdownIt-Anchor\" href=\"#抽取公共库文件\">#</a> 抽取公共库文件：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t以上方法导入库的时候总是会遇到一些问题，比如如果有<span class=\"number\">100</span>个方法，你只想用<span class=\"number\">50</span>个，那么你就要用<span class=\"number\">50</span>个<span class=\"keyword\">show</span>或者<span class=\"number\">50</span>个<span class=\"keyword\">hide</span>，但是dart提供了一种方式，就是抽取库到一个公共类中。</span><br><span class=\"line\">    前面提到过，dart中所有文件都是一个库，那么我们把需要导入的库，全部<span class=\"keyword\">export</span>到一个库中，在引用这个库，就不用担心过多引入了。</span><br><span class=\"line\">        </span><br><span class=\"line\">公共库：</span><br><span class=\"line\">util.dart</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"string\">&#x27;util/TimeUtil&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"string\">&#x27;util/FileUtil&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\">我的代码：</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;util&#x27;</span>;</span><br></pre></td></tr></table></figure>\n<h3 id=\"使用第三方库\"><a class=\"markdownIt-Anchor\" href=\"#使用第三方库\">#</a> 使用第三方库：</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//dart使用第三方库需要创建一个文件 pubspec.yaml</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">库名</span></span><br><span class=\"line\"><span class=\"attr\">desciption:</span> <span class=\"string\">描述</span></span><br><span class=\"line\"><span class=\"attr\">dependencies:</span> <span class=\"string\">依赖</span></span><br><span class=\"line\">   <span class=\"attr\">http:</span> <span class=\"string\">^0.13.4</span></span><br><span class=\"line\"><span class=\"string\">怎么找库？</span></span><br><span class=\"line\"><span class=\"string\">https://pub.dev/packages/http</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220402134052159.png\" alt=\"image-20220402134052159\"></p>\n<p>点击 installing</p>\n<p>把 dependencies 内容复制到代码中</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">name:</span> <span class=\"string\">coderwhy</span></span><br><span class=\"line\"><span class=\"attr\">desciption:</span> <span class=\"string\">a</span> <span class=\"string\">dart</span></span><br><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">http:</span> <span class=\"string\">^0.12.0+4</span></span><br><span class=\"line\"><span class=\"attr\">environment:</span> </span><br><span class=\"line\">  <span class=\"attr\">sdk:</span> <span class=\"string\">&#x27;&gt;=2.10.0 &lt; 3.0.0&#x27;</span></span><br></pre></td></tr></table></figure>\n<p>进入当前类文件夹，终端输入 pub get 就会下载对应库包</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:http/http.dart&#x27;</span> <span class=\"keyword\">as</span> http;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//引入第三方库，必须用package来开头</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> url = <span class=\"string\">&#x27;https://www.brath.cloud:9000/esn-user-service/user/getUserInfo?id=1&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> url2 = <span class=\"string\">&#x27;https://brath.cloud/image/back.png&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> response = <span class=\"keyword\">await</span> http.<span class=\"keyword\">get</span>(url);</span><br><span class=\"line\">  <span class=\"built_in\">print</span>(response.body);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"异常处理\"><a class=\"markdownIt-Anchor\" href=\"#异常处理\">#</a> 异常处理：</h3>\n<p>​\t与 Java 相同但是有不一样的部分：</p>\n<p>​\t同步处理</p>\n<p>​\t\t在一个方法中用 try 捕获异常，如果调用方法就捕获不到了！</p>\n<p>​\t异步处理</p>\n<p>​\t\t调用一个异步方法如果发生异常，可以用自异步 + await 来捕获异常</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() <span class=\"keyword\">async</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">await</span> test1();</span><br><span class=\"line\">  &#125;<span class=\"keyword\">catch</span>(e)&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"> test1() <span class=\"keyword\">async</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"number\">11</span>~/<span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"接下来介绍-我们的flutter\"><a class=\"markdownIt-Anchor\" href=\"#接下来介绍-我们的flutter\">#</a> 接下来介绍 我们的 Flutter！</h4>\n<h2 id=\"最好的跨平台解决方案-flutter\"><a class=\"markdownIt-Anchor\" href=\"#最好的跨平台解决方案-flutter\">#</a> 最好的跨平台解决方案 Flutter</h2>\n<p>架构对比：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220401170121598.png\" alt=\"image-20220401170121598\"></p>\n<h4 id=\"gup绘制出图像放到buffer缓存中手机屏幕根据刷新率来读取缓存的操作就是展示图像-image-20220401171307870\"><a class=\"markdownIt-Anchor\" href=\"#gup绘制出图像放到buffer缓存中手机屏幕根据刷新率来读取缓存的操作就是展示图像-image-20220401171307870\">#</a> GUP 绘制出图像，放到 Buffer 缓存中，手机屏幕根据刷新率来读取缓存的操作，就是展示图像。\t<img data-src=\"https://brath.cloud/blogImg/image-20220401171307870.png\" alt=\"image-20220401171307870\"></h4>\n<h3 id=\"引出了一个概念垂直同步\"><a class=\"markdownIt-Anchor\" href=\"#引出了一个概念垂直同步\">#</a> 引出了一个概念：垂直同步</h3>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220401172029367.png\" alt=\"image-20220401172029367\"></p>\n<p>​\t为什么要有垂直同步？</p>\n<p>​\t来看一个例子：假设我 GPU 每秒帧率产生 60，手机屏幕每秒也是接受 60，这时可以正常显示。</p>\n<p>​\t\t\t\t\t\t\t\t如果突然每秒帧率提高到 120，手机屏幕可能会来不及读取缓存导致画面重叠、撕裂</p>\n<p>​\t开启垂直同后，会有两块缓存区域。</p>\n<p>​\t垂直同步就限制了手机屏幕读取缓存和 GPU 产生的速度，开启垂直同步后，GPU 将画面写入到第一个缓存中，第一个缓存会复制内容（地址交换）到第二个缓存中，当两份缓存都存在这一帧，就会发送一个 VSync 的信号，告诉 GPU 可以绘制下一张图，然后手机屏幕来显示第二个缓存中的内容，这样就可以避免图像撕裂。</p>\n<h5 id=\"一个简单的flutter结构\"><a class=\"markdownIt-Anchor\" href=\"#一个简单的flutter结构\">#</a> 一个简单的 flutter 结构：</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// mian() =&gt; runApp(MyApp());</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() &#123;</span><br><span class=\"line\">  runApp(<span class=\"keyword\">const</span> MyApp());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//APP主体</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home: BrathScaffoldPage()</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//页面主体</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrathScaffoldPage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      <span class=\"comment\">//appbar：顶部标签主体</span></span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;第一个Fullter程序&quot;</span>,style: TextStyle(fontSize: <span class=\"number\">20</span>),),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: BrathBodyPage()</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//内容主体</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BrathBodyPage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span></span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Text(<span class=\"string\">&quot;Hello Fullter&quot;</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"开始学习\"><a class=\"markdownIt-Anchor\" href=\"#开始学习\">#</a> 开始学习：</h5>\n<h4 id=\"下载flutter-sdk\"><a class=\"markdownIt-Anchor\" href=\"#下载flutter-sdk\">#</a> 下载 Flutter SDK</h4>\n<p>配置 Flutter 的第一步就是下载 Flutter SDK，然后进行安装，上面两个地址都有给 SDK 下载地址，这里的问题是有的 SDK 安装包有时会报 没有.git 文件的错误，所以最稳妥的方法是通过 git clone 命令安装<br>\n在安装目录下面执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git clone -b stable https://github.com/flutter/flutter.git</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714320308.png\" alt=\"img\"></p>\n<p>安装完成之后，可以在安装根目录，找的 flutter_console.bat 文件，双击运行</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714323989.png\" alt=\"img\"></p>\n<h1 id=\"配置flutter运行环境变量\"><a class=\"markdownIt-Anchor\" href=\"#配置flutter运行环境变量\">#</a> 配置 Flutter 运行环境变量</h1>\n<p>在用户变量里面编辑或者添加 Path 条目，把 Flutter 的 bin 目录路径添加在里面</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714326036.png\" alt=\"img\"></p>\n<h1 id=\"运行flutter\"><a class=\"markdownIt-Anchor\" href=\"#运行flutter\">#</a> 运行 Flutter</h1>\n<p>在命令行运行 flutter doctor，它会下载它自己的依赖项并自行编译，一般情况是会报错提示，多半是 Android SDK 找不到什么的，如果出错了，就按照错误信息网上查一下就解决了。<br>\n我的已经处理完成的</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714328081.png\" alt=\"img\"></p>\n<h1 id=\"编辑器设置\"><a class=\"markdownIt-Anchor\" href=\"#编辑器设置\">#</a> 编辑器设置</h1>\n<p>我用的 Android Studio，上面连接里面有不同系统和编辑器的流程，详情可以前往查看</p>\n<p>Android Studio 的开发环境就不说了，需要的可以自行百度。Android Studio 配置 Flutter 开发主要是 Flutter 和 Dart 两个插件</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714332173.png\" alt=\"img\"></p>\n<p>File – Settings – Plugins – Marketplace 然后在搜索里面搜索 Flutter 和 Dart 安装就可以了。<br>\n安装完插件，重启一下 Android Studio 基本就配置完成了，可以新建 Flutter 项目了。</p>\n<h1 id=\"新建flutter项目\"><a class=\"markdownIt-Anchor\" href=\"#新建flutter项目\">#</a> 新建 Flutter 项目</h1>\n<p>File – New – New Flutter Project</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714334854.png\" alt=\"img\"></p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714337229.png\" alt=\"img\"></p>\n<p>选择 Flutter Application</p>\n<p>然后到这个最后一步的时候，会有一点小问题</p>\n<p><img data-src=\"https://brath.cloud/blogImg/202202090714339364.png\" alt=\"img\"></p>\n<p>Flutter SDK path 这一栏第一次默认是空的，需要手动选择，选择我们最开始下载的 Flutter SDK，选择根目录，就可以了</p>\n<h1 id=\"至此flutter的开发环境安装完毕\"><a class=\"markdownIt-Anchor\" href=\"#至此flutter的开发环境安装完毕\">#</a> 至此 Flutter 的开发环境安装完毕！</h1>\n<h4 id=\"现在开始学习flutter的基础组件以及进阶理论\"><a class=\"markdownIt-Anchor\" href=\"#现在开始学习flutter的基础组件以及进阶理论\">#</a> 现在开始学习 Flutter 的基础组件，以及进阶理论！</h4>\n<h1 id=\"flutter学习笔记-autherbrath\"><a class=\"markdownIt-Anchor\" href=\"#flutter学习笔记-autherbrath\">#</a> flutter 学习笔记  auther：Brath</h1>\n<h2 id=\"所有的重点都在代码的注释中标注\"><a class=\"markdownIt-Anchor\" href=\"#所有的重点都在代码的注释中标注\">#</a> 所有的重点都在代码的注释中标注！</h2>\n<h3 id=\"创建项目\"><a class=\"markdownIt-Anchor\" href=\"#创建项目\">#</a> 创建项目：</h3>\n<p>​\t\t到想存储项目的文件路径，打开 CMD，输入 flutter create 项目名称即可</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506084830778.png\" alt=\"image-20220506084830778\"></p>\n<p>​\t\tvscode 下载好插件，dart 和 flutter 打开对应 flutter 文件，即可开始编写</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>; <span class=\"comment\">//导包 material</span></span><br><span class=\"line\"></span><br><span class=\"line\">main() &#123;</span><br><span class=\"line\">  runApp(MyApp()); <span class=\"comment\">//运行app</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123; <span class=\"comment\">//继承无状态widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp( <span class=\"comment\">//运行根节点MaterialApp</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"widgetflutter模块组件\"><a class=\"markdownIt-Anchor\" href=\"#widgetflutter模块组件\">#</a> Widget：flutter 模块 / 组件</h2>\n<h4 id=\"特性\"><a class=\"markdownIt-Anchor\" href=\"#特性\">#</a> 特性：</h4>\n<h5 id=\"widget分为有状态statefulwidget和无状态的-statelesswidget\"><a class=\"markdownIt-Anchor\" href=\"#widget分为有状态statefulwidget和无状态的-statelesswidget\">#</a> widget 分为有状态（StatefulWidget）和无状态的 (StatelessWidget)</h5>\n<p>无状态的 widget 是静态页面</p>\n<p>有状态的 widget 是动态页面</p>\n<h4 id=\"要点\"><a class=\"markdownIt-Anchor\" href=\"#要点\">#</a> 要点：</h4>\n<h5 id=\"tipsflutter的main入口调用第一个widget需要该widget使用-materialapp作为首个widget\"><a class=\"markdownIt-Anchor\" href=\"#tipsflutter的main入口调用第一个widget需要该widget使用-materialapp作为首个widget\">#</a> tips：flutter 的 main 入口调用第一个 widget 需要该 widget 使用 MaterialApp () 作为首个 widget</h5>\n<p>因为 MaterialApp 包含了路由主题等等组件，flutter 规定只能用 MaterialApp 当作根节点</p>\n<h3 id=\"使用materialapp的home属性来指定页面\"><a class=\"markdownIt-Anchor\" href=\"#使用materialapp的home属性来指定页面\">#</a> 使用 MaterialApp 的 home 属性来指定页面</h3>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      debugShowCheckedModeBanner: <span class=\"keyword\">false</span>,</span><br><span class=\"line\">      home: HomePage(),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"container容器相当于divwidget下面有更详细的介绍\"><a class=\"markdownIt-Anchor\" href=\"#container容器相当于divwidget下面有更详细的介绍\">#</a> Container 容器（相当于 DIV）(widget)：下面有更详细的介绍</h2>\n<p>均为可选参数</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Container(&#123;</span><br><span class=\"line\">    Key? key,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.alignment,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.padding, <span class=\"comment\">//边距</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.color, <span class=\"comment\">//颜色 使用 Clolrs枚举</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.decoration, <span class=\"comment\">//描述</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.foregroundDecoration,</span><br><span class=\"line\">    <span class=\"built_in\">double?</span> width, <span class=\"comment\">//宽度 使用double 常量</span></span><br><span class=\"line\">    <span class=\"built_in\">double?</span> height, <span class=\"comment\">//高度 使用double 常量</span></span><br><span class=\"line\">    BoxConstraints? constraints,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.margin, <span class=\"comment\">//margin</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transform,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.transformAlignment,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.child, <span class=\"comment\">//子组件</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clipBehavior = Clip.none,</span><br><span class=\"line\">  &#125;) : <span class=\"keyword\">assert</span>(margin == <span class=\"keyword\">null</span> || margin.isNonNegative),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(padding == <span class=\"keyword\">null</span> || padding.isNonNegative),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(decoration == <span class=\"keyword\">null</span> || decoration.debugAssertIsValid()),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(constraints == <span class=\"keyword\">null</span> || constraints.debugAssertIsValid()),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(clipBehavior != <span class=\"keyword\">null</span>),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(decoration != <span class=\"keyword\">null</span> || clipBehavior == Clip.none),</span><br><span class=\"line\">       <span class=\"keyword\">assert</span>(color == <span class=\"keyword\">null</span> || decoration == <span class=\"keyword\">null</span>,</span><br><span class=\"line\">         <span class=\"string\">&#x27;Cannot provide both a color and a decoration\\n&#x27;</span></span><br><span class=\"line\">         <span class=\"string\">&#x27;To provide both, use &quot;decoration: BoxDecoration(color: color)&quot;.&#x27;</span>,</span><br><span class=\"line\">       ),</span><br><span class=\"line\">       constraints =</span><br><span class=\"line\">        (width != <span class=\"keyword\">null</span> || height != <span class=\"keyword\">null</span>)</span><br><span class=\"line\">          ? constraints?.tighten(width: width, height: height)</span><br><span class=\"line\">            ?? BoxConstraints.tightFor(width: width, height: height)</span><br><span class=\"line\">          : constraints,</span><br><span class=\"line\">       <span class=\"keyword\">super</span>(key: key);</span><br></pre></td></tr></table></figure>\n<h2 id=\"text文本组件widget\"><a class=\"markdownIt-Anchor\" href=\"#text文本组件widget\">#</a> Text 文本组件 (widget)：</h2>\n<p>Text 默认传一个文本：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TextDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span></span><br><span class=\"line\"><span class=\"class\">  @<span class=\"title\">override</span></span></span><br><span class=\"line\"><span class=\"class\">  <span class=\"title\">Widget</span> <span class=\"title\">build</span>(<span class=\"title\">BuildContext</span> <span class=\"title\">context</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container( <span class=\"comment\">//容器</span></span><br><span class=\"line\">      width: <span class=\"built_in\">double</span>.infinity, <span class=\"comment\">//宽度 使用double枚举</span></span><br><span class=\"line\">      color: Colors.blue, <span class=\"comment\">//颜色 使用Colors枚举</span></span><br><span class=\"line\">      child: Text( <span class=\"comment\">//容器的子组件 文本组件 </span></span><br><span class=\"line\">      <span class=\"string\">&quot;文本&quot;</span> * <span class=\"number\">20</span>, <span class=\"comment\">//输入文本 20个</span></span><br><span class=\"line\">      maxLines: <span class=\"number\">1</span>, <span class=\"comment\">//最大行数 1</span></span><br><span class=\"line\">      textDirection: TextDirection.ltr, <span class=\"comment\">//从左到右</span></span><br><span class=\"line\">      textAlign: TextAlign.center, <span class=\"comment\">//剧中</span></span><br><span class=\"line\">      style: TextStyle( <span class=\"comment\">//设置文本样式</span></span><br><span class=\"line\">        fontSize: <span class=\"number\">30</span>, <span class=\"comment\">//字体大小 30</span></span><br><span class=\"line\">        color: Colors.teal <span class=\"comment\">//字体颜色</span></span><br><span class=\"line\">      ),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> Text(</span><br><span class=\"line\">    <span class=\"comment\">//必传参数</span></span><br><span class=\"line\">    <span class=\"built_in\">String</span> <span class=\"keyword\">this</span>.data, </span><br><span class=\"line\">    <span class=\"comment\">//可选参数</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">    Key? key,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.style, <span class=\"comment\">//文本风格，使用 TextStyle方法来指定</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.strutStyle,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.textAlign, <span class=\"comment\">//设置文本居中 靠左 靠右，使用 TextAlign枚举</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.textDirection, <span class=\"comment\">//文本排列：左到右 右到左 使用 TextDirection枚举</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.locale,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.softWrap,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.overflow, <span class=\"comment\">//溢出后按照什么风格显示，使用TextOverflow的枚举</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.textScaleFactor,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.maxLines,  <span class=\"comment\">//最大行数</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.semanticsLabel,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.textWidthBasis,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.textHeightBehavior,</span><br><span class=\"line\">  &#125;) : <span class=\"keyword\">assert</span>(</span><br><span class=\"line\">         data != <span class=\"keyword\">null</span>,</span><br><span class=\"line\">         <span class=\"string\">&#x27;A non-null String must be provided to a Text widget.&#x27;</span>,</span><br><span class=\"line\">       ),</span><br><span class=\"line\">       textSpan = <span class=\"keyword\">null</span>,</span><br><span class=\"line\">       <span class=\"keyword\">super</span>(key: key);</span><br></pre></td></tr></table></figure>\n<h2 id=\"button按钮组件widget\"><a class=\"markdownIt-Anchor\" href=\"#button按钮组件widget\">#</a> Button 按钮组件 (widget)：</h2>\n<p>flutter 中有几种常用按钮组件：</p>\n<p>在 2.0 版本后遗弃按钮 RaisedButton 改为 ElevatedButton ，  FlatButton 改为 TextButton</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RaisedButton 已遗弃</span><br><span class=\"line\">FlatButton 已遗弃</span><br></pre></td></tr></table></figure>\n<h4 id=\"elevatedbutton漂浮按钮升降按钮\"><a class=\"markdownIt-Anchor\" href=\"#elevatedbutton漂浮按钮升降按钮\">#</a> ElevatedButton：漂浮按钮 / 升降按钮</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506094017377.png\" alt=\"image-20220506094017377\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ButtonDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        ElevatedButton(</span><br><span class=\"line\">          onPressed:()&#123;</span><br><span class=\"line\">            <span class=\"comment\">//点击事件，如果为null未定义的话，按钮无法点击</span></span><br><span class=\"line\">          &#125;, </span><br><span class=\"line\">        child: Text( <span class=\"comment\">//这里是按钮文本，可以是图片可以是文本</span></span><br><span class=\"line\">          <span class=\"string\">&quot;漂浮按钮&quot;</span></span><br><span class=\"line\">          )</span><br><span class=\"line\">        )</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"textbutton扁平按钮文本按钮\"><a class=\"markdownIt-Anchor\" href=\"#textbutton扁平按钮文本按钮\">#</a> TextButton：扁平按钮 / 文本按钮</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506094026219.png\" alt=\"image-20220506094026219\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ButtonDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        TextButton(</span><br><span class=\"line\">          onPressed: ()&#123;</span><br><span class=\"line\">            <span class=\"comment\">//点击事件</span></span><br><span class=\"line\">          &#125;, </span><br><span class=\"line\">          child: Text(</span><br><span class=\"line\">            <span class=\"string\">&quot;扁平按钮&quot;</span></span><br><span class=\"line\">       ))</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"textbuttonicon带图标的扁平按钮文本按钮\"><a class=\"markdownIt-Anchor\" href=\"#textbuttonicon带图标的扁平按钮文本按钮\">#</a> TextButton.icon：带图标的扁平按钮 / 文本按钮</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506094049981.png\" alt=\"image-20220506094049981\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ButtonDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        TextButton.icon(onPressed: ()&#123;&#125;,</span><br><span class=\"line\">         icon: Icon(Icons.add), <span class=\"comment\">//使用Icons枚举选择图标</span></span><br><span class=\"line\">         label: Text(<span class=\"string\">&quot;图标按钮&quot;</span>))</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"outlinedbuttonicon无阴影按钮\"><a class=\"markdownIt-Anchor\" href=\"#outlinedbuttonicon无阴影按钮\">#</a> OutlinedButton.icon：无阴影按钮</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506094056747.png\" alt=\"image-20220506094056747\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ButtonDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">         OutlinedButton(onPressed: ()&#123;&#125;, </span><br><span class=\"line\">         child: Text(<span class=\"string\">&quot;无阴影按钮&quot;</span>))</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"outlinedbuttonicon图标按钮\"><a class=\"markdownIt-Anchor\" href=\"#outlinedbuttonicon图标按钮\">#</a> OutlinedButton.icon：图标按钮</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506094100990.png\" alt=\"image-20220506094100990\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ButtonDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">         IconButton(onPressed: ()&#123;&#125;, </span><br><span class=\"line\">         icon: Icon(Icons.home)) <span class=\"comment\">//图标用 Icons 枚举选择</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"image图片-图标组件widget\"><a class=\"markdownIt-Anchor\" href=\"#image图片-图标组件widget\">#</a> Image 图片、图标组件 (widget)：</h2>\n<p>flutter 提供了四种图片加载方式：<img data-src=\"https://brath.cloud/blogImg/image-20220506095911749.png\" alt=\"image-20220506095911749\"></p>\n<p>1、Image.network   // 从网络获取图片</p>\n<p>2、Image.asset   // 从项目本地获取图片</p>\n<p>3、Image.file   // 从文件路径获取图片</p>\n<p>4、Image.memory  // 从手机内存，存储中获取图片</p>\n<p>使用 asset 需要设置 pubspec.yaml 中的 assets <img data-src=\"https://brath.cloud/blogImg/image-20220506100017264.png\" alt=\"image-20220506100017264\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ImageIconDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        Icon(Icons.home), <span class=\"comment\">//普通图标</span></span><br><span class=\"line\">        IconButton(onPressed: ()&#123;&#125;, icon: Icon(Icons.home)), <span class=\"comment\">//带点击事件的图标</span></span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          width: <span class=\"built_in\">double</span>.infinity, <span class=\"comment\">//最大宽度</span></span><br><span class=\"line\">          child: Image.network( <span class=\"comment\">//从网络获取图片</span></span><br><span class=\"line\">          <span class=\"string\">&quot;https://brath.cloud/love/GCLK6888.JPG?versionId=CAEQNxiBgID8yJjchBgiIDUzZGFiMWU3YWVlNDQ4YmJhMzMwNDY0Mzk1OGJiOTU1&quot;</span>,</span><br><span class=\"line\">          fit: BoxFit.fill, <span class=\"comment\">//图片填充模式</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        Image.asset(<span class=\"string\">&quot;images/image.jpeg&quot;</span>), <span class=\"comment\">//项目加载图片</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"switch开关checkbox复选框组件widget\"><a class=\"markdownIt-Anchor\" href=\"#switch开关checkbox复选框组件widget\">#</a> Switch 开关，CheckBox 复选框组件 (widget)：</h2>\n<p>因为开关和复选框是动态的，有状态的，所以我们要使用 StatefulWidget 来做他们的 widget</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Tips：在 onChanged 使用 setState 来改变状态</span></span><br></pre></td></tr></table></figure>\n<p>Check 复选框<img data-src=\"https://brath.cloud/blogImg/image-20220506100951883.png\" alt=\"\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CheckDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;CheckDemo&gt; createState() =&gt; _CheckDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_CheckDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">CheckDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">bool</span> _check = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        Checkbox(</span><br><span class=\"line\">          value: _check, </span><br><span class=\"line\">          onChanged: (res)&#123; <span class=\"comment\">//在 onChanged 使用 setState 来改变状态</span></span><br><span class=\"line\">            setState(() &#123;</span><br><span class=\"line\">              _check = res!;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Switch 开关<img data-src=\"https://brath.cloud/blogImg/image-20220506101002490.png\" alt=\"image-20220506101002490\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CheckDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;CheckDemo&gt; createState() =&gt; _CheckDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_CheckDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">CheckDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">bool</span> _<span class=\"keyword\">switch</span> = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Column(</span><br><span class=\"line\">      children: [</span><br><span class=\"line\">        Switch(</span><br><span class=\"line\">          value: _<span class=\"keyword\">switch</span>, </span><br><span class=\"line\">          onChanged: (res)&#123; <span class=\"comment\">//在 onChanged 使用 setState 来改变状态</span></span><br><span class=\"line\">             setState(() &#123;</span><br><span class=\"line\">                _<span class=\"keyword\">switch</span> = res;</span><br><span class=\"line\">             &#125;);</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">      ],</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"progress-进度条指示器组件widget\"><a class=\"markdownIt-Anchor\" href=\"#progress-进度条指示器组件widget\">#</a> Progress 进度条，指示器组件 (widget)：</h2>\n<p>flutter 为我们提供了几种进度条和指示器样式</p>\n<p>1、LinearProgressIndicator  线性指示器 <img data-src=\"https://brath.cloud/blogImg/image-20220506102352707.png\" alt=\"image-20220506102352707\"></p>\n<p>2、CircularProgressIndicator  圆圈指示器 <img data-src=\"https://brath.cloud/blogImg/image-20220506102400475.png\" alt=\"image-20220506102400475\"></p>\n<p>3、CupertinoActivityIndicator  IOS 风格的进度指示器 <img data-src=\"https://brath.cloud/blogImg/image-20220506102404297.png\" alt=\"image-20220506102404297\"></p>\n<p>可以设置的参数：</p>\n<p>value：可以设置 0 - 1，来表示当前进度</p>\n<p>valueColor：使用 AlwaysStoppedAnimation (Colors.red)  动画包裹颜色设置进度指示器的颜色</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProgressDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Padding(</span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>),</span><br><span class=\"line\">      child: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          LinearProgressIndicator( <span class=\"comment\">//线性指示器</span></span><br><span class=\"line\">            value: <span class=\"number\">.5</span>, <span class=\"comment\">//进度 从0-1， .5就是一半</span></span><br><span class=\"line\">            valueColor: AlwaysStoppedAnimation(Colors.red), <span class=\"comment\">//设置颜色要用动画包裹</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          SizedBox(height: <span class=\"number\">16</span>), <span class=\"comment\">//设置间隔 16 </span></span><br><span class=\"line\">          Container( <span class=\"comment\">//设置容器</span></span><br><span class=\"line\">            height: <span class=\"number\">100</span>, <span class=\"comment\">//高 100</span></span><br><span class=\"line\">            width: <span class=\"number\">100</span>, <span class=\"comment\">//宽 100</span></span><br><span class=\"line\">            child: CircularProgressIndicator( <span class=\"comment\">//圆圈指示器</span></span><br><span class=\"line\">              <span class=\"comment\">// value: .8,</span></span><br><span class=\"line\">              valueColor: AlwaysStoppedAnimation(Colors.red),</span><br><span class=\"line\">            ),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          SizedBox(height: <span class=\"number\">16</span>),</span><br><span class=\"line\">          CupertinoActivityIndicator(), <span class=\"comment\">//IOS风格的进度指示器</span></span><br><span class=\"line\">      ]),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"click-点击组件widget\"><a class=\"markdownIt-Anchor\" href=\"#click-点击组件widget\">#</a> Click 点击组件 (widget)：</h2>\n<p>flutter 为我们提供了 GestureDetector 手势检测器<img data-src=\"https://brath.cloud/blogImg/image-20220506102924441.png\" alt=\"image-20220506102924441\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ClickDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> GestureDetector( <span class=\"comment\">//创建手势检测器</span></span><br><span class=\"line\">      onTap: ()&#123; <span class=\"comment\">//单击</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;点击&quot;</span>);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      onDoubleTap: ()&#123; <span class=\"comment\">//双击</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;双击&quot;</span>);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;点击组件&quot;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"input-输入框组件widget\"><a class=\"markdownIt-Anchor\" href=\"#input-输入框组件widget\">#</a> Input 输入框组件 (widget)：</h2>\n<p>flutter 为我们提供了两种常用输入组件：</p>\n<p>TextField：默认典型输入框，没有 validator 验证</p>\n<p>TextFromField：特点是可以带参数校验 validator 一般用于登录注册表单验证</p>\n<h4 id=\"textfield-源码\"><a class=\"markdownIt-Anchor\" href=\"#textfield-源码\">#</a> TextField 源码</h4>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> TextField(&#123;</span><br><span class=\"line\">   Key? key,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.controller, <span class=\"comment\">//控制器</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.focusNode, <span class=\"comment\">//焦点</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.decoration = <span class=\"keyword\">const</span> InputDecoration(), <span class=\"comment\">//装饰器</span></span><br><span class=\"line\">   TextInputType? keyboardType,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.textInputAction, <span class=\"comment\">//输入动作 键盘右下角（完成，搜索，下一行）</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.textCapitalization = TextCapitalization.none,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.style, <span class=\"comment\">//样式</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.strutStyle,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.textAlign = TextAlign.start, <span class=\"comment\">//文本格式 默认从左开始</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.textAlignVertical,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.textDirection, <span class=\"comment\">//文本方向</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.readOnly = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   ToolbarOptions? toolbarOptions,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.showCursor,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.autofocus = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.obscuringCharacter = <span class=\"string\">&#x27;•&#x27;</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.obscureText = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.autocorrect = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   SmartDashesType? smartDashesType,</span><br><span class=\"line\">   SmartQuotesType? smartQuotesType,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.enableSuggestions = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.maxLines = <span class=\"number\">1</span>, <span class=\"comment\">//最大行数</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.minLines, <span class=\"comment\">//最小行数</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.expands = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.maxLength, <span class=\"comment\">//最大字数</span></span><br><span class=\"line\">   <span class=\"meta\">@Deprecated</span>(</span><br><span class=\"line\">     <span class=\"string\">&#x27;Use maxLengthEnforcement parameter which provides more specific &#x27;</span></span><br><span class=\"line\">     <span class=\"string\">&#x27;behavior related to the maxLength limit. &#x27;</span></span><br><span class=\"line\">     <span class=\"string\">&#x27;This feature was deprecated after v1.25.0-5.0.pre.&#x27;</span>,</span><br><span class=\"line\">   )</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.maxLengthEnforced = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.maxLengthEnforcement,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.onChanged, <span class=\"comment\">//当值改变</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.onEditingComplete,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.onSubmitted,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.onAppPrivateCommand,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.inputFormatters,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.enabled,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.cursorWidth = <span class=\"number\">2.0</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.cursorHeight,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.cursorRadius,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.cursorColor,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.selectionHeightStyle = ui.BoxHeightStyle.tight,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.selectionWidthStyle = ui.BoxWidthStyle.tight,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.keyboardAppearance,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.scrollPadding = <span class=\"keyword\">const</span> EdgeInsets.all(<span class=\"number\">20.0</span>),</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.dragStartBehavior = DragStartBehavior.start,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.enableInteractiveSelection = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.selectionControls,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.onTap,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.mouseCursor,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.buildCounter,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.scrollController,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.scrollPhysics,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.autofillHints = <span class=\"keyword\">const</span> &lt;<span class=\"built_in\">String</span>&gt;[],</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.clipBehavior = Clip.hardEdge,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.restorationId,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.enableIMEPersonalizedLearning = <span class=\"keyword\">true</span>,</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"textfromfield-源码\"><a class=\"markdownIt-Anchor\" href=\"#textfromfield-源码\">#</a> TextFromField 源码</h4>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Key? key,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.controller,</span><br><span class=\"line\">   <span class=\"built_in\">String?</span> initialValue,</span><br><span class=\"line\">   FocusNode? focusNode,</span><br><span class=\"line\">   InputDecoration? decoration = <span class=\"keyword\">const</span> InputDecoration(),</span><br><span class=\"line\">   TextInputType? keyboardType,</span><br><span class=\"line\">   TextCapitalization textCapitalization = TextCapitalization.none,</span><br><span class=\"line\">   TextInputAction? textInputAction,</span><br><span class=\"line\">   TextStyle? style,</span><br><span class=\"line\">   StrutStyle? strutStyle,</span><br><span class=\"line\">   TextDirection? textDirection,</span><br><span class=\"line\">   TextAlign textAlign = TextAlign.start,</span><br><span class=\"line\">   TextAlignVertical? textAlignVertical,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> autofocus = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> readOnly = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   ToolbarOptions? toolbarOptions,</span><br><span class=\"line\">   <span class=\"built_in\">bool?</span> showCursor,</span><br><span class=\"line\">   <span class=\"built_in\">String</span> obscuringCharacter = <span class=\"string\">&#x27;•&#x27;</span>,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> obscureText = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> autocorrect = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   SmartDashesType? smartDashesType,</span><br><span class=\"line\">   SmartQuotesType? smartQuotesType,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> enableSuggestions = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   <span class=\"meta\">@Deprecated</span>(</span><br><span class=\"line\">     <span class=\"string\">&#x27;Use maxLengthEnforcement parameter which provides more specific &#x27;</span></span><br><span class=\"line\">     <span class=\"string\">&#x27;behavior related to the maxLength limit. &#x27;</span></span><br><span class=\"line\">     <span class=\"string\">&#x27;This feature was deprecated after v1.25.0-5.0.pre.&#x27;</span>,</span><br><span class=\"line\">   )</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> maxLengthEnforced = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   MaxLengthEnforcement? maxLengthEnforcement,</span><br><span class=\"line\">   <span class=\"built_in\">int?</span> maxLines = <span class=\"number\">1</span>,</span><br><span class=\"line\">   <span class=\"built_in\">int?</span> minLines,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> expands = <span class=\"keyword\">false</span>,</span><br><span class=\"line\">   <span class=\"built_in\">int?</span> maxLength,</span><br><span class=\"line\">   ValueChanged&lt;<span class=\"built_in\">String</span>&gt;? onChanged,</span><br><span class=\"line\">   GestureTapCallback? onTap,</span><br><span class=\"line\">   VoidCallback? onEditingComplete,</span><br><span class=\"line\">   ValueChanged&lt;<span class=\"built_in\">String</span>&gt;? onFieldSubmitted,</span><br><span class=\"line\">   FormFieldSetter&lt;<span class=\"built_in\">String</span>&gt;? onSaved,</span><br><span class=\"line\">   FormFieldValidator&lt;<span class=\"built_in\">String</span>&gt;? validator, <span class=\"comment\">//与TextFiled不同的点，增加了 validator验证方法</span></span><br><span class=\"line\">   <span class=\"built_in\">List</span>&lt;TextInputFormatter&gt;? inputFormatters,</span><br><span class=\"line\">   <span class=\"built_in\">bool?</span> enabled,</span><br><span class=\"line\">   <span class=\"built_in\">double</span> cursorWidth = <span class=\"number\">2.0</span>,</span><br><span class=\"line\">   <span class=\"built_in\">double?</span> cursorHeight,</span><br><span class=\"line\">   Radius? cursorRadius,</span><br><span class=\"line\">   Color? cursorColor,</span><br><span class=\"line\">   Brightness? keyboardAppearance,</span><br><span class=\"line\">   EdgeInsets scrollPadding = <span class=\"keyword\">const</span> EdgeInsets.all(<span class=\"number\">20.0</span>),</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> enableInteractiveSelection = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">   TextSelectionControls? selectionControls,</span><br><span class=\"line\">   InputCounterWidgetBuilder? buildCounter,</span><br><span class=\"line\">   ScrollPhysics? scrollPhysics,</span><br><span class=\"line\">   <span class=\"built_in\">Iterable</span>&lt;<span class=\"built_in\">String</span>&gt;? autofillHints,</span><br><span class=\"line\">   AutovalidateMode? autovalidateMode,</span><br><span class=\"line\">   ScrollController? scrollController,</span><br><span class=\"line\">   <span class=\"built_in\">String?</span> restorationId,</span><br><span class=\"line\">   <span class=\"built_in\">bool</span> enableIMEPersonalizedLearning = <span class=\"keyword\">true</span>,</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>\n<p>简易登录</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506130535502.png\" alt=\"image-20220506130535502\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">InputDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123; <span class=\"comment\">//创建有状态 widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;InputDemo&gt; createState() =&gt; _InputDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_InputDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">InputDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  GlobalKey _key = GlobalKey&lt;FormState&gt;(); <span class=\"comment\">//key的泛型是表单状态，这样就可以通过key提交</span></span><br><span class=\"line\">  TextEditingController _rootController = TextEditingController();<span class=\"comment\">//账号控制器</span></span><br><span class=\"line\">  TextEditingController _passController = TextEditingController();<span class=\"comment\">//密码控制器</span></span><br><span class=\"line\">  FocusNode _r = FocusNode(); <span class=\"comment\">//账号焦点</span></span><br><span class=\"line\">  FocusNode _p = FocusNode(); <span class=\"comment\">//密码焦点</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//当退出时销毁controller，否则占用内存</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();  <span class=\"comment\">//销毁父类</span></span><br><span class=\"line\">    _rootController.dispose(); <span class=\"comment\">//销毁</span></span><br><span class=\"line\">    _passController.dispose(); <span class=\"comment\">//销毁</span></span><br><span class=\"line\">    _r.dispose(); <span class=\"comment\">//销毁</span></span><br><span class=\"line\">    _p.dispose(); <span class=\"comment\">//销毁</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Form( <span class=\"comment\">//构建表单</span></span><br><span class=\"line\">      key: _key, <span class=\"comment\">//构建表单提交key</span></span><br><span class=\"line\">      child: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">        TextFormField( <span class=\"comment\">//构建表单输入框</span></span><br><span class=\"line\">          autofocus: <span class=\"keyword\">true</span>, <span class=\"comment\">//默认焦点聚集</span></span><br><span class=\"line\">          focusNode: _r, <span class=\"comment\">//账号焦点</span></span><br><span class=\"line\">          controller: _rootController, <span class=\"comment\">//引用账号控制器</span></span><br><span class=\"line\">          decoration: InputDecoration( <span class=\"comment\">//输入框描述</span></span><br><span class=\"line\">            prefixIcon: Icon(Icons.add), <span class=\"comment\">//输入框图标</span></span><br><span class=\"line\">            labelText: <span class=\"string\">&quot;账号&quot;</span>, <span class=\"comment\">//输入框标题</span></span><br><span class=\"line\">            hintText: <span class=\"string\">&quot;默认文字&quot;</span> <span class=\"comment\">//输入框默认value</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          validator: (v)&#123; <span class=\"comment\">//只有使用 TextFormField 才可以用验证 validator 不用验证使用 TextField</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span>(v == <span class=\"keyword\">null</span> || v.isEmpty)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"string\">&quot;账号不能为空!&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          textInputAction: TextInputAction.next, <span class=\"comment\">//回车后跳转下个输入框</span></span><br><span class=\"line\">          onFieldSubmitted: (v)&#123; <span class=\"comment\">//监听回车键</span></span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;brath&quot;</span>);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        SizedBox(height: <span class=\"number\">8</span>), <span class=\"comment\">//设置间隔高度</span></span><br><span class=\"line\">        TextFormField(</span><br><span class=\"line\">          focusNode: _p, <span class=\"comment\">//密码焦点</span></span><br><span class=\"line\">          controller: _passController,</span><br><span class=\"line\">          decoration: InputDecoration(</span><br><span class=\"line\">            prefixIcon: Icon(Icons.add),</span><br><span class=\"line\">            labelText: <span class=\"string\">&quot;密码&quot;</span>,</span><br><span class=\"line\">            hintText: <span class=\"string\">&quot;输入密码&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          obscureText: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">          validator: (v)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(v == <span class=\"keyword\">null</span> || v.length &lt; <span class=\"number\">5</span>)&#123;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"string\">&quot;密码不能小于5位数!&quot;</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          textInputAction: TextInputAction.send, <span class=\"comment\">//将小键盘右下角的回车设置图标</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        SizedBox(height: <span class=\"number\">16</span>),</span><br><span class=\"line\">        ElevatedButton(</span><br><span class=\"line\">          onPressed: ()&#123;</span><br><span class=\"line\">            <span class=\"comment\">//当校验通过时输出 true 否则 false</span></span><br><span class=\"line\">            <span class=\"built_in\">print</span>((_key.currentState <span class=\"keyword\">as</span> FormState).validate().toString());</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          child: Text(<span class=\"string\">&quot;提交&quot;</span>),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">      ]),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter路由工具\"><a class=\"markdownIt-Anchor\" href=\"#flutter路由工具\">#</a> Flutter 路由工具：</h2>\n<p>var res = await Navigator.of (context).push ( // 跳转路由到 MenuPage 并可以接受返回值</p>\n<p>这段代码用异步来监听返回值，优点是，无论是否点击按钮返回，都可以接收到返回值</p>\n<p>还可以用 .then ((value) =&gt; print (value)); 的方式来获取，这样更简洁，只有返回的时候才会监听，不返回不监听</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ignore_for_file: prefer_const_constructors, use_key_in_widget_constructors</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>; <span class=\"comment\">//新页面导包</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LoginPage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123; <span class=\"comment\">//无状态widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar( <span class=\"comment\">//标题</span></span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;登录&quot;</span>),</span><br><span class=\"line\">        elevation: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: ElevatedButton( <span class=\"comment\">//登录按钮</span></span><br><span class=\"line\">        onPressed: () <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> res = <span class=\"keyword\">await</span> Navigator.of(context).push( <span class=\"comment\">//跳转路由到 MenuPage 并可以接受返回值</span></span><br><span class=\"line\">            MaterialPageRoute(</span><br><span class=\"line\">              builder: (context) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> MenuPage( <span class=\"comment\">//传参 menuTitle</span></span><br><span class=\"line\">                  menuTitle: <span class=\"string\">&quot;菜单&quot;</span>,</span><br><span class=\"line\">                );</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              settings: RouteSettings( <span class=\"comment\">//路由设置</span></span><br><span class=\"line\">                name: <span class=\"string\">&quot;参数&quot;</span>,</span><br><span class=\"line\">                arguments: <span class=\"string\">&quot;我是参数&quot;</span>, <span class=\"comment\">//向目标传参的数据</span></span><br><span class=\"line\">              ),</span><br><span class=\"line\">              maintainState: <span class=\"keyword\">false</span>,</span><br><span class=\"line\">              fullscreenDialog: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">          ));</span><br><span class=\"line\">          <span class=\"built_in\">print</span>(res); <span class=\"comment\">//打印返回值</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        child: Text(<span class=\"string\">&quot;登录&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MenuPage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">final</span> <span class=\"built_in\">String</span> menuTitle;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> MenuPage(&#123;Key? key,<span class=\"keyword\">required</span> <span class=\"keyword\">this</span>.menuTitle&#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//通过 ModalRoute.of(context)?.settings.arguments; 来获取传参</span></span><br><span class=\"line\">    <span class=\"built_in\">dynamic</span> arguments = ModalRoute.of(context)?.settings.arguments;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(menuTitle + <span class=\"string\">&quot;  &quot;</span> + arguments),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: ElevatedButton(</span><br><span class=\"line\">        onPressed: ()&#123;</span><br><span class=\"line\">          Navigator.of(context).pop(<span class=\"string\">&quot;Brath&quot;</span>);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        child: Text(<span class=\"string\">&quot;返回按钮&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Flutter 中管理多个页面时有两个核心概念和类： <code>Route</code>  和 <code>Navigator</code> 。<br>\n一个 <code>route</code>  是一个屏幕或页面的抽象， <code>Navigator</code>  是管理 <code>route</code>  的 <code>Widget</code> 。 <code>Navigator</code>  可以通过 <code>route</code>  入栈和出栈来实现页面之间的跳转。<br>\n路由一般分为静态路由 (即命名路由) 和动态路由。</p>\n<h3 id=\"静态路由即命名路由\"><a class=\"markdownIt-Anchor\" href=\"#静态路由即命名路由\">#</a> 静态路由 (即命名路由)</h3>\n<p>静态路由在通过 <code>Navigator</code>  跳转之前，需要在 <code>MaterialApp</code>  组件内显式声明路由的名称，而一旦声明，路由的跳转方式就固定了。通过在 <code>MaterialApp</code>  内的 <code>routes</code>  属性进行显式声明路由的定义。</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title class_ inherited__\">StatelessWidget</span> &#123;</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  <span class=\"title class_\">Widget</span> <span class=\"title function_\">build</span>(<span class=\"params\">BuildContext context</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title class_\">MaterialApp</span>(</span><br><span class=\"line\">      <span class=\"attr\">initialRoute</span>: <span class=\"string\">&quot;/&quot;</span>, <span class=\"comment\">// 默认加载的界面，这里为RootPage</span></span><br><span class=\"line\">      <span class=\"attr\">routes</span>: &#123; <span class=\"comment\">// 显式声明路由</span></span><br><span class=\"line\">       <span class=\"comment\">//&quot;/&quot;:(context) =&gt; RootPage(),</span></span><br><span class=\"line\">        <span class=\"string\">&quot;A&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">Apage</span>(),</span><br><span class=\"line\">        <span class=\"string\">&quot;B&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">Bpage</span>(),</span><br><span class=\"line\">        <span class=\"string\">&quot;C&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">Cpage</span>(),</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\"> \t<span class=\"comment\">// home: LoginPage(),//当设置命名路由后，home不用设置</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">注意：如果指定了home属性，routes表则不能再包含此属性。</span><br><span class=\"line\">如上代码中【<span class=\"attr\">home</span>: <span class=\"title class_\">RootPage</span>()】  和 【<span class=\"string\">&quot;/&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">RootPage</span>()】两则不能同时存在。</span><br></pre></td></tr></table></figure>\n<p>例如： <code>RootPage</code>  跳转 <code>Apage</code>  即： <code>RootPage</code>   —&gt; <code>Apage</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).pushNamed(<span class=\"string\">&quot;A&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>一般方法中带有 <code>Name</code>  多数是通过静态路由完成跳转的，如 <code>pushNamed</code> 、 <code>pushReplacementNamed</code> 、 <code>pushNamedAndRemoveUntil</code>  等。</p>\n<h3 id=\"动态路由\"><a class=\"markdownIt-Anchor\" href=\"#动态路由\">#</a> 动态路由</h3>\n<p>动态路由无需在 <code>MaterialApp</code>  内的 <code>routes</code>  中注册即可直接使用：RootPage  —&gt; Apage</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">push</span>(<span class=\"title class_\">MaterialPageRoute</span>(</span><br><span class=\"line\">  <span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">Apage</span>(),</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<p>动态路由中，需要传入一个 <code>Route</code> , 这里使用的是 <code>MaterialPageRoute</code> ，它可以使用和平台风格一致的路由切换动画，在 iOS 上左右滑动切换，Android 上会上下滑动切换。也可以使用 <code>CupertinoPageRoute</code>  实现全平台的左右滑动切换。<br>\n当然也可以自定义路由切换动画，使用 <code>PageRouteBuilder</code> : 使用 <code>FadeTransition</code> <br>\n 做一个渐入过渡动画。</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).push(</span><br><span class=\"line\">  PageRouteBuilder(</span><br><span class=\"line\">    transitionDuration: <span class=\"built_in\">Duration</span>(milliseconds: <span class=\"number\">250</span>), <span class=\"comment\">// //动画时间为0.25秒</span></span><br><span class=\"line\">    pageBuilder: (BuildContext context,Animation animation,</span><br><span class=\"line\">        Animation secondaryAnimation)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> FadeTransition( <span class=\"comment\">//渐隐渐入过渡动画</span></span><br><span class=\"line\">        opacity: animation,</span><br><span class=\"line\">        child: Apage()</span><br><span class=\"line\">       );</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">  )</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>到现在为止，可能对路由有了一定的认识，，下面就结合具体方法来详细说明。<br>\n在这之前有必要说明：<br>\n <code>Navigator.of(context).push</code>  和 <code>Navigator.push</code>  两着并没有特别的区别，看源码也得知，后者其实就是调用了前者。<br>\n <code>of</code> ：获取 <code>Navigator</code>  当前已经实例的状态。</p>\n<h3 id=\"路由拦截\"><a class=\"markdownIt-Anchor\" href=\"#路由拦截\">#</a> 路由拦截：</h3>\n<p>flutter 提供了 onGenerateRoute 来使用路由拦截器，作用于强制登录</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      debugShowCheckedModeBanner: <span class=\"keyword\">false</span>,</span><br><span class=\"line\">      initialRoute: <span class=\"string\">&quot;/&quot;</span>,</span><br><span class=\"line\">      routes: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;/&quot;</span> :(context) =&gt; LoginPage(),</span><br><span class=\"line\">        <span class=\"comment\">// &quot;menu&quot; :(context) =&gt; MenuPage(), </span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      onGenerateRoute: (RouteSettings s)&#123; <span class=\"comment\">//路由拦截器</span></span><br><span class=\"line\">        <span class=\"built_in\">print</span>(s.name); <span class=\"comment\">//路由名称</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s.name != <span class=\"string\">&quot;menu&quot;</span>)&#123; <span class=\"comment\">//当该路由不等于 menu 强制跳转回首页</span></span><br><span class=\"line\">              <span class=\"keyword\">return</span> MaterialPageRoute(builder: (context)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> LoginPage();</span><br><span class=\"line\">          &#125;,settings: s);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(s.name)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">case</span> <span class=\"string\">&quot;menu&quot;</span> : <span class=\"comment\">//当该路由等于 menu 跳转至 menu 菜单</span></span><br><span class=\"line\">          <span class=\"keyword\">return</span> MaterialPageRoute(builder: (context)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> MenuPage();</span><br><span class=\"line\">          &#125;,settings: s);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">// home: LoginPage(),//当设置命名路由后，home不用设置</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由方法解释\"><a class=\"markdownIt-Anchor\" href=\"#路由方法解释\">#</a> 路由方法解释：</h3>\n<h3 id=\"pop\"><a class=\"markdownIt-Anchor\" href=\"#pop\">#</a> pop</h3>\n<p>返回当前路由栈的上一个界面。<br>\n <code>Navigator.pop(context);</code></p>\n<h3 id=\"push-pushnamed\"><a class=\"markdownIt-Anchor\" href=\"#push-pushnamed\">#</a> push / pushNamed  ：</h3>\n<p>见上，两者运行效果相同，只是调用不同，都是将一个 <code>page</code>  压入路由栈中。直白点就是 <code>push</code>  是把界面直接放入， <code>pushNames</code>  是通过路由名的方式，通过 router 使界面进入对应的栈中。<br>\n结果：直接在原来的路由栈上添加一个新的  <code>page</code> 。</p>\n<h3 id=\"pushreplacement-pushreplacementnamed-popandpushnamed\"><a class=\"markdownIt-Anchor\" href=\"#pushreplacement-pushreplacementnamed-popandpushnamed\">#</a> pushReplacement / pushReplacementNamed / popAndPushNamed</h3>\n<p>替换路由，顾名思义替换当前的路由。<br>\n例如</p>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-de7b4cb63fcb1d83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/985/format/webp\" alt=\"img\"></p>\n<p>Replacement.png</p>\n<p>由图可知在 <code>BPage</code>  使用替换跳转到 <code>Cpage</code>  的时候， <code>Bpage</code>  被 <code>Cpage</code>  替换了在堆栈中的位置而移除栈， <code>CPage</code>  默认返回的是 <code>APage</code> 。</p>\n<h6 id=\"pushreplacement-使用的动态路由方式跳转\"><a class=\"markdownIt-Anchor\" href=\"#pushreplacement-使用的动态路由方式跳转\">#</a> pushReplacement 使用的动态路由方式跳转：</h6>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">pushReplacement</span>(<span class=\"title class_\">MaterialPageRoute</span>(</span><br><span class=\"line\">  <span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">Cpage</span>(),</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<h6 id=\"pushreplacementnamed-使用的静态路由方式\"><a class=\"markdownIt-Anchor\" href=\"#pushreplacementnamed-使用的静态路由方式\">#</a> pushReplacementNamed 使用的静态路由方式，</h6>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).pushReplacementNamed(<span class=\"string\">&quot;/C&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>两者运行效果相同。</p>\n<h6 id=\"popandpushnamed\"><a class=\"markdownIt-Anchor\" href=\"#popandpushnamed\">#</a> popAndPushNamed：</h6>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).popAndPushNamed(<span class=\"string\">&quot;/C&quot;</span>);</span><br></pre></td></tr></table></figure>\n<p>其实和上面两个方法运行的结果也是一致，区别就是动画效果不一样： <code>BPage</code>  —&gt; <code>CPage</code>  的时候， <code>CPage</code>  会同时有 <code>pop</code>  的转场效果和从 <code>BPage</code>  页 <code>push</code>  的转场效果。简单来说就是 <code>CPage</code>  先 <code>pop</code>  到 <code>BPage</code> ，在 <code>push</code>  到 <code>CPage</code> 。（不知道是不是卡顿的原因，笔者看起来区别不大）</p>\n<p>综上：3 中方法结果一样，只是调用方式和过渡动画的区别，开发者自行选择。</p>\n<h3 id=\"pushandremoveuntil-pushnamedandremoveuntil\"><a class=\"markdownIt-Anchor\" href=\"#pushandremoveuntil-pushnamedandremoveuntil\">#</a> pushAndRemoveUntil / pushNamedAndRemoveUntil</h3>\n<p>在使用上述方式跳转时，会按次序移除其他的路由，直到遇到被标记的路由（ <code>predicate</code>  函数返回了 <code>true</code> ）时停止。若 没有标记的路由，则移除全部。<br>\n当路由栈中存在重复的标记路由时，默认移除到最近的一个停止。</p>\n<h6 id=\"第一种\"><a class=\"markdownIt-Anchor\" href=\"#第一种\">#</a> 第一种</h6>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 移除全部</span></span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">pushAndRemoveUntil</span>(context,</span><br><span class=\"line\">                <span class=\"title class_\">MaterialPageRoute</span>(<span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">_</span>) =&gt;</span> <span class=\"title class_\">CPage</span>()), <span class=\"function\">(<span class=\"params\">Route router</span>) =&gt;</span> router == <span class=\"literal\">null</span>);</span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 移除全部</span></span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">pushNamedAndRemoveUntil</span>(<span class=\"string\">&quot;/C&quot;</span>, <span class=\"function\">(<span class=\"params\">Route router</span>) =&gt;</span> router == <span class=\"literal\">null</span>);</span><br></pre></td></tr></table></figure>\n<p>此时的路由栈示意图：</p>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-364a8005348f7aec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/983/format/webp\" alt=\"img\"></p>\n<p>RemoveUntil_all.png</p>\n<p>可知出了要 <code>push</code>  的 <code>CPage</code> ，当前路由栈中所有的路由都被移除， <code>CPage</code>  变成根路由。</p>\n<h6 id=\"第二种移除到rootpage停止\"><a class=\"markdownIt-Anchor\" href=\"#第二种移除到rootpage停止\">#</a> 第二种：移除到 RootPage 停止</h6>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// &quot;/&quot;即为RootPage，标记后，移除到该路由停止移除</span></span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">pushAndRemoveUntil</span>(context,</span><br><span class=\"line\">                <span class=\"title class_\">MaterialPageRoute</span>(<span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">_</span>) =&gt;</span> <span class=\"title class_\">CPage</span>()), <span class=\"title class_\">ModalRoute</span>.<span class=\"title function_\">withName</span>(<span class=\"string\">&#x27;/&#x27;</span>))</span><br><span class=\"line\">或</span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">pushAndRemoveUntil</span>(context,</span><br><span class=\"line\">                <span class=\"title class_\">MaterialPageRoute</span>(<span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">_</span>) =&gt;</span> <span class=\"title class_\">CPage</span>()), <span class=\"function\">(<span class=\"params\">Route router</span>) =&gt;</span> router.<span class=\"property\">settings</span>.<span class=\"property\">name</span> == <span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 只是写法不一样</span></span><br></pre></td></tr></table></figure>\n<p>或</p>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">pushNamedAndRemoveUntil</span>(<span class=\"string\">&quot;/C&quot;</span>, <span class=\"function\">(<span class=\"params\">Route router</span>) =&gt;</span> router.<span class=\"property\">settings</span>.<span class=\"property\">name</span> == <span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">或</span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">pushNamedAndRemoveUntil</span>(<span class=\"string\">&quot;/C&quot;</span>, <span class=\"title class_\">ModalRoute</span>.<span class=\"title function_\">withName</span>(<span class=\"string\">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure>\n<p>此时的路由栈示意图：</p>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-d03ce09352ff0619.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/992/format/webp\" alt=\"img\"></p>\n<p>RemoveUntil_until.png</p>\n<p><code>push</code>  到 <code>CPage</code>  的时候，移除到 <code>RootPage</code>  停止， <code>CPage</code>  默认返回 <code>RootPage</code> 。</p>\n<h3 id=\"popuntil\"><a class=\"markdownIt-Anchor\" href=\"#popuntil\">#</a> popUntil</h3>\n<p>返回到指定的标记路由，若标记的路由为 <code>null</code> ，则程序退出，慎用！！！<br>\n有时候我们需要根据业务需求判断：可能返回上一级路由，也可能返回上上级路由或是返回指定的路由等。这个时候就不能使用 <code>Replacemen</code> t 和 <code>RemoveUntil</code>  来替换、移除路由了。<br>\n例如：</p>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-7ca98d9fca946e7e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/453/format/webp\" alt=\"img\"></p>\n<p>until.png</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">popUntil</span>(<span class=\"function\">(<span class=\"params\">route</span>) =&gt;</span> route.<span class=\"property\">settings</span>.<span class=\"property\">name</span> == <span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">或</span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">popUntil</span>(<span class=\"title class_\">ModalRoute</span>.<span class=\"title function_\">withName</span>(<span class=\"string\">&quot;/&quot;</span>));</span><br></pre></td></tr></table></figure>\n<p>再例如：</p>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-6c759f94d04bf0d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/447/format/webp\" alt=\"img\"></p>\n<p>要实现上述功能，从 <code>CPage</code>  返回到 <code>APage</code> ，并且不在 <code>MaterialApp</code>  内的 <code>routes</code>  属性进行显式声明路由。因为笔者觉得一个应用程序的界面太多了，如果每个界面都要显示声明路由，实在是不优雅。<br>\n因为需要返回 <code>APage</code> ，还是需要标记路由，所有我们在之前跳转 <code>APage</code>  的时候设置 <code>RouteSettings</code> ，如下：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 设置APage的RouteSettings</span></span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">push</span>(<span class=\"title class_\">MaterialPageRoute</span>(</span><br><span class=\"line\">  <span class=\"attr\">settings</span>: <span class=\"title class_\">RouteSettings</span>(<span class=\"attr\">name</span>:<span class=\"string\">&quot;/A&quot;</span>),</span><br><span class=\"line\">  <span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">APage</span>(),</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<p>在 <code>CPage</code>  需要返回的时候，调用就行：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).popUntil(ModalRoute.withName(<span class=\"string\">&quot;/A&quot;</span>));</span><br></pre></td></tr></table></figure>\n<p>这样代码看起来很优雅，不会冗余。<br>\n另：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 返回根路由</span></span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">popUntil</span>(<span class=\"function\">(<span class=\"params\">route</span>) =&gt;</span> route.<span class=\"property\">isFirst</span>);</span><br></pre></td></tr></table></figure>\n<h3 id=\"canpop\"><a class=\"markdownIt-Anchor\" href=\"#canpop\">#</a> canPop</h3>\n<p>用来判断是否可以导航到新页面，返回的 <code>bool</code>  类型，一般是在设备带返回的物理按键时需要判断是否可以 <code>pop</code> 。</p>\n<h3 id=\"maybepop\"><a class=\"markdownIt-Anchor\" href=\"#maybepop\">#</a> maybePop</h3>\n<p>可以理解为 <code>canPop</code>  的升级， <code>maybePop</code>  会自动判断。如果当前的路由可以 <code>pop</code> ，则执行当前路由的 <code>pop</code>  操作，否则将不执行。</p>\n<h3 id=\"removerouteremoveroutebelow\"><a class=\"markdownIt-Anchor\" href=\"#removerouteremoveroutebelow\">#</a> removeRoute/removeRouteBelow</h3>\n<p>删除路由，同时执行 <code>Route.dispose</code>  操作，无过渡动画，正在进行的手势也会被取消。</p>\n<h6 id=\"removeroute\"><a class=\"markdownIt-Anchor\" href=\"#removeroute\">#</a> removeRoute</h6>\n<p><img data-src=\"https:////upload-images.jianshu.io/upload_images/2675141-b33464133f67a4db.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/996/format/webp\" alt=\"img\"></p>\n<p>removeRoute.png</p>\n<p><code>BPage</code>  被移除了当前的路由栈。<br>\n如果在当前页面调用 <code>removeRoute</code> ，则类似于调用 <code>pop</code>  方法，区别就是无过渡动画，所以 <code>removeRoute</code>  也可以用来返回上一页。</p>\n<h6 id=\"removeroutebelow\"><a class=\"markdownIt-Anchor\" href=\"#removeroutebelow\">#</a> removeRouteBelow</h6>\n<p>移除指定路由底层的临近的一个路由，并且对应路由不存在的时候会报错。<br>\n同上。</p>\n<p>综上：这个两个方法一般情况下很少用，而且必须要持有对应的要移除的路由。<br>\n一般用于立即关闭，如移除当前界面的弹出框等。</p>\n<hr>\n<h1 id=\"路由传值\"><a class=\"markdownIt-Anchor\" href=\"#路由传值\">#</a> 路由传值</h1>\n<p>常见的路由传值分为两个方面：</p>\n<ul>\n<li>向下级路由传值</li>\n<li>返回上级路由时传值</li>\n</ul>\n<p>要注意的是，我们一般说静态路由不能传值，并不是说一定不能用于传值，而是因为静态路由一般需要在 <code>MaterialApp</code>  内的 <code>routes</code>  属性进行显式声明，在这里使用构造函数传值无实际意义。<br>\n如：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">MaterialApp</span>(</span><br><span class=\"line\">     <span class=\"attr\">initialRoute</span>: <span class=\"string\">&quot;/&quot;</span>, <span class=\"comment\">// 默认加载的界面，这里为RootPage</span></span><br><span class=\"line\">     <span class=\"attr\">routes</span>: &#123; <span class=\"comment\">// 显式声明路由</span></span><br><span class=\"line\">       <span class=\"string\">&quot;/&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">RootPage</span>(),</span><br><span class=\"line\">       <span class=\"string\">&quot;/A&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">APage</span>(<span class=\"string\">&quot;title&quot;</span>),  <span class=\"comment\">// 在这里传参无实际意义，一般需要传入的参数都是动态变化的</span></span><br><span class=\"line\">       <span class=\"string\">&quot;/B&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">BPage</span>(),</span><br><span class=\"line\">       <span class=\"string\">&quot;/C&quot;</span>:<span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">CPage</span>(),</span><br><span class=\"line\">     &#125;,</span><br><span class=\"line\">    <span class=\"comment\">// home: RootPage(),</span></span><br><span class=\"line\">   );</span><br></pre></td></tr></table></figure>\n<h3 id=\"向下级路由传值\"><a class=\"markdownIt-Anchor\" href=\"#向下级路由传值\">#</a> 向下级路由传值</h3>\n<h5 id=\"1-构造函数传值\"><a class=\"markdownIt-Anchor\" href=\"#1-构造函数传值\">#</a> 1、构造函数传值</h5>\n<p>首先构造一个可以带参数的构造函数：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">APage</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">String</span> title;</span><br><span class=\"line\">  APage(<span class=\"keyword\">this</span>.title);</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  _APageState createState() =&gt; _APageState();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在路由跳转的时候传值：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">push</span>(<span class=\"title class_\">MaterialPageRoute</span>(</span><br><span class=\"line\">  <span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">APage</span>(<span class=\"string\">&quot;这是传入的参数&quot;</span>),</span><br><span class=\"line\">));</span><br></pre></td></tr></table></figure>\n<p>在 APage 拿到传入的值：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在 StatefulWidget 使用[widget.参数名]</span></span><br><span class=\"line\"><span class=\"built_in\">Container</span>(</span><br><span class=\"line\">  child: <span class=\"built_in\">Text</span>(widget.title),</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h5 id=\"2-modalroute-传值\"><a class=\"markdownIt-Anchor\" href=\"#2-modalroute-传值\">#</a> 2、ModalRoute 传值</h5>\n<p>在 <code>Navigator.of(context).push</code>  的跳转方式中， <code>MaterialPageRoute</code>  的构造参数中 可以看到有 <code>RouteSettings</code>  的属性， <code>RouteSettings</code>  就是当前路由的基本信息</p>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> RouteSettings(&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.name,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.isInitialRoute = <span class=\"literal\">false</span>,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.arguments, <span class=\"comment\">// 存储路由相关的参数Object</span></span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n<p>路由跳转时设置传递参数：</p>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">push</span>(<span class=\"title class_\">MaterialPageRoute</span>(</span><br><span class=\"line\">  <span class=\"attr\">settings</span>: <span class=\"title class_\">RouteSettings</span>(<span class=\"attr\">name</span>:<span class=\"string\">&quot;/A&quot;</span>,<span class=\"attr\">arguments</span>: &#123;<span class=\"string\">&quot;argms&quot;</span>:<span class=\"string\">&quot;这是传入A的参数&quot;</span>&#125;),</span><br><span class=\"line\">  <span class=\"attr\">builder</span>: <span class=\"function\">(<span class=\"params\">context</span>) =&gt;</span> <span class=\"title class_\">APage</span>(),</span><br><span class=\"line\">));</span><br><span class=\"line\">或使用静态路由pushName：</span><br><span class=\"line\"><span class=\"title class_\">Navigator</span>.<span class=\"title function_\">of</span>(context).<span class=\"title function_\">pushNamed</span>(<span class=\"string\">&quot;/A&quot;</span>,<span class=\"attr\">arguments</span>:&#123;<span class=\"string\">&quot;argms&quot;</span>:<span class=\"string\">&quot;这是传入A的参数&quot;</span>&#125;);</span><br></pre></td></tr></table></figure>\n<p>在 <code>APage</code>  中取值：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">Map</span> argms = ModalRoute.of(context).settings.arguments;</span><br><span class=\"line\"><span class=\"built_in\">print</span>(argms[<span class=\"string\">&quot;argms&quot;</span>]);</span><br></pre></td></tr></table></figure>\n<h3 id=\"返回上级路由时传值\"><a class=\"markdownIt-Anchor\" href=\"#返回上级路由时传值\">#</a> 返回上级路由时传值</h3>\n<p>就是在调用 <code>APage</code>  中调用 <code>pop</code>  返回路由的时候传参</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator<span class=\"selector-class\">.of</span>(context)<span class=\"selector-class\">.pop</span>(&quot;这是pop返回的参数值&quot;);</span><br></pre></td></tr></table></figure>\n<p>在上一级路由获取：</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Navigator.of(context).push(MaterialPageRoute(</span><br><span class=\"line\">  builder: (context) =&gt; APage(),</span><br><span class=\"line\">)).then((<span class=\"keyword\">value</span>)&#123; <span class=\"comment\">// 获取pop的传值</span></span><br><span class=\"line\">  print(<span class=\"keyword\">value</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">或</span><br><span class=\"line\">String <span class=\"keyword\">value</span> = <span class=\"keyword\">await</span> Navigator.of(context).pushNamed(<span class=\"string\">&#x27;/xxx&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter-布局layout-widget\"><a class=\"markdownIt-Anchor\" href=\"#flutter-布局layout-widget\">#</a> Flutter 布局（Layout ）（Widget）：</h2>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">textDirection: TextDirection.ltr, <span class=\"comment\">//组件排列方式</span></span><br><span class=\"line\">mainAxisSize: MainAxisSize.max, <span class=\"comment\">//主轴最大值</span></span><br><span class=\"line\">mainAxisAlignment: MainAxisAlignment.spaceEvenly, <span class=\"comment\">//主轴布局</span></span><br><span class=\"line\">crossAxisAlignment: CrossAxisAlignment.start, <span class=\"comment\">//纵轴排列方式</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"column-纵向\"><a class=\"markdownIt-Anchor\" href=\"#column-纵向\">#</a> Column  - 纵向</h4>\n<p>概念：纵轴的宽度，默认使用子组件最大宽度</p>\n<p>此时，红色和黄色容器宽度为 100 绿色为 150，整个容器就会使用 最大的子组件宽度 150 来表示自己</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506141732333.png\" alt=\"image-20220506141732333\"></p>\n<p>Column 代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LayoutDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;布局练习&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Container(</span><br><span class=\"line\">        color: Colors.grey,</span><br><span class=\"line\">        child: Column(children: [</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          width: <span class=\"number\">100</span>,</span><br><span class=\"line\">          height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          color: Colors.red,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        Container(</span><br><span class=\"line\">          width: <span class=\"number\">150</span>,</span><br><span class=\"line\">          height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          color: Colors.green,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">            Container(</span><br><span class=\"line\">          width: <span class=\"number\">100</span>,</span><br><span class=\"line\">          height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          color: Colors.yellow,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ]),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"row-横向\"><a class=\"markdownIt-Anchor\" href=\"#row-横向\">#</a> Row - 横向</h4>\n<p>概念：和 Colunm 相似，纵轴的宽度，默认使用子组件最大高度</p>\n<p>此时，红色和黄色容器高度为 100 绿色为 200，整个容器就会使用 最大的子组件高度 200 来表示自己</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506142159516.png\" alt=\"image-20220506142159516\"></p>\n<p>Row 代码演示</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LayoutDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;布局练习&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Container(</span><br><span class=\"line\">        color: Colors.grey,</span><br><span class=\"line\">      child: Row(</span><br><span class=\"line\">        textDirection: TextDirection.ltr, <span class=\"comment\">//组件排列方式</span></span><br><span class=\"line\">        mainAxisSize: MainAxisSize.max, <span class=\"comment\">//主轴最大值</span></span><br><span class=\"line\">        mainAxisAlignment: MainAxisAlignment.spaceEvenly, <span class=\"comment\">//主轴布局</span></span><br><span class=\"line\">        crossAxisAlignment: CrossAxisAlignment.start, <span class=\"comment\">//纵轴排列方式</span></span><br><span class=\"line\">        children: [</span><br><span class=\"line\">           Container(</span><br><span class=\"line\">          width: <span class=\"number\">100</span>,</span><br><span class=\"line\">          height: <span class=\"number\">200</span>,</span><br><span class=\"line\">          color: Colors.red,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">            Container(</span><br><span class=\"line\">          width: <span class=\"number\">150</span>,</span><br><span class=\"line\">          height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          color: Colors.green,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">            Container(</span><br><span class=\"line\">          width: <span class=\"number\">100</span>,</span><br><span class=\"line\">          height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          color: Colors.yellow,</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ]),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter弹性布局flex\"><a class=\"markdownIt-Anchor\" href=\"#flutter弹性布局flex\">#</a> Flutter 弹性布局 (Flex)：</h2>\n<p>flutter 为我们提供了 Flex 这个 widget 来制造弹性布局</p>\n<p>Flex 默认 必传方向 Axis</p>\n<p>children 使用 Expanded 来包裹，可以设置 flex 权重，根据数字大小来设置权重</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506150504528.png\" alt=\"image-20220506150504528\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LayoutDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">        appBar: AppBar(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;布局练习&quot;</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        body: Container(</span><br><span class=\"line\">          color: Colors.grey,</span><br><span class=\"line\">          child: Flex(</span><br><span class=\"line\">            direction: Axis.vertical,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              Expanded(child: </span><br><span class=\"line\">              Container(</span><br><span class=\"line\">                width: <span class=\"number\">100</span>,</span><br><span class=\"line\">                height: <span class=\"number\">200</span>,</span><br><span class=\"line\">                color: Colors.red,</span><br><span class=\"line\">              ),flex: <span class=\"number\">2</span>,),</span><br><span class=\"line\">              Expanded(child: </span><br><span class=\"line\">              Container(</span><br><span class=\"line\">                width: <span class=\"number\">100</span>,</span><br><span class=\"line\">                height: <span class=\"number\">200</span>,</span><br><span class=\"line\">                color: Colors.green,</span><br><span class=\"line\">              ),flex: <span class=\"number\">2</span>,),</span><br><span class=\"line\">               Expanded(child: </span><br><span class=\"line\">              Container(</span><br><span class=\"line\">                width: <span class=\"number\">100</span>,</span><br><span class=\"line\">                height: <span class=\"number\">200</span>,</span><br><span class=\"line\">                color: Colors.yellow,</span><br><span class=\"line\">              ),flex: <span class=\"number\">2</span>,),</span><br><span class=\"line\">            ],</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter流式布局wrap\"><a class=\"markdownIt-Anchor\" href=\"#flutter流式布局wrap\">#</a> Flutter 流式布局 (Wrap)：</h2>\n<p>flutter 为我们提供了 Wrap 这个 widget 来制造弹性布局</p>\n<p>使用 有状态的  StatefulWidget  来构建 wrap 布局</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506150443707.png\" alt=\"image-20220506150443707\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WrapDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;WrapDemo&gt; createState() =&gt; _WrapDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_WrapDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">WrapDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> list = &lt;<span class=\"built_in\">int</span>&gt;[];</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++) &#123; <span class=\"comment\">//初始化时向数组添加 20 个数据</span></span><br><span class=\"line\">      list.add(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Wrap(</span><br><span class=\"line\">      direction: Axis.horizontal, <span class=\"comment\">//设置方向</span></span><br><span class=\"line\">      alignment: WrapAlignment.start, <span class=\"comment\">//布局参数</span></span><br><span class=\"line\">      spacing: <span class=\"number\">1.0</span>, <span class=\"comment\">//边距</span></span><br><span class=\"line\">      runSpacing: <span class=\"number\">1.0</span>, <span class=\"comment\">//边距</span></span><br><span class=\"line\">      children: list.map((e) =&gt; Container(</span><br><span class=\"line\">        height: <span class=\"number\">100</span>,</span><br><span class=\"line\">        width: <span class=\"number\">100</span>,</span><br><span class=\"line\">        child: Text(</span><br><span class=\"line\">          e.toString(),</span><br><span class=\"line\">          style: TextStyle(</span><br><span class=\"line\">            color: Colors.black,</span><br><span class=\"line\">            fontSize: <span class=\"number\">20</span></span><br><span class=\"line\">          )</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        color: Colors.blue,</span><br><span class=\"line\">      )).toList()</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter层叠布局stack\"><a class=\"markdownIt-Anchor\" href=\"#flutter层叠布局stack\">#</a> Flutter 层叠布局 (Stack)：</h2>\n<p>flutter 为我们提供了 Stack 这个 widget 来制造层叠布局</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506150429490.png\" alt=\"image-20220506150429490\"></p>\n<p>我们设置了两个容器 div，在层叠布局中，如果后一个容器，比前面的容器大，那么就会遮挡，原理是为什么？</p>\n<ol>\n<li>flutter 在绘画时，从 x 0 y 0 开始绘画，也就是 左上角</li>\n<li>意味着两个容器绘画开始的坐标都是相同的，只不过宽高不一样</li>\n<li>那么如果第一个容器宽高为 100 第二个为 150 就理所应当的遮住啦！</li>\n</ol>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StackDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      color: Colors.grey,</span><br><span class=\"line\">      width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">      child: Stack(</span><br><span class=\"line\">        alignment: AlignmentDirectional.center, <span class=\"comment\">//居中布局</span></span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Colors.green,</span><br><span class=\"line\">            width: <span class=\"number\">150</span>,</span><br><span class=\"line\">            height: <span class=\"number\">150</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Colors.red,</span><br><span class=\"line\">            width: <span class=\"number\">100</span>,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter定位布局positioned\"><a class=\"markdownIt-Anchor\" href=\"#flutter定位布局positioned\">#</a> Flutter 定位布局 (Positioned)：</h2>\n<p>flutter 为我们提供了 Positioned 这个 widget 来制造层叠布局</p>\n<p>如果 Positioned 设置了宽高，那么子组件不生效</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506151155616.png\" alt=\"image-20220506151155616\"></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//如果设置了 </span></span><br><span class=\"line\">​\ttop: <span class=\"number\">10</span>,</span><br><span class=\"line\">​   bottom: <span class=\"number\">10</span>,</span><br><span class=\"line\">​\t\t那么就不能设置高度 height</span><br><span class=\"line\"><span class=\"comment\">//如果设置了</span></span><br><span class=\"line\">​     left: <span class=\"number\">10</span>,</span><br><span class=\"line\">​     right: <span class=\"number\">10</span>,</span><br><span class=\"line\">​\t\t那么就不能设置宽度 width</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506151900799.png\" alt=\"image-20220506151900799\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">StackDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      color: Colors.grey,</span><br><span class=\"line\">      width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">      child: Stack(</span><br><span class=\"line\">        alignment: AlignmentDirectional.center,</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Colors.green,</span><br><span class=\"line\">            width: <span class=\"number\">150</span>,</span><br><span class=\"line\">            height: <span class=\"number\">150</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Colors.red,</span><br><span class=\"line\">            width: <span class=\"number\">100</span>,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Positioned(</span><br><span class=\"line\">            <span class=\"comment\">// width: 100,</span></span><br><span class=\"line\">            <span class=\"comment\">// height: 100,</span></span><br><span class=\"line\">            child: Container(</span><br><span class=\"line\">                color: Colors.yellow,</span><br><span class=\"line\">                width: <span class=\"number\">300</span>,</span><br><span class=\"line\">                height: <span class=\"number\">300</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          top: <span class=\"number\">50</span>,</span><br><span class=\"line\">          left: <span class=\"number\">150</span>,</span><br><span class=\"line\">          right: <span class=\"number\">150</span>,</span><br><span class=\"line\">          bottom: <span class=\"number\">50</span>,</span><br><span class=\"line\">        )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter相对定位align\"><a class=\"markdownIt-Anchor\" href=\"#flutter相对定位align\">#</a> Flutter 相对定位 (Align)：</h2>\n<p>flutter 为我们提供了 Align 这个 widget 来制造层叠布局</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506154713361.png\" alt=\"image-20220506154713361\"></p>\n<p>要点：只会相对于父组件来定位，而不是屏幕</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AlignDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      width: <span class=\"number\">200</span>,</span><br><span class=\"line\">      height: <span class=\"number\">200</span>,</span><br><span class=\"line\">      color: Colors.green,</span><br><span class=\"line\">      child: Align(</span><br><span class=\"line\">        alignment: Alignment.center, <span class=\"comment\">//居中</span></span><br><span class=\"line\">        child: FlutterLogo( <span class=\"comment\">//flutter的logo</span></span><br><span class=\"line\">          size: <span class=\"number\">60</span>, <span class=\"comment\">//宽高60</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的内外边距-padding-margin\"><a class=\"markdownIt-Anchor\" href=\"#flutter的内外边距-padding-margin\">#</a> Flutter 的内外边距 Padding、Margin</h2>\n<p>flutter 为我们提供了 padding 和 margin 这量个 属性来设置内外边距</p>\n<p>内边距：当前容器内的组件对于当前容器的距离</p>\n<p>外边距：当前容器距离父类容器的距离</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506154557035.png\" alt=\"image-20220506154557035\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PaddingAndMarginDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      width: <span class=\"number\">100</span>,</span><br><span class=\"line\">      height: <span class=\"number\">100</span>,</span><br><span class=\"line\">      color: Colors.red,</span><br><span class=\"line\">      <span class=\"comment\">//设置外边距（当前容器距离父类容器的距离）</span></span><br><span class=\"line\">      <span class=\"comment\">// margin: EdgeInsets.only(left: 10),//单独设置外边距</span></span><br><span class=\"line\">      margin: EdgeInsets.all(<span class=\"number\">10</span>),<span class=\"comment\">//四个方向设置外边距</span></span><br><span class=\"line\">      <span class=\"comment\">//设置内边距（当前容器内的组件对于当前容器的距离）</span></span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">20</span>),</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;我有边距&quot;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter尺寸限制容器constrainedboxwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter尺寸限制容器constrainedboxwidget\">#</a> Flutter 尺寸限制容器（ConstrainedBox）widget：</h2>\n<p>要点：子 widget 没有设置宽高的时候取自己设置的最大宽高</p>\n<p>ConstrainedBox 的特点就是可以设置最大或者最小的宽高，子组件怎么设置都不可以超过这个宽高</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506155526846.png\" alt=\"image-20220506155526846\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConstrainedBoxDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ConstrainedBox(</span><br><span class=\"line\">      constraints: BoxConstraints(</span><br><span class=\"line\">        maxHeight: <span class=\"number\">100</span>,</span><br><span class=\"line\">        maxWidth: <span class=\"number\">100</span>,</span><br><span class=\"line\">        minHeight: <span class=\"number\">50</span>,</span><br><span class=\"line\">        minWidth: <span class=\"number\">50</span>,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        width: <span class=\"number\">500</span>,</span><br><span class=\"line\">        height: <span class=\"number\">500</span>,</span><br><span class=\"line\">        color: Colors.red,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter尺寸限制容器sizeboxwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter尺寸限制容器sizeboxwidget\">#</a> Flutter 尺寸限制容器（SizeBox）widget：</h2>\n<p>要点：如果父容器指定了宽高，那么子组件不可以修改宽高</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506155924950.png\" alt=\"image-20220506155924950\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConstrainedBoxDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> SizedBox(</span><br><span class=\"line\">        <span class=\"comment\">// width: 100,</span></span><br><span class=\"line\">        <span class=\"comment\">// height: 100,</span></span><br><span class=\"line\">      child: Container(</span><br><span class=\"line\">        color: Colors.red,</span><br><span class=\"line\">        width: <span class=\"number\">200</span>,</span><br><span class=\"line\">        height: <span class=\"number\">200</span>,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter装饰器boxdecorationwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter装饰器boxdecorationwidget\">#</a> Flutter 装饰器（BoxDecoration）widget：</h2>\n<p>flutter 为我们提供了 BoxDecoration  这量个 widget 来设置样式装饰</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506161223872.png\" alt=\"image-20220506161223872\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConstrainedBoxDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      margin: EdgeInsets.all(<span class=\"number\">20</span>),</span><br><span class=\"line\">      width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">      child: DecoratedBox( <span class=\"comment\">//装饰器</span></span><br><span class=\"line\">      decoration: BoxDecoration(</span><br><span class=\"line\">        <span class=\"comment\">// color: Colors.red</span></span><br><span class=\"line\">        gradient: LinearGradient( <span class=\"comment\">//渐变颜色</span></span><br><span class=\"line\">          colors: [</span><br><span class=\"line\">            Colors.red, <span class=\"comment\">//从红色</span></span><br><span class=\"line\">            Colors.green, <span class=\"comment\">//到绿色</span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        borderRadius: BorderRadius.circular(<span class=\"number\">10.0</span>), <span class=\"comment\">//圆角度</span></span><br><span class=\"line\">        boxShadow: [</span><br><span class=\"line\">          BoxShadow(</span><br><span class=\"line\">            color: Colors.black,</span><br><span class=\"line\">            offset: Offset(<span class=\"number\">2.0</span>,<span class=\"number\">2.0</span>),</span><br><span class=\"line\">            blurRadius: <span class=\"number\">2</span>,</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      child: Padding(</span><br><span class=\"line\">        padding: EdgeInsets.only(</span><br><span class=\"line\">          left: <span class=\"number\">100</span>,</span><br><span class=\"line\">          right: <span class=\"number\">100</span>,</span><br><span class=\"line\">          top: <span class=\"number\">20</span>,</span><br><span class=\"line\">          bottom: <span class=\"number\">20</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">        child: Text(</span><br><span class=\"line\">          <span class=\"string\">&quot;渐变色~&quot;</span>,</span><br><span class=\"line\">          style: TextStyle(</span><br><span class=\"line\">            color: Colors.white</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          textAlign: TextAlign.center,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter小容器containerwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter小容器containerwidget\">#</a> Flutter 小容器（Container）widget：</h2>\n<p>要点：当 Container 设置了 foregroundDecoration（前景） 的背景颜色，那么子组件将不会显示</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506161715758.png\" alt=\"image-20220506161715758\"></p>\n<p>要点：当 Container 设置了 decoration（背景） 的背景颜色，那么子组件将会显示</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506161724860.png\" alt=\"image-20220506161724860\"></p>\n<p>设置内边距并旋转 0.5</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506162019154.png\" alt=\"image-20220506162019154\"></p>\n<p>代码演示</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ContarinerDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container(</span><br><span class=\"line\">      margin: EdgeInsets.all(<span class=\"number\">100</span>), <span class=\"comment\">//设置内边距</span></span><br><span class=\"line\">      width: <span class=\"number\">100</span>,</span><br><span class=\"line\">      height: <span class=\"number\">100</span>,</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;data&quot;</span>), </span><br><span class=\"line\">      decoration: BoxDecoration( <span class=\"comment\">//设置背景  foregroundDecoration设置前景，会遮挡</span></span><br><span class=\"line\">        color: Colors.red</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      transform: Matrix4.rotationZ(<span class=\"number\">0.5</span>), <span class=\"comment\">//旋转，可选坐标轴</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter小容器materiaappscaffoldwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter小容器materiaappscaffoldwidget\">#</a> Flutter 小容器（MateriaApp，Scaffold）widget：</h2>\n<p>1.MateriaApp 是 flutter 的根节点，flutter 规定必须要 MateriaApp 来作为根节点展示</p>\n<p>2. 在 MateriaApp 可以设置路由，每个子页面必须由 Scaffold 来包裹</p>\n<p>3. 每个 Scaffold 包含两个部分 appBar（头部），body（展示体）</p>\n<h2 id=\"flutter的appbar\"><a class=\"markdownIt-Anchor\" href=\"#flutter的appbar\">#</a> Flutter 的 AppBar：</h2>\n<p>Scaffold 中的 AppBar 有很多特性：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506164220445.png\" alt=\"image-20220506164220445\"></p>\n<p>代码演示</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PageDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;PageDemo&gt; createState() =&gt; _PageDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_PageDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">PageDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        leading: IconButton( <span class=\"comment\">//设置左侧图标</span></span><br><span class=\"line\">            onPressed: () &#123;</span><br><span class=\"line\">              <span class=\"built_in\">print</span>(<span class=\"string\">&quot;点击了！&quot;</span>);</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            icon: Icon(Icons.home) <span class=\"comment\">//左边房子图片</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        <span class=\"comment\">// centerTitle: true, //设置centerTitle为true，可将标题居中</span></span><br><span class=\"line\">        title: Text(</span><br><span class=\"line\">          <span class=\"string\">&quot;演示&quot;</span>,</span><br><span class=\"line\">          style: TextStyle(fontSize: <span class=\"number\">15</span>),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        actions: [  <span class=\"comment\">//设置左侧图标</span></span><br><span class=\"line\">          IconButton(</span><br><span class=\"line\">              onPressed: () &#123;</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;点击了加！&quot;</span>);</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              icon: Icon(Icons.add)),</span><br><span class=\"line\">          IconButton(</span><br><span class=\"line\">              onPressed: () &#123;</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;点击了减！&quot;</span>);</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              icon: Icon(Icons.remove)),</span><br><span class=\"line\">          IconButton(</span><br><span class=\"line\">              onPressed: () &#123;</span><br><span class=\"line\">                <span class=\"built_in\">print</span>(<span class=\"string\">&quot;点击了灯！&quot;</span>);</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              icon: Icon(Icons.wb_iridescent_rounded)),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        elevation: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      <span class=\"comment\">// body: ,</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的顶部tabbar选项卡\"><a class=\"markdownIt-Anchor\" href=\"#flutter的顶部tabbar选项卡\">#</a> Flutter 的顶部 TabBar 选项卡：</h2>\n<p>Flutter 提供 顶部 TabBar 选项卡</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506170237419.png\" alt=\"image-20220506170237419\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PageDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;PageDemo&gt; createState() =&gt; _PageDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_PageDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">PageDemo</span>&gt; <span class=\"title\">with</span> <span class=\"title\">SingleTickerProviderStateMixin</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span> tabs = [<span class=\"string\">&quot;Fullter&quot;</span>, <span class=\"string\">&quot;Andiord&quot;</span>, <span class=\"string\">&quot;IOS&quot;</span>]; <span class=\"comment\">//选项卡数组</span></span><br><span class=\"line\">  <span class=\"comment\">//选项控制器</span></span><br><span class=\"line\">  <span class=\"keyword\">late</span> TabController _controller = TabController(length: tabs.length, vsync: <span class=\"keyword\">this</span>);</span><br><span class=\"line\">  <span class=\"comment\">//选项索引  </span></span><br><span class=\"line\">  <span class=\"built_in\">int</span> _index = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"><span class=\"language-markdown\">/**</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\">     *</span> 初始化</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"code\">     **/</span></span></span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    _controller = TabController( <span class=\"comment\">//创建新控制器</span></span><br><span class=\"line\">      initialIndex: _index, <span class=\"comment\">//设置初始索引</span></span><br><span class=\"line\">      length: tabs.length, <span class=\"comment\">//长度为数组疮毒</span></span><br><span class=\"line\">      vsync: <span class=\"keyword\">this</span></span><br><span class=\"line\">      );</span><br><span class=\"line\">      _controller.addListener(() &#123; <span class=\"comment\">//监听器</span></span><br><span class=\"line\">        setState(() &#123; <span class=\"comment\">//监听状态，当状态改变，把控制器索引赋值到选项索引，用来做内容切换</span></span><br><span class=\"line\">          _index = _controller.index;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"comment\"><span class=\"language-markdown\"><span class=\"code\">/**</span></span></span></span><br><span class=\"line\"><span class=\"code\"><span class=\"language-markdown\"><span class=\"comment\">    * 销毁</span></span></span></span><br><span class=\"line\"><span class=\"code\"><span class=\"language-markdown\"><span class=\"comment\">    **/</span></span></span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    _controller.dispose();</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        elevation: <span class=\"number\">10.0</span>, <span class=\"comment\">//阴影</span></span><br><span class=\"line\">        bottom: TabBar(</span><br><span class=\"line\">          controller: _controller, <span class=\"comment\">//选项接收控制器</span></span><br><span class=\"line\">          tabs: tabs.map((e) =&gt; Tab( <span class=\"comment\">//遍历选项</span></span><br><span class=\"line\">          text: e, <span class=\"comment\">//文本为map中的内容</span></span><br><span class=\"line\">        )).toList(), <span class=\"comment\">//转为集合</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Text(_index.toString()), <span class=\"comment\">//body可以根据index来输出不同内容</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的顶部tabbar选项卡进阶\"><a class=\"markdownIt-Anchor\" href=\"#flutter的顶部tabbar选项卡进阶\">#</a> Flutter 的顶部 TabBar 选项卡（进阶）</h2>\n<p>使用 Flutter 提供 顶部 TabBarView 组件来设置选项卡</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506171550665.png\" alt=\"image-20220506171550665\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PageDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">//指定三个容器页面，在下方调用 widget.widgets 因为泛型指定了 Widget 所以都是Widget数组</span></span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;Widget&gt; widgets = [FlutterView(),AndroidView(),IOSView()];</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;PageDemo&gt; createState() =&gt; _PageDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_PageDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">PageDemo</span>&gt; <span class=\"title\">with</span> <span class=\"title\">SingleTickerProviderStateMixin</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span> tabs = [<span class=\"string\">&quot;Fullter&quot;</span>, <span class=\"string\">&quot;Andiord&quot;</span>, <span class=\"string\">&quot;IOS&quot;</span>];</span><br><span class=\"line\">  <span class=\"keyword\">late</span> TabController _controller = TabController(length: tabs.length, vsync: <span class=\"keyword\">this</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    _controller = TabController(</span><br><span class=\"line\">      length: tabs.length, </span><br><span class=\"line\">      vsync: <span class=\"keyword\">this</span></span><br><span class=\"line\">      );</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    _controller.dispose();</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        elevation: <span class=\"number\">10.0</span>,</span><br><span class=\"line\">        bottom: TabBar(</span><br><span class=\"line\">          controller: _controller,</span><br><span class=\"line\">          tabs: tabs.map((e) =&gt; Tab(</span><br><span class=\"line\">          text: e,</span><br><span class=\"line\">        )).toList(),</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: TabBarView( <span class=\"comment\">//使用 TabBarView 包裹body</span></span><br><span class=\"line\">        children: widget.widgets, <span class=\"comment\">//内容就是widgets</span></span><br><span class=\"line\">        controller: _controller, <span class=\"comment\">//通过控制器来切换</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">FlutterView</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;FlutterView&quot;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AndroidView</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;AndroidView&quot;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">IOSView</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Center(</span><br><span class=\"line\">      child: Text(<span class=\"string\">&quot;IOSView&quot;</span>),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的侧抽屉-drawer-样式\"><a class=\"markdownIt-Anchor\" href=\"#flutter的侧抽屉-drawer-样式\">#</a> Flutter 的侧抽屉 Drawer 样式</h2>\n<p>使用 Flutter 提供 侧抽屉 Drawer 组件来设置抽屉样式</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506172420330.png\" alt=\"image-20220506172420330\"></p>\n<h4 id=\"要点drawer是-scaffold-中的属性并不是-appbar-的\"><a class=\"markdownIt-Anchor\" href=\"#要点drawer是-scaffold-中的属性并不是-appbar-的\">#</a> 要点：drawer 是 Scaffold 中的属性，并不是 AppBar 的</h4>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506172505516.png\" alt=\"image-20220506172505516\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">myDrawer</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Drawer(</span><br><span class=\"line\">      child: MediaQuery.removePadding( <span class=\"comment\">//删除边距</span></span><br><span class=\"line\">        context: context, </span><br><span class=\"line\">        child: Column(</span><br><span class=\"line\">          crossAxisAlignment: CrossAxisAlignment.start, <span class=\"comment\">//从左开始</span></span><br><span class=\"line\">          children: [</span><br><span class=\"line\">            Padding(padding: EdgeInsets.only(top: <span class=\"number\">40</span>),</span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;Brath&quot;</span>),</span><br><span class=\"line\">            )</span><br><span class=\"line\">          ],</span><br><span class=\"line\">        ),</span><br><span class=\"line\">        removeTop: <span class=\"keyword\">true</span>, <span class=\"comment\">//删除顶部</span></span><br><span class=\"line\">        ),     </span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的底部选项卡\"><a class=\"markdownIt-Anchor\" href=\"#flutter的底部选项卡\">#</a> Flutter 的底部选项卡</h2>\n<p>使用 flutter 提供的 bottomNavigationBar 来做底部选项卡，做到点击卡片切换页面</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220506190446130.png\" alt=\"image-20220506190446130\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BottomNavigatorBarDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> BottomNavigatorBarDemo(&#123; Key? key &#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;BottomNavigatorBarDemo&gt; createState() =&gt; _BottomNavigatorBarDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_BottomNavigatorBarDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">BottomNavigatorBarDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> _index = <span class=\"number\">0</span>; <span class=\"comment\">//页面index</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;底部选项卡&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      bottomNavigationBar: BottomNavigationBar( <span class=\"comment\">//底部选项widget</span></span><br><span class=\"line\">        items: [</span><br><span class=\"line\">          <span class=\"comment\">//三个选项</span></span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.add),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;新增&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.home),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;我的&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.remove),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;减少&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      currentIndex: _index, <span class=\"comment\">//当前index</span></span><br><span class=\"line\">      onTap: (v)&#123; <span class=\"comment\">//当点击时，把当前索引状态改为点击的索引</span></span><br><span class=\"line\">      setState(() &#123;</span><br><span class=\"line\">        _index = v;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Center(child: Text(_index.toString())), <span class=\"comment\">//展示当前索引</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的底部选项卡进阶版\"><a class=\"markdownIt-Anchor\" href=\"#flutter的底部选项卡进阶版\">#</a> Flutter 的底部选项卡（进阶版）</h2>\n<p>使用 flutter 提供的 bottomNavigationBar 来做底部选项卡，做到按钮居中布局</p>\n<p>要点：两种实现方式，BottomNavigationBar 中如果 BottomNavigationBarItem 超过三个需要设置 type👇否则不显示</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">type: BottomNavigationBarType.fixed</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507084730237.png\" alt=\"image-20220507084730237\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">BottomNavigatorBarDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;Widget&gt; widgets = [ <span class=\"comment\">//四个页面数组</span></span><br><span class=\"line\">    PageDemo(),</span><br><span class=\"line\">    LayoutDemo(),</span><br><span class=\"line\">    LoginPage(),</span><br><span class=\"line\">      LoginPage(),</span><br><span class=\"line\">    ];</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;BottomNavigatorBarDemo&gt; createState() =&gt; _BottomNavigatorBarDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_BottomNavigatorBarDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">BottomNavigatorBarDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> _index = <span class=\"number\">0</span>; <span class=\"comment\">//页面index</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;底部选项卡&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      bottomNavigationBar: BottomNavigationBar( <span class=\"comment\">//底部选项widget</span></span><br><span class=\"line\">      type: BottomNavigationBarType.fixed, <span class=\"comment\">//设置超出三个页面显示</span></span><br><span class=\"line\">        items: [</span><br><span class=\"line\">          <span class=\"comment\">//三个选项</span></span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.add),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;首页&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.home),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;我的&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.remove),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;登录&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          BottomNavigationBarItem(</span><br><span class=\"line\">            icon: Icon(Icons.remove),</span><br><span class=\"line\">            label: <span class=\"string\">&quot;登录&quot;</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      currentIndex: _index, <span class=\"comment\">//当前index</span></span><br><span class=\"line\">      onTap: (v)&#123; <span class=\"comment\">//当点击时，把当前索引状态改为点击的索引</span></span><br><span class=\"line\">      setState(() &#123;</span><br><span class=\"line\">        _index = v;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked, <span class=\"comment\">//将按钮作为居中嵌入下方tabbar</span></span><br><span class=\"line\">      floatingActionButton: FloatingActionButton( <span class=\"comment\">//设置居中按钮</span></span><br><span class=\"line\">        onPressed: ()&#123;</span><br><span class=\"line\">          <span class=\"built_in\">print</span>(<span class=\"string\">&quot;object&quot;</span>);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: widget.widgets[_index], <span class=\"comment\">//展示当前索引</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>第二种实现方式：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507084943281.png\" alt=\"image-20220507084943281\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_BottomNavigatorBarDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">BottomNavigatorBarDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> _index = <span class=\"number\">0</span>; <span class=\"comment\">//页面index</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;底部选项卡&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      bottomNavigationBar: BottomAppBar(</span><br><span class=\"line\">        color: Theme.of(context).primaryColorDark, <span class=\"comment\">//设置tabbar颜色主题</span></span><br><span class=\"line\">        shape: CircularNotchedRectangle(), <span class=\"comment\">//设置按钮风格</span></span><br><span class=\"line\">        child: Row(</span><br><span class=\"line\">          mainAxisAlignment: MainAxisAlignment.spaceAround,</span><br><span class=\"line\">          children: [</span><br><span class=\"line\">           IconButton(</span><br><span class=\"line\">             onPressed: ()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">             &#125;, </span><br><span class=\"line\">             icon: Icon(Icons.add)),</span><br><span class=\"line\">             SizedBox(height: <span class=\"number\">16</span>),</span><br><span class=\"line\">                        IconButton(</span><br><span class=\"line\">             onPressed: ()&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">             &#125;, </span><br><span class=\"line\">             icon: Icon(Icons.home)),</span><br><span class=\"line\">          ]</span><br><span class=\"line\">        ),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked,</span><br><span class=\"line\">      floatingActionButton: FloatingActionButton(</span><br><span class=\"line\">        onPressed: ()&#123;</span><br><span class=\"line\">          <span class=\"built_in\">print</span>(<span class=\"string\">&quot;object&quot;</span>);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: widget.widgets[_index], <span class=\"comment\">//展示当前索引</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的列表-listviewwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter的列表-listviewwidget\">#</a> Flutter 的列表 （ListView）Widget</h2>\n<p>flutter 为我们提供了 ListView 这个 widget 来展示我们的列表</p>\n<p>源码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//均为可选参数</span></span><br><span class=\"line\">ListView(&#123;</span><br><span class=\"line\">    Key? key,</span><br><span class=\"line\">    Axis scrollDirection = Axis.vertical, <span class=\"comment\">//滑动方向，默认垂直</span></span><br><span class=\"line\">    <span class=\"built_in\">bool</span> reverse = <span class=\"keyword\">false</span>, <span class=\"comment\">//是否反向，默认否</span></span><br><span class=\"line\">    ScrollController? controller, <span class=\"comment\">//监听滑动距离回调 控制器</span></span><br><span class=\"line\">    <span class=\"built_in\">bool?</span> primary,</span><br><span class=\"line\">    ScrollPhysics? physics,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> shrinkWrap = <span class=\"keyword\">false</span>, <span class=\"comment\">//限制listview的高度为子组件的高度</span></span><br><span class=\"line\">    EdgeInsetsGeometry? padding,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.itemExtent, <span class=\"comment\">//设置list展示间距</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.prototypeItem,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addAutomaticKeepAlives = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addRepaintBoundaries = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addSemanticIndexes = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">double?</span> cacheExtent,</span><br><span class=\"line\">    <span class=\"built_in\">List</span>&lt;Widget&gt; children = <span class=\"keyword\">const</span> &lt;Widget&gt;[],</span><br><span class=\"line\">    <span class=\"built_in\">int?</span> semanticChildCount,</span><br><span class=\"line\">    DragStartBehavior dragStartBehavior = DragStartBehavior.start,</span><br><span class=\"line\">    ScrollViewKeyboardDismissBehavior keyboardDismissBehavior = ScrollViewKeyboardDismissBehavior.manual,</span><br><span class=\"line\">    <span class=\"built_in\">String?</span> restorationId,</span><br><span class=\"line\">    Clip clipBehavior = Clip.hardEdge,</span><br><span class=\"line\">  &#125;) </span><br></pre></td></tr></table></figure>\n<h5 id=\"用-listview-实现滑动列表并且可以细粒度显示每个list数据并且可以点击按钮返回顶部\"><a class=\"markdownIt-Anchor\" href=\"#用-listview-实现滑动列表并且可以细粒度显示每个list数据并且可以点击按钮返回顶部\">#</a> 用 ListView 实现滑动列表，并且可以细粒度显示每个 list 数据，并且可以点击按钮返回顶部</h5>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507094032250.png\" alt=\"image-20220507094032250\" style=\"zoom: 67%;\" /><img data-src=\"https://brath.cloud/blogImg/image-20220507094042244.png\" alt=\"image-20220507094042244\" style=\"zoom: 67%;\" /></p>\n<p>代码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ListViewDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123; <span class=\"comment\">//创建无状态Widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;ListViewDemo&gt; createState() =&gt; _ListViewDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_ListViewDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">ListViewDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;<span class=\"built_in\">int</span>&gt; list = []; <span class=\"comment\">//初始化list为空</span></span><br><span class=\"line\">  ScrollController _controller = ScrollController(); <span class=\"comment\">//控制器</span></span><br><span class=\"line\">  <span class=\"built_in\">bool</span> <span class=\"keyword\">show</span> = <span class=\"keyword\">false</span>; <span class=\"comment\">//是否展示按钮</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    _controller = ScrollController(); <span class=\"comment\">//初始化时，初始控制器</span></span><br><span class=\"line\">    _controller.addListener(() &#123; <span class=\"comment\">//增加控制器监听</span></span><br><span class=\"line\">      <span class=\"keyword\">if</span>(_controller.offset &gt;= <span class=\"number\">100</span> &amp;&amp; <span class=\"keyword\">show</span> == <span class=\"keyword\">false</span>)&#123; <span class=\"comment\">//如果滑动距离大于100并且按钮没展示那就展示按钮</span></span><br><span class=\"line\">        setState(() &#123;</span><br><span class=\"line\">          <span class=\"keyword\">show</span> = <span class=\"keyword\">true</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(_controller.offset &lt; <span class=\"number\">100</span> &amp;&amp; <span class=\"keyword\">show</span> == <span class=\"keyword\">true</span>)&#123; <span class=\"comment\">//如果滑动距离小于100并且按钮展示那就关闭按钮</span></span><br><span class=\"line\">        setState(() &#123;</span><br><span class=\"line\">          <span class=\"keyword\">show</span> = <span class=\"keyword\">false</span>;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">100</span>; i++) &#123;</span><br><span class=\"line\">      list.add(i); <span class=\"comment\">//循环添加到数组</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement dispose</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">    _controller.dispose(); <span class=\"comment\">//退出时，销毁控制器，否则内存会溢出</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;滚动列表&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      floatingActionButton: <span class=\"keyword\">show</span> ? FloatingActionButton( <span class=\"comment\">//使用三元来控制按钮展示</span></span><br><span class=\"line\">        child: Icon(Icons.vertical_align_top_outlined),</span><br><span class=\"line\">       onPressed: ()&#123;</span><br><span class=\"line\">        _controller.animateTo( <span class=\"comment\">//设置回到顶部</span></span><br><span class=\"line\">        <span class=\"number\">0</span>, <span class=\"comment\">//回到哪个部分 0 就是顶端</span></span><br><span class=\"line\">        duration: <span class=\"built_in\">Duration</span>(milliseconds: <span class=\"number\">300</span>),  <span class=\"comment\">//用Duration设置时间</span></span><br><span class=\"line\">        curve: Curves.slowMiddle <span class=\"comment\">//用Curves设置动效</span></span><br><span class=\"line\">        );</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">      ): <span class=\"keyword\">null</span>, <span class=\"comment\">//如果show为false则不展示按钮</span></span><br><span class=\"line\">      body: Scrollbar(</span><br><span class=\"line\">        child: RefreshIndicator( <span class=\"comment\">//使用 RefreshIndicator 包裹listview使其可以下拉刷新</span></span><br><span class=\"line\">          <span class=\"comment\">//第一种方法：直接展示数组数据</span></span><br><span class=\"line\">      <span class=\"comment\">//     child: ListView(</span></span><br><span class=\"line\">      <span class=\"comment\">//   children: list.map((e) =&gt; Text(e.toString())).toList(),</span></span><br><span class=\"line\">      <span class=\"comment\">//   shrinkWrap: true, //限制listview的高度为子组件的高度</span></span><br><span class=\"line\">      <span class=\"comment\">//   reverse: false,//是否反向列表</span></span><br><span class=\"line\">      <span class=\"comment\">//   itemExtent: 50,//设置list展示间距</span></span><br><span class=\"line\">      <span class=\"comment\">// ),</span></span><br><span class=\"line\">          <span class=\"comment\">//第二种方法，构造展示数组数据，可以细粒度操作</span></span><br><span class=\"line\">      child: ListView.builder(</span><br><span class=\"line\">        itemBuilder: (BuildContext context,<span class=\"built_in\">int</span> index)&#123; <span class=\"comment\">//itemBuilder构建列表</span></span><br><span class=\"line\">          <span class=\"keyword\">if</span>(index == <span class=\"number\">2</span>)&#123; <span class=\"comment\">//如果第索引 == 2那么就展示一个图标</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> Icon(Icons.add);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> Text(list[index].toString()); <span class=\"comment\">//返回所有list中的索引打印String类型</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        itemCount: list.length, <span class=\"comment\">//itemCount表示数组长度</span></span><br><span class=\"line\">        controller: _controller, <span class=\"comment\">//接入控制器</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">      onRefresh: _onRefresh, <span class=\"comment\">//使用_onRefresh方法决定下拉刷新时的操作</span></span><br><span class=\"line\">      )</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  Future _onRefresh() <span class=\"keyword\">async</span>&#123; <span class=\"comment\">//因为是异步操作所以加入 async ，在方法返回种使用 await 可以做到强制等待异步返回</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> Future.delayed( <span class=\"comment\">//处理返回</span></span><br><span class=\"line\">      <span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">3</span>), <span class=\"comment\">//等待3秒</span></span><br><span class=\"line\">      ()&#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;三&quot;</span>); <span class=\"comment\">//三秒后打印</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot;三&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的网格布局-gridviewwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter的网格布局-gridviewwidget\">#</a> Flutter 的网格布局 （GridView）Widget：</h2>\n<p>flutter 为我们提供了 GridView 这个 widget 来展示我们的网格数据</p>\n<p>源码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GridView(&#123;</span><br><span class=\"line\">    Key? key,</span><br><span class=\"line\">    Axis scrollDirection = Axis.vertical, <span class=\"comment\">//展示方向，默认垂直</span></span><br><span class=\"line\">    <span class=\"built_in\">bool</span> reverse = <span class=\"keyword\">false</span>, <span class=\"comment\">//是否反向</span></span><br><span class=\"line\">    ScrollController? controller, <span class=\"comment\">//滑动控制器</span></span><br><span class=\"line\">    <span class=\"built_in\">bool?</span> primary,</span><br><span class=\"line\">    ScrollPhysics? physics,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> shrinkWrap = <span class=\"keyword\">false</span>, <span class=\"comment\">//是否跟随子组件显示最大高度</span></span><br><span class=\"line\">    EdgeInsetsGeometry? padding,</span><br><span class=\"line\">    <span class=\"keyword\">required</span> <span class=\"keyword\">this</span>.gridDelegate,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addAutomaticKeepAlives = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addRepaintBoundaries = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">bool</span> addSemanticIndexes = <span class=\"keyword\">true</span>,</span><br><span class=\"line\">    <span class=\"built_in\">double?</span> cacheExtent,</span><br><span class=\"line\">    <span class=\"built_in\">List</span>&lt;Widget&gt; children = <span class=\"keyword\">const</span> &lt;Widget&gt;[],</span><br><span class=\"line\">    <span class=\"built_in\">int?</span> semanticChildCount,</span><br><span class=\"line\">    DragStartBehavior dragStartBehavior = DragStartBehavior.start,</span><br><span class=\"line\">    Clip clipBehavior = Clip.hardEdge,</span><br><span class=\"line\">    ScrollViewKeyboardDismissBehavior keyboardDismissBehavior = ScrollViewKeyboardDismissBehavior.manual,</span><br><span class=\"line\">    <span class=\"built_in\">String?</span> restorationId,</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507095538462.png\" alt=\"image-20220507095538462\"></p>\n<p>代码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Grid_view_demo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>, <span class=\"comment\">//居中appbar标题</span></span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;网格布局演示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: GridView(</span><br><span class=\"line\">        gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(</span><br><span class=\"line\">          crossAxisCount: <span class=\"number\">2</span>, <span class=\"comment\">//横向最大展示个数</span></span><br><span class=\"line\">          mainAxisSpacing: <span class=\"number\">10</span>, <span class=\"comment\">//横向间距</span></span><br><span class=\"line\">          crossAxisSpacing: <span class=\"number\">10</span>, <span class=\"comment\">//纵向间距</span></span><br><span class=\"line\">        ),</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Colors.amber,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">85</span>, <span class=\"number\">76</span>, <span class=\"number\">51</span>),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">14</span>, <span class=\"number\">223</span>, <span class=\"number\">125</span>),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            color: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">42</span>, <span class=\"number\">45</span>, <span class=\"number\">209</span>),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的弹窗alertdialogwidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter的弹窗alertdialogwidget\">#</a> Flutter 的弹窗（AlertDialog）Widget：</h2>\n<p>flutter 为我们提供了 AlertDialog 这个 widget 来展示我们的弹窗数据</p>\n<p>源码阅读：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> AlertDialog(&#123;</span><br><span class=\"line\">   Key? key,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.title, <span class=\"comment\">//弹窗标题</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.titlePadding, <span class=\"comment\">//弹窗边距</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.titleTextStyle, <span class=\"comment\">//文字风格</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.content, <span class=\"comment\">//弹窗内容</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.contentPadding = <span class=\"keyword\">const</span> EdgeInsets.fromLTRB(<span class=\"number\">24.0</span>, <span class=\"number\">20.0</span>, <span class=\"number\">24.0</span>, <span class=\"number\">24.0</span>), <span class=\"comment\">//内容边距</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.contentTextStyle, <span class=\"comment\">//内容风格</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.actions, <span class=\"comment\">//确认展示结果</span></span><br><span class=\"line\">   <span class=\"keyword\">this</span>.actionsPadding = EdgeInsets.zero,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.actionsAlignment,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.actionsOverflowDirection,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.actionsOverflowButtonSpacing,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.buttonPadding,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.backgroundColor,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.elevation,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.semanticLabel,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.insetPadding = _defaultInsetPadding,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.clipBehavior = Clip.none,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.shape,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.alignment,</span><br><span class=\"line\">   <span class=\"keyword\">this</span>.scrollable = <span class=\"keyword\">false</span>,</span><br><span class=\"line\"> &#125;)</span><br></pre></td></tr></table></figure>\n<h5 id=\"图片为ios风格的弹窗\"><a class=\"markdownIt-Anchor\" href=\"#图片为ios风格的弹窗\">#</a> 图片为 IOS 风格的弹窗</h5>\n<p><strong><img data-src=\"https://brath.cloud/blogImg/image-20220507101536722.png\" alt=\"image-20220507101536722\"></strong></p>\n<p>代码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AlertDialogDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123; <span class=\"comment\">//创建有状态widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;AlertDialogDemo&gt; createState() =&gt; _AlertDialogDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AlertDialogDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">AlertDialogDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;弹窗展示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column( <span class=\"comment\">//构建Column，展示按钮为对话框</span></span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">            onPressed: _showAlert, <span class=\"comment\">//设置弹窗方法 _showAlert</span></span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;对话框&quot;</span>))</span><br><span class=\"line\">          ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">void</span> _showAlert() <span class=\"keyword\">async</span>&#123; <span class=\"comment\">//async异步弹窗</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = <span class=\"keyword\">await</span> showDialog( <span class=\"comment\">//await接收异步结果</span></span><br><span class=\"line\">      context: context, <span class=\"comment\">//传递上下文对象</span></span><br><span class=\"line\">      builder: (BuildContext context) &#123; <span class=\"comment\">//builder构建方法，传入BuildContext</span></span><br><span class=\"line\">        <span class=\"comment\">//默认风格弹窗</span></span><br><span class=\"line\">        <span class=\"comment\">// return AlertDialog( //AlertDialog展示弹窗</span></span><br><span class=\"line\">        <span class=\"comment\">//   title: Text(&quot;与Brath的聊天&quot;), //弹窗标题</span></span><br><span class=\"line\">        <span class=\"comment\">//   content: Text(&quot;确认删除&quot;), //弹窗文本</span></span><br><span class=\"line\">        <span class=\"comment\">//   actions: [</span></span><br><span class=\"line\">        <span class=\"comment\">//     TextButton(onPressed: () &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//       Navigator.of(context).pop(true); //第一种返回方式，of上下文然后pop关闭，并返回一个true</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#125;, child: Text(&quot;确认&quot;)),</span></span><br><span class=\"line\">        <span class=\"comment\">//     TextButton(onPressed: () &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">//       Navigator.pop(context,false); //第二种返回方式，先pop关闭。然后用of链接上线问，并返回一个false</span></span><br><span class=\"line\">        <span class=\"comment\">//     &#125;, child: Text(&quot;取消&quot;)),</span></span><br><span class=\"line\">        <span class=\"comment\">//   ],</span></span><br><span class=\"line\">        <span class=\"comment\">// );</span></span><br><span class=\"line\">        <span class=\"comment\">//IOS风格弹窗 除了widget不一样，其他参数均为统一</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span> CupertinoAlertDialog(</span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;与Brath的聊天&quot;</span>),</span><br><span class=\"line\">          content: Text(<span class=\"string\">&quot;确认删除&quot;</span>),</span><br><span class=\"line\">          actions: [</span><br><span class=\"line\">            TextButton(onPressed: () &#123;</span><br><span class=\"line\">              Navigator.of(context).pop(<span class=\"keyword\">true</span>);</span><br><span class=\"line\">            &#125;, child: Text(<span class=\"string\">&quot;确认&quot;</span>)),</span><br><span class=\"line\">            TextButton(onPressed: () &#123;</span><br><span class=\"line\">              Navigator.pop(context,<span class=\"keyword\">false</span>);</span><br><span class=\"line\">            &#125;, child: Text(<span class=\"string\">&quot;取消&quot;</span>)),</span><br><span class=\"line\">          ],</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res); <span class=\"comment\">//打印路由返回结果</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的弹框simpledialog-widget\"><a class=\"markdownIt-Anchor\" href=\"#flutter的弹框simpledialog-widget\">#</a> Flutter 的弹框（SimpleDialog） Widget：</h2>\n<p>flutter 为我们提供了 SimpleDialog 这个 widget 来展示我们的弹框数据</p>\n<p>源码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> SimpleDialog(&#123;</span><br><span class=\"line\">    Key? key,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.title, <span class=\"comment\">//弹框标题</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.titlePadding = <span class=\"keyword\">const</span> EdgeInsets.fromLTRB(<span class=\"number\">24.0</span>, <span class=\"number\">24.0</span>, <span class=\"number\">24.0</span>, <span class=\"number\">0.0</span>),</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.titleTextStyle,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.children, </span><br><span class=\"line\">    <span class=\"keyword\">this</span>.contentPadding = <span class=\"keyword\">const</span> EdgeInsets.fromLTRB(<span class=\"number\">0.0</span>, <span class=\"number\">12.0</span>, <span class=\"number\">0.0</span>, <span class=\"number\">16.0</span>),</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.backgroundColor,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.elevation,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.semanticLabel,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.insetPadding = _defaultInsetPadding,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.clipBehavior = Clip.none,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.shape,</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.alignment,</span><br><span class=\"line\">  &#125;)</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507102533285.png\" alt=\"image-20220507102533285\"></p>\n<p>代码演示</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">AlertDialogDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123; <span class=\"comment\">//创建有状态widget</span></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;AlertDialogDemo&gt; createState() =&gt; _AlertDialogDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_AlertDialogDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">AlertDialogDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;<span class=\"built_in\">int</span>&gt; list = []; <span class=\"comment\">//初始化空数组</span></span><br><span class=\"line\"><span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement initState</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">20</span>; i++) &#123;</span><br><span class=\"line\">      list.add(i);<span class=\"comment\">//加入循环数据</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;弹窗展示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column( <span class=\"comment\">//构建Column，展示按钮为对话框</span></span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">            onPressed: _showAlert, <span class=\"comment\">//设置弹窗方法 _showAlert</span></span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;对话框&quot;</span>)),</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">            onPressed: _showList, <span class=\"comment\">//设置弹窗方法 _showAlert</span></span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;列表框&quot;</span>)),</span><br><span class=\"line\">          ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">void</span> _showList() <span class=\"keyword\">async</span>&#123; <span class=\"comment\">//async异步弹框</span></span><br><span class=\"line\"> <span class=\"keyword\">var</span> res = <span class=\"keyword\">await</span> showDialog( <span class=\"comment\">//await接收异步结果</span></span><br><span class=\"line\">      barrierDismissible: <span class=\"keyword\">false</span>, <span class=\"comment\">//展示弹窗，点击空白不会关闭</span></span><br><span class=\"line\">      context: context, <span class=\"comment\">//传递上下文对象</span></span><br><span class=\"line\">      builder: (BuildContext context) &#123; <span class=\"comment\">//builder构建方法，传入BuildContext</span></span><br><span class=\"line\">         <span class=\"keyword\">return</span> SimpleDialog( <span class=\"comment\">//创建弹框展示列表</span></span><br><span class=\"line\">          title: Text(<span class=\"string\">&quot;与Brath的聊天&quot;</span>), <span class=\"comment\">//弹框标题</span></span><br><span class=\"line\">          children: list.map((e) =&gt; GestureDetector( <span class=\"comment\">//用GestureDetector展示list</span></span><br><span class=\"line\">            child: Text(e.toString()), <span class=\"comment\">//每个孩子都是list中的String输出</span></span><br><span class=\"line\">            onTap: ()&#123;</span><br><span class=\"line\">              Navigator.pop(context,e); <span class=\"comment\">//点击每个list，路由返回并打印当前数组数值</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            )).toList(),</span><br><span class=\"line\">        );</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的表格tablewidget\"><a class=\"markdownIt-Anchor\" href=\"#flutter的表格tablewidget\">#</a> Flutter 的表格（Table）Widget：</h2>\n<p>flutter 为我们提供了 Table 还有 DataTable 这两个常用 widget 来展示我们的表格</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507110417537.png\" alt=\"image-20220507110417537\"></p>\n<p>代码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">TableDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;TableDemo&gt; createState() =&gt; _TableDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_TableDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">TableDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;<span class=\"built_in\">Map</span>&gt; list = []; <span class=\"comment\">//初始化表格数据</span></span><br><span class=\"line\">  <span class=\"built_in\">int</span> _sortColumnIndex = <span class=\"number\">0</span>; <span class=\"comment\">//初始化排序索引</span></span><br><span class=\"line\">  <span class=\"built_in\">bool</span> _sortAscending = <span class=\"keyword\">true</span>; <span class=\"comment\">//初始化排序方式 ture为 ASC false为 DESC</span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">      list.add(&#123; <span class=\"comment\">//循环添加map数据</span></span><br><span class=\"line\">        <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;b&quot;</span> * i,</span><br><span class=\"line\">        <span class=\"string\">&quot;gender&quot;</span>: i % <span class=\"number\">1</span> == <span class=\"number\">0</span> ? <span class=\"string\">&quot;男&quot;</span> : <span class=\"string\">&quot;女&quot;</span>, <span class=\"comment\">//取余等于0是男 否则是女</span></span><br><span class=\"line\">        <span class=\"string\">&quot;isSelect&quot;</span>: <span class=\"keyword\">false</span>, <span class=\"comment\">//选中状态默认为不选中</span></span><br><span class=\"line\">        <span class=\"string\">&quot;age&quot;</span>: i.toString() + i.toString(),</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;表格演示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Padding(</span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>), <span class=\"comment\">//设置10边距</span></span><br><span class=\"line\">        <span class=\"comment\">//普通表格</span></span><br><span class=\"line\">      <span class=\"comment\">//   child: Table(</span></span><br><span class=\"line\">      <span class=\"comment\">//   border: TableBorder.all(</span></span><br><span class=\"line\">      <span class=\"comment\">//     color: Colors.green</span></span><br><span class=\"line\">      <span class=\"comment\">//   ),</span></span><br><span class=\"line\">      <span class=\"comment\">//   children: list.map((e) =&gt; TableRow(</span></span><br><span class=\"line\">      <span class=\"comment\">//     children: [</span></span><br><span class=\"line\">      <span class=\"comment\">//       Text(e[&quot;name&quot;]), //展示name列</span></span><br><span class=\"line\">      <span class=\"comment\">//       Text(e[&quot;gender&quot;]), //展示性别列</span></span><br><span class=\"line\">      <span class=\"comment\">//     ],</span></span><br><span class=\"line\">      <span class=\"comment\">//   )).toList(),</span></span><br><span class=\"line\">      <span class=\"comment\">// ),</span></span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//H5表格，常用,可排序，可选中</span></span><br><span class=\"line\">      child: DataTable(</span><br><span class=\"line\">        sortColumnIndex: _sortColumnIndex, <span class=\"comment\">//设置排序索引</span></span><br><span class=\"line\">        sortAscending: _sortAscending, <span class=\"comment\">//设置排序方式</span></span><br><span class=\"line\">        columns: [</span><br><span class=\"line\">          DataColumn(</span><br><span class=\"line\">            onSort: (columnIndex, ascending) &#123; <span class=\"comment\">//DataColumn的排序方法</span></span><br><span class=\"line\">              setState(() &#123;</span><br><span class=\"line\">                _sortAscending = ascending; <span class=\"comment\">//设置ascending（排序方式）为当前的_sortAscending</span></span><br><span class=\"line\">                _sortColumnIndex = columnIndex; <span class=\"comment\">//设置columnIndex（排序索引）为当前的_sortColumnIndex</span></span><br><span class=\"line\">                list.sort((begin,end)&#123; <span class=\"comment\">//对数组排序</span></span><br><span class=\"line\">                  <span class=\"keyword\">if</span>(!ascending)&#123; <span class=\"comment\">//如果为desc的排序方式</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> c = begin; <span class=\"comment\">//新建c变量等于 begin</span></span><br><span class=\"line\">                    begin = end; <span class=\"comment\">//begin 赋值到 end</span></span><br><span class=\"line\">                    end = c; <span class=\"comment\">//edn赋值到c ，完成数据转换</span></span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">                  <span class=\"comment\">//返回begin的name数据，转换成edn的name数据</span></span><br><span class=\"line\">                  <span class=\"keyword\">return</span> begin[<span class=\"string\">&quot;name&quot;</span>].toString().length.compareTo(end[<span class=\"string\">&quot;name&quot;</span>].toString().length);</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            label: Text(<span class=\"string\">&quot;姓名&quot;</span>) <span class=\"comment\">//展示标题为姓名</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          DataColumn(</span><br><span class=\"line\">            label: Text(<span class=\"string\">&quot;性别&quot;</span>) <span class=\"comment\">//展示标题为性别</span></span><br><span class=\"line\">          ), </span><br><span class=\"line\">          DataColumn(</span><br><span class=\"line\">            label: Text(<span class=\"string\">&quot;年龄&quot;</span>) <span class=\"comment\">//展示标题为年龄</span></span><br><span class=\"line\">          ), </span><br><span class=\"line\">        ], <span class=\"comment\">//表头列</span></span><br><span class=\"line\">        rows: list.map((e) =&gt; DataRow(</span><br><span class=\"line\">          selected: e[<span class=\"string\">&quot;isSelect&quot;</span>],</span><br><span class=\"line\">          onSelectChanged: (v)&#123; <span class=\"comment\">//点击数据</span></span><br><span class=\"line\">            setState(() &#123; <span class=\"comment\">//改变状态</span></span><br><span class=\"line\">              <span class=\"keyword\">if</span>(e[<span class=\"string\">&quot;isSelect&quot;</span>] != v)&#123; <span class=\"comment\">//如果当前选中状态不等于传过来的状态（选中|不选中）</span></span><br><span class=\"line\">                e[<span class=\"string\">&quot;isSelect&quot;</span>] = v; <span class=\"comment\">//就把他传过来的状态设置为当前状态</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          cells: [</span><br><span class=\"line\">            DataCell(Text(e[<span class=\"string\">&quot;name&quot;</span>])), <span class=\"comment\">//设置姓名内容列</span></span><br><span class=\"line\">            DataCell(Text(e[<span class=\"string\">&quot;gender&quot;</span>])), <span class=\"comment\">//设置性别内容列</span></span><br><span class=\"line\">            DataCell(Text(e[<span class=\"string\">&quot;age&quot;</span>])), <span class=\"comment\">//设置年龄内容列</span></span><br><span class=\"line\">          ]</span><br><span class=\"line\">        )</span><br><span class=\"line\">        ).toList(),<span class=\"comment\">//数组打印</span></span><br><span class=\"line\">      ),</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter卡片card-widget\"><a class=\"markdownIt-Anchor\" href=\"#flutter卡片card-widget\">#</a> Flutter 卡片（Card） Widget：</h2>\n<p>flutter 为我们提供了 Card 这个 widget 来展示我们的卡片数据</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507111422728.png\" alt=\"image-20220507111422728\"></p>\n<p>代码展示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CardDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;CardDemo&gt; createState() =&gt; _CardDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_CardDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">CardDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">List</span>&lt;<span class=\"built_in\">Map</span>&gt; list = []; </span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement initState</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">10</span>; i++) &#123;</span><br><span class=\"line\">          list.add(&#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;age&quot;</span>: <span class=\"number\">10</span> + i,</span><br><span class=\"line\">            <span class=\"string\">&quot;name&quot;</span>: <span class=\"string\">&quot;barth&quot;</span> + i.toString(),</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\"><span class=\"language-markdown\">/**</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\">   *</span> list构建方法，一定要在 build 方法上面，init方法下面构建，因为代码从上到下执行</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\">   <span class=\"emphasis\">*/</span></span></span></span><br><span class=\"line\">  Widget _itemBuilder(BuildContext context,<span class=\"built_in\">int</span> index)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Card( <span class=\"comment\">//返回卡片集合</span></span><br><span class=\"line\">      color: Colors.green, <span class=\"comment\">//设置卡片背景色</span></span><br><span class=\"line\">      shadowColor: Colors.grey, <span class=\"comment\">//设置阴影背景色</span></span><br><span class=\"line\">      elevation: <span class=\"number\">5.0</span>, <span class=\"comment\">//设置阴影度</span></span><br><span class=\"line\">      child: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          SizedBox(height: <span class=\"number\">8</span>), <span class=\"comment\">//于顶部间隔 8</span></span><br><span class=\"line\">          Text(list[index][<span class=\"string\">&quot;name&quot;</span>]),<span class=\"comment\">//展示list中的name</span></span><br><span class=\"line\">          SizedBox(height: <span class=\"number\">8</span>), <span class=\"comment\">//与上个name间隔8</span></span><br><span class=\"line\">          Text(list[index][<span class=\"string\">&quot;age&quot;</span>].toString()), <span class=\"comment\">//展示age内容</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;卡片数据演示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Padding( <span class=\"comment\">//边距 Widget</span></span><br><span class=\"line\">        padding: EdgeInsets.all(<span class=\"number\">10</span>), <span class=\"comment\">//设置上下左右10边距</span></span><br><span class=\"line\">        child: ListView.builder( <span class=\"comment\">//构建listView</span></span><br><span class=\"line\">          itemBuilder: _itemBuilder, <span class=\"comment\">//设置builder方法</span></span><br><span class=\"line\">          itemCount: list.length, <span class=\"comment\">//设置list大小</span></span><br><span class=\"line\">          )</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的listtitlewidget类似于聊天标签\"><a class=\"markdownIt-Anchor\" href=\"#flutter的listtitlewidget类似于聊天标签\">#</a> Flutter 的（ListTitle）Widget（类似于聊天标签）：</h2>\n<p>Flutter 为我们提供了 ListTile 这个 Widget 来展示标签</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507112500603.png\" alt=\"image-20220507112500603\"></p>\n<p>代码演示：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@override</span></span><br><span class=\"line\">Widget build(BuildContext context) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">    backgroundColor: Colors.white,</span><br><span class=\"line\">    appBar: AppBar(</span><br><span class=\"line\">      centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">      title: Text(<span class=\"string\">&quot;卡片数据演示&quot;</span>),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    body: Padding( <span class=\"comment\">//边距 Widget</span></span><br><span class=\"line\">      padding: EdgeInsets.all(<span class=\"number\">10</span>), <span class=\"comment\">//设置上下左右10边距</span></span><br><span class=\"line\">      <span class=\"comment\">//listView卡片</span></span><br><span class=\"line\">      child: ListView(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ListTile( <span class=\"comment\">//创建listTitle</span></span><br><span class=\"line\">            tileColor: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">204</span>, <span class=\"number\">184</span>, <span class=\"number\">128</span>), <span class=\"comment\">//标签颜色</span></span><br><span class=\"line\">            leading: Icon(Icons.token_sharp), <span class=\"comment\">//左边图标</span></span><br><span class=\"line\">            title: Text(<span class=\"string\">&quot;Brath&quot;</span>),<span class=\"comment\">//主标题数据</span></span><br><span class=\"line\">            textColor: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">49</span>, <span class=\"number\">54</span>, <span class=\"number\">42</span>),<span class=\"comment\">//标题文字颜色</span></span><br><span class=\"line\">            subtitle: Text(<span class=\"string\">&quot;Flutter卡片数据演示数据 1 &quot;</span>), <span class=\"comment\">//副标题数据</span></span><br><span class=\"line\">            trailing: Icon(Icons.account_circle_rounded),<span class=\"comment\">//右边图标</span></span><br><span class=\"line\">          ),</span><br><span class=\"line\">          SizedBox(height: <span class=\"number\">8</span>),</span><br><span class=\"line\">          ListTile(</span><br><span class=\"line\">            tileColor: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">197</span>, <span class=\"number\">124</span>, <span class=\"number\">55</span>),</span><br><span class=\"line\">            leading: Icon(Icons.token_sharp),</span><br><span class=\"line\">            title: Text(<span class=\"string\">&quot;Braht 2&quot;</span>),</span><br><span class=\"line\">            textColor: Color.fromARGB(<span class=\"number\">255</span>, <span class=\"number\">49</span>, <span class=\"number\">54</span>, <span class=\"number\">42</span>),</span><br><span class=\"line\">           subtitle: Text(<span class=\"string\">&quot;Flutter卡片数据演示数据 2 &quot;</span>),</span><br><span class=\"line\">            trailing: Icon(Icons.account_circle_rounded),</span><br><span class=\"line\">          ),        </span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    </span><br><span class=\"line\">    ),</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter性能优化\"><a class=\"markdownIt-Anchor\" href=\"#flutter性能优化\">#</a> Flutter 性能优化：</h2>\n<p>先看图片：</p>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507114818793.png\" alt=\"image-20220507114818793\"></p>\n<p>​\t\t我们以看到，这张图片由三个容器构成，并且点击黄色容器，其数字会增加，理论上来说代码并没有任何问题。</p>\n<p>​\t\t但是，在我们打开 检测工具后，发现，当点击黄色容器时，所有容器都会重新渲染，这就造成了性能的损耗！</p>\n<p>​\t\t如何优化？</p>\n<p>​\t\t代码演示：</p>\n<h5 id=\"使用一个单独的-countdemo-来对-黄色的容器进行封装这样就可以做到单独渲染\"><a class=\"markdownIt-Anchor\" href=\"#使用一个单独的-countdemo-来对-黄色的容器进行封装这样就可以做到单独渲染\">#</a> 使用一个单独的 CountDemo 来对 黄色的容器进行封装，这样就可以做到单独渲染</h5>\n<h5 id=\"因为-setstate-会重新绘制当前组件column单独封装后他自己就是一个单独组件countdemo\"><a class=\"markdownIt-Anchor\" href=\"#因为-setstate-会重新绘制当前组件column单独封装后他自己就是一个单独组件countdemo\">#</a> 因为 setState 会重新绘制当前组件（Column），单独封装后，他自己就是一个单独组件（CountDemo）</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">performanceDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;performanceDemo&gt; createState() =&gt; _performanceDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_performanceDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">performanceDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;性能优化专题&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">            color: Colors.red,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">            color: Colors.yellow,</span><br><span class=\"line\">            child: CountDemo(),</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Container(</span><br><span class=\"line\">            width: <span class=\"built_in\">double</span>.infinity,</span><br><span class=\"line\">            height: <span class=\"number\">100</span>,</span><br><span class=\"line\">            color: Colors.blue,</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-markdown\">/**</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\"> *</span> 使用一个单独的 CountDemo 来对 黄色的容器进行封装，这样就可以做到单独渲染</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\"> *</span> 因为 setState 会重新绘制当前组件（Column），单独封装后，他自己就是一个单独组件（CountDemo）</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"> <span class=\"strong\">**/</span></span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CountDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;CountDemo&gt; createState() =&gt; _CountDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_CountDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">CountDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> GestureDetector(</span><br><span class=\"line\">              child: Text(count.toString()),</span><br><span class=\"line\">              onTap: ()&#123;</span><br><span class=\"line\">                setState(() &#123;</span><br><span class=\"line\">                  count ++;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的全局状态管理-provider-非常重要\"><a class=\"markdownIt-Anchor\" href=\"#flutter的全局状态管理-provider-非常重要\">#</a> Flutter 的全局状态管理 Provider 非常重要！</h2>\n<h5 id=\"我们分为四个步骤来学习全局状态管理-provider\"><a class=\"markdownIt-Anchor\" href=\"#我们分为四个步骤来学习全局状态管理-provider\">#</a> 我们分为四个步骤来学习全局状态管理 Provider</h5>\n<h5 id=\"1-因为全局状态管理是单独的插件所以我们第一步一定是导包\"><a class=\"markdownIt-Anchor\" href=\"#1-因为全局状态管理是单独的插件所以我们第一步一定是导包\">#</a> 1、因为全局状态管理是单独的插件，所以我们第一步一定是导包</h5>\n<p>选择根目录下的 pubspec.yaml 依赖配置文件</p>\n<p>以作者 Brath 的 flutter 版本 2.0 为例，使用 5.0.0 版本<img data-src=\"https://brath.cloud/blogImg/image-20220507123010044.png\" alt=\"image-20220507123010044\"></p>\n<h5 id=\"2-下载好依赖后我们在-lib-目录创建文件夹provider-并在文件夹内创建一个-count_providerdart作为我们的第一个全局状态类\"><a class=\"markdownIt-Anchor\" href=\"#2-下载好依赖后我们在-lib-目录创建文件夹provider-并在文件夹内创建一个-count_providerdart作为我们的第一个全局状态类\">#</a> 2、下载好依赖后，我们在 lib 目录创建文件夹：Provider 并在文件夹内创建一个 Count_provider.dart，作为我们的第一个全局状态类</h5>\n<p><img data-src=\"https://brath.cloud/blogImg/image-20220507123111058.png\" alt=\"image-20220507123111058\"></p>\n<p>​\t\t在类中写入代码：</p>\n<h5 id=\"要点notifylisteners-这个方法的作用就是实现局部刷新\"><a class=\"markdownIt-Anchor\" href=\"#要点notifylisteners-这个方法的作用就是实现局部刷新\">#</a> 要点：notifyListeners () 这个方法的作用就是实现局部刷新</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">CountProvider</span> <span class=\"keyword\">extends</span> <span class=\"title\">ChangeNotifier</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">int</span> _count = <span class=\"number\">0</span>; <span class=\"comment\">//定义初始数量为0</span></span><br><span class=\"line\">  <span class=\"keyword\">get</span> count =&gt; _count; <span class=\"comment\">//get方法用于外部获取count</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> add()&#123; <span class=\"comment\">//增加方法</span></span><br><span class=\"line\">    _count ++; <span class=\"comment\">//总数+1</span></span><br><span class=\"line\">    notifyListeners();<span class=\"comment\">//通知监听方法</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"3-我们写一个新的类用于测试全局状态数据\"><a class=\"markdownIt-Anchor\" href=\"#3-我们写一个新的类用于测试全局状态数据\">#</a> 3、我们写一个新的类用于测试全局状态数据</h5>\n<p>​\t\t要点：</p>\n<p>​\t\t\t1. 获取全局变量：</p>\n<h5 id=\"通过provider的of方法泛型我们的全局状态类传入上下文对象就可以获取count\"><a class=\"markdownIt-Anchor\" href=\"#通过provider的of方法泛型我们的全局状态类传入上下文对象就可以获取count\">#</a> 通过 Provider 的 of 方法（泛型我们的全局状态类）传入上下文对象，就可以获取 count</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Provider.of&lt;CountProvider&gt;(context).count.toString()</span><br></pre></td></tr></table></figure>\n<p>​\t\t\t2. 修改全局变量：</p>\n<h5 id=\"通过上下文对象的read方法泛型我们的全局状态类就可以获取状态类中的方法来操作\"><a class=\"markdownIt-Anchor\" href=\"#通过上下文对象的read方法泛型我们的全局状态类就可以获取状态类中的方法来操作\">#</a> 通过上下文对象的 read 方法（泛型我们的全局状态类），就可以获取状态类中的方法，来操作</h5>\n<h6 id=\"tips不是从当前页使用方法修改全局变量而是全局变量提供了方法供外部修改\"><a class=\"markdownIt-Anchor\" href=\"#tips不是从当前页使用方法修改全局变量而是全局变量提供了方法供外部修改\">#</a> Tips：不是从当前页使用方法修改全局变量，而是全局变量提供了方法供外部修改！</h6>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">context.read&lt;CountProvider&gt;().add();</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;ProviderDemo&gt; createState() =&gt; _ProviderDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_ProviderDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">ProviderDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;Provider全局状态管理&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">          onPressed: ()&#123;</span><br><span class=\"line\">            Navigator.of(context).pushNamed(<span class=\"string\">&quot;ProviderDemo2&quot;</span>); <span class=\"comment\">//点击跳转到ProviderDemo2页面</span></span><br><span class=\"line\">          &#125;, </span><br><span class=\"line\">          child: Icon(Icons.add_task_rounded)),</span><br><span class=\"line\">          Text(</span><br><span class=\"line\">          Provider.of&lt;CountProvider&gt;(context).count.toString() <span class=\"comment\">//通过Provider展示count数据</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      floatingActionButton: FloatingActionButton(</span><br><span class=\"line\">        child: Icon(Icons.sanitizer_sharp),</span><br><span class=\"line\">        onPressed: ()&#123;</span><br><span class=\"line\">          context.read&lt;CountProvider&gt;().add(); <span class=\"comment\">//通过上下文对象获取add方法实现新增</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"><span class=\"language-markdown\">/**</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\"> *</span> 第二个页面</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"> <span class=\"emphasis\">*/</span></span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProviderDemo2</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;Provider2&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">     body: FloatingActionButton(</span><br><span class=\"line\">        child: Icon(Icons.sanitizer_sharp),</span><br><span class=\"line\">        onPressed: ()&#123;</span><br><span class=\"line\">          context.read&lt;CountProvider&gt;().add(); <span class=\"comment\">//通过上下文对象获取add方法实现新增</span></span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>4、在 main.dart 中修改启动方式</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main() &#123;</span><br><span class=\"line\">  runApp(</span><br><span class=\"line\">      <span class=\"comment\">//只用 ChangeNotifierProvider 来包裹就只可以调用一个全局类</span></span><br><span class=\"line\">      <span class=\"comment\">// ChangeNotifierProvider(</span></span><br><span class=\"line\">      <span class=\"comment\">//   create: (context)=&gt;CountProvider(),</span></span><br><span class=\"line\">      <span class=\"comment\">//   child: MyApp(),</span></span><br><span class=\"line\">      <span class=\"comment\">//   ),</span></span><br><span class=\"line\">      <span class=\"comment\">//使用 MultiProvider 多状态管理来包裹，即可实现多个状态类</span></span><br><span class=\"line\">      MultiProvider(</span><br><span class=\"line\">          providers: [</span><br><span class=\"line\">            ChangeNotifierProvider(</span><br><span class=\"line\">            create: (context) =&gt; CountProvider(),</span><br><span class=\"line\">          ), </span><br><span class=\"line\">          <span class=\"comment\">//   ChangeNotifierProvider(</span></span><br><span class=\"line\">          <span class=\"comment\">//   create: (context) =&gt; CountProvider2(),</span></span><br><span class=\"line\">          <span class=\"comment\">// ), </span></span><br><span class=\"line\">          ],</span><br><span class=\"line\">    child: MyApp(),</span><br><span class=\"line\">  ));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"flutter的网络请求dio\"><a class=\"markdownIt-Anchor\" href=\"#flutter的网络请求dio\">#</a> Flutter 的网络请求（DIO）</h2>\n<h5 id=\"flutter在-pubdev-为我们提供了许多网络请求组件我们选择用dio来做请求组件\"><a class=\"markdownIt-Anchor\" href=\"#flutter在-pubdev-为我们提供了许多网络请求组件我们选择用dio来做请求组件\">#</a> Flutter 在 pub.dev 为我们提供了许多网络请求组件，我们选择用 DIO 来做请求组件</h5>\n<p>使用方法：</p>\n<h5 id=\"1-因为网络请求是单独的插件所以我们第一步一定是导包\"><a class=\"markdownIt-Anchor\" href=\"#1-因为网络请求是单独的插件所以我们第一步一定是导包\">#</a> 1、因为网络请求是单独的插件，所以我们第一步一定是导包</h5>\n<p>选择根目录下的 pubspec.yaml 依赖配置文件</p>\n<p>以作者 Brath 的 flutter 版本 2.0 为例，使用 4.0.0 版本<img data-src=\"https://brath.cloud/blogImg/image-20220507124040380.png\" alt=\"image-20220507124040380\"></p>\n<h5 id=\"2-编写代码\"><a class=\"markdownIt-Anchor\" href=\"#2-编写代码\">#</a> 2、编写代码：</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">DioDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;DioDemo&gt; createState() =&gt; _DioDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_DioDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">DioDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  Dio _dio = Dio(); <span class=\"comment\">//定义DIO</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement initState</span></span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\">    <span class=\"comment\">//初始化baseUrl基URL</span></span><br><span class=\"line\">    _dio.options.baseUrl = <span class=\"string\">&quot;https://www.XXX.XXX:0000/&quot;</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;网络请求演示&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">            onPressed: _<span class=\"keyword\">get</span>,</span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;getUserinfo&quot;</span>)</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ]</span><br><span class=\"line\">        ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">void</span> _<span class=\"keyword\">get</span>() <span class=\"keyword\">async</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//第一种传参方式：名文传输</span></span><br><span class=\"line\">    <span class=\"comment\">// var res = await _dio.get(&quot;get/getData?id=1&quot;);</span></span><br><span class=\"line\">    <span class=\"comment\">// print(res.toString()); </span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">//第二种传参方式：queryParameters包装传输</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> res2 = <span class=\"keyword\">await</span> _dio.<span class=\"keyword\">get</span>(</span><br><span class=\"line\">      <span class=\"string\">&quot;get/getData&quot;</span>,</span><br><span class=\"line\">      queryParameters: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;id&quot;</span>: <span class=\"number\">1</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"comment\">//通过Options来添加 headers 请求头</span></span><br><span class=\"line\">      options: Options(</span><br><span class=\"line\">        headers: &#123;</span><br><span class=\"line\">          <span class=\"string\">&quot;token&quot;</span>: <span class=\"string\">&quot;header-Token&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      )</span><br><span class=\"line\">    );</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res2.toString()); </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"3-如果小伙伴们的请求报错有以下原因-参考博客httpsblogcsdnnettxaz6articledetails119168489\"><a class=\"markdownIt-Anchor\" href=\"#3-如果小伙伴们的请求报错有以下原因-参考博客httpsblogcsdnnettxaz6articledetails119168489\">#</a> 3、如果小伙伴们的请求报错：有以下原因 （参考博客：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3R4YXo2L2FydGljbGUvZGV0YWlscy8xMTkxNjg0ODklRUYlQkMlODk=\">https://blog.csdn.net/txaz6/article/details/119168489）</span></h5>\n<h5 id=\"1请求本地连接ip地址错误\"><a class=\"markdownIt-Anchor\" href=\"#1请求本地连接ip地址错误\">#</a> 1. 请求本地连接，ip 地址错误</h5>\n<h5 id=\"2未添加网络请求权限\"><a class=\"markdownIt-Anchor\" href=\"#2未添加网络请求权限\">#</a> 2. 未添加网络请求权限</h5>\n<h5 id=\"3请求的地址是http不是https\"><a class=\"markdownIt-Anchor\" href=\"#3请求的地址是http不是https\">#</a> 3. 请求的地址是 http，不是 https</h5>\n<h5 id=\"4与服务端的请求参数不同导致无法请求到接口\"><a class=\"markdownIt-Anchor\" href=\"#4与服务端的请求参数不同导致无法请求到接口\">#</a> 4. 与服务端的请求参数不同，导致无法请求到接口</h5>\n<h3 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h3>\n<h2 id=\"flutter的设计模式mvvmmodel-view-viewmodel\"><a class=\"markdownIt-Anchor\" href=\"#flutter的设计模式mvvmmodel-view-viewmodel\">#</a> Flutter 的设计模式（MVVM）（Model View ViewModel）</h2>\n<h4 id=\"mvvm就是model-view-viewmodel的简写\"><a class=\"markdownIt-Anchor\" href=\"#mvvm就是model-view-viewmodel的简写\">#</a> MVVM 就是 Model View ViewModel 的简写。</h4>\n<h5 id=\"model-处理接口请求数据\"><a class=\"markdownIt-Anchor\" href=\"#model-处理接口请求数据\">#</a> Model ：处理接口请求数据</h5>\n<h5 id=\"view-展示页面\"><a class=\"markdownIt-Anchor\" href=\"#view-展示页面\">#</a> View ：展示页面</h5>\n<h5 id=\"viewmodel处理业务逻辑相当于model-view的链接层\"><a class=\"markdownIt-Anchor\" href=\"#viewmodel处理业务逻辑相当于model-view的链接层\">#</a> ViewModel：处理业务逻辑（相当于 Model、View 的链接层）</h5>\n<h6 id=\"简单流程view通知viewmodel层viewmodel通知model层调用接口viewmodel层接收model的数据响应给view层展示\"><a class=\"markdownIt-Anchor\" href=\"#简单流程view通知viewmodel层viewmodel通知model层调用接口viewmodel层接收model的数据响应给view层展示\">#</a> 简单流程：view 通知 viewModel 层，viewModel 通知 Model 层调用接口，viewModel 层接收 Model 的数据，响应给 view 层展示</h6>\n<h4 id=\"我们通过几个步骤来演示-mvvm-模式的请求流程以及他的优缺点\"><a class=\"markdownIt-Anchor\" href=\"#我们通过几个步骤来演示-mvvm-模式的请求流程以及他的优缺点\">#</a> 我们通过几个步骤来演示 MVVM 模式的请求流程，以及他的优缺点</h4>\n<h5 id=\"1-首先创建-model-view-viewmodel-三个文件夹image-20220507133147052\"><a class=\"markdownIt-Anchor\" href=\"#1-首先创建-model-view-viewmodel-三个文件夹image-20220507133147052\">#</a> 1、首先创建   Model View ViewModel 三个文件夹<img data-src=\"https://brath.cloud/blogImg/image-20220507133147052.png\" alt=\"image-20220507133147052\"></h5>\n<h5 id=\"2-编写-model-层-请求数据\"><a class=\"markdownIt-Anchor\" href=\"#2-编写-model-层-请求数据\">#</a> 2、编写 Model 层 （请求数据）</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MvvmModel</span></span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">dynamic</span> <span class=\"keyword\">get</span>(<span class=\"built_in\">int</span> id) <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\"><span class=\"language-markdown\">/**</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"bullet\">     *</span> 获取用户信息方法</span></span></span><br><span class=\"line\"><span class=\"language-markdown\"><span class=\"comment\"><span class=\"code\">     */</span></span></span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;开始调用userinfo接口&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = <span class=\"keyword\">await</span> Dio().<span class=\"keyword\">get</span>(</span><br><span class=\"line\">      <span class=\"string\">&quot;https://xxx:0000/gerUserInfo&quot;</span>,</span><br><span class=\"line\">      queryParameters: &#123; <span class=\"comment\">//设置请求参数</span></span><br><span class=\"line\">        <span class=\"string\">&quot;userId&quot;</span>: id <span class=\"comment\">//id = viewModel传来的ID</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">    );</span><br><span class=\"line\">     <span class=\"built_in\">print</span>(<span class=\"string\">&quot;调用完毕&quot;</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"3-编写-view-层-接收-展示数据\"><a class=\"markdownIt-Anchor\" href=\"#3-编写-view-层-接收-展示数据\">#</a> 3、编写 View 层 （接收、展示数据）</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MvvmViewDemo</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;MvvmViewDemo&gt; createState() =&gt; _MvvmViewDemoState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_MvvmViewDemoState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">MvvmViewDemo</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">dynamic</span> res;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Scaffold(</span><br><span class=\"line\">      appBar: AppBar(</span><br><span class=\"line\">        centerTitle: <span class=\"keyword\">true</span>,</span><br><span class=\"line\">        title: Text(<span class=\"string\">&quot;View展示页面&quot;</span>),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      body: Column(</span><br><span class=\"line\">        children: [</span><br><span class=\"line\">          ElevatedButton(</span><br><span class=\"line\">            onPressed: () <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">             <span class=\"comment\">//使用上下文对象的read泛型 ViewModel 类来使用get方法传入 id 获取信息</span></span><br><span class=\"line\">             context.read&lt;MvvmViewModel&gt;().<span class=\"keyword\">get</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            child: Text(<span class=\"string\">&quot;调用ViewwModel获取用户userinfo&quot;</span>)</span><br><span class=\"line\">          ),</span><br><span class=\"line\">        ],</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"4-编写-viewmodel-层-整合view以及modelview调用viewmodel-viewmodel-调用-model-返回结果给view\"><a class=\"markdownIt-Anchor\" href=\"#4-编写-viewmodel-层-整合view以及modelview调用viewmodel-viewmodel-调用-model-返回结果给view\">#</a> 4、编写 ViewModel 层 （整合 view 以及 model：view 调用 ViewModel ，ViewModel 调用 model 返回结果给 view）</h5>\n<p>tips：在调用完接口后跳转时，因为 Navigator 需要一个上下文对象，但是我们当前没有上下文对象，所以要在 main 入口定义一个对象：</p>\n<p>main.dart👇</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">final</span> GlobalKey&lt;NavigatorState&gt; navigatorkey = GlobalKey&lt;NavigatorState&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      navigatorKey: navigatorkey, <span class=\"comment\">//在 MaterialApp 中 将 navigatorKey 设置为我们定义的navigatorkey，这也是为什么flutter要求使用 MaterialApp 作为mian根节点的原因</span></span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>MvvmViewModel.dart👇</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MvvmViewModel</span> <span class=\"keyword\">extends</span> <span class=\"title\">ChangeNotifier</span></span>&#123;</span><br><span class=\"line\"> MvvmModel _model = MvvmModel(); <span class=\"comment\">//实例化 model 的对象，因为model是做请求的所以我们调用model</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> <span class=\"keyword\">get</span>(<span class=\"built_in\">int</span> id) <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//使用model的get方法传入id来获取数据，注意使用 async 和 await 来做异步调用防止接口错误导致程序等待超时</span></span><br><span class=\"line\">    Response res = <span class=\"keyword\">await</span> _model.<span class=\"keyword\">get</span>(id); </span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.data); <span class=\"comment\">//获取 Response 的数据</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.headers); <span class=\"comment\">//获取 Response 的请求头</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.statusCode); <span class=\"comment\">//获取 Response 的状态码</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(res.realUri);     <span class=\"comment\">//获取 Response 的请求地址</span></span><br><span class=\"line\">    <span class=\"comment\">//使用mian中的 navigatorkey 的 currentContext 来获取当前的上下文对象，如果是dart2.0以后需要加一个 ！否则会报错，因为参数必须不能为空</span></span><br><span class=\"line\">    Navigator.of(navigatorkey.currentContext!).pushNamed(<span class=\"string\">&quot;DioDemo&quot;</span>); <span class=\"comment\">//我们在调用完接口后跳转到 DioDemo页面</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"5-dio返回值-response-介绍\"><a class=\"markdownIt-Anchor\" href=\"#5-dio返回值-response-介绍\">#</a> 5、DIO 返回值 <strong>Response</strong> 介绍</h5>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Response res = <span class=\"keyword\">await</span> _model.<span class=\"keyword\">get</span>(id); </span><br><span class=\"line\"><span class=\"built_in\">print</span>(res.data); <span class=\"comment\">//获取 Response 的数据</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(res.headers); <span class=\"comment\">//获取 Response 的请求头</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(res.statusCode); <span class=\"comment\">//获取 Response 的状态码</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(res.realUri);     <span class=\"comment\">//获取 Response 的请求地址</span></span><br></pre></td></tr></table></figure>\n<p>本篇至此就结束啦！如果你读到了这里，不妨给我点个赞，我叫 Brath，是一个非科班出身的技术狂！</p>\n<p>我的博客 brath.top 欢迎访问！</p>\n<p>全文共计  15332 词</p>\n<p>本文由 Brath 编写，禁止转载，违法必究‘！</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/",
            "url": "http://example.com/2022/12/27/Flutter%E5%BC%80%E5%8F%91%E4%B8%AD%E4%BD%BF%E7%94%A8WIFI%E7%9C%9F%E6%9C%BA%E8%B0%83%E8%AF%95/",
            "title": "Flutter开发中使用WIFI真机调试",
            "date_published": "2022-12-27T08:18:48.562Z",
            "content_html": "<h1 id=\"flutter开发中使用wifi真机调试\"><a class=\"markdownIt-Anchor\" href=\"#flutter开发中使用wifi真机调试\">#</a> Flutter 开发中使用 WIFI 真机调试</h1>\n<h4 id=\"使用vscode开发flutter用wifi-或者-手机热点进行-无线调试过程\"><a class=\"markdownIt-Anchor\" href=\"#使用vscode开发flutter用wifi-或者-手机热点进行-无线调试过程\">#</a> 使用 vscode 开发 flutter，用 wifi 或者 手机热点进行 无线调试过程</h4>\n<h4 id=\"1手机连接wifi后在设置中找到ip和端口\"><a class=\"markdownIt-Anchor\" href=\"#1手机连接wifi后在设置中找到ip和端口\">#</a> 1. 手机连接 wifi 后在设置中找到 ip 和端口</h4>\n<h4 id=\"2在vscode终端输入-adb-connect-手机ip手机端口\"><a class=\"markdownIt-Anchor\" href=\"#2在vscode终端输入-adb-connect-手机ip手机端口\">#</a> 2. 在 vscode 终端输入 adb connect 手机 IP: 手机端口</h4>\n<h4 id=\"3作者在csdn这个烂环境中没找到有用的信息全是粘贴的所以希望这篇文章帮助到你你可以把我的地址列出来粘贴可以抄袭可耻\"><a class=\"markdownIt-Anchor\" href=\"#3作者在csdn这个烂环境中没找到有用的信息全是粘贴的所以希望这篇文章帮助到你你可以把我的地址列出来粘贴可以抄袭可耻\">#</a> 3. 作者在 CSDN 这个烂环境中没找到有用的信息，全是粘贴的，所以希望这篇文章帮助到你，你可以把我的地址列出来，粘贴可以，抄袭可耻！</h4>\n<h4 id=\"4完成以上步骤手机端应有开启无线调试的提示记得提前打开开发者模式\"><a class=\"markdownIt-Anchor\" href=\"#4完成以上步骤手机端应有开启无线调试的提示记得提前打开开发者模式\">#</a> 4. 完成以上步骤，手机端应有开启无线调试的提示，记得提前打开开发者模式。</h4>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Flutter_GetX%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/Flutter_GetX%E6%96%87%E6%A1%A3/",
            "title": "Flutter GETX框架",
            "date_published": "2022-12-27T08:18:48.559Z",
            "content_html": "<p>​\t\tGetX 是 Flutter 上的一个轻量且强大的解决方案：高性能的状态管理、智能的依赖注入和便捷的路由管理。</p>\n<p>​\t\t与其说是一个状态管理库，倒不如是是一个简化 Flutter 开发的百宝箱。它提供了很多工具来简化我们的开发，本篇我们先对 GetX 有一个大概的认识，然后接下来的篇章再将 GetX 的具体应用。</p>\n<h2 id=\"getx-工具介绍\"><a class=\"markdownIt-Anchor\" href=\"#getx-工具介绍\">#</a> <strong>GetX 工具介绍</strong></h2>\n<p>官方文档给出关于 GetX 的介绍如下：</p>\n<blockquote>\n<p>GetX is an extra-light and powerful solution for Flutter. It combines high-performance state management, intelligent dependency injection, and route management quickly and practically. GetX 是一个超轻量且强大的 Flutter 应用解决方案。它组合了高性能的状态管理、智能的依赖注入以及快速可用的路由管理。</p>\n</blockquote>\n<p>而实际上，GetX 还有更多的小工具，示例如下：</p>\n<h4 id=\"状态管理\"><a class=\"markdownIt-Anchor\" href=\"#状态管理\">#</a> 状态管理</h4>\n<ul>\n<li>Obx 是配合 Rx 响应式变量使用、GetBuilder 是配合 update 使用：请注意，这完全是俩套定点刷新控件的方案。<br>\n区别：前者响应式变量变化，Obx 自动刷新；后者需要使用 update 手动调用刷新</li>\n<li>每一个响应式变量，都需要生成对应的 GetStream，占用资源大于基本数据类型，会对内存造成一定压力</li>\n<li>GetBuilder 内部实际上是对 StatefulWidget 的封装，所以占用资源极小（推荐使用）</li>\n</ul>\n<h4 id=\"控制器的注入\"><a class=\"markdownIt-Anchor\" href=\"#控制器的注入\">#</a> 控制器的注入</h4>\n<ul>\n<li>静态路由绑定</li>\n</ul>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">AsWorkStatisticsBinding</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Bindings</span> &#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"built_in\">void</span> <span class=\"title function_\">dependencies</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Get</span>.<span class=\"property\">lazyPut</span>&lt;<span class=\"title class_\">AsWorkStatisticsController</span>&gt;(<span class=\"function\">() =&gt;</span> <span class=\"title class_\">AsWorkStatisticsController</span>());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">static</span> final <span class=\"title class_\">List</span>&lt;<span class=\"title class_\">GetPage</span>&gt; routes = [</span><br><span class=\"line\">    <span class=\"title class_\">GetPage</span>(</span><br><span class=\"line\">      <span class=\"attr\">name</span>: workStatisticsPage,</span><br><span class=\"line\">      <span class=\"attr\">page</span>: <span class=\"function\">() =&gt;</span> <span class=\"keyword\">const</span> <span class=\"title class_\">AsWorkStatisticsPage</span>(),</span><br><span class=\"line\">      <span class=\"attr\">binding</span>: <span class=\"title class_\">AsWorkStatisticsBinding</span>(),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"title class_\">Get</span>.<span class=\"title function_\">toNamed</span>(<span class=\"title class_\">ASRouteConfig</span>.<span class=\"property\">workPlanDetailPage</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>动态路由绑定</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get<span class=\"selector-class\">.to</span>(AsWorkStatisticsPage(),binding: <span class=\"built_in\">AsWorkStatisticsBinding</span>());</span><br></pre></td></tr></table></figure>\n<ul>\n<li>页面注入</li>\n</ul>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Get</span>.<span class=\"property\">lazyPut</span>&lt;<span class=\"title class_\">AsWorkStatisticsController</span>&gt;(<span class=\"function\">() =&gt;</span> <span class=\"title class_\">AsWorkStatisticsController</span>());</span><br></pre></td></tr></table></figure>\n<h4 id=\"动态简单路由和静态命名路由\"><a class=\"markdownIt-Anchor\" href=\"#动态简单路由和静态命名路由\">#</a> 动态 / 简单路由和静态 / 命名路由</h4>\n<p>请注意命名路由，只需要在 api 结尾加上 Named 即可，举例：</p>\n<ul>\n<li>默认：<span class=\"exturl\" data-url=\"aHR0cDovL0dldC50bw==\">Get.to</span>(SomePage());</li>\n<li>命名路由：Get.toNamed (“/somePage”);</li>\n<li>导航到新的页面</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.to(NextScreen());</span><br><span class=\"line\">Get.toNamed(<span class=\"string\">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>关闭 SnackBars、Dialogs、BottomSheets 或任何你通常会用 Navigator.pop (context) 关闭的东西</li>\n</ul>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get<span class=\"selector-class\">.back</span>();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>进入下一个页面，但没有返回上一个页面的选项（用于 SplashScreens，登录页面等）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.off(NextScreen());</span><br><span class=\"line\">Get.offNamed(<span class=\"string\">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>进入下一个界面并取消之前的所有路由（在购物车、投票和测试中很有用）</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.offAll(NextScreen());</span><br><span class=\"line\">Get.offAllNamed(<span class=\"string\">&quot;/NextScreen&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>发送数据到其它页面</li>\n</ul>\n<p>只要发送你想要的参数即可。Get 在这里接受任何东西，无论是一个字符串，一个 Map，一个 List，甚至一个类的实例。</p>\n<figure class=\"highlight tsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Get</span>.<span class=\"title function_\">to</span>(<span class=\"title class_\">NextScreen</span>(), <span class=\"attr\">arguments</span>: <span class=\"string\">&#x27;Get is the best&#x27;</span>);</span><br><span class=\"line\"><span class=\"title class_\">Get</span>.<span class=\"title function_\">toNamed</span>(<span class=\"string\">&quot;/NextScreen&quot;</span>, <span class=\"attr\">arguments</span>: <span class=\"string\">&#x27;Get is the best&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>在你的类或控制器上。</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(Get.arguments);</span><br><span class=\"line\"><span class=\"comment\">//print out: Get is the best</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>要导航到下一条路由，并在返回后立即接收或更新数据</li>\n</ul>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"keyword\">await</span> Get.to(Payment());</span><br><span class=\"line\"><span class=\"keyword\">var</span> data = <span class=\"keyword\">await</span> Get.toNamed(<span class=\"string\">&quot;/payment&quot;</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>在另一个页面上，发送前一个路由的数据</li>\n</ul>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.back(result: <span class=\"string\">&#x27;success&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">// 并使用它，例：</span></span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">data</span> == <span class=\"string\">&#x27;success&#x27;</span>) madeAnything();</span><br></pre></td></tr></table></figure>\n<ul>\n<li>跳转重复页面，可以这样写</li>\n</ul>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.to(XxxxPage(), preventDuplicates: <span class=\"literal\">false</span>);</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\">Get.toNamed(<span class=\"string\">&#x27;xxx&#x27;</span>,  preventDuplicates: <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n<ul>\n<li>如果你不想使用 GetX 语法，只要把 Navigator（大写）改成 navigator（小写），你就可以拥有标准导航的所有功能，而不需要使用 context，例如：</li>\n</ul>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认的Flutter导航</span></span><br><span class=\"line\">Navigator.of(context).push(</span><br><span class=\"line\">  context,</span><br><span class=\"line\">  MaterialPageRoute(</span><br><span class=\"line\">    builder: (BuildContext context) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> HomePage();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ),</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用Flutter语法获得，而不需要context。</span></span><br><span class=\"line\">navigator.push(</span><br><span class=\"line\">  MaterialPageRoute(</span><br><span class=\"line\">    builder: (_) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> HomePage();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  ),</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// get语法</span></span><br><span class=\"line\">Get.to(HomePage());</span><br></pre></td></tr></table></figure>\n<h4 id=\"getview的使用\"><a class=\"markdownIt-Anchor\" href=\"#getview的使用\">#</a> GetView 的使用</h4>\n<p>GetView 只是对已注册的 Controller 有一个名为 controller 的 getter 的 const Stateless 的 Widget，如果我们只有单个控制器作为依赖项，那我们就可以使用 GetView，而不是使用 StatelessWidget，并且避免了写 Get.Find ()。</p>\n<p>GetView 的使用方法非常简单，只是要将你的视图层继承自 GetView 并传入需要注册的控制器并 Get.put () 即可：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">GetViewAndGetWidgetExample</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">GetView</span>&lt;GetViewCountController&gt; &#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget <span class=\"title function_\">build</span><span class=\"params\">(BuildContext context)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    Get.put(GetViewCountController());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Container();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由\"><a class=\"markdownIt-Anchor\" href=\"#路由\">#</a> <strong>路由</strong></h3>\n<p>路由支持命名路由和匿名路由：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.to(() =&gt; Home());</span><br><span class=\"line\">Get.toNamed(&#x27;/home&#x27;);</span><br><span class=\"line\">// 返回上一个页面</span><br><span class=\"line\">Get.back();</span><br><span class=\"line\">// 使用下一个页面替换</span><br><span class=\"line\">Get.off(NextScreen());</span><br><span class=\"line\">// 清空导航堆栈全部页面</span><br><span class=\"line\">Get.offAll(NextScreen());</span><br><span class=\"line\">// 获取命名路由参数</span><br><span class=\"line\">print(Get.parameters[&#x27;id&#x27;]);</span><br><span class=\"line\">print(Get.parameters[&#x27;name&#x27;]);</span><br></pre></td></tr></table></figure>\n<p>GetX 的路由好处是不依赖于  <code>context</code> ，十分简洁，更多路由介绍可以参考：<strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9naXRodWIuY29tL2pvbmF0YXNsYXcvZ2V0eC9ibG9iL21hc3Rlci9kb2N1bWVudGF0aW9uL2VuX1VTL3JvdXRlX21hbmFnZW1lbnQubWQ=\">GetX 路由介绍官方文档</span></strong>。</p>\n<h2 id=\"snackbar\"><a class=\"markdownIt-Anchor\" href=\"#snackbar\">#</a> <strong>SnackBar</strong></h2>\n<p>Flutter 自身携带的 SnackBar 有很多限制，而 GetX 的非常简单，当然也有更多的样式配置和位置配置参数。</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.snackbar(&#x27;SnackBar&#x27;, &#x27;这是GetX的SnackBar&#x27;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"对话框\"><a class=\"markdownIt-Anchor\" href=\"#对话框\">#</a> <strong>对话框</strong></h2>\n<p>对话框也一样，默认的对话框开箱即用。</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.defaultDialog(</span><br><span class=\"line\">  title: &#x27;对话框&#x27;,</span><br><span class=\"line\">  content: Text(&#x27;对话框内容&#x27;),</span><br><span class=\"line\">  onConfirm: () &#123;</span><br><span class=\"line\">    print(&#x27;Confirm&#x27;);</span><br><span class=\"line\">    Get.back();</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  onCancel: () &#123;</span><br><span class=\"line\">    print(&#x27;Cancel&#x27;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<h2 id=\"内存缓存\"><a class=\"markdownIt-Anchor\" href=\"#内存缓存\">#</a> <strong>内存缓存</strong></h2>\n<p>GetX 可以缓存内容对象，以便在不同页面共享数据。使用的时候需要注意，需要先  <code>put</code>  操作再  <code>find</code>  操作，否则会抛异常。</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.put(CacheData(name: &#x27;这是缓存数据&#x27;));</span><br><span class=\"line\">CacheData cache = Get.find();</span><br></pre></td></tr></table></figure>\n<h2 id=\"离线存储\"><a class=\"markdownIt-Anchor\" href=\"#离线存储\">#</a> <strong>离线存储</strong></h2>\n<p>GetX 提供了一个 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9wdWIuZmx1dHRlci1pby5jbi9wYWNrYWdlcy9nZXRfc3RvcmFnZQ==\">get_storage</span></strong> 插件用于离线存储，与  <code>shared_preferences</code>  相比，其优点是纯 Dart 编写，不依赖于原生，因此可以在安卓、iOS、Web、Linux、Mac 等多个平台使用。 <code>GetStorage</code>  是基于内存和文件存储的，当内存容器中有数据时优先从内存读取。同时在构建 GetStorage 对象到时候指定存储的文件名以及存储数据的容器。</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GetStorage storage = GetStorage();</span><br><span class=\"line\">storage.write(&#x27;name&#x27;, &#x27;岛上码农&#x27;);</span><br><span class=\"line\">storage.read(&#x27;name&#x27;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"更改主题\"><a class=\"markdownIt-Anchor\" href=\"#更改主题\">#</a> <strong>更改主题</strong></h2>\n<p>可以说是一行代码搞定深色和浅色模式，也可以更改为自定义主题 —— <strong>老板让你根据手机壳改主体颜色的需求</strong>已经搞定了一大半了！</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Get.changeTheme(</span><br><span class=\"line\">  Get.isDarkMode ? ThemeData.light() : ThemeData.dark());</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://brath.cloud/blogImg/v2-196c01dbae06a8e68132fcd94e3983a6_b.jpg\" alt=\"img\"></p>\n<h2 id=\"多语言支持\"><a class=\"markdownIt-Anchor\" href=\"#多语言支持\">#</a> <strong>多语言支持</strong></h2>\n<p>多语言支持使用数据字典完成，在  <code>GetMaterialApp</code>  指定字典对象（继承自  <code>Translations</code> ），使用字符串的时候假设 <code>.tr</code>  后缀，就可以在切换语言的时候自动切换字符串对应语言的翻译了。</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class GetXDemo extends StatelessWidget &#123;</span><br><span class=\"line\">  // 省略其他代码</span><br><span class=\"line\">  TextButton(</span><br><span class=\"line\">    onPressed: () &#123;</span><br><span class=\"line\">      var locale = Locale(&#x27;en&#x27;, &#x27;US&#x27;);</span><br><span class=\"line\">      Get.updateLocale(locale);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    child: Text(&#x27;name&#x27;.tr),</span><br><span class=\"line\">  ),</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class Messages extends Translations &#123;</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Map&lt;String, Map&lt;String, String&gt;&gt; get keys =&gt; &#123;</span><br><span class=\"line\">        &#x27;en_US&#x27;: &#123;</span><br><span class=\"line\">          &#x27;name&#x27;: &#x27;Island Coder&#x27;,</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &#x27;zh_CN&#x27;: &#123;</span><br><span class=\"line\">          &#x27;name&#x27;: &#x27;岛上码农&#x27;,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">class MyApp extends StatelessWidget &#123;</span><br><span class=\"line\">  // This widget is the root of your application.</span><br><span class=\"line\">  @override</span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    return GetMaterialApp(</span><br><span class=\"line\">      translations: Messages(),</span><br><span class=\"line\">      locale: Locale(&#x27;zh&#x27;, &#x27;CN&#x27;),</span><br><span class=\"line\">      color: Colors.white,</span><br><span class=\"line\">      navigatorKey: Get.key,</span><br><span class=\"line\">      title: &#x27;Flutter Demo&#x27;,</span><br><span class=\"line\">      theme: ThemeData(</span><br><span class=\"line\">        primarySwatch: Colors.blue,</span><br><span class=\"line\">        brightness: Brightness.light,</span><br><span class=\"line\">      ),</span><br><span class=\"line\">      home: GetXDemo(),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"getx-的理念\"><a class=\"markdownIt-Anchor\" href=\"#getx-的理念\">#</a> <strong>GetX 的理念</strong></h2>\n<p>GetX 有三个基本的理念，分别是性能、生产力和组织性（Organization）。</p>\n<ul>\n<li>性能（Performance）：GetX 关注性能并最小化资源消耗。GetX 不使用  <code>Stream</code>  或  <code>ChangeNotifier</code> 。</li>\n<li>生产力（Productivity）：GetX 使用简洁愉悦的语法。不管你要做什么，使用 GetX 都会觉得简便。这使得开发的时间大大节省，并且保证应用性能的最大化。通常来说，开发者需要关注从内存中移除控制器。而使用 GetX 的时候，则无需这么做。当控制器不被使用的时候，资源会自动从内存中释放。如果确实需要常住内存，那就需要在依赖中声明  <code>permanent:true</code> 。通过这种方式，可以降低内存中有过多不必要依赖对象的风险。同时，依赖默认也是懒加载。</li>\n<li>组织性（Organization）：GetX 可以将视图、展示逻辑、业务逻辑、依赖注入和导航完全解耦。路由之间跳转无需  <code>context</code> ，因此我们的导航不会依赖组件树。也不需要使用通过  <code>InheritedWidget</code>  的  <code>context</code>  访问控制器或 BLOC 对象，因此可以将展示逻辑和业务逻辑从虚拟的组件层分离。我们也不需要像 MultiProvider 那样往组件树中注入 Controller/Model/Bloc 等类对象。因此可以将依赖注入和视图分离。</li>\n</ul>\n<h2 id=\"getx-生态\"><a class=\"markdownIt-Anchor\" href=\"#getx-生态\">#</a> <strong>GetX 生态</strong></h2>\n<p>GetX 有很多特性，使得编码变得容易。每个特性之间是相互独立的，并且只会在使用的时候才启动。例如，如果仅仅是使用状态管理，那么只有状态管理会被编译。而如果只使用路由，那么状态管理的部分就不会编译。</p>\n<p>GetX 有一个很大的生态，包括了大型的社区维护，大量的协作者（GitHub 上看有 132 位），并且承诺只要 Flutter 存在就会继续维护下去。而且 GetX 兼容 Android, iOS, Web, Mac, Linux, Windows 多个平台。GetX 甚至还有服务端版本 <strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9naXRodWIuY29tL2pvbmF0YXNsYXcvZ2V0X3NlcnZlcg==\">Get_Server</span></strong>（感觉 Flutter 要一统程序员界啊，啥时候支持鸿蒙？）。</p>\n<p>为了简化开发，GetX 还提供了脚手架工具 **<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9wdWIuZmx1dHRlci1pby5jbi9wYWNrYWdlcy9nZXRfY2xp\">GET_CLI</span>** 和 VSCode 插件 <code>GetX Snippets</code> （也有 Android Studio 和 Intellij 插件）。提供了如下快速代码模板：</p>\n<ul>\n<li>\n<p>getmain：GetX 的 main.dart 代码；</p>\n</li>\n<li>\n<p>getmodel：Model 类代码，包括了 fromJson 和 toJson 方法</p>\n</li>\n<li>\n<p>其他，输入 getxxxx 根据提示生成即可，具体参考：<strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLnpoaWh1LmNvbS8/dGFyZ2V0PWh0dHBzJTNBLy9tYXJrZXRwbGFjZS52aXN1YWxzdHVkaW8uY29tL2l0ZW1zJTNGaXRlbU5hbWUlM0RnZXQtc25pcHBldHMuZ2V0LXNuaXBwZXRz\">GetX Snippets 介绍</span></strong>。</p>\n</li>\n</ul>\n<h2 id=\"总结\"><a class=\"markdownIt-Anchor\" href=\"#总结\">#</a> <strong>总结</strong></h2>\n<p>本篇对 GetX 插件做了简单的介绍，可以看到 GetX 的生态确实很丰富，感觉是一个集大成者，GetX 基本上涵盖了 Flutter 应用开发的很大一部分，如路由、主题、多语言、弹层、状态管理、依赖注入、网络请求封装等等。GetX 看着像一个框架， 但实际上它的各个模块是独立的，其实是一个工具箱。对于开发的时候，可以用它的全家桶，也可以从中任取所需的模块到我们的应用中使用。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Flutter%20%E6%B5%81%E7%95%85%E5%BA%A6%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6%20Keframe/",
            "url": "http://example.com/2022/12/27/Flutter%20%E6%B5%81%E7%95%85%E5%BA%A6%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6%20Keframe/",
            "title": "Flutter 流畅度优化组件 Keframe",
            "date_published": "2022-12-27T08:18:48.558Z",
            "content_html": "<p>最近在开发一款 APP，核心场景类似于帖子这类的，所以下拉加载页面的流畅度成为最棘手的问题，在掘金上看见了这篇文章： <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTc5NzgxOTk3NTY4ODg0NzY2\">https://juejin.cn/post/6979781997568884766</span></p>\n<p>Nayuta 的 Keframe 组件正好可以满足帧率优化的问题</p>\n<h3 id=\"项目依赖\"><a class=\"markdownIt-Anchor\" href=\"#项目依赖\">#</a> 项目依赖：</h3>\n<p>在  <code>pubspec.yaml</code>  中添加  <code>keframe</code>  依赖</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">keframe:</span> <span class=\"string\">version</span></span><br></pre></td></tr></table></figure>\n<p>组件仅区分非空安全与空安全版本</p>\n<p>非空安全使用：  <code>1.0.2</code></p>\n<p>空安全版本使用：  <code>2.0.2</code></p>\n<p>github 地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZnaXRodWIuY29tJTJGTGlhbmppYVRlY2glMkZrZWZyYW1l\">github.com/LianjiaTech…</span></p>\n<p>pub 查看：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZwdWIuZGV2JTJGcGFja2FnZXMlMkZrZWZyYW1l\">pub.dev/packages/ke…</span></p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#SizeCacheWidget用来包裹最外层的list</span><br><span class=\"line\">#FrameSeparateWidget用来包裹list的子集即可    </span><br><span class=\"line\">example:</span><br><span class=\"line\">SizeCacheWidget(</span><br><span class=\"line\">\tchild：ListView || CustomScrollView(</span><br><span class=\"line\">    \tslivers[</span><br><span class=\"line\">            SliverList(</span><br><span class=\"line\">            \tdelegate: SliverChildBuilderDelegate</span><br><span class=\"line\">                (BuildContext context, <span class=\"built_in\">int</span> index)&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> FrameSeparateWidget(</span><br><span class=\"line\">                    \tchild: ···</span><br><span class=\"line\">                    )</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            )</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    )</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h3 id=\"快速上手\"><a class=\"markdownIt-Anchor\" href=\"#快速上手\">#</a> 快速上手：</h3>\n<p>如下图所示</p>\n<p><img data-src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83d16f3b2a3e45b79fc73d7a52774696~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>假如现在页面由 A、B、C、D 四部分组成，每部分耗时 10ms，在页面时构建为 40ms。使用分帧组件   <code>FrameSeparateWidget</code>  嵌套每一个部分。页面构建时会在第一帧渲染简单的占位，在后续四帧内分别渲染 A、B、C、D。</p>\n<p>对于列表，在每一个 item 中嵌套  <code>FrameSeparateWidget</code> ，并将  <code>ListView</code>  嵌套在  <code>SizeCacheWidget</code>  内即可。</p>\n<p><img data-src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ffecd49bf9ba4379984a22ef79663104~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"image.png\"></p>\n<hr>\n<h2 id=\"构造函数说明\"><a class=\"markdownIt-Anchor\" href=\"#构造函数说明\">#</a> 构造函数说明</h2>\n<p>FrameSeparateWidget ：分帧组件，将嵌套的 widget 单独一帧渲染</p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>参数名</th>\n<th>是否必填</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Key</td>\n<td>key</td>\n<td>否</td>\n<td></td>\n</tr>\n<tr>\n<td>int</td>\n<td>index</td>\n<td>否</td>\n<td>分帧组件 id，<strong>使用 SizeCacheWidget 的场景必传</strong>，SizeCacheWidget 中维护了 index 对应的 Size 信息</td>\n</tr>\n<tr>\n<td>Widget</td>\n<td>child</td>\n<td>是</td>\n<td>实际需要渲染的 widget</td>\n</tr>\n<tr>\n<td>Widget</td>\n<td>placeHolder</td>\n<td>否</td>\n<td>占位 widget，尽量设置简单的占位，不传默认是 Container ()</td>\n</tr>\n</tbody>\n</table>\n<p>SizeCacheWidget：缓存子节点中，分帧组件嵌套的<strong>实际 widget 的尺寸信息</strong></p>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>参数名</th>\n<th>是否必填</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Key</td>\n<td>key</td>\n<td>否</td>\n<td></td>\n</tr>\n<tr>\n<td>Widget</td>\n<td>child</td>\n<td>是</td>\n<td>子节点中如果包含分帧组件，则缓存<strong>实际的 widget 尺寸</strong></td>\n</tr>\n<tr>\n<td>int</td>\n<td>estimateCount</td>\n<td>否</td>\n<td>预估屏幕上子节点的数量，提高快速滚动时的响应速度</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"方案设计与分析\"><a class=\"markdownIt-Anchor\" href=\"#方案设计与分析\">#</a> 方案设计与分析：</h2>\n<p>卡顿的本质，就是 <strong>单帧的绘制时间过长</strong>。基于此自然衍生出两种思路解决：</p>\n<p>1、减少一帧的绘制耗时，因为导致耗时过长的原因有很多，比如不合理的刷新，或者绘制时间过长，都有可能，需要具体问题具体分析，后面我会分享一些我的优化经验。</p>\n<p><strong>2、在不对耗时优化下，将一帧的任务拆分到多帧内，保证每一帧都不超时。这也是本组件的设计思路，分帧渲染。</strong></p>\n<p>如下图所示:</p>\n<p><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb09c9aadc5d45c9b966661c8d73e4c1~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>原理并不复杂，问题在于如何在 Flutter 中实践这一机制。</p>\n<p>因为涉及到帧与系统的调度，自然联想到看  <code>SchedulerBinding</code>  中有无现成的 API。</p>\n<p>发现了  <code>scheduleTask</code>  方法，这是系统提供的一个执行任务的方法，但这个方法存在两个问题：</p>\n<ul>\n<li>1、其中的渲染任务是优先级进行堆排序，而堆排序是<strong>不稳定</strong>排序，这会导致任务的执行顺序并非 FIFO。从效果上来看，就是列表不会按照顺序渲染，而是会出现跳动渲染的情况</li>\n<li>2、这个方法本身存在调度问题，我已经提交 issue 与 pr，不过一直卡在单元测试上，如果感兴趣可以以在这里交流谈论。</li>\n</ul>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZnaXRodWIuY29tJTJGZmx1dHRlciUyRmZsdXR0ZXIlMkZwdWxsJTJGODI3ODE=\">fix: Tasks scheduled through ‘SchedulerBinding.instance.scheduleTask’… #82781 </span></p>\n<p>最终，参考这个设计结合  <code>endOfFrame</code>  方法的使用，完成了分帧队列。整个渲染流程变为下图所示：</p>\n<p><img data-src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb9d177b4b0847339eaf952a7ef67cca~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>对于列表构建场景来说，假设屏幕上能显示五个 item。首先在第一帧的时候，列表会渲染 5 个占位的 Widget，同时添加 5 个高优先级任务到队列中，这里的任务可以是简单的将占位 Widget 和实际 item 进行替换，也可通过渐变等动画提升体验。在后续的五帧中占位 Widget 依次被替换成实际的列表 item。</p>\n<p>在  <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTQwMTM0ODkxNjA2NTA3NTM0\">ListView 流畅度翻倍！！Flutter 卡顿分析和通用优化方案</span>  这篇文章中有更加详细的分析。</p>\n<h2 id=\"一些展示效果example-说明请查看-github\"><a class=\"markdownIt-Anchor\" href=\"#一些展示效果example-说明请查看-github\">#</a> 一些展示效果（Example 说明请查看 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9saW5rLmp1ZWppbi5jbj90YXJnZXQ9aHR0cHMlM0ElMkYlMkZnaXRodWIuY29tJTJGTGlhbmppYVRlY2glMkZrZWZyYW1lJTJGYmxvYiUyRm1hc3RlciUyRlJFQURNRS1aSC5tZA==\">Github</span>）</h2>\n<p>卡顿的页面往往都是由多个复杂 widget 同时渲染导致。通过为复杂的 widget 嵌套分帧组件  <code>FrameSeparateWidget</code> 。渲染时，分帧组件会在第一帧同时渲染多个  <code>palceHolder</code> ，之后连续的多帧内依次渲染复杂子项，以此提升页面流畅度。</p>\n<p>例如 example 中的优化前示例：</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ListView.builder(</span><br><span class=\"line\">              itemCount: childCount,</span><br><span class=\"line\">              itemBuilder: (c, i) =&gt; CellWidget(</span><br><span class=\"line\">                color: i % <span class=\"number\">2</span> == <span class=\"number\">0</span> ? Colors.red : Colors.blue,</span><br><span class=\"line\">                index: i,</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            )</span><br><span class=\"line\">复制代码</span><br></pre></td></tr></table></figure>\n<p>其中  <code>CellWidget</code>  高度为 60，内部嵌套了三个  <code>TextField</code>  的组件（整体构建耗时在 9ms 左右）。</p>\n<p>优化仅需为每一个 item 嵌套分帧组件，并为其设置  <code>placeHolder</code> （placeHolder 尽量简单，样式与实际 item 接近即可）。</p>\n<p>在列表情况下，给 ListView 嵌套  <code>SizeCacheWidget</code> ，同时建议将预加载范围  <code>cacheExtent</code>  设置大一点，例如 500（该属性默认为 250），提升慢速滑动时候的体验。</p>\n<p><img data-src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f33ddd7d9de4e369b0e457f84171cc8~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"Screenrecording_20210611_194905.gif\"> (占位与实际列表项不一致时，首次渲染抖动，二次渲染正常)</p>\n<p>此外，也可以给 item 嵌套透明度 / 位移等动画，优化视觉上的效果。</p>\n<p>效果如下图：</p>\n<table>\n<thead>\n<tr>\n<th><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb7d1361ae7842df954bb1c559e2ec54~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"Screenrecording_20210315_133310.gif\"></th>\n<th><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ee6827f7eed4463a1a8a5b00a58fd6e~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"Screenrecording_20210315_133848.gif\"></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"分帧的成本\"><a class=\"markdownIt-Anchor\" href=\"#分帧的成本\">#</a> 分帧的成本</h2>\n<p>当然分帧方案也非十全十美，在我看来主要有两点成本：</p>\n<p>1、额外的构建开销：整个构建过程的构建消耗由「n * widget 消耗 」变成了「n *（ widget + 占位）消耗 + 系统调度 n 帧消耗」。可以看出，额外的开销主要由占位的复杂度决定。如果占位只是简单的 Container，测试后发现整体构建耗时大概提升在 15 % 左右。这种额外开销对于当下的移动设备而言，成本几乎可以不计。</p>\n<p>2、视觉上的变化：如同上面的演示，组件会将 item 分帧渲染，页面在视觉上出现占位变成实际 widget 的过程。但其实由于列表存在缓存区域（建议将缓存区调大），在高端机或正常滑动情况下用户并无感知。而在中低端设备上快速滑动能感觉到切换的过程，但比严重顿挫要好。</p>\n<hr>\n<h2 id=\"优化前后对比演示\"><a class=\"markdownIt-Anchor\" href=\"#优化前后对比演示\">#</a> 优化前后对比演示</h2>\n<p>注：gif 帧率只有 20</p>\n<table>\n<thead>\n<tr>\n<th>优化前</th>\n<th>优化后</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2f20f593cc144b72a1df4bdae57a165c~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"优化前\"></td>\n<td><img data-src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05aea6de421545b9bbf868c344a9afe9~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"优化后\"></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"最后一点点思考\"><a class=\"markdownIt-Anchor\" href=\"#最后一点点思考\">#</a> 最后：一点点思考</h2>\n<p>列表优化篇到此告一段落，在整个开源实践过程中，有两点感触较深：</p>\n<p>作者：Nayuta<br>\n 链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82OTc5NzgxOTk3NTY4ODg0NzY2\">https://juejin.cn/post/6979781997568884766</span></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Elasticsearch7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6/",
            "url": "http://example.com/2022/12/27/Elasticsearch7%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6/",
            "title": "ELASTICSEARCH7.X安全性之访问密码设置",
            "date_published": "2022-12-27T08:18:48.556Z",
            "content_html": "<h2 id=\"elasticsearch7x安全性之访问密码设置\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearch7x安全性之访问密码设置\">#</a> ELASTICSEARCH7.X 安全性之访问密码设置</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当我们安装完ElasticSearch的时候发现，访问过程中我们没有任何安全认证就可以直接访问并操作。如果是生产环境，端口向外暴露的话，那么对数据的安全性是无法得到保障的。</span><br></pre></td></tr></table></figure>\n<p>一般解决方案有</p>\n<ul>\n<li>开启 ElasticSearch 认证插件，访问的时候添加账密不就好了</li>\n<li>当然也可以通过 nginx 作代理防护</li>\n</ul>\n<p>本文主要讲解通过启用 X-Pack 来设置 ElasticSearch 的访问密码。</p>\n<p>集群与单据环境都适合次方法</p>\n<ul>\n<li>集群与单据环境配置的区别就是，集群需要在某一台生成证书然后拷贝到其它节点目录下。</li>\n<li>集群环境重设置密码的时候需要整个集群节点都已启动，可在任一台处修改。</li>\n</ul>\n<h2 id=\"2x-pack简介\"><a class=\"markdownIt-Anchor\" href=\"#2x-pack简介\">#</a> 2.X-PACK 简介</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">X-Pack是Elastic Stack扩展功能，提供安全性，警报，监视，报告，机器学习和许多其他功能。 ES7.0+之后，默认情况下，当安装Elasticsearch时，会自动安装X-Pack，无需单独再安装。自6.8以及7.1+版本之后，基础级安全永久免费了。</span><br><span class=\"line\">在使用的时候主要需要配置一下证书，以及修改配置文件（config/elasticsearch.yml ）</span><br></pre></td></tr></table></figure>\n<h2 id=\"3证书配置\"><a class=\"markdownIt-Anchor\" href=\"#3证书配置\">#</a> 3. 证书配置</h2>\n<h3 id=\"31生成节点证书\"><a class=\"markdownIt-Anchor\" href=\"#31生成节点证书\">#</a> 3.1 生成节点证书</h3>\n<p>切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin<br>\n 借助 elasticsearch-certutil 命令生成证书：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./elasticsearch-certutil ca -out config/certs/elastic-certificates.p12 -pass</span><br></pre></td></tr></table></figure>\n<p>这里单独设置了一个 证书文件目录 config/certs<br>\n<img data-src=\"https://www.freesion.com/images/951/a3d0c1934c0ed0f8440f830d63e96dbf.png\" alt=\"在这里插入图片描述\"></p>\n<p>生成后的证书<br>\n<img data-src=\"https://www.freesion.com/images/953/de92ac2cf73d1ed0da994f9d1066e8f1.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"32修改配置\"><a class=\"markdownIt-Anchor\" href=\"#32修改配置\">#</a> 3.2 修改配置</h3>\n<p>配置通信证书 &gt; 需要在 config 目前下 elasticsearch.yml 配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 开启xpack</span><br><span class=\"line\">xpack.security.enabled: true</span><br><span class=\"line\">xpack.license.self_generated.type: basic</span><br><span class=\"line\">xpack.security.transport.ssl.enabled: true</span><br><span class=\"line\"># 证书配置</span><br><span class=\"line\">xpack.security.transport.ssl.verification_mode: certificate</span><br><span class=\"line\">xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12</span><br><span class=\"line\">xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>其它配置（可选）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#跨域配置</span><br><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>\n<p>注：若是集群环境则需要将证书文件目录，以及配置文件，在所有集群环境下都修改一下。</p>\n<h3 id=\"33重启生效\"><a class=\"markdownIt-Anchor\" href=\"#33重启生效\">#</a> 3.3. 重启生效</h3>\n<p>需要重启 elasticsearch</p>\n<p>注：若是集群环境下则需要启动所有集群节点，再统一设置密码</p>\n<p>注：重启异常情况，若出现报错，类似 failed to load plugin class [org.elasticsearch.xpack.core.XPackPlugin]<br>\n 请检查是否是使用 root 用户生成的证书，启动用户无权限导致。</p>\n<h2 id=\"4设置用户密码\"><a class=\"markdownIt-Anchor\" href=\"#4设置用户密码\">#</a> 4. 设置用户密码</h2>\n<p>执行设置用户名和密码的命令，内置了部分用户<br>\n切换到 elasticsearch 安装文件目录 bin 下 ：示例：/usr/local/elasticsearch-7.4.0/bin/</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 手动配置每个用户密码模式（需要一个一个的输入）</span><br><span class=\"line\">./elasticsearch-setup-passwords interactive</span><br></pre></td></tr></table></figure>\n<p>也可以先自动配置密码后续再修改</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#自动配置每个用户密码（随机生成并返回字符串密码,需要保存好）</span><br><span class=\"line\">./elasticsearch-setup-passwords auto  </span><br></pre></td></tr></table></figure>\n<p>下图 1 是自动生成密码情况（一定拷贝下来要牢记密码）<br>\n<img data-src=\"https://www.freesion.com/images/198/f383d0d38bab2a11f3293d44ffccf0ae.png\" alt=\"在这里插入图片描述\"></p>\n<p>下图 2 是自定义密码情况<br>\n分别为多个用户设置密码例如：elastic, kibana, logstash_system,beats_system,<br>\n 设置密码的时候需要连续输入 2 遍。<br>\n<img data-src=\"https://www.freesion.com/images/458/363890f3fdffcc0b1bcfaae3c8295952.png\" alt=\"在这里插入图片描述\"></p>\n<p>部分内置账号的角色权限解释如下：</p>\n<ul>\n<li>elastic 账号：拥有 superuser 角色，是内置的超级用户。</li>\n<li>kibana 账号：拥有 kibana_system 角色，用户 kibana 用来连接 elasticsearch 并与之通信。Kibana 服务器以该用户身份提交请求以访问集群监视 API 和 .kibana 索引。不能访问 index。</li>\n<li>logstash_system 账号：拥有 logstash_system 角色。用户 Logstash 在 Elasticsearch 中存储监控信息时使用。</li>\n</ul>\n<p>至此单节点安全配置完毕，重启 es 后访问 9200 会出现用户名和密码的提示窗口，我们就可以通过用户生成的密码过行访问了</p>\n<h2 id=\"5测试访问\"><a class=\"markdownIt-Anchor\" href=\"#5测试访问\">#</a> 5. 测试访问</h2>\n<p>通过查看证书方式，顺便测试一下密码是否生效了<br>\n浏览器输入 <span class=\"exturl\" data-url=\"aHR0cDovL2lwOjkyMDAvX2xpY2Vuc2U=\">http://IP:9200/_license</span> 可以看到，弹窗出来，需要输入密码了<br>\n<img data-src=\"https://www.freesion.com/images/561/b7034fa6ab245e277567b01d40929119.png\" alt=\"在这里插入图片描述\"><br>\n<img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/9b1a95e8a4b361dd4f7e3012300d1115.png\" alt=\"在这里插入图片描述\"></p>\n<h2 id=\"附录常见问题\"><a class=\"markdownIt-Anchor\" href=\"#附录常见问题\">#</a> 附录：常见问题</h2>\n<h3 id=\"1如何修改账号密码\"><a class=\"markdownIt-Anchor\" href=\"#1如何修改账号密码\">#</a> 1. 如何修改账号密码</h3>\n<p>以 elastic 账号为例，注意需要在 elasticsearch 服务已启动的情况下进行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H &#x27;Content-Type: application/json&#x27; -u elastic:123456 -XPUT &#x27;http://localhost:9200/_xpack/security/user/elastic/_password&#x27; -d &#x27;&#123; &quot;password&quot; : &quot;1234567&quot; &#125;&#x27;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2客户端es-head连接问题\"><a class=\"markdownIt-Anchor\" href=\"#2客户端es-head连接问题\">#</a> 2. 客户端 ES-HEAD 连接问题</h3>\n<p>连接失败情况下先检查是否是跨域问题</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http.cors.enabled: true</span><br><span class=\"line\">http.cors.allow-origin: &quot;*&quot;</span><br><span class=\"line\">http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</span><br></pre></td></tr></table></figure>\n<p>例如下图连接的时候报错未授权<br>\n<img data-src=\"https://www.freesion.com/images/96/57fa25b106cf1cdee9f44a2f8577e620.png\" alt=\"在这里插入图片描述\"></p>\n<p>解决方案：在访问的 URL 中拼接授权账号信息<br>\n示例：?auth_user=elastic&amp;auth_password=1234567</p>\n<p>示例：指定服务端地址以及账户</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://IP:9100/?base_uri=http://IP:9200&amp;auth_user=elastic&amp;auth_password=1234567</span><br></pre></td></tr></table></figure>\n<h3 id=\"3启动报xpack相关错\"><a class=\"markdownIt-Anchor\" href=\"#3启动报xpack相关错\">#</a> 3. 启动报 XPACK 相关错</h3>\n<p><img data-src=\"https://www.freesion.com/images/947/90ff281ef660a79e49875391f87e474b.png\" alt=\"在这里插入图片描述\"></p>\n<p>DecoderException: javax.net.ssl.SSLHandshakeException: No available authentication scheme<br>\n<img data-src=\"https://www.freesion.com/images/485/efd6d897ad8655121334fd050eecd445.png\" alt=\"在这里插入图片描述\"></p>\n<p>解决方案：请通过上文配置步骤，排查，检查证书是否已经配置好，以及配置是否填写正确</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Elasticsearch/",
            "url": "http://example.com/2022/12/27/Elasticsearch/",
            "title": "Elasticsearch学习",
            "date_published": "2022-12-27T08:18:48.554Z",
            "content_html": "<h1 id=\"elasticsearch\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearch\">#</a> Elasticsearch</h1>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/elasticsearch.jpg\" alt=\"img\"></p>\n<h2 id=\"目标\"><a class=\"markdownIt-Anchor\" href=\"#目标\">#</a> 目标</h2>\n<ul>\n<li>了解 ES 中的基本概念</li>\n<li>掌握 RESTFul 操作 ES 的 CRUD</li>\n<li>掌握 Spring Data Elasticsearch 操作 ES</li>\n</ul>\n<h2 id=\"简介\"><a class=\"markdownIt-Anchor\" href=\"#简介\">#</a> 简介</h2>\n<p>Elasticsearch 是一个基于 Lucene 的搜索服务器。它提供了一个分布式多用户能力的全文搜索引擎，基于 RESTful web 接口。Elasticsearch 是用 Java 开发的，并作为 Apache 许可条款下的开放源码发布，是当前流行的企业级搜索引擎。设计用于云计算中，能够达到实时搜索，稳定，可靠，快速，安装使用方便。</p>\n<p>我们建立一个网站或应用程序，并要添加搜索功能，但是想要完成搜索工作的创建是非常困难的。我们希望搜索解决方案要运行速度快，我们希望能有一个零配置和一个完全免费的搜索模式，我们希望能够简单地使用 JSON 通过 HTTP 来索引数据，我们希望我们的搜索服务器始终可用，我们希望能够从一台开始并扩展到数百台，我们要实时搜索，我们要简单的多用户，我们希望建立一个云的解决方案。因此我们利用 Elasticsearch 来解决所有这些问题及可能出现的更多其它问题。</p>\n<h2 id=\"安装和运行\"><a class=\"markdownIt-Anchor\" href=\"#安装和运行\">#</a> 安装和运行</h2>\n<p>该软件是基于 Java 编写的解压即用的软件，只需要有 Java 的运行环境即可，把压缩包解压后，进入到 bin 目录运行 elasticsearch.bat，出现以下界面，表示成功启动服务器</p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606092632.png\" alt=\"img\"></p>\n<p>浏览器输入：<strong>localhost:9200</strong>，看到浏览器输出服务器的信息，表示安装成功，可以使用了</p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606093141.png\" alt=\"img\"></p>\n<p>注意：程序启动后有两个端口 9200 和 9300，9200 端口用于 HTTP 协议，基于 RESTFul 来使用，9300 端口用于 TCP 协议，基于 jar 包来使用</p>\n<h3 id=\"后台启动\"><a class=\"markdownIt-Anchor\" href=\"#后台启动\">#</a> 后台启动</h3>\n<p>使用<strong>安装目录 /bin/elasticsearch-service.bat</strong> 程序可以把 Elasticsearch 安装后服务列表中，以后我们可以在服务列表来启动该程序，也可以设置成开机启动模式</p>\n<p>注意：设置后台启动需要手动配置 Java 虚拟机的路径，使用命令<strong> elasticsearch-service.bat manager</strong> 来配置</p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190622211819.png\" alt=\"img\"></p>\n<h3 id=\"安装head插件\"><a class=\"markdownIt-Anchor\" href=\"#安装head插件\">#</a> 安装 head 插件</h3>\n<p>Elasticsearch 默认的客户端工具是命令行形式的，操作起来不方便，也不直观看到数据的展示，所以我们需要去安装一个可视化插件，但是这些插件都是基于 H5 开发的，在谷歌的应用商店中找到<strong> elasticsearch-head</strong> 插件，然后安装，使用该插件能比较直观的展示服务器中的数据</p>\n<h3 id=\"安装kibana\"><a class=\"markdownIt-Anchor\" href=\"#安装kibana\">#</a> 安装 kibana</h3>\n<p>该软件也是解压即用的工具，用于管理和监控 Elasticsearch 的运作，同时内部包含了客户端工具，支持 RESTFul 操作 Elasticsearch。解压后运行 bin/kibana.bat，看到启动成功的端口号即可以使用浏览器来使用了</p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190606141235.png\" alt=\"img\"></p>\n<p>浏览器输入：<span class=\"exturl\" data-url=\"aHR0cDovL2xvY2FsaG9zdDo1NjAxLw==\">http://localhost:5601</span></p>\n<h2 id=\"概念名词\"><a class=\"markdownIt-Anchor\" href=\"#概念名词\">#</a> 概念名词</h2>\n<h3 id=\"数据存储图\"><a class=\"markdownIt-Anchor\" href=\"#数据存储图\">#</a> 数据存储图</h3>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604113843.png\" alt=\"img\"></p>\n<p>注意：从 Elasticsearch6 开始一个索引里面只能有一个类型，后续计划删除类型这个概念，从 ES6 开始一般让索引名称和类型名称一致</p>\n<h3 id=\"主要组件\"><a class=\"markdownIt-Anchor\" href=\"#主要组件\">#</a> 主要组件</h3>\n<ul>\n<li>\n<p>索引</p>\n<p>ES 将数据存储于一个或多个索引中，索引是具有类似特性的文档的集合。类比传统的关系型数据库领域来说，索引相当于 SQL 中的一个数据库，或者一个数据存储方案 (schema)。索引由其名称 (必须为全小写字符) 进行标识，并通过引用此名称完成文档的创建、搜索、更新及删除操作。一个 ES 集群中可以按需创建任意数目的索引。</p>\n</li>\n<li>\n<p>类型</p>\n<p>类型是索引内部的逻辑分区 (category/partition)，然而其意义完全取决于用户需求。因此，一个索引内部可定义一个或多个类型 (type)。一般来说，类型就是为那些拥有相同的域的文档做的预定义。例如，在索引中，可以定义一个用于存储用户数据的类型，一个存储日志数据的类型，以及一个存储评论数据的类型。类比传统的关系型数据库领域来说，类型相当于表。</p>\n</li>\n<li>\n<p>映射</p>\n<p>Mapping, 就是对索引库中索引的字段名称及其数据类型进行定义，类似于 mysql 中的表结构信息。不过 es 的 mapping 比数据库灵活很多，它可以动态识别字段。一般不需要指定 mapping 都可以，因为 es 会自动根据数据格式识别它的类型，如果你需要对某些字段添加特殊属性（如：定义使用其它分词器、是否分词、是否存储等），就必须手动添加 mapping。</p>\n<p>需要注意的是映射是不可修改的，一旦确定就不允许改动，在使用自动识别功能时，会以第一个存入的文档为参考来建立映射，后面存入的文档也必须符合该映射才能存入</p>\n</li>\n<li>\n<p>文档</p>\n<p>文档是 Lucene 索引和搜索的原子单位，它是包含了一个或多个域的容器，基于 JSON 格式进行表示。文档由一个或多个域组成，每个域拥有一个名字及一个或多个值，有多个值的域通常称为多值域。每个文档可以存储不同的域集，但同一类型下的文档至应该有某种程度上的相似之处。</p>\n</li>\n</ul>\n<h3 id=\"分片和副本\"><a class=\"markdownIt-Anchor\" href=\"#分片和副本\">#</a> 分片和副本</h3>\n<p>ES 的分片 (shard) 机制可将一个索引内部的数据分布地存储于多个节点，它通过将一个索引切分为多个底层物理的 Lucene 索引完成索引数据的分割存储功能，这每一个物理的 Lucene 索引称为一个分片 (shard)。每个分片其内部都是一个全功能且独立的索引，因此可由集群中的任何主机存储。创建索引时，用户可指定其分片的数量，默认数量为 5 个。</p>\n<p>Shard 有两种类型：primary 和 replica，即主 shard 及副本 shard。Primary shard 用于文档存储，每个新的索引会自动创建 5 个 Primary shard，当然此数量可在索引创建之前通过配置自行定义，不过，一旦创建完成，其 Primary shard 的数量将不可更改。Replica shard 是 Primary Shard 的副本，用于冗余数据及提高搜索性能。每个 Primary shard 默认配置了一个 Replica shard，但也可以配置多个，且其数量可动态更改。ES 会根据需要自动增加或减少这些 Replica shard 的数量。</p>\n<h3 id=\"分词器\"><a class=\"markdownIt-Anchor\" href=\"#分词器\">#</a> 分词器</h3>\n<p>把文本内容按照标准进行切分，默认的是 standard，该分词器按照单词切分，内容转变为小写，去掉标点，遇到每个中文字符都当成 1 个单词处理，后面会安装开源的中文分词器插件（ik）</p>\n<h4 id=\"感受分词器效果\"><a class=\"markdownIt-Anchor\" href=\"#感受分词器效果\">#</a> 感受分词器效果</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">先创建一个名叫shop_product的索引，然后再感受分词效果</span><br><span class=\"line\">PUT /shop_product</span><br><span class=\"line\"></span><br><span class=\"line\">默认分词器：</span><br><span class=\"line\">GET /shop_product/_analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;text&quot;:&quot;I am Groot&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">GET /shop_product/_analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">结论：默认的分词器只能对英文正常分词，不能对中文正常分词</span><br></pre></td></tr></table></figure>\n<h4 id=\"安装ik分词器\"><a class=\"markdownIt-Anchor\" href=\"#安装ik分词器\">#</a> 安装 IK 分词器</h4>\n<p>直接把压缩文件中的内容解压，然后放在 elasticsearch/plugins 下，然后重启即可</p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190611130218.png\" alt=\"img\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">IK分词器：</span><br><span class=\"line\">ik_smart：粗力度分词</span><br><span class=\"line\">ik_max_word：细力度分词</span><br><span class=\"line\"></span><br><span class=\"line\">GET /shop_product/_analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;text&quot;:&quot;I am Groot&quot;,</span><br><span class=\"line\">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">GET /shop_product/_analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class=\"line\">  &quot;analyzer&quot;:&quot;ik_smart&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">GET /shop_product/_analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;text&quot;:&quot;英特尔酷睿i7处理器&quot;,</span><br><span class=\"line\">  &quot;analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">结论：都能正常分词</span><br></pre></td></tr></table></figure>\n<h4 id=\"拓展词库\"><a class=\"markdownIt-Anchor\" href=\"#拓展词库\">#</a> 拓展词库</h4>\n<p>最简单的方式就是找到 IK 插件中的<strong> config/main.dic</strong> 文件，往里面添加新的词汇，然后重启服务器即可</p>\n<h3 id=\"倒排索引\"><a class=\"markdownIt-Anchor\" href=\"#倒排索引\">#</a> 倒排索引</h3>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/20190604141259.png\" alt=\"img\"></p>\n<h2 id=\"基本操作了解\"><a class=\"markdownIt-Anchor\" href=\"#基本操作了解\">#</a> 基本操作（了解）</h2>\n<h3 id=\"索引操作\"><a class=\"markdownIt-Anchor\" href=\"#索引操作\">#</a> 索引操作</h3>\n<p>建表索引，相当于在是在建立数据库</p>\n<h4 id=\"建立索引\"><a class=\"markdownIt-Anchor\" href=\"#建立索引\">#</a> 建立索引</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：PUT /索引名</span><br><span class=\"line\">在没有特殊设置的情况下，默认有5个分片，1个备份，也可以通过请求参数的方式来指定</span><br><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;settings&quot;: &#123;</span><br><span class=\"line\">    &quot;number_of_shards&quot;: 5, //设置5个片区</span><br><span class=\"line\">    &quot;number_of_replicas&quot;: 1 //设置1个备份</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"删除索引\"><a class=\"markdownIt-Anchor\" href=\"#删除索引\">#</a> 删除索引</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：DELETE /索引名</span><br></pre></td></tr></table></figure>\n<h3 id=\"映射操作\"><a class=\"markdownIt-Anchor\" href=\"#映射操作\">#</a> 映射操作</h3>\n<h4 id=\"建立索引和映射\"><a class=\"markdownIt-Anchor\" href=\"#建立索引和映射\">#</a> 建立索引和映射</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：PUT /索引名</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;mappings&quot;: &#123;</span><br><span class=\"line\">    类型名: &#123;</span><br><span class=\"line\">      &quot;properties..0&quot;: &#123;</span><br><span class=\"line\">        字段名: &#123;</span><br><span class=\"line\">          &quot;type&quot;: 字段类型, </span><br><span class=\"line\">          &quot;analyzer&quot;: 分词器类型, </span><br><span class=\"line\">          &quot;search_analyzer&quot;: 分词器类型,</span><br><span class=\"line\">          ...</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        ...</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">字段类型：double / long / integer / text / keyword / date / binary</span><br><span class=\"line\">注意：text和keyword都是字符串类型，但是只有text类型的数据才能分词，字段的配置一旦确定就不能更改</span><br><span class=\"line\">映射的配置项有很多，我们可以根据需要只配置用得上的属性</span><br></pre></td></tr></table></figure>\n<h4 id=\"查询映射\"><a class=\"markdownIt-Anchor\" href=\"#查询映射\">#</a> 查询映射</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：GET /索引名/_mapping</span><br></pre></td></tr></table></figure>\n<h2 id=\"crud操作\"><a class=\"markdownIt-Anchor\" href=\"#crud操作\">#</a> CRUD 操作</h2>\n<h3 id=\"文档操作\"><a class=\"markdownIt-Anchor\" href=\"#文档操作\">#</a> 文档操作</h3>\n<h4 id=\"新增和替换文档\"><a class=\"markdownIt-Anchor\" href=\"#新增和替换文档\">#</a> 新增和替换文档</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：PUT /索引名/类型名/文档ID</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  field1: value1,</span><br><span class=\"line\">  field2: value2,</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">注意：当索引/类型/映射不存在时，会使用默认设置自动添加</span><br><span class=\"line\">ES中的数据一般是从别的数据库导入的，所以文档的ID会沿用原数据库中的ID</span><br><span class=\"line\">索引库中没有该ID对应的文档时则新增，拥有该ID对应的文档时则替换</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：新增一个文档</span><br><span class=\"line\">需求2：替换一个文档</span><br></pre></td></tr></table></figure>\n<p>每一个文档都内置以下字段</p>\n<blockquote>\n<p>_index：所属索引</p>\n<p>_type：所属类型</p>\n<p>_id：文档 ID</p>\n<p>_version：乐观锁版本号</p>\n<p>_source：数据内容</p>\n</blockquote>\n<h4 id=\"查询文档\"><a class=\"markdownIt-Anchor\" href=\"#查询文档\">#</a> 查询文档</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：</span><br><span class=\"line\">根据ID查询 -&gt; GET /索引名/类型名/文档ID</span><br><span class=\"line\">查询所有（基本查询语句） -&gt; GET /索引名/类型名/_search</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：根据文档ID查询一个文档</span><br><span class=\"line\">需求2：查询所有的文档</span><br></pre></td></tr></table></figure>\n<p>查询所有结果中包含以下字段</p>\n<blockquote>\n<p>took：耗时</p>\n<p>_shards.total：分片总数</p>\n<p>hits.total：查询到的数量</p>\n<p>hits.max_score：最大匹配度</p>\n<p>hits.hits：查询到的结果</p>\n<p>hits.hits._score：匹配度</p>\n</blockquote>\n<h4 id=\"删除文档\"><a class=\"markdownIt-Anchor\" href=\"#删除文档\">#</a> 删除文档</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：DELETE /索引名/类型名/文档ID</span><br><span class=\"line\">注意：这里的删除并且不是真正意义上的删除，仅仅是清空文档内容而已，并且标记该文档的状态为删除</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：根据文档ID删除一个文档</span><br><span class=\"line\">需求2：替换刚刚删除的文档</span><br></pre></td></tr></table></figure>\n<h2 id=\"高级查询\"><a class=\"markdownIt-Anchor\" href=\"#高级查询\">#</a> 高级查询</h2>\n<p>数据准备：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PUT /shop_product</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;mappings&quot;: &#123;</span><br><span class=\"line\">    &quot;shop_product&quot;: &#123;</span><br><span class=\"line\">      &quot;properties&quot;: &#123;</span><br><span class=\"line\">        &quot;id&quot;: &#123;</span><br><span class=\"line\">          &quot;type&quot;: &quot;integer&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;title&quot;:&#123;</span><br><span class=\"line\">          &quot;type&quot;: &quot;text&quot;, </span><br><span class=\"line\">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class=\"line\">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;price&quot;:&#123;</span><br><span class=\"line\">          &quot;type&quot;: &quot;double&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;intro&quot;:&#123;</span><br><span class=\"line\">          &quot;type&quot;: &quot;text&quot;, </span><br><span class=\"line\">          &quot;analyzer&quot;: &quot;ik_smart&quot;, </span><br><span class=\"line\">          &quot;search_analyzer&quot;: &quot;ik_smart&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        &quot;brand&quot;:&#123;</span><br><span class=\"line\">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST /shop_product/shop_product/_bulk</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 1&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:1,&quot;title&quot;:&quot;Apple iPhone XR (A2108) 128GB 白色 移动联通电信4G手机 双卡双待&quot;,&quot;price&quot;:5299,&quot;intro&quot;:&quot;【iPhoneXR限时特惠！】6.1英寸视网膜显示屏，A12仿生芯片，面容识别，无线充电，支持双卡！选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 2&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:2,&quot;title&quot;:&quot;Apple 2019款 Macbook Pro 13.3【带触控栏】八代i7 18G 256G RP645显卡 深空灰 苹果笔记本电脑 轻薄本 MUHN2CH/A&quot;,&quot;price&quot;:15299,&quot;intro&quot;:&quot;【八月精选】Pro2019年新品上市送三重好礼，现在购买领满8000减400元优惠神劵，劵后更优惠！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 3&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:3,&quot;title&quot;:&quot;Apple iPad Air 3 2019年新款平板电脑 10.5英寸（64G WLAN版/A12芯片/Retina显示屏/MUUL2CH/A）金色&quot;,&quot;price&quot;:3788,&quot;intro&quot;:&quot;8月尊享好礼！买iPad即送蓝牙耳机！领券立减！多款产品支持手写笔！【新一代iPad，总有一款适合你】选【换修无忧版】获 AppleCare 原厂服务，享只换不修！更有快速换机、保值换新、轻松月付！&quot;,&quot;brand&quot;:&quot;Apple&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 4&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:4,&quot;title&quot;:&quot;华为HUAWEI MateBook X Pro 2019款 英特尔酷睿i5 13.9英寸全面屏轻薄笔记本电脑(i5 8G 512G 3K 触控) 灰&quot;,&quot;price&quot;:7999,&quot;intro&quot;:&quot;3K全面屏开启无界视野;轻薄设计灵动有型，HuaweiShare一碰传&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 5&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:5,&quot;title&quot;:&quot;华为 HUAWEI Mate20 X (5G) 7nm工艺5G旗舰芯片全面屏超大广角徕卡三摄8GB+256GB翡冷翠5G双模全网通手机&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;【5G双模，支持SA/NSA网络，7.2英寸全景巨屏，石墨烯液冷散热】5G先驱，极速体验。&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 6&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:6,&quot;title&quot;:&quot;华为平板 M6 10.8英寸麒麟980影音娱乐平板电脑4GB+64GB WiFi（香槟金）&quot;,&quot;price&quot;:2299,&quot;intro&quot;:&quot;【华为暑期购】8月2日-4日，M5青春版指定爆款型号优惠100元，AI语音控制&quot;,&quot;brand&quot;:&quot;华为&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 7&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:7,&quot;title&quot;:&quot;荣耀20 PRO DXOMARK全球第二高分 4800万四摄 双光学防抖 麒麟980 全网通4G 8GB+128GB 蓝水翡翠 拍照手机&quot;,&quot;price&quot;:3199,&quot;intro&quot;:&quot;白条6期免息！麒麟980，4800万全焦段AI四摄！荣耀20系列2699起，4800万超广角AI四摄！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 8&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:8,&quot;title&quot;:&quot;荣耀MagicBook Pro 16.1英寸全面屏轻薄性能笔记本电脑（酷睿i7 8G 512G MX250 IPS FHD 指纹解锁）冰河银&quot;,&quot;price&quot;:6199,&quot;intro&quot;:&quot;16.1英寸无界全面屏金属轻薄本，100%sRGB色域，全高清IPS防眩光护眼屏，14小时长续航，指纹一健开机登录，魔法一碰传高速传输。&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 9&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:9,&quot;title&quot;:&quot;荣耀平板5 麒麟8核芯片 GT游戏加速 4G+128G 10.1英寸全高清屏影音平板电脑 WiFi版 冰川蓝&quot;,&quot;price&quot;:1549,&quot;intro&quot;:&quot;【爆款平板推荐】哈曼卡顿专业调音，10.1英寸全高清大屏，双喇叭立体环绕音，配置多重护眼，值得拥有！&quot;,&quot;brand&quot;:&quot;荣耀&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 10&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:10,&quot;title&quot;:&quot;小米9 4800万超广角三摄 6GB+128GB全息幻彩蓝 骁龙855 全网通4G 双卡双待 水滴全面屏拍照智能游戏手机&quot;,&quot;price&quot;:2799,&quot;intro&quot;:&quot;限时优惠200，成交价2799！索尼4800万广角微距三摄，屏下指纹解锁！&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 11&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:11,&quot;title&quot;:&quot;小米(MI)Pro 2019款 15.6英寸金属轻薄笔记本(第八代英特尔酷睿i7-8550U 16G 512GSSD MX250 2G独显) 深空灰&quot;,&quot;price&quot;:6899,&quot;intro&quot;:&quot;【PCIE固态硬盘、72%NTSC高色域全高清屏】B面康宁玻璃覆盖、16G双通道大内存、第八代酷睿I7处理器、专业级调校MX150&quot;,&quot;brand&quot;:&quot;小米&quot;&#125;</span><br><span class=\"line\">&#123;&quot;create&quot;:&#123;&quot;_id&quot;: 12&#125;&#125;</span><br><span class=\"line\">&#123;&quot;id&quot;:12,&quot;title&quot;:&quot;联想(Lenovo)拯救者Y7000P 2019英特尔酷睿i7 15.6英寸游戏笔记本电脑(i7 9750H 16G 1T SSD GTX1660Ti 144Hz)&quot;,&quot;price&quot;:9299,&quot;intro&quot;:&quot;超大1T固态，升级双通道16G内存一步到位，GTX1660Ti电竞级独显，英特尔9代i7H高性能处理器，144Hz电竞屏窄边框！&quot;,&quot;brand&quot;:&quot;联想&quot;&#125;</span><br></pre></td></tr></table></figure>\n<p>Elasticsearch 基于 JSON 提供完整的查询 DSL（Domain Specific Language：领域特定语言）来定义查询。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">基本语法：</span><br><span class=\"line\">GET /索引名/类型名/_search</span><br></pre></td></tr></table></figure>\n<p>一般都是需要配合查询参数来使用的，配合不同的参数有不同的查询效果</p>\n<p>参数配置项可以参考博客：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC82MzMzOTQwNjIxZWM=\">https://www.jianshu.com/p/6333940621ec</span></p>\n<h3 id=\"结果排序\"><a class=\"markdownIt-Anchor\" href=\"#结果排序\">#</a> 结果排序</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;sort&quot;: [</span><br><span class=\"line\">    &#123;field: 排序规则&#125;,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">排序</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;sort&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;price&quot;: &#123;</span><br><span class=\"line\">        &quot;order&quot;: &quot;desc&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">排序规则：</span><br><span class=\"line\">asc表示升序</span><br><span class=\"line\">desc:表示降序</span><br><span class=\"line\">没有配置排序的情况下，默认按照评分降序排列</span><br></pre></td></tr></table></figure>\n<h3 id=\"分页查询\"><a class=\"markdownIt-Anchor\" href=\"#分页查询\">#</a> 分页查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;from&quot;: start,</span><br><span class=\"line\">  &quot;size&quot;: pageSize</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">分页 从第几个开始 每页几个</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;from&quot;: 2,</span><br><span class=\"line\">  &quot;size&quot;: 4,</span><br><span class=\"line\">  &quot;sort&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;price&quot;: &#123;</span><br><span class=\"line\">        &quot;order&quot;: &quot;desc&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：查询所有文档按照价格降序排列</span><br><span class=\"line\">需求2：分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br></pre></td></tr></table></figure>\n<h3 id=\"检索查询\"><a class=\"markdownIt-Anchor\" href=\"#检索查询\">#</a> 检索查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    检索方式: &#123;field: value&#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">检索查询 全文检索</span><br><span class=\"line\">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;match&quot;: &#123;</span><br><span class=\"line\">      &quot;title&quot;: &quot;游戏 手机&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">检索查询 精准匹配</span><br><span class=\"line\">需求2：查询商品价格等于15299的商品</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;term&quot;: &#123;</span><br><span class=\"line\">      &quot;price&quot;: 15299</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">检索查询 范围检索</span><br><span class=\"line\">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;range&quot;: &#123;</span><br><span class=\"line\">      &quot;price&quot;: &#123;</span><br><span class=\"line\">        &quot;gte&quot;: 5000,</span><br><span class=\"line\">        &quot;lte&quot;: 10000</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;sort&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;price&quot;: &#123;</span><br><span class=\"line\">        &quot;order&quot;: &quot;asc&quot;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">检索方式：</span><br><span class=\"line\">term表示精确匹配，value值不会被分词器拆分，按照倒排索引匹配</span><br><span class=\"line\">match表示全文检索，value值会被分词器拆分，然后去倒排索引中匹配</span><br><span class=\"line\">range表示范围检索，其value值是一个对象，如&#123; &quot;range&quot;: &#123;field: &#123;比较规则: value, ...&#125;&#125; &#125;</span><br><span class=\"line\">  比较规则有gt / gte / lt / lte 等</span><br><span class=\"line\">  </span><br><span class=\"line\">注意：term和match都能用在数值和字符上，range用在数值上</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class=\"line\">需求2：查询商品价格等于15299的商品</span><br><span class=\"line\">需求3：查询商品价格在5000~10000之间商品，按照价格升序排列</span><br></pre></td></tr></table></figure>\n<h3 id=\"关键字查询\"><a class=\"markdownIt-Anchor\" href=\"#关键字查询\">#</a> 关键字查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;multi_match&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: value,</span><br><span class=\"line\">      &quot;fields&quot;: [field1, field2, ...]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">关键字查询</span><br><span class=\"line\">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;multi_match&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class=\"line\">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">multi_match：表示在多个字段间做检索，只要其中一个字段满足条件就能查询出来，多用在字段上</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br></pre></td></tr></table></figure>\n<h3 id=\"高亮显示\"><a class=\"markdownIt-Anchor\" href=\"#高亮显示\">#</a> 高亮显示</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123; ... &#125;,</span><br><span class=\"line\">  &quot;highlight&quot;: &#123;</span><br><span class=\"line\">    &quot;fields&quot;: &#123;</span><br><span class=\"line\">      field1: &#123;&#125;,</span><br><span class=\"line\">      field2: &#123;&#125;,</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;pre_tags&quot;: 开始标签,</span><br><span class=\"line\">    &quot;post_tags&quot; 结束标签</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">高亮显示</span><br><span class=\"line\">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;multi_match&quot;: &#123;</span><br><span class=\"line\">      &quot;query&quot;: &quot;蓝牙 指纹 双卡&quot;,</span><br><span class=\"line\">      &quot;fields&quot;: [&quot;title&quot;, &quot;intro&quot;]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &quot;highlight&quot;: &#123;</span><br><span class=\"line\">    &quot;fields&quot;: &#123;</span><br><span class=\"line\">      &quot;title&quot;: &#123;&#125;,</span><br><span class=\"line\">      &quot;intro&quot;: &#123;&#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &quot;pre_tags&quot;:&quot;&lt;h1&gt;&quot;,</span><br><span class=\"line\">    &quot;post_tags&quot;:&quot;&lt;/h1&gt;&quot;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">highlight：表示高亮显示，需要在fields中配置哪些字段中检索到该内容需要高亮显示</span><br><span class=\"line\">  必须配合检索(term / match)一起使用</span><br><span class=\"line\">  </span><br><span class=\"line\">需求1：查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br></pre></td></tr></table></figure>\n<h3 id=\"逻辑查询\"><a class=\"markdownIt-Anchor\" href=\"#逻辑查询\">#</a> 逻辑查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式： </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;bool&quot;: &#123;</span><br><span class=\"line\">      逻辑规则: [</span><br><span class=\"line\">        &#123;检索方式: &#123;field: value&#125;&#125;, </span><br><span class=\"line\">        ...</span><br><span class=\"line\">      ],</span><br><span class=\"line\">      ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">逻辑查询</span><br><span class=\"line\">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;bool&quot;: &#123;</span><br><span class=\"line\">      &quot;must&quot;: [</span><br><span class=\"line\">        &#123;&quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;i7&quot;</span><br><span class=\"line\">        &#125;&#125;,</span><br><span class=\"line\">        &#123;&quot;range&quot;: &#123;</span><br><span class=\"line\">          &quot;price&quot;: &#123;</span><br><span class=\"line\">            &quot;gt&quot;: 7000</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">逻辑查询</span><br><span class=\"line\">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;bool&quot;: &#123;</span><br><span class=\"line\">      &quot;should&quot;: [</span><br><span class=\"line\">        &#123;&quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;pro&quot;</span><br><span class=\"line\">        &#125;&#125;,</span><br><span class=\"line\">        &#123;&quot;range&quot;: &#123;</span><br><span class=\"line\">          &quot;price&quot;: &#123;</span><br><span class=\"line\">            &quot;gte&quot;: 1000,</span><br><span class=\"line\">            &quot;lte&quot;: 3000</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">逻辑规则：must / should / must_not，相当于and / or / not</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class=\"line\">需求2：查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br></pre></td></tr></table></figure>\n<h3 id=\"过滤查询\"><a class=\"markdownIt-Anchor\" href=\"#过滤查询\">#</a> 过滤查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;bool&quot;: &#123;</span><br><span class=\"line\">      &quot;filter&quot;: [</span><br><span class=\"line\">        &#123; 检索方式: &#123; field: value &#125; &#125;，            \t</span><br><span class=\"line\">        ...</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;             </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">过滤查询 不评分</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;query&quot;: &#123;</span><br><span class=\"line\">    &quot;bool&quot;: &#123;</span><br><span class=\"line\">      &quot;filter&quot;: [</span><br><span class=\"line\">        &#123;&quot;match&quot;: &#123;</span><br><span class=\"line\">          &quot;title&quot;: &quot;pro&quot;</span><br><span class=\"line\">        &#125;&#125;</span><br><span class=\"line\">      ]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">从效果上讲过滤查询和检索查询能做一样的效果</span><br><span class=\"line\">区别在于过滤查询不评分，结果能缓存，检索查询要评分，结果不缓存</span><br><span class=\"line\">一般是不会直接使用过滤查询，都是在检索了一定数据的基础上再使用</span><br></pre></td></tr></table></figure>\n<p>关于 filter 的更多认知推荐大家读这篇博客：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xhb3lhbmczNjAvYXJ0aWNsZS9kZXRhaWxzLzgwNDY4NzU3\">https://blog.csdn.net/laoyang360/article/details/80468757</span></p>\n<h3 id=\"分组查询\"><a class=\"markdownIt-Anchor\" href=\"#分组查询\">#</a> 分组查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">参数格式：</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 0,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    自定义分组字段: &#123;</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: 分组字段, </span><br><span class=\"line\">        &quot;order&quot;: &#123;自定义统计字段:排序规则&#125;, </span><br><span class=\"line\">        &quot;size&quot;: 10  //默认显示10组 </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123; //分组后的统计查询，相当于MySQL分组函数查询</span><br><span class=\"line\">        自定义统计字段: &#123;</span><br><span class=\"line\">          分组运算: &#123;</span><br><span class=\"line\">            &quot;field&quot;: 统计字段</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;       </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">分组查询</span><br><span class=\"line\">需求1：按照品牌分组，统计各品牌的数量</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 0,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;brand_group&quot;: &#123;</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class=\"line\">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class=\"line\">        &quot;size&quot;: 10  </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123; </span><br><span class=\"line\">        &quot;brand_group&quot;: &#123;</span><br><span class=\"line\">          &quot;value_count&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;id&quot;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;       </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">分组查询</span><br><span class=\"line\">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 0,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;brand_group&quot;: &#123;</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class=\"line\">        &quot;order&quot;: &#123;&quot;brand_group&quot;:&quot;desc&quot;&#125;, </span><br><span class=\"line\">        &quot;size&quot;: 10  </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123; </span><br><span class=\"line\">        &quot;brand_group&quot;: &#123;</span><br><span class=\"line\">          &quot;avg&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;price&quot;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;       </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">分组查询</span><br><span class=\"line\">需求3：按照品牌分组，统计各品牌的价格数据</span><br><span class=\"line\">GET /shop_product/shop_product/_search</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;size&quot;: 0,</span><br><span class=\"line\">  &quot;aggs&quot;: &#123;</span><br><span class=\"line\">    &quot;brand_group_aggs&quot;: &#123;</span><br><span class=\"line\">      &quot;terms&quot;: &#123;</span><br><span class=\"line\">        &quot;field&quot;: &quot;brand&quot;, </span><br><span class=\"line\">        &quot;order&quot;: &#123;&quot;brand_group_aggs.count&quot;:&quot;desc&quot;&#125;, </span><br><span class=\"line\">        &quot;size&quot;: 10  </span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &quot;aggs&quot;: &#123; </span><br><span class=\"line\">        &quot;brand_group_aggs&quot;: &#123;</span><br><span class=\"line\">          &quot;stats&quot;: &#123;</span><br><span class=\"line\">            &quot;field&quot;: &quot;price&quot;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;       </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">分组运算：avg / sum / min / max / value_count / stats(执行以上所有功能的)</span><br><span class=\"line\">注意：这里是size=0其目的是为了不要显示hit内容，专注点放在观察分组上</span><br><span class=\"line\"></span><br><span class=\"line\">需求1：按照品牌分组，统计各品牌的数量</span><br><span class=\"line\">需求2：按照品牌分组，统计各品牌的平均价格</span><br><span class=\"line\">需求3：按照品牌分组，统计各品牌的价格数据</span><br></pre></td></tr></table></figure>\n<h2 id=\"批处理了解\"><a class=\"markdownIt-Anchor\" href=\"#批处理了解\">#</a> 批处理（了解）</h2>\n<p>当需要集中的批量处理文档时，如果依然使用传统的操作单个 API 的方式，将会浪费大量网络资源，Elasticsearch 为了提高操作的性能，专门提供了批处理的 API</p>\n<h3 id=\"mget批量查询\"><a class=\"markdownIt-Anchor\" href=\"#mget批量查询\">#</a> mget 批量查询</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：</span><br><span class=\"line\">GET /索引名/类型/_mget</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;docs&quot;: [</span><br><span class=\"line\">    &#123;&quot;_id&quot;: 文档ID&#125;,</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"bulk批量增删改\"><a class=\"markdownIt-Anchor\" href=\"#bulk批量增删改\">#</a> bulk 批量增删改</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">语法：</span><br><span class=\"line\">POST /索引名/类型/_bulk</span><br><span class=\"line\">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class=\"line\">&#123;...&#125;</span><br><span class=\"line\">&#123;动作:&#123;&quot;_id&quot;: 文档ID&#125;&#125;</span><br><span class=\"line\">&#123;...&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">动作：create / update / delete，其中delete只有1行JSON，其他操作都是有2行JSON，并且JSON不能格式化，如果是update动作，它的数据需要加个key为doc</span><br><span class=\"line\">如：</span><br><span class=\"line\">&#123;&quot;update&quot;: &#123;&quot;_id&quot;: xx&#125;&#125;</span><br><span class=\"line\">&#123;&quot;doc&quot;: &#123;&quot;xx&quot;:xx, &quot;xx&quot;:xx&#125;&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"spring-data-elasticsearch\"><a class=\"markdownIt-Anchor\" href=\"#spring-data-elasticsearch\">#</a> Spring Data Elasticsearch</h2>\n<h3 id=\"准备环境\"><a class=\"markdownIt-Anchor\" href=\"#准备环境\">#</a> 准备环境</h3>\n<h4 id=\"导入依赖\"><a class=\"markdownIt-Anchor\" href=\"#导入依赖\">#</a> 导入依赖</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;parent&gt;</span><br><span class=\"line\">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;2.1.3.RELEASE&lt;/version&gt;</span><br><span class=\"line\">&lt;/parent&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;properties&gt;</span><br><span class=\"line\">    &lt;java.version&gt;1.8&lt;/java.version&gt;</span><br><span class=\"line\">&lt;/properties&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;dependencies&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;!--SpringBoot整合Spring Data Elasticsearch的依赖--&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">    &lt;dependency&gt;</span><br><span class=\"line\">        &lt;groupId&gt;commons-beanutils&lt;/groupId&gt;</span><br><span class=\"line\">        &lt;artifactId&gt;commons-beanutils&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;version&gt;1.8.3&lt;/version&gt;</span><br><span class=\"line\">    &lt;/dependency&gt;</span><br><span class=\"line\">&lt;/dependencies&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;build&gt;</span><br><span class=\"line\">    &lt;plugins&gt;</span><br><span class=\"line\">        &lt;plugin&gt;</span><br><span class=\"line\">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">        &lt;/plugin&gt;</span><br><span class=\"line\">    &lt;/plugins&gt;</span><br><span class=\"line\">&lt;/build&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"编写domain\"><a class=\"markdownIt-Anchor\" href=\"#编写domain\">#</a> 编写 DOMAIN</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">  @Document：配置操作哪个索引下的哪个类型</span><br><span class=\"line\">  @Id：标记文档ID字段</span><br><span class=\"line\">  @Field：配置映射信息，如：分词器</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Getter@Setter@ToString</span><br><span class=\"line\">@NoArgsConstructor</span><br><span class=\"line\">@AllArgsConstructor</span><br><span class=\"line\">@Document(indexName=&quot;shop_product&quot;, type=&quot;shop_product&quot;)</span><br><span class=\"line\">public class Product &#123;</span><br><span class=\"line\">    @Id</span><br><span class=\"line\">    private String id;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class=\"line\">    private String title;</span><br><span class=\"line\"></span><br><span class=\"line\">    private Integer price;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Field(analyzer=&quot;ik_max_word&quot;,searchAnalyzer=&quot;ik_max_word&quot;, type=FieldType.Text)</span><br><span class=\"line\">    private String intro;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Field(type=FieldType.Keyword)</span><br><span class=\"line\">    private String brand;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"配置连接信息\"><a class=\"markdownIt-Anchor\" href=\"#配置连接信息\">#</a> 配置连接信息</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#application.properties</span><br><span class=\"line\"># 配置集群名称，名称写错会连不上服务器，默认elasticsearch</span><br><span class=\"line\">spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class=\"line\"># 配置集群节点</span><br><span class=\"line\">spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br></pre></td></tr></table></figure>\n<h3 id=\"elasticsearchrepository\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearchrepository\">#</a> ElasticsearchRepository</h3>\n<p>该接口是框架封装的用于操作 Elastsearch 的高级接口，只要我们自己的写个接口去继承该接口就能直接对 Elasticsearch 进行 CRUD 操作</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\">  泛型1：domain的类型</span><br><span class=\"line\">  泛型2：文档主键类型</span><br><span class=\"line\">  该接口直接该给Spring，底层会使用JDK代理的方式创建对象，交给容器管理</span><br><span class=\"line\"> */</span><br><span class=\"line\">@Repository</span><br><span class=\"line\">public interface ProductESRepository extends ElasticsearchRepository&lt;Product, String&gt; &#123;</span><br><span class=\"line\">    // 符合Spring Data规范的高级查询方法</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"完成crud分页排序\"><a class=\"markdownIt-Anchor\" href=\"#完成crud分页排序\">#</a> 完成 CRUD + 分页 + 排序</h3>\n<h3 id=\"组件介绍\"><a class=\"markdownIt-Anchor\" href=\"#组件介绍\">#</a> 组件介绍</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ElasticsearchRepository：框架封装的用于便捷完成常用操作的工具接口</span><br><span class=\"line\">ElasticsearchTemplate：框架封装的用于便捷操作Elasticsearch的模板类</span><br><span class=\"line\"></span><br><span class=\"line\">NativeSearchQueryBuilder：用于生成查询条件的构建器，需要去封装各种查询条件</span><br><span class=\"line\">QueryBuilder：该接口表示一个查询条件，其对象可以通过QueryBuilders工具类中的方法快速生成各种条件</span><br><span class=\"line\">  boolQuery()：生成bool条件，相当于 &quot;bool&quot;: &#123; &#125;</span><br><span class=\"line\">  matchQuery()：生成match条件，相当于 &quot;match&quot;: &#123; &#125;</span><br><span class=\"line\">  rangeQuery()：生成range条件，相当于 &quot;range&quot;: &#123; &#125;</span><br><span class=\"line\">AbstractAggregationBuilder：用于生成分组查询的构建器，其对象通过AggregationBuilders工具类生成</span><br><span class=\"line\">Pageable：表示分页参数，对象通过PageRequest.of(页数, 容量)获取</span><br><span class=\"line\">SortBuilder：排序构建器，对象通过SortBuilders.fieldSort(字段).order(规则)获取</span><br></pre></td></tr></table></figure>\n<h3 id=\"elasticsearchtemplate\"><a class=\"markdownIt-Anchor\" href=\"#elasticsearchtemplate\">#</a> ElasticsearchTemplate</h3>\n<p>该模板类，封装了便捷操作 Elasticsearch 的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作，该对象用起来会略微复杂些，尤其是对于查询，还需要把查询到的结果自己封装对象</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//该对象已经由SpringBoot完成自动配置，直接注入即可</span><br><span class=\"line\">@Autowired</span><br><span class=\"line\">private ElasticsearchTemplate template;</span><br></pre></td></tr></table></figure>\n<p>一般情况下，ElasticsearchTemplate 和 ElasticsearchRepository 是分工合作的，ElasticsearchRepository 已经能完成绝大部分的功能，如果遇到复杂的查询则要使用 ElasticsearchTemplate，如多字段分组、高亮显示等</p>\n<h3 id=\"实例代码\"><a class=\"markdownIt-Anchor\" href=\"#实例代码\">#</a> 实例代码</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Autowired</span><br><span class=\"line\">private ElasticsearchTemplate template;</span><br><span class=\"line\"></span><br><span class=\"line\">@Autowired</span><br><span class=\"line\">private ProductESRepository repository;</span><br><span class=\"line\"></span><br><span class=\"line\">// 新增或者覆盖一个文档</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testSaveOrUpdate() throws Exception &#123;</span><br><span class=\"line\">    // 索引库中不存在则新增，存在则覆盖</span><br><span class=\"line\">    Product p = new Product(&quot;13&quot;, &quot;华为手环 B5（Android 运动手环）&quot;, 999,</span><br><span class=\"line\">                            &quot;高清彩屏 腕上蓝牙耳机 心率检测 来电消息提醒&quot;, &quot;华为&quot;);</span><br><span class=\"line\">    repostitory.save(p);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 删除一个文档</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testDelete() throws Exception &#123;</span><br><span class=\"line\">    repostitory.deleteById(&quot;13&quot;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 根据ID查询一个文档</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testGet() throws Exception &#123;</span><br><span class=\"line\">    Optional&lt;Product&gt; optional = repostitory.findById(&quot;1&quot;);</span><br><span class=\"line\">    optional.ifPresent(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询所有文档</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testList() throws Exception &#123;</span><br><span class=\"line\">    Iterable&lt;Product&gt; iter = repostitory.findAll();</span><br><span class=\"line\">    iter.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 分页查询文档按照价格降序排列，显示第2页，每页显示3个</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery1() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    // 设置分页信息</span><br><span class=\"line\">    builder.withPageable(PageRequest.of(1, 3));</span><br><span class=\"line\">    // 设置排序信息</span><br><span class=\"line\">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.DESC));</span><br><span class=\"line\"></span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    System.out.println(page.getTotalElements()); //总记录数</span><br><span class=\"line\">    System.out.println(page.getTotalPages()); //总页数</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品标题中符合&quot;游戏 手机&quot;的字样的商品</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery2() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.matchQuery(&quot;title&quot;, &quot;游戏 手机&quot;)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品价格等于15299的商品</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery3() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.termQuery(&quot;price&quot;, 15299)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品价格在5000~9000之间商品，按照价格升序排列</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery4() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.rangeQuery(&quot;price&quot;)</span><br><span class=\"line\">            .gte(5000).lte(9000)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    builder.withSort(SortBuilders.fieldSort(&quot;price&quot;).order(SortOrder.ASC));</span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery5() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class=\"line\">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品标题中符合&quot;i7&quot;的字样并且价格大于7000的商品</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery6() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.boolQuery()</span><br><span class=\"line\">        .must(QueryBuilders.matchQuery(&quot;title&quot;, &quot;i7&quot;))</span><br><span class=\"line\">        .must(QueryBuilders.rangeQuery(&quot;price&quot;).gt(7000))</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品标题中符合&quot;pro&quot;的字样或者价格在1000~3000的商品</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery7() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.boolQuery()</span><br><span class=\"line\">            .should(QueryBuilders.matchQuery(&quot;title&quot;, &quot;pro&quot;))</span><br><span class=\"line\">            .should(QueryBuilders.rangeQuery(&quot;price&quot;).gte(1000).lte(3000))</span><br><span class=\"line\">    );</span><br><span class=\"line\">    Page&lt;Product&gt; page = repostitory.search(builder.build());</span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 按照品牌分组，统计各品牌的数量</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery8() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.addAggregation(</span><br><span class=\"line\">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class=\"line\">    // 获取自定义的分组字段</span><br><span class=\"line\">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class=\"line\">    brand.getBuckets().forEach(bucket -&gt; System.out.println(bucket.getDocCount()));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 按照品牌分组，统计各品牌的平均价格</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery9() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.addAggregation(</span><br><span class=\"line\">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class=\"line\">        .subAggregation(AggregationBuilders.avg(&quot;avgPrice&quot;).field(&quot;price&quot;))</span><br><span class=\"line\">    );</span><br><span class=\"line\">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class=\"line\">    // 获取自定义的分组字段</span><br><span class=\"line\">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class=\"line\">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class=\"line\">        InternalAvg avgPrice = bucket.getAggregations().get(&quot;avgPrice&quot;);</span><br><span class=\"line\">        System.out.println(avgPrice.getValue());</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 按照品牌分组，统计各品牌的价格数据</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testQuery10() throws Exception &#123;</span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    builder.addAggregation(</span><br><span class=\"line\">        AggregationBuilders.terms(&quot;groupByBrand&quot;).field(&quot;brand&quot;)</span><br><span class=\"line\">        .subAggregation(AggregationBuilders.stats(&quot;statsPrice&quot;).field(&quot;price&quot;))</span><br><span class=\"line\">    );</span><br><span class=\"line\">    AggregatedPage&lt;Product&gt; page = (AggregatedPage&lt;Product&gt;) repostitory.search(builder.build());</span><br><span class=\"line\">    // 获取自定义的分组字段</span><br><span class=\"line\">    StringTerms brand = (StringTerms) page.getAggregation(&quot;groupByBrand&quot;);</span><br><span class=\"line\">    brand.getBuckets().forEach(bucket -&gt; &#123;</span><br><span class=\"line\">        InternalStats statsPrice = bucket.getAggregations().get(&quot;statsPrice&quot;);</span><br><span class=\"line\">        System.out.println(statsPrice.getSumAsString());</span><br><span class=\"line\">        System.out.println(statsPrice.getAvgAsString());</span><br><span class=\"line\">        System.out.println(statsPrice.getMaxAsString());</span><br><span class=\"line\">        System.out.println(statsPrice.getMinAsString());</span><br><span class=\"line\">        System.out.println(statsPrice.getCount());</span><br><span class=\"line\">        System.out.println(&quot;-----------------------&quot;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 查询商品标题或简介中符合&quot;蓝牙 指纹 双卡&quot;的字样的商品，并且高亮显示</span><br><span class=\"line\">@Test</span><br><span class=\"line\">public void testHighlight() throws Exception &#123;</span><br><span class=\"line\">    // Java与JSON互转的工具对象</span><br><span class=\"line\">    ObjectMapper mapper = new ObjectMapper();</span><br><span class=\"line\"></span><br><span class=\"line\">    NativeSearchQueryBuilder builder = new NativeSearchQueryBuilder();</span><br><span class=\"line\">    // 设置查询哪个索引中的哪个类型</span><br><span class=\"line\">    builder.withIndices(&quot;shop_product&quot;).withTypes(&quot;shop_product&quot;);</span><br><span class=\"line\">    builder.withQuery(</span><br><span class=\"line\">        QueryBuilders.multiMatchQuery(&quot;蓝牙 指纹 双卡&quot;,</span><br><span class=\"line\">                                      &quot;title&quot;, &quot;intro&quot;)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    builder.withHighlightFields(</span><br><span class=\"line\">        new HighlightBuilder.Field(&quot;title&quot;)</span><br><span class=\"line\">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;),</span><br><span class=\"line\">        new HighlightBuilder.Field(&quot;intro&quot;)</span><br><span class=\"line\">            .preTags(&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;).postTags(&quot;&lt;/span&gt;&quot;)</span><br><span class=\"line\">    );</span><br><span class=\"line\">    AggregatedPage&lt;Product&gt; page = template.queryForPage(builder.build(), Product.class, new SearchResultMapper() &#123;</span><br><span class=\"line\">        public &lt;T&gt; AggregatedPage&lt;T&gt; mapResults(SearchResponse resp, Class&lt;T&gt; clazz, Pageable pageable) &#123;</span><br><span class=\"line\">            List&lt;T&gt; list = new ArrayList&lt;&gt;();</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                for (SearchHit hit : resp.getHits().getHits()) &#123;</span><br><span class=\"line\">                    // 把查询到的JSON字符串转换成Java对象</span><br><span class=\"line\">                    T t = mapper.readValue(hit.getSourceAsString(), clazz);</span><br><span class=\"line\">                    for (HighlightField field : hit.getHighlightFields().values()) &#123;</span><br><span class=\"line\">                        // 替换需要高亮显示的字段，用到Apache的BeanUtils工具</span><br><span class=\"line\">                        BeanUtils.setProperty(t, field.getName(), field.getFragments()[0].string());</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    list.add(t);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; catch (Exception e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">                return null;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            long total = resp.getHits().totalHits;</span><br><span class=\"line\">            return new AggregatedPageImpl&lt;&gt;(list, pageable, total);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    page.forEach(System.out::println);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"springboot23x以上配置\"><a class=\"markdownIt-Anchor\" href=\"#springboot23x以上配置\">#</a> springboot2.3.x 以上配置</h3>\n<blockquote>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnNwcmluZy5pby9zcHJpbmctZGF0YS9lbGFzdGljc2VhcmNoL2RvY3MvNC4wLjEuUkVMRUFTRS9yZWZlcmVuY2UvaHRtbC8jbmV3LWZlYXR1cmVz\">配置关系对应</span></p>\n<p><img data-src=\"https://images-jsh.oss-cn-beijing.aliyuncs.com/img/%E6%88%AA%E5%B1%8F2021-08-14%2014.17.14.png\" alt=\"截屏2021-08-14 14.17.14\"></p>\n</blockquote>\n<ol>\n<li>\n<p>pom 相同</p>\n</li>\n<li>\n<p>配置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">## 旧版本以spring.data.elasticsearch.开头;访问地址配置不用声明访问协议,监听es的tcp端口</span><br><span class=\"line\">#spring.data.elasticsearch.cluster-nodes=localhost:9300</span><br><span class=\"line\">#spring.data.elasticsearch.cluster-name=elasticsearch</span><br><span class=\"line\"></span><br><span class=\"line\">## 新版本以spring.elasticsearch.rest.开头;访问地址配置需要声明访问协议,直接监听es访问端口</span><br><span class=\"line\">spring.elasticsearch.rest.uris=http://localhost:9200</span><br><span class=\"line\">spring.elasticsearch.rest.username=elasticsearch</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>使用</p>\n<ul>\n<li>\n<p>旧版的核心访问对象是 ElasticsearchTemplate；新版的核心访问对象是 ElasticsearchRestTemplate；</p>\n</li>\n<li>\n<p>实体类没有类型</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// @Document指定当前类是索引对象。indexName:索引名称;shards:创建索引时的分片数;replicas:创建索引时的备份数</span><br><span class=\"line\">@Document(indexName = &quot;book_&quot;, shards = 5, replicas = 1)</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ol>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/docker%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2rocketMQ/",
            "url": "http://example.com/2022/12/27/docker%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2rocketMQ/",
            "title": "docker简单部署rocketMQ",
            "date_published": "2022-12-27T08:18:48.552Z",
            "content_html": "<h1 id=\"docker简单部署rocketmq\"><a class=\"markdownIt-Anchor\" href=\"#docker简单部署rocketmq\">#</a> docker 简单部署 rocketMQ</h1>\n<p>1. 创建 namesrv 服务<br>\n拉取镜像</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull rocketmqinc/rocketmq</span><br></pre></td></tr></table></figure>\n<h3 id=\"创建namesrv数据存储路径\"><a class=\"markdownIt-Anchor\" href=\"#创建namesrv数据存储路径\">#</a> 创建 namesrv 数据存储路径</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir -p  /docker/rocketmq/data/namesrv/logs   /docker/rocketmq/data/namesrv/store</span><br></pre></td></tr></table></figure>\n<h3 id=\"构建namesrv容器\"><a class=\"markdownIt-Anchor\" href=\"#构建namesrv容器\">#</a> 构建 namesrv 容器</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">--name rmqnamesrv \\</span><br><span class=\"line\">-p 9876:9876 \\</span><br><span class=\"line\">-v /docker/rocketmq/data/namesrv/logs:/root/logs \\</span><br><span class=\"line\">-v /docker/rocketmq/data/namesrv/store:/root/store \\</span><br><span class=\"line\">-e &quot;MAX_POSSIBLE_HEAP=100000000&quot; \\</span><br><span class=\"line\">rocketmqinc/rocketmq \\</span><br><span class=\"line\">sh mqnamesrv </span><br></pre></td></tr></table></figure>\n<h1 id=\"2创建broker节点\"><a class=\"markdownIt-Anchor\" href=\"#2创建broker节点\">#</a> 2. 创建 broker 节点</h1>\n<h2 id=\"创建broker数据存储路径\"><a class=\"markdownIt-Anchor\" href=\"#创建broker数据存储路径\">#</a> 创建 broker 数据存储路径</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">mkdir</span> -p  /docker/rocketmq/data/broker/logs   /docker/rocketmq/data/broker/store /docker/rocketmq/conf</span><br></pre></td></tr></table></figure>\n<h2 id=\"创建配置文件\"><a class=\"markdownIt-Anchor\" href=\"#创建配置文件\">#</a> 创建配置文件</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /docker/rocketmq/conf/broker.conf</span><br><span class=\"line\"># 所属集群名称，如果节点较多可以配置多个</span><br><span class=\"line\">brokerClusterName = DefaultCluster</span><br><span class=\"line\">#broker名称，master和slave使用相同的名称，表明他们的主从关系</span><br><span class=\"line\">brokerName = broker-a</span><br><span class=\"line\">#0表示Master，大于0表示不同的slave</span><br><span class=\"line\">brokerId = 0</span><br><span class=\"line\">#表示几点做消息删除动作，默认是凌晨4点</span><br><span class=\"line\">deleteWhen = 04</span><br><span class=\"line\">#在磁盘上保留消息的时长，单位是小时</span><br><span class=\"line\">fileReservedTime = 48</span><br><span class=\"line\">#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；</span><br><span class=\"line\">brokerRole = ASYNC_MASTER</span><br><span class=\"line\">#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；</span><br><span class=\"line\">flushDiskType = ASYNC_FLUSH</span><br><span class=\"line\"># 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full</span><br><span class=\"line\">diskMaxUsedSpaceRatio=95</span><br><span class=\"line\"></span><br><span class=\"line\">namesrvAddr=【IP】:9876</span><br><span class=\"line\">brokerIP1 = 【IP】</span><br></pre></td></tr></table></figure>\n<h2 id=\"构建broker容器\"><a class=\"markdownIt-Anchor\" href=\"#构建broker容器\">#</a> 构建 broker 容器</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d  \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">--name rmqbroker \\</span><br><span class=\"line\">--link rmqnamesrv:namesrv \\</span><br><span class=\"line\">-p 10911:10911 \\</span><br><span class=\"line\">-p 10912:10912 \\</span><br><span class=\"line\">-p 10909:10909 \\</span><br><span class=\"line\">-v  /docker/rocketmq/data/broker/logs:/root/logs \\</span><br><span class=\"line\">-v  /docker/rocketmq/data/broker/store:/root/store \\</span><br><span class=\"line\">-v /docker/rocketmq/conf/broker.conf:/opt/rocketmq-4.4.0/conf/broker.conf \\</span><br><span class=\"line\">-e &quot;NAMESRV_ADDR= 43.143.40.221:9876&quot; \\</span><br><span class=\"line\">-e &quot;MAX_POSSIBLE_HEAP=200000000&quot; \\</span><br><span class=\"line\">rocketmqinc/rocketmq \\</span><br><span class=\"line\">sh mqbroker -c /opt/rocketmq-4.4.0/conf/broker.conf  </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"3创建rockermq-console服务\"><a class=\"markdownIt-Anchor\" href=\"#3创建rockermq-console服务\">#</a> 3. 创建 rockermq-console 服务</h1>\n<h2 id=\"拉取镜像\"><a class=\"markdownIt-Anchor\" href=\"#拉取镜像\">#</a> 拉取镜像</h2>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull pangliang/rocketmq-console-ng</span><br></pre></td></tr></table></figure>\n<h2 id=\"构建rockermq-console容器\"><a class=\"markdownIt-Anchor\" href=\"#构建rockermq-console容器\">#</a> 构建 rockermq-console 容器</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d \\</span><br><span class=\"line\">--restart=always \\</span><br><span class=\"line\">--name rmqadmin \\</span><br><span class=\"line\">-e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=43.143.40.221:9876 \\</span><br><span class=\"line\">-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; \\</span><br><span class=\"line\">-p 9877:8080 \\</span><br><span class=\"line\">pangliang/rocketmq-console-ng</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"关闭防火墙\"><a class=\"markdownIt-Anchor\" href=\"#关闭防火墙\">#</a> 关闭防火墙</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop firewalld.service</span><br></pre></td></tr></table></figure>\n<h3 id=\"开放指定端口\"><a class=\"markdownIt-Anchor\" href=\"#开放指定端口\">#</a> 开放指定端口</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --permanent --zone=public --add-port=9876/tcp</span><br><span class=\"line\">firewall-cmd --permanent --zone=public --add-port=10911/tcp</span><br><span class=\"line\">firewall-cmd --permanent --zone=public --add-port=10912/tcp</span><br><span class=\"line\"># 立即生效</span><br><span class=\"line\">firewall-cmd --reload</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"访问控制台\"><a class=\"markdownIt-Anchor\" href=\"#访问控制台\">#</a> 访问控制台</h2>\n<p>网页访问 http://【IP】:9999 / 查看控制台信息</p>\n<p><img data-src=\"https://brath.cloud/blogImg/20201013235856206.png\" alt=\"在这里插入图片描述\"></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Docker%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2Reids%E9%95%9C%E5%83%8F%E4%BD%9C%E4%B8%BA%E4%BB%8E%E8%8A%82%E7%82%B9/",
            "url": "http://example.com/2022/12/27/Docker%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2Reids%E9%95%9C%E5%83%8F%E4%BD%9C%E4%B8%BA%E4%BB%8E%E8%8A%82%E7%82%B9/",
            "title": "Docker环境部署Reids镜像作为从节点",
            "date_published": "2022-12-27T08:18:48.550Z",
            "content_html": "<h2 id=\"docker环境部署reids镜像作为从节点\"><a class=\"markdownIt-Anchor\" href=\"#docker环境部署reids镜像作为从节点\">#</a> Docker 环境部署 Reids 镜像作为从节点</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 拉取镜像</span><br><span class=\"line\">docker pull redis</span><br><span class=\"line\"></span><br><span class=\"line\"># 配置文件</span><br><span class=\"line\">本地：/mydata/redis/data/redis.conf 提前准备好</span><br><span class=\"line\">主要配置</span><br><span class=\"line\">bind 127.0.0.1 #注释掉这部分，使redis可以外部访问</span><br><span class=\"line\">daemonize no#用守护线程的方式启动</span><br><span class=\"line\">requirepass 你的密码#给redis设置密码</span><br><span class=\"line\">appendonly yes#redis持久化　　默认是no</span><br><span class=\"line\">tcp-keepalive 300 #防止出现远程主机强迫关闭了一个现有的连接的错误 默认是300</span><br><span class=\"line\"></span><br><span class=\"line\"># 创建实例并启动</span><br><span class=\"line\">docker run -p 6380:6379 --name redis -v /mydata/redis/data/redis.conf:/etc/redis/redis.conf  -v /mydata/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes</span><br></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85vim/",
            "url": "http://example.com/2022/12/27/Docker%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85vim/",
            "title": "Docker环境下安装vim",
            "date_published": "2022-12-27T08:18:48.548Z",
            "content_html": "<h2 id=\"docker环境下安装vim\"><a class=\"markdownIt-Anchor\" href=\"#docker环境下安装vim\">#</a> Docker 环境下安装 vim</h2>\n<p>在使用 docker 容器时，容器一般没有安装 vim，就需要安装 vim<br>\napt-get install vim 命令用于安装 vim，但是下载过慢。<br>\n第一步 配置国内镜像源<br>\n进入某个容器</p>\n<p>例如进入 mysql</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker exec -it mysql /bin/bash</span><br></pre></td></tr></table></figure>\n<p>第二步：更新源</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt update</span><br></pre></td></tr></table></figure>\n<p>第三步安装 vim</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install vim</span><br></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/CompletableFuture%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/",
            "url": "http://example.com/2022/12/27/CompletableFuture%E4%BD%BF%E7%94%A8%E6%96%87%E6%A1%A3/",
            "title": "CompletableFuture使用文档",
            "date_published": "2022-12-27T08:18:48.546Z",
            "content_html": "<p>背景：<br>\nCompletableFuture 字面翻译过来，就是 “可完成的 Future”。同传统的 Future 相比较，CompletableFuture 能够主动设置计算的结果值（主动终结计算过程，即 completable），从而在某些场景下主动结束阻塞等待。而 Future 由于不能主动设置计算结果值，一旦调用 get () 进行阻塞等待，要么当计算结果产生，要么超时，才会返回。</p>\n<p>CompletableFuture 说白了其实就是为了解决 Future 的问题（阻塞），而生！！！</p>\n<p>下面总结 CompletableFuture 的常用 api</p>\n<ol>\n<li>\n<p>创建 CompletableFuture<br>\n 实例方法：</p>\n<pre><code>//实例方法\nCompletableFuture&lt;String&gt; completableFutureOne = new CompletableFuture&lt;&gt;();\nSupplier&lt;?&gt; task=new Supplier&lt;Object&gt;() &#123;\n    @Override\n    public Object get() &#123;\n        return null;\n    &#125;\n&#125;;\nCompletableFuture&lt;?&gt; completableFuture = completableFutureOne.supplyAsync(task);\n</code></pre>\n</li>\n</ol>\n<p>静态方法：</p>\n<p>public static void main(String[] args) throws ExecutionException, InterruptedException {<br>\nRunnable runnable = () -&gt;<br>\nSystem.out.println (“执行无返回结果的异步任务”);<br>\nSystem.out.println(CompletableFuture.runAsync(runnable).get());</p>\n<pre><code>      CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;\n          System.out.println(&quot;执行有返回值的异步任务&quot;);\n          return &quot;Hello World&quot;;\n      &#125;);\n      String result = future.get();\n      System.out.println(result);\n  &#125;\n</code></pre>\n<h2 id=\"2-whencomplete-第一个任务结束对其结果处理handly的作用一样\"><a class=\"markdownIt-Anchor\" href=\"#2-whencomplete-第一个任务结束对其结果处理handly的作用一样\">#</a> 2、whenComplete - 第一个任务结束，对其结果处理 (handly 的作用一样)</h2>\n<p>结果处理就是当 future 任务完成时，对任务的结果做处理工作！或异常情况处理！</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class=\"line\">            try &#123;</span><br><span class=\"line\">                TimeUnit.SECONDS.sleep(1);</span><br><span class=\"line\">            &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            System.out.println(&quot;执行结束1！&quot;);</span><br><span class=\"line\">            return 5;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        future.whenComplete(new BiConsumer&lt;Integer, Throwable&gt;() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public void accept(Integer t, Throwable action) &#123;</span><br><span class=\"line\">                t=t+1;</span><br><span class=\"line\">//                int i = 12 / 0;</span><br><span class=\"line\">                System.out.println(&quot;执行完成2！&quot;+action.getMessage());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        .exceptionally(new Function&lt;Throwable, Integer&gt;() &#123;</span><br><span class=\"line\">            @Override</span><br><span class=\"line\">            public Integer apply(Throwable t) &#123;</span><br><span class=\"line\">                System.out.println(&quot;执行失败3：&quot; + t.getMessage());</span><br><span class=\"line\">                return null;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;).join();</span><br><span class=\"line\">        Integer integer = future.get();</span><br><span class=\"line\">        System.out.println(&quot;=&gt;integer&quot;+integer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>1、whenComplete 只是对任务运行结束后，拿到任务结果，做个处理，并且如果任务执行有异常，会监听到异常！<br>\n2、如果 whenComplete 本身有异常，那么需要单独加 exceptionally 来监听异常！<br>\n3、最终 future.get () 拿到的还是任务 1 的结果<br>\n 4、如果任务有异常，future.get () 拿到会抛出异常！</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行结束1！</span><br><span class=\"line\">执行失败3：java.lang.ArithmeticException: / by zero</span><br><span class=\"line\">Exception in thread &quot;main&quot; java.util.concurrent.ExecutionException: java.lang.ArithmeticException: / by zero</span><br><span class=\"line\">\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)</span><br><span class=\"line\">\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)</span><br><span class=\"line\">\tat top.lisicheng.wmd.CompleableFutureTest2.main(CompleableFutureTest2.java:83)</span><br><span class=\"line\">Caused by: java.lang.ArithmeticException: / by zero</span><br><span class=\"line\">\tat top.lisicheng.wmd.CompleableFutureTest2.lambda$main$0(CompleableFutureTest2.java:65)</span><br><span class=\"line\">\tat java.util.concurrent.CompletableFuture$AsyncSupply.run$$$capture(CompletableFuture.java:1590)</span><br><span class=\"line\">\tat java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java)</span><br><span class=\"line\">\tat java.util.concurrent.CompletableFuture$AsyncSupply.exec(CompletableFuture.java:1582)</span><br><span class=\"line\">\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)</span><br><span class=\"line\">\tat java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)</span><br><span class=\"line\">\tat java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)</span><br><span class=\"line\">\tat java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"3-thenapply-第一个任务结束可能还有第二-第三个任务且后面一个任务需要用到前面任务的返回值\"><a class=\"markdownIt-Anchor\" href=\"#3-thenapply-第一个任务结束可能还有第二-第三个任务且后面一个任务需要用到前面任务的返回值\">#</a> 3、thenApply - 第一个任务结束，可能还有第二、第三个任务，且后面一个任务，需要用到前面任务的返回值</h2>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void test4(String[] args) throws ExecutionException, InterruptedException &#123;</span><br><span class=\"line\">        /**</span><br><span class=\"line\">         * public &lt;U&gt; CompletableFuture&lt;U&gt; thenApply(Function&lt;? super T,? extends U&gt; fn)</span><br><span class=\"line\">         * public &lt;U&gt; CompletableFuture&lt;U&gt; thenApplyAsync(Function&lt;? super T,? extends U&gt; fn)</span><br><span class=\"line\">         * public &lt;U&gt; CompletableFuture&lt;U&gt; thenApplyAsync(Function&lt;? super T,? extends U&gt; fn, Executor executor)</span><br><span class=\"line\">         *  总结：thenApply 接收一个函数作为参数，使用该函数处理上一个CompletableFuture 调用的结果，</span><br><span class=\"line\">         *  并返回一个具有处理结果的Future对象。</span><br><span class=\"line\">         *</span><br><span class=\"line\">         */</span><br><span class=\"line\">        CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(() -&gt; &#123;</span><br><span class=\"line\">            int result = 100;</span><br><span class=\"line\">            System.out.println(&quot;一阶段：&quot; + result);</span><br><span class=\"line\">            return result;</span><br><span class=\"line\">        &#125;).thenApply(number -&gt; &#123;</span><br><span class=\"line\">            int result = number * 3;</span><br><span class=\"line\">            System.out.println(&quot;二阶段：&quot; + result);</span><br><span class=\"line\">            return result;</span><br><span class=\"line\">        &#125;).thenApply(number -&gt; &#123;</span><br><span class=\"line\">            int result = number * 3;</span><br><span class=\"line\">            System.out.println(&quot;三阶段：&quot; + result);</span><br><span class=\"line\">            return result;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(&quot;最终结果：&quot; + future.get());</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"4-thencompose-跟上面一样的作用\"><a class=\"markdownIt-Anchor\" href=\"#4-thencompose-跟上面一样的作用\">#</a> 4、thenCompose - 跟上面一样的作用：</h2>\n<p>thenCompose 的参数为一个返回 CompletableFuture 实例的函数，该函数的参数是先前计算步骤的结果。</p>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public &lt;U&gt; CompletableFuture&lt;U&gt; thenCompose(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn);</span><br><span class=\"line\">public &lt;U&gt; CompletableFuture&lt;U&gt; thenComposeAsync(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn) ;</span><br><span class=\"line\">public &lt;U&gt; CompletableFuture&lt;U&gt; thenComposeAsync(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn, Executor executor) ;</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">public static void main(String[] args) throws InterruptedException, ExecutionException &#123;</span><br><span class=\"line\">    CompletableFuture&lt;Integer&gt; future = CompletableFuture.supplyAsync(new Supplier&lt;Integer&gt;() &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public Integer get() &#123;</span><br><span class=\"line\">            int number = new Random().nextInt(3);</span><br><span class=\"line\">            System.out.println(&quot;第一阶段：&quot; + number);</span><br><span class=\"line\">            return number;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;).thenCompose(new Function&lt;Integer, CompletionStage&lt;Integer&gt;&gt;() &#123;</span><br><span class=\"line\">        @Override</span><br><span class=\"line\">        public CompletionStage&lt;Integer&gt; apply(Integer param) &#123;</span><br><span class=\"line\">            return CompletableFuture.supplyAsync(new Supplier&lt;Integer&gt;() &#123;</span><br><span class=\"line\">                @Override</span><br><span class=\"line\">                public Integer get() &#123;</span><br><span class=\"line\">                    int number = param * 2;</span><br><span class=\"line\">                    System.out.println(&quot;第二阶段：&quot; + number);</span><br><span class=\"line\">                    return number;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    System.out.println(&quot;最终结果: &quot; + future.get());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">那么 thenApply 和 thenCompose 有何区别呢：</span><br><span class=\"line\"></span><br><span class=\"line\">thenApply 转换的是泛型中的类型，返回的是同一个CompletableFuture；</span><br><span class=\"line\">thenCompose 将内部的 CompletableFuture 调用展开来并使用上一个CompletableFutre 调用的结果在下一步的 CompletableFuture 调用中进行运算，</span><br><span class=\"line\">是生成一个新的CompletableFuture。</span><br></pre></td></tr></table></figure>\n<p><strong>下面用一个例子对对比：</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) throws InterruptedException, ExecutionException &#123;</span><br><span class=\"line\">    CompletableFuture&lt;String&gt; future = CompletableFuture.supplyAsync(() -&gt; &quot;Hello&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">    CompletableFuture&lt;String&gt; result1 = future.thenApply(param -&gt; param + &quot; World&quot;);</span><br><span class=\"line\">    CompletableFuture&lt;String&gt; result2 = future.thenCompose(param -&gt; CompletableFuture.supplyAsync(() -&gt; param + &quot; World&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">    System.out.println(result1.get());</span><br><span class=\"line\">    System.out.println(result2.get());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"5-结果消费\"><a class=\"markdownIt-Anchor\" href=\"#5-结果消费\">#</a> 5、结果消费</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">thenAccept系列：对单个结果进行消费</span><br><span class=\"line\">thenAcceptBoth系列：对两个结果进行消费</span><br><span class=\"line\">thenRun系列：不关心结果，只对结果执行Action</span><br></pre></td></tr></table></figure>\n<p>只会拿到上个任务的值，然后对值进行消费，但是绝对不会产生新的值<br>\n这是跟上面任务中间 转换的，最大的区别</p>\n<p>消费结果还包括 thenRun<br>\nthenRun 跟 thenAccept 的区别是，它不仅不产生新的值，还不消费上个任务的值，只是自己做一个业务处理。</p>\n<p>6、结果组合<br>\n thenCombine - 合并两个线程任务的结果，并进一步处理。<br>\napplyToEither - 两个线程任务相比较，先获得执行结果的，就对该结果进行下一步的转化操作。<br>\nacceptEither - 两个线程任务相比较，先获得执行结果的，就对该结果进行下一步的消费操作。<br>\nrunAfterEither - 两个线程任务相比较，有任何一个执行完成，就进行下一步操作，不关心运行结果。<br>\nrunAfterBoth - 两个线程任务相比较，两个全部执行完成，才进行下一步操作，不关心运行结果。<br>\nanyOf-anyOf 方法的参数是多个给定的 CompletableFuture，当其中的任何一个完成时，方法返回这个 CompletableFuture。<br>\nallOf-allOf 方法用来实现多 CompletableFuture 的同时返回。</p>\n<p>代码实例</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@RestController</span><br><span class=\"line\">@RequestMapping(&quot;/test&quot;)</span><br><span class=\"line\">public class TestController &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static ExecutorService threadPool =</span><br><span class=\"line\">            new ThreadPoolExecutor(</span><br><span class=\"line\">                    10,</span><br><span class=\"line\">                    40,</span><br><span class=\"line\">                    20,</span><br><span class=\"line\">                    TimeUnit.SECONDS,</span><br><span class=\"line\">                    new ArrayBlockingQueue&lt;Runnable&gt;(</span><br><span class=\"line\">                            16</span><br><span class=\"line\">                    ));</span><br><span class=\"line\"></span><br><span class=\"line\">    /**</span><br><span class=\"line\">     * CompletableFuture 测试</span><br><span class=\"line\">     *</span><br><span class=\"line\">     * @return</span><br><span class=\"line\">     */</span><br><span class=\"line\">    @ApiOperation(&quot;CompletableFuture 测试&quot;)</span><br><span class=\"line\">    @PostMapping(&quot;test&quot;)</span><br><span class=\"line\">    public Object test() &#123;</span><br><span class=\"line\">        Map&lt;Object, Object&gt; result = new HashMap&lt;&gt;();</span><br><span class=\"line\">        CompletableFuture.allOf(</span><br><span class=\"line\">                CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(&quot;执行1&quot;);</span><br><span class=\"line\">                    result.put(&quot;key1&quot;, seslectData1());</span><br><span class=\"line\">                &#125;, threadPool),</span><br><span class=\"line\">                CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(&quot;执行2&quot;);</span><br><span class=\"line\">                    result.put(&quot;key2&quot;, seslectData2());</span><br><span class=\"line\">                &#125;, threadPool),</span><br><span class=\"line\">                CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class=\"line\">                    System.out.println(&quot;执行3&quot;);</span><br><span class=\"line\">                    result.put(&quot;key3&quot;, seslectData3());</span><br><span class=\"line\">                &#125;, threadPool)</span><br><span class=\"line\">        ).join();</span><br><span class=\"line\"></span><br><span class=\"line\">        return ResponseUtil.ok(result);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String seslectData1() &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            Thread.sleep(500);</span><br><span class=\"line\">        &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return &quot;key1&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String seslectData2() &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            Thread.sleep(500);</span><br><span class=\"line\">        &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return &quot;key2&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String seslectData3() &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">            Thread.sleep(300);</span><br><span class=\"line\">        &#125; catch (InterruptedException e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return &quot;key3&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/CAS%E6%9C%BA%E5%88%B6/",
            "url": "http://example.com/2022/12/27/CAS%E6%9C%BA%E5%88%B6/",
            "title": "CAS机制",
            "date_published": "2022-12-27T08:18:48.544Z",
            "content_html": "<h1 id=\"cas机制\"><a class=\"markdownIt-Anchor\" href=\"#cas机制\">#</a> CAS 机制</h1>\n<h3 id=\"我们先看一段代码\"><a class=\"markdownIt-Anchor\" href=\"#我们先看一段代码\">#</a> 我们先看一段代码：</h3>\n<p>启动两个线程，每个线程中让静态变量 count 循环累加 100 次。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312170840546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>最终输出的 count 结果一定是 200 吗？因为这段代码是非<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT0lRTclQkElQkYlRTclQTglOEIlRTUlQUUlODklRTUlODUlQTgmYW1wO3NwbT0xMDAxLjIxMDEuMzAwMS43MDIw\">线程安全</span>的，所以最终的自增结果很可能会小于 200。我们再加上 synchronized 同步锁，再来看一下。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312170827236?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>加了同步锁之后，count 自增的操作变成了原子性操作，所以最终输出一定是 count=200，代码实现了线程安全。虽然 synchronized 确保了线程安全，但是在某些情况下，这并不是一个最有的选择。</p>\n<p>关键在于性能问题。</p>\n<p>synchronized 关键字会让没有得到锁资源的线程进入 BLOCKED 状态，而后在争夺到锁资源后恢复为 RUNNABLE 状态，这个过程中涉及到操作系统用户模式和内核模式的转换，代价比较高。</p>\n<p>尽管 JAVA 1.6 为 synchronized 做了优化，增加了从偏向锁到轻量级锁再到重量级锁的过过度，但是在最终转变为重量级锁之后，性能仍然比较低。所以面对这种情况，我们就可以使用 java 中的 “原子操作类”。</p>\n<p>所谓原子操作类，指的是 java.util.concurrent.atomic 包下，一系列以 Atomic 开头的包装类。如 AtomicBoolean，AtomicUInteger，AtomicLong。它们分别用于 Boolean，Integer，Long 类型的原子性操作。</p>\n<p>现在我们尝试使用 AtomicInteger 类：</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312172106130?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>使用 AtomicInteger 之后，最终的输出结果同样可以保证是 200。并且在某些情况下，代码的性能会比 synchronized 更好。</p>\n<p>而 Atomic 操作类的底层正是用到了 “CAS 机制”。</p>\n<p>CAS 是英文单词 Compare and Swap 的缩写，翻译过来就是比较并替换。</p>\n<p>CAS 机制中使用了 3 个基本操作数：内存地址 V，旧的预期值 A，要修改的新值 B。</p>\n<p>更新一个变量的时候，只有当变量的预期值 A 和内存地址 V 当中的实际值相同时，才会将内存地址 V 对应的值修改为 B。</p>\n<p>我们看一个例子：</p>\n<p>\\1. 在内存地址 V 当中，存储着值为 10 的变量。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312172707148?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\2. 此时线程 1 想把变量的值增加 1. 对线程 1 来说，旧的预期值 A=10，要修改的新值 B=11.</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312172814864?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\3. 在线程 1 要提交更新之前，另一个线程 2 抢先一步，把内存地址 V 中的变量值率先更新成了 11。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312172943800?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\4. 线程 1 开始提交更新，首先进行 A 和地址 V 的实际值比较，发现 A 不等于 V 的实际值，提交失败。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312173045349?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\5. 线程 1 重新获取内存地址 V 的当前值，并重新计算想要修改的值。此时对线程 1 来说，A=11，B=12。这个重新尝试的过程被称为自旋。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312173220371?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\6. 这一次比较幸运，没有其他线程改变地址 V 的值。线程 1 进行比较，发现 A 和地址 V 的实际值是相等的。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312173331761?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>\\7. 线程 1 进行交换，把地址 V 的值替换为 B，也就是 12.</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312173421205?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>从思想上来说，synchronized 属于悲观锁，悲观的认为程序中的并发情况严重，所以严防死守，CAS 属于乐观锁，乐观地认为程序中的并发情况不那么严重，所以让线程不断去重试更新。</p>\n<p>在 java 中除了上面提到的 Atomic 系列类，以及 Lock 系列类夺得底层实现，甚至在 JAVA1.6 以上版本，synchronized 转变为重量级锁之前，也会采用 CAS 机制。</p>\n<p><strong>CAS 的缺点：</strong></p>\n<p>1） CPU 开销过大</p>\n<p>在并发量比较高的情况下，如果许多线程反复尝试更新某一个变量，却又一直更新不成功，循环往复，会给 CPU 带来很到的压力。</p>\n<p>2） 不能保证代码块的原子性</p>\n<p>CAS 机制所保证的知识一个变量的原子性操作，而不能保证整个代码块的原子性。比如需要保证 3 个变量共同进行原子性的更新，就不得不使用 synchronized 了。</p>\n<p>3） ABA 问题</p>\n<p>这是 CAS 机制最大的问题所在。（后面有介绍）</p>\n<p>我们下面来介绍一下两个问题：</p>\n<p><em><strong>*1. JAVA 中 CAS 的底层实现 *</strong></em></p>\n<p><em><strong>*2. CAS 的 ABA 问题和解决办法。*</strong></em></p>\n<p>我们看一下 AtomicInteger 当中常用的自增方法 incrementAndGet：</p>\n<p>public final int incrementAndGet() {</p>\n<p>for (;😉 {</p>\n<p>​    int current = get();</p>\n<p>​    int next = current + 1;</p>\n<p>​    if (compareAndSet(current, next))</p>\n<p>​      return next;</p>\n<p>}</p>\n<p>}</p>\n<p>private volatile int value;</p>\n<p>public final int get() {</p>\n<p>return value;</p>\n<p>}</p>\n<p>这段代码是一个无限循环，也就是 CAS 的自旋，循环体中做了三件事：</p>\n<p>\\1. 获取当前值</p>\n<p>\\2. 当前值 + 1，计算出目标值</p>\n<p>\\3. 进行 CAS 操作，如果成功则跳出循环，如果失败则重复上述步骤</p>\n<p>这里需要注意的重点是 get 方法，这个方法的作用是获取变量的当前值。</p>\n<p>如何保证获取的当前值是内存中的最新值？很简单，用 volatile 关键字来保证（保证线程间的可见性）。我们接下来看一下 compareAndSet 方法的实现：</p>\n<p><img data-src=\"https://img-blog.csdn.net/2018031217514825?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>compareAndSet 方法的实现很简单，只有一行代码。这里涉及到两个重要的对象，一个是 unsafe，一个是 valueOffset。</p>\n<p>什么是 unsafe 呢？Java 语言不像 C，C++ 那样可以直接访问底层操作系统，但是 JVM 为我们提供了一个后门，这个后门就是 unsafe。unsafe 为我们提供了硬件级别的原子操作。</p>\n<p>至于 valueOffset 对象，是通过 unsafe.objectFiledOffset 方法得到，所代表的是 AtomicInteger 对象 value 成员变量在内存中的偏移量。我们可以简单的把 valueOffset 理解为 value 变量的内存地址。</p>\n<p>我们上面说过，CAS 机制中使用了 3 个基本操作数：内存地址 V，旧的预期值 A，要修改的新值 B。</p>\n<p>而 unsafe 的 compareAndSwapInt 方法的参数包括了这三个基本元素：valueOffset 参数代表了 V，expect 参数代表了 A，update 参数代表了 B。</p>\n<p>正是 unsafe 的 compareAndSwapInt 方法保证了 Compare 和 Swap 操作之间的原子性操作。</p>\n<p>我们现在来说什么是 ABA 问题。假设内存中有一个值为 A 的变量，存储在地址 V 中。</p>\n<p><img data-src=\"https://img-blog.csdn.net/2018031218013467?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>此时有三个线程想使用 CAS 的方式更新这个变量的值，每个线程的执行时间有略微偏差。线程 1 和线程 2 已经获取当前值，线程 3 还未获取当前值。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312180247202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>接下来，线程 1 先一步执行成功，把当前值成功从 A 更新为 B；同时线程 2 因为某种原因被阻塞住，没有做更新操作；线程 3 在线程 1 更新之后，获取了当前值 B。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312180432152?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>在之后，线程 2 仍然处于阻塞状态，线程 3 继续执行，成功把当前值从 B 更新成了 A。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312180546889?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>最后，线程 2 终于恢复了运行状态，由于阻塞之前已经获得了 “当前值 A”，并且经过 compare 检测，内存地址 V 中的实际值也是 A，所以成功把变量值 A 更新成了 B。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312180729792?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>看起来这个例子没啥问题，但如果结合实际，就可以发现它的问题所在。</p>\n<p>我们假设一个提款机的例子。假设有一个遵循 CAS 原理的提款机，小灰有 100 元存款，要用这个提款机来提款 50 元。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312181342879?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>由于提款机硬件出了点问题，小灰的提款操作被同时提交了两次，开启了两个线程，两个线程都是获取当前值 100 元，要更新成 50 元。</p>\n<p>理想情况下，应该一个线程更新成功，一个线程更新失败，小灰的存款值被扣一次。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312181404403?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>线程 1 首先执行成功，把余额从 100 改成 50. 线程 2 因为某种原因阻塞。这时，小灰的妈妈刚好给小灰汇款 50 元。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312181531202?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>线程 2 仍然是阻塞状态，线程 3 执行成功，把余额从 50 改成了 100。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312181635868?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>线程 2 恢复运行，由于阻塞之前获得了 “当前值” 100，并且经过 compare 检测，此时存款实际值也是 100，所以会成功把变量值 100 更新成 50。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312181813320?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>原本线程 2 应当提交失败，小灰的正确余额应该保持 100 元，结果由于 ABA 问题提交成功了。</p>\n<p>怎么解决呢？加个版本号就可以了。</p>\n<p>真正要做到严谨的 CAS 机制，我们在 compare 阶段不仅要比较期望值 A 和地址 V 中的实际值，还要比较变量的版本号是否一致。</p>\n<p>我们仍然以刚才的例子来说明，假设地址 V 中存储着变量值 A，当前版本号是 01。线程 1 获取了当前值 A 和版本号 01，想要更新为 B，但是被阻塞了。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312182255181?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>这时候，内存地址 V 中变量发生了多次改变，版本号提升为 03，但是变量值仍然是 A。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312182346458?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>随后线程 1 恢复运行，进行 compare 操作。经过比较，线程 1 所获得的值和地址的实际值都是 A，但是版本号不相等，所以这一次更新失败。</p>\n<p><img data-src=\"https://img-blog.csdn.net/20180312182506360?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzI5OTgxNTM=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70\" alt=\"img\"></p>\n<p>在 Java 中，AtomicStampedReference 类就实现了用版本号作比较额 CAS 机制。</p>\n<p><em><strong>*1. java 语言 CAS 底层如何实现？*</strong></em></p>\n<p><em><strong>* 利用 unsafe 提供的原子性操作方法。*</strong></em></p>\n<p><em><strong>*2. 什么事 ABA 问题？怎么解决？*</strong></em></p>\n<p><em><strong>* 当一个值从 A 变成 B，又更新回 A，普通 CAS 机制会误判通过检测。*</strong></em></p>\n<p><em><strong>* 利用版本号比较可以有效解决 ABA 问题。*</strong></em></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/CAS-ABA%E9%97%AE%E9%A2%98/",
            "url": "http://example.com/2022/12/27/CAS-ABA%E9%97%AE%E9%A2%98/",
            "title": "CAS-ABA问题",
            "date_published": "2022-12-27T08:18:48.542Z",
            "content_html": "<h1 id=\"cas-aba问题\"><a class=\"markdownIt-Anchor\" href=\"#cas-aba问题\">#</a> CAS-ABA 问题</h1>\n<h2 id=\"一概述\"><a class=\"markdownIt-Anchor\" href=\"#一概述\">#</a> 一。概述：</h2>\n<p>​\t\tABA 问题是在多线程并发的情况下，发生的一种现象。上一次记录了有关 CAS 操作的一些知识，CAS 通过比较内存中的一个数据是否是预期值，如果是就将它修改成新值，如果不是则进行自旋，重复比较的操作，直到某一刻内存值等于预期值再进行修改。而 ABA 问题则是在 CAS 操作中存在的一个经典问题，这个问题某些时候不会带来任何影响，某些时候却是影响很大的。</p>\n<h2 id=\"二什么是aba问题\"><a class=\"markdownIt-Anchor\" href=\"#二什么是aba问题\">#</a> 二。什么是 ABA 问题？</h2>\n<h4 id=\"理解一\"><a class=\"markdownIt-Anchor\" href=\"#理解一\">#</a> 理解一：</h4>\n<p>​\t\t当执行 campare and swap 会出现失败的情况。例如，一个线程先读取共享内存数据值 A，随后因某种原因，线程暂时挂起，同时另一个线程临时将共享内存数据值先改为 B，随后又改回为 A。随后挂起线程恢复，并通过 CAS 比较，最终比较结果将会无变化。这样会通过检查，这就是 ABA 问题。 在 CAS 比较前会读取原始数据，随后进行原子 CAS 操作。这个间隙之间由于并发操作，最终可能会带来问题。</p>\n<h4 id=\"理解二\"><a class=\"markdownIt-Anchor\" href=\"#理解二\">#</a> <strong>理解二:</strong></h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20181231131658183.png\" alt=\"\"></p>\n<p>“ABA” 问题：假设 t1 线程工作时间为 10 秒，t2 线程工作时间为 2 秒，那么可能在 A 的工作期间，主内存中的共享变量 A 已经被 t2 线程修改了多次，只是恰好最后一次修改的值是该变量的初始值，虽然用 CAS 判定出来的结果是期望值，但是却不是原来那个了 =======》“狸猫换太子”<br>\n 相当于是只关心共享变量的起始值和结束值，而不关心过程中共享变量是否被其他线程动过。<br>\n有些业务可能不需要关心中间过程，只要前后值一样就行，但是有些业务需求要求变量在中间过程不能被修改。</p>\n<p>只靠 CAS 无法保证 ABA 问题，需要使用 “原子引用” 才能解决！！！！</p>\n<h1 id=\"三aba问题的解决\"><a class=\"markdownIt-Anchor\" href=\"#三aba问题的解决\">#</a> 三.ABA 问题的解决：</h1>\n<h2 id=\"原子引用存在aba问题\"><a class=\"markdownIt-Anchor\" href=\"#原子引用存在aba问题\">#</a> 原子引用：（存在 ABA 问题）</h2>\n<p>案例：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">package</span> InterviewTest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">User</span>&#123;</span><br><span class=\"line\">\t String name;</span><br><span class=\"line\">\t <span class=\"type\">int</span> age;</span><br><span class=\"line\">\t </span><br><span class=\"line\">\t <span class=\"keyword\">public</span> <span class=\"title function_\">User</span><span class=\"params\">(String name,<span class=\"type\">int</span> age)</span> &#123;</span><br><span class=\"line\">\t\t <span class=\"built_in\">this</span>.name=name;</span><br><span class=\"line\">\t\t <span class=\"built_in\">this</span>.age=age;</span><br><span class=\"line\">\t &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String <span class=\"title function_\">toString</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"string\">&quot;User [name=&quot;</span> + name + <span class=\"string\">&quot;, age=&quot;</span> + age + <span class=\"string\">&quot;]&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String <span class=\"title function_\">getName</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> name;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">getAge</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> age;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setAge</span><span class=\"params\">(<span class=\"type\">int</span> age)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AtomicReferenceDemo</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">User</span> <span class=\"variable\">z3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;z3&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">\t\t<span class=\"type\">User</span> <span class=\"variable\">li4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;li4&quot;</span>,<span class=\"number\">25</span>);</span><br><span class=\"line\">\t\tAtomicReference&lt;User&gt; atomicReference  = <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicReference</span>&lt;&gt;();</span><br><span class=\"line\">\t\tatomicReference.set(z3);</span><br><span class=\"line\">\t\tSystem.out.println(atomicReference);</span><br><span class=\"line\">\t\tSystem.out.println(atomicReference.compareAndSet(z3, li4)+</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"string\">&quot;       &quot;</span>+atomicReference.get().toString());</span><br><span class=\"line\">\t\tSystem.out.println(atomicReference.compareAndSet(li4, z3)+</span><br><span class=\"line\">\t\t\t\t<span class=\"string\">&quot;       &quot;</span>+atomicReference.get().toString());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"带版本号的原子引用解决aba问题\"><a class=\"markdownIt-Anchor\" href=\"#带版本号的原子引用解决aba问题\">#</a> 带版本号的原子引用（解决 ABA 问题）</h2>\n<p><strong>AtomicStampedReference 版本号原子引用：</strong><br>\n<strong>案例：两种原子引用的对比</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">package</span> InterviewTest;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.atomic.AtomicStampedReference;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ABADemo</span> &#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> AtomicReference&lt;Integer&gt; atomicReference </span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t= <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicReference</span>&lt;&gt;(<span class=\"number\">100</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">static</span> AtomicStampedReference&lt;Integer&gt;  atomicStampedReference </span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t= <span class=\"keyword\">new</span> <span class=\"title class_\">AtomicStampedReference</span>&lt;&gt;(<span class=\"number\">100</span>,<span class=\"number\">1</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;************以下是ABA问题的产生**************&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">\t\t\tatomicReference.compareAndSet(<span class=\"number\">100</span>, <span class=\"number\">101</span>);</span><br><span class=\"line\">\t\t\tatomicReference.compareAndSet(<span class=\"number\">101</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">\t\t&#125;,<span class=\"string\">&quot;t1&quot;</span>).start();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tSystem.out.println(atomicReference.compareAndSet(<span class=\"number\">100</span>, <span class=\"number\">2019</span>)</span><br><span class=\"line\">\t\t\t\t\t+<span class=\"string\">&quot;   &quot;</span>+atomicReference.get());</span><br><span class=\"line\">\t\t&#125;,<span class=\"string\">&quot;t2&quot;</span>).start();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tThread.sleep(<span class=\"number\">2000</span>);</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tSystem.out.println(<span class=\"string\">&quot;************以下是ABA问题的解决**************&quot;</span>);</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">int</span> <span class=\"variable\">stamp</span> <span class=\"operator\">=</span> atomicStampedReference.getStamp();</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()</span><br><span class=\"line\">\t\t\t\t\t+<span class=\"string\">&quot;  &quot;</span>+<span class=\"string\">&quot;   第一次版本号：&quot;</span>+stamp);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\tatomicStampedReference.compareAndSet(<span class=\"number\">100</span>, </span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"number\">101</span>, </span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\tatomicStampedReference.getStamp(),</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\tatomicStampedReference.getStamp()+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()</span><br><span class=\"line\">\t\t\t\t\t+<span class=\"string\">&quot;  &quot;</span>+<span class=\"string\">&quot;   第2次版本号：&quot;</span>+atomicStampedReference.getStamp());</span><br><span class=\"line\">\t\t\tatomicStampedReference.compareAndSet(<span class=\"number\">101</span>, </span><br><span class=\"line\">\t\t\t\t\t<span class=\"number\">100</span>, </span><br><span class=\"line\">\t\t\t\t\tatomicStampedReference.getStamp(),</span><br><span class=\"line\">\t\t\t\t\tatomicStampedReference.getStamp()+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()</span><br><span class=\"line\">\t\t\t\t\t+<span class=\"string\">&quot;  &quot;</span>+<span class=\"string\">&quot;   第3次版本号：&quot;</span>+atomicStampedReference.getStamp());</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;,<span class=\"string\">&quot;t3&quot;</span>).start();</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">int</span> <span class=\"variable\">stamp</span> <span class=\"operator\">=</span> atomicStampedReference.getStamp();</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()</span><br><span class=\"line\">\t\t\t\t\t+<span class=\"string\">&quot;  &quot;</span>+<span class=\"string\">&quot;   第一次版本号：&quot;</span>+stamp);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\tThread.sleep(<span class=\"number\">3000</span>);</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">\t\t\t\te.printStackTrace();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t<span class=\"type\">boolean</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span>  atomicStampedReference.compareAndSet(</span><br><span class=\"line\">\t\t\t\t\t<span class=\"number\">100</span>, </span><br><span class=\"line\">\t\t\t\t\t<span class=\"number\">2019</span>, </span><br><span class=\"line\">\t\t\t\t\tstamp, </span><br><span class=\"line\">\t\t\t\t\tstamp+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()+</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">&quot;  修改成功否：&quot;</span>+result+<span class=\"string\">&quot;  当前最新实际版本号：&quot;</span></span><br><span class=\"line\">\t\t\t\t\t+atomicStampedReference.getStamp());</span><br><span class=\"line\">\t\t\tSystem.out.println(Thread.currentThread().getName()+</span><br><span class=\"line\">\t\t\t\t\t<span class=\"string\">&quot;  当前实际最新值：&quot;</span></span><br><span class=\"line\">\t\t\t\t\t+atomicStampedReference.getReference());</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;,<span class=\"string\">&quot;t4&quot;</span>).start();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">输出:</span><br><span class=\"line\">************以下是ABA问题的产生**************</span><br><span class=\"line\"><span class=\"literal\">true</span>   <span class=\"number\">2019</span></span><br><span class=\"line\">************以下是ABA问题的解决**************</span><br><span class=\"line\">t3     第一次版本号：<span class=\"number\">1</span></span><br><span class=\"line\">t4     第一次版本号：<span class=\"number\">1</span></span><br><span class=\"line\">t3     第<span class=\"number\">2</span>次版本号：<span class=\"number\">2</span></span><br><span class=\"line\">t3     第<span class=\"number\">3</span>次版本号：<span class=\"number\">3</span></span><br><span class=\"line\">t4  修改成功否：<span class=\"literal\">false</span>  当前最新实际版本号：<span class=\"number\">3</span></span><br><span class=\"line\">t4  当前实际最新值：<span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/Alibaba%E5%88%86%E5%B1%82%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B%E8%A7%84%E7%BA%A6/",
            "url": "http://example.com/2022/12/27/Alibaba%E5%88%86%E5%B1%82%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B%E8%A7%84%E7%BA%A6/",
            "title": "阿里巴巴Java开发手册中的DO、DTO、BO、AO、VO、POJO定义",
            "date_published": "2022-12-27T08:18:48.539Z",
            "content_html": "<p>分层领域模型规约：</p>\n<p>DO（ Data Object）：与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。<br>\nDTO（ Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。<br>\nBO（ Business Object）：业务对象。 由 Service 层输出的封装业务逻辑的对象。<br>\nAO（ Application Object）：应用对象。 在 Web 层与 Service 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。<br>\nVO（ View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。<br>\nPOJO（ Plain Ordinary Java Object）：在本手册中， POJO 专指只有 setter/getter/toString 的简单类，包括 DO/DTO/BO/VO 等。<br>\nQuery：数据查询对象，各层接收上层的查询请求。 注意超过 2 个参数的查询封装，禁止使用 Map 类来传输。<br>\n领域模型命名规约：</p>\n<p>数据对象：xxxDO，xxx 即为数据表名。<br>\n数据传输对象：xxxDTO，xxx 为业务领域相关的名称。<br>\n展示对象：xxxVO，xxx 一般为网页名称。<br>\nPOJO 是 DO/DTO/BO/VO 的统称，禁止命名成 xxxPOJO。</p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/12/27/hello-world/",
            "url": "http://example.com/2022/12/27/hello-world/",
            "title": "Hello World",
            "date_published": "2022-12-27T06:56:58.937Z",
            "content_html": "<p>Welcome to <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvLw==\">Hexo</span>! This is your very first post. Check <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mv\">documentation</span> for more info. If you get any problems when using Hexo, you can find the answer in <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvdHJvdWJsZXNob290aW5nLmh0bWw=\">troubleshooting</span> or you can ask me on <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2hleG9qcy9oZXhvL2lzc3Vlcw==\">GitHub</span>.</p>\n<h2 id=\"quick-start\"><a class=\"markdownIt-Anchor\" href=\"#quick-start\">#</a> Quick Start</h2>\n<h3 id=\"create-a-new-post\"><a class=\"markdownIt-Anchor\" href=\"#create-a-new-post\">#</a> Create a new post</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvd3JpdGluZy5odG1s\">Writing</span></p>\n<h3 id=\"run-server\"><a class=\"markdownIt-Anchor\" href=\"#run-server\">#</a> Run server</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvc2VydmVyLmh0bWw=\">Server</span></p>\n<h3 id=\"generate-static-files\"><a class=\"markdownIt-Anchor\" href=\"#generate-static-files\">#</a> Generate static files</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3MvZ2VuZXJhdGluZy5odG1s\">Generating</span></p>\n<h3 id=\"deploy-to-remote-sites\"><a class=\"markdownIt-Anchor\" href=\"#deploy-to-remote-sites\">#</a> Deploy to remote sites</h3>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n<p>More info: <span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL2RvY3Mvb25lLWNvbW1hbmQtZGVwbG95bWVudC5odG1s\">Deployment</span></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/11/24/Docker%E7%94%A8%E6%B3%95%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/",
            "url": "http://example.com/2022/11/24/Docker%E7%94%A8%E6%B3%95%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/",
            "title": "Docker的基础用法",
            "date_published": "2022-11-24T05:13:10.754Z",
            "content_html": "<h1 id=\"1-docker架构\"><a class=\"markdownIt-Anchor\" href=\"#1-docker架构\">#</a> 1 Docker 架构</h1>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/60e8fc2bc92e48d0b96c0eaf079483c6.png\" alt=\"在这里插入图片描述\"></p>\n<p>镜像 (Image)：Docker 镜像 (Image)，就相当于是 一个 root 文件系统。比如官方镜像 ubuntu:16.04 就包 含了完整的一套 Ubuntu16.04 最小系统的 root 文件系统。<br>\n容器 (Container)：镜像 (Image) 和容器 (Contain er) 的关系，就像是面向对象程序设计中的类和对象一 样，镜像是静态的定义，容器是镜像运行时的实体。容 器可以被创建、启动、停止、删除、暂停等。<br>\n仓库 (Repository)：仓库可看成一个代码控制中心， 用来保存镜像</p>\n<h1 id=\"2-docker镜像与镜像仓库\"><a class=\"markdownIt-Anchor\" href=\"#2-docker镜像与镜像仓库\">#</a> 2 Docker 镜像与镜像仓库</h1>\n<p>在 docker 中仓库的名字是以应用的名称取名的。</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183520743.jpg\" alt=\"在这里插入图片描述\"></p>\n<p>镜像是静态的，而容器是动态的，容器有其生命周期，镜像与容器的关系类似于程序与进程的关系。镜像类似于文件系统中的程序文件，而容器则类似于将一个程序运行起来的状态，也即进程。所以容器是可以删除的，容器被删除后其镜像是不会被删除的。</p>\n<h1 id=\"3-docker对象\"><a class=\"markdownIt-Anchor\" href=\"#3-docker对象\">#</a> 3 Docker 对象</h1>\n<p>When you use docker, you are creating and using images, containers, networks, volumes, pluginns, and other objects.(当你使用 docker 时，你正在创建和使用镜像、容器、网络、卷、插件和其他对象)</p>\n<p>IMAGES (镜像)</p>\n<p>An image is a read-only template with instructions for creating a docker container.(镜像是一个只读模板，它带有创建 docker 容器的指令。)<br>\n Often, an image is based on another image, with some additional customization.(通常，一个镜像基于另一个镜像，并带有一些额外的自定义。)<br>\n You might create your own images or you might only use those created by others and published in a registry.(您可以创建自己的镜像，也可以使用其他人创建并在仓库中发布的镜像。)<br>\n CONTAINERS (容器)</p>\n<p>A conntainer is a runnable instance of an image.(容器是镜像的可运行实例。)<br>\n You can create, run, stop, move, or delete a container using the docker API or CLI.(您可以通过 docker API 或 CLI 创建、运行、停止、移动或删除容器。)<br>\n You can connect a container to one or more networks, attach storage to it, or even create a new image based on its current state.(您可以将容器连接到一个或多个网络，为其附加存储，甚至可以根据其当前状态创建新镜像。)</p>\n<h1 id=\"4-docker安装及使用\"><a class=\"markdownIt-Anchor\" href=\"#4-docker安装及使用\">#</a> 4 Docker 安装及使用</h1>\n<p>4.1 Docker 安装</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\">[root@Docker ~]# sed -i &#x27;s@https://download.docker.com@https://mirrors.tuna.tsinghua.edu.cn/docker-ce@g&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class=\"line\">[root@Docker ~]# yum clean all</span><br><span class=\"line\">21 文件已删除</span><br><span class=\"line\">[root@Docker ~]# yum -y install docker-ce</span><br></pre></td></tr></table></figure>\n<h1 id=\"42-docker加速\"><a class=\"markdownIt-Anchor\" href=\"#42-docker加速\">#</a> 4.2 Docker 加速</h1>\n<p>为什么需要加速器？因为 docker 在拉取镜像时，是去国外拉取的所以会比较慢，使用加速器可以解决这个问题</p>\n<p>docker-ce 的配置文件是 /etc/docker/daemon.json，此文件默认不存在，需要我们手动创建并进行配置，而 docker 的加速就是通过配置此文件来实现的</p>\n<h4 id=\"docker的加速有多种方式\"><a class=\"markdownIt-Anchor\" href=\"#docker的加速有多种方式\">#</a> docker 的加速有多种方式</h4>\n<ul>\n<li>docker cn</li>\n<li>中国科技大学加速器</li>\n<li>阿里云加速器（需要通过阿里云开发者平台注册帐号，免费使用个人私有的加速器）</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# systemctl enable --now docker    //启动docker服务</span><br><span class=\"line\">Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/lib/systemd/system/docker.service.</span><br><span class=\"line\">[root@Docker ~]# cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">     &quot;registry-mirrors&quot;: [&quot;https://xj3hc284.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">[root@Docker ~]# systemctl daemon-reload</span><br><span class=\"line\">[root@Docker ~]# systemctl restart docker    //重启docker服务</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"43-docker常用操作\"><a class=\"markdownIt-Anchor\" href=\"#43-docker常用操作\">#</a> 4.3 Docker 常用操作</h2>\n<h3 id=\"431-docker-version查看版本号\"><a class=\"markdownIt-Anchor\" href=\"#431-docker-version查看版本号\">#</a> 4.3.1 docker version (查看版本号)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker version</span><br><span class=\"line\">Client: Docker Engine - Community    //docker客户端版本</span><br><span class=\"line\"> Version:           20.10.11</span><br><span class=\"line\"> API version:       1.41</span><br><span class=\"line\"> Go version:        go1.16.9</span><br><span class=\"line\"> Git commit:        dea9396</span><br><span class=\"line\"> Built:             Thu Nov 18 00:36:58 2021</span><br><span class=\"line\"> OS/Arch:           linux/amd64</span><br><span class=\"line\"> Context:           default</span><br><span class=\"line\"> Experimental:      true</span><br><span class=\"line\"></span><br><span class=\"line\">Server: Docker Engine - Community    //docker服务端版本</span><br><span class=\"line\"> Engine:</span><br><span class=\"line\">  Version:          20.10.11</span><br><span class=\"line\">  API version:      1.41 (minimum version 1.12)</span><br><span class=\"line\">  Go version:       go1.16.9</span><br><span class=\"line\">  Git commit:       847da18</span><br><span class=\"line\">  Built:            Thu Nov 18 00:35:20 2021</span><br><span class=\"line\">  OS/Arch:          linux/amd64</span><br><span class=\"line\">  Experimental:     false</span><br><span class=\"line\"> containerd:    //容器版本</span><br><span class=\"line\">  Version:          1.4.12</span><br><span class=\"line\">  GitCommit:        7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class=\"line\"> runc:</span><br><span class=\"line\">  Version:          1.0.2</span><br><span class=\"line\">  GitCommit:        v1.0.2-0-g52b36a2</span><br><span class=\"line\"> docker-init:    //docker初始化版本</span><br><span class=\"line\">  Version:          0.19.0</span><br><span class=\"line\">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>\n<h3 id=\"432-docker-info显示整个系统的信息\"><a class=\"markdownIt-Anchor\" href=\"#432-docker-info显示整个系统的信息\">#</a> 4.3.2 docker info (显示整个系统的信息)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker info</span><br><span class=\"line\">Client:        #docker客户端版本信息</span><br><span class=\"line\"> Context:    default        #上下文</span><br><span class=\"line\"> Debug Mode: false</span><br><span class=\"line\"> Plugins:        #插件</span><br><span class=\"line\">  app: Docker App (Docker Inc., v0.9.1-beta3)</span><br><span class=\"line\">  buildx: Build with BuildKit (Docker Inc., v0.6.3-docker)</span><br><span class=\"line\">  scan: Docker Scan (Docker Inc., v0.9.0)</span><br><span class=\"line\"></span><br><span class=\"line\">Server:        #docker服务端版本信息</span><br><span class=\"line\"> Containers: 0        #容器个数</span><br><span class=\"line\">  Running: 0        #运行个数</span><br><span class=\"line\">  Paused: 0        #暂停状态个数</span><br><span class=\"line\">  Stopped: 0        #停止状态个数</span><br><span class=\"line\"> Images: 0        #镜像个数</span><br><span class=\"line\"> Server Version: 20.10.11        #服务版本号</span><br><span class=\"line\"> Storage Driver: overlay2        #存储驱动</span><br><span class=\"line\">  Backing Filesystem: xfs        #后端文件系统</span><br><span class=\"line\">  Supports d_type: true</span><br><span class=\"line\">  Native Overlay Diff: true</span><br><span class=\"line\">  userxattr: false</span><br><span class=\"line\"> Logging Driver: json-file        # 日志驱动</span><br><span class=\"line\"> Cgroup Driver: cgroupfs</span><br><span class=\"line\"> Cgroup Version: 1</span><br><span class=\"line\"> Plugins:        # 插件</span><br><span class=\"line\">  Volume: local</span><br><span class=\"line\">  Network: bridge host ipvlan macvlan null overlay</span><br><span class=\"line\">  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog</span><br><span class=\"line\"> Swarm: inactive</span><br><span class=\"line\"> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc</span><br><span class=\"line\"> Default Runtime: runc</span><br><span class=\"line\"> Init Binary: docker-init</span><br><span class=\"line\"> containerd version: 7b11cfaabd73bb80907dd23182b9347b4245eb5d</span><br><span class=\"line\"> runc version: v1.0.2-0-g52b36a2</span><br><span class=\"line\"> init version: de40ad0</span><br><span class=\"line\"> Security Options:        # 安全选项</span><br><span class=\"line\">  seccomp</span><br><span class=\"line\">   Profile: default</span><br><span class=\"line\"> Kernel Version: 4.18.0-257.el8.x86_64        # 内核版本号</span><br><span class=\"line\"> Operating System: CentOS Stream 8        # 操作系统</span><br><span class=\"line\"> OSType: linux        #操作系统 类型</span><br><span class=\"line\"> Architecture: x86_64        #架构</span><br><span class=\"line\"> CPUs: 4        # CPU核心数</span><br><span class=\"line\"> Total Memory: 7.559GiB        #总内存 </span><br><span class=\"line\"> Name: Docker</span><br><span class=\"line\"> ID: 4MEZ:OEWB:CPHP:3PYE:54J3:46XO:B5CX:JHYB:OW5Q:TWJP:PWHO:JJSM           </span><br><span class=\"line\"> Docker Root Dir: /var/lib/docker        #docker默认目录</span><br><span class=\"line\"> Debug Mode: false</span><br><span class=\"line\"> Registry: https://index.docker.io/v1/        # 仓库地址</span><br><span class=\"line\"> Labels:        #标签</span><br><span class=\"line\"> Experimental: false</span><br><span class=\"line\"> Insecure Registries:</span><br><span class=\"line\">  127.0.0.0/8</span><br><span class=\"line\"> Registry Mirrors:        #加速器</span><br><span class=\"line\">  https://xj3hc284.mirror.aliyuncs.com/</span><br><span class=\"line\"> Live Restore Enabled: false</span><br></pre></td></tr></table></figure>\n<h3 id=\"433-docker-search在docker-hub中搜索镜像\"><a class=\"markdownIt-Anchor\" href=\"#433-docker-search在docker-hub中搜索镜像\">#</a> 4.3.3 docker search (在 docker hub 中搜索镜像)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker search nginx</span><br><span class=\"line\">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class=\"line\">nginx                             Official build of Nginx.                        15893     [OK]       </span><br><span class=\"line\">jwilder/nginx-proxy               Automated Nginx reverse proxy for docker con…   2098                 [OK]</span><br><span class=\"line\">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   819                  [OK]</span><br><span class=\"line\">jc21/nginx-proxy-manager          Docker container for managing Nginx proxy ho…   285                  </span><br><span class=\"line\">linuxserver/nginx                 An Nginx container, brought to you by LinuxS…   160                  </span><br><span class=\"line\">tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp…   146                  [OK]</span><br><span class=\"line\">jlesage/nginx-proxy-manager       Docker container for Nginx Proxy Manager        144                  [OK]</span><br><span class=\"line\">alfg/nginx-rtmp                   NGINX, nginx-rtmp-module and FFmpeg from sou…   110                  [OK]</span><br><span class=\"line\">nginxdemos/hello                  NGINX webserver that serves a simple page co…   79                   [OK]</span><br><span class=\"line\">privatebin/nginx-fpm-alpine       PrivateBin running on an Nginx, php-fpm &amp; Al…   60                   [OK]</span><br><span class=\"line\">nginx/nginx-ingress               NGINX and  NGINX Plus Ingress Controllers fo…   57                   </span><br><span class=\"line\">nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles                  54                   </span><br><span class=\"line\">nginxproxy/nginx-proxy            Automated Nginx reverse proxy for docker con…   28                   </span><br><span class=\"line\">staticfloat/nginx-certbot         Opinionated setup for automatic TLS certs lo…   25                   [OK]</span><br><span class=\"line\">nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter for NGINX and NGIN…   22                   </span><br><span class=\"line\">schmunk42/nginx-redirect          A very simple container to redirect HTTP tra…   19                   [OK]</span><br><span class=\"line\">centos/nginx-112-centos7          Platform for running nginx 1.12 or building …   16                   </span><br><span class=\"line\">centos/nginx-18-centos7           Platform for running nginx 1.8 or building n…   13                   </span><br><span class=\"line\">flashspys/nginx-static            Super Lightweight Nginx Image                   11                   [OK]</span><br><span class=\"line\">bitwarden/nginx                   The Bitwarden nginx web server acting as a r…   11                   </span><br><span class=\"line\">mailu/nginx                       Mailu nginx frontend                            9                    [OK]</span><br><span class=\"line\">sophos/nginx-vts-exporter         Simple server that scrapes Nginx vts stats a…   7                    [OK]</span><br><span class=\"line\">ansibleplaybookbundle/nginx-apb   An APB to deploy NGINX                          3                    [OK]</span><br><span class=\"line\">arnau/nginx-gate                  Docker image with Nginx with Lua enabled on …   1                    [OK]</span><br><span class=\"line\">wodby/nginx                       Generic nginx                                   1                    [OK]</span><br></pre></td></tr></table></figure>\n<h3 id=\"434-docker-pull拉取镜像\"><a class=\"markdownIt-Anchor\" href=\"#434-docker-pull拉取镜像\">#</a> 4.3.4 docker pull (拉取镜像)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker pull nginx</span><br><span class=\"line\">Using default tag: latest</span><br><span class=\"line\">latest: Pulling from library/nginx</span><br><span class=\"line\">eff15d958d66: Pull complete </span><br><span class=\"line\">1e5351450a59: Pull complete </span><br><span class=\"line\">2df63e6ce2be: Pull complete </span><br><span class=\"line\">9171c7ae368c: Pull complete </span><br><span class=\"line\">020f975acd28: Pull complete </span><br><span class=\"line\">266f639b35ad: Pull complete </span><br><span class=\"line\">Digest: sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e</span><br><span class=\"line\">Status: Downloaded newer image for nginx:latest</span><br><span class=\"line\">docker.io/library/nginx:latest</span><br></pre></td></tr></table></figure>\n<h3 id=\"435-docker-images列出系统当前镜像\"><a class=\"markdownIt-Anchor\" href=\"#435-docker-images列出系统当前镜像\">#</a> 4.3.5 docker images (列出系统当前镜像)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker images</span><br><span class=\"line\">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>\n<h3 id=\"436-docker-image-history查看指定镜像的历史\"><a class=\"markdownIt-Anchor\" href=\"#436-docker-image-history查看指定镜像的历史\">#</a> 4.3.6 docker image history (查看指定镜像的历史)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker image history nginx</span><br><span class=\"line\">IMAGE          CREATED       CREATED BY                                      SIZE      COMMENT</span><br><span class=\"line\">ea335eea17ab   13 days ago   /bin/sh -c #(nop)  CMD [&quot;nginx&quot; &quot;-g&quot; &quot;daemon…   0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  STOPSIGNAL SIGQUIT           0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENTRYPOINT [&quot;/docker-entr…   0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:09a214a3e07c919a…   4.61kB    </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0fd5fca330dcd6a7…   1.04kB    </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:0b866ff3fc1ef5b0…   1.96kB    </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop) COPY file:65504f71f5855ca0…   1.2kB     </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c set -x     &amp;&amp; addgroup --system -…   61.1MB    </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV PKG_RELEASE=1~bullseye   0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NJS_VERSION=0.7.0        0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  ENV NGINX_VERSION=1.21.4     0B        </span><br><span class=\"line\">&lt;missing&gt;      13 days ago   /bin/sh -c #(nop)  LABEL maintainer=NGINX Do…   0B        </span><br><span class=\"line\">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop)  CMD [&quot;bash&quot;]                 0B        </span><br><span class=\"line\">&lt;missing&gt;      2 weeks ago   /bin/sh -c #(nop) ADD file:a2405ebb9892d98be…   80.4MB    </span><br></pre></td></tr></table></figure>\n<h3 id=\"437-docker-image-inspect查看指定镜像的详细信息\"><a class=\"markdownIt-Anchor\" href=\"#437-docker-image-inspect查看指定镜像的详细信息\">#</a> 4.3.7 docker image inspect (查看指定镜像的详细信息)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker image inspect nginx</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;Id&quot;: &quot;sha256:ea335eea17ab984571cd4a3bcf90a0413773b559c75ef4cda07d0ce952b00291&quot;,</span><br><span class=\"line\">        &quot;RepoTags&quot;: [</span><br><span class=\"line\">            &quot;nginx:latest&quot;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        &quot;RepoDigests&quot;: [</span><br><span class=\"line\">            &quot;nginx@sha256:097c3a0913d7e3a5b01b6c685a60c03632fc7a2b50bc8e35bcaa3691d788226e&quot;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class=\"line\">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class=\"line\">        &quot;Created&quot;: &quot;2021-11-17T10:38:14.652464384Z&quot;,</span><br><span class=\"line\">        &quot;Container&quot;: &quot;8a038ff17987cf87d4b7d7e2c80cb83bd2474d66e2dd0719e2b4f7de2ad6d853&quot;,</span><br><span class=\"line\">        &quot;ContainerConfig&quot;: &#123;</span><br><span class=\"line\">            &quot;Hostname&quot;: &quot;8a038ff17987&quot;,</span><br><span class=\"line\">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class=\"line\">            &quot;User&quot;: &quot;&quot;,</span><br><span class=\"line\">            &quot;AttachStdin&quot;: false,</span><br><span class=\"line\">            &quot;AttachStdout&quot;: false,</span><br><span class=\"line\">            &quot;AttachStderr&quot;: false,</span><br><span class=\"line\">            &quot;ExposedPorts&quot;: &#123;</span><br><span class=\"line\">                &quot;80/tcp&quot;: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"438-删除镜像\"><a class=\"markdownIt-Anchor\" href=\"#438-删除镜像\">#</a> 4.3.8 删除镜像</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   57 minutes ago   Exited (0) 6 minutes ago             youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker images</span><br><span class=\"line\">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">httpd        latest    ad17c88403e2   12 days ago   143MB</span><br><span class=\"line\">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker rmi ad17c88403e2</span><br><span class=\"line\">Untagged: httpd:latest</span><br><span class=\"line\">Untagged: httpd@sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class=\"line\">Deleted: sha256:ad17c88403e2cedd27963b98be7f04bd3f903dfa7490586de397d0404424936d</span><br><span class=\"line\">Deleted: sha256:a59e7dfeeb485a8a45b1fcce812b10fbd955d304fa2e9ca43b10b16a8ee1afb8</span><br><span class=\"line\">Deleted: sha256:9592080464aa1890ed187c42a13ecc9f175e975a96a3fad28df0559ad0c08b9d</span><br><span class=\"line\">Deleted: sha256:42d2debfa0c419f7f89affa3e9b62d1b7e54dc6654dbd186d4654ee3661c44c8</span><br><span class=\"line\">Deleted: sha256:136822c50a75392f4ce06461fa4894aa7d1e060ec0dd4782e13e2d9829df50a3</span><br><span class=\"line\">[root@Docker ~]# docker images</span><br><span class=\"line\">REPOSITORY   TAG       IMAGE ID       CREATED       SIZE</span><br><span class=\"line\">nginx        latest    ea335eea17ab   13 days ago   141MB</span><br></pre></td></tr></table></figure>\n<h3 id=\"439-docker-create创建容器\"><a class=\"markdownIt-Anchor\" href=\"#439-docker-create创建容器\">#</a> 4.3.9 docker create (创建容器)</h3>\n<p>此命令只会创建容器，而不会运行容器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker create nginx</span><br><span class=\"line\">8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74</span><br></pre></td></tr></table></figure>\n<h3 id=\"4310-docker-ps列出容器\"><a class=\"markdownIt-Anchor\" href=\"#4310-docker-ps列出容器\">#</a> 4.3.10 docker ps (列出容器)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps         //查看正在运行的容器</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps -a        //查看所有容器</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS    PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   3 minutes ago   Created             youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4311-docker-start启动容器\"><a class=\"markdownIt-Anchor\" href=\"#4311-docker-start启动容器\">#</a> 4.3.11 docker start (启动容器)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker start 8442117bc0c7        #启动容器，后面接容器的ID号，ID号可以简写</span><br><span class=\"line\">8442117bc0c7</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS          PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   8 minutes ago   Up 14 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4312-docker-attach进入容器\"><a class=\"markdownIt-Anchor\" href=\"#4312-docker-attach进入容器\">#</a> 4.3.12 docker attach (进入容器)</h3>\n<p>在当前 shell 下 attach 连接指定运行镜像，以这种方式进入容器，此时容器会一直占用前台，如果退出容器，容器就会停止</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   50 minutes ago   Up 30 seconds   80/tcp    youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker attach 8442117bc0c7</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br></pre></td></tr></table></figure>\n<h3 id=\"4313-docker-exec进入容器\"><a class=\"markdownIt-Anchor\" href=\"#4313-docker-exec进入容器\">#</a> 4.3.13 docker exec (进入容器)</h3>\n<p>用这个命令进入容器后台运行就算是退出了容器，容器也不会停止运行</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   26 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker exec -it 8442117bc0c7 /bin/bash</span><br><span class=\"line\">root@8442117bc0c7:/# ls</span><br><span class=\"line\">bin  boot  dev\tdocker-entrypoint.d  docker-entrypoint.sh  etc\thome  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class=\"line\">root@8442117bc0c7:/# exit</span><br><span class=\"line\">exit</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   27 minutes ago   Up 23 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4314-docker-inspect查看容器的信息详细\"><a class=\"markdownIt-Anchor\" href=\"#4314-docker-inspect查看容器的信息详细\">#</a> 4.3.14 docker inspect (查看容器的信息详细)</h3>\n<p>通过查看详细信息可以查看其容器的 IP 地址</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker inspect 8442117bc0c7</span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        &quot;Id&quot;: &quot;8442117bc0c7b85609a77229433413a85ac0fa951fe9c0efc3c340b1299fbd74&quot;,</span><br><span class=\"line\">        &quot;Created&quot;: &quot;2021-12-01T07:28:48.929261547Z&quot;,</span><br><span class=\"line\">        &quot;Path&quot;: &quot;/docker-entrypoint.sh&quot;,</span><br><span class=\"line\">        &quot;Args&quot;: [</span><br><span class=\"line\">            &quot;nginx&quot;,</span><br><span class=\"line\">            &quot;-g&quot;,</span><br><span class=\"line\">            &quot;daemon off;&quot;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        &quot;State&quot;: &#123;</span><br><span class=\"line\">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class=\"line\">            &quot;Running&quot;: true,</span><br><span class=\"line\">            &quot;Paused&quot;: false,</span><br><span class=\"line\">            &quot;Restarting&quot;: false,</span><br><span class=\"line\">            &quot;OOMKilled&quot;: false,</span><br><span class=\"line\">            &quot;Dead&quot;: false,</span><br><span class=\"line\">            &quot;Pid&quot;: 5390,</span><br><span class=\"line\">            &quot;ExitCode&quot;: 0,</span><br><span class=\"line\">            &quot;Error&quot;: &quot;&quot;,</span><br><span class=\"line\">            &quot;StartedAt&quot;: &quot;2021-12-01T07:36:41.636489391Z&quot;,</span><br><span class=\"line\">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">......</span><br></pre></td></tr></table></figure>\n<h3 id=\"4315-docker-logs查看容器日志\"><a class=\"markdownIt-Anchor\" href=\"#4315-docker-logs查看容器日志\">#</a> 4.3.15 docker logs (查看容器日志)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker logs 8442117bc0c7</span><br><span class=\"line\">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span><br><span class=\"line\">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span><br><span class=\"line\">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span><br><span class=\"line\">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span><br><span class=\"line\">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span><br><span class=\"line\">/docker-entrypoint.sh: Configuration complete; ready for start up</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: using the &quot;epoll&quot; event method</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: nginx/1.21.4</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) </span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: OS: Linux 4.18.0-257.el8.x86_64</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: start worker processes</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: start worker process 31</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: start worker process 32</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: start worker process 33</span><br><span class=\"line\">2021/12/01 07:36:41 [notice] 1#1: start worker process 34</span><br><span class=\"line\">172.17.0.1 - - [01/Dec/2021:07:43:23 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class=\"line\">172.17.0.1 - - [01/Dec/2021:07:43:44 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class=\"line\">172.17.0.1 - - [01/Dec/2021:07:43:45 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class=\"line\">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br><span class=\"line\">172.17.0.1 - - [01/Dec/2021:07:43:46 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.61.1&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4316-docker-stop停止容器\"><a class=\"markdownIt-Anchor\" href=\"#4316-docker-stop停止容器\">#</a> 4.3.16 docker stop (停止容器)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Up 8 minutes   80/tcp    youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker stop 8442117bc0c7</span><br><span class=\"line\">8442117bc0c7</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps -a </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   16 minutes ago   Exited (0) 5 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4317-docker-restart重启容器\"><a class=\"markdownIt-Anchor\" href=\"#4317-docker-restart重启容器\">#</a> 4.3.17 docker restart (重启容器)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps -a </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Exited (0) 46 seconds ago             youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker restart 8442117bc0c7</span><br><span class=\"line\">8442117bc0c7</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   17 minutes ago   Up 3 seconds   80/tcp    youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4318-docker-kill杀死正在运行的容器\"><a class=\"markdownIt-Anchor\" href=\"#4318-docker-kill杀死正在运行的容器\">#</a> 4.3.18 docker kill (杀死正在运行的容器)</h3>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Up 2 minutes   80/tcp    youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker kill 8442117bc0c7 </span><br><span class=\"line\">8442117bc0c7</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                       PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   20 minutes ago   Exited (137) 4 seconds ago             youthful_euclid</span><br></pre></td></tr></table></figure>\n<h3 id=\"4319-docker-run创建并启动容器\"><a class=\"markdownIt-Anchor\" href=\"#4319-docker-run创建并启动容器\">#</a> 4.3.19 docker run (创建并启动容器)</h3>\n<p>此命令会做三件事情，首先先查看本地是否都对应的镜像，如果没有就拉取，然后创建容器，然后运行容器</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                     PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   35 minutes ago   Exited (0) 5 minutes ago             youthful_euclid</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker run -it httpd /bin/bash        #此命令的作用是，拉取一个httpd的镜像，然后创建容器并运行，-it表示以交互的方式进入终端，/bin/bash表示终端的环境</span><br><span class=\"line\">Unable to find image &#x27;httpd:latest&#x27; locally</span><br><span class=\"line\">latest: Pulling from library/httpd</span><br><span class=\"line\">eff15d958d66: Already exists </span><br><span class=\"line\">ba1caf8ba86c: Pull complete </span><br><span class=\"line\">ab86dc02235d: Pull complete </span><br><span class=\"line\">0d58b11d2867: Pull complete </span><br><span class=\"line\">e88da7cb925c: Pull complete </span><br><span class=\"line\">Digest: sha256:1d71eef54c08435c0be99877c408637f03112dc9f929fba3cccdd15896099b02</span><br><span class=\"line\">Status: Downloaded newer image for httpd:latest</span><br><span class=\"line\">root@a01b8d80a160:/usr/local/apache2# ls</span><br><span class=\"line\">bin  build  cgi-bin  conf  error  htdocs  icons  include  logs\tmodules</span><br></pre></td></tr></table></figure>\n<h3 id=\"4320-docker-rm删除容器\"><a class=\"markdownIt-Anchor\" href=\"#4320-docker-rm删除容器\">#</a> 4.3.20 docker rm (删除容器)</h3>\n<p>删除一个或者多个容器，只能删除停止状态的容器或者 - f 强制删除</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS         PORTS     NAMES</span><br><span class=\"line\">a01b8d80a160   httpd     &quot;/bin/bash&quot;   10 minutes ago   Up 3 seconds   80/tcp    hardcore_varahamihira</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker rm a01b8d80a160</span><br><span class=\"line\">Error response from daemon: You cannot remove a running container a01b8d80a1609e81d8d8121b3fc3c0f53a676340b3b093b353a7f9bb498fe0e6. Stop the container before attempting removal or force remove</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker rm -f a01b8d80a160</span><br><span class=\"line\">a01b8d80a160</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps </span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class=\"line\"></span><br><span class=\"line\">[root@Docker ~]# docker ps -a</span><br><span class=\"line\">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS                      PORTS     NAMES</span><br><span class=\"line\">8442117bc0c7   nginx     &quot;/docker-entrypoint.…&quot;   48 minutes ago   Exited (0) 18 minutes ago             youthful_euclid</span><br></pre></td></tr></table></figure>\n<h1 id=\"5-docker-event-state\"><a class=\"markdownIt-Anchor\" href=\"#5-docker-event-state\">#</a> 5 Docker event state</h1>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20210104183609729.jpg\" alt=\"在这里插入图片描述\"></p>\n<p>本文来自 CSDN</p>\n<p>原文链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NjcyNzEyOS9hcnRpY2xlL2RldGFpbHMvMTIxNjY1NjY4\">https://blog.csdn.net/weixin_46727129/article/details/121665668</span></p>\n",
            "tags": []
        },
        {
            "id": "http://example.com/2022/11/22/Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85jenkins/",
            "url": "http://example.com/2022/11/22/Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%AE%89%E8%A3%85jenkins/",
            "title": "Linux环境下安装jenkins",
            "date_published": "2022-11-22T02:19:35.591Z",
            "content_html": "<h1 id=\"linux环境下安装jenkins\"><a class=\"markdownIt-Anchor\" href=\"#linux环境下安装jenkins\">#</a> Linux 环境下安装 jenkins</h1>\n<h3 id=\"1-添加存储库\"><a class=\"markdownIt-Anchor\" href=\"#1-添加存储库\">#</a> 1、添加存储库</h3>\n<p>yum 的 repo 中默认没有 Jenkins，需要先将 Jenkins 存储库添加到 yum repos，执行下面的命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br></pre></td></tr></table></figure>\n<p>完成界面：</p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171035460.png\" alt=\"在这里插入图片描述\"></p>\n<p>然后执行下面的命令：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-安装jenkins\"><a class=\"markdownIt-Anchor\" href=\"#2-安装jenkins\">#</a> 2、安装 jenkins</h3>\n<p>执行安装命令： yum install jenkins<br>\n 如下图所示，出现询问是否下载时，输入 y，然后点击回车，等待安装完成：<br>\n<img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171215646.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"3-修改配置\"><a class=\"markdownIt-Anchor\" href=\"#3-修改配置\">#</a> <strong>3、修改配置</strong></h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zby5jc2RuLm5ldC9zby9zZWFyY2g/cT1qZW5raW5zJmFtcDtzcG09MTAwMS4yMTAxLjMwMDEuNzAyMA==\">jenkins</span> 安装成功后，默认的用户是 jenkins，端口是 8080，为了防止冲突，并且给用户赋权限，我们修改用户名和端口。<br>\n输入命令，进入 jenkins 配置文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/jenkins</span><br></pre></td></tr></table></figure>\n<p>找到如下配置：</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">JENKINS_USER=&quot;jenkins&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># Type:        string</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># Default: &quot;false&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># ServiceRestart: jenkins</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># Whether to skip potentially long-running chown at the</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"variable\">$JENKINS_HOME</span> location. Do not <span class=\"built_in\">enable</span> this, <span class=\"string\">&quot;true&quot;</span>, unless</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">you know what you<span class=\"string\">&#x27;re doing. See JENKINS-23273.</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\">#JENKINS_INSTALL_SKIP_CHOWN=&quot;false&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Type: string</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Default:     &quot;-Djava.awt.headless=true&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># ServiceRestart: jenkins</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\"># Options to pass to java when running Jenkins.</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Type:        integer(0:65535)</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Default:     8080</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># ServiceRestart: jenkins</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\"># Port Jenkins is listening on.</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">Set to -1 to disable</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\">JENKINS_PORT=&quot;8080&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Type:        string</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># Default:     &quot;&quot;</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"># ServiceRestart: jenkins</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\"># IP address Jenkins listens on for HTTP requests.</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"string\">Default is all interfaces (0.0.0.0).</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"string\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"language-bash\"></span></span></span><br></pre></td></tr></table></figure>\n<h4 id=\"修改用户名端口\"><a class=\"markdownIt-Anchor\" href=\"#修改用户名端口\">#</a> 修改用户名，端口：</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/20201231171521366.png\" alt=\"在这里插入图片描述\"></p>\n<h3 id=\"若为云服务器需配置安全组并开放端口才可以正常访问\"><a class=\"markdownIt-Anchor\" href=\"#若为云服务器需配置安全组并开放端口才可以正常访问\">#</a> 若为云服务器，需配置安全组并开放端口才可以正常访问</h3>\n<h1 id=\"启动jenkins\"><a class=\"markdownIt-Anchor\" href=\"#启动jenkins\">#</a> 启动 jenkins</h1>\n<h4 id=\"1如果是2022年7月以后安装的jekins需要下载jdk11或者jdk17版本的jdk环境\"><a class=\"markdownIt-Anchor\" href=\"#1如果是2022年7月以后安装的jekins需要下载jdk11或者jdk17版本的jdk环境\">#</a> 1. 如果是 2022 年 7 月以后安装的 jekins，需要下载 jdk11 或者 jdk17 版本的 jdk 环境</h4>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install fontconfig java-11-openjdk</span><br></pre></td></tr></table></figure>\n<h3 id=\"设置自启后启动jenkins服务systemctl-enable-now-jenkins\"><a class=\"markdownIt-Anchor\" href=\"#设置自启后启动jenkins服务systemctl-enable-now-jenkins\">#</a> 设置自启后启动 jenkins 服务：systemctl enable --now jenkins</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ebae0938355.png\" alt=\"jenkins在linux下安装（rpm包）_javascript_07\"></p>\n<h3 id=\"查看是否自启动systemctl-is-enabled-jenkins\"><a class=\"markdownIt-Anchor\" href=\"#查看是否自启动systemctl-is-enabled-jenkins\">#</a> 查看是否自启动：systemctl is-enabled jenkins</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ecdddd6790.png\" alt=\"jenkins在linux下安装（rpm包）_java_08\"></p>\n<h3 id=\"查看服务状态systemctl-status-jenkinsservice\"><a class=\"markdownIt-Anchor\" href=\"#查看服务状态systemctl-status-jenkinsservice\">#</a> 查看服务状态：systemctl status jenkins.service</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288ee068451100.png\" alt=\"jenkins在linux下安装（rpm包）_java_09\"></p>\n<h3 id=\"jenkins-failed-to-find-a-valid-java-installation\"><a class=\"markdownIt-Anchor\" href=\"#jenkins-failed-to-find-a-valid-java-installation\">#</a> jenkins: failed to find a valid Java installation</h3>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013406_6337288eeec5c74170.png\" alt=\"jenkins在linux下安装（rpm包）_javascript_10\"></p>\n<h3 id=\"使用以下方法启动jenkins\"><a class=\"markdownIt-Anchor\" href=\"#使用以下方法启动jenkins\">#</a> 使用以下方法启动 jenkins</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cd /etc/init.d</span><br><span class=\"line\"></span><br><span class=\"line\"># 启动</span><br><span class=\"line\">./jenkins start</span><br><span class=\"line\"># 停止</span><br><span class=\"line\">./jenkins stop</span><br><span class=\"line\"># 状态</span><br><span class=\"line\">./jenkins status</span><br></pre></td></tr></table></figure>\n<h3 id=\"提示jdk版本不满足-可能是jdk11没有配置到jeknins上\"><a class=\"markdownIt-Anchor\" href=\"#提示jdk版本不满足-可能是jdk11没有配置到jeknins上\">#</a> 提示 jdk 版本不满足，可能是 jdk11 没有配置到 jeknins 上</h3>\n<h4 id=\"jenkins-requires-java-versions-17-11-but-you-are-running-with-java-18-from-usrlocaljdk180_211jre\"><a class=\"markdownIt-Anchor\" href=\"#jenkins-requires-java-versions-17-11-but-you-are-running-with-java-18-from-usrlocaljdk180_211jre\">#</a> Jenkins requires Java versions [17, 11] but you are running with Java 1.8 from /usr/local/jdk1.8.0_211/jre</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/01013407_6337288f30b9997576.png\" alt=\"jenkins在linux下安装（rpm包）_json_13\"></p>\n<h4 id=\"将jdk11的环境配置到-etcrcdinitdjenkins-的candidates中\"><a class=\"markdownIt-Anchor\" href=\"#将jdk11的环境配置到-etcrcdinitdjenkins-的candidates中\">#</a> 将 jdk11 的环境配置到 /etc/rc.d/init.d/jenkins 的 candidates 中</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105322847.png\" alt=\"image-20221122105322847\"></p>\n<h4 id=\"重新启动服务没有报错\"><a class=\"markdownIt-Anchor\" href=\"#重新启动服务没有报错\">#</a> 重新启动服务，没有报错</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105452465.png\" alt=\"image-20221122105452465\"></p>\n<h4 id=\"访问-jenkins第一次需要输入生成的密码在-varlibjenkinssecrets-目录下的initialadminpassword文件中\"><a class=\"markdownIt-Anchor\" href=\"#访问-jenkins第一次需要输入生成的密码在-varlibjenkinssecrets-目录下的initialadminpassword文件中\">#</a> 访问 Jenkins，第一次需要输入生成的密码，在 /var/lib/jenkins/secrets 目录下的 initialAdminPassword 文件中</h4>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122104907426.png\" alt=\"image-20221122104907426\"></p>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122104919096.png\" alt=\"image-20221122104919096\"></p>\n<h2 id=\"成功\"><a class=\"markdownIt-Anchor\" href=\"#成功\">#</a> 成功</h2>\n<p><img data-src=\"https://brath.oss-cn-shanghai.aliyuncs.com/pigo/image-20221122105607288.png\" alt=\"image-20221122105607288\"></p>\n",
            "tags": []
        }
    ]
}